var E_=Object.defineProperty;var S_=(s,e,t)=>e in s?E_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var oe=(s,e,t)=>S_(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},uh={},ch;function O_(){if(ch)return uh;ch=1;var s={};/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */var e;return function(t){(function(n){var i=typeof Ci=="object"?Ci:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=a(t);typeof i.Reflect>"u"?i.Reflect=t:r=a(i.Reflect,r),n(r);function a(o,l){return function(u,c){typeof o[u]!="function"&&Object.defineProperty(o,u,{configurable:!0,writable:!0,value:c}),l&&l(u,c)}}})(function(n){var i=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",a=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",l=typeof Object.create=="function",u={__proto__:[]}instanceof Array,c=!l&&!u,d={create:l?function(){return Mt(Object.create(null))}:u?function(){return Mt({__proto__:null})}:function(){return Mt({})},has:c?function(ae,D){return i.call(ae,D)}:function(ae,D){return D in ae},get:c?function(ae,D){return i.call(ae,D)?ae[D]:void 0}:function(ae,D){return ae[D]}},h=Object.getPrototypeOf(Function),p=typeof process=="object"&&s&&s.REFLECT_METADATA_USE_MAP_POLYFILL==="true",g=!p&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:yt(),f=!p&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ht(),m=!p&&typeof WeakMap=="function"?WeakMap:Dr(),C=new m;function _(ae,D,O,k){if(ne(O)){if(!we(ae))throw new TypeError;if(!Le(D))throw new TypeError;return U(ae,D)}else{if(!we(ae))throw new TypeError;if(!Ce(D))throw new TypeError;if(!Ce(k)&&!ne(k)&&!de(k))throw new TypeError;return de(k)&&(k=void 0),O=Re(O),W(ae,D,O,k)}}n("decorate",_);function y(ae,D){function O(k,w){if(!Ce(k))throw new TypeError;if(!ne(w)&&!Ue(w))throw new TypeError;q(ae,D,k,w)}return O}n("metadata",y);function T(ae,D,O,k){if(!Ce(O))throw new TypeError;return ne(k)||(k=Re(k)),q(ae,D,O,k)}n("defineMetadata",T);function E(ae,D,O){if(!Ce(D))throw new TypeError;return ne(O)||(O=Re(O)),B(ae,D,O)}n("hasMetadata",E);function b(ae,D,O){if(!Ce(D))throw new TypeError;return ne(O)||(O=Re(O)),V(ae,D,O)}n("hasOwnMetadata",b);function v(ae,D,O){if(!Ce(D))throw new TypeError;return ne(O)||(O=Re(O)),J(ae,D,O)}n("getMetadata",v);function I(ae,D,O){if(!Ce(D))throw new TypeError;return ne(O)||(O=Re(O)),$(ae,D,O)}n("getOwnMetadata",I);function R(ae,D){if(!Ce(ae))throw new TypeError;return ne(D)||(D=Re(D)),Q(ae,D)}n("getMetadataKeys",R);function N(ae,D){if(!Ce(ae))throw new TypeError;return ne(D)||(D=Re(D)),ie(ae,D)}n("getOwnMetadataKeys",N);function L(ae,D,O){if(!Ce(D))throw new TypeError;ne(O)||(O=Re(O));var k=M(D,O,!1);if(ne(k)||!k.delete(ae))return!1;if(k.size>0)return!0;var w=C.get(D);return w.delete(O),w.size>0||C.delete(D),!0}n("deleteMetadata",L);function U(ae,D){for(var O=ae.length-1;O>=0;--O){var k=ae[O],w=k(D);if(!ne(w)&&!de(w)){if(!Le(w))throw new TypeError;D=w}}return D}function W(ae,D,O,k){for(var w=ae.length-1;w>=0;--w){var z=ae[w],Z=z(D,O,k);if(!ne(Z)&&!de(Z)){if(!Ce(Z))throw new TypeError;k=Z}}return k}function M(ae,D,O){var k=C.get(ae);if(ne(k)){if(!O)return;k=new g,C.set(ae,k)}var w=k.get(D);if(ne(w)){if(!O)return;w=new g,k.set(D,w)}return w}function B(ae,D,O){var k=V(ae,D,O);if(k)return!0;var w=vt(D);return de(w)?!1:B(ae,w,O)}function V(ae,D,O){var k=M(D,O,!1);return ne(k)?!1:Te(k.has(ae))}function J(ae,D,O){var k=V(ae,D,O);if(k)return $(ae,D,O);var w=vt(D);if(!de(w))return J(ae,w,O)}function $(ae,D,O){var k=M(D,O,!1);if(!ne(k))return k.get(ae)}function q(ae,D,O,k){var w=M(O,k,!0);w.set(ae,D)}function Q(ae,D){var O=ie(ae,D),k=vt(ae);if(k===null)return O;var w=Q(k,D);if(w.length<=0)return O;if(O.length<=0)return w;for(var z=new f,Z=[],se=0,me=O;se<me.length;se++){var Pe=me[se],be=z.has(Pe);be||(z.add(Pe),Z.push(Pe))}for(var He=0,nt=w;He<nt.length;He++){var Pe=nt[He],be=z.has(Pe);be||(z.add(Pe),Z.push(Pe))}return Z}function ie(ae,D){var O=[],k=M(ae,D,!1);if(ne(k))return O;for(var w=k.keys(),z=Bt(w),Z=0;;){var se=Nt(z);if(!se)return O.length=Z,O;var me=Fe(se);try{O[Z]=me}catch(Pe){try{Xe(z)}finally{throw Pe}}Z++}}function Y(ae){if(ae===null)return 1;switch(typeof ae){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return ae===null?1:6;default:return 6}}function ne(ae){return ae===void 0}function de(ae){return ae===null}function Ae(ae){return typeof ae=="symbol"}function Ce(ae){return typeof ae=="object"?ae!==null:typeof ae=="function"}function pe(ae,D){switch(Y(ae)){case 0:return ae;case 1:return ae;case 2:return ae;case 3:return ae;case 4:return ae;case 5:return ae}var O="string",k=at(ae,a);if(k!==void 0){var w=k.call(ae,O);if(Ce(w))throw new TypeError;return w}return fe(ae)}function fe(ae,D){var O,k;{var w=ae.toString;if(Me(w)){var k=w.call(ae);if(!Ce(k))return k}var O=ae.valueOf;if(Me(O)){var k=O.call(ae);if(!Ce(k))return k}}throw new TypeError}function Te(ae){return!!ae}function xe(ae){return""+ae}function Re(ae){var D=pe(ae);return Ae(D)?D:xe(D)}function we(ae){return Array.isArray?Array.isArray(ae):ae instanceof Object?ae instanceof Array:Object.prototype.toString.call(ae)==="[object Array]"}function Me(ae){return typeof ae=="function"}function Le(ae){return typeof ae=="function"}function Ue(ae){switch(Y(ae)){case 3:return!0;case 4:return!0;default:return!1}}function at(ae,D){var O=ae[D];if(O!=null){if(!Me(O))throw new TypeError;return O}}function Bt(ae){var D=at(ae,o);if(!Me(D))throw new TypeError;var O=D.call(ae);if(!Ce(O))throw new TypeError;return O}function Fe(ae){return ae.value}function Nt(ae){var D=ae.next();return D.done?!1:D}function Xe(ae){var D=ae.return;D&&D.call(ae)}function vt(ae){var D=Object.getPrototypeOf(ae);if(typeof ae!="function"||ae===h||D!==h)return D;var O=ae.prototype,k=O&&Object.getPrototypeOf(O);if(k==null||k===Object.prototype)return D;var w=k.constructor;return typeof w!="function"||w===ae?D:w}function yt(){var ae={},D=[],O=function(){function Z(se,me,Pe){this._index=0,this._keys=se,this._values=me,this._selector=Pe}return Z.prototype["@@iterator"]=function(){return this},Z.prototype[o]=function(){return this},Z.prototype.next=function(){var se=this._index;if(se>=0&&se<this._keys.length){var me=this._selector(this._keys[se],this._values[se]);return se+1>=this._keys.length?(this._index=-1,this._keys=D,this._values=D):this._index++,{value:me,done:!1}}return{value:void 0,done:!0}},Z.prototype.throw=function(se){throw this._index>=0&&(this._index=-1,this._keys=D,this._values=D),se},Z.prototype.return=function(se){return this._index>=0&&(this._index=-1,this._keys=D,this._values=D),{value:se,done:!0}},Z}();return function(){function Z(){this._keys=[],this._values=[],this._cacheKey=ae,this._cacheIndex=-2}return Object.defineProperty(Z.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Z.prototype.has=function(se){return this._find(se,!1)>=0},Z.prototype.get=function(se){var me=this._find(se,!1);return me>=0?this._values[me]:void 0},Z.prototype.set=function(se,me){var Pe=this._find(se,!0);return this._values[Pe]=me,this},Z.prototype.delete=function(se){var me=this._find(se,!1);if(me>=0){for(var Pe=this._keys.length,be=me+1;be<Pe;be++)this._keys[be-1]=this._keys[be],this._values[be-1]=this._values[be];return this._keys.length--,this._values.length--,se===this._cacheKey&&(this._cacheKey=ae,this._cacheIndex=-2),!0}return!1},Z.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=ae,this._cacheIndex=-2},Z.prototype.keys=function(){return new O(this._keys,this._values,k)},Z.prototype.values=function(){return new O(this._keys,this._values,w)},Z.prototype.entries=function(){return new O(this._keys,this._values,z)},Z.prototype["@@iterator"]=function(){return this.entries()},Z.prototype[o]=function(){return this.entries()},Z.prototype._find=function(se,me){return this._cacheKey!==se&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=se)),this._cacheIndex<0&&me&&(this._cacheIndex=this._keys.length,this._keys.push(se),this._values.push(void 0)),this._cacheIndex},Z}();function k(Z,se){return Z}function w(Z,se){return se}function z(Z,se){return[Z,se]}}function Ht(){return function(){function ae(){this._map=new g}return Object.defineProperty(ae.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),ae.prototype.has=function(D){return this._map.has(D)},ae.prototype.add=function(D){return this._map.set(D,D),this},ae.prototype.delete=function(D){return this._map.delete(D)},ae.prototype.clear=function(){this._map.clear()},ae.prototype.keys=function(){return this._map.keys()},ae.prototype.values=function(){return this._map.values()},ae.prototype.entries=function(){return this._map.entries()},ae.prototype["@@iterator"]=function(){return this.keys()},ae.prototype[o]=function(){return this.keys()},ae}()}function Dr(){var ae=16,D=d.create(),O=k();return function(){function me(){this._key=k()}return me.prototype.has=function(Pe){var be=w(Pe,!1);return be!==void 0?d.has(be,this._key):!1},me.prototype.get=function(Pe){var be=w(Pe,!1);return be!==void 0?d.get(be,this._key):void 0},me.prototype.set=function(Pe,be){var He=w(Pe,!0);return He[this._key]=be,this},me.prototype.delete=function(Pe){var be=w(Pe,!1);return be!==void 0?delete be[this._key]:!1},me.prototype.clear=function(){this._key=k()},me}();function k(){var me;do me="@@WeakMap@@"+se();while(d.has(D,me));return D[me]=!0,me}function w(me,Pe){if(!i.call(me,O)){if(!Pe)return;Object.defineProperty(me,O,{value:d.create()})}return me[O]}function z(me,Pe){for(var be=0;be<Pe;++be)me[be]=Math.random()*255|0;return me}function Z(me){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(me)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(me)):z(new Uint8Array(me),me):z(new Array(me),me)}function se(){var me=Z(ae);me[6]=me[6]&79|64,me[8]=me[8]&191|128;for(var Pe="",be=0;be<ae;++be){var He=me[be];(be===4||be===6||be===8)&&(Pe+="-"),He<16&&(Pe+="0"),Pe+=He.toString(16).toLowerCase()}return Pe}}function Mt(ae){return ae.__=void 0,delete ae.__,ae}})}(e||(e={})),uh}O_();const Ii=function(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof self<"u")return self;if(typeof window<"u")return window;try{return new Function("return this")()}catch{return{}}}();Ii.trustedTypes===void 0&&(Ii.trustedTypes={createPolicy:(s,e)=>e});const Zp={configurable:!1,enumerable:!1,writable:!1};Ii.FAST===void 0&&Reflect.defineProperty(Ii,"FAST",Object.assign({value:Object.create(null)},Zp));const Zo=Ii.FAST;if(Zo.getById===void 0){const s=Object.create(null);Reflect.defineProperty(Zo,"getById",Object.assign({value(e,t){let n=s[e];return n===void 0&&(n=t?s[e]=t():null),n}},Zp))}const dn=Object.freeze([]),Xl=Ii.FAST.getById(1,()=>{const s=[],e=[];function t(){if(e.length)throw e.shift()}function n(a){try{a.call()}catch(o){e.push(o),setTimeout(t,0)}}function i(){let o=0;for(;o<s.length;)if(n(s[o]),o++,o>1024){for(let l=0,u=s.length-o;l<u;l++)s[l]=s[l+o];s.length-=o,o=0}s.length=0}function r(a){s.length<1&&Ii.requestAnimationFrame(i),s.push(a)}return Object.freeze({enqueue:r,process:i})}),Qp=Ii.trustedTypes.createPolicy("fast-html",{createHTML:s=>s});let Jl=Qp;const zo=`fast-${Math.random().toString(36).substring(2,8)}`,eg=`${zo}{`,tc=`}${zo}`,it=Object.freeze({supportsAdoptedStyleSheets:Array.isArray(document.adoptedStyleSheets)&&"replace"in CSSStyleSheet.prototype,setHTMLPolicy(s){if(Jl!==Qp)throw new Error("The HTML policy can only be set once.");Jl=s},createHTML(s){return Jl.createHTML(s)},isMarker(s){return s&&s.nodeType===8&&s.data.startsWith(zo)},extractDirectiveIndexFromMarker(s){return parseInt(s.data.replace(`${zo}:`,""))},createInterpolationPlaceholder(s){return`${eg}${s}${tc}`},createCustomAttributePlaceholder(s,e){return`${s}="${this.createInterpolationPlaceholder(e)}"`},createBlockPlaceholder(s){return`<!--${zo}:${s}-->`},queueUpdate:Xl.enqueue,processUpdates:Xl.process,nextUpdate(){return new Promise(Xl.enqueue)},setAttribute(s,e,t){t==null?s.removeAttribute(e):s.setAttribute(e,t)},setBooleanAttribute(s,e,t){t?s.setAttribute(e,""):s.removeAttribute(e)},removeChildNodes(s){for(let e=s.firstChild;e!==null;e=s.firstChild)s.removeChild(e)},createTemplateWalker(s){return document.createTreeWalker(s,133,null,!1)}});class Cs{constructor(e,t){this.sub1=void 0,this.sub2=void 0,this.spillover=void 0,this.source=e,this.sub1=t}has(e){return this.spillover===void 0?this.sub1===e||this.sub2===e:this.spillover.indexOf(e)!==-1}subscribe(e){const t=this.spillover;if(t===void 0){if(this.has(e))return;if(this.sub1===void 0){this.sub1=e;return}if(this.sub2===void 0){this.sub2=e;return}this.spillover=[this.sub1,this.sub2,e],this.sub1=void 0,this.sub2=void 0}else t.indexOf(e)===-1&&t.push(e)}unsubscribe(e){const t=this.spillover;if(t===void 0)this.sub1===e?this.sub1=void 0:this.sub2===e&&(this.sub2=void 0);else{const n=t.indexOf(e);n!==-1&&t.splice(n,1)}}notify(e){const t=this.spillover,n=this.source;if(t===void 0){const i=this.sub1,r=this.sub2;i!==void 0&&i.handleChange(n,e),r!==void 0&&r.handleChange(n,e)}else for(let i=0,r=t.length;i<r;++i)t[i].handleChange(n,e)}}class tg{constructor(e){this.subscribers={},this.sourceSubscribers=null,this.source=e}notify(e){var t;const n=this.subscribers[e];n!==void 0&&n.notify(e),(t=this.sourceSubscribers)===null||t===void 0||t.notify(e)}subscribe(e,t){var n;if(t){let i=this.subscribers[t];i===void 0&&(this.subscribers[t]=i=new Cs(this.source)),i.subscribe(e)}else this.sourceSubscribers=(n=this.sourceSubscribers)!==null&&n!==void 0?n:new Cs(this.source),this.sourceSubscribers.subscribe(e)}unsubscribe(e,t){var n;if(t){const i=this.subscribers[t];i!==void 0&&i.unsubscribe(e)}else(n=this.sourceSubscribers)===null||n===void 0||n.unsubscribe(e)}}const Pt=Zo.getById(2,()=>{const s=/(:|&&|\|\||if)/,e=new WeakMap,t=new WeakMap,n=it.queueUpdate;let i,r=c=>{throw new Error("Must call enableArrayObservation before observing arrays.")};function a(c){let d=c.$fastController||e.get(c);return d===void 0&&(Array.isArray(c)?d=r(c):e.set(c,d=new tg(c))),d}function o(c){let d=t.get(c);if(d===void 0){let h=Reflect.getPrototypeOf(c);for(;d===void 0&&h!==null;)d=t.get(h),h=Reflect.getPrototypeOf(h);d===void 0?d=[]:d=d.slice(0),t.set(c,d)}return d}class l{constructor(d){this.name=d,this.field=`_${d}`,this.callback=`${d}Changed`}getValue(d){return i!==void 0&&i.watch(d,this.name),d[this.field]}setValue(d,h){const p=this.field,g=d[p];if(g!==h){d[p]=h;const f=d[this.callback];typeof f=="function"&&f.call(d,g,h),a(d).notify(this.name)}}}class u extends Cs{constructor(d,h,p=!1){super(d,h),this.binding=d,this.isVolatileBinding=p,this.needsRefresh=!0,this.needsQueue=!0,this.first=this,this.last=null,this.propertySource=void 0,this.propertyName=void 0,this.notifier=void 0,this.next=void 0}observe(d,h){this.needsRefresh&&this.last!==null&&this.disconnect();const p=i;i=this.needsRefresh?this:void 0,this.needsRefresh=this.isVolatileBinding;const g=this.binding(d,h);return i=p,g}disconnect(){if(this.last!==null){let d=this.first;for(;d!==void 0;)d.notifier.unsubscribe(this,d.propertyName),d=d.next;this.last=null,this.needsRefresh=this.needsQueue=!0}}watch(d,h){const p=this.last,g=a(d),f=p===null?this.first:{};if(f.propertySource=d,f.propertyName=h,f.notifier=g,g.subscribe(this,h),p!==null){if(!this.needsRefresh){let m;i=void 0,m=p.propertySource[p.propertyName],i=this,d===m&&(this.needsRefresh=!0)}p.next=f}this.last=f}handleChange(){this.needsQueue&&(this.needsQueue=!1,n(this))}call(){this.last!==null&&(this.needsQueue=!0,this.notify(this))}records(){let d=this.first;return{next:()=>{const h=d;return h===void 0?{value:void 0,done:!0}:(d=d.next,{value:h,done:!1})},[Symbol.iterator]:function(){return this}}}}return Object.freeze({setArrayObserverFactory(c){r=c},getNotifier:a,track(c,d){i!==void 0&&i.watch(c,d)},trackVolatile(){i!==void 0&&(i.needsRefresh=!0)},notify(c,d){a(c).notify(d)},defineProperty(c,d){typeof d=="string"&&(d=new l(d)),o(c).push(d),Reflect.defineProperty(c,d.name,{enumerable:!0,get:function(){return d.getValue(this)},set:function(h){d.setValue(this,h)}})},getAccessors:o,binding(c,d,h=this.isVolatileBinding(c)){return new u(c,d,h)},isVolatileBinding(c){return s.test(c.toString())}})});function tt(s,e){Pt.defineProperty(s,e)}const dh=Zo.getById(3,()=>{let s=null;return{get(){return s},set(e){s=e}}});class Qo{constructor(){this.index=0,this.length=0,this.parent=null,this.parentContext=null}get event(){return dh.get()}get isEven(){return this.index%2===0}get isOdd(){return this.index%2!==0}get isFirst(){return this.index===0}get isInMiddle(){return!this.isFirst&&!this.isLast}get isLast(){return this.index===this.length-1}static setEvent(e){dh.set(e)}}Pt.defineProperty(Qo.prototype,"index");Pt.defineProperty(Qo.prototype,"length");const $o=Object.seal(new Qo);class js{constructor(){this.targetIndex=0}}class rg extends js{constructor(){super(...arguments),this.createPlaceholder=it.createInterpolationPlaceholder}}class rc extends js{constructor(e,t,n){super(),this.name=e,this.behavior=t,this.options=n}createPlaceholder(e){return it.createCustomAttributePlaceholder(this.name,e)}createBehavior(e){return new this.behavior(e,this.options)}}function b_(s,e){this.source=s,this.context=e,this.bindingObserver===null&&(this.bindingObserver=Pt.binding(this.binding,this,this.isBindingVolatile)),this.updateTarget(this.bindingObserver.observe(s,e))}function v_(s,e){this.source=s,this.context=e,this.target.addEventListener(this.targetName,this)}function k_(){this.bindingObserver.disconnect(),this.source=null,this.context=null}function I_(){this.bindingObserver.disconnect(),this.source=null,this.context=null;const s=this.target.$fastView;s!==void 0&&s.isComposed&&(s.unbind(),s.needsBindOnly=!0)}function D_(){this.target.removeEventListener(this.targetName,this),this.source=null,this.context=null}function R_(s){it.setAttribute(this.target,this.targetName,s)}function P_(s){it.setBooleanAttribute(this.target,this.targetName,s)}function N_(s){if(s==null&&(s=""),s.create){this.target.textContent="";let e=this.target.$fastView;e===void 0?e=s.create():this.target.$fastTemplate!==s&&(e.isComposed&&(e.remove(),e.unbind()),e=s.create()),e.isComposed?e.needsBindOnly&&(e.needsBindOnly=!1,e.bind(this.source,this.context)):(e.isComposed=!0,e.bind(this.source,this.context),e.insertBefore(this.target),this.target.$fastView=e,this.target.$fastTemplate=s)}else{const e=this.target.$fastView;e!==void 0&&e.isComposed&&(e.isComposed=!1,e.remove(),e.needsBindOnly?e.needsBindOnly=!1:e.unbind()),this.target.textContent=s}}function M_(s){this.target[this.targetName]=s}function x_(s){const e=this.classVersions||Object.create(null),t=this.target;let n=this.version||0;if(s!=null&&s.length){const i=s.split(/\s+/);for(let r=0,a=i.length;r<a;++r){const o=i[r];o!==""&&(e[o]=n,t.classList.add(o))}}if(this.classVersions=e,this.version=n+1,n!==0){n-=1;for(const i in e)e[i]===n&&t.classList.remove(i)}}class ic extends rg{constructor(e){super(),this.binding=e,this.bind=b_,this.unbind=k_,this.updateTarget=R_,this.isBindingVolatile=Pt.isVolatileBinding(this.binding)}get targetName(){return this.originalTargetName}set targetName(e){if(this.originalTargetName=e,e!==void 0)switch(e[0]){case":":if(this.cleanedTargetName=e.substr(1),this.updateTarget=M_,this.cleanedTargetName==="innerHTML"){const t=this.binding;this.binding=(n,i)=>it.createHTML(t(n,i))}break;case"?":this.cleanedTargetName=e.substr(1),this.updateTarget=P_;break;case"@":this.cleanedTargetName=e.substr(1),this.bind=v_,this.unbind=D_;break;default:this.cleanedTargetName=e,e==="class"&&(this.updateTarget=x_);break}}targetAtContent(){this.updateTarget=N_,this.unbind=I_}createBehavior(e){return new L_(e,this.binding,this.isBindingVolatile,this.bind,this.unbind,this.updateTarget,this.cleanedTargetName)}}class L_{constructor(e,t,n,i,r,a,o){this.source=null,this.context=null,this.bindingObserver=null,this.target=e,this.binding=t,this.isBindingVolatile=n,this.bind=i,this.unbind=r,this.updateTarget=a,this.targetName=o}handleChange(){this.updateTarget(this.bindingObserver.observe(this.source,this.context))}handleEvent(e){Qo.setEvent(e);const t=this.binding(this.source,this.context);Qo.setEvent(null),t!==!0&&e.preventDefault()}}let ql=null;class nc{addFactory(e){e.targetIndex=this.targetIndex,this.behaviorFactories.push(e)}captureContentBinding(e){e.targetAtContent(),this.addFactory(e)}reset(){this.behaviorFactories=[],this.targetIndex=-1}release(){ql=this}static borrow(e){const t=ql||new nc;return t.directives=e,t.reset(),ql=null,t}}function K_(s){if(s.length===1)return s[0];let e;const t=s.length,n=s.map(a=>typeof a=="string"?()=>a:(e=a.targetName||e,a.binding)),i=(a,o)=>{let l="";for(let u=0;u<t;++u)l+=n[u](a,o);return l},r=new ic(i);return r.targetName=e,r}const w_=tc.length;function ig(s,e){const t=e.split(eg);if(t.length===1)return null;const n=[];for(let i=0,r=t.length;i<r;++i){const a=t[i],o=a.indexOf(tc);let l;if(o===-1)l=a;else{const u=parseInt(a.substring(0,o));n.push(s.directives[u]),l=a.substring(o+w_)}l!==""&&n.push(l)}return n}function hh(s,e,t=!1){const n=e.attributes;for(let i=0,r=n.length;i<r;++i){const a=n[i],o=a.value,l=ig(s,o);let u=null;l===null?t&&(u=new ic(()=>o),u.targetName=a.name):u=K_(l),u!==null&&(e.removeAttributeNode(a),i--,r--,s.addFactory(u))}}function B_(s,e,t){const n=ig(s,e.textContent);if(n!==null){let i=e;for(let r=0,a=n.length;r<a;++r){const o=n[r],l=r===0?e:i.parentNode.insertBefore(document.createTextNode(""),i.nextSibling);typeof o=="string"?l.textContent=o:(l.textContent=" ",s.captureContentBinding(o)),i=l,s.targetIndex++,l!==e&&t.nextNode()}s.targetIndex--}}function U_(s,e){const t=s.content;document.adoptNode(t);const n=nc.borrow(e);hh(n,s,!0);const i=n.behaviorFactories;n.reset();const r=it.createTemplateWalker(t);let a;for(;a=r.nextNode();)switch(n.targetIndex++,a.nodeType){case 1:hh(n,a);break;case 3:B_(n,a,r);break;case 8:it.isMarker(a)&&n.addFactory(e[it.extractDirectiveIndexFromMarker(a)])}let o=0;(it.isMarker(t.firstChild)||t.childNodes.length===1&&e.length)&&(t.insertBefore(document.createComment(""),t.firstChild),o=-1);const l=n.behaviorFactories;return n.release(),{fragment:t,viewBehaviorFactories:l,hostBehaviorFactories:i,targetOffset:o}}const Zl=document.createRange();class ng{constructor(e,t){this.fragment=e,this.behaviors=t,this.source=null,this.context=null,this.firstChild=e.firstChild,this.lastChild=e.lastChild}appendTo(e){e.appendChild(this.fragment)}insertBefore(e){if(this.fragment.hasChildNodes())e.parentNode.insertBefore(this.fragment,e);else{const t=e.parentNode,n=this.lastChild;let i=this.firstChild,r;for(;i!==n;)r=i.nextSibling,t.insertBefore(i,e),i=r;t.insertBefore(n,e)}}remove(){const e=this.fragment,t=this.lastChild;let n=this.firstChild,i;for(;n!==t;)i=n.nextSibling,e.appendChild(n),n=i;e.appendChild(t)}dispose(){const e=this.firstChild.parentNode,t=this.lastChild;let n=this.firstChild,i;for(;n!==t;)i=n.nextSibling,e.removeChild(n),n=i;e.removeChild(t);const r=this.behaviors,a=this.source;for(let o=0,l=r.length;o<l;++o)r[o].unbind(a)}bind(e,t){const n=this.behaviors;if(this.source!==e)if(this.source!==null){const i=this.source;this.source=e,this.context=t;for(let r=0,a=n.length;r<a;++r){const o=n[r];o.unbind(i),o.bind(e,t)}}else{this.source=e,this.context=t;for(let i=0,r=n.length;i<r;++i)n[i].bind(e,t)}}unbind(){if(this.source===null)return;const e=this.behaviors,t=this.source;for(let n=0,i=e.length;n<i;++n)e[n].unbind(t);this.source=null}static disposeContiguousBatch(e){if(e.length!==0){Zl.setStartBefore(e[0].firstChild),Zl.setEndAfter(e[e.length-1].lastChild),Zl.deleteContents();for(let t=0,n=e.length;t<n;++t){const i=e[t],r=i.behaviors,a=i.source;for(let o=0,l=r.length;o<l;++o)r[o].unbind(a)}}}}class ph{constructor(e,t){this.behaviorCount=0,this.hasHostBehaviors=!1,this.fragment=null,this.targetOffset=0,this.viewBehaviorFactories=null,this.hostBehaviorFactories=null,this.html=e,this.directives=t}create(e){if(this.fragment===null){let u;const c=this.html;if(typeof c=="string"){u=document.createElement("template"),u.innerHTML=it.createHTML(c);const h=u.content.firstElementChild;h!==null&&h.tagName==="TEMPLATE"&&(u=h)}else u=c;const d=U_(u,this.directives);this.fragment=d.fragment,this.viewBehaviorFactories=d.viewBehaviorFactories,this.hostBehaviorFactories=d.hostBehaviorFactories,this.targetOffset=d.targetOffset,this.behaviorCount=this.viewBehaviorFactories.length+this.hostBehaviorFactories.length,this.hasHostBehaviors=this.hostBehaviorFactories.length>0}const t=this.fragment.cloneNode(!0),n=this.viewBehaviorFactories,i=new Array(this.behaviorCount),r=it.createTemplateWalker(t);let a=0,o=this.targetOffset,l=r.nextNode();for(let u=n.length;a<u;++a){const c=n[a],d=c.targetIndex;for(;l!==null;)if(o===d){i[a]=c.createBehavior(l);break}else l=r.nextNode(),o++}if(this.hasHostBehaviors){const u=this.hostBehaviorFactories;for(let c=0,d=u.length;c<d;++c,++a)i[a]=u[c].createBehavior(e)}return new ng(t,i)}render(e,t,n){typeof t=="string"&&(t=document.getElementById(t)),n===void 0&&(n=t);const i=this.create(n);return i.bind(e,$o),i.appendTo(t),i}}const F_=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function ht(s,...e){const t=[];let n="";for(let i=0,r=s.length-1;i<r;++i){const a=s[i];let o=e[i];if(n+=a,o instanceof ph){const l=o;o=()=>l}if(typeof o=="function"&&(o=new ic(o)),o instanceof rg){const l=F_.exec(a);l!==null&&(o.targetName=l[2])}o instanceof js?(n+=o.createPlaceholder(t.length),t.push(o)):n+=o}return n+=s[s.length-1],new ph(n,t)}class _r{constructor(){this.targets=new WeakSet}addStylesTo(e){this.targets.add(e)}removeStylesFrom(e){this.targets.delete(e)}isAttachedTo(e){return this.targets.has(e)}withBehaviors(...e){return this.behaviors=this.behaviors===null?e:this.behaviors.concat(e),this}}_r.create=(()=>{if(it.supportsAdoptedStyleSheets){const s=new Map;return e=>new V_(e,s)}return s=>new H_(s)})();function oc(s){return s.map(e=>e instanceof _r?oc(e.styles):[e]).reduce((e,t)=>e.concat(t),[])}function og(s){return s.map(e=>e instanceof _r?e.behaviors:null).reduce((e,t)=>t===null?e:(e===null&&(e=[]),e.concat(t)),null)}class V_ extends _r{constructor(e,t){super(),this.styles=e,this.styleSheetCache=t,this._styleSheets=void 0,this.behaviors=og(e)}get styleSheets(){if(this._styleSheets===void 0){const e=this.styles,t=this.styleSheetCache;this._styleSheets=oc(e).map(n=>{if(n instanceof CSSStyleSheet)return n;let i=t.get(n);return i===void 0&&(i=new CSSStyleSheet,i.replaceSync(n),t.set(n,i)),i})}return this._styleSheets}addStylesTo(e){e.adoptedStyleSheets=[...e.adoptedStyleSheets,...this.styleSheets],super.addStylesTo(e)}removeStylesFrom(e){const t=this.styleSheets;e.adoptedStyleSheets=e.adoptedStyleSheets.filter(n=>t.indexOf(n)===-1),super.removeStylesFrom(e)}}let j_=0;function W_(){return`fast-style-class-${++j_}`}class H_ extends _r{constructor(e){super(),this.styles=e,this.behaviors=null,this.behaviors=og(e),this.styleSheets=oc(e),this.styleClass=W_()}addStylesTo(e){const t=this.styleSheets,n=this.styleClass;e=this.normalizeTarget(e);for(let i=0;i<t.length;i++){const r=document.createElement("style");r.innerHTML=t[i],r.className=n,e.append(r)}super.addStylesTo(e)}removeStylesFrom(e){e=this.normalizeTarget(e);const t=e.querySelectorAll(`.${this.styleClass}`);for(let n=0,i=t.length;n<i;++n)e.removeChild(t[n]);super.removeStylesFrom(e)}isAttachedTo(e){return super.isAttachedTo(this.normalizeTarget(e))}normalizeTarget(e){return e===document?document.body:e}}const G_={toView(s){return s?"true":"false"},fromView(s){return!(s==null||s==="false"||s===!1||s===0)}},ac={toView(s){if(s==null)return null;const e=s*1;return isNaN(e)?null:e.toString()},fromView(s){if(s==null)return null;const e=s*1;return isNaN(e)?null:e}};class _s{constructor(e,t,n=t.toLowerCase(),i="reflect",r){this.guards=new Set,this.Owner=e,this.name=t,this.attribute=n,this.mode=i,this.converter=r,this.fieldName=`_${t}`,this.callbackName=`${t}Changed`,this.hasCallback=this.callbackName in e.prototype,i==="boolean"&&r===void 0&&(this.converter=G_)}setValue(e,t){const n=e[this.fieldName],i=this.converter;i!==void 0&&(t=i.fromView(t)),n!==t&&(e[this.fieldName]=t,this.tryReflectToAttribute(e),this.hasCallback&&e[this.callbackName](n,t),e.$fastController.notify(this.name))}getValue(e){return Pt.track(e,this.name),e[this.fieldName]}onAttributeChangedCallback(e,t){this.guards.has(e)||(this.guards.add(e),this.setValue(e,t),this.guards.delete(e))}tryReflectToAttribute(e){const t=this.mode,n=this.guards;n.has(e)||t==="fromView"||it.queueUpdate(()=>{n.add(e);const i=e[this.fieldName];switch(t){case"reflect":const r=this.converter;it.setAttribute(e,this.attribute,r!==void 0?r.toView(i):i);break;case"boolean":it.setBooleanAttribute(e,this.attribute,i);break}n.delete(e)})}static collect(e,...t){const n=[];t.push(e.attributes);for(let i=0,r=t.length;i<r;++i){const a=t[i];if(a!==void 0)for(let o=0,l=a.length;o<l;++o){const u=a[o];typeof u=="string"?n.push(new _s(e,u)):n.push(new _s(e,u.property,u.attribute,u.mode,u.converter))}}return n}}function Ee(s,e){let t;function n(i,r){arguments.length>1&&(t.property=r),(i.constructor.attributes||(i.constructor.attributes=[])).push(t)}if(arguments.length>1){t={},n(s,e);return}return t=s===void 0?{}:s,n}const gh={mode:"open"},fh={},ku=Zo.getById(4,()=>{const s=new Map;return Object.freeze({register(e){return s.has(e.type)?!1:(s.set(e.type,e),!0)},getByType(e){return s.get(e)}})});class pa{constructor(e,t=e.definition){typeof t=="string"&&(t={name:t}),this.type=e,this.name=t.name,this.template=t.template;const n=_s.collect(e,t.attributes),i=new Array(n.length),r={},a={};for(let o=0,l=n.length;o<l;++o){const u=n[o];i[o]=u.attribute,r[u.name]=u,a[u.attribute]=u}this.attributes=n,this.observedAttributes=i,this.propertyLookup=r,this.attributeLookup=a,this.shadowOptions=t.shadowOptions===void 0?gh:t.shadowOptions===null?void 0:Object.assign(Object.assign({},gh),t.shadowOptions),this.elementOptions=t.elementOptions===void 0?fh:Object.assign(Object.assign({},fh),t.elementOptions),this.styles=t.styles===void 0?void 0:Array.isArray(t.styles)?_r.create(t.styles):t.styles instanceof _r?t.styles:_r.create([t.styles])}get isDefined(){return!!ku.getByType(this.type)}define(e=customElements){const t=this.type;if(ku.register(this)){const n=this.attributes,i=t.prototype;for(let r=0,a=n.length;r<a;++r)Pt.defineProperty(i,n[r]);Reflect.defineProperty(t,"observedAttributes",{value:this.observedAttributes,enumerable:!0})}return e.get(this.name)||e.define(this.name,t,this.elementOptions),this}}pa.forType=ku.getByType;const ag=new WeakMap,z_={bubbles:!0,composed:!0,cancelable:!0};function Ql(s){return s.shadowRoot||ag.get(s)||null}let $_=class sg extends tg{constructor(e,t){super(e),this.boundObservables=null,this.behaviors=null,this.needsInitialization=!0,this._template=null,this._styles=null,this._isConnected=!1,this.$fastController=this,this.view=null,this.element=e,this.definition=t;const n=t.shadowOptions;if(n!==void 0){const r=e.attachShadow(n);n.mode==="closed"&&ag.set(e,r)}const i=Pt.getAccessors(e);if(i.length>0){const r=this.boundObservables=Object.create(null);for(let a=0,o=i.length;a<o;++a){const l=i[a].name,u=e[l];u!==void 0&&(delete e[l],r[l]=u)}}}get isConnected(){return Pt.track(this,"isConnected"),this._isConnected}setIsConnected(e){this._isConnected=e,Pt.notify(this,"isConnected")}get template(){return this._template}set template(e){this._template!==e&&(this._template=e,this.needsInitialization||this.renderTemplate(e))}get styles(){return this._styles}set styles(e){this._styles!==e&&(this._styles!==null&&this.removeStyles(this._styles),this._styles=e,!this.needsInitialization&&e!==null&&this.addStyles(e))}addStyles(e){const t=Ql(this.element)||this.element.getRootNode();if(e instanceof HTMLStyleElement)t.append(e);else if(!e.isAttachedTo(t)){const n=e.behaviors;e.addStylesTo(t),n!==null&&this.addBehaviors(n)}}removeStyles(e){const t=Ql(this.element)||this.element.getRootNode();if(e instanceof HTMLStyleElement)t.removeChild(e);else if(e.isAttachedTo(t)){const n=e.behaviors;e.removeStylesFrom(t),n!==null&&this.removeBehaviors(n)}}addBehaviors(e){const t=this.behaviors||(this.behaviors=new Map),n=e.length,i=[];for(let r=0;r<n;++r){const a=e[r];t.has(a)?t.set(a,t.get(a)+1):(t.set(a,1),i.push(a))}if(this._isConnected){const r=this.element;for(let a=0;a<i.length;++a)i[a].bind(r,$o)}}removeBehaviors(e,t=!1){const n=this.behaviors;if(n===null)return;const i=e.length,r=[];for(let a=0;a<i;++a){const o=e[a];if(n.has(o)){const l=n.get(o)-1;l===0||t?n.delete(o)&&r.push(o):n.set(o,l)}}if(this._isConnected){const a=this.element;for(let o=0;o<r.length;++o)r[o].unbind(a)}}onConnectedCallback(){if(this._isConnected)return;const e=this.element;this.needsInitialization?this.finishInitialization():this.view!==null&&this.view.bind(e,$o);const t=this.behaviors;if(t!==null)for(const[n]of t)n.bind(e,$o);this.setIsConnected(!0)}onDisconnectedCallback(){if(!this._isConnected)return;this.setIsConnected(!1);const e=this.view;e!==null&&e.unbind();const t=this.behaviors;if(t!==null){const n=this.element;for(const[i]of t)i.unbind(n)}}onAttributeChangedCallback(e,t,n){const i=this.definition.attributeLookup[e];i!==void 0&&i.onAttributeChangedCallback(this.element,n)}emit(e,t,n){return this._isConnected?this.element.dispatchEvent(new CustomEvent(e,Object.assign(Object.assign({detail:t},z_),n))):!1}finishInitialization(){const e=this.element,t=this.boundObservables;if(t!==null){const i=Object.keys(t);for(let r=0,a=i.length;r<a;++r){const o=i[r];e[o]=t[o]}this.boundObservables=null}const n=this.definition;this._template===null&&(this.element.resolveTemplate?this._template=this.element.resolveTemplate():n.template&&(this._template=n.template||null)),this._template!==null&&this.renderTemplate(this._template),this._styles===null&&(this.element.resolveStyles?this._styles=this.element.resolveStyles():n.styles&&(this._styles=n.styles||null)),this._styles!==null&&this.addStyles(this._styles),this.needsInitialization=!1}renderTemplate(e){const t=this.element,n=Ql(t)||t;this.view!==null?(this.view.dispose(),this.view=null):this.needsInitialization||it.removeChildNodes(n),e&&(this.view=e.render(t,n,t))}static forCustomElement(e){const t=e.$fastController;if(t!==void 0)return t;const n=pa.forType(e.constructor);if(n===void 0)throw new Error("Missing FASTElement definition.");return e.$fastController=new sg(e,n)}};function mh(s){return class extends s{constructor(){super(),$_.forCustomElement(this)}$emit(e,t,n){return this.$fastController.emit(e,t,n)}connectedCallback(){this.$fastController.onConnectedCallback()}disconnectedCallback(){this.$fastController.onDisconnectedCallback()}attributeChangedCallback(e,t,n){this.$fastController.onAttributeChangedCallback(e,t,n)}}}const to=Object.assign(mh(HTMLElement),{from(s){return mh(s)},define(s,e){return new pa(s,e).define().type}});function sc(s){return function(e){new pa(e,s).define()}}class lc{createCSS(){return""}createBehavior(){}}function lg(s,e){const t=[];let n="";const i=[];for(let r=0,a=s.length-1;r<a;++r){n+=s[r];let o=e[r];if(o instanceof lc){const l=o.createBehavior();o=o.createCSS(),l&&i.push(l)}o instanceof _r||o instanceof CSSStyleSheet?(n.trim()!==""&&(t.push(n),n=""),t.push(o)):n+=o}return n+=s[s.length-1],n.trim()!==""&&t.push(n),{styles:t,behaviors:i}}function De(s,...e){const{styles:t,behaviors:n}=lg(s,e),i=_r.create(t);return n.length&&i.withBehaviors(...n),i}class Y_ extends lc{constructor(e,t){super(),this.behaviors=t,this.css="";const n=e.reduce((i,r)=>(typeof r=="string"?this.css+=r:i.push(r),i),[]);n.length&&(this.styles=_r.create(n))}createBehavior(){return this}createCSS(){return this.css}bind(e){this.styles&&e.$fastController.addStyles(this.styles),this.behaviors.length&&e.$fastController.addBehaviors(this.behaviors)}unbind(e){this.styles&&e.$fastController.removeStyles(this.styles),this.behaviors.length&&e.$fastController.removeBehaviors(this.behaviors)}}function ni(s,...e){const{styles:t,behaviors:n}=lg(s,e);return new Y_(t,n)}function ti(s,e,t){return{index:s,removed:e,addedCount:t}}const ug=0,cg=1,Iu=2,Du=3;function X_(s,e,t,n,i,r){const a=r-i+1,o=t-e+1,l=new Array(a);let u,c;for(let d=0;d<a;++d)l[d]=new Array(o),l[d][0]=d;for(let d=0;d<o;++d)l[0][d]=d;for(let d=1;d<a;++d)for(let h=1;h<o;++h)s[e+h-1]===n[i+d-1]?l[d][h]=l[d-1][h-1]:(u=l[d-1][h]+1,c=l[d][h-1]+1,l[d][h]=u<c?u:c);return l}function J_(s){let e=s.length-1,t=s[0].length-1,n=s[e][t];const i=[];for(;e>0||t>0;){if(e===0){i.push(Iu),t--;continue}if(t===0){i.push(Du),e--;continue}const r=s[e-1][t-1],a=s[e-1][t],o=s[e][t-1];let l;a<o?l=a<r?a:r:l=o<r?o:r,l===r?(r===n?i.push(ug):(i.push(cg),n=r),e--,t--):l===a?(i.push(Du),e--,n=a):(i.push(Iu),t--,n=o)}return i.reverse(),i}function q_(s,e,t){for(let n=0;n<t;++n)if(s[n]!==e[n])return n;return t}function Z_(s,e,t){let n=s.length,i=e.length,r=0;for(;r<t&&s[--n]===e[--i];)r++;return r}function Q_(s,e,t,n){return e<t||n<s?-1:e===t||n===s?0:s<t?e<n?e-t:n-t:n<e?n-s:e-s}function dg(s,e,t,n,i,r){let a=0,o=0;const l=Math.min(t-e,r-i);if(e===0&&i===0&&(a=q_(s,n,l)),t===s.length&&r===n.length&&(o=Z_(s,n,l-a)),e+=a,i+=a,t-=o,r-=o,t-e===0&&r-i===0)return dn;if(e===t){const g=ti(e,[],0);for(;i<r;)g.removed.push(n[i++]);return[g]}else if(i===r)return[ti(e,[],t-e)];const u=J_(X_(s,e,t,n,i,r)),c=[];let d,h=e,p=i;for(let g=0;g<u.length;++g)switch(u[g]){case ug:d!==void 0&&(c.push(d),d=void 0),h++,p++;break;case cg:d===void 0&&(d=ti(h,[],0)),d.addedCount++,h++,d.removed.push(n[p]),p++;break;case Iu:d===void 0&&(d=ti(h,[],0)),d.addedCount++,h++;break;case Du:d===void 0&&(d=ti(h,[],0)),d.removed.push(n[p]),p++;break}return d!==void 0&&c.push(d),c}const Ch=Array.prototype.push;function ey(s,e,t,n){const i=ti(e,t,n);let r=!1,a=0;for(let o=0;o<s.length;o++){const l=s[o];if(l.index+=a,r)continue;const u=Q_(i.index,i.index+i.removed.length,l.index,l.index+l.addedCount);if(u>=0){s.splice(o,1),o--,a-=l.addedCount-l.removed.length,i.addedCount+=l.addedCount-u;const c=i.removed.length+l.removed.length-u;if(!i.addedCount&&!c)r=!0;else{let d=l.removed;if(i.index<l.index){const h=i.removed.slice(0,l.index-i.index);Ch.apply(h,d),d=h}if(i.index+i.removed.length>l.index+l.addedCount){const h=i.removed.slice(l.index+l.addedCount-i.index);Ch.apply(d,h)}i.removed=d,l.index<i.index&&(i.index=l.index)}}else if(i.index<l.index){r=!0,s.splice(o,0,i),o++;const c=i.addedCount-i.removed.length;l.index+=c,a+=c}}r||s.push(i)}function ty(s){const e=[];for(let t=0,n=s.length;t<n;t++){const i=s[t];ey(e,i.index,i.removed,i.addedCount)}return e}function ry(s,e){let t=[];const n=ty(e);for(let i=0,r=n.length;i<r;++i){const a=n[i];if(a.addedCount===1&&a.removed.length===1){a.removed[0]!==s[a.index]&&t.push(a);continue}t=t.concat(dg(s,a.index,a.index+a.addedCount,a.removed,0,a.removed.length))}return t}let _h=!1;function eu(s,e){let t=s.index;const n=e.length;return t>n?t=n-s.addedCount:t<0&&(t=n+s.removed.length+t-s.addedCount),t<0&&(t=0),s.index=t,s}class iy extends Cs{constructor(e){super(e),this.oldCollection=void 0,this.splices=void 0,this.needsQueue=!0,this.call=this.flush,Reflect.defineProperty(e,"$fastController",{value:this,enumerable:!1})}subscribe(e){this.flush(),super.subscribe(e)}addSplice(e){this.splices===void 0?this.splices=[e]:this.splices.push(e),this.needsQueue&&(this.needsQueue=!1,it.queueUpdate(this))}reset(e){this.oldCollection=e,this.needsQueue&&(this.needsQueue=!1,it.queueUpdate(this))}flush(){const e=this.splices,t=this.oldCollection;if(e===void 0&&t===void 0)return;this.needsQueue=!0,this.splices=void 0,this.oldCollection=void 0;const n=t===void 0?ry(this.source,e):dg(this.source,0,this.source.length,t,0,t.length);this.notify(n)}}function ny(){if(_h)return;_h=!0,Pt.setArrayObserverFactory(l=>new iy(l));const s=Array.prototype;if(s.$fastPatch)return;Reflect.defineProperty(s,"$fastPatch",{value:1,enumerable:!1});const e=s.pop,t=s.push,n=s.reverse,i=s.shift,r=s.sort,a=s.splice,o=s.unshift;s.pop=function(){const l=this.length>0,u=e.apply(this,arguments),c=this.$fastController;return c!==void 0&&l&&c.addSplice(ti(this.length,[u],0)),u},s.push=function(){const l=t.apply(this,arguments),u=this.$fastController;return u!==void 0&&u.addSplice(eu(ti(this.length-arguments.length,[],arguments.length),this)),l},s.reverse=function(){let l;const u=this.$fastController;u!==void 0&&(u.flush(),l=this.slice());const c=n.apply(this,arguments);return u!==void 0&&u.reset(l),c},s.shift=function(){const l=this.length>0,u=i.apply(this,arguments),c=this.$fastController;return c!==void 0&&l&&c.addSplice(ti(0,[u],0)),u},s.sort=function(){let l;const u=this.$fastController;u!==void 0&&(u.flush(),l=this.slice());const c=r.apply(this,arguments);return u!==void 0&&u.reset(l),c},s.splice=function(){const l=a.apply(this,arguments),u=this.$fastController;return u!==void 0&&u.addSplice(eu(ti(+arguments[0],l,arguments.length>2?arguments.length-2:0),this)),l},s.unshift=function(){const l=o.apply(this,arguments),u=this.$fastController;return u!==void 0&&u.addSplice(eu(ti(0,[],arguments.length),this)),l}}class oy{constructor(e,t){this.target=e,this.propertyName=t}bind(e){e[this.propertyName]=this.target}unbind(){}}function tr(s){return new rc("fast-ref",oy,s)}function vi(s,e){const t=typeof e=="function"?e:()=>e;return(n,i)=>s(n,i)?t(n,i):null}const V0=Object.freeze({positioning:!1,recycle:!0});function ay(s,e,t,n){s.bind(e[t],n)}function sy(s,e,t,n){const i=Object.create(n);i.index=t,i.length=e.length,s.bind(e[t],i)}class ly{constructor(e,t,n,i,r,a){this.location=e,this.itemsBinding=t,this.templateBinding=i,this.options=a,this.source=null,this.views=[],this.items=null,this.itemsObserver=null,this.originalContext=void 0,this.childContext=void 0,this.bindView=ay,this.itemsBindingObserver=Pt.binding(t,this,n),this.templateBindingObserver=Pt.binding(i,this,r),a.positioning&&(this.bindView=sy)}bind(e,t){this.source=e,this.originalContext=t,this.childContext=Object.create(t),this.childContext.parent=e,this.childContext.parentContext=this.originalContext,this.items=this.itemsBindingObserver.observe(e,this.originalContext),this.template=this.templateBindingObserver.observe(e,this.originalContext),this.observeItems(!0),this.refreshAllViews()}unbind(){this.source=null,this.items=null,this.itemsObserver!==null&&this.itemsObserver.unsubscribe(this),this.unbindAllViews(),this.itemsBindingObserver.disconnect(),this.templateBindingObserver.disconnect()}handleChange(e,t){e===this.itemsBinding?(this.items=this.itemsBindingObserver.observe(this.source,this.originalContext),this.observeItems(),this.refreshAllViews()):e===this.templateBinding?(this.template=this.templateBindingObserver.observe(this.source,this.originalContext),this.refreshAllViews(!0)):this.updateViews(t)}observeItems(e=!1){if(!this.items){this.items=dn;return}const t=this.itemsObserver,n=this.itemsObserver=Pt.getNotifier(this.items),i=t!==n;i&&t!==null&&t.unsubscribe(this),(i||e)&&n.subscribe(this)}updateViews(e){const t=this.childContext,n=this.views,i=this.bindView,r=this.items,a=this.template,o=this.options.recycle,l=[];let u=0,c=0;for(let d=0,h=e.length;d<h;++d){const p=e[d],g=p.removed;let f=0,m=p.index;const C=m+p.addedCount,_=n.splice(p.index,g.length);for(c=l.length+_.length;m<C;++m){const y=n[m],T=y?y.firstChild:this.location;let E;o&&c>0?(f<=c&&_.length>0?(E=_[f],f++):(E=l[u],u++),c--):E=a.create(),n.splice(m,0,E),i(E,r,m,t),E.insertBefore(T)}_[f]&&l.push(..._.slice(f))}for(let d=u,h=l.length;d<h;++d)l[d].dispose();if(this.options.positioning)for(let d=0,h=n.length;d<h;++d){const p=n[d].context;p.length=h,p.index=d}}refreshAllViews(e=!1){const t=this.items,n=this.childContext,i=this.template,r=this.location,a=this.bindView;let o=t.length,l=this.views,u=l.length;if((o===0||e||!this.options.recycle)&&(ng.disposeContiguousBatch(l),u=0),u===0){this.views=l=new Array(o);for(let c=0;c<o;++c){const d=i.create();a(d,t,c,n),l[c]=d,d.insertBefore(r)}}else{let c=0;for(;c<o;++c)if(c<u){const h=l[c];a(h,t,c,n)}else{const h=i.create();a(h,t,c,n),l.push(h),h.insertBefore(r)}const d=l.splice(c,u-c);for(c=0,o=d.length;c<o;++c)d[c].dispose()}}unbindAllViews(){const e=this.views;for(let t=0,n=e.length;t<n;++t)e[t].unbind()}}class hg extends js{constructor(e,t,n){super(),this.itemsBinding=e,this.templateBinding=t,this.options=n,this.createPlaceholder=it.createBlockPlaceholder,ny(),this.isItemsBindingVolatile=Pt.isVolatileBinding(e),this.isTemplateBindingVolatile=Pt.isVolatileBinding(t)}createBehavior(e){return new ly(e,this.itemsBinding,this.isItemsBindingVolatile,this.templateBinding,this.isTemplateBindingVolatile,this.options)}}function pg(s){return s?function(e,t,n){return e.nodeType===1&&e.matches(s)}:function(e,t,n){return e.nodeType===1}}class gg{constructor(e,t){this.target=e,this.options=t,this.source=null}bind(e){const t=this.options.property;this.shouldUpdate=Pt.getAccessors(e).some(n=>n.name===t),this.source=e,this.updateTarget(this.computeNodes()),this.shouldUpdate&&this.observe()}unbind(){this.updateTarget(dn),this.source=null,this.shouldUpdate&&this.disconnect()}handleEvent(){this.updateTarget(this.computeNodes())}computeNodes(){let e=this.getNodes();return this.options.filter!==void 0&&(e=e.filter(this.options.filter)),e}updateTarget(e){this.source[this.options.property]=e}}class uy extends gg{constructor(e,t){super(e,t)}observe(){this.target.addEventListener("slotchange",this)}disconnect(){this.target.removeEventListener("slotchange",this)}getNodes(){return this.target.assignedNodes(this.options)}}function Ws(s){return typeof s=="string"&&(s={property:s}),new rc("fast-slotted",uy,s)}class cy extends gg{constructor(e,t){super(e,t),this.observer=null,t.childList=!0}observe(){this.observer===null&&(this.observer=new MutationObserver(this.handleEvent.bind(this))),this.observer.observe(this.target,this.options)}disconnect(){this.observer.disconnect()}getNodes(){return"subtree"in this.options?Array.from(this.target.querySelectorAll(this.options.selector)):Array.from(this.target.childNodes)}}function fg(s){return typeof s=="string"&&(s={property:s}),new rc("fast-children",cy,s)}class uc{handleStartContentChange(){this.startContainer.classList.toggle("start",this.start.assignedNodes().length>0)}handleEndContentChange(){this.endContainer.classList.toggle("end",this.end.assignedNodes().length>0)}}const cc=(s,e)=>ht`
    <span
        part="end"
        ${tr("endContainer")}
        class=${t=>e.end?"end":void 0}
    >
        <slot name="end" ${tr("end")} @slotchange="${t=>t.handleEndContentChange()}">
            ${e.end||""}
        </slot>
    </span>
`,dc=(s,e)=>ht`
    <span
        part="start"
        ${tr("startContainer")}
        class="${t=>e.start?"start":void 0}"
    >
        <slot
            name="start"
            ${tr("start")}
            @slotchange="${t=>t.handleStartContentChange()}"
        >
            ${e.start||""}
        </slot>
    </span>
`,j0=ht`
    <span part="end" ${tr("endContainer")}>
        <slot
            name="end"
            ${tr("end")}
            @slotchange="${s=>s.handleEndContentChange()}"
        ></slot>
    </span>
`,W0=ht`
    <span part="start" ${tr("startContainer")}>
        <slot
            name="start"
            ${tr("start")}
            @slotchange="${s=>s.handleStartContentChange()}"
        ></slot>
    </span>
`;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ru=function(s,e){return Ru=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Ru(s,e)};function hc(s,e){Ru(s,e);function t(){this.constructor=s}s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function ge(s,e,t,n){var i=arguments.length,r=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(s,e,t,n);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(r=(i<3?a(r):i>3?a(e,t,r):a(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r}function dy(s,e,t,n){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(c){try{u(n.next(c))}catch(d){a(d)}}function l(c){try{u(n.throw(c))}catch(d){a(d)}}function u(c){c.done?r(c.value):i(c.value).then(o,l)}u((n=n.apply(s,[])).next())})}function hy(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,i,r,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(r=u[0]&2?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){t.label=u[1];break}if(u[0]===6&&t.label<r[1]){t.label=r[1],r=u;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(u);break}r[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(s,t)}catch(c){u=[6,c],i=0}finally{n=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ha(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ys(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var n=t.call(s),i,r=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)r.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return r}function ln(){for(var s=[],e=0;e<arguments.length;e++)s=s.concat(ys(arguments[e]));return s}const tu=new Map;"metadata"in Reflect||(Reflect.metadata=function(s,e){return function(t){Reflect.defineMetadata(s,e,t)}},Reflect.defineMetadata=function(s,e,t){let n=tu.get(t);n===void 0&&tu.set(t,n=new Map),n.set(s,e)},Reflect.getOwnMetadata=function(s,e){const t=tu.get(e);if(t!==void 0)return t.get(s)});class py{constructor(e,t){this.container=e,this.key=t}instance(e){return this.registerResolver(0,e)}singleton(e){return this.registerResolver(1,e)}transient(e){return this.registerResolver(2,e)}callback(e){return this.registerResolver(3,e)}cachedCallback(e){return this.registerResolver(3,Cg(e))}aliasTo(e){return this.registerResolver(5,e)}registerResolver(e,t){const{container:n,key:i}=this;return this.container=this.key=void 0,n.registerResolver(i,new Yr(i,e,t))}}function Io(s){const e=s.slice(),t=Object.keys(s),n=t.length;let i;for(let r=0;r<n;++r)i=t[r],_g(i)||(e[i]=s[i]);return e}const gy=Object.freeze({none(s){throw Error(`${s.toString()} not registered, did you forget to add @singleton()?`)},singleton(s){return new Yr(s,1,s)},transient(s){return new Yr(s,2,s)}}),ru=Object.freeze({default:Object.freeze({parentLocator:()=>null,responsibleForOwnerRequests:!1,defaultResolver:gy.singleton})}),yh=new Map;function Ah(s){return e=>Reflect.getOwnMetadata(s,e)}let Th=null;const Wt=Object.freeze({createContainer(s){return new Yo(null,Object.assign({},ru.default,s))},findResponsibleContainer(s){const e=s.$$container$$;return e&&e.responsibleForOwnerRequests?e:Wt.findParentContainer(s)},findParentContainer(s){const e=new CustomEvent(mg,{bubbles:!0,composed:!0,cancelable:!0,detail:{container:void 0}});return s.dispatchEvent(e),e.detail.container||Wt.getOrCreateDOMContainer()},getOrCreateDOMContainer(s,e){return s?s.$$container$$||new Yo(s,Object.assign({},ru.default,e,{parentLocator:Wt.findParentContainer})):Th||(Th=new Yo(null,Object.assign({},ru.default,e,{parentLocator:()=>null})))},getDesignParamtypes:Ah("design:paramtypes"),getAnnotationParamtypes:Ah("di:paramtypes"),getOrCreateAnnotationParamTypes(s){let e=this.getAnnotationParamtypes(s);return e===void 0&&Reflect.defineMetadata("di:paramtypes",e=[],s),e},getDependencies(s){let e=yh.get(s);if(e===void 0){const t=s.inject;if(t===void 0){const n=Wt.getDesignParamtypes(s),i=Wt.getAnnotationParamtypes(s);if(n===void 0)if(i===void 0){const r=Object.getPrototypeOf(s);typeof r=="function"&&r!==Function.prototype?e=Io(Wt.getDependencies(r)):e=[]}else e=Io(i);else if(i===void 0)e=Io(n);else{e=Io(n);let r=i.length,a;for(let u=0;u<r;++u)a=i[u],a!==void 0&&(e[u]=a);const o=Object.keys(i);r=o.length;let l;for(let u=0;u<r;++u)l=o[u],_g(l)||(e[l]=i[l])}}else e=Io(t);yh.set(s,e)}return e},defineProperty(s,e,t,n=!1){const i=`$di_${e}`;Reflect.defineProperty(s,e,{get:function(){let r=this[i];if(r===void 0&&(r=(this instanceof HTMLElement?Wt.findResponsibleContainer(this):Wt.getOrCreateDOMContainer()).get(t),this[i]=r,n&&this instanceof to)){const o=this.$fastController,l=()=>{const c=Wt.findResponsibleContainer(this).get(t),d=this[i];c!==d&&(this[i]=r,o.notify(e))};o.subscribe({handleChange:l},"isConnected")}return r}})},createInterface(s,e){const t=typeof s=="function"?s:e,n=typeof s=="string"?s:s&&"friendlyName"in s&&s.friendlyName||bh,i=typeof s=="string"?!1:s&&"respectConnection"in s&&s.respectConnection||!1,r=function(a,o,l){if(a==null||new.target!==void 0)throw new Error(`No registration for interface: '${r.friendlyName}'`);if(o)Wt.defineProperty(a,o,r,i);else{const u=Wt.getOrCreateAnnotationParamTypes(a);u[l]=r}};return r.$isInterface=!0,r.friendlyName=n??"(anonymous)",t!=null&&(r.register=function(a,o){return t(new py(a,o??r))}),r.toString=function(){return`InterfaceSymbol<${r.friendlyName}>`},r},inject(...s){return function(e,t,n){if(typeof n=="number"){const i=Wt.getOrCreateAnnotationParamTypes(e),r=s[0];r!==void 0&&(i[n]=r)}else if(t)Wt.defineProperty(e,t,s[0]);else{const i=n?Wt.getOrCreateAnnotationParamTypes(n.value):Wt.getOrCreateAnnotationParamTypes(e);let r;for(let a=0;a<s.length;++a)r=s[a],r!==void 0&&(i[a]=r)}}},transient(s){return s.register=function(t){return ea.transient(s,s).register(t)},s.registerInRequestor=!1,s},singleton(s,e=my){return s.register=function(n){return ea.singleton(s,s).register(n)},s.registerInRequestor=e.scoped,s}}),fy=Wt.createInterface("Container");Wt.inject;const my={scoped:!1};class Yr{constructor(e,t,n){this.key=e,this.strategy=t,this.state=n,this.resolving=!1}get $isResolver(){return!0}register(e){return e.registerResolver(this.key,this)}resolve(e,t){switch(this.strategy){case 0:return this.state;case 1:{if(this.resolving)throw new Error(`Cyclic dependency found: ${this.state.name}`);return this.resolving=!0,this.state=e.getFactory(this.state).construct(t),this.strategy=0,this.resolving=!1,this.state}case 2:{const n=e.getFactory(this.state);if(n===null)throw new Error(`Resolver for ${String(this.key)} returned a null factory`);return n.construct(t)}case 3:return this.state(e,t,this);case 4:return this.state[0].resolve(e,t);case 5:return t.get(this.state);default:throw new Error(`Invalid resolver strategy specified: ${this.strategy}.`)}}getFactory(e){var t,n,i;switch(this.strategy){case 1:case 2:return e.getFactory(this.state);case 5:return(i=(n=(t=e.getResolver(this.state))===null||t===void 0?void 0:t.getFactory)===null||n===void 0?void 0:n.call(t,e))!==null&&i!==void 0?i:null;default:return null}}}function Eh(s){return this.get(s)}function Cy(s,e){return e(s)}class _y{constructor(e,t){this.Type=e,this.dependencies=t,this.transformers=null}construct(e,t){let n;return t===void 0?n=new this.Type(...this.dependencies.map(Eh,e)):n=new this.Type(...this.dependencies.map(Eh,e),...t),this.transformers==null?n:this.transformers.reduce(Cy,n)}registerTransformer(e){(this.transformers||(this.transformers=[])).push(e)}}const yy={$isResolver:!0,resolve(s,e){return e}};function cs(s){return typeof s.register=="function"}function Ay(s){return cs(s)&&typeof s.registerInRequestor=="boolean"}function Sh(s){return Ay(s)&&s.registerInRequestor}function Ty(s){return s.prototype!==void 0}const Ey=new Set(["Array","ArrayBuffer","Boolean","DataView","Date","Error","EvalError","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Number","Object","Promise","RangeError","ReferenceError","RegExp","Set","SharedArrayBuffer","String","SyntaxError","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakSet"]),mg="__DI_LOCATE_PARENT__",iu=new Map;class Yo{constructor(e,t){this.owner=e,this.config=t,this._parent=void 0,this.registerDepth=0,this.context=null,e!==null&&(e.$$container$$=this),this.resolvers=new Map,this.resolvers.set(fy,yy),e instanceof Node&&e.addEventListener(mg,n=>{n.composedPath()[0]!==this.owner&&(n.detail.container=this,n.stopImmediatePropagation())})}get parent(){return this._parent===void 0&&(this._parent=this.config.parentLocator(this.owner)),this._parent}get depth(){return this.parent===null?0:this.parent.depth+1}get responsibleForOwnerRequests(){return this.config.responsibleForOwnerRequests}registerWithContext(e,...t){return this.context=e,this.register(...t),this.context=null,this}register(...e){if(++this.registerDepth===100)throw new Error("Unable to autoregister dependency");let t,n,i,r,a;const o=this.context;for(let l=0,u=e.length;l<u;++l)if(t=e[l],!!vh(t))if(cs(t))t.register(this,o);else if(Ty(t))ea.singleton(t,t).register(this);else for(n=Object.keys(t),r=0,a=n.length;r<a;++r)i=t[n[r]],vh(i)&&(cs(i)?i.register(this,o):this.register(i));return--this.registerDepth,this}registerResolver(e,t){Ga(e);const n=this.resolvers,i=n.get(e);return i==null?n.set(e,t):i instanceof Yr&&i.strategy===4?i.state.push(t):n.set(e,new Yr(e,4,[i,t])),t}registerTransformer(e,t){const n=this.getResolver(e);if(n==null)return!1;if(n.getFactory){const i=n.getFactory(this);return i==null?!1:(i.registerTransformer(t),!0)}return!1}getResolver(e,t=!0){if(Ga(e),e.resolve!==void 0)return e;let n=this,i;for(;n!=null;)if(i=n.resolvers.get(e),i==null){if(n.parent==null){const r=Sh(e)?this:n;return t?this.jitRegister(e,r):null}n=n.parent}else return i;return null}has(e,t=!1){return this.resolvers.has(e)?!0:t&&this.parent!=null?this.parent.has(e,!0):!1}get(e){if(Ga(e),e.$isResolver)return e.resolve(this,this);let t=this,n;for(;t!=null;)if(n=t.resolvers.get(e),n==null){if(t.parent==null){const i=Sh(e)?this:t;return n=this.jitRegister(e,i),n.resolve(t,this)}t=t.parent}else return n.resolve(t,this);throw new Error(`Unable to resolve key: ${e}`)}getAll(e,t=!1){Ga(e);const n=this;let i=n,r;if(t){let a=dn;for(;i!=null;)r=i.resolvers.get(e),r!=null&&(a=a.concat(Oh(r,i,n))),i=i.parent;return a}else for(;i!=null;)if(r=i.resolvers.get(e),r==null){if(i=i.parent,i==null)return dn}else return Oh(r,i,n);return dn}getFactory(e){let t=iu.get(e);if(t===void 0){if(Sy(e))throw new Error(`${e.name} is a native function and therefore cannot be safely constructed by DI. If this is intentional, please use a callback or cachedCallback resolver.`);iu.set(e,t=new _y(e,Wt.getDependencies(e)))}return t}registerFactory(e,t){iu.set(e,t)}createChild(e){return new Yo(null,Object.assign({},this.config,e,{parentLocator:()=>this}))}jitRegister(e,t){if(typeof e!="function")throw new Error(`Attempted to jitRegister something that is not a constructor: '${e}'. Did you forget to register this dependency?`);if(Ey.has(e.name))throw new Error(`Attempted to jitRegister an intrinsic type: ${e.name}. Did you forget to add @inject(Key)`);if(cs(e)){const n=e.register(t);if(!(n instanceof Object)||n.resolve==null){const i=t.resolvers.get(e);if(i!=null)return i;throw new Error("A valid resolver was not returned from the static register method")}return n}else{if(e.$isInterface)throw new Error(`Attempted to jitRegister an interface: ${e.friendlyName}`);{const n=this.config.defaultResolver(e,t);return t.resolvers.set(e,n),n}}}}const nu=new WeakMap;function Cg(s){return function(e,t,n){if(nu.has(n))return nu.get(n);const i=s(e,t,n);return nu.set(n,i),i}}const ea=Object.freeze({instance(s,e){return new Yr(s,0,e)},singleton(s,e){return new Yr(s,1,e)},transient(s,e){return new Yr(s,2,e)},callback(s,e){return new Yr(s,3,e)},cachedCallback(s,e){return new Yr(s,3,Cg(e))},aliasTo(s,e){return new Yr(e,5,s)}});function Ga(s){if(s==null)throw new Error("key/value cannot be null or undefined. Are you trying to inject/register something that doesn't exist with DI?")}function Oh(s,e,t){if(s instanceof Yr&&s.strategy===4){const n=s.state;let i=n.length;const r=new Array(i);for(;i--;)r[i]=n[i].resolve(e,t);return r}return[s.resolve(e,t)]}const bh="(anonymous)";function vh(s){return typeof s=="object"&&s!==null||typeof s=="function"}const Sy=function(){const s=new WeakMap;let e=!1,t="",n=0;return function(i){return e=s.get(i),e===void 0&&(t=i.toString(),n=t.length,e=n>=29&&n<=100&&t.charCodeAt(n-1)===125&&t.charCodeAt(n-2)<=32&&t.charCodeAt(n-3)===93&&t.charCodeAt(n-4)===101&&t.charCodeAt(n-5)===100&&t.charCodeAt(n-6)===111&&t.charCodeAt(n-7)===99&&t.charCodeAt(n-8)===32&&t.charCodeAt(n-9)===101&&t.charCodeAt(n-10)===118&&t.charCodeAt(n-11)===105&&t.charCodeAt(n-12)===116&&t.charCodeAt(n-13)===97&&t.charCodeAt(n-14)===110&&t.charCodeAt(n-15)===88,s.set(i,e)),e}}(),za={};function _g(s){switch(typeof s){case"number":return s>=0&&(s|0)===s;case"string":{const e=za[s];if(e!==void 0)return e;const t=s.length;if(t===0)return za[s]=!1;let n=0;for(let i=0;i<t;++i)if(n=s.charCodeAt(i),i===0&&n===48&&t>1||n<48||n>57)return za[s]=!1;return za[s]=!0}default:return!1}}function kh(s){return`${s.toLowerCase()}:presentation`}const $a=new Map,yg=Object.freeze({define(s,e,t){const n=kh(s);$a.get(n)===void 0?$a.set(n,e):$a.set(n,!1),t.register(ea.instance(n,e))},forTag(s,e){const t=kh(s),n=$a.get(t);return n===!1?Wt.findResponsibleContainer(e).get(t):n||null}});class Oy{constructor(e,t){this.template=e||null,this.styles=t===void 0?null:Array.isArray(t)?_r.create(t):t instanceof _r?t:_r.create([t])}applyTo(e){const t=e.$fastController;t.template===null&&(t.template=this.template),t.styles===null&&(t.styles=this.styles)}}class ur extends to{constructor(){super(...arguments),this._presentation=void 0}get $presentation(){return this._presentation===void 0&&(this._presentation=yg.forTag(this.tagName,this)),this._presentation}templateChanged(){this.template!==void 0&&(this.$fastController.template=this.template)}stylesChanged(){this.styles!==void 0&&(this.$fastController.styles=this.styles)}connectedCallback(){this.$presentation!==null&&this.$presentation.applyTo(this),super.connectedCallback()}static compose(e){return(t={})=>new by(this===ur?class extends ur{}:this,e,t)}}ge([tt],ur.prototype,"template",void 0);ge([tt],ur.prototype,"styles",void 0);function Do(s,e,t){return typeof s=="function"?s(e,t):s}class by{constructor(e,t,n){this.type=e,this.elementDefinition=t,this.overrideDefinition=n,this.definition=Object.assign(Object.assign({},this.elementDefinition),this.overrideDefinition)}register(e,t){const n=this.definition,i=this.overrideDefinition,a=`${n.prefix||t.elementPrefix}-${n.baseName}`;t.tryDefineElement({name:a,type:this.type,baseClass:this.elementDefinition.baseClass,callback:o=>{const l=new Oy(Do(n.template,o,n),Do(n.styles,o,n));o.definePresentation(l);let u=Do(n.shadowOptions,o,n);o.shadowRootMode&&(u?i.shadowOptions||(u.mode=o.shadowRootMode):u!==null&&(u={mode:o.shadowRootMode})),o.defineElement({elementOptions:Do(n.elementOptions,o,n),shadowOptions:u,attributes:Do(n.attributes,o,n)})}})}}function ga(s,...e){e.forEach(t=>{if(Object.getOwnPropertyNames(t.prototype).forEach(n=>{n!=="constructor"&&Object.defineProperty(s.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n))}),t.attributes){const n=s.attributes||[];s.attributes=n.concat(t.attributes)}})}const vy={horizontal:"horizontal",vertical:"vertical"};function ky(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Ih(...s){return s.every(e=>e instanceof HTMLElement)}function Iy(){const s=document.querySelector('meta[property="csp-nonce"]');return s?s.getAttribute("content"):null}let nn;function Dy(){if(typeof nn=="boolean")return nn;if(!ky())return nn=!1,nn;const s=document.createElement("style"),e=Iy();e!==null&&s.setAttribute("nonce",e),document.head.appendChild(s);try{s.sheet.insertRule("foo:focus-visible {color:inherit}",0),nn=!0}catch{nn=!1}finally{document.head.removeChild(s)}return nn}const Dh="focus",Rh="focusin",zn="focusout",$n="keydown",Ph="resize",Nh="scroll";var Mh;(function(s){s[s.alt=18]="alt",s[s.arrowDown=40]="arrowDown",s[s.arrowLeft=37]="arrowLeft",s[s.arrowRight=39]="arrowRight",s[s.arrowUp=38]="arrowUp",s[s.back=8]="back",s[s.backSlash=220]="backSlash",s[s.break=19]="break",s[s.capsLock=20]="capsLock",s[s.closeBracket=221]="closeBracket",s[s.colon=186]="colon",s[s.colon2=59]="colon2",s[s.comma=188]="comma",s[s.ctrl=17]="ctrl",s[s.delete=46]="delete",s[s.end=35]="end",s[s.enter=13]="enter",s[s.equals=187]="equals",s[s.equals2=61]="equals2",s[s.equals3=107]="equals3",s[s.escape=27]="escape",s[s.forwardSlash=191]="forwardSlash",s[s.function1=112]="function1",s[s.function10=121]="function10",s[s.function11=122]="function11",s[s.function12=123]="function12",s[s.function2=113]="function2",s[s.function3=114]="function3",s[s.function4=115]="function4",s[s.function5=116]="function5",s[s.function6=117]="function6",s[s.function7=118]="function7",s[s.function8=119]="function8",s[s.function9=120]="function9",s[s.home=36]="home",s[s.insert=45]="insert",s[s.menu=93]="menu",s[s.minus=189]="minus",s[s.minus2=109]="minus2",s[s.numLock=144]="numLock",s[s.numPad0=96]="numPad0",s[s.numPad1=97]="numPad1",s[s.numPad2=98]="numPad2",s[s.numPad3=99]="numPad3",s[s.numPad4=100]="numPad4",s[s.numPad5=101]="numPad5",s[s.numPad6=102]="numPad6",s[s.numPad7=103]="numPad7",s[s.numPad8=104]="numPad8",s[s.numPad9=105]="numPad9",s[s.numPadDivide=111]="numPadDivide",s[s.numPadDot=110]="numPadDot",s[s.numPadMinus=109]="numPadMinus",s[s.numPadMultiply=106]="numPadMultiply",s[s.numPadPlus=107]="numPadPlus",s[s.openBracket=219]="openBracket",s[s.pageDown=34]="pageDown",s[s.pageUp=33]="pageUp",s[s.period=190]="period",s[s.print=44]="print",s[s.quote=222]="quote",s[s.scrollLock=145]="scrollLock",s[s.shift=16]="shift",s[s.space=32]="space",s[s.tab=9]="tab",s[s.tilde=192]="tilde",s[s.windowsLeft=91]="windowsLeft",s[s.windowsOpera=219]="windowsOpera",s[s.windowsRight=92]="windowsRight"})(Mh||(Mh={}));const Ag="ArrowDown",Tg="ArrowLeft",Eg="ArrowRight",Sg="ArrowUp",pc="Enter",Og="Escape",gc="Home",fc="End",Ry="F2",Py="PageDown",Ny="PageUp",My=" ",xy="Tab";var Di;(function(s){s.ltr="ltr",s.rtl="rtl"})(Di||(Di={}));var te;(function(s){s.Canvas="Canvas",s.CanvasText="CanvasText",s.LinkText="LinkText",s.VisitedText="VisitedText",s.ActiveText="ActiveText",s.ButtonFace="ButtonFace",s.ButtonText="ButtonText",s.Field="Field",s.FieldText="FieldText",s.Highlight="Highlight",s.HighlightText="HighlightText",s.GrayText="GrayText"})(te||(te={}));class qt{}ge([Ee({attribute:"aria-atomic"})],qt.prototype,"ariaAtomic",void 0);ge([Ee({attribute:"aria-busy"})],qt.prototype,"ariaBusy",void 0);ge([Ee({attribute:"aria-controls"})],qt.prototype,"ariaControls",void 0);ge([Ee({attribute:"aria-current"})],qt.prototype,"ariaCurrent",void 0);ge([Ee({attribute:"aria-describedby"})],qt.prototype,"ariaDescribedby",void 0);ge([Ee({attribute:"aria-details"})],qt.prototype,"ariaDetails",void 0);ge([Ee({attribute:"aria-disabled"})],qt.prototype,"ariaDisabled",void 0);ge([Ee({attribute:"aria-errormessage"})],qt.prototype,"ariaErrormessage",void 0);ge([Ee({attribute:"aria-flowto"})],qt.prototype,"ariaFlowto",void 0);ge([Ee({attribute:"aria-haspopup"})],qt.prototype,"ariaHaspopup",void 0);ge([Ee({attribute:"aria-hidden"})],qt.prototype,"ariaHidden",void 0);ge([Ee({attribute:"aria-invalid"})],qt.prototype,"ariaInvalid",void 0);ge([Ee({attribute:"aria-keyshortcuts"})],qt.prototype,"ariaKeyshortcuts",void 0);ge([Ee({attribute:"aria-label"})],qt.prototype,"ariaLabel",void 0);ge([Ee({attribute:"aria-labelledby"})],qt.prototype,"ariaLabelledby",void 0);ge([Ee({attribute:"aria-live"})],qt.prototype,"ariaLive",void 0);ge([Ee({attribute:"aria-owns"})],qt.prototype,"ariaOwns",void 0);ge([Ee({attribute:"aria-relevant"})],qt.prototype,"ariaRelevant",void 0);ge([Ee({attribute:"aria-roledescription"})],qt.prototype,"ariaRoledescription",void 0);const Pu=s=>{const e=s.closest("[dir]");return e!==null&&e.dir==="rtl"?Di.rtl:Di.ltr};class Ly{constructor(){this.intersectionDetector=null,this.observedElements=new Map,this.requestPosition=(e,t)=>{var n;if(this.intersectionDetector!==null){if(this.observedElements.has(e)){(n=this.observedElements.get(e))===null||n===void 0||n.push(t);return}this.observedElements.set(e,[t]),this.intersectionDetector.observe(e)}},this.cancelRequestPosition=(e,t)=>{const n=this.observedElements.get(e);if(n!==void 0){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}},this.initializeIntersectionDetector=()=>{Ii.IntersectionObserver&&(this.intersectionDetector=new IntersectionObserver(this.handleIntersection,{root:null,rootMargin:"0px",threshold:[0,1]}))},this.handleIntersection=e=>{if(this.intersectionDetector===null)return;const t=[],n=[];e.forEach(i=>{var r;(r=this.intersectionDetector)===null||r===void 0||r.unobserve(i.target);const a=this.observedElements.get(i.target);a!==void 0&&(a.forEach(o=>{let l=t.indexOf(o);l===-1&&(l=t.length,t.push(o),n.push([])),n[l].push(i)}),this.observedElements.delete(i.target))}),t.forEach((i,r)=>{i(n[r])})},this.initializeIntersectionDetector()}}class bt extends ur{constructor(){super(...arguments),this.anchor="",this.viewport="",this.horizontalPositioningMode="uncontrolled",this.horizontalDefaultPosition="unset",this.horizontalViewportLock=!1,this.horizontalInset=!1,this.horizontalScaling="content",this.verticalPositioningMode="uncontrolled",this.verticalDefaultPosition="unset",this.verticalViewportLock=!1,this.verticalInset=!1,this.verticalScaling="content",this.fixedPlacement=!1,this.autoUpdateMode="anchor",this.anchorElement=null,this.viewportElement=null,this.initialLayoutComplete=!1,this.resizeDetector=null,this.baseHorizontalOffset=0,this.baseVerticalOffset=0,this.pendingPositioningUpdate=!1,this.pendingReset=!1,this.currentDirection=Di.ltr,this.regionVisible=!1,this.forceUpdate=!1,this.updateThreshold=.5,this.update=()=>{this.pendingPositioningUpdate||this.requestPositionUpdates()},this.startObservers=()=>{this.stopObservers(),this.anchorElement!==null&&(this.requestPositionUpdates(),this.resizeDetector!==null&&(this.resizeDetector.observe(this.anchorElement),this.resizeDetector.observe(this)))},this.requestPositionUpdates=()=>{this.anchorElement===null||this.pendingPositioningUpdate||(bt.intersectionService.requestPosition(this,this.handleIntersection),bt.intersectionService.requestPosition(this.anchorElement,this.handleIntersection),this.viewportElement!==null&&bt.intersectionService.requestPosition(this.viewportElement,this.handleIntersection),this.pendingPositioningUpdate=!0)},this.stopObservers=()=>{this.pendingPositioningUpdate&&(this.pendingPositioningUpdate=!1,bt.intersectionService.cancelRequestPosition(this,this.handleIntersection),this.anchorElement!==null&&bt.intersectionService.cancelRequestPosition(this.anchorElement,this.handleIntersection),this.viewportElement!==null&&bt.intersectionService.cancelRequestPosition(this.viewportElement,this.handleIntersection)),this.resizeDetector!==null&&this.resizeDetector.disconnect()},this.getViewport=()=>typeof this.viewport!="string"||this.viewport===""?document.documentElement:document.getElementById(this.viewport),this.getAnchor=()=>document.getElementById(this.anchor),this.handleIntersection=e=>{this.pendingPositioningUpdate&&(this.pendingPositioningUpdate=!1,this.applyIntersectionEntries(e)&&this.updateLayout())},this.applyIntersectionEntries=e=>{const t=e.find(r=>r.target===this),n=e.find(r=>r.target===this.anchorElement),i=e.find(r=>r.target===this.viewportElement);return t===void 0||i===void 0||n===void 0?!1:!this.regionVisible||this.forceUpdate||this.regionRect===void 0||this.anchorRect===void 0||this.viewportRect===void 0||this.isRectDifferent(this.anchorRect,n.boundingClientRect)||this.isRectDifferent(this.viewportRect,i.boundingClientRect)||this.isRectDifferent(this.regionRect,t.boundingClientRect)?(this.regionRect=t.boundingClientRect,this.anchorRect=n.boundingClientRect,this.viewportElement===document.documentElement?this.viewportRect=new DOMRectReadOnly(i.boundingClientRect.x+document.documentElement.scrollLeft,i.boundingClientRect.y+document.documentElement.scrollTop,i.boundingClientRect.width,i.boundingClientRect.height):this.viewportRect=i.boundingClientRect,this.updateRegionOffset(),this.forceUpdate=!1,!0):!1},this.updateRegionOffset=()=>{this.anchorRect&&this.regionRect&&(this.baseHorizontalOffset=this.baseHorizontalOffset+(this.anchorRect.left-this.regionRect.left)+(this.translateX-this.baseHorizontalOffset),this.baseVerticalOffset=this.baseVerticalOffset+(this.anchorRect.top-this.regionRect.top)+(this.translateY-this.baseVerticalOffset))},this.isRectDifferent=(e,t)=>Math.abs(e.top-t.top)>this.updateThreshold||Math.abs(e.right-t.right)>this.updateThreshold||Math.abs(e.bottom-t.bottom)>this.updateThreshold||Math.abs(e.left-t.left)>this.updateThreshold,this.handleResize=e=>{this.update()},this.reset=()=>{this.pendingReset&&(this.pendingReset=!1,this.anchorElement===null&&(this.anchorElement=this.getAnchor()),this.viewportElement===null&&(this.viewportElement=this.getViewport()),this.currentDirection=Pu(this),this.startObservers())},this.updateLayout=()=>{let e,t;if(this.horizontalPositioningMode!=="uncontrolled"){const r=this.getPositioningOptions(this.horizontalInset);if(this.horizontalDefaultPosition==="center")t="center";else if(this.horizontalDefaultPosition!=="unset"){let h=this.horizontalDefaultPosition;if(h==="start"||h==="end"){const p=Pu(this);if(p!==this.currentDirection){this.currentDirection=p,this.initialize();return}this.currentDirection===Di.ltr?h=h==="start"?"left":"right":h=h==="start"?"right":"left"}switch(h){case"left":t=this.horizontalInset?"insetStart":"start";break;case"right":t=this.horizontalInset?"insetEnd":"end";break}}const a=this.horizontalThreshold!==void 0?this.horizontalThreshold:this.regionRect!==void 0?this.regionRect.width:0,o=this.anchorRect!==void 0?this.anchorRect.left:0,l=this.anchorRect!==void 0?this.anchorRect.right:0,u=this.anchorRect!==void 0?this.anchorRect.width:0,c=this.viewportRect!==void 0?this.viewportRect.left:0,d=this.viewportRect!==void 0?this.viewportRect.right:0;(t===void 0||this.horizontalPositioningMode!=="locktodefault"&&this.getAvailableSpace(t,o,l,u,c,d)<a)&&(t=this.getAvailableSpace(r[0],o,l,u,c,d)>this.getAvailableSpace(r[1],o,l,u,c,d)?r[0]:r[1])}if(this.verticalPositioningMode!=="uncontrolled"){const r=this.getPositioningOptions(this.verticalInset);if(this.verticalDefaultPosition==="center")e="center";else if(this.verticalDefaultPosition!=="unset")switch(this.verticalDefaultPosition){case"top":e=this.verticalInset?"insetStart":"start";break;case"bottom":e=this.verticalInset?"insetEnd":"end";break}const a=this.verticalThreshold!==void 0?this.verticalThreshold:this.regionRect!==void 0?this.regionRect.height:0,o=this.anchorRect!==void 0?this.anchorRect.top:0,l=this.anchorRect!==void 0?this.anchorRect.bottom:0,u=this.anchorRect!==void 0?this.anchorRect.height:0,c=this.viewportRect!==void 0?this.viewportRect.top:0,d=this.viewportRect!==void 0?this.viewportRect.bottom:0;(e===void 0||this.verticalPositioningMode!=="locktodefault"&&this.getAvailableSpace(e,o,l,u,c,d)<a)&&(e=this.getAvailableSpace(r[0],o,l,u,c,d)>this.getAvailableSpace(r[1],o,l,u,c,d)?r[0]:r[1])}const n=this.getNextRegionDimension(t,e),i=this.horizontalPosition!==t||this.verticalPosition!==e;if(this.setHorizontalPosition(t,n),this.setVerticalPosition(e,n),this.updateRegionStyle(),!this.initialLayoutComplete){this.initialLayoutComplete=!0,this.requestPositionUpdates();return}this.regionVisible||(this.regionVisible=!0,this.style.removeProperty("pointer-events"),this.style.removeProperty("opacity"),this.classList.toggle("loaded",!0),this.$emit("loaded",this,{bubbles:!1})),this.updatePositionClasses(),i&&this.$emit("positionchange",this,{bubbles:!1})},this.updateRegionStyle=()=>{this.style.width=this.regionWidth,this.style.height=this.regionHeight,this.style.transform=`translate(${this.translateX}px, ${this.translateY}px)`},this.updatePositionClasses=()=>{this.classList.toggle("top",this.verticalPosition==="start"),this.classList.toggle("bottom",this.verticalPosition==="end"),this.classList.toggle("inset-top",this.verticalPosition==="insetStart"),this.classList.toggle("inset-bottom",this.verticalPosition==="insetEnd"),this.classList.toggle("vertical-center",this.verticalPosition==="center"),this.classList.toggle("left",this.horizontalPosition==="start"),this.classList.toggle("right",this.horizontalPosition==="end"),this.classList.toggle("inset-left",this.horizontalPosition==="insetStart"),this.classList.toggle("inset-right",this.horizontalPosition==="insetEnd"),this.classList.toggle("horizontal-center",this.horizontalPosition==="center")},this.setHorizontalPosition=(e,t)=>{if(e===void 0||this.regionRect===void 0||this.anchorRect===void 0||this.viewportRect===void 0)return;let n=0;switch(this.horizontalScaling){case"anchor":case"fill":n=this.horizontalViewportLock?this.viewportRect.width:t.width,this.regionWidth=`${n}px`;break;case"content":n=this.regionRect.width,this.regionWidth="unset";break}let i=0;switch(e){case"start":this.translateX=this.baseHorizontalOffset-n,this.horizontalViewportLock&&this.anchorRect.left>this.viewportRect.right&&(this.translateX=this.translateX-(this.anchorRect.left-this.viewportRect.right));break;case"insetStart":this.translateX=this.baseHorizontalOffset-n+this.anchorRect.width,this.horizontalViewportLock&&this.anchorRect.right>this.viewportRect.right&&(this.translateX=this.translateX-(this.anchorRect.right-this.viewportRect.right));break;case"insetEnd":this.translateX=this.baseHorizontalOffset,this.horizontalViewportLock&&this.anchorRect.left<this.viewportRect.left&&(this.translateX=this.translateX-(this.anchorRect.left-this.viewportRect.left));break;case"end":this.translateX=this.baseHorizontalOffset+this.anchorRect.width,this.horizontalViewportLock&&this.anchorRect.right<this.viewportRect.left&&(this.translateX=this.translateX-(this.anchorRect.right-this.viewportRect.left));break;case"center":if(i=(this.anchorRect.width-n)/2,this.translateX=this.baseHorizontalOffset+i,this.horizontalViewportLock){const r=this.anchorRect.left+i,a=this.anchorRect.right-i;r<this.viewportRect.left&&!(a>this.viewportRect.right)?this.translateX=this.translateX-(r-this.viewportRect.left):a>this.viewportRect.right&&!(r<this.viewportRect.left)&&(this.translateX=this.translateX-(a-this.viewportRect.right))}break}this.horizontalPosition=e},this.setVerticalPosition=(e,t)=>{if(e===void 0||this.regionRect===void 0||this.anchorRect===void 0||this.viewportRect===void 0)return;let n=0;switch(this.verticalScaling){case"anchor":case"fill":n=this.verticalViewportLock?this.viewportRect.height:t.height,this.regionHeight=`${n}px`;break;case"content":n=this.regionRect.height,this.regionHeight="unset";break}let i=0;switch(e){case"start":this.translateY=this.baseVerticalOffset-n,this.verticalViewportLock&&this.anchorRect.top>this.viewportRect.bottom&&(this.translateY=this.translateY-(this.anchorRect.top-this.viewportRect.bottom));break;case"insetStart":this.translateY=this.baseVerticalOffset-n+this.anchorRect.height,this.verticalViewportLock&&this.anchorRect.bottom>this.viewportRect.bottom&&(this.translateY=this.translateY-(this.anchorRect.bottom-this.viewportRect.bottom));break;case"insetEnd":this.translateY=this.baseVerticalOffset,this.verticalViewportLock&&this.anchorRect.top<this.viewportRect.top&&(this.translateY=this.translateY-(this.anchorRect.top-this.viewportRect.top));break;case"end":this.translateY=this.baseVerticalOffset+this.anchorRect.height,this.verticalViewportLock&&this.anchorRect.bottom<this.viewportRect.top&&(this.translateY=this.translateY-(this.anchorRect.bottom-this.viewportRect.top));break;case"center":if(i=(this.anchorRect.height-n)/2,this.translateY=this.baseVerticalOffset+i,this.verticalViewportLock){const r=this.anchorRect.top+i,a=this.anchorRect.bottom-i;r<this.viewportRect.top&&!(a>this.viewportRect.bottom)?this.translateY=this.translateY-(r-this.viewportRect.top):a>this.viewportRect.bottom&&!(r<this.viewportRect.top)&&(this.translateY=this.translateY-(a-this.viewportRect.bottom))}}this.verticalPosition=e},this.getPositioningOptions=e=>e?["insetStart","insetEnd"]:["start","end"],this.getAvailableSpace=(e,t,n,i,r,a)=>{const o=t-r,l=a-(t+i);switch(e){case"start":return o;case"insetStart":return o+i;case"insetEnd":return l+i;case"end":return l;case"center":return Math.min(o,l)*2+i}},this.getNextRegionDimension=(e,t)=>{const n={height:this.regionRect!==void 0?this.regionRect.height:0,width:this.regionRect!==void 0?this.regionRect.width:0};return e!==void 0&&this.horizontalScaling==="fill"?n.width=this.getAvailableSpace(e,this.anchorRect!==void 0?this.anchorRect.left:0,this.anchorRect!==void 0?this.anchorRect.right:0,this.anchorRect!==void 0?this.anchorRect.width:0,this.viewportRect!==void 0?this.viewportRect.left:0,this.viewportRect!==void 0?this.viewportRect.right:0):this.horizontalScaling==="anchor"&&(n.width=this.anchorRect!==void 0?this.anchorRect.width:0),t!==void 0&&this.verticalScaling==="fill"?n.height=this.getAvailableSpace(t,this.anchorRect!==void 0?this.anchorRect.top:0,this.anchorRect!==void 0?this.anchorRect.bottom:0,this.anchorRect!==void 0?this.anchorRect.height:0,this.viewportRect!==void 0?this.viewportRect.top:0,this.viewportRect!==void 0?this.viewportRect.bottom:0):this.verticalScaling==="anchor"&&(n.height=this.anchorRect!==void 0?this.anchorRect.height:0),n},this.startAutoUpdateEventListeners=()=>{window.addEventListener(Ph,this.update,{passive:!0}),window.addEventListener(Nh,this.update,{passive:!0,capture:!0}),this.resizeDetector!==null&&this.viewportElement!==null&&this.resizeDetector.observe(this.viewportElement)},this.stopAutoUpdateEventListeners=()=>{window.removeEventListener(Ph,this.update),window.removeEventListener(Nh,this.update),this.resizeDetector!==null&&this.viewportElement!==null&&this.resizeDetector.unobserve(this.viewportElement)}}anchorChanged(){this.initialLayoutComplete&&(this.anchorElement=this.getAnchor())}viewportChanged(){this.initialLayoutComplete&&(this.viewportElement=this.getViewport())}horizontalPositioningModeChanged(){this.requestReset()}horizontalDefaultPositionChanged(){this.updateForAttributeChange()}horizontalViewportLockChanged(){this.updateForAttributeChange()}horizontalInsetChanged(){this.updateForAttributeChange()}horizontalThresholdChanged(){this.updateForAttributeChange()}horizontalScalingChanged(){this.updateForAttributeChange()}verticalPositioningModeChanged(){this.requestReset()}verticalDefaultPositionChanged(){this.updateForAttributeChange()}verticalViewportLockChanged(){this.updateForAttributeChange()}verticalInsetChanged(){this.updateForAttributeChange()}verticalThresholdChanged(){this.updateForAttributeChange()}verticalScalingChanged(){this.updateForAttributeChange()}fixedPlacementChanged(){this.$fastController.isConnected&&this.initialLayoutComplete&&this.initialize()}autoUpdateModeChanged(e,t){this.$fastController.isConnected&&this.initialLayoutComplete&&(e==="auto"&&this.stopAutoUpdateEventListeners(),t==="auto"&&this.startAutoUpdateEventListeners())}anchorElementChanged(){this.requestReset()}viewportElementChanged(){this.$fastController.isConnected&&this.initialLayoutComplete&&this.initialize()}connectedCallback(){super.connectedCallback(),this.autoUpdateMode==="auto"&&this.startAutoUpdateEventListeners(),this.initialize()}disconnectedCallback(){super.disconnectedCallback(),this.autoUpdateMode==="auto"&&this.stopAutoUpdateEventListeners(),this.stopObservers(),this.disconnectResizeDetector()}adoptedCallback(){this.initialize()}disconnectResizeDetector(){this.resizeDetector!==null&&(this.resizeDetector.disconnect(),this.resizeDetector=null)}initializeResizeDetector(){this.disconnectResizeDetector(),this.resizeDetector=new window.ResizeObserver(this.handleResize)}updateForAttributeChange(){this.$fastController.isConnected&&this.initialLayoutComplete&&(this.forceUpdate=!0,this.update())}initialize(){this.initializeResizeDetector(),this.anchorElement===null&&(this.anchorElement=this.getAnchor()),this.requestReset()}requestReset(){this.$fastController.isConnected&&this.pendingReset===!1&&(this.setInitialState(),it.queueUpdate(()=>this.reset()),this.pendingReset=!0)}setInitialState(){this.initialLayoutComplete=!1,this.regionVisible=!1,this.translateX=0,this.translateY=0,this.baseHorizontalOffset=0,this.baseVerticalOffset=0,this.viewportRect=void 0,this.regionRect=void 0,this.anchorRect=void 0,this.verticalPosition=void 0,this.horizontalPosition=void 0,this.style.opacity="0",this.style.pointerEvents="none",this.forceUpdate=!1,this.style.position=this.fixedPlacement?"fixed":"absolute",this.updatePositionClasses(),this.updateRegionStyle()}}bt.intersectionService=new Ly;ge([Ee],bt.prototype,"anchor",void 0);ge([Ee],bt.prototype,"viewport",void 0);ge([Ee({attribute:"horizontal-positioning-mode"})],bt.prototype,"horizontalPositioningMode",void 0);ge([Ee({attribute:"horizontal-default-position"})],bt.prototype,"horizontalDefaultPosition",void 0);ge([Ee({attribute:"horizontal-viewport-lock",mode:"boolean"})],bt.prototype,"horizontalViewportLock",void 0);ge([Ee({attribute:"horizontal-inset",mode:"boolean"})],bt.prototype,"horizontalInset",void 0);ge([Ee({attribute:"horizontal-threshold"})],bt.prototype,"horizontalThreshold",void 0);ge([Ee({attribute:"horizontal-scaling"})],bt.prototype,"horizontalScaling",void 0);ge([Ee({attribute:"vertical-positioning-mode"})],bt.prototype,"verticalPositioningMode",void 0);ge([Ee({attribute:"vertical-default-position"})],bt.prototype,"verticalDefaultPosition",void 0);ge([Ee({attribute:"vertical-viewport-lock",mode:"boolean"})],bt.prototype,"verticalViewportLock",void 0);ge([Ee({attribute:"vertical-inset",mode:"boolean"})],bt.prototype,"verticalInset",void 0);ge([Ee({attribute:"vertical-threshold"})],bt.prototype,"verticalThreshold",void 0);ge([Ee({attribute:"vertical-scaling"})],bt.prototype,"verticalScaling",void 0);ge([Ee({attribute:"fixed-placement",mode:"boolean"})],bt.prototype,"fixedPlacement",void 0);ge([Ee({attribute:"auto-update-mode"})],bt.prototype,"autoUpdateMode",void 0);ge([tt],bt.prototype,"anchorElement",void 0);ge([tt],bt.prototype,"viewportElement",void 0);ge([tt],bt.prototype,"initialLayoutComplete",void 0);const mc=(s,e)=>ht`
    <button
        class="control"
        part="control"
        ?autofocus="${t=>t.autofocus}"
        ?disabled="${t=>t.disabled}"
        form="${t=>t.formId}"
        formaction="${t=>t.formaction}"
        formenctype="${t=>t.formenctype}"
        formmethod="${t=>t.formmethod}"
        formnovalidate="${t=>t.formnovalidate}"
        formtarget="${t=>t.formtarget}"
        name="${t=>t.name}"
        type="${t=>t.type}"
        value="${t=>t.value}"
        aria-atomic="${t=>t.ariaAtomic}"
        aria-busy="${t=>t.ariaBusy}"
        aria-controls="${t=>t.ariaControls}"
        aria-current="${t=>t.ariaCurrent}"
        aria-describedby="${t=>t.ariaDescribedby}"
        aria-details="${t=>t.ariaDetails}"
        aria-disabled="${t=>t.ariaDisabled}"
        aria-errormessage="${t=>t.ariaErrormessage}"
        aria-expanded="${t=>t.ariaExpanded}"
        aria-flowto="${t=>t.ariaFlowto}"
        aria-haspopup="${t=>t.ariaHaspopup}"
        aria-hidden="${t=>t.ariaHidden}"
        aria-invalid="${t=>t.ariaInvalid}"
        aria-keyshortcuts="${t=>t.ariaKeyshortcuts}"
        aria-label="${t=>t.ariaLabel}"
        aria-labelledby="${t=>t.ariaLabelledby}"
        aria-live="${t=>t.ariaLive}"
        aria-owns="${t=>t.ariaOwns}"
        aria-pressed="${t=>t.ariaPressed}"
        aria-relevant="${t=>t.ariaRelevant}"
        aria-roledescription="${t=>t.ariaRoledescription}"
        ${tr("control")}
    >
        ${dc(s,e)}
        <span class="content" part="content">
            <slot ${Ws("defaultSlottedContent")}></slot>
        </span>
        ${cc(s,e)}
    </button>
`,xh="form-associated-proxy",Lh="ElementInternals",Kh=Lh in window&&"setFormValue"in window[Lh].prototype,wh=new WeakMap;function bg(s){const e=class extends s{constructor(...t){super(...t),this.dirtyValue=!1,this.disabled=!1,this.proxyEventsToBlock=["change","click"],this.proxyInitialized=!1,this.required=!1,this.initialValue=this.initialValue||"",this.elementInternals||(this.formResetCallback=this.formResetCallback.bind(this))}static get formAssociated(){return Kh}get validity(){return this.elementInternals?this.elementInternals.validity:this.proxy.validity}get form(){return this.elementInternals?this.elementInternals.form:this.proxy.form}get validationMessage(){return this.elementInternals?this.elementInternals.validationMessage:this.proxy.validationMessage}get willValidate(){return this.elementInternals?this.elementInternals.willValidate:this.proxy.willValidate}get labels(){if(this.elementInternals)return Object.freeze(Array.from(this.elementInternals.labels));if(this.proxy instanceof HTMLElement&&this.proxy.ownerDocument&&this.id){const t=this.proxy.labels,n=Array.from(this.proxy.getRootNode().querySelectorAll(`[for='${this.id}']`)),i=t?n.concat(Array.from(t)):n;return Object.freeze(i)}else return dn}valueChanged(t,n){this.dirtyValue=!0,this.proxy instanceof HTMLElement&&(this.proxy.value=this.value),this.currentValue=this.value,this.setFormValue(this.value),this.validate()}currentValueChanged(){this.value=this.currentValue}initialValueChanged(t,n){this.dirtyValue||(this.value=this.initialValue,this.dirtyValue=!1)}disabledChanged(t,n){this.proxy instanceof HTMLElement&&(this.proxy.disabled=this.disabled),it.queueUpdate(()=>this.classList.toggle("disabled",this.disabled))}nameChanged(t,n){this.proxy instanceof HTMLElement&&(this.proxy.name=this.name)}requiredChanged(t,n){this.proxy instanceof HTMLElement&&(this.proxy.required=this.required),it.queueUpdate(()=>this.classList.toggle("required",this.required)),this.validate()}get elementInternals(){if(!Kh)return null;let t=wh.get(this);return t||(t=this.attachInternals(),wh.set(this,t)),t}connectedCallback(){super.connectedCallback(),this.addEventListener("keypress",this._keypressHandler),this.value||(this.value=this.initialValue,this.dirtyValue=!1),this.elementInternals||(this.attachProxy(),this.form&&this.form.addEventListener("reset",this.formResetCallback))}disconnectedCallback(){this.proxyEventsToBlock.forEach(t=>this.proxy.removeEventListener(t,this.stopPropagation)),!this.elementInternals&&this.form&&this.form.removeEventListener("reset",this.formResetCallback)}checkValidity(){return this.elementInternals?this.elementInternals.checkValidity():this.proxy.checkValidity()}reportValidity(){return this.elementInternals?this.elementInternals.reportValidity():this.proxy.reportValidity()}setValidity(t,n,i){this.elementInternals?this.elementInternals.setValidity(t,n,i):typeof n=="string"&&this.proxy.setCustomValidity(n)}formDisabledCallback(t){this.disabled=t}formResetCallback(){this.value=this.initialValue,this.dirtyValue=!1}attachProxy(){var t;this.proxyInitialized||(this.proxyInitialized=!0,this.proxy.style.display="none",this.proxyEventsToBlock.forEach(n=>this.proxy.addEventListener(n,this.stopPropagation)),this.proxy.disabled=this.disabled,this.proxy.required=this.required,typeof this.name=="string"&&(this.proxy.name=this.name),typeof this.value=="string"&&(this.proxy.value=this.value),this.proxy.setAttribute("slot",xh),this.proxySlot=document.createElement("slot"),this.proxySlot.setAttribute("name",xh)),(t=this.shadowRoot)===null||t===void 0||t.appendChild(this.proxySlot),this.appendChild(this.proxy)}detachProxy(){var t;this.removeChild(this.proxy),(t=this.shadowRoot)===null||t===void 0||t.removeChild(this.proxySlot)}validate(){this.proxy instanceof HTMLElement&&this.setValidity(this.proxy.validity,this.proxy.validationMessage)}setFormValue(t,n){this.elementInternals&&this.elementInternals.setFormValue(t,n||t)}_keypressHandler(t){switch(t.key){case pc:if(this.form instanceof HTMLFormElement){const n=this.form.querySelector("[type=submit]");n==null||n.click()}break}}stopPropagation(t){t.stopPropagation()}};return Ee({mode:"boolean"})(e.prototype,"disabled"),Ee({mode:"fromView",attribute:"value"})(e.prototype,"initialValue"),Ee({attribute:"current-value"})(e.prototype,"currentValue"),Ee(e.prototype,"name"),Ee({mode:"boolean"})(e.prototype,"required"),tt(e.prototype,"value"),e}class Ky extends ur{}class wy extends bg(Ky){constructor(){super(...arguments),this.proxy=document.createElement("input")}}let br=class extends wy{constructor(){super(...arguments),this.handleClick=e=>{var t;this.disabled&&((t=this.defaultSlottedContent)===null||t===void 0?void 0:t.length)<=1&&e.stopPropagation()},this.handleSubmission=()=>{if(!this.form)return;const e=this.proxy.isConnected;e||this.attachProxy(),typeof this.form.requestSubmit=="function"?this.form.requestSubmit(this.proxy):this.proxy.click(),e||this.detachProxy()},this.handleFormReset=()=>{var e;(e=this.form)===null||e===void 0||e.reset()},this.handleUnsupportedDelegatesFocus=()=>{var e;window.ShadowRoot&&!window.ShadowRoot.prototype.hasOwnProperty("delegatesFocus")&&(!((e=this.$fastController.definition.shadowOptions)===null||e===void 0)&&e.delegatesFocus)&&(this.focus=()=>{this.control.focus()})}}formactionChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.formAction=this.formaction)}formenctypeChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.formEnctype=this.formenctype)}formmethodChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.formMethod=this.formmethod)}formnovalidateChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.formNoValidate=this.formnovalidate)}formtargetChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.formTarget=this.formtarget)}typeChanged(e,t){this.proxy instanceof HTMLInputElement&&(this.proxy.type=this.type),t==="submit"&&this.addEventListener("click",this.handleSubmission),e==="submit"&&this.removeEventListener("click",this.handleSubmission),t==="reset"&&this.addEventListener("click",this.handleFormReset),e==="reset"&&this.removeEventListener("click",this.handleFormReset)}connectedCallback(){var e;super.connectedCallback(),this.proxy.setAttribute("type",this.type),this.handleUnsupportedDelegatesFocus();const t=Array.from((e=this.control)===null||e===void 0?void 0:e.children);t&&t.forEach(n=>{n.addEventListener("click",this.handleClick)})}disconnectedCallback(){var e;super.disconnectedCallback();const t=Array.from((e=this.control)===null||e===void 0?void 0:e.children);t&&t.forEach(n=>{n.removeEventListener("click",this.handleClick)})}};ge([Ee({mode:"boolean"})],br.prototype,"autofocus",void 0);ge([Ee({attribute:"form"})],br.prototype,"formId",void 0);ge([Ee],br.prototype,"formaction",void 0);ge([Ee],br.prototype,"formenctype",void 0);ge([Ee],br.prototype,"formmethod",void 0);ge([Ee({mode:"boolean"})],br.prototype,"formnovalidate",void 0);ge([Ee],br.prototype,"formtarget",void 0);ge([Ee],br.prototype,"type",void 0);ge([tt],br.prototype,"defaultSlottedContent",void 0);class Hs{}ge([Ee({attribute:"aria-expanded"})],Hs.prototype,"ariaExpanded",void 0);ge([Ee({attribute:"aria-pressed"})],Hs.prototype,"ariaPressed",void 0);ga(Hs,qt);ga(br,uc,Hs);const Ya={none:"none",default:"default",sticky:"sticky"},Ki={default:"default",columnHeader:"columnheader",rowHeader:"rowheader"},Xo={default:"default",header:"header",stickyHeader:"sticky-header"};class yr extends ur{constructor(){super(...arguments),this.rowType=Xo.default,this.rowData=null,this.columnDefinitions=null,this.isActiveRow=!1,this.cellsRepeatBehavior=null,this.cellsPlaceholder=null,this.focusColumnIndex=0,this.refocusOnLoad=!1,this.updateRowStyle=()=>{this.style.gridTemplateColumns=this.gridTemplateColumns}}gridTemplateColumnsChanged(){this.$fastController.isConnected&&this.updateRowStyle()}rowTypeChanged(){this.$fastController.isConnected&&this.updateItemTemplate()}rowDataChanged(){if(this.rowData!==null&&this.isActiveRow){this.refocusOnLoad=!0;return}}cellItemTemplateChanged(){this.updateItemTemplate()}headerCellItemTemplateChanged(){this.updateItemTemplate()}connectedCallback(){super.connectedCallback(),this.cellsRepeatBehavior===null&&(this.cellsPlaceholder=document.createComment(""),this.appendChild(this.cellsPlaceholder),this.updateItemTemplate(),this.cellsRepeatBehavior=new hg(e=>e.columnDefinitions,e=>e.activeCellItemTemplate,{positioning:!0}).createBehavior(this.cellsPlaceholder),this.$fastController.addBehaviors([this.cellsRepeatBehavior])),this.addEventListener("cell-focused",this.handleCellFocus),this.addEventListener(zn,this.handleFocusout),this.addEventListener($n,this.handleKeydown),this.updateRowStyle(),this.refocusOnLoad&&(this.refocusOnLoad=!1,this.cellElements.length>this.focusColumnIndex&&this.cellElements[this.focusColumnIndex].focus())}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("cell-focused",this.handleCellFocus),this.removeEventListener(zn,this.handleFocusout),this.removeEventListener($n,this.handleKeydown)}handleFocusout(e){this.contains(e.target)||(this.isActiveRow=!1,this.focusColumnIndex=0)}handleCellFocus(e){this.isActiveRow=!0,this.focusColumnIndex=this.cellElements.indexOf(e.target),this.$emit("row-focused",this)}handleKeydown(e){if(e.defaultPrevented)return;let t=0;switch(e.key){case Tg:t=Math.max(0,this.focusColumnIndex-1),this.cellElements[t].focus(),e.preventDefault();break;case Eg:t=Math.min(this.cellElements.length-1,this.focusColumnIndex+1),this.cellElements[t].focus(),e.preventDefault();break;case gc:e.ctrlKey||(this.cellElements[0].focus(),e.preventDefault());break;case fc:e.ctrlKey||(this.cellElements[this.cellElements.length-1].focus(),e.preventDefault());break}}updateItemTemplate(){this.activeCellItemTemplate=this.rowType===Xo.default&&this.cellItemTemplate!==void 0?this.cellItemTemplate:this.rowType===Xo.default&&this.cellItemTemplate===void 0?this.defaultCellItemTemplate:this.headerCellItemTemplate!==void 0?this.headerCellItemTemplate:this.defaultHeaderCellItemTemplate}}ge([Ee({attribute:"grid-template-columns"})],yr.prototype,"gridTemplateColumns",void 0);ge([Ee({attribute:"row-type"})],yr.prototype,"rowType",void 0);ge([tt],yr.prototype,"rowData",void 0);ge([tt],yr.prototype,"columnDefinitions",void 0);ge([tt],yr.prototype,"cellItemTemplate",void 0);ge([tt],yr.prototype,"headerCellItemTemplate",void 0);ge([tt],yr.prototype,"rowIndex",void 0);ge([tt],yr.prototype,"isActiveRow",void 0);ge([tt],yr.prototype,"activeCellItemTemplate",void 0);ge([tt],yr.prototype,"defaultCellItemTemplate",void 0);ge([tt],yr.prototype,"defaultHeaderCellItemTemplate",void 0);ge([tt],yr.prototype,"cellElements",void 0);function By(s){const e=s.tagFor(yr);return ht`
    <${e}
        :rowData="${t=>t}"
        :cellItemTemplate="${(t,n)=>n.parent.cellItemTemplate}"
        :headerCellItemTemplate="${(t,n)=>n.parent.headerCellItemTemplate}"
    ></${e}>
`}const Uy=(s,e)=>{const t=By(s),n=s.tagFor(yr);return ht`
        <template
            role="grid"
            tabindex="0"
            :rowElementTag="${()=>n}"
            :defaultRowItemTemplate="${t}"
            ${fg({property:"rowElements",filter:pg("[role=row]")})}
        >
            <slot></slot>
        </template>
    `};class sr extends ur{constructor(){super(),this.noTabbing=!1,this.generateHeader=Ya.default,this.rowsData=[],this.columnDefinitions=null,this.focusRowIndex=0,this.focusColumnIndex=0,this.rowsPlaceholder=null,this.generatedHeader=null,this.isUpdatingFocus=!1,this.pendingFocusUpdate=!1,this.rowindexUpdateQueued=!1,this.columnDefinitionsStale=!0,this.generatedGridTemplateColumns="",this.focusOnCell=(e,t,n)=>{if(this.rowElements.length===0){this.focusRowIndex=0,this.focusColumnIndex=0;return}const i=Math.max(0,Math.min(this.rowElements.length-1,e)),a=this.rowElements[i].querySelectorAll('[role="cell"], [role="gridcell"], [role="columnheader"], [role="rowheader"]'),o=Math.max(0,Math.min(a.length-1,t)),l=a[o];n&&this.scrollHeight!==this.clientHeight&&(i<this.focusRowIndex&&this.scrollTop>0||i>this.focusRowIndex&&this.scrollTop<this.scrollHeight-this.clientHeight)&&l.scrollIntoView({block:"center",inline:"center"}),l.focus()},this.onChildListChange=(e,t)=>{e&&e.length&&(e.forEach(n=>{n.addedNodes.forEach(i=>{i.nodeType===1&&i.getAttribute("role")==="row"&&(i.columnDefinitions=this.columnDefinitions)})}),this.queueRowIndexUpdate())},this.queueRowIndexUpdate=()=>{this.rowindexUpdateQueued||(this.rowindexUpdateQueued=!0,it.queueUpdate(this.updateRowIndexes))},this.updateRowIndexes=()=>{let e=this.gridTemplateColumns;if(e===void 0){if(this.generatedGridTemplateColumns===""&&this.rowElements.length>0){const t=this.rowElements[0];this.generatedGridTemplateColumns=new Array(t.cellElements.length).fill("1fr").join(" ")}e=this.generatedGridTemplateColumns}this.rowElements.forEach((t,n)=>{const i=t;i.rowIndex=n,i.gridTemplateColumns=e,this.columnDefinitionsStale&&(i.columnDefinitions=this.columnDefinitions)}),this.rowindexUpdateQueued=!1,this.columnDefinitionsStale=!1}}static generateTemplateColumns(e){let t="";return e.forEach(n=>{t=`${t}${t===""?"":" "}1fr`}),t}noTabbingChanged(){this.$fastController.isConnected&&(this.noTabbing?this.setAttribute("tabIndex","-1"):this.setAttribute("tabIndex",this.contains(document.activeElement)||this===document.activeElement?"-1":"0"))}generateHeaderChanged(){this.$fastController.isConnected&&this.toggleGeneratedHeader()}gridTemplateColumnsChanged(){this.$fastController.isConnected&&this.updateRowIndexes()}rowsDataChanged(){this.columnDefinitions===null&&this.rowsData.length>0&&(this.columnDefinitions=sr.generateColumns(this.rowsData[0])),this.$fastController.isConnected&&this.toggleGeneratedHeader()}columnDefinitionsChanged(){if(this.columnDefinitions===null){this.generatedGridTemplateColumns="";return}this.generatedGridTemplateColumns=sr.generateTemplateColumns(this.columnDefinitions),this.$fastController.isConnected&&(this.columnDefinitionsStale=!0,this.queueRowIndexUpdate())}headerCellItemTemplateChanged(){this.$fastController.isConnected&&this.generatedHeader!==null&&(this.generatedHeader.headerCellItemTemplate=this.headerCellItemTemplate)}focusRowIndexChanged(){this.$fastController.isConnected&&this.queueFocusUpdate()}focusColumnIndexChanged(){this.$fastController.isConnected&&this.queueFocusUpdate()}connectedCallback(){super.connectedCallback(),this.rowItemTemplate===void 0&&(this.rowItemTemplate=this.defaultRowItemTemplate),this.rowsPlaceholder=document.createComment(""),this.appendChild(this.rowsPlaceholder),this.toggleGeneratedHeader(),this.rowsRepeatBehavior=new hg(e=>e.rowsData,e=>e.rowItemTemplate,{positioning:!0}).createBehavior(this.rowsPlaceholder),this.$fastController.addBehaviors([this.rowsRepeatBehavior]),this.addEventListener("row-focused",this.handleRowFocus),this.addEventListener(Dh,this.handleFocus),this.addEventListener($n,this.handleKeydown),this.addEventListener(zn,this.handleFocusOut),this.observer=new MutationObserver(this.onChildListChange),this.observer.observe(this,{childList:!0}),this.noTabbing&&this.setAttribute("tabindex","-1"),it.queueUpdate(this.queueRowIndexUpdate)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("row-focused",this.handleRowFocus),this.removeEventListener(Dh,this.handleFocus),this.removeEventListener($n,this.handleKeydown),this.removeEventListener(zn,this.handleFocusOut),this.observer.disconnect(),this.rowsPlaceholder=null,this.generatedHeader=null}handleRowFocus(e){this.isUpdatingFocus=!0;const t=e.target;this.focusRowIndex=this.rowElements.indexOf(t),this.focusColumnIndex=t.focusColumnIndex,this.setAttribute("tabIndex","-1"),this.isUpdatingFocus=!1}handleFocus(e){this.focusOnCell(this.focusRowIndex,this.focusColumnIndex,!0)}handleFocusOut(e){(e.relatedTarget===null||!this.contains(e.relatedTarget))&&this.setAttribute("tabIndex",this.noTabbing?"-1":"0")}handleKeydown(e){if(e.defaultPrevented)return;let t;const n=this.rowElements.length-1,i=this.offsetHeight+this.scrollTop,r=this.rowElements[n];switch(e.key){case Sg:e.preventDefault(),this.focusOnCell(this.focusRowIndex-1,this.focusColumnIndex,!0);break;case Ag:e.preventDefault(),this.focusOnCell(this.focusRowIndex+1,this.focusColumnIndex,!0);break;case Ny:if(e.preventDefault(),this.rowElements.length===0){this.focusOnCell(0,0,!1);break}if(this.focusRowIndex===0){this.focusOnCell(0,this.focusColumnIndex,!1);return}for(t=this.focusRowIndex-1,t;t>=0;t--){const a=this.rowElements[t];if(a.offsetTop<this.scrollTop){this.scrollTop=a.offsetTop+a.clientHeight-this.clientHeight;break}}this.focusOnCell(t,this.focusColumnIndex,!1);break;case Py:if(e.preventDefault(),this.rowElements.length===0){this.focusOnCell(0,0,!1);break}if(this.focusRowIndex>=n||r.offsetTop+r.offsetHeight<=i){this.focusOnCell(n,this.focusColumnIndex,!1);return}for(t=this.focusRowIndex+1,t;t<=n;t++){const a=this.rowElements[t];if(a.offsetTop+a.offsetHeight>i){let o=0;this.generateHeader===Ya.sticky&&this.generatedHeader!==null&&(o=this.generatedHeader.clientHeight),this.scrollTop=a.offsetTop-o;break}}this.focusOnCell(t,this.focusColumnIndex,!1);break;case gc:e.ctrlKey&&(e.preventDefault(),this.focusOnCell(0,0,!0));break;case fc:e.ctrlKey&&this.columnDefinitions!==null&&(e.preventDefault(),this.focusOnCell(this.rowElements.length-1,this.columnDefinitions.length-1,!0));break}}queueFocusUpdate(){this.isUpdatingFocus&&(this.contains(document.activeElement)||this===document.activeElement)||this.pendingFocusUpdate===!1&&(this.pendingFocusUpdate=!0,it.queueUpdate(()=>this.updateFocus()))}updateFocus(){this.pendingFocusUpdate=!1,this.focusOnCell(this.focusRowIndex,this.focusColumnIndex,!0)}toggleGeneratedHeader(){if(this.generatedHeader!==null&&(this.removeChild(this.generatedHeader),this.generatedHeader=null),this.generateHeader!==Ya.none&&this.rowsData.length>0){const e=document.createElement(this.rowElementTag);this.generatedHeader=e,this.generatedHeader.columnDefinitions=this.columnDefinitions,this.generatedHeader.gridTemplateColumns=this.gridTemplateColumns,this.generatedHeader.rowType=this.generateHeader===Ya.sticky?Xo.stickyHeader:Xo.header,(this.firstChild!==null||this.rowsPlaceholder!==null)&&this.insertBefore(e,this.firstChild!==null?this.firstChild:this.rowsPlaceholder);return}}}sr.generateColumns=s=>Object.getOwnPropertyNames(s).map((e,t)=>({columnDataKey:e,gridColumn:`${t}`}));ge([Ee({attribute:"no-tabbing",mode:"boolean"})],sr.prototype,"noTabbing",void 0);ge([Ee({attribute:"generate-header"})],sr.prototype,"generateHeader",void 0);ge([Ee({attribute:"grid-template-columns"})],sr.prototype,"gridTemplateColumns",void 0);ge([tt],sr.prototype,"rowsData",void 0);ge([tt],sr.prototype,"columnDefinitions",void 0);ge([tt],sr.prototype,"rowItemTemplate",void 0);ge([tt],sr.prototype,"cellItemTemplate",void 0);ge([tt],sr.prototype,"headerCellItemTemplate",void 0);ge([tt],sr.prototype,"focusRowIndex",void 0);ge([tt],sr.prototype,"focusColumnIndex",void 0);ge([tt],sr.prototype,"defaultRowItemTemplate",void 0);ge([tt],sr.prototype,"rowElementTag",void 0);ge([tt],sr.prototype,"rowElements",void 0);const Fy=ht`
    <template>
        ${s=>s.rowData===null||s.columnDefinition===null||s.columnDefinition.columnDataKey===null?null:s.rowData[s.columnDefinition.columnDataKey]}
    </template>
`,Vy=ht`
    <template>
        ${s=>s.columnDefinition===null?null:s.columnDefinition.title===void 0?s.columnDefinition.columnDataKey:s.columnDefinition.title}
    </template>
`;class En extends ur{constructor(){super(...arguments),this.cellType=Ki.default,this.rowData=null,this.columnDefinition=null,this.isActiveCell=!1,this.customCellView=null,this.updateCellStyle=()=>{this.style.gridColumn=this.gridColumn}}cellTypeChanged(){this.$fastController.isConnected&&this.updateCellView()}gridColumnChanged(){this.$fastController.isConnected&&this.updateCellStyle()}columnDefinitionChanged(e,t){this.$fastController.isConnected&&this.updateCellView()}connectedCallback(){var e;super.connectedCallback(),this.addEventListener(Rh,this.handleFocusin),this.addEventListener(zn,this.handleFocusout),this.addEventListener($n,this.handleKeydown),this.style.gridColumn=`${((e=this.columnDefinition)===null||e===void 0?void 0:e.gridColumn)===void 0?0:this.columnDefinition.gridColumn}`,this.updateCellView(),this.updateCellStyle()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener(Rh,this.handleFocusin),this.removeEventListener(zn,this.handleFocusout),this.removeEventListener($n,this.handleKeydown),this.disconnectCellView()}handleFocusin(e){if(!this.isActiveCell){switch(this.isActiveCell=!0,this.cellType){case Ki.columnHeader:if(this.columnDefinition!==null&&this.columnDefinition.headerCellInternalFocusQueue!==!0&&typeof this.columnDefinition.headerCellFocusTargetCallback=="function"){const t=this.columnDefinition.headerCellFocusTargetCallback(this);t!==null&&t.focus()}break;default:if(this.columnDefinition!==null&&this.columnDefinition.cellInternalFocusQueue!==!0&&typeof this.columnDefinition.cellFocusTargetCallback=="function"){const t=this.columnDefinition.cellFocusTargetCallback(this);t!==null&&t.focus()}break}this.$emit("cell-focused",this)}}handleFocusout(e){this!==document.activeElement&&!this.contains(document.activeElement)&&(this.isActiveCell=!1)}handleKeydown(e){if(!(e.defaultPrevented||this.columnDefinition===null||this.cellType===Ki.default&&this.columnDefinition.cellInternalFocusQueue!==!0||this.cellType===Ki.columnHeader&&this.columnDefinition.headerCellInternalFocusQueue!==!0))switch(e.key){case pc:case Ry:if(this.contains(document.activeElement)&&document.activeElement!==this)return;switch(this.cellType){case Ki.columnHeader:if(this.columnDefinition.headerCellFocusTargetCallback!==void 0){const t=this.columnDefinition.headerCellFocusTargetCallback(this);t!==null&&t.focus(),e.preventDefault()}break;default:if(this.columnDefinition.cellFocusTargetCallback!==void 0){const t=this.columnDefinition.cellFocusTargetCallback(this);t!==null&&t.focus(),e.preventDefault()}break}break;case Og:this.contains(document.activeElement)&&document.activeElement!==this&&(this.focus(),e.preventDefault());break}}updateCellView(){if(this.disconnectCellView(),this.columnDefinition!==null)switch(this.cellType){case Ki.columnHeader:this.columnDefinition.headerCellTemplate!==void 0?this.customCellView=this.columnDefinition.headerCellTemplate.render(this,this):this.customCellView=Vy.render(this,this);break;case void 0:case Ki.rowHeader:case Ki.default:this.columnDefinition.cellTemplate!==void 0?this.customCellView=this.columnDefinition.cellTemplate.render(this,this):this.customCellView=Fy.render(this,this);break}}disconnectCellView(){this.customCellView!==null&&(this.customCellView.dispose(),this.customCellView=null)}}ge([Ee({attribute:"cell-type"})],En.prototype,"cellType",void 0);ge([Ee({attribute:"grid-column"})],En.prototype,"gridColumn",void 0);ge([tt],En.prototype,"rowData",void 0);ge([tt],En.prototype,"columnDefinition",void 0);function jy(s){const e=s.tagFor(En);return ht`
    <${e}
        cell-type="${t=>t.isRowHeader?"rowheader":void 0}"
        grid-column="${(t,n)=>n.index+1}"
        :rowData="${(t,n)=>n.parent.rowData}"
        :columnDefinition="${t=>t}"
    ></${e}>
`}function Wy(s){const e=s.tagFor(En);return ht`
    <${e}
        cell-type="columnheader"
        grid-column="${(t,n)=>n.index+1}"
        :columnDefinition="${t=>t}"
    ></${e}>
`}const Hy=(s,e)=>{const t=jy(s),n=Wy(s);return ht`
        <template
            role="row"
            class="${i=>i.rowType!=="default"?i.rowType:""}"
            :defaultCellItemTemplate="${t}"
            :defaultHeaderCellItemTemplate="${n}"
            ${fg({property:"cellElements",filter:pg('[role="cell"],[role="gridcell"],[role="columnheader"],[role="rowheader"]')})}
        >
            <slot ${Ws("slottedCellElements")}></slot>
        </template>
    `},Gy=(s,e)=>ht`
        <template
            tabindex="-1"
            role="${t=>!t.cellType||t.cellType==="default"?"gridcell":t.cellType}"
            class="
            ${t=>t.cellType==="columnheader"?"column-header":t.cellType==="rowheader"?"row-header":""}
            "
        >
            <slot></slot>
        </template>
    `,zy=(s,e)=>ht`
    <slot></slot>
`;let vg=class extends ur{};function As(s){const e=s.parentElement;if(e)return e;{const t=s.getRootNode();if(t.host instanceof HTMLElement)return t.host}return null}function $y(s,e){let t=e;for(;t!==null;){if(t===s)return!0;t=As(t)}return!1}const ki=document.createElement("div");function Yy(s){return s instanceof to}class Cc{setProperty(e,t){it.queueUpdate(()=>this.target.setProperty(e,t))}removeProperty(e){it.queueUpdate(()=>this.target.removeProperty(e))}}class Xy extends Cc{constructor(e){super();const t=new CSSStyleSheet;this.target=t.cssRules[t.insertRule(":host{}")].style,e.$fastController.addStyles(_r.create([t]))}}class Jy extends Cc{constructor(){super();const e=new CSSStyleSheet;this.target=e.cssRules[e.insertRule(":root{}")].style,document.adoptedStyleSheets=[...document.adoptedStyleSheets,e]}}class qy extends Cc{constructor(){super(),this.style=document.createElement("style"),document.head.appendChild(this.style);const{sheet:e}=this.style;if(e){const t=e.insertRule(":root{}",e.cssRules.length);this.target=e.cssRules[t].style}}}class kg{constructor(e){this.store=new Map,this.target=null;const t=e.$fastController;this.style=document.createElement("style"),t.addStyles(this.style),Pt.getNotifier(t).subscribe(this,"isConnected"),this.handleChange(t,"isConnected")}targetChanged(){if(this.target!==null)for(const[e,t]of this.store.entries())this.target.setProperty(e,t)}setProperty(e,t){this.store.set(e,t),it.queueUpdate(()=>{this.target!==null&&this.target.setProperty(e,t)})}removeProperty(e){this.store.delete(e),it.queueUpdate(()=>{this.target!==null&&this.target.removeProperty(e)})}handleChange(e,t){const{sheet:n}=this.style;if(n){const i=n.insertRule(":host{}",n.cssRules.length);this.target=n.cssRules[i].style}else this.target=null}}ge([tt],kg.prototype,"target",void 0);class Zy{constructor(e){this.target=e.style}setProperty(e,t){it.queueUpdate(()=>this.target.setProperty(e,t))}removeProperty(e){it.queueUpdate(()=>this.target.removeProperty(e))}}class ar{setProperty(e,t){ar.properties[e]=t;for(const n of ar.roots.values())jn.getOrCreate(ar.normalizeRoot(n)).setProperty(e,t)}removeProperty(e){delete ar.properties[e];for(const t of ar.roots.values())jn.getOrCreate(ar.normalizeRoot(t)).removeProperty(e)}static registerRoot(e){const{roots:t}=ar;if(!t.has(e)){t.add(e);const n=jn.getOrCreate(this.normalizeRoot(e));for(const i in ar.properties)n.setProperty(i,ar.properties[i])}}static unregisterRoot(e){const{roots:t}=ar;if(t.has(e)){t.delete(e);const n=jn.getOrCreate(ar.normalizeRoot(e));for(const i in ar.properties)n.removeProperty(i)}}static normalizeRoot(e){return e===ki?document:e}}ar.roots=new Set;ar.properties={};const ou=new WeakMap,Qy=it.supportsAdoptedStyleSheets?Xy:kg,jn=Object.freeze({getOrCreate(s){if(ou.has(s))return ou.get(s);let e;return s===ki?e=new ar:s instanceof Document?e=it.supportsAdoptedStyleSheets?new Jy:new qy:Yy(s)?e=new Qy(s):e=new Zy(s),ou.set(s,e),e}});class fr extends lc{constructor(e){super(),this.subscribers=new WeakMap,this._appliedTo=new Set,this.name=e.name,e.cssCustomPropertyName!==null&&(this.cssCustomProperty=`--${e.cssCustomPropertyName}`,this.cssVar=`var(${this.cssCustomProperty})`),this.id=fr.uniqueId(),fr.tokensById.set(this.id,this)}get appliedTo(){return[...this._appliedTo]}static from(e){return new fr({name:typeof e=="string"?e:e.name,cssCustomPropertyName:typeof e=="string"?e:e.cssCustomPropertyName===void 0?e.name:e.cssCustomPropertyName})}static isCSSDesignToken(e){return typeof e.cssCustomProperty=="string"}static isDerivedDesignTokenValue(e){return typeof e=="function"}static getTokenById(e){return fr.tokensById.get(e)}getOrCreateSubscriberSet(e=this){return this.subscribers.get(e)||this.subscribers.set(e,new Set)&&this.subscribers.get(e)}createCSS(){return this.cssVar||""}getValueFor(e){const t=Yt.getOrCreate(e).get(this);if(t!==void 0)return t;throw new Error(`Value could not be retrieved for token named "${this.name}". Ensure the value is set for ${e} or an ancestor of ${e}.`)}setValueFor(e,t){return this._appliedTo.add(e),t instanceof fr&&(t=this.alias(t)),Yt.getOrCreate(e).set(this,t),this}deleteValueFor(e){return this._appliedTo.delete(e),Yt.existsFor(e)&&Yt.getOrCreate(e).delete(this),this}withDefault(e){return this.setValueFor(ki,e),this}subscribe(e,t){const n=this.getOrCreateSubscriberSet(t);t&&!Yt.existsFor(t)&&Yt.getOrCreate(t),n.has(e)||n.add(e)}unsubscribe(e,t){const n=this.subscribers.get(t||this);n&&n.has(e)&&n.delete(e)}notify(e){const t=Object.freeze({token:this,target:e});this.subscribers.has(this)&&this.subscribers.get(this).forEach(n=>n.handleChange(t)),this.subscribers.has(e)&&this.subscribers.get(e).forEach(n=>n.handleChange(t))}alias(e){return t=>e.getValueFor(t)}}fr.uniqueId=(()=>{let s=0;return()=>(s++,s.toString(16))})();fr.tokensById=new Map;class eA{startReflection(e,t){e.subscribe(this,t),this.handleChange({token:e,target:t})}stopReflection(e,t){e.unsubscribe(this,t),this.remove(e,t)}handleChange(e){const{token:t,target:n}=e;this.add(t,n)}add(e,t){jn.getOrCreate(t).setProperty(e.cssCustomProperty,this.resolveCSSValue(Yt.getOrCreate(t).get(e)))}remove(e,t){jn.getOrCreate(t).removeProperty(e.cssCustomProperty)}resolveCSSValue(e){return e&&typeof e.createCSS=="function"?e.createCSS():e}}class tA{constructor(e,t,n){this.source=e,this.token=t,this.node=n,this.dependencies=new Set,this.observer=Pt.binding(e,this,!1),this.observer.handleChange=this.observer.call,this.handleChange()}disconnect(){this.observer.disconnect()}handleChange(){this.node.store.set(this.token,this.observer.observe(this.node.target,$o))}}class rA{constructor(){this.values=new Map}set(e,t){this.values.get(e)!==t&&(this.values.set(e,t),Pt.getNotifier(this).notify(e.id))}get(e){return Pt.track(this,e.id),this.values.get(e)}delete(e){this.values.delete(e)}all(){return this.values.entries()}}const Ro=new WeakMap,Po=new WeakMap;class Yt{constructor(e){this.target=e,this.store=new rA,this.children=[],this.assignedValues=new Map,this.reflecting=new Set,this.bindingObservers=new Map,this.tokenValueChangeHandler={handleChange:(t,n)=>{const i=fr.getTokenById(n);if(i&&(i.notify(this.target),fr.isCSSDesignToken(i))){const r=this.parent,a=this.isReflecting(i);if(r){const o=r.get(i),l=t.get(i);o!==l&&!a?this.reflectToCSS(i):o===l&&a&&this.stopReflectToCSS(i)}else a||this.reflectToCSS(i)}}},Ro.set(e,this),Pt.getNotifier(this.store).subscribe(this.tokenValueChangeHandler),e instanceof to?e.$fastController.addBehaviors([this]):e.isConnected&&this.bind()}static getOrCreate(e){return Ro.get(e)||new Yt(e)}static existsFor(e){return Ro.has(e)}static findParent(e){if(ki!==e.target){let t=As(e.target);for(;t!==null;){if(Ro.has(t))return Ro.get(t);t=As(t)}return Yt.getOrCreate(ki)}return null}static findClosestAssignedNode(e,t){let n=t;do{if(n.has(e))return n;n=n.parent?n.parent:n.target!==ki?Yt.getOrCreate(ki):null}while(n!==null);return null}get parent(){return Po.get(this)||null}has(e){return this.assignedValues.has(e)}get(e){const t=this.store.get(e);if(t!==void 0)return t;const n=this.getRaw(e);if(n!==void 0)return this.hydrate(e,n),this.get(e)}getRaw(e){var t;return this.assignedValues.has(e)?this.assignedValues.get(e):(t=Yt.findClosestAssignedNode(e,this))===null||t===void 0?void 0:t.getRaw(e)}set(e,t){fr.isDerivedDesignTokenValue(this.assignedValues.get(e))&&this.tearDownBindingObserver(e),this.assignedValues.set(e,t),fr.isDerivedDesignTokenValue(t)?this.setupBindingObserver(e,t):this.store.set(e,t)}delete(e){this.assignedValues.delete(e),this.tearDownBindingObserver(e);const t=this.getRaw(e);t?this.hydrate(e,t):this.store.delete(e)}bind(){const e=Yt.findParent(this);e&&e.appendChild(this);for(const t of this.assignedValues.keys())t.notify(this.target)}unbind(){this.parent&&Po.get(this).removeChild(this)}appendChild(e){e.parent&&Po.get(e).removeChild(e);const t=this.children.filter(n=>e.contains(n));Po.set(e,this),this.children.push(e),t.forEach(n=>e.appendChild(n)),Pt.getNotifier(this.store).subscribe(e);for(const[n,i]of this.store.all())e.hydrate(n,this.bindingObservers.has(n)?this.getRaw(n):i)}removeChild(e){const t=this.children.indexOf(e);return t!==-1&&this.children.splice(t,1),Pt.getNotifier(this.store).unsubscribe(e),e.parent===this?Po.delete(e):!1}contains(e){return $y(this.target,e.target)}reflectToCSS(e){this.isReflecting(e)||(this.reflecting.add(e),Yt.cssCustomPropertyReflector.startReflection(e,this.target))}stopReflectToCSS(e){this.isReflecting(e)&&(this.reflecting.delete(e),Yt.cssCustomPropertyReflector.stopReflection(e,this.target))}isReflecting(e){return this.reflecting.has(e)}handleChange(e,t){const n=fr.getTokenById(t);n&&this.hydrate(n,this.getRaw(n))}hydrate(e,t){if(!this.has(e)){const n=this.bindingObservers.get(e);fr.isDerivedDesignTokenValue(t)?n?n.source!==t&&(this.tearDownBindingObserver(e),this.setupBindingObserver(e,t)):this.setupBindingObserver(e,t):(n&&this.tearDownBindingObserver(e),this.store.set(e,t))}}setupBindingObserver(e,t){const n=new tA(t,e,this);return this.bindingObservers.set(e,n),n}tearDownBindingObserver(e){return this.bindingObservers.has(e)?(this.bindingObservers.get(e).disconnect(),this.bindingObservers.delete(e),!0):!1}}Yt.cssCustomPropertyReflector=new eA;ge([tt],Yt.prototype,"children",void 0);function iA(s){return fr.from(s)}const Lt=Object.freeze({create:iA,notifyConnection(s){return!s.isConnected||!Yt.existsFor(s)?!1:(Yt.getOrCreate(s).bind(),!0)},notifyDisconnection(s){return s.isConnected||!Yt.existsFor(s)?!1:(Yt.getOrCreate(s).unbind(),!0)},registerRoot(s=ki){ar.registerRoot(s)},unregisterRoot(s=ki){ar.unregisterRoot(s)}}),au=Object.freeze({definitionCallbackOnly:null,ignoreDuplicate:Symbol()}),su=new Map,ds=new Map;let Hn=null;const No=Wt.createInterface(s=>s.cachedCallback(e=>(Hn===null&&(Hn=new Ig(null,e)),Hn))),_c=Object.freeze({tagFor(s){return ds.get(s)},responsibleFor(s){const e=s.$$designSystem$$;return e||Wt.findResponsibleContainer(s).get(No)},getOrCreate(s){if(!s)return Hn===null&&(Hn=Wt.getOrCreateDOMContainer().get(No)),Hn;const e=s.$$designSystem$$;if(e)return e;const t=Wt.getOrCreateDOMContainer(s);if(t.has(No,!1))return t.get(No);{const n=new Ig(s,t);return t.register(ea.instance(No,n)),n}}});function nA(s,e,t){return typeof s=="string"?{name:s,type:e,callback:t}:s}class Ig{constructor(e,t){this.owner=e,this.container=t,this.designTokensInitialized=!1,this.prefix="fast",this.shadowRootMode=void 0,this.disambiguate=()=>au.definitionCallbackOnly,e!==null&&(e.$$designSystem$$=this)}withPrefix(e){return this.prefix=e,this}withShadowRootMode(e){return this.shadowRootMode=e,this}withElementDisambiguation(e){return this.disambiguate=e,this}withDesignTokenRoot(e){return this.designTokenRoot=e,this}register(...e){const t=this.container,n=[],i=this.disambiguate,r=this.shadowRootMode,a={elementPrefix:this.prefix,tryDefineElement(o,l,u){const c=nA(o,l,u),{name:d,callback:h,baseClass:p}=c;let{type:g}=c,f=d,m=su.get(f),C=!0;for(;m;){const _=i(f,g,m);switch(_){case au.ignoreDuplicate:return;case au.definitionCallbackOnly:C=!1,m=void 0;break;default:f=_,m=su.get(f);break}}C&&((ds.has(g)||g===ur)&&(g=class extends g{}),su.set(f,g),ds.set(g,f),p&&ds.set(p,f)),n.push(new oA(t,f,g,r,h,C))}};this.designTokensInitialized||(this.designTokensInitialized=!0,this.designTokenRoot!==null&&Lt.registerRoot(this.designTokenRoot)),t.registerWithContext(a,...e);for(const o of n)o.callback(o),o.willDefine&&o.definition!==null&&o.definition.define();return this}}class oA{constructor(e,t,n,i,r,a){this.container=e,this.name=t,this.type=n,this.shadowRootMode=i,this.callback=r,this.willDefine=a,this.definition=null}definePresentation(e){yg.define(this.name,e,this.container)}defineElement(e){this.definition=new pa(this.type,Object.assign(Object.assign({},e),{name:this.name}))}tagFor(e){return _c.tagFor(e)}}const aA=(s,e)=>ht`
    <div class="positioning-region" part="positioning-region">
        ${vi(t=>t.modal,ht`
                <div
                    class="overlay"
                    part="overlay"
                    role="presentation"
                    @click="${t=>t.dismiss()}"
                ></div>
            `)}
        <div
            role="dialog"
            tabindex="-1"
            class="control"
            part="control"
            aria-modal="${t=>t.modal}"
            aria-describedby="${t=>t.ariaDescribedby}"
            aria-labelledby="${t=>t.ariaLabelledby}"
            aria-label="${t=>t.ariaLabel}"
            ${tr("dialog")}
        >
            <slot></slot>
        </div>
    </div>
`;/*!
* tabbable 5.3.3
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var sA=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],lA=sA.join(","),Dg=typeof Element>"u",Ts=Dg?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Nu=!Dg&&Element.prototype.getRootNode?function(s){return s.getRootNode()}:function(s){return s.ownerDocument},uA=function(e,t){return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},Rg=function(e){return e.tagName==="INPUT"},cA=function(e){return Rg(e)&&e.type==="hidden"},dA=function(e){var t=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return t},hA=function(e,t){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===t)return e[n]},pA=function(e){if(!e.name)return!0;var t=e.form||Nu(e),n=function(o){return t.querySelectorAll('input[type="radio"][name="'+o+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=n(window.CSS.escape(e.name));else try{i=n(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var r=hA(i,e.form);return!r||r===e},gA=function(e){return Rg(e)&&e.type==="radio"},fA=function(e){return gA(e)&&!pA(e)},Bh=function(e){var t=e.getBoundingClientRect(),n=t.width,i=t.height;return n===0&&i===0},mA=function(e,t){var n=t.displayCheck,i=t.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var r=Ts.call(e,"details>summary:first-of-type"),a=r?e.parentElement:e;if(Ts.call(a,"details:not([open]) *"))return!0;var o=Nu(e).host,l=(o==null?void 0:o.ownerDocument.contains(o))||e.ownerDocument.contains(e);if(!n||n==="full"){if(typeof i=="function"){for(var u=e;e;){var c=e.parentElement,d=Nu(e);if(c&&!c.shadowRoot&&i(c)===!0)return Bh(e);e.assignedSlot?e=e.assignedSlot:!c&&d!==e.ownerDocument?e=d.host:e=c}e=u}if(l)return!e.getClientRects().length}else if(n==="non-zero-area")return Bh(e);return!1},CA=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if(t.tagName==="FIELDSET"&&t.disabled){for(var n=0;n<t.children.length;n++){var i=t.children.item(n);if(i.tagName==="LEGEND")return Ts.call(t,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}t=t.parentElement}return!1},_A=function(e,t){return!(t.disabled||cA(t)||mA(t,e)||dA(t)||CA(t))},yA=function(e,t){return!(fA(t)||uA(t)<0||!_A(e,t))},Uh=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return Ts.call(e,lA)===!1?!1:yA(t,e)};class Kr extends ur{constructor(){super(...arguments),this.modal=!0,this.hidden=!1,this.trapFocus=!0,this.trapFocusChanged=()=>{this.$fastController.isConnected&&this.updateTrapFocus()},this.isTrappingFocus=!1,this.handleDocumentKeydown=e=>{if(!e.defaultPrevented&&!this.hidden)switch(e.key){case Og:this.dismiss(),e.preventDefault();break;case xy:this.handleTabKeyDown(e);break}},this.handleDocumentFocus=e=>{!e.defaultPrevented&&this.shouldForceFocus(e.target)&&(this.focusFirstElement(),e.preventDefault())},this.handleTabKeyDown=e=>{if(!this.trapFocus||this.hidden)return;const t=this.getTabQueueBounds();if(t.length!==0){if(t.length===1){t[0].focus(),e.preventDefault();return}e.shiftKey&&e.target===t[0]?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&e.target===t[t.length-1]&&(t[0].focus(),e.preventDefault())}},this.getTabQueueBounds=()=>{const e=[];return Kr.reduceTabbableItems(e,this)},this.focusFirstElement=()=>{const e=this.getTabQueueBounds();e.length>0?e[0].focus():this.dialog instanceof HTMLElement&&this.dialog.focus()},this.shouldForceFocus=e=>this.isTrappingFocus&&!this.contains(e),this.shouldTrapFocus=()=>this.trapFocus&&!this.hidden,this.updateTrapFocus=e=>{const t=e===void 0?this.shouldTrapFocus():e;t&&!this.isTrappingFocus?(this.isTrappingFocus=!0,document.addEventListener("focusin",this.handleDocumentFocus),it.queueUpdate(()=>{this.shouldForceFocus(document.activeElement)&&this.focusFirstElement()})):!t&&this.isTrappingFocus&&(this.isTrappingFocus=!1,document.removeEventListener("focusin",this.handleDocumentFocus))}}dismiss(){this.$emit("dismiss"),this.$emit("cancel")}show(){this.hidden=!1}hide(){this.hidden=!0,this.$emit("close")}connectedCallback(){super.connectedCallback(),document.addEventListener("keydown",this.handleDocumentKeydown),this.notifier=Pt.getNotifier(this),this.notifier.subscribe(this,"hidden"),this.updateTrapFocus()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this.handleDocumentKeydown),this.updateTrapFocus(!1),this.notifier.unsubscribe(this,"hidden")}handleChange(e,t){switch(t){case"hidden":this.updateTrapFocus();break}}static reduceTabbableItems(e,t){return t.getAttribute("tabindex")==="-1"?e:Uh(t)||Kr.isFocusableFastElement(t)&&Kr.hasTabbableShadow(t)?(e.push(t),e):t.childElementCount?e.concat(Array.from(t.children).reduce(Kr.reduceTabbableItems,[])):e}static isFocusableFastElement(e){var t,n;return!!(!((n=(t=e.$fastController)===null||t===void 0?void 0:t.definition.shadowOptions)===null||n===void 0)&&n.delegatesFocus)}static hasTabbableShadow(e){var t,n;return Array.from((n=(t=e.shadowRoot)===null||t===void 0?void 0:t.querySelectorAll("*"))!==null&&n!==void 0?n:[]).some(i=>Uh(i))}}ge([Ee({mode:"boolean"})],Kr.prototype,"modal",void 0);ge([Ee({mode:"boolean"})],Kr.prototype,"hidden",void 0);ge([Ee({attribute:"trap-focus",mode:"boolean"})],Kr.prototype,"trapFocus",void 0);ge([Ee({attribute:"aria-describedby"})],Kr.prototype,"ariaDescribedby",void 0);ge([Ee({attribute:"aria-labelledby"})],Kr.prototype,"ariaLabelledby",void 0);ge([Ee({attribute:"aria-label"})],Kr.prototype,"ariaLabel",void 0);const AA={separator:"separator",presentation:"presentation"};class yc extends ur{constructor(){super(...arguments),this.role=AA.separator,this.orientation=vy.horizontal}}ge([Ee],yc.prototype,"role",void 0);ge([Ee],yc.prototype,"orientation",void 0);const mr={menuitem:"menuitem",menuitemcheckbox:"menuitemcheckbox",menuitemradio:"menuitemradio"},TA={[mr.menuitem]:"menuitem",[mr.menuitemcheckbox]:"menuitemcheckbox",[mr.menuitemradio]:"menuitemradio"};class Br extends ur{constructor(){super(...arguments),this.role=mr.menuitem,this.hasSubmenu=!1,this.currentDirection=Di.ltr,this.focusSubmenuOnLoad=!1,this.handleMenuItemKeyDown=e=>{if(e.defaultPrevented)return!1;switch(e.key){case pc:case My:return this.invoke(),!1;case Eg:return this.expandAndFocus(),!1;case Tg:if(this.expanded)return this.expanded=!1,this.focus(),!1}return!0},this.handleMenuItemClick=e=>(e.defaultPrevented||this.disabled||this.invoke(),!1),this.submenuLoaded=()=>{this.focusSubmenuOnLoad&&(this.focusSubmenuOnLoad=!1,this.hasSubmenu&&(this.submenu.focus(),this.setAttribute("tabindex","-1")))},this.handleMouseOver=e=>(this.disabled||!this.hasSubmenu||this.expanded||(this.expanded=!0),!1),this.handleMouseOut=e=>(!this.expanded||this.contains(document.activeElement)||(this.expanded=!1),!1),this.expandAndFocus=()=>{this.hasSubmenu&&(this.focusSubmenuOnLoad=!0,this.expanded=!0)},this.invoke=()=>{if(!this.disabled)switch(this.role){case mr.menuitemcheckbox:this.checked=!this.checked;break;case mr.menuitem:this.updateSubmenu(),this.hasSubmenu?this.expandAndFocus():this.$emit("change");break;case mr.menuitemradio:this.checked||(this.checked=!0);break}},this.updateSubmenu=()=>{this.submenu=this.domChildren().find(e=>e.getAttribute("role")==="menu"),this.hasSubmenu=this.submenu!==void 0}}expandedChanged(e){if(this.$fastController.isConnected){if(this.submenu===void 0)return;this.expanded===!1?this.submenu.collapseExpandedItem():this.currentDirection=Pu(this),this.$emit("expanded-change",this,{bubbles:!1})}}checkedChanged(e,t){this.$fastController.isConnected&&this.$emit("change")}connectedCallback(){super.connectedCallback(),it.queueUpdate(()=>{this.updateSubmenu()}),this.startColumnCount||(this.startColumnCount=1),this.observer=new MutationObserver(this.updateSubmenu)}disconnectedCallback(){super.disconnectedCallback(),this.submenu=void 0,this.observer!==void 0&&(this.observer.disconnect(),this.observer=void 0)}domChildren(){return Array.from(this.children).filter(e=>!e.hasAttribute("hidden"))}}ge([Ee({mode:"boolean"})],Br.prototype,"disabled",void 0);ge([Ee({mode:"boolean"})],Br.prototype,"expanded",void 0);ge([tt],Br.prototype,"startColumnCount",void 0);ge([Ee],Br.prototype,"role",void 0);ge([Ee({mode:"boolean"})],Br.prototype,"checked",void 0);ge([tt],Br.prototype,"submenuRegion",void 0);ge([tt],Br.prototype,"hasSubmenu",void 0);ge([tt],Br.prototype,"currentDirection",void 0);ge([tt],Br.prototype,"submenu",void 0);ga(Br,uc);const EA=(s,e)=>ht`
    <template
        role="${t=>t.role}"
        aria-haspopup="${t=>t.hasSubmenu?"menu":void 0}"
        aria-checked="${t=>t.role!==mr.menuitem?t.checked:void 0}"
        aria-disabled="${t=>t.disabled}"
        aria-expanded="${t=>t.expanded}"
        @keydown="${(t,n)=>t.handleMenuItemKeyDown(n.event)}"
        @click="${(t,n)=>t.handleMenuItemClick(n.event)}"
        @mouseover="${(t,n)=>t.handleMouseOver(n.event)}"
        @mouseout="${(t,n)=>t.handleMouseOut(n.event)}"
        class="${t=>t.disabled?"disabled":""} ${t=>t.expanded?"expanded":""} ${t=>`indent-${t.startColumnCount}`}"
    >
            ${vi(t=>t.role===mr.menuitemcheckbox,ht`
                    <div part="input-container" class="input-container">
                        <span part="checkbox" class="checkbox">
                            <slot name="checkbox-indicator">
                                ${e.checkboxIndicator||""}
                            </slot>
                        </span>
                    </div>
                `)}
            ${vi(t=>t.role===mr.menuitemradio,ht`
                    <div part="input-container" class="input-container">
                        <span part="radio" class="radio">
                            <slot name="radio-indicator">
                                ${e.radioIndicator||""}
                            </slot>
                        </span>
                    </div>
                `)}
        </div>
        ${dc(s,e)}
        <span class="content" part="content">
            <slot></slot>
        </span>
        ${cc(s,e)}
        ${vi(t=>t.hasSubmenu,ht`
                <div
                    part="expand-collapse-glyph-container"
                    class="expand-collapse-glyph-container"
                >
                    <span part="expand-collapse" class="expand-collapse">
                        <slot name="expand-collapse-indicator">
                            ${e.expandCollapseGlyph||""}
                        </slot>
                    </span>
                </div>
            `)}
        ${vi(t=>t.expanded,ht`
                <${s.tagFor(bt)}
                    :anchorElement="${t=>t}"
                    vertical-positioning-mode="dynamic"
                    vertical-default-position="bottom"
                    vertical-inset="true"
                    horizontal-positioning-mode="dynamic"
                    horizontal-default-position="end"
                    class="submenu-region"
                    dir="${t=>t.currentDirection}"
                    @loaded="${t=>t.submenuLoaded()}"
                    ${tr("submenuRegion")}
                    part="submenu-region"
                >
                    <slot name="submenu"></slot>
                </${s.tagFor(bt)}>
            `)}
    </template>
`,SA=(s,e)=>ht`
    <template
        slot="${t=>t.slot?t.slot:t.isNestedMenu()?"submenu":void 0}"
        role="menu"
        @keydown="${(t,n)=>t.handleMenuKeyDown(n.event)}"
        @focusout="${(t,n)=>t.handleFocusOut(n.event)}"
    >
        <slot ${Ws("items")}></slot>
    </template>
`;let Gs=class Pg extends ur{constructor(){super(...arguments),this.expandedItem=null,this.focusIndex=-1,this.isNestedMenu=()=>this.parentElement!==null&&Ih(this.parentElement)&&this.parentElement.getAttribute("role")==="menuitem",this.handleFocusOut=e=>{if(!this.contains(e.relatedTarget)&&this.menuItems!==void 0){this.collapseExpandedItem();const t=this.menuItems.findIndex(this.isFocusableElement);this.menuItems[this.focusIndex].setAttribute("tabindex","-1"),this.menuItems[t].setAttribute("tabindex","0"),this.focusIndex=t}},this.handleItemFocus=e=>{const t=e.target;this.menuItems!==void 0&&t!==this.menuItems[this.focusIndex]&&(this.menuItems[this.focusIndex].setAttribute("tabindex","-1"),this.focusIndex=this.menuItems.indexOf(t),t.setAttribute("tabindex","0"))},this.handleExpandedChanged=e=>{if(e.defaultPrevented||e.target===null||this.menuItems===void 0||this.menuItems.indexOf(e.target)<0)return;e.preventDefault();const t=e.target;if(this.expandedItem!==null&&t===this.expandedItem&&t.expanded===!1){this.expandedItem=null;return}t.expanded&&(this.expandedItem!==null&&this.expandedItem!==t&&(this.expandedItem.expanded=!1),this.menuItems[this.focusIndex].setAttribute("tabindex","-1"),this.expandedItem=t,this.focusIndex=this.menuItems.indexOf(t),t.setAttribute("tabindex","0"))},this.removeItemListeners=()=>{this.menuItems!==void 0&&this.menuItems.forEach(e=>{e.removeEventListener("expanded-change",this.handleExpandedChanged),e.removeEventListener("focus",this.handleItemFocus)})},this.setItems=()=>{const e=this.domChildren();this.removeItemListeners(),this.menuItems=e;const t=this.menuItems.filter(this.isMenuItemElement);t.length&&(this.focusIndex=0);function n(r){const a=r.getAttribute("role"),o=r.querySelector("[slot=start]");return a!==mr.menuitem&&o===null||a===mr.menuitem&&o!==null?1:a!==mr.menuitem&&o!==null?2:0}const i=t.reduce((r,a)=>{const o=n(a);return r>o?r:o},0);t.forEach((r,a)=>{r.setAttribute("tabindex",a===0?"0":"-1"),r.addEventListener("expanded-change",this.handleExpandedChanged),r.addEventListener("focus",this.handleItemFocus),r instanceof Br&&(r.startColumnCount=i)})},this.changeHandler=e=>{if(this.menuItems===void 0)return;const t=e.target,n=this.menuItems.indexOf(t);if(n!==-1&&t.role==="menuitemradio"&&t.checked===!0){for(let r=n-1;r>=0;--r){const a=this.menuItems[r],o=a.getAttribute("role");if(o===mr.menuitemradio&&(a.checked=!1),o==="separator")break}const i=this.menuItems.length-1;for(let r=n+1;r<=i;++r){const a=this.menuItems[r],o=a.getAttribute("role");if(o===mr.menuitemradio&&(a.checked=!1),o==="separator")break}}},this.isMenuItemElement=e=>Ih(e)&&Pg.focusableElementRoles.hasOwnProperty(e.getAttribute("role")),this.isFocusableElement=e=>this.isMenuItemElement(e)}itemsChanged(e,t){this.$fastController.isConnected&&this.menuItems!==void 0&&this.setItems()}connectedCallback(){super.connectedCallback(),it.queueUpdate(()=>{this.setItems()}),this.addEventListener("change",this.changeHandler)}disconnectedCallback(){super.disconnectedCallback(),this.removeItemListeners(),this.menuItems=void 0,this.removeEventListener("change",this.changeHandler)}focus(){this.setFocus(0,1)}collapseExpandedItem(){this.expandedItem!==null&&(this.expandedItem.expanded=!1,this.expandedItem=null)}handleMenuKeyDown(e){if(!(e.defaultPrevented||this.menuItems===void 0))switch(e.key){case Ag:this.setFocus(this.focusIndex+1,1);return;case Sg:this.setFocus(this.focusIndex-1,-1);return;case fc:this.setFocus(this.menuItems.length-1,-1);return;case gc:this.setFocus(0,1);return;default:return!0}}domChildren(){return Array.from(this.children).filter(e=>!e.hasAttribute("hidden"))}setFocus(e,t){if(this.menuItems!==void 0)for(;e>=0&&e<this.menuItems.length;){const n=this.menuItems[e];if(this.isFocusableElement(n)){this.focusIndex>-1&&this.menuItems.length>=this.focusIndex-1&&this.menuItems[this.focusIndex].setAttribute("tabindex","-1"),this.focusIndex=e,n.setAttribute("tabindex","0"),n.focus();break}e+=t}}};Gs.focusableElementRoles=TA;ge([tt],Gs.prototype,"items",void 0);class OA extends ur{}class bA extends bg(OA){constructor(){super(...arguments),this.proxy=document.createElement("input")}}const vA={email:"email",password:"password",tel:"tel",text:"text",url:"url"};let vr=class extends bA{constructor(){super(...arguments),this.type=vA.text}readOnlyChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.readOnly=this.readOnly,this.validate())}autofocusChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.autofocus=this.autofocus,this.validate())}placeholderChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.placeholder=this.placeholder)}typeChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.type=this.type,this.validate())}listChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.setAttribute("list",this.list),this.validate())}maxlengthChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.maxLength=this.maxlength,this.validate())}minlengthChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.minLength=this.minlength,this.validate())}patternChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.pattern=this.pattern,this.validate())}sizeChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.size=this.size)}spellcheckChanged(){this.proxy instanceof HTMLInputElement&&(this.proxy.spellcheck=this.spellcheck)}connectedCallback(){super.connectedCallback(),this.proxy.setAttribute("type",this.type),this.validate(),this.autofocus&&it.queueUpdate(()=>{this.focus()})}select(){this.control.select(),this.$emit("select")}handleTextInput(){this.value=this.control.value}handleChange(){this.$emit("change")}};ge([Ee({attribute:"readonly",mode:"boolean"})],vr.prototype,"readOnly",void 0);ge([Ee({mode:"boolean"})],vr.prototype,"autofocus",void 0);ge([Ee],vr.prototype,"placeholder",void 0);ge([Ee],vr.prototype,"type",void 0);ge([Ee],vr.prototype,"list",void 0);ge([Ee({converter:ac})],vr.prototype,"maxlength",void 0);ge([Ee({converter:ac})],vr.prototype,"minlength",void 0);ge([Ee],vr.prototype,"pattern",void 0);ge([Ee({converter:ac})],vr.prototype,"size",void 0);ge([Ee({mode:"boolean"})],vr.prototype,"spellcheck",void 0);ge([tt],vr.prototype,"defaultSlottedNodes",void 0);class Ng{}ga(Ng,qt);ga(vr,uc,Ng);function kA(s,e,t){return s.nodeType!==Node.TEXT_NODE?!0:typeof s.nodeValue=="string"&&!!s.nodeValue.trim().length}const IA=(s,e)=>ht`
    <template
        class="
            ${t=>t.readOnly?"readonly":""}
        "
    >
        <label
            part="label"
            for="control"
            class="${t=>t.defaultSlottedNodes&&t.defaultSlottedNodes.length?"label":"label label__hidden"}"
        >
            <slot
                ${Ws({property:"defaultSlottedNodes",filter:kA})}
            ></slot>
        </label>
        <div class="root" part="root">
            ${dc(s,e)}
            <input
                class="control"
                part="control"
                id="control"
                @input="${t=>t.handleTextInput()}"
                @change="${t=>t.handleChange()}"
                ?autofocus="${t=>t.autofocus}"
                ?disabled="${t=>t.disabled}"
                list="${t=>t.list}"
                maxlength="${t=>t.maxlength}"
                minlength="${t=>t.minlength}"
                pattern="${t=>t.pattern}"
                placeholder="${t=>t.placeholder}"
                ?readonly="${t=>t.readOnly}"
                ?required="${t=>t.required}"
                size="${t=>t.size}"
                ?spellcheck="${t=>t.spellcheck}"
                :value="${t=>t.value}"
                type="${t=>t.type}"
                aria-atomic="${t=>t.ariaAtomic}"
                aria-busy="${t=>t.ariaBusy}"
                aria-controls="${t=>t.ariaControls}"
                aria-current="${t=>t.ariaCurrent}"
                aria-describedby="${t=>t.ariaDescribedby}"
                aria-details="${t=>t.ariaDetails}"
                aria-disabled="${t=>t.ariaDisabled}"
                aria-errormessage="${t=>t.ariaErrormessage}"
                aria-flowto="${t=>t.ariaFlowto}"
                aria-haspopup="${t=>t.ariaHaspopup}"
                aria-hidden="${t=>t.ariaHidden}"
                aria-invalid="${t=>t.ariaInvalid}"
                aria-keyshortcuts="${t=>t.ariaKeyshortcuts}"
                aria-label="${t=>t.ariaLabel}"
                aria-labelledby="${t=>t.ariaLabelledby}"
                aria-live="${t=>t.ariaLive}"
                aria-owns="${t=>t.ariaOwns}"
                aria-relevant="${t=>t.ariaRelevant}"
                aria-roledescription="${t=>t.ariaRoledescription}"
                ${tr("control")}
            />
            ${cc(s,e)}
        </div>
    </template>
`;class DA{constructor(e){this.listenerCache=new WeakMap,this.query=e}bind(e){const{query:t}=this,n=this.constructListener(e);n.bind(t)(),t.addListener(n),this.listenerCache.set(e,n)}unbind(e){const t=this.listenerCache.get(e);t&&(this.query.removeListener(t),this.listenerCache.delete(e))}}class fa extends DA{constructor(e,t){super(e),this.styles=t}static with(e){return t=>new fa(e,t)}constructListener(e){let t=!1;const n=this.styles;return function(){const{matches:r}=this;r&&!t?(e.$fastController.addStyles(n),t=r):!r&&t&&(e.$fastController.removeStyles(n),t=r)}}unbind(e){super.unbind(e),e.$fastController.removeStyles(this.styles)}}const kt=fa.with(window.matchMedia("(forced-colors)"));fa.with(window.matchMedia("(prefers-color-scheme: dark)"));fa.with(window.matchMedia("(prefers-color-scheme: light)"));class Mg{constructor(e,t,n){this.propertyName=e,this.value=t,this.styles=n}bind(e){Pt.getNotifier(e).subscribe(this,this.propertyName),this.handleChange(e,this.propertyName)}unbind(e){Pt.getNotifier(e).unsubscribe(this,this.propertyName),e.$fastController.removeStyles(this.styles)}handleChange(e,t){e[t]===this.value?e.$fastController.addStyles(this.styles):e.$fastController.removeStyles(this.styles)}}const ta="not-allowed",RA=":host([hidden]){display:none}";function ro(s){return`${RA}:host{display:${s}}`}const Je=Dy()?"focus-visible":"focus";function fi(s,e,t){return isNaN(s)||s<=e?e:s>=t?t:s}function lu(s,e,t){return isNaN(s)||s<=e?0:s>=t?1:s/(t-e)}function on(s,e,t){return isNaN(s)?e:e+s*(t-e)}function Fh(s){return s*(Math.PI/180)}function PA(s){return s*(180/Math.PI)}function NA(s){const e=Math.round(fi(s,0,255)).toString(16);return e.length===1?"0"+e:e}function dr(s,e,t){return isNaN(s)||s<=0?e:s>=1?t:e+s*(t-e)}function Ac(s,e,t){if(s<=0)return e%360;if(s>=1)return t%360;const n=(e-t+360)%360,i=(t-e+360)%360;return n<=i?(e-n*s+360)%360:(e+n*s+360)%360}function Jt(s,e){const t=Math.pow(10,e);return Math.round(s*t)/t}class Vi{constructor(e,t,n){this.h=e,this.s=t,this.l=n}static fromObject(e){return e&&!isNaN(e.h)&&!isNaN(e.s)&&!isNaN(e.l)?new Vi(e.h,e.s,e.l):null}equalValue(e){return this.h===e.h&&this.s===e.s&&this.l===e.l}roundToPrecision(e){return new Vi(Jt(this.h,e),Jt(this.s,e),Jt(this.l,e))}toObject(){return{h:this.h,s:this.s,l:this.l}}}class ra{constructor(e,t,n){this.h=e,this.s=t,this.v=n}static fromObject(e){return e&&!isNaN(e.h)&&!isNaN(e.s)&&!isNaN(e.v)?new ra(e.h,e.s,e.v):null}equalValue(e){return this.h===e.h&&this.s===e.s&&this.v===e.v}roundToPrecision(e){return new ra(Jt(this.h,e),Jt(this.s,e),Jt(this.v,e))}toObject(){return{h:this.h,s:this.s,v:this.v}}}class Zt{constructor(e,t,n){this.l=e,this.a=t,this.b=n}static fromObject(e){return e&&!isNaN(e.l)&&!isNaN(e.a)&&!isNaN(e.b)?new Zt(e.l,e.a,e.b):null}equalValue(e){return this.l===e.l&&this.a===e.a&&this.b===e.b}roundToPrecision(e){return new Zt(Jt(this.l,e),Jt(this.a,e),Jt(this.b,e))}toObject(){return{l:this.l,a:this.a,b:this.b}}}Zt.epsilon=216/24389;Zt.kappa=24389/27;class Yn{constructor(e,t,n){this.l=e,this.c=t,this.h=n}static fromObject(e){return e&&!isNaN(e.l)&&!isNaN(e.c)&&!isNaN(e.h)?new Yn(e.l,e.c,e.h):null}equalValue(e){return this.l===e.l&&this.c===e.c&&this.h===e.h}roundToPrecision(e){return new Yn(Jt(this.l,e),Jt(this.c,e),Jt(this.h,e))}toObject(){return{l:this.l,c:this.c,h:this.h}}}class pt{constructor(e,t,n,i){this.r=e,this.g=t,this.b=n,this.a=typeof i=="number"&&!isNaN(i)?i:1}static fromObject(e){return e&&!isNaN(e.r)&&!isNaN(e.g)&&!isNaN(e.b)?new pt(e.r,e.g,e.b,e.a):null}equalValue(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}toStringHexRGB(){return"#"+[this.r,this.g,this.b].map(this.formatHexValue).join("")}toStringHexRGBA(){return this.toStringHexRGB()+this.formatHexValue(this.a)}toStringHexARGB(){return"#"+[this.a,this.r,this.g,this.b].map(this.formatHexValue).join("")}toStringWebRGB(){return`rgb(${Math.round(on(this.r,0,255))},${Math.round(on(this.g,0,255))},${Math.round(on(this.b,0,255))})`}toStringWebRGBA(){return`rgba(${Math.round(on(this.r,0,255))},${Math.round(on(this.g,0,255))},${Math.round(on(this.b,0,255))},${fi(this.a,0,1)})`}roundToPrecision(e){return new pt(Jt(this.r,e),Jt(this.g,e),Jt(this.b,e),Jt(this.a,e))}clamp(){return new pt(fi(this.r,0,1),fi(this.g,0,1),fi(this.b,0,1),fi(this.a,0,1))}toObject(){return{r:this.r,g:this.g,b:this.b,a:this.a}}formatHexValue(e){return NA(on(e,0,255))}}class Or{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromObject(e){return e&&!isNaN(e.x)&&!isNaN(e.y)&&!isNaN(e.z)?new Or(e.x,e.y,e.z):null}equalValue(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}roundToPrecision(e){return new Or(Jt(this.x,e),Jt(this.y,e),Jt(this.z,e))}toObject(){return{x:this.x,y:this.y,z:this.z}}}Or.whitePoint=new Or(.95047,1,1.08883);function Mu(s){return s.r*.2126+s.g*.7152+s.b*.0722}function ia(s){function e(t){return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}return Mu(new pt(e(s.r),e(s.g),e(s.b),1))}const Vh=(s,e)=>(s+.05)/(e+.05);function jh(s,e){const t=ia(s),n=ia(e);return t>n?Vh(t,n):Vh(n,t)}function uu(s,e,t){return t-e===0?0:(s-e)/(t-e)}function cu(s,e,t){const n=uu(s.r,e.r,t.r),i=uu(s.g,e.g,t.g),r=uu(s.b,e.b,t.b);return(n+i+r)/3}function MA(s,e,t=null){let n=0,i=t;return i!==null?n=cu(s,e,i):(i=new pt(0,0,0,1),n=cu(s,e,i),n<=0&&(i=new pt(1,1,1,1),n=cu(s,e,i))),n=Math.round(n*1e3)/1e3,new pt(i.r,i.g,i.b,n)}function gn(s){const e=Math.max(s.r,s.g,s.b),t=Math.min(s.r,s.g,s.b),n=e-t;let i=0;n!==0&&(e===s.r?i=60*((s.g-s.b)/n%6):e===s.g?i=60*((s.b-s.r)/n+2):i=60*((s.r-s.g)/n+4)),i<0&&(i+=360);const r=(e+t)/2;let a=0;return n!==0&&(a=n/(1-Math.abs(2*r-1))),new Vi(i,a,r)}function Es(s,e=1){const t=(1-Math.abs(2*s.l-1))*s.s,n=t*(1-Math.abs(s.h/60%2-1)),i=s.l-t/2;let r=0,a=0,o=0;return s.h<60?(r=t,a=n,o=0):s.h<120?(r=n,a=t,o=0):s.h<180?(r=0,a=t,o=n):s.h<240?(r=0,a=n,o=t):s.h<300?(r=n,a=0,o=t):s.h<360&&(r=t,a=0,o=n),new pt(r+i,a+i,o+i,e)}function Wh(s){const e=Math.max(s.r,s.g,s.b),t=Math.min(s.r,s.g,s.b),n=e-t;let i=0;n!==0&&(e===s.r?i=60*((s.g-s.b)/n%6):e===s.g?i=60*((s.b-s.r)/n+2):i=60*((s.r-s.g)/n+4)),i<0&&(i+=360);let r=0;return e!==0&&(r=n/e),new ra(i,r,e)}function xA(s,e=1){const t=s.s*s.v,n=t*(1-Math.abs(s.h/60%2-1)),i=s.v-t;let r=0,a=0,o=0;return s.h<60?(r=t,a=n,o=0):s.h<120?(r=n,a=t,o=0):s.h<180?(r=0,a=t,o=n):s.h<240?(r=0,a=n,o=t):s.h<300?(r=n,a=0,o=t):s.h<360&&(r=t,a=0,o=n),new pt(r+i,a+i,o+i,e)}function LA(s){let e=0,t=0;return s.h!==0&&(e=Math.cos(Fh(s.h))*s.c,t=Math.sin(Fh(s.h))*s.c),new Zt(s.l,e,t)}function KA(s){let e=0;(Math.abs(s.b)>.001||Math.abs(s.a)>.001)&&(e=PA(Math.atan2(s.b,s.a))),e<0&&(e+=360);const t=Math.sqrt(s.a*s.a+s.b*s.b);return new Yn(s.l,t,e)}function wA(s){const e=(s.l+16)/116,t=e+s.a/500,n=e-s.b/200,i=Math.pow(t,3),r=Math.pow(e,3),a=Math.pow(n,3);let o=0;i>Zt.epsilon?o=i:o=(116*t-16)/Zt.kappa;let l=0;s.l>Zt.epsilon*Zt.kappa?l=r:l=s.l/Zt.kappa;let u=0;return a>Zt.epsilon?u=a:u=(116*n-16)/Zt.kappa,o=Or.whitePoint.x*o,l=Or.whitePoint.y*l,u=Or.whitePoint.z*u,new Or(o,l,u)}function BA(s){function e(l){return l>Zt.epsilon?Math.pow(l,1/3):(Zt.kappa*l+16)/116}const t=e(s.x/Or.whitePoint.x),n=e(s.y/Or.whitePoint.y),i=e(s.z/Or.whitePoint.z),r=116*n-16,a=500*(t-n),o=200*(n-i);return new Zt(r,a,o)}function xu(s){function e(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}const t=e(s.r),n=e(s.g),i=e(s.b),r=t*.4124564+n*.3575761+i*.1804375,a=t*.2126729+n*.7151522+i*.072175,o=t*.0193339+n*.119192+i*.9503041;return new Or(r,a,o)}function xg(s,e=1){function t(a){return a<=.0031308?a*12.92:1.055*Math.pow(a,1/2.4)-.055}const n=t(s.x*3.2404542-s.y*1.5371385-s.z*.4985314),i=t(s.x*-.969266+s.y*1.8760108+s.z*.041556),r=t(s.x*.0556434-s.y*.2040259+s.z*1.0572252);return new pt(n,i,r,e)}function Ss(s){return BA(xu(s))}function Jo(s,e=1){return xg(wA(s),e)}function Lu(s){return KA(Ss(s))}function Lg(s,e=1){return Jo(LA(s),e)}function Hh(s,e,t=18){const n=Lu(s);let i=n.c+e*t;return i<0&&(i=0),Lg(new Yn(n.l,i,n.h))}function du(s,e){return s*e}function Gh(s,e){return new pt(du(s.r,e.r),du(s.g,e.g),du(s.b,e.b),1)}function hu(s,e){return s<.5?fi(2*e*s,0,1):fi(1-2*(1-e)*(1-s),0,1)}function zh(s,e){return new pt(hu(s.r,e.r),hu(s.g,e.g),hu(s.b,e.b),1)}var $h;(function(s){s[s.Burn=0]="Burn",s[s.Color=1]="Color",s[s.Darken=2]="Darken",s[s.Dodge=3]="Dodge",s[s.Lighten=4]="Lighten",s[s.Multiply=5]="Multiply",s[s.Overlay=6]="Overlay",s[s.Screen=7]="Screen"})($h||($h={}));function UA(s,e){if(e.a>=1)return e;if(e.a<=0)return new pt(s.r,s.g,s.b,1);const t=e.a*e.r+(1-e.a)*s.r,n=e.a*e.g+(1-e.a)*s.g,i=e.a*e.b+(1-e.a)*s.b;return new pt(t,n,i,1)}function wo(s,e,t){return isNaN(s)||s<=0?e:s>=1?t:new pt(dr(s,e.r,t.r),dr(s,e.g,t.g),dr(s,e.b,t.b),dr(s,e.a,t.a))}function FA(s,e,t){return isNaN(s)||s<=0?e:s>=1?t:new Vi(Ac(s,e.h,t.h),dr(s,e.s,t.s),dr(s,e.l,t.l))}function VA(s,e,t){return isNaN(s)||s<=0?e:s>=1?t:new ra(Ac(s,e.h,t.h),dr(s,e.s,t.s),dr(s,e.v,t.v))}function jA(s,e,t){return isNaN(s)||s<=0?e:s>=1?t:new Or(dr(s,e.x,t.x),dr(s,e.y,t.y),dr(s,e.z,t.z))}function WA(s,e,t){return isNaN(s)||s<=0?e:s>=1?t:new Zt(dr(s,e.l,t.l),dr(s,e.a,t.a),dr(s,e.b,t.b))}function HA(s,e,t){return isNaN(s)||s<=0?e:s>=1?t:new Yn(dr(s,e.l,t.l),dr(s,e.c,t.c),Ac(s,e.h,t.h))}var Lr;(function(s){s[s.RGB=0]="RGB",s[s.HSL=1]="HSL",s[s.HSV=2]="HSV",s[s.XYZ=3]="XYZ",s[s.LAB=4]="LAB",s[s.LCH=5]="LCH"})(Lr||(Lr={}));function Bo(s,e,t,n){if(isNaN(s)||s<=0)return t;if(s>=1)return n;switch(e){case Lr.HSL:return Es(FA(s,gn(t),gn(n)));case Lr.HSV:return xA(VA(s,Wh(t),Wh(n)));case Lr.XYZ:return xg(jA(s,xu(t),xu(n)));case Lr.LAB:return Jo(WA(s,Ss(t),Ss(n)));case Lr.LCH:return Lg(HA(s,Lu(t),Lu(n)));default:return wo(s,t,n)}}class Xr{constructor(e){if(e==null||e.length===0)throw new Error("The stops argument must be non-empty");this.stops=this.sortColorScaleStops(e)}static createBalancedColorScale(e){if(e==null||e.length===0)throw new Error("The colors argument must be non-empty");const t=new Array(e.length);for(let n=0;n<e.length;n++)n===0?t[n]={color:e[n],position:0}:n===e.length-1?t[n]={color:e[n],position:1}:t[n]={color:e[n],position:n*(1/(e.length-1))};return new Xr(t)}getColor(e,t=Lr.RGB){if(this.stops.length===1)return this.stops[0].color;if(e<=0)return this.stops[0].color;if(e>=1)return this.stops[this.stops.length-1].color;let n=0;for(let a=0;a<this.stops.length;a++)this.stops[a].position<=e&&(n=a);let i=n+1;i>=this.stops.length&&(i=this.stops.length-1);const r=(e-this.stops[n].position)*(1/(this.stops[i].position-this.stops[n].position));return Bo(r,t,this.stops[n].color,this.stops[i].color)}trim(e,t,n=Lr.RGB){if(e<0||t>1||t<e)throw new Error("Invalid bounds");if(e===t)return new Xr([{color:this.getColor(e,n),position:0}]);const i=[];for(let o=0;o<this.stops.length;o++)this.stops[o].position>=e&&this.stops[o].position<=t&&i.push(this.stops[o]);if(i.length===0)return new Xr([{color:this.getColor(e),position:e},{color:this.getColor(t),position:t}]);i[0].position!==e&&i.unshift({color:this.getColor(e),position:e}),i[i.length-1].position!==t&&i.push({color:this.getColor(t),position:t});const r=t-e,a=new Array(i.length);for(let o=0;o<i.length;o++)a[o]={color:i[o].color,position:(i[o].position-e)/r};return new Xr(a)}findNextColor(e,t,n=!1,i=Lr.RGB,r=.005,a=32){isNaN(e)||e<=0?e=0:e>=1&&(e=1);const o=this.getColor(e,i),l=n?0:1,u=this.getColor(l,i);if(jh(o,u)<=t)return l;let d=n?0:e,h=n?e:0,p=l,g=0;for(;g<=a;){p=Math.abs(h-d)/2+d;const f=this.getColor(p,i),m=jh(o,f);if(Math.abs(m-t)<=r)return p;m>t?n?d=p:h=p:n?h=p:d=p,g++}return p}clone(){const e=new Array(this.stops.length);for(let t=0;t<e.length;t++)e[t]={color:this.stops[t].color,position:this.stops[t].position};return new Xr(e)}sortColorScaleStops(e){return e.sort((t,n)=>{const i=t.position,r=n.position;return i<r?-1:i>r?1:0})}}const GA=/^#((?:[0-9a-f]{6}|[0-9a-f]{3}))$/i;function yi(s){const e=GA.exec(s);if(e===null)return null;let t=e[1];if(t.length===3){const i=t.charAt(0),r=t.charAt(1),a=t.charAt(2);t=i.concat(i,r,r,a,a)}const n=parseInt(t,16);return isNaN(n)?null:new pt(lu((n&16711680)>>>16,0,255),lu((n&65280)>>>8,0,255),lu(n&255,0,255),1)}class ji{constructor(e){this.config=Object.assign({},ji.defaultPaletteConfig,e),this.palette=[],this.updatePaletteColors()}updatePaletteGenerationValues(e){let t=!1;for(const n in e)this.config[n]&&(this.config[n].equalValue?this.config[n].equalValue(e[n])||(this.config[n]=e[n],t=!0):e[n]!==this.config[n]&&(this.config[n]=e[n],t=!0));return t&&this.updatePaletteColors(),t}updatePaletteColors(){const e=this.generatePaletteColorScale();for(let t=0;t<this.config.steps;t++)this.palette[t]=e.getColor(t/(this.config.steps-1),this.config.interpolationMode)}generatePaletteColorScale(){const e=gn(this.config.baseColor),n=new Xr([{position:0,color:this.config.scaleColorLight},{position:.5,color:this.config.baseColor},{position:1,color:this.config.scaleColorDark}]).trim(this.config.clipLight,1-this.config.clipDark),i=n.getColor(0),r=n.getColor(1);let a=i,o=r;if(e.s>=this.config.saturationAdjustmentCutoff&&(a=Hh(a,this.config.saturationLight),o=Hh(o,this.config.saturationDark)),this.config.multiplyLight!==0){const l=Gh(this.config.baseColor,a);a=Bo(this.config.multiplyLight,this.config.interpolationMode,a,l)}if(this.config.multiplyDark!==0){const l=Gh(this.config.baseColor,o);o=Bo(this.config.multiplyDark,this.config.interpolationMode,o,l)}if(this.config.overlayLight!==0){const l=zh(this.config.baseColor,a);a=Bo(this.config.overlayLight,this.config.interpolationMode,a,l)}if(this.config.overlayDark!==0){const l=zh(this.config.baseColor,o);o=Bo(this.config.overlayDark,this.config.interpolationMode,o,l)}return this.config.baseScalePosition?this.config.baseScalePosition<=0?new Xr([{position:0,color:this.config.baseColor},{position:1,color:o.clamp()}]):this.config.baseScalePosition>=1?new Xr([{position:0,color:a.clamp()},{position:1,color:this.config.baseColor}]):new Xr([{position:0,color:a.clamp()},{position:this.config.baseScalePosition,color:this.config.baseColor},{position:1,color:o.clamp()}]):new Xr([{position:0,color:a.clamp()},{position:.5,color:this.config.baseColor},{position:1,color:o.clamp()}])}}ji.defaultPaletteConfig={baseColor:yi("#808080"),steps:11,interpolationMode:Lr.RGB,scaleColorLight:new pt(1,1,1,1),scaleColorDark:new pt(0,0,0,1),clipLight:.185,clipDark:.16,saturationAdjustmentCutoff:.05,saturationLight:.35,saturationDark:1.25,overlayLight:0,overlayDark:.25,multiplyLight:0,multiplyDark:0,baseScalePosition:.5};ji.greyscalePaletteConfig={baseColor:yi("#808080"),steps:11,interpolationMode:Lr.RGB,scaleColorLight:new pt(1,1,1,1),scaleColorDark:new pt(0,0,0,1),clipLight:0,clipDark:0,saturationAdjustmentCutoff:0,saturationLight:0,saturationDark:0,overlayLight:0,overlayDark:0,multiplyLight:0,multiplyDark:0,baseScalePosition:.5};ji.defaultPaletteConfig.scaleColorLight,ji.defaultPaletteConfig.scaleColorDark;class zs{constructor(e){this.palette=[],this.config=Object.assign({},zs.defaultPaletteConfig,e),this.regenPalettes()}regenPalettes(){let e=this.config.steps;(isNaN(e)||e<3)&&(e=3);const t=.14,n=.06,i=new pt(t,t,t,1),r=94,o=new ji(Object.assign(Object.assign({},ji.greyscalePaletteConfig),{baseColor:i,baseScalePosition:(1-t)*100/r,steps:e})).palette,l=Mu(this.config.baseColor),u=gn(this.config.baseColor).l,c=(l+u)/2,h=this.matchRelativeLuminanceIndex(c,o)/(e-1),g=this.matchRelativeLuminanceIndex(t,o)/(e-1),f=gn(this.config.baseColor),m=Es(Vi.fromObject({h:f.h,s:f.s,l:t})),C=Es(Vi.fromObject({h:f.h,s:f.s,l:n})),_=new Array(5);_[0]={position:0,color:new pt(1,1,1,1)},_[1]={position:h,color:this.config.baseColor},_[2]={position:g,color:m},_[3]={position:.99,color:C},_[4]={position:1,color:new pt(0,0,0,1)};const y=new Xr(_);this.palette=new Array(e);for(let T=0;T<e;T++){const E=y.getColor(T/(e-1),Lr.RGB);this.palette[T]=E}}matchRelativeLuminanceIndex(e,t){let n=Number.MAX_VALUE,i=0,r=0;const a=t.length;for(;r<a;r++){const o=Math.abs(Mu(t[r])-e);o<n&&(n=o,i=r)}return i}}zs.defaultPaletteConfig={baseColor:yi("#808080"),steps:94};function Kg(s,e){const t=s.relativeLuminance>e.relativeLuminance?s:e,n=s.relativeLuminance>e.relativeLuminance?e:s;return(t.relativeLuminance+.05)/(n.relativeLuminance+.05)}const zi=Object.freeze({create(s,e,t){return new Yh(s,e,t)},from(s){return new Yh(s.r,s.g,s.b)}});function zA(s){const e={r:0,g:0,b:0,toColorString:()=>"",contrast:()=>0,relativeLuminance:0};for(const t in e)if(typeof e[t]!=typeof s[t])return!1;return!0}let Yh=class wg extends pt{constructor(e,t,n){super(e,t,n,1),this.toColorString=this.toStringHexRGB,this.contrast=Kg.bind(null,this),this.createCSS=this.toColorString,this.relativeLuminance=ia(this)}static fromObject(e){return new wg(e.r,e.g,e.b)}};function Ku(s,e,t=0,n=s.length-1){if(n===t)return s[t];const i=Math.floor((n-t)/2)+t;return e(s[i])?Ku(s,e,t,i):Ku(s,e,i+1,n)}const $A=(-.1+Math.sqrt(.21))/2;function YA(s){return s.relativeLuminance<=$A}function Sn(s){return YA(s)?-1:1}function XA(s,e,t){return typeof s=="number"?Os.from(zi.create(s,e,t)):Os.from(s)}function JA(s){return zA(s)?Xh.from(s):Xh.from(zi.create(s.r,s.g,s.b))}const Os=Object.freeze({create:XA,from:JA});let Xh=class Bg{constructor(e,t){this.closestIndexCache=new Map,this.source=e,this.swatches=t,this.reversedSwatches=Object.freeze([...this.swatches].reverse()),this.lastIndex=this.swatches.length-1}colorContrast(e,t,n,i){n===void 0&&(n=this.closestIndexOf(e));let r=this.swatches;const a=this.lastIndex;let o=n;i===void 0&&(i=Sn(e));const l=u=>Kg(e,u)>=t;return i===-1&&(r=this.reversedSwatches,o=a-o),Ku(r,l,o,a)}get(e){return this.swatches[e]||this.swatches[fi(e,0,this.lastIndex)]}closestIndexOf(e){if(this.closestIndexCache.has(e.relativeLuminance))return this.closestIndexCache.get(e.relativeLuminance);let t=this.swatches.indexOf(e);if(t!==-1)return this.closestIndexCache.set(e.relativeLuminance,t),t;const n=this.swatches.reduce((i,r)=>Math.abs(r.relativeLuminance-e.relativeLuminance)<Math.abs(i.relativeLuminance-e.relativeLuminance)?r:i);return t=this.swatches.indexOf(n),this.closestIndexCache.set(e.relativeLuminance,t),t}static from(e){return new Bg(e,Object.freeze(new zs({baseColor:pt.fromObject(e)}).palette.map(t=>{const n=yi(t.toStringHexRGB());return zi.create(n.r,n.g,n.b)})))}};function qA(s,e,t,n,i,r,a,o,l){const u=s.source,c=e.closestIndexOf(t),d=Math.max(a,o,l),h=c>=d?-1:1,g=s.closestIndexOf(u),f=g+h*-1*n,m=f+h*i,C=f+h*r;return{rest:s.get(f),hover:s.get(g),active:s.get(m),focus:s.get(C)}}function ZA(s,e,t,n,i,r,a){const o=s.source,l=s.closestIndexOf(o),u=Sn(e),c=l+(u===1?Math.min(n,i):Math.max(u*n,u*i)),d=s.colorContrast(e,t,c,u),h=s.closestIndexOf(d),p=h+u*Math.abs(n-i),g=u===1?n<i:u*n>u*i;let f,m;return g?(f=h,m=p):(f=p,m=h),{rest:s.get(f),hover:s.get(m),active:s.get(f+u*r),focus:s.get(f+u*a)}}const Jh=zi.create(1,1,1),QA=zi.create(0,0,0),eT=zi.from(yi("#808080")),tT=zi.from(yi("#DA1A5F"));function rT(s,e){return s.contrast(Jh)>=e?Jh:QA}function iT(s,e,t,n,i,r){const a=s.closestIndexOf(e),o=Math.max(t,n,i,r),l=a>=o?-1:1;return{rest:s.get(a+l*t),hover:s.get(a+l*n),active:s.get(a+l*i),focus:s.get(a+l*r)}}function nT(s,e,t,n,i,r){const a=Sn(e),o=s.closestIndexOf(e);return{rest:s.get(o-a*t),hover:s.get(o-a*n),active:s.get(o-a*i),focus:s.get(o-a*r)}}function oT(s,e,t){const n=s.closestIndexOf(e);return s.get(n-(n<t?t*-1:t))}function aT(s,e,t,n,i,r,a,o,l,u){const c=Math.max(t,n,i,r,a,o,l,u),d=s.closestIndexOf(e),h=d>=c?-1:1;return{rest:s.get(d+h*t),hover:s.get(d+h*n),active:s.get(d+h*i),focus:s.get(d+h*r)}}function sT(s,e,t,n,i,r){const a=Sn(e),o=s.closestIndexOf(s.colorContrast(e,4.5)),l=o+a*Math.abs(t-n),u=a===1?t<n:a*t>a*n;let c,d;return u?(c=o,d=l):(c=l,d=o),{rest:s.get(c),hover:s.get(d),active:s.get(c+a*i),focus:s.get(c+a*r)}}function lT(s,e){return s.colorContrast(e,3.5)}function uT(s,e,t){return s.colorContrast(t,3.5,s.closestIndexOf(s.source),Sn(e)*-1)}function cT(s,e){return s.colorContrast(e,14)}function dT(s,e){return s.colorContrast(e,4.5)}function $s(s){return zi.create(s,s,s)}const hT={LightMode:1,DarkMode:.23};function pT(s,e,t){return s.get(s.closestIndexOf($s(e))+t)}function gT(s,e,t){const n=s.closestIndexOf($s(e))-t;return s.get(n-t)}function fT(s,e){return s.get(s.closestIndexOf($s(e)))}function Tc(s,e,t,n,i,r){return Math.max(s.closestIndexOf($s(e))+t,n,i,r)}function mT(s,e,t,n,i,r){return s.get(Tc(s,e,t,n,i,r))}function CT(s,e,t,n,i,r){return s.get(Tc(s,e,t,n,i,r)+t)}function _T(s,e,t,n,i,r){return s.get(Tc(s,e,t,n,i,r)+t*2)}function yT(s,e,t,n,i,r){const a=s.closestIndexOf(e),o=Sn(e),l=a+o*t,u=l+o*(n-t),c=l+o*(i-t),d=l+o*(r-t);return{rest:s.get(l),hover:s.get(u),active:s.get(c),focus:s.get(d)}}function AT(s,e,t){return s.get(s.closestIndexOf(e)+Sn(e)*t)}const{create:Se}=Lt;function $e(s){return Lt.create({name:s,cssCustomPropertyName:null})}const TT=Se("body-font").withDefault('aktiv-grotesk, "Segoe UI", Arial, Helvetica, sans-serif'),Ug=Se("base-height-multiplier").withDefault(10),$0=Se("base-horizontal-spacing-multiplier").withDefault(3),io=Se("base-layer-luminance").withDefault(hT.DarkMode),Fg=Se("control-corner-radius").withDefault(4),Ec=Se("density").withDefault(0),Sc=Se("design-unit").withDefault(4),Y0=Se("direction").withDefault(Di.ltr),ET=Se("disabled-opacity").withDefault(.3),Ai=Se("stroke-width").withDefault(1),ri=Se("focus-stroke-width").withDefault(2),ST=Se("type-ramp-base-font-size").withDefault("14px"),OT=Se("type-ramp-base-line-height").withDefault("20px"),X0=Se("type-ramp-minus-1-font-size").withDefault("12px"),J0=Se("type-ramp-minus-1-line-height").withDefault("16px"),q0=Se("type-ramp-minus-2-font-size").withDefault("10px"),Z0=Se("type-ramp-minus-2-line-height").withDefault("16px"),Q0=Se("type-ramp-plus-1-font-size").withDefault("16px"),eD=Se("type-ramp-plus-1-line-height").withDefault("24px"),tD=Se("type-ramp-plus-2-font-size").withDefault("20px"),rD=Se("type-ramp-plus-2-line-height").withDefault("28px"),iD=Se("type-ramp-plus-3-font-size").withDefault("28px"),nD=Se("type-ramp-plus-3-line-height").withDefault("36px"),oD=Se("type-ramp-plus-4-font-size").withDefault("34px"),aD=Se("type-ramp-plus-4-line-height").withDefault("44px"),sD=Se("type-ramp-plus-5-font-size").withDefault("46px"),lD=Se("type-ramp-plus-5-line-height").withDefault("56px"),uD=Se("type-ramp-plus-6-font-size").withDefault("60px"),cD=Se("type-ramp-plus-6-line-height").withDefault("72px"),dD=$e("accent-fill-rest-delta").withDefault(0),bT=$e("accent-fill-hover-delta").withDefault(4),vT=$e("accent-fill-active-delta").withDefault(-5),kT=$e("accent-fill-focus-delta").withDefault(0),IT=$e("accent-foreground-rest-delta").withDefault(0),DT=$e("accent-foreground-hover-delta").withDefault(6),RT=$e("accent-foreground-active-delta").withDefault(-4),PT=$e("accent-foreground-focus-delta").withDefault(0),no=$e("neutral-fill-rest-delta").withDefault(7),oo=$e("neutral-fill-hover-delta").withDefault(10),ao=$e("neutral-fill-active-delta").withDefault(5),Vg=$e("neutral-fill-focus-delta").withDefault(0),NT=$e("neutral-fill-input-rest-delta").withDefault(0),MT=$e("neutral-fill-input-hover-delta").withDefault(0),xT=$e("neutral-fill-input-active-delta").withDefault(0),LT=$e("neutral-fill-input-focus-delta").withDefault(0),KT=$e("neutral-fill-stealth-rest-delta").withDefault(0),wT=$e("neutral-fill-stealth-hover-delta").withDefault(5),BT=$e("neutral-fill-stealth-active-delta").withDefault(3),UT=$e("neutral-fill-stealth-focus-delta").withDefault(0),FT=$e("neutral-fill-strong-rest-delta").withDefault(0),VT=$e("neutral-fill-strong-hover-delta").withDefault(8),jT=$e("neutral-fill-strong-active-delta").withDefault(-5),WT=$e("neutral-fill-strong-focus-delta").withDefault(0),so=$e("neutral-fill-layer-rest-delta").withDefault(3),HT=$e("neutral-stroke-rest-delta").withDefault(25),GT=$e("neutral-stroke-hover-delta").withDefault(40),zT=$e("neutral-stroke-active-delta").withDefault(16),$T=$e("neutral-stroke-focus-delta").withDefault(25),YT=$e("neutral-stroke-divider-rest-delta").withDefault(8),XT=Se("neutral-color").withDefault(eT),cr=$e("neutral-palette").withDefault(s=>Os.from(XT.getValueFor(s))),JT=Se("accent-color").withDefault(tT),Oc=$e("accent-palette").withDefault(s=>Os.from(JT.getValueFor(s))),qT=$e("neutral-layer-card-container-recipe").withDefault({evaluate:s=>pT(cr.getValueFor(s),io.getValueFor(s),so.getValueFor(s))});Se("neutral-layer-card-container").withDefault(s=>qT.getValueFor(s).evaluate(s));const ZT=$e("neutral-layer-floating-recipe").withDefault({evaluate:s=>gT(cr.getValueFor(s),io.getValueFor(s),so.getValueFor(s))}),hD=Se("neutral-layer-floating").withDefault(s=>ZT.getValueFor(s).evaluate(s)),QT=$e("neutral-layer-1-recipe").withDefault({evaluate:s=>fT(cr.getValueFor(s),io.getValueFor(s))}),eE=Se("neutral-layer-1").withDefault(s=>QT.getValueFor(s).evaluate(s)),tE=$e("neutral-layer-2-recipe").withDefault({evaluate:s=>mT(cr.getValueFor(s),io.getValueFor(s),so.getValueFor(s),no.getValueFor(s),oo.getValueFor(s),ao.getValueFor(s))});Se("neutral-layer-2").withDefault(s=>tE.getValueFor(s).evaluate(s));const rE=$e("neutral-layer-3-recipe").withDefault({evaluate:s=>CT(cr.getValueFor(s),io.getValueFor(s),so.getValueFor(s),no.getValueFor(s),oo.getValueFor(s),ao.getValueFor(s))});Se("neutral-layer-3").withDefault(s=>rE.getValueFor(s).evaluate(s));const iE=$e("neutral-layer-4-recipe").withDefault({evaluate:s=>_T(cr.getValueFor(s),io.getValueFor(s),so.getValueFor(s),no.getValueFor(s),oo.getValueFor(s),ao.getValueFor(s))});Se("neutral-layer-4").withDefault(s=>iE.getValueFor(s).evaluate(s));const hr=Se("fill-color").withDefault(s=>eE.getValueFor(s));var na;(function(s){s[s.normal=4.5]="normal",s[s.large=7]="large"})(na||(na={}));const Ys=Se({name:"accent-fill-recipe",cssCustomPropertyName:null}).withDefault({evaluate:(s,e)=>qA(Oc.getValueFor(s),cr.getValueFor(s),e||hr.getValueFor(s),bT.getValueFor(s),vT.getValueFor(s),kT.getValueFor(s),no.getValueFor(s),oo.getValueFor(s),ao.getValueFor(s))}),fn=Se("accent-fill-rest").withDefault(s=>Ys.getValueFor(s).evaluate(s).rest),Xs=Se("accent-fill-hover").withDefault(s=>Ys.getValueFor(s).evaluate(s).hover),Js=Se("accent-fill-active").withDefault(s=>Ys.getValueFor(s).evaluate(s).active),jg=Se("accent-fill-focus").withDefault(s=>Ys.getValueFor(s).evaluate(s).focus),Wg=s=>(e,t)=>rT(t||fn.getValueFor(e),s),qs=$e("foreground-on-accent-recipe").withDefault({evaluate:(s,e)=>Wg(na.normal)(s,e)}),nE=Se("foreground-on-accent-rest").withDefault(s=>qs.getValueFor(s).evaluate(s,fn.getValueFor(s))),oE=Se("foreground-on-accent-hover").withDefault(s=>qs.getValueFor(s).evaluate(s,Xs.getValueFor(s))),aE=Se("foreground-on-accent-active").withDefault(s=>qs.getValueFor(s).evaluate(s,Js.getValueFor(s))),pD=Se("foreground-on-accent-focus").withDefault(s=>qs.getValueFor(s).evaluate(s,jg.getValueFor(s))),Zs=$e("foreground-on-accent-large-recipe").withDefault({evaluate:(s,e)=>Wg(na.large)(s,e)});Se("foreground-on-accent-rest-large").withDefault(s=>Zs.getValueFor(s).evaluate(s,fn.getValueFor(s)));Se("foreground-on-accent-hover-large").withDefault(s=>Zs.getValueFor(s).evaluate(s,Xs.getValueFor(s)));Se("foreground-on-accent-active-large").withDefault(s=>Zs.getValueFor(s).evaluate(s,Js.getValueFor(s)));Se("foreground-on-accent-focus-large").withDefault(s=>Zs.getValueFor(s).evaluate(s,jg.getValueFor(s)));const sE=s=>(e,t)=>ZA(Oc.getValueFor(e),t||hr.getValueFor(e),s,IT.getValueFor(e),DT.getValueFor(e),RT.getValueFor(e),PT.getValueFor(e)),Qs=Se({name:"accent-foreground-recipe",cssCustomPropertyName:null}).withDefault({evaluate:(s,e)=>sE(na.normal)(s,e)}),bs=Se("accent-foreground-rest").withDefault(s=>Qs.getValueFor(s).evaluate(s).rest),wu=Se("accent-foreground-hover").withDefault(s=>Qs.getValueFor(s).evaluate(s).hover),Bu=Se("accent-foreground-active").withDefault(s=>Qs.getValueFor(s).evaluate(s).active);Se("accent-foreground-focus").withDefault(s=>Qs.getValueFor(s).evaluate(s).focus);const el=Se({name:"neutral-fill-recipe",cssCustomPropertyName:null}).withDefault({evaluate:(s,e)=>iT(cr.getValueFor(s),e||hr.getValueFor(s),no.getValueFor(s),oo.getValueFor(s),ao.getValueFor(s),Vg.getValueFor(s))}),Hg=Se("neutral-fill-rest").withDefault(s=>el.getValueFor(s).evaluate(s).rest),lE=Se("neutral-fill-hover").withDefault(s=>el.getValueFor(s).evaluate(s).hover),uE=Se("neutral-fill-active").withDefault(s=>el.getValueFor(s).evaluate(s).active);Se("neutral-fill-focus").withDefault(s=>el.getValueFor(s).evaluate(s).focus);const tl=Se({name:"neutral-fill-input-recipe",cssCustomPropertyName:null}).withDefault({evaluate:(s,e)=>nT(cr.getValueFor(s),e||hr.getValueFor(s),NT.getValueFor(s),MT.getValueFor(s),xT.getValueFor(s),LT.getValueFor(s))}),gD=Se("neutral-fill-input-rest").withDefault(s=>tl.getValueFor(s).evaluate(s).rest),fD=Se("neutral-fill-input-hover").withDefault(s=>tl.getValueFor(s).evaluate(s).hover),mD=Se("neutral-fill-input-active").withDefault(s=>tl.getValueFor(s).evaluate(s).active);Se("neutral-fill-input-focus").withDefault(s=>tl.getValueFor(s).evaluate(s).focus);const rl=Se({name:"neutral-fill-stealth-recipe",cssCustomPropertyName:null}).withDefault({evaluate:(s,e)=>aT(cr.getValueFor(s),e||hr.getValueFor(s),KT.getValueFor(s),wT.getValueFor(s),BT.getValueFor(s),UT.getValueFor(s),no.getValueFor(s),oo.getValueFor(s),ao.getValueFor(s),Vg.getValueFor(s))}),Gg=Se("neutral-fill-stealth-rest").withDefault(s=>rl.getValueFor(s).evaluate(s).rest),cE=Se("neutral-fill-stealth-hover").withDefault(s=>rl.getValueFor(s).evaluate(s).hover),dE=Se("neutral-fill-stealth-active").withDefault(s=>rl.getValueFor(s).evaluate(s).active),CD=Se("neutral-fill-stealth-focus").withDefault(s=>rl.getValueFor(s).evaluate(s).focus),il=Se({name:"neutral-fill-strong-recipe",cssCustomPropertyName:null}).withDefault({evaluate:(s,e)=>sT(cr.getValueFor(s),e||hr.getValueFor(s),FT.getValueFor(s),VT.getValueFor(s),jT.getValueFor(s),WT.getValueFor(s))});Se("neutral-fill-strong-rest").withDefault(s=>il.getValueFor(s).evaluate(s).rest);Se("neutral-fill-strong-hover").withDefault(s=>il.getValueFor(s).evaluate(s).hover);Se("neutral-fill-strong-active").withDefault(s=>il.getValueFor(s).evaluate(s).active);Se("neutral-fill-strong-focus").withDefault(s=>il.getValueFor(s).evaluate(s).focus);const zg=$e("neutral-fill-layer-recipe").withDefault({evaluate:(s,e)=>oT(cr.getValueFor(s),e||hr.getValueFor(s),so.getValueFor(s))});Se("neutral-fill-layer-rest").withDefault(s=>zg.getValueFor(s).evaluate(s));const hE=$e("focus-stroke-outer-recipe").withDefault({evaluate:s=>lT(cr.getValueFor(s),hr.getValueFor(s))}),mn=Se("focus-stroke-outer").withDefault(s=>hE.getValueFor(s).evaluate(s)),pE=$e("focus-stroke-inner-recipe").withDefault({evaluate:s=>uT(Oc.getValueFor(s),hr.getValueFor(s),mn.getValueFor(s))}),gE=Se("focus-stroke-inner").withDefault(s=>pE.getValueFor(s).evaluate(s)),fE=$e("neutral-foreground-hint-recipe").withDefault({evaluate:s=>dT(cr.getValueFor(s),hr.getValueFor(s))}),_D=Se("neutral-foreground-hint").withDefault(s=>fE.getValueFor(s).evaluate(s)),mE=$e("neutral-foreground-recipe").withDefault({evaluate:s=>cT(cr.getValueFor(s),hr.getValueFor(s))}),$g=Se("neutral-foreground-rest").withDefault(s=>mE.getValueFor(s).evaluate(s)),nl=Se({name:"neutral-stroke-recipe",cssCustomPropertyName:null}).withDefault({evaluate:s=>yT(cr.getValueFor(s),hr.getValueFor(s),HT.getValueFor(s),GT.getValueFor(s),zT.getValueFor(s),$T.getValueFor(s))}),yD=Se("neutral-stroke-rest").withDefault(s=>nl.getValueFor(s).evaluate(s).rest),AD=Se("neutral-stroke-hover").withDefault(s=>nl.getValueFor(s).evaluate(s).hover),TD=Se("neutral-stroke-active").withDefault(s=>nl.getValueFor(s).evaluate(s).active),ED=Se("neutral-stroke-focus").withDefault(s=>nl.getValueFor(s).evaluate(s).focus),CE=$e("neutral-stroke-divider-recipe").withDefault({evaluate:(s,e)=>AT(cr.getValueFor(s),e||hr.getValueFor(s),YT.getValueFor(s))}),SD=Se("neutral-stroke-divider-rest").withDefault(s=>CE.getValueFor(s).evaluate(s)),OD=Lt.create({name:"height-number",cssCustomPropertyName:null}).withDefault(s=>(Ug.getValueFor(s)+Ec.getValueFor(s))*Sc.getValueFor(s)),qh=ni`(${Ug} + ${Ec}) * ${Sc}`,_E="0 0 calc((var(--elevation) * 0.225px) + 2px) rgba(0, 0, 0, calc(.11 * (2 - var(--background-luminance, 1))))",yE="0 calc(var(--elevation) * 0.4px) calc((var(--elevation) * 0.9px)) rgba(0, 0, 0, calc(.13 * (2 - var(--background-luminance, 1))))",AE=`box-shadow: ${_E}, ${yE};`,TE=De`
    ${ro("inline-flex")} :host {
        font-family: ${TT};
        outline: none;
        font-size: ${ST};
        line-height: ${OT};
        height: calc(${qh} * 1px);
        min-width: calc(${qh} * 1px);
        background-color: ${Hg};
        color: ${$g};
        border-radius: calc(${Fg} * 1px);
        fill: currentcolor;
        cursor: pointer;
    }

    .control {
        background: transparent;
        height: inherit;
        flex-grow: 1;
        box-sizing: border-box;
        display: inline-flex;
        justify-content: center;
        align-items: baseline;
        padding: 0 calc((10 + (${Sc} * 2 * ${Ec})) * 1px);
        white-space: nowrap;
        outline: none;
        text-decoration: none;
        border: calc(${Ai} * 1px) solid transparent;
        color: inherit;
        border-radius: inherit;
        fill: inherit;
        cursor: inherit;
        font-weight: inherit;
        font-family: inherit;
        font-size: inherit;
        line-height: inherit;
    }

    :host(:hover) {
        background-color: ${lE};
    }

    :host(:active) {
        background-color: ${uE};
    }

    .control:${Je} {
        border-color: ${mn};
        box-shadow: 0 0 0 calc((${ri} - ${Ai}) * 1px) ${mn} inset;
    }

    .control::-moz-focus-inner {
        border: 0;
    }

    .start,
    .content,
    .end {
        align-self: center;
    }

    .start,
    .end {
        display: flex;
    }

    .control.icon-only {
        padding: 0;
        line-height: 0;
    }

    ::slotted(svg) {
        ${""} width: 16px;
        height: 16px;
        pointer-events: none;
    }

    .start {
        margin-inline-end: 11px;
    }

    .end {
        margin-inline-start: 11px;
    }
`.withBehaviors(kt(De`
            :host .control {
              background-color: ${te.ButtonFace};
              border-color: ${te.ButtonText};
              color: ${te.ButtonText};
              fill: currentColor;
            }

            :host(:hover) .control {
              forced-color-adjust: none;
              background-color: ${te.Highlight};
              color: ${te.HighlightText};
            }

            .control:${Je} {
              forced-color-adjust: none;
              background-color: ${te.Highlight};
              border-color: ${te.ButtonText};
              box-shadow: 0 0 0 calc((${ri} - ${Ai}) * 1px) ${te.ButtonText} inset;
              color: ${te.HighlightText};
            }

            .control:hover,
            :host([appearance="outline"]) .control:hover {
              border-color: ${te.ButtonText};
            }

            :host([href]) .control {
                border-color: ${te.LinkText};
                color: ${te.LinkText};
            }

            :host([href]) .control:hover,
            :host([href]) .control:${Je}{
              forced-color-adjust: none;
              background: ${te.ButtonFace};
              border-color: ${te.LinkText};
              box-shadow: 0 0 0 1px ${te.LinkText} inset;
              color: ${te.LinkText};
              fill: currentColor;
            }
        `)),EE=De`
    :host([appearance="accent"]) {
        background: ${fn};
        color: ${nE};
    }

    :host([appearance="accent"]:hover) {
        background: ${Xs};
        color: ${oE};
    }

    :host([appearance="accent"]:active) .control:active {
        background: ${Js};
        color: ${aE};
    }

    :host([appearance="accent"]) .control:${Je} {
        box-shadow: 0 0 0 calc((${ri} - ${Ai}) * 1px) ${mn} inset,
            0 0 0 calc((${ri} + ${Ai}) * 1px) ${gE} inset;
    }
`.withBehaviors(kt(De`
            :host([appearance="accent"]) .control {
                forced-color-adjust: none;
                background: ${te.Highlight};
                color: ${te.HighlightText};
            }

            :host([appearance="accent"]) .control:hover,
            :host([appearance="accent"]:active) .control:active {
                background: ${te.HighlightText};
                border-color: ${te.Highlight};
                color: ${te.Highlight};
            }

            :host([appearance="accent"]) .control:${Je} {
                border-color: ${te.Highlight};
                box-shadow: 0 0 0 calc(${ri} * 1px) ${te.HighlightText} inset;
            }

            :host([appearance="accent"][href]) .control{
                background: ${te.LinkText};
                color: ${te.HighlightText};
            }

            :host([appearance="accent"][href]) .control:hover {
                background: ${te.ButtonFace};
                border-color: ${te.LinkText};
                box-shadow: none;
                color: ${te.LinkText};
                fill: currentColor;
            }

            :host([appearance="accent"][href]) .control:${Je} {
                border-color: ${te.LinkText};
                box-shadow: 0 0 0 calc(${ri} * 1px) ${te.HighlightText} inset;
            }
        `)),bD=De`
    :host([appearance="hypertext"]) {
        font-size: inherit;
        line-height: inherit;
        height: auto;
        min-width: 0;
        background: transparent;
    }

    :host([appearance="hypertext"]) .control {
        display: inline;
        padding: 0;
        border: none;
        box-shadow: none;
        border-radius: 0;
        line-height: 1;
    }

    :host a.control:not(:link) {
        background-color: transparent;
        cursor: default;
    }
    :host([appearance="hypertext"]) .control:link,
    :host([appearance="hypertext"]) .control:visited {
        background: transparent;
        color: ${bs};
        border-bottom: calc(${Ai} * 1px) solid ${bs};
    }

    :host([appearance="hypertext"]:hover),
    :host([appearance="hypertext"]) .control:hover {
        background: transparent;
        border-bottom-color: ${wu};
    }

    :host([appearance="hypertext"]:active),
    :host([appearance="hypertext"]) .control:active {
        background: transparent;
        border-bottom-color: ${Bu};
    }

    :host([appearance="hypertext"]) .control:${Je} {
        border-bottom: calc(${ri} * 1px) solid ${mn};
        margin-bottom: calc(calc(${Ai} - ${ri}) * 1px);
    }
`.withBehaviors(kt(De`
            :host([appearance="hypertext"]:hover) {
                background-color: ${te.ButtonFace};
                color: ${te.ButtonText};
            }
            :host([appearance="hypertext"][href]) .control:hover,
            :host([appearance="hypertext"][href]) .control:active,
            :host([appearance="hypertext"][href]) .control:${Je} {
                color: ${te.LinkText};
                border-bottom-color: ${te.LinkText};
                box-shadow: none;
            }
        `)),SE=De`
    :host([appearance="lightweight"]) {
        background: transparent;
        color: ${bs};
    }

    :host([appearance="lightweight"]) .control {
        padding: 0;
        height: initial;
        border: none;
        box-shadow: none;
        border-radius: 0;
    }

    :host([appearance="lightweight"]:hover) {
        background: transparent;
        color: ${wu};
    }

    :host([appearance="lightweight"]:active) {
        background: transparent;
        color: ${Bu};
    }

    :host([appearance="lightweight"]) .content {
        position: relative;
    }

    :host([appearance="lightweight"]) .content::before {
        content: "";
        display: block;
        height: calc(${Ai} * 1px);
        position: absolute;
        top: calc(1em + 4px);
        width: 100%;
    }

    :host([appearance="lightweight"]:hover) .content::before {
        background: ${wu};
    }

    :host([appearance="lightweight"]:active) .content::before {
        background: ${Bu};
    }

    :host([appearance="lightweight"]) .control:${Je} .content::before {
        background: ${$g};
        height: calc(${ri} * 1px);
    }
`.withBehaviors(kt(De`
            :host([appearance="lightweight"]) .control:hover,
            :host([appearance="lightweight"]) .control:${Je} {
                forced-color-adjust: none;
                background: ${te.ButtonFace};
                color: ${te.Highlight};
            }
            :host([appearance="lightweight"]) .control:hover .content::before,
            :host([appearance="lightweight"]) .control:${Je} .content::before {
                background: ${te.Highlight};
            }

            :host([appearance="lightweight"][href]) .control:hover,
            :host([appearance="lightweight"][href]) .control:${Je} {
                background: ${te.ButtonFace};
                box-shadow: none;
                color: ${te.LinkText};
            }

            :host([appearance="lightweight"][href]) .control:hover .content::before,
            :host([appearance="lightweight"][href]) .control:${Je} .content::before {
                background: ${te.LinkText};
            }
        `)),OE=De`
    :host([appearance="outline"]) {
        background: transparent;
        border-color: ${fn};
    }

    :host([appearance="outline"]:hover) {
        border-color: ${Xs};
    }

    :host([appearance="outline"]:active) {
        border-color: ${Js};
    }

    :host([appearance="outline"]) .control {
        border-color: inherit;
    }

    :host([appearance="outline"]) .control:${Je} {
        box-shadow: 0 0 0 calc((${ri} - ${Ai}) * 1px) ${mn} inset;
        border-color: ${mn};
    }
`.withBehaviors(kt(De`
            :host([appearance="outline"]) .control {
                border-color: ${te.ButtonText};
            }
            :host([appearance="outline"]) .control:${Je} {
              forced-color-adjust: none;
              background-color: ${te.Highlight};
              border-color: ${te.ButtonText};
              box-shadow: 0 0 0 calc((${ri} - ${Ai}) * 1px) ${te.ButtonText} inset;
              color: ${te.HighlightText};
              fill: currentColor;
            }
            :host([appearance="outline"][href]) .control {
                background: ${te.ButtonFace};
                border-color: ${te.LinkText};
                color: ${te.LinkText};
                fill: currentColor;
            }
            :host([appearance="outline"][href]) .control:hover,
            :host([appearance="outline"][href]) .control:${Je} {
              forced-color-adjust: none;
              border-color: ${te.LinkText};
              box-shadow: 0 0 0 1px ${te.LinkText} inset;
            }
        `)),bE=De`
    :host([appearance="stealth"]) {
        background: ${Gg};
    }

    :host([appearance="stealth"]:hover) {
        background: ${cE};
    }

    :host([appearance="stealth"]:active) {
        background: ${dE};
    }
`.withBehaviors(kt(De`
            :host([appearance="stealth"]),
            :host([appearance="stealth"]) .control {
                forced-color-adjust: none;
                background: ${te.ButtonFace};
                border-color: transparent;
                color: ${te.ButtonText};
                fill: currentColor;
            }

            :host([appearance="stealth"]:hover) .control {
                background: ${te.Highlight};
                border-color: ${te.Highlight};
                color: ${te.HighlightText};
                fill: currentColor;
            }

            :host([appearance="stealth"]:${Je}) .control {
                background: ${te.Highlight};
                box-shadow: 0 0 0 1px ${te.Highlight};
                color: ${te.HighlightText};
                fill: currentColor;
            }

            :host([appearance="stealth"][href]) .control {
                color: ${te.LinkText};
            }

            :host([appearance="stealth"][href]:hover) .control,
            :host([appearance="stealth"][href]:${Je}) .control {
                background: ${te.LinkText};
                border-color: ${te.LinkText};
                color: ${te.HighlightText};
                fill: currentColor;
            }

            :host([appearance="stealth"][href]:${Je}) .control {
                forced-color-adjust: none;
                box-shadow: 0 0 0 1px ${te.LinkText};
            }
        `));function Xa(s,e){return new Mg("appearance",s,e)}const vE=(s,e)=>De`
        :host([disabled]),
        :host([disabled]:hover),
        :host([disabled]:active) {
            opacity: ${ET};
            background-color: ${Hg};
            cursor: ${ta};
        }

        ${TE}
    `.withBehaviors(kt(De`
                :host([disabled]),
                :host([disabled]) .control,
                :host([disabled]:hover),
                :host([disabled]:active) {
                    forced-color-adjust: none;
                    background-color: ${te.ButtonFace};
                    border-color: ${te.GrayText};
                    color: ${te.GrayText};
                    cursor: ${ta};
                    opacity: 1;
                }
            `),Xa("accent",De`
                :host([appearance="accent"][disabled]),
                :host([appearance="accent"][disabled]:hover),
                :host([appearance="accent"][disabled]:active) {
                    background: ${fn};
                }

                ${EE}
            `.withBehaviors(kt(De`
                        :host([appearance="accent"][disabled]) .control,
                        :host([appearance="accent"][disabled]) .control:hover {
                            background: ${te.ButtonFace};
                            border-color: ${te.GrayText};
                            color: ${te.GrayText};
                        }
                    `))),Xa("lightweight",De`
                :host([appearance="lightweight"][disabled]:hover),
                :host([appearance="lightweight"][disabled]:active) {
                    background-color: transparent;
                    color: ${bs};
                }

                :host([appearance="lightweight"][disabled]) .content::before,
                :host([appearance="lightweight"][disabled]:hover) .content::before,
                :host([appearance="lightweight"][disabled]:active) .content::before {
                    background: transparent;
                }

                ${SE}
            `.withBehaviors(kt(De`
                        :host([appearance="lightweight"].disabled) .control {
                            forced-color-adjust: none;
                            color: ${te.GrayText};
                        }

                        :host([appearance="lightweight"].disabled)
                            .control:hover
                            .content::before {
                            background: none;
                        }
                    `))),Xa("outline",De`
                :host([appearance="outline"][disabled]),
                :host([appearance="outline"][disabled]:hover),
                :host([appearance="outline"][disabled]:active) {
                    background: transparent;
                    border-color: ${fn};
                }

                ${OE}
            `.withBehaviors(kt(De`
                        :host([appearance="outline"][disabled]) .control {
                            border-color: ${te.GrayText};
                        }
                    `))),Xa("stealth",De`
                :host([appearance="stealth"][disabled]),
                :host([appearance="stealth"][disabled]:hover),
                :host([appearance="stealth"][disabled]:active) {
                    background: ${Gg};
                }

                ${bE}
            `.withBehaviors(kt(De`
                        :host([appearance="stealth"][disabled]) {
                            background: ${te.ButtonFace};
                        }

                        :host([appearance="stealth"][disabled]) .control {
                            background: ${te.ButtonFace};
                            border-color: transparent;
                            color: ${te.GrayText};
                        }
                    `))));let Yg=class extends br{constructor(){super(...arguments),this.appearance="neutral"}defaultSlottedContentChanged(e,t){const n=this.defaultSlottedContent.filter(i=>i.nodeType===Node.ELEMENT_NODE);n.length===1&&n[0]instanceof SVGElement?this.control.classList.add("icon-only"):this.control.classList.remove("icon-only")}};ge([Ee],Yg.prototype,"appearance",void 0);const kE=Yg.compose({baseName:"button",baseClass:br,template:mc,styles:vE,shadowOptions:{delegatesFocus:!0}}),IE=(s,e)=>De`
        ${ro("block")} :host {
            --elevation: 4;
            display: block;
            contain: content;
            height: var(--card-height, 100%);
            width: var(--card-width, 100%);
            box-sizing: border-box;
            background: ${hr};
            border-radius: calc(${Fg} * 1px);
            ${AE}
        }
    `.withBehaviors(kt(De`
                :host {
                    forced-color-adjust: none;
                    background: ${te.Canvas};
                    box-shadow: 0 0 0 1px ${te.CanvasText};
                }
            `));class DE extends vg{connectedCallback(){super.connectedCallback();const e=As(this);e&&hr.setValueFor(this,t=>zg.getValueFor(t).evaluate(t,hr.getValueFor(e)))}}const RE=DE.compose({baseName:"card",baseClass:vg,template:zy,styles:IE});function PE(s){return _c.getOrCreate(s).withPrefix("fast")}function vs(s,e){const t=s.relativeLuminance>e.relativeLuminance?s:e,n=s.relativeLuminance>e.relativeLuminance?e:s;return(t.relativeLuminance+.05)/(n.relativeLuminance+.05)}const Ri=Object.freeze({create(s,e,t){return new ks(s,e,t)},from(s){return new ks(s.r,s.g,s.b)}});function NE(s){const e={r:0,g:0,b:0,toColorString:()=>"",contrast:()=>0,relativeLuminance:0};for(const t in e)if(typeof e[t]!=typeof s[t])return!1;return!0}class ks extends pt{constructor(e,t,n){super(e,t,n,1),this.toColorString=this.toStringHexRGB,this.contrast=vs.bind(null,this),this.createCSS=this.toColorString,this.relativeLuminance=ia(this)}static fromObject(e){return new ks(e.r,e.g,e.b)}}function Uu(s,e,t=0,n=s.length-1){if(n===t)return s[t];const i=Math.floor((n-t)/2)+t;return e(s[i])?Uu(s,e,t,i):Uu(s,e,i+1,n)}const ME=(-.1+Math.sqrt(.21))/2;function ma(s){return s.relativeLuminance<=ME}function On(s){return ma(s)?-1:1}const Zh={stepContrast:1.03,stepContrastRamp:.03,preserveSource:!1};function xE(s,e,t){return typeof s=="number"?Is.from(Ri.create(s,e,t)):Is.from(s)}function LE(s,e){return NE(s)?gi.from(s,e):gi.from(Ri.create(s.r,s.g,s.b),e)}const Is=Object.freeze({create:xE,from:LE});class gi{constructor(e,t){this.closestIndexCache=new Map,this.source=e,this.swatches=t,this.reversedSwatches=Object.freeze([...this.swatches].reverse()),this.lastIndex=this.swatches.length-1}colorContrast(e,t,n,i){n===void 0&&(n=this.closestIndexOf(e));let r=this.swatches;const a=this.lastIndex;let o=n;i===void 0&&(i=On(e));const l=u=>vs(e,u)>=t;return i===-1&&(r=this.reversedSwatches,o=a-o),Uu(r,l,o,a)}get(e){return this.swatches[e]||this.swatches[fi(e,0,this.lastIndex)]}closestIndexOf(e){if(this.closestIndexCache.has(e.relativeLuminance))return this.closestIndexCache.get(e.relativeLuminance);let t=this.swatches.indexOf(e);if(t!==-1)return this.closestIndexCache.set(e.relativeLuminance,t),t;const n=this.swatches.reduce((i,r)=>Math.abs(r.relativeLuminance-e.relativeLuminance)<Math.abs(i.relativeLuminance-e.relativeLuminance)?r:i);return t=this.swatches.indexOf(n),this.closestIndexCache.set(e.relativeLuminance,t),t}static saturationBump(e,t){const i=gn(e).s,r=gn(t);if(r.s<i){const a=new Vi(r.h,i,r.l);return Es(a)}return t}static ramp(e){const t=e/100;return t>.5?(t-.5)/.5:2*t}static createHighResolutionPalette(e){const t=[],n=Ss(pt.fromObject(e).roundToPrecision(4)),i=Jo(new Zt(0,n.a,n.b)).clamp().roundToPrecision(4),r=Jo(new Zt(50,n.a,n.b)).clamp().roundToPrecision(4),a=Jo(new Zt(100,n.a,n.b)).clamp().roundToPrecision(4),o=new pt(0,0,0),l=new pt(1,1,1),u=a.equalValue(l)?0:14,c=i.equalValue(o)?0:14;for(let d=100+u;d>=0-c;d-=.5){let h;if(d<0){const p=d/c+1;h=wo(p,o,i)}else if(d<=50)h=wo(gi.ramp(d),i,r);else if(d<=100)h=wo(gi.ramp(d),r,a);else{const p=(d-100)/u;h=wo(p,a,l)}h=gi.saturationBump(r,h).roundToPrecision(4),t.push(Ri.from(h))}return new gi(e,t)}static adjustEnd(e,t,n,i){const r=i===-1?t.swatches:t.reversedSwatches,a=u=>{const c=t.closestIndexOf(u);return i===1?t.lastIndex-c:c};i===1&&n.reverse();const o=e(n[n.length-2]);if(Jt(vs(n[n.length-1],n[n.length-2]),2)<o){n.pop();const u=t.colorContrast(r[t.lastIndex],o,void 0,i),c=a(u),d=a(n[n.length-2]),h=c-d;let p=1;for(let g=n.length-h-1;g<n.length;g++){const f=a(n[g]),m=g===n.length-1?t.lastIndex:f+p;n[g]=r[m],p++}}i===1&&n.reverse()}static createColorPaletteByContrast(e,t){const n=gi.createHighResolutionPalette(e),i=o=>{const l=t.stepContrast+t.stepContrast*(1-o.relativeLuminance)*t.stepContrastRamp;return Jt(l,2)},r=[];let a=t.preserveSource?e:n.swatches[0];r.push(a);do{const o=i(a);a=n.colorContrast(a,o,void 0,1),r.push(a)}while(a.relativeLuminance>0);if(t.preserveSource){a=e;do{const o=i(a);a=n.colorContrast(a,o,void 0,-1),r.unshift(a)}while(a.relativeLuminance<1)}return this.adjustEnd(i,n,r,-1),t.preserveSource&&this.adjustEnd(i,n,r,1),r}static from(e,t){const n=t===void 0?Zh:Object.assign(Object.assign({},Zh),t);return new gi(e,Object.freeze(gi.createColorPaletteByContrast(e,n)))}}const Ds=Ri.create(1,1,1),bc=Ri.create(0,0,0),KE=Ri.create(.5,.5,.5),pu=yi("#0078D4"),wE=Ri.create(pu.r,pu.g,pu.b);function Xg(s,e,t,n,i){const r=c=>c.contrast(Ds)>=i?Ds:bc,a=r(s),o=r(e),l=a.relativeLuminance===o.relativeLuminance?a:r(t),u=r(n);return{rest:a,hover:o,active:l,focus:u}}class ol{constructor(e,t,n,i){this.toColorString=()=>this.cssGradient,this.contrast=vs.bind(null,this),this.createCSS=this.toColorString,this.color=new pt(e,t,n),this.cssGradient=i,this.relativeLuminance=ia(this.color),this.r=e,this.g=t,this.b=n}static fromObject(e,t){return new ol(e.r,e.g,e.b,t)}}const BE=new pt(0,0,0),UE=new pt(1,1,1);function Jg(s,e,t,n,i,r,a,o,l=10,u=!1){const c=s.closestIndexOf(e);o===void 0&&(o=On(e));function d(y){if(u){const T=s.closestIndexOf(e),E=s.get(T),b=y.relativeLuminance<e.relativeLuminance?BE:UE,v=MA(yi(y.toColorString()),yi(E.toColorString()),b).roundToPrecision(2),I=UA(yi(e.toColorString()),v);return Ri.from(I)}else return y}const h=c+o*t,p=h+o*(n-t),g=h+o*(i-t),f=h+o*(r-t),m=o===-1?0:100-l,C=o===-1?l:100;function _(y,T){const E=s.get(y);if(T){const b=s.get(y+o*a),v=o===-1?b:E,I=o===-1?E:b,R=`linear-gradient(${d(v).toColorString()} ${m}%, ${d(I).toColorString()} ${C}%)`;return ol.fromObject(v,R)}else return d(E)}return{rest:_(h,!0),hover:_(p,!0),active:_(g,!1),focus:_(f,!0)}}function FE(s,e,t,n,i,r,a,o){const l=s.closestIndexOf(e),u=On(e),c=l+u*t,d=c+u*(n-t),h=c+u*(i-t),p=c+u*(r-t),g=`calc(100% - ${o})`;function f(m,C){const _=s.get(m);if(C){const y=s.get(m+u*a),T=`linear-gradient(${_.toColorString()} ${g}, ${y.toColorString()} ${g}, ${y.toColorString()})`;return ol.fromObject(_,T)}else return _}return{rest:f(c,!0),hover:f(d,!0),active:f(h,!1),focus:f(p,!0)}}function VE(s,e,t){return s.colorContrast(e,t)}function Xn(s,e,t,n,i,r,a,o){o==null&&(o=On(e));const l=s.closestIndexOf(s.colorContrast(e,t));return{rest:s.get(l+o*n),hover:s.get(l+o*i),active:s.get(l+o*r),focus:s.get(l+o*a)}}function jE(s,e,t,n,i,r,a,o=void 0,l,u,c,d,h,p=void 0){return ma(e)?Xn(s,e,l,u,c,d,h,p):Xn(s,e,t,n,i,r,a,o)}function WE(s,e,t){return s.get(s.closestIndexOf(e)+On(e)*t)}function Wi(s,e,t,n,i,r,a){const o=s.closestIndexOf(e);return a==null&&(a=On(e)),{rest:s.get(o+a*t),hover:s.get(o+a*n),active:s.get(o+a*i),focus:s.get(o+a*r)}}function vc(s,e,t,n,i,r,a=void 0,o,l,u,c,d=void 0){return ma(e)?Wi(s,e,o,l,u,c,d):Wi(s,e,t,n,i,r,a)}function HE(s,e){return ma(e)?Ds:bc}function GE(s,e,t){return ma(e)?bc:Ds}function zE(s){return Ri.create(s,s,s)}var Fu;(function(s){s[s.LightMode=.98]="LightMode",s[s.DarkMode=.15]="DarkMode"})(Fu||(Fu={}));function Ca(s,e){return s.closestIndexOf(zE(e))}function $E(s,e){return s.get(Ca(s,e))}function YE(s,e,t){return s.get(Ca(s,e)+t)}function qg(s,e,t){return s.get(Ca(s,e)+t*-1)}function XE(s,e,t){return s.get(Ca(s,e)+t*-1*2)}function JE(s,e,t){return s.get(Ca(s,e)+t*-1*3)}const qE={Thin:100,ExtraLight:200,Light:300,Normal:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Black:900},{create:he}=Lt;function Oe(s){return Lt.create({name:s,cssCustomPropertyName:null})}const gu=he("direction").withDefault(Di.ltr),kc=he("disabled-opacity").withDefault(.3),ZE=he("base-height-multiplier").withDefault(8),kD=he("base-horizontal-spacing-multiplier").withDefault(3),Zg=he("density").withDefault(0),mi=he("design-unit").withDefault(4),Jn=he("control-corner-radius").withDefault(4),Qg=he("layer-corner-radius").withDefault(8),Ft=he("stroke-width").withDefault(1),Sr=he("focus-stroke-width").withDefault(2),Pi=he("body-font").withDefault('"Segoe UI Variable", "Segoe UI", sans-serif'),QE=he("font-weight").withDefault(qE.Normal);function Ni(s){return e=>{const t=s.getValueFor(e),n=QE.getValueFor(e);if(t.endsWith("px")){const i=Number.parseFloat(t.replace("px",""));if(i<=12)return`"wght" ${n}, "opsz" 8`;if(i>24)return`"wght" ${n}, "opsz" 36`}return`"wght" ${n}, "opsz" 10.5`}}const ef=he("type-ramp-base-font-size").withDefault("14px"),eS=he("type-ramp-base-line-height").withDefault("20px"),tS=he("type-ramp-base-font-variations").withDefault(Ni(ef)),tf=he("type-ramp-minus-1-font-size").withDefault("12px"),rS=he("type-ramp-minus-1-line-height").withDefault("16px"),iS=he("type-ramp-minus-1-font-variations").withDefault(Ni(tf)),rf=he("type-ramp-minus-2-font-size").withDefault("10px"),nS=he("type-ramp-minus-2-line-height").withDefault("14px"),oS=he("type-ramp-minus-2-font-variations").withDefault(Ni(rf)),nf=he("type-ramp-plus-1-font-size").withDefault("16px"),aS=he("type-ramp-plus-1-line-height").withDefault("22px"),sS=he("type-ramp-plus-1-font-variations").withDefault(Ni(nf)),of=he("type-ramp-plus-2-font-size").withDefault("20px"),lS=he("type-ramp-plus-2-line-height").withDefault("26px"),uS=he("type-ramp-plus-2-font-variations").withDefault(Ni(of)),af=he("type-ramp-plus-3-font-size").withDefault("24px"),cS=he("type-ramp-plus-3-line-height").withDefault("32px"),dS=he("type-ramp-plus-3-font-variations").withDefault(Ni(af)),sf=he("type-ramp-plus-4-font-size").withDefault("28px"),hS=he("type-ramp-plus-4-line-height").withDefault("36px"),pS=he("type-ramp-plus-4-font-variations").withDefault(Ni(sf)),lf=he("type-ramp-plus-5-font-size").withDefault("32px"),gS=he("type-ramp-plus-5-line-height").withDefault("40px"),fS=he("type-ramp-plus-5-font-variations").withDefault(Ni(lf)),uf=he("type-ramp-plus-6-font-size").withDefault("40px"),mS=he("type-ramp-plus-6-line-height").withDefault("52px"),CS=he("type-ramp-plus-6-font-variations").withDefault(Ni(uf)),lo=he("base-layer-luminance").withDefault(Fu.LightMode),Qh=Oe("accent-fill-rest-delta").withDefault(0),ep=Oe("accent-fill-hover-delta").withDefault(-2),tp=Oe("accent-fill-active-delta").withDefault(-5),rp=Oe("accent-fill-focus-delta").withDefault(0),_S=Oe("accent-foreground-rest-delta").withDefault(0),yS=Oe("accent-foreground-hover-delta").withDefault(3),AS=Oe("accent-foreground-active-delta").withDefault(-8),TS=Oe("accent-foreground-focus-delta").withDefault(0),ES=Oe("neutral-fill-rest-delta").withDefault(-1),SS=Oe("neutral-fill-hover-delta").withDefault(1),OS=Oe("neutral-fill-active-delta").withDefault(0),bS=Oe("neutral-fill-focus-delta").withDefault(0),vS=Oe("neutral-fill-input-rest-delta").withDefault(-1),kS=Oe("neutral-fill-input-hover-delta").withDefault(1),IS=Oe("neutral-fill-input-active-delta").withDefault(0),DS=Oe("neutral-fill-input-focus-delta").withDefault(-2),Ja=Oe("neutral-fill-input-alt-rest-delta").withDefault(2),ip=Oe("neutral-fill-input-alt-hover-delta").withDefault(4),np=Oe("neutral-fill-input-alt-active-delta").withDefault(6),op=Oe("neutral-fill-input-alt-focus-delta").withDefault(2),Cn=Oe("neutral-fill-layer-rest-delta").withDefault(-2),RS=Oe("neutral-fill-layer-hover-delta").withDefault(-3),PS=Oe("neutral-fill-layer-active-delta").withDefault(-3),qa=Oe("neutral-fill-layer-alt-rest-delta").withDefault(-1),NS=Oe("neutral-fill-secondary-rest-delta").withDefault(3),MS=Oe("neutral-fill-secondary-hover-delta").withDefault(2),xS=Oe("neutral-fill-secondary-active-delta").withDefault(1),LS=Oe("neutral-fill-secondary-focus-delta").withDefault(3),KS=Oe("neutral-fill-stealth-rest-delta").withDefault(0),wS=Oe("neutral-fill-stealth-hover-delta").withDefault(3),BS=Oe("neutral-fill-stealth-active-delta").withDefault(2),US=Oe("neutral-fill-stealth-focus-delta").withDefault(0),FS=Oe("neutral-fill-strong-rest-delta").withDefault(0),VS=Oe("neutral-fill-strong-hover-delta").withDefault(8),jS=Oe("neutral-fill-strong-active-delta").withDefault(-5),WS=Oe("neutral-fill-strong-focus-delta").withDefault(0),HS=Oe("neutral-stroke-rest-delta").withDefault(8),GS=Oe("neutral-stroke-hover-delta").withDefault(12),zS=Oe("neutral-stroke-active-delta").withDefault(6),$S=Oe("neutral-stroke-focus-delta").withDefault(8),cf=Oe("neutral-stroke-control-rest-delta").withDefault(3),df=Oe("neutral-stroke-control-hover-delta").withDefault(5),hf=Oe("neutral-stroke-control-active-delta").withDefault(5),pf=Oe("neutral-stroke-control-focus-delta").withDefault(5),YS=Oe("neutral-stroke-divider-rest-delta").withDefault(4),ap=Oe("neutral-stroke-layer-rest-delta").withDefault(3),XS=Oe("neutral-stroke-layer-hover-delta").withDefault(3),JS=Oe("neutral-stroke-layer-active-delta").withDefault(3),qS=Oe("neutral-stroke-strong-hover-delta").withDefault(0),ZS=Oe("neutral-stroke-strong-active-delta").withDefault(0),QS=Oe("neutral-stroke-strong-focus-delta").withDefault(0),eO=he("neutral-base-color").withDefault(KE),Kt=Oe("neutral-palette").withDefault(s=>Is.from(eO.getValueFor(s))),tO=he("accent-base-color").withDefault(wE),Ic=Oe("accent-palette").withDefault(s=>Is.from(tO.getValueFor(s))),rO=Oe("neutral-layer-card-container-recipe").withDefault({evaluate:s=>qg(Kt.getValueFor(s),lo.getValueFor(s),Cn.getValueFor(s))});he("neutral-layer-card-container").withDefault(s=>rO.getValueFor(s).evaluate(s));const iO=Oe("neutral-layer-floating-recipe").withDefault({evaluate:s=>YE(Kt.getValueFor(s),lo.getValueFor(s),Cn.getValueFor(s))}),gf=he("neutral-layer-floating").withDefault(s=>iO.getValueFor(s).evaluate(s)),nO=Oe("neutral-layer-1-recipe").withDefault({evaluate:s=>$E(Kt.getValueFor(s),lo.getValueFor(s))}),oO=he("neutral-layer-1").withDefault(s=>nO.getValueFor(s).evaluate(s)),aO=Oe("neutral-layer-2-recipe").withDefault({evaluate:s=>qg(Kt.getValueFor(s),lo.getValueFor(s),Cn.getValueFor(s))});he("neutral-layer-2").withDefault(s=>aO.getValueFor(s).evaluate(s));const sO=Oe("neutral-layer-3-recipe").withDefault({evaluate:s=>XE(Kt.getValueFor(s),lo.getValueFor(s),Cn.getValueFor(s))});he("neutral-layer-3").withDefault(s=>sO.getValueFor(s).evaluate(s));const lO=Oe("neutral-layer-4-recipe").withDefault({evaluate:s=>JE(Kt.getValueFor(s),lo.getValueFor(s),Cn.getValueFor(s))});he("neutral-layer-4").withDefault(s=>lO.getValueFor(s).evaluate(s));const wt=he("fill-color").withDefault(s=>oO.getValueFor(s));var Rs;(function(s){s[s.normal=4.5]="normal",s[s.large=3]="large"})(Rs||(Rs={}));const al=Oe("accent-fill-recipe").withDefault({evaluate:(s,e)=>jE(Ic.getValueFor(s),e||wt.getValueFor(s),5,Qh.getValueFor(s),ep.getValueFor(s),tp.getValueFor(s),rp.getValueFor(s),void 0,8,Qh.getValueFor(s),ep.getValueFor(s),tp.getValueFor(s),rp.getValueFor(s),void 0)}),hn=he("accent-fill-rest").withDefault(s=>al.getValueFor(s).evaluate(s).rest),qn=he("accent-fill-hover").withDefault(s=>al.getValueFor(s).evaluate(s).hover),Zn=he("accent-fill-active").withDefault(s=>al.getValueFor(s).evaluate(s).active),sl=he("accent-fill-focus").withDefault(s=>al.getValueFor(s).evaluate(s).focus),ll=Oe("foreground-on-accent-recipe").withDefault({evaluate:s=>Xg(hn.getValueFor(s),qn.getValueFor(s),Zn.getValueFor(s),sl.getValueFor(s),Rs.normal)}),uO=he("foreground-on-accent-rest").withDefault(s=>ll.getValueFor(s).evaluate(s).rest),cO=he("foreground-on-accent-hover").withDefault(s=>ll.getValueFor(s).evaluate(s).hover),dO=he("foreground-on-accent-active").withDefault(s=>ll.getValueFor(s).evaluate(s).active);he("foreground-on-accent-focus").withDefault(s=>ll.getValueFor(s).evaluate(s).focus);const ul=Oe("accent-foreground-recipe").withDefault({evaluate:(s,e)=>Xn(Ic.getValueFor(s),e||wt.getValueFor(s),9.5,_S.getValueFor(s),yS.getValueFor(s),AS.getValueFor(s),TS.getValueFor(s))}),hO=he("accent-foreground-rest").withDefault(s=>ul.getValueFor(s).evaluate(s).rest),pO=he("accent-foreground-hover").withDefault(s=>ul.getValueFor(s).evaluate(s).hover),gO=he("accent-foreground-active").withDefault(s=>ul.getValueFor(s).evaluate(s).active);he("accent-foreground-focus").withDefault(s=>ul.getValueFor(s).evaluate(s).focus);const cl=Oe("accent-stroke-control-recipe").withDefault({evaluate:(s,e)=>Jg(Kt.getValueFor(s),e||wt.getValueFor(s),-3,-3,-3,-3,10,1,void 0,!0)}),fO=he("accent-stroke-control-rest").withDefault(s=>cl.getValueFor(s).evaluate(s,hn.getValueFor(s)).rest),mO=he("accent-stroke-control-hover").withDefault(s=>cl.getValueFor(s).evaluate(s,qn.getValueFor(s)).hover),CO=he("accent-stroke-control-active").withDefault(s=>cl.getValueFor(s).evaluate(s,Zn.getValueFor(s)).active);he("accent-stroke-control-focus").withDefault(s=>cl.getValueFor(s).evaluate(s,sl.getValueFor(s)).focus);const dl=Oe("neutral-fill-recipe").withDefault({evaluate:(s,e)=>vc(Kt.getValueFor(s),e||wt.getValueFor(s),ES.getValueFor(s),SS.getValueFor(s),OS.getValueFor(s),bS.getValueFor(s),void 0,2,3,1,2,void 0)}),Za=he("neutral-fill-rest").withDefault(s=>dl.getValueFor(s).evaluate(s).rest),sp=he("neutral-fill-hover").withDefault(s=>dl.getValueFor(s).evaluate(s).hover),lp=he("neutral-fill-active").withDefault(s=>dl.getValueFor(s).evaluate(s).active);he("neutral-fill-focus").withDefault(s=>dl.getValueFor(s).evaluate(s).focus);const uo=Oe("neutral-fill-input-recipe").withDefault({evaluate:(s,e)=>vc(Kt.getValueFor(s),e||wt.getValueFor(s),vS.getValueFor(s),kS.getValueFor(s),IS.getValueFor(s),DS.getValueFor(s),void 0,2,3,1,0,void 0)}),Qa=he("neutral-fill-input-rest").withDefault(s=>uo.getValueFor(s).evaluate(s).rest),up=he("neutral-fill-input-hover").withDefault(s=>uo.getValueFor(s).evaluate(s).hover);he("neutral-fill-input-active").withDefault(s=>uo.getValueFor(s).evaluate(s).active);const cp=he("neutral-fill-input-focus").withDefault(s=>uo.getValueFor(s).evaluate(s).focus),hl=Oe("neutral-fill-input-alt-recipe").withDefault({evaluate:(s,e)=>vc(Kt.getValueFor(s),e||wt.getValueFor(s),Ja.getValueFor(s),ip.getValueFor(s),np.getValueFor(s),op.getValueFor(s),1,Ja.getValueFor(s),Ja.getValueFor(s)-ip.getValueFor(s),Ja.getValueFor(s)-np.getValueFor(s),op.getValueFor(s),1)}),ID=he("neutral-fill-input-alt-rest").withDefault(s=>hl.getValueFor(s).evaluate(s).rest),DD=he("neutral-fill-input-alt-hover").withDefault(s=>hl.getValueFor(s).evaluate(s).hover),RD=he("neutral-fill-input-alt-active").withDefault(s=>hl.getValueFor(s).evaluate(s).active),PD=he("neutral-fill-input-alt-focus").withDefault(s=>hl.getValueFor(s).evaluate(s).focus),Dc=Oe("neutral-fill-layer-recipe").withDefault({evaluate:(s,e)=>Wi(Kt.getValueFor(s),e||wt.getValueFor(s),Cn.getValueFor(s),RS.getValueFor(s),PS.getValueFor(s),Cn.getValueFor(s),1)}),ND=he("neutral-fill-layer-rest").withDefault(s=>Dc.getValueFor(s).evaluate(s).rest);he("neutral-fill-layer-hover").withDefault(s=>Dc.getValueFor(s).evaluate(s).hover);he("neutral-fill-layer-active").withDefault(s=>Dc.getValueFor(s).evaluate(s).active);const _O=Oe("neutral-fill-layer-alt-recipe").withDefault({evaluate:(s,e)=>Wi(Kt.getValueFor(s),e||wt.getValueFor(s),qa.getValueFor(s),qa.getValueFor(s),qa.getValueFor(s),qa.getValueFor(s))}),MD=he("neutral-fill-layer-alt-rest").withDefault(s=>_O.getValueFor(s).evaluate(s).rest),co=Oe("neutral-fill-secondary-recipe").withDefault({evaluate:(s,e)=>Wi(Kt.getValueFor(s),e||wt.getValueFor(s),NS.getValueFor(s),MS.getValueFor(s),xS.getValueFor(s),LS.getValueFor(s))}),yO=he("neutral-fill-secondary-rest").withDefault(s=>co.getValueFor(s).evaluate(s).rest),AO=he("neutral-fill-secondary-hover").withDefault(s=>co.getValueFor(s).evaluate(s).hover),xD=he("neutral-fill-secondary-active").withDefault(s=>co.getValueFor(s).evaluate(s).active);he("neutral-fill-secondary-focus").withDefault(s=>co.getValueFor(s).evaluate(s).focus);const pl=Oe("neutral-fill-stealth-recipe").withDefault({evaluate:(s,e)=>Wi(Kt.getValueFor(s),e||wt.getValueFor(s),KS.getValueFor(s),wS.getValueFor(s),BS.getValueFor(s),US.getValueFor(s))}),Ps=he("neutral-fill-stealth-rest").withDefault(s=>pl.getValueFor(s).evaluate(s).rest),Rc=he("neutral-fill-stealth-hover").withDefault(s=>pl.getValueFor(s).evaluate(s).hover),Pc=he("neutral-fill-stealth-active").withDefault(s=>pl.getValueFor(s).evaluate(s).active),LD=he("neutral-fill-stealth-focus").withDefault(s=>pl.getValueFor(s).evaluate(s).focus),gl=Oe("neutral-fill-strong-recipe").withDefault({evaluate:(s,e)=>Xn(Kt.getValueFor(s),e||wt.getValueFor(s),4.5,FS.getValueFor(s),VS.getValueFor(s),jS.getValueFor(s),WS.getValueFor(s))}),KD=he("neutral-fill-strong-rest").withDefault(s=>gl.getValueFor(s).evaluate(s).rest),wD=he("neutral-fill-strong-hover").withDefault(s=>gl.getValueFor(s).evaluate(s).hover),BD=he("neutral-fill-strong-active").withDefault(s=>gl.getValueFor(s).evaluate(s).active);he("neutral-fill-strong-focus").withDefault(s=>gl.getValueFor(s).evaluate(s).focus);const fl=Oe("neutral-foreground-recipe").withDefault({evaluate:(s,e)=>Xn(Kt.getValueFor(s),e||wt.getValueFor(s),16,0,-19,-30,0)}),Qn=he("neutral-foreground-rest").withDefault(s=>fl.getValueFor(s).evaluate(s).rest),UD=he("neutral-foreground-hover").withDefault(s=>fl.getValueFor(s).evaluate(s).hover),FD=he("neutral-foreground-active").withDefault(s=>fl.getValueFor(s).evaluate(s).active);he("neutral-foreground-focus").withDefault(s=>fl.getValueFor(s).evaluate(s).focus);const _a=Oe("neutral-foreground-hint-recipe").withDefault({evaluate:(s,e)=>VE(Kt.getValueFor(s),e||wt.getValueFor(s),4.5)}),TO=he("neutral-foreground-hint").withDefault(s=>_a.getValueFor(s).evaluate(s)),ml=Oe("neutral-stroke-recipe").withDefault({evaluate:(s,e)=>Wi(Kt.getValueFor(s),e||wt.getValueFor(s),HS.getValueFor(s),GS.getValueFor(s),zS.getValueFor(s),$S.getValueFor(s))}),Ns=he("neutral-stroke-rest").withDefault(s=>ml.getValueFor(s).evaluate(s).rest),EO=he("neutral-stroke-hover").withDefault(s=>ml.getValueFor(s).evaluate(s).hover),SO=he("neutral-stroke-active").withDefault(s=>ml.getValueFor(s).evaluate(s).active),VD=he("neutral-stroke-focus").withDefault(s=>ml.getValueFor(s).evaluate(s).focus),Cl=Oe("neutral-stroke-control-recipe").withDefault({evaluate:(s,e)=>Jg(Kt.getValueFor(s),e||wt.getValueFor(s),cf.getValueFor(s),df.getValueFor(s),hf.getValueFor(s),pf.getValueFor(s),5)}),OO=he("neutral-stroke-control-rest").withDefault(s=>Cl.getValueFor(s).evaluate(s).rest),bO=he("neutral-stroke-control-hover").withDefault(s=>Cl.getValueFor(s).evaluate(s).hover),vO=he("neutral-stroke-control-active").withDefault(s=>Cl.getValueFor(s).evaluate(s).active);he("neutral-stroke-control-focus").withDefault(s=>Cl.getValueFor(s).evaluate(s).focus);const kO=Oe("neutral-stroke-divider-recipe").withDefault({evaluate:(s,e)=>WE(Kt.getValueFor(s),e||wt.getValueFor(s),YS.getValueFor(s))}),ff=he("neutral-stroke-divider-rest").withDefault(s=>kO.getValueFor(s).evaluate(s)),_l=Oe("neutral-stroke-input-recipe").withDefault({evaluate:(s,e)=>FE(Kt.getValueFor(s),e||wt.getValueFor(s),cf.getValueFor(s),df.getValueFor(s),hf.getValueFor(s),pf.getValueFor(s),20,Ft.getValueFor(s)+"px")}),dp=he("neutral-stroke-input-rest").withDefault(s=>_l.getValueFor(s).evaluate(s).rest),IO=he("neutral-stroke-input-hover").withDefault(s=>_l.getValueFor(s).evaluate(s).hover);he("neutral-stroke-input-active").withDefault(s=>_l.getValueFor(s).evaluate(s).active);he("neutral-stroke-input-focus").withDefault(s=>_l.getValueFor(s).evaluate(s).focus);const Nc=Oe("neutral-stroke-layer-recipe").withDefault({evaluate:(s,e)=>Wi(Kt.getValueFor(s),e||wt.getValueFor(s),ap.getValueFor(s),XS.getValueFor(s),JS.getValueFor(s),ap.getValueFor(s))}),jD=he("neutral-stroke-layer-rest").withDefault(s=>Nc.getValueFor(s).evaluate(s).rest);he("neutral-stroke-layer-hover").withDefault(s=>Nc.getValueFor(s).evaluate(s).hover);he("neutral-stroke-layer-active").withDefault(s=>Nc.getValueFor(s).evaluate(s).active);const yl=Oe("neutral-stroke-strong-recipe").withDefault({evaluate:(s,e)=>Xn(Kt.getValueFor(s),e||wt.getValueFor(s),5.5,0,qS.getValueFor(s),ZS.getValueFor(s),QS.getValueFor(s))}),WD=he("neutral-stroke-strong-rest").withDefault(s=>yl.getValueFor(s).evaluate(s).rest),HD=he("neutral-stroke-strong-hover").withDefault(s=>yl.getValueFor(s).evaluate(s).hover),GD=he("neutral-stroke-strong-active").withDefault(s=>yl.getValueFor(s).evaluate(s).active);he("neutral-stroke-strong-focus").withDefault(s=>yl.getValueFor(s).evaluate(s).focus);const DO=Oe("focus-stroke-outer-recipe").withDefault({evaluate:s=>HE(Kt.getValueFor(s),wt.getValueFor(s))}),_n=he("focus-stroke-outer").withDefault(s=>DO.getValueFor(s).evaluate(s)),RO=Oe("focus-stroke-inner-recipe").withDefault({evaluate:s=>GE(Ic.getValueFor(s),wt.getValueFor(s),_n.getValueFor(s))}),PO=he("focus-stroke-inner").withDefault(s=>RO.getValueFor(s).evaluate(s)),Al=Oe("foreground-on-accent-large-recipe").withDefault({evaluate:s=>Xg(hn.getValueFor(s),qn.getValueFor(s),Zn.getValueFor(s),sl.getValueFor(s),Rs.large)});he("foreground-on-accent-rest-large").withDefault(s=>Al.getValueFor(s).evaluate(s).rest);he("foreground-on-accent-hover-large").withDefault(s=>Al.getValueFor(s).evaluate(s,qn.getValueFor(s)).hover);he("foreground-on-accent-active-large").withDefault(s=>Al.getValueFor(s).evaluate(s,Zn.getValueFor(s)).active);he("foreground-on-accent-focus-large").withDefault(s=>Al.getValueFor(s).evaluate(s,sl.getValueFor(s)).focus);const NO=he("neutral-fill-inverse-rest-delta").withDefault(0),MO=he("neutral-fill-inverse-hover-delta").withDefault(-3),xO=he("neutral-fill-inverse-active-delta").withDefault(7),LO=he("neutral-fill-inverse-focus-delta").withDefault(0);function KO(s,e,t,n,i,r){const a=On(e),o=s.closestIndexOf(s.colorContrast(e,14)),l=o+a*Math.abs(t-n),u=a===1?t<n:a*t>a*n;let c,d;return u?(c=o,d=l):(c=l,d=o),{rest:s.get(c),hover:s.get(d),active:s.get(c+a*i),focus:s.get(c+a*r)}}const Tl=Oe("neutral-fill-inverse-recipe").withDefault({evaluate:(s,e)=>KO(Kt.getValueFor(s),e||wt.getValueFor(s),NO.getValueFor(s),MO.getValueFor(s),xO.getValueFor(s),LO.getValueFor(s))});he("neutral-fill-inverse-rest").withDefault(s=>Tl.getValueFor(s).evaluate(s).rest);he("neutral-fill-inverse-hover").withDefault(s=>Tl.getValueFor(s).evaluate(s).hover);he("neutral-fill-inverse-active").withDefault(s=>Tl.getValueFor(s).evaluate(s).active);he("neutral-fill-inverse-focus").withDefault(s=>Tl.getValueFor(s).evaluate(s).focus);const oa=ni`
  font-family: ${Pi};
  font-size: ${ef};
  line-height: ${eS};
  font-weight: initial;
  font-variation-settings: ${tS};
`,zD=ni`
  font-family: ${Pi};
  font-size: ${tf};
  line-height: ${rS};
  font-weight: initial;
  font-variation-settings: ${iS};
`;ni`
  font-family: ${Pi};
  font-size: ${rf};
  line-height: ${nS};
  font-weight: initial;
  font-variation-settings: ${oS};
`;ni`
  font-family: ${Pi};
  font-size: ${nf};
  line-height: ${aS};
  font-weight: initial;
  font-variation-settings: ${sS};
`;ni`
  font-family: ${Pi};
  font-size: ${of};
  line-height: ${lS};
  font-weight: initial;
  font-variation-settings: ${uS};
`;ni`
  font-family: ${Pi};
  font-size: ${af};
  line-height: ${cS};
  font-weight: initial;
  font-variation-settings: ${dS};
`;ni`
  font-family: ${Pi};
  font-size: ${sf};
  line-height: ${hS};
  font-weight: initial;
  font-variation-settings: ${pS};
`;ni`
  font-family: ${Pi};
  font-size: ${lf};
  line-height: ${gS};
  font-weight: initial;
  font-variation-settings: ${fS};
`;ni`
  font-family: ${Pi};
  font-size: ${uf};
  line-height: ${mS};
  font-weight: initial;
  font-variation-settings: ${CS};
`;const Ms=ni`(${ZE} + ${Zg}) * ${mi}`;class wO{constructor(e,t){this.cache=new WeakMap,this.ltr=e,this.rtl=t}bind(e){this.attach(e)}unbind(e){const t=this.cache.get(e);t&&gu.unsubscribe(t)}attach(e){const t=this.cache.get(e)||new BO(this.ltr,this.rtl,e),n=gu.getValueFor(e);gu.subscribe(t),t.attach(n),this.cache.set(e,t)}}class BO{constructor(e,t,n){this.ltr=e,this.rtl=t,this.source=n,this.attached=null}handleChange({target:e,token:t}){this.attach(t.getValueFor(this.source))}attach(e){this.attached!==this[e]&&(this.attached!==null&&this.source.$fastController.removeStyles(this.attached),this.attached=this[e],this.attached!==null&&this.source.$fastController.addStyles(this.attached))}}const bn=Lt.create({name:"elevation-shadow",cssCustomPropertyName:null}).withDefault({evaluate:(s,e,t)=>{let n=.12,i=.14;e>16&&(n=.2,i=.24);const r=`0 0 2px rgba(0, 0, 0, ${n})`,a=`0 calc(${e} * 0.5px) calc((${e} * 1px)) rgba(0, 0, 0, ${i})`;return`${r}, ${a}`}}),UO=Lt.create("elevation-shadow-card-rest-size").withDefault(4),FO=Lt.create("elevation-shadow-card-hover-size").withDefault(8),VO=Lt.create("elevation-shadow-card-active-size").withDefault(0),jO=Lt.create("elevation-shadow-card-focus-size").withDefault(8),$D=Lt.create("elevation-shadow-card-rest").withDefault(s=>bn.getValueFor(s).evaluate(s,UO.getValueFor(s)));Lt.create("elevation-shadow-card-hover").withDefault(s=>bn.getValueFor(s).evaluate(s,FO.getValueFor(s)));Lt.create("elevation-shadow-card-active").withDefault(s=>bn.getValueFor(s).evaluate(s,VO.getValueFor(s)));Lt.create("elevation-shadow-card-focus").withDefault(s=>bn.getValueFor(s).evaluate(s,jO.getValueFor(s)));const WO=Lt.create("elevation-shadow-tooltip-size").withDefault(16),YD=Lt.create("elevation-shadow-tooltip").withDefault(s=>bn.getValueFor(s).evaluate(s,WO.getValueFor(s))),HO=Lt.create("elevation-shadow-flyout-size").withDefault(32),GO=Lt.create("elevation-shadow-flyout").withDefault(s=>bn.getValueFor(s).evaluate(s,HO.getValueFor(s))),zO=Lt.create("elevation-shadow-dialog-size").withDefault(128),$O=Lt.create("elevation-shadow-dialog").withDefault(s=>bn.getValueFor(s).evaluate(s,zO.getValueFor(s))),YO=(s,e,t="",n="")=>De`
    ${ro("inline-flex")} :host {
      position: relative;
      box-sizing: border-box;
      outline: none;
      ${oa}
      height: calc(${Ms} * 1px);
      min-width: calc(${Ms} * 1px);
      color: ${Qn};
      border-radius: calc(${Jn} * 1px);
      fill: currentcolor;
      cursor: pointer;
    }

    :host .control {
      background: padding-box linear-gradient(${Za}, ${Za}),
        border-box ${OO};
      border: calc(${Ft} * 1px) solid transparent;
      flex-grow: 1;
      box-sizing: border-box;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 0 calc((10 + (${mi} * 2 * ${Zg})) * 1px);
      white-space: nowrap;
      outline: none;
      text-decoration: none;
      color: inherit;
      border-radius: inherit;
      fill: inherit;
      cursor: inherit;
      font-family: inherit;
    }

    .control,
    .end,
    .start {
      font: inherit;
    }

    .control.icon-only {
      padding: 0;
      line-height: 0;
    }

    :host .control${t}:hover {
      background: padding-box linear-gradient(${sp}, ${sp}),
        border-box ${bO};
    }

    :host .control${t}:active {
      background: padding-box linear-gradient(${lp}, ${lp}),
        border-box ${vO};
    }

    :host .control:${Je} {
      border-color: ${_n} !important;
      box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${_n} inset !important;
    }

    :host .control${n} {
      background: padding-box linear-gradient(${Za}, ${Za}), border-box ${Ns};
    }

    .control::-moz-focus-inner {
      border: 0;
    }

    .content {
      pointer-events: none;
    }

    .start,
    .end {
      display: flex;
      pointer-events: none;
    }

    .start {
      margin-inline-end: 11px;
    }

    .end {
      margin-inline-start: 11px;
    }
  `.withBehaviors(kt(De`
        :host .control {
          background: ${te.ButtonFace};
          border-color: ${te.ButtonText};
          color: ${te.ButtonText};
          fill: currentcolor;
        }
        :host(:not([disabled])) .control:hover,
        :host .control${t}:hover,
        .control${t}:hover {
          forced-color-adjust: none;
          background: ${te.Highlight};
          color: ${te.HighlightText};
        }
        .control:${Je},
        :host .control:${Je},
        :host(:${Je}) .control {
          forced-color-adjust: none;
          background: ${te.ButtonFace};
          border-color: ${te.Highlight} !important;
          box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${te.Highlight} !important;
        }
        :host([href]) .control {
          background: ${te.ButtonFace};
          border-color: ${te.LinkText};
          color: ${te.LinkText};
          fill: currentcolor;
        }
        :host([href]) .control:hover,
        :host(.neutral[href]) .control:hover {
          background: ${te.LinkText};
          border-color: ${te.LinkText} !important;
          color: ${te.HighlightText};
          fill: currentcolor;
        }
        :host([href]) .control:${Je}{
          forced-color-adjust: none;
          border-color: ${te.LinkText} !important;
          box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${te.LinkText} !important;
        }
    `)),XO=(s,e,t="",n="")=>De`
    :host .control {
      background: padding-box linear-gradient(${hn}, ${hn}),
        border-box ${fO};
      color: ${uO};
    }

    :host .control${t}:hover {
      background: padding-box linear-gradient(${qn}, ${qn}),
        border-box ${mO};
      color: ${cO};
    }

    :host .control${t}:active {
      background: padding-box linear-gradient(${Zn}, ${Zn}),
        border-box ${CO};
      color: ${dO};
    }

    :host .control:${Je} {
      box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${_n} inset,
        0 0 0 calc(((${Sr} + ${Ft}) - ${Ft}) * 1px) ${PO} inset !important;
    }

    :host .control${n} {
      background: ${hn};
    }
  `.withBehaviors(kt(De`
        :host .control {
          forced-color-adjust: none;
          background: ${te.Highlight};
          color: ${te.HighlightText};
        }
        :host .control${t}:hover,
        :host .control${t}:active {
          background: ${te.HighlightText};
          border-color: ${te.Highlight};
          color: ${te.Highlight};
        }
        :host .control:${Je} {
          background: ${te.Highlight};
          box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${te.Highlight} inset,
            0 0 0 calc(((${Sr} + ${Ft}) - ${Ft}) * 1px) ${te.HighlightText} inset !important;
        }
        :host([href]) .control {
          background: ${te.LinkText};
          color: ${te.HighlightText};
        }
        :host([href]) .control:hover {
          background: ${te.ButtonFace};
          border-color: ${te.LinkText};
          box-shadow: none;
          color: ${te.LinkText};
          fill: currentcolor;
        }
        :host([href]) .control:${Je} {
          background: ${te.LinkText};
          box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${te.LinkText} inset,
            0 0 0 calc(((${Sr} + ${Ft}) - ${Ft}) * 1px) ${te.HighlightText} inset !important;
          color: ${te.HighlightText};
          fill: currentcolor;
        }
      `));const JO=(s,e,t="",n="")=>De`
    :host {
      color: ${hO};
    }

    :host .control {
      background: ${Ps};
    }

    :host .control${t}:hover {
      background: ${Rc};
      color: ${pO};
    }

    :host .control${t}:active {
      background: ${Pc};
      color: ${gO};
    }

    :host .control${n} {
      background: ${Ps};
    }
  `.withBehaviors(kt(De`
        :host .control {
          border-color: ${te.ButtonFace};
          color: ${te.ButtonText};
        }
        :host .control${t}:hover,
        :host .control${t}:active,
        :host .control:${Je} {
          border-color: ${te.Highlight};
          background: ${te.Highlight};
          box-shadow: none;
          color: ${te.HighlightText};
        }
        :host([href]) .control {
          border-color: ${te.ButtonFace};
          color: ${te.LinkText};
        }
        :host([href]) .control:hover,
        :host([href]) .control:${Je} {
          background: ${te.ButtonFace};
          box-shadow: none;
          color: ${te.LinkText};
        }
      `)),qO=(s,e,t="",n="")=>De`
    :host .control {
      background: transparent !important;
      border-color: ${Ns};
    }

    :host .control${t}:hover {
      border-color: ${EO};
    }

    :host .control${t}:active {
      border-color: ${SO};
    }

    :host .control${n} {
      background: transparent !important;
      border-color: ${Ns};
    }
  `.withBehaviors(kt(De`
        :host .control${n} {
          border-color: ${te.ButtonText};
        }
        :host .control${t}:hover {
          border-color: ${te.Highlight};
          color: ${te.ButtonText};
        }
        :host([href]) {
          border-color: ${te.LinkText};
        }
        :host([href]) .control:hover {
          box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${te.LinkText};
          color: ${te.LinkText};
        }
      `)),ZO=(s,e,t="",n="")=>De`
    :host .control {
      background: ${Ps};
    }

    :host .control${t}:hover {
      background: ${Rc};
    }

    :host .control${t}:active {
      background: ${Pc};
    }

    :host .control${n} {
      background: ${Ps};
    }
  `.withBehaviors(kt(De`
        :host .control {
          background: ${te.ButtonFace};
          border-color: ${te.ButtonFace};
          color: ${te.ButtonText};
          fill: currentcolor;
        }
        :host .control${t}:hover,
        :host .control${t}:active,
        :host .control:${Je} {
          background: ${te.Highlight};
          border-color: ${te.Highlight};
          box-shadow: none !important;
          color: ${te.HighlightText};
          fill: currentcolor;
        }
        :host([href]) .control {
          border-color: ${te.ButtonFace};
          color: ${te.LinkText};
        }
        :host([href]) .control:hover,
        :host([href]) .control:${Je} {
          background: ${te.LinkText};
          border-color: ${te.LinkText};
          box-shadow: none !important;
          color: ${te.HighlightText};
          fill: currentcolor;
        }
      `)),QO=Lt.create("input-placeholder-rest").withDefault(s=>{const e=uo.getValueFor(s);return _a.getValueFor(s).evaluate(s,e.evaluate(s).rest)}),eb=Lt.create("input-placeholder-hover").withDefault(s=>{const e=uo.getValueFor(s);return _a.getValueFor(s).evaluate(s,e.evaluate(s).hover)}),tb=Lt.create("input-filled-placeholder-rest").withDefault(s=>{const e=co.getValueFor(s);return _a.getValueFor(s).evaluate(s,e.evaluate(s).rest)}),rb=Lt.create("input-filled-placeholder-hover").withDefault(s=>{const e=co.getValueFor(s);return _a.getValueFor(s).evaluate(s,e.evaluate(s).hover)}),ib=(s,e,t)=>De`
  :host {
    ${oa}
    color: ${Qn};
    fill: currentcolor;
    outline: none;
    user-select: none;
    position: relative;
  }

  ${t} {
    box-sizing: border-box;
    position: relative;
    color: inherit;
    background: padding-box linear-gradient(${Qa}, ${Qa}),
      border-box ${dp};
    border: calc(${Ft} * 1px) solid transparent;
    border-radius: calc(${Jn} * 1px);
    height: calc(${Ms} * 1px);
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
  }

  .control {
    width: 100%;
  }

  .control:hover,
  .control:${Je},
  .control:disabled,
  .control:active {
    outline: none;
  }

  .label {
    display: block;
    color: ${Qn};
    cursor: pointer;
    ${oa}
    margin-bottom: 4px;
  }

  .label__hidden {
    display: none;
    visibility: hidden;
  }

  :host(:hover:not([disabled]):not(:focus-within)) ${t} {
    background: padding-box linear-gradient(${up}, ${up}),
      border-box ${IO};
  }

  :host(:not([disabled]):focus-within) ${t} {
    background: padding-box linear-gradient(${cp}, ${cp}),
      border-box ${dp};
  }

  .control::placeholder {
    color: ${QO};
  }

  :host(:hover:not([disabled]):not(:focus-within)) .control::placeholder {
    color: ${eb};
  }

  :host([disabled]) ${t}, :host([readonly]) ${t}, :host([disabled]) .label,
  :host([readonly]) .label,
  :host([disabled]) .control,
  :host([readonly]) .control {
    cursor: ${ta};
  }

  :host([disabled]) {
    opacity: ${kc};
  }

  :host([disabled]) ${t} {
    background: padding-box linear-gradient(${Qa}, ${Qa}),
      border-box ${Ns};
  }
`,nb=(s,e,t)=>De`
  :host(:not([disabled]):active)::after {
    left: 50%;
    width: 40%;
    transform: translateX(-50%);
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }

  :host(:not([disabled]):focus-within)::after {
    left: 0;
    width: 100%;
    transform: none;
  }

  :host(:not([disabled]):active)::after,
  :host(:not([disabled]):focus-within:not(:active))::after {
    content: '';
    position: absolute;
    height: calc(${Sr} * 1px);
    bottom: 0;
    border-bottom: calc(${Sr} * 1px) solid ${hn};
    border-bottom-left-radius: calc(${Jn} * 1px);
    border-bottom-right-radius: calc(${Jn} * 1px);
    z-index: 2;
    transition: all 300ms cubic-bezier(0.1, 0.9, 0.2, 1);
  }
`,ob=(s,e,t)=>De`
  :host ${t} {
    background: ${yO};
    border-color: transparent;
  }

  :host(:hover:not([disabled]):not(:focus-within)) ${t} {
    background: ${AO};
    border-color: transparent;
  }

  .control::placeholder {
    color: ${tb};
  }

  :host(:hover:not([disabled]):not(:focus-within)) .control::placeholder {
    color: ${rb};
  }

  :host(:focus-within:not([disabled])) ${t} {
    border-color: transparent;
    box-shadow: none;
  }
`,ab=(s,e,t)=>De`
  :host ${t} {
    background: ${te.Field};
    border-color: ${te.FieldText};
  }
  :host(:hover:not([disabled]):not(:focus-within)) ${t} {
    border-color: ${te.Highlight};
  }
  :host(:not([disabled]):active)::after,
  :host(:not([disabled]):focus-within:not(:active))::after {
    border-bottom-color: ${te.Highlight};
  }
  :host([disabled]) {
    opacity: 1;
  }
  :host([disabled]) ${t} {
    border-color: ${te.GrayText};
  }
  :host([disabled]) ::placeholder,
  :host([disabled]) ::-webkit-input-placeholder,
  :host([disabled]) .label {
    color: ${te.GrayText};
    fill: currentcolor;
  }
`,sb=(s,e,t)=>De`
  :host ${t},
  :host(:hover:not([disabled])) ${t},
  :host(:active:not([disabled])) ${t},
  :host(:focus-within:not([disabled])) ${t} {
    background: ${te.Field};
    border-color: ${te.FieldText};
  }
  :host(:not([disabled]):active)::after,
  :host(:not([disabled]):focus-within:not(:active))::after {
    border-bottom-color: ${te.Highlight};
  }
  :host([disabled]) ${t} {
    border-color: ${te.GrayText};
  }
`;function Uo(s,e){return new Mg("appearance",s,e)}const Mo=":not([disabled])",xo="[disabled]",mf=(s,e)=>De`
    :host([disabled]) {
      opacity: ${kc};
      cursor: ${ta};
    }

    ${YO(s,e,Mo,xo)}
  `.withBehaviors(kt(De`
        :host([disabled]) {
          opacity: 1;
        }
        :host([disabled]) .control {
          border-color: ${te.GrayText};
          color: ${te.GrayText};
          fill: currentcolor;
        }
      `),Uo("accent",De`
      ${XO(s,e,Mo,xo)},
      `.withBehaviors(kt(De`
            :host([disabled]) .control {
              background: ${te.ButtonFace};
            }
          `))),Uo("lightweight",De`
      ${JO(s,e,Mo,xo)},
      `.withBehaviors(kt(De`
            :host([disabled]) .control {
              border-color: ${te.ButtonFace};
            }
          `))),Uo("outline",De`
      ${qO(s,e,Mo,xo)}
      `.withBehaviors(kt(De`
            :host([disabled]) .control {
              border-color: ${te.GrayText};
            }
          `))),Uo("stealth",De`
      ${ZO(s,e,Mo,xo)}
      `.withBehaviors(kt(De`
            :host([disabled]) .control {
              border-color: ${te.ButtonFace};
            }
          `))));class El extends br{appearanceChanged(e,t){e!==t&&(this.classList.add(t),this.classList.remove(e))}connectedCallback(){super.connectedCallback(),this.appearance||(this.appearance="neutral")}defaultSlottedContentChanged(){const e=this.defaultSlottedContent.filter(t=>t.nodeType===Node.ELEMENT_NODE);e.length===1&&e[0]instanceof SVGElement?this.control.classList.add("icon-only"):this.control.classList.remove("icon-only")}}ge([Ee],El.prototype,"appearance",void 0);const Cf=El.compose({baseName:"button",baseClass:br,template:mc,styles:mf,shadowOptions:{delegatesFocus:!0}}),lb=mf,ub=(s,e)=>De`
  :host {
    display: flex;
    position: relative;
    flex-direction: column;
  }
`,cb=(s,e)=>De`
    :host {
      display: grid;
      padding: 1px 0;
      box-sizing: border-box;
      width: 100%;
      border-bottom: calc(${Ft} * 1px) solid ${ff};
    }

    :host(.header) {
    }

    :host(.sticky-header) {
      background: ${wt};
      position: sticky;
      top: 0;
    }
  `.withBehaviors(kt(De`
        :host {
        }
      `)),db=(s,e)=>De`
    :host {
      padding: calc(${mi} * 1px) calc(${mi} * 3px);
      color: ${Qn};
      box-sizing: border-box;
      ${oa}
      border: transparent calc(${Sr} * 1px) solid;
      overflow: hidden;
      outline: none;
      white-space: nowrap;
      border-radius: calc(${Jn} * 1px);
    }

    :host(.column-header) {
      font-weight: 600;
    }

    :host(:${Je}) {
      border-color: ${_n};
    }
  `.withBehaviors(kt(De`
        :host {
          forced-color-adjust: none;
          border-color: transparent;
          background: ${te.Field};
          color: ${te.FieldText};
        }

        :host(:${Je}) {
          border-color: ${te.FieldText};
          box-shadow: 0 0 0 2px inset ${te.Field};
          color: ${te.FieldText};
        }
      `)),hb=En.compose({baseName:"data-grid-cell",template:Gy,styles:db}),pb=yr.compose({baseName:"data-grid-row",template:Hy,styles:cb}),gb=sr.compose({baseName:"data-grid",template:Uy,styles:ub}),fb=(s,e)=>De`
  :host([hidden]) {
    display: none;
  }

  :host {
    --dialog-height: 480px;
    --dialog-width: 640px;
    display: block;
  }

  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    touch-action: none;
  }

  .positioning-region {
    display: flex;
    justify-content: center;
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    overflow: auto;
  }

  .control {
    box-shadow: ${$O};
    margin-top: auto;
    margin-bottom: auto;
    border-radius: calc(${Qg} * 1px);
    width: var(--dialog-width);
    height: var(--dialog-height);
    background: ${wt};
    z-index: 1;
    border: calc(${Ft} * 1px) solid transparent;
  }
`,_f=Kr.compose({baseName:"dialog",template:aA,styles:fb}),mb=(s,e)=>De`
    ${ro("block")} :host {
      background: ${gf};
      border: calc(${Ft} * 1px) solid transparent;
      border-radius: calc(${Qg} * 1px);
      box-shadow: ${GO};
      padding: calc(${mi} * 1px) 0;
      max-width: 368px;
      min-width: 64px;
    }

    :host([slot='submenu']) {
      width: max-content;
      margin: 0 calc(${mi} * 2px);
    }

    ::slotted(${s.tagFor(Br)}) {
      margin: 0 calc(${mi} * 1px);
    }

    ::slotted(${s.tagFor(yc)}) {
      margin: calc(${mi} * 1px) 0;
    }

    ::slotted(hr) {
      box-sizing: content-box;
      height: 0;
      margin: calc(${mi} * 1px) 0;
      border: none;
      border-top: calc(${Ft} * 1px) solid ${ff};
    }
  `.withBehaviors(kt(De`
        :host([slot='submenu']) {
          background: ${te.Canvas};
          border-color: ${te.CanvasText};
        }
      `));class Cb extends Gs{connectedCallback(){super.connectedCallback(),wt.setValueFor(this,gf)}}const _b=Cb.compose({baseName:"menu",baseClass:Gs,template:SA,styles:mb}),yb=(s,e)=>De`
    ${ro("grid")} :host {
      contain: layout;
      overflow: visible;
      ${oa}
      outline: none;
      box-sizing: border-box;
      height: calc(${Ms} * 1px);
      grid-template-columns: minmax(32px, auto) 1fr minmax(32px, auto);
      grid-template-rows: auto;
      justify-items: center;
      align-items: center;
      padding: 0;
      white-space: nowrap;
      color: ${Qn};
      fill: currentcolor;
      cursor: pointer;
      border-radius: calc(${Jn} * 1px);
      border: calc(${Ft} * 1px) solid transparent;
    }

    :host(.indent-0) {
      grid-template-columns: auto 1fr minmax(32px, auto);
    }

    :host(.indent-0) .content {
      grid-column: 1;
      grid-row: 1;
      margin-inline-start: 10px;
    }

    :host(.indent-0) .expand-collapse-glyph-container {
      grid-column: 5;
      grid-row: 1;
    }

    :host(.indent-2) {
      grid-template-columns: minmax(32px, auto) minmax(32px, auto) 1fr minmax(32px, auto) minmax(32px, auto);
    }

    :host(.indent-2) .content {
      grid-column: 3;
      grid-row: 1;
      margin-inline-start: 10px;
    }

    :host(.indent-2) .expand-collapse-glyph-container {
      grid-column: 5;
      grid-row: 1;
    }

    :host(.indent-2) .start {
      grid-column: 2;
    }

    :host(.indent-2) .end {
      grid-column: 4;
    }

    :host(:${Je}) {
      border: calc(${Ft} * 1px) solid ${_n};
      box-shadow: 0 0 0 calc((${Sr} - ${Ft}) * 1px) ${_n};
    }

    :host(:not([disabled]):hover) {
      background: ${Rc};
    }

    :host(:not([disabled]):active),
    :host(.expanded) {
      background: ${Pc};
      color: ${Qn};
    }

    :host([disabled]) {
      cursor: ${ta};
      opacity: ${kc};
    }

    .content {
      grid-column-start: 2;
      justify-self: start;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .start,
    .end {
      display: flex;
      justify-content: center;
    }

    :host(.indent-0[aria-haspopup='menu']) {
      display: grid;
      grid-template-columns: minmax(32px, auto) auto 1fr minmax(32px, auto) minmax(32px, auto);
      align-items: center;
      min-height: 32px;
    }

    :host(.indent-1[aria-haspopup='menu']),
    :host(.indent-1[role='menuitemcheckbox']),
    :host(.indent-1[role='menuitemradio']) {
      display: grid;
      grid-template-columns: minmax(32px, auto) auto 1fr minmax(32px, auto) minmax(32px, auto);
      align-items: center;
      min-height: 32px;
    }

    :host(.indent-2:not([aria-haspopup='menu'])) .end {
      grid-column: 5;
    }

    :host .input-container,
    :host .expand-collapse-glyph-container {
      display: none;
    }

    :host([aria-haspopup='menu']) .expand-collapse-glyph-container,
    :host([role='menuitemcheckbox']) .input-container,
    :host([role='menuitemradio']) .input-container {
      display: grid;
    }

    :host([aria-haspopup='menu']) .content,
    :host([role='menuitemcheckbox']) .content,
    :host([role='menuitemradio']) .content {
      grid-column-start: 3;
    }

    :host([aria-haspopup='menu'].indent-0) .content {
      grid-column-start: 1;
    }

    :host([aria-haspopup='menu']) .end,
    :host([role='menuitemcheckbox']) .end,
    :host([role='menuitemradio']) .end {
      grid-column-start: 4;
    }

    :host .expand-collapse,
    :host .checkbox,
    :host .radio {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-sizing: border-box;
      outline: none;
    }

    :host .checkbox-indicator,
    :host .radio-indicator,
    slot[name='checkbox-indicator'],
    slot[name='radio-indicator'] {
      display: none;
    }

    ::slotted([slot='end']:not(svg)) {
      margin-inline-end: 10px;
      color: ${TO};
    }

    :host([aria-checked='true']) .checkbox-indicator,
    :host([aria-checked='true']) slot[name='checkbox-indicator'],
    :host([aria-checked='true']) .radio-indicator,
    :host([aria-checked='true']) slot[name='radio-indicator'] {
      display: flex;
    }
  `.withBehaviors(kt(De`
        :host,
        ::slotted([slot='end']:not(svg)) {
          forced-color-adjust: none;
          color: ${te.ButtonText};
          fill: currentcolor;
        }
        :host(:not([disabled]):hover) {
          background: ${te.Highlight};
          color: ${te.HighlightText};
          fill: currentcolor;
        }
        :host(:hover) .start,
        :host(:hover) .end,
        :host(:hover)::slotted(svg),
        :host(:active) .start,
        :host(:active) .end,
        :host(:active)::slotted(svg),
        :host(:hover) ::slotted([slot='end']:not(svg)),
        :host(:${Je}) ::slotted([slot='end']:not(svg)) {
          color: ${te.HighlightText};
          fill: currentcolor;
        }
        :host(.expanded) {
          background: ${te.Highlight};
          border-color: ${te.Highlight};
          color: ${te.HighlightText};
        }
        :host(:${Je}) {
          background: ${te.Highlight};
          border-color: ${te.ButtonText};
          box-shadow: 0 0 0 calc(${Ft} * 1px) inset ${te.HighlightText};
          color: ${te.HighlightText};
          fill: currentcolor;
        }
        :host([disabled]),
        :host([disabled]:hover),
        :host([disabled]:hover) .start,
        :host([disabled]:hover) .end,
        :host([disabled]:hover)::slotted(svg),
        :host([disabled]:${Je}) {
          background: ${te.ButtonFace};
          color: ${te.GrayText};
          fill: currentcolor;
          opacity: 1;
        }
        :host([disabled]:${Je}) {
          border-color: ${te.GrayText};
        }
        :host .expanded-toggle,
        :host .checkbox,
        :host .radio {
          border-color: ${te.ButtonText};
          background: ${te.HighlightText};
        }
        :host([checked]) .checkbox,
        :host([checked]) .radio {
          background: ${te.HighlightText};
          border-color: ${te.HighlightText};
        }
        :host(:hover) .expanded-toggle,
            :host(:hover) .checkbox,
            :host(:hover) .radio,
            :host(:${Je}) .expanded-toggle,
            :host(:${Je}) .checkbox,
            :host(:${Je}) .radio,
            :host([checked]:hover) .checkbox,
            :host([checked]:hover) .radio,
            :host([checked]:${Je}) .checkbox,
            :host([checked]:${Je}) .radio {
          border-color: ${te.HighlightText};
        }
        :host([aria-checked='true']) {
          background: ${te.Highlight};
          color: ${te.HighlightText};
        }
        :host([aria-checked='true']) .checkbox-indicator,
        :host([aria-checked='true']) ::slotted([slot='checkbox-indicator']),
        :host([aria-checked='true']) ::slotted([slot='radio-indicator']) {
          fill: ${te.Highlight};
        }
        :host([aria-checked='true']) .radio-indicator {
          background: ${te.Highlight};
        }
      `),new wO(De`
        .expand-collapse-glyph-container {
          transform: rotate(0deg);
        }
      `,De`
        .expand-collapse-glyph-container {
          transform: rotate(180deg);
        }
      `)),Ab=Br.compose({baseName:"menu-item",template:EA,styles:yb,checkboxIndicator:`
    <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg">
      <path d="M13.86 3.66a.5.5 0 01-.02.7l-7.93 7.48a.6.6 0 01-.84-.02L2.4 9.1a.5.5 0 01.72-.7l2.4 2.44 7.65-7.2a.5.5 0 01.7.02z"/>
    </svg>
  `,expandCollapseGlyph:`
    <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg">
      <path d="M5.65 3.15a.5.5 0 000 .7L9.79 8l-4.14 4.15a.5.5 0 00.7.7l4.5-4.5a.5.5 0 000-.7l-4.5-4.5a.5.5 0 00-.7 0z"/>
    </svg>
  `,radioIndicator:`
    <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg">
      <circle cx="8" cy="8" r="2"/>
    </svg>
  `}),Tb=(s,e)=>De`
    ${ob(s,e,".root")}
  `.withBehaviors(kt(De`
        ${sb(s,e,".root")}
      `)),Eb=(s,e)=>De`
    ${ro("inline-block")}

    ${ib(s,e,".root")}

    ${nb()}

    .root {
      display: flex;
      flex-direction: row;
    }

    .control {
      -webkit-appearance: none;
      color: inherit;
      background: transparent;
      border: 0;
      height: calc(100% - 4px);
      margin-top: auto;
      margin-bottom: auto;
      padding: 0 calc(${mi} * 2px + 1px);
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
    }

    .start,
    .end {
      display: flex;
      margin: auto;
    }

    .start {
      display: flex;
      margin-inline-start: 11px;
    }

    .end {
      display: flex;
      margin-inline-end: 11px;
    }
  `.withBehaviors(Uo("filled",Tb(s,e)),kt(De`
        ${ab(s,e,".root")}
      `));class yf extends vr{appearanceChanged(e,t){e!==t&&(this.classList.add(t),this.classList.remove(e))}connectedCallback(){super.connectedCallback(),this.appearance||(this.appearance="outline")}}ge([Ee],yf.prototype,"appearance",void 0);const Sb=yf.compose({baseName:"text-field",baseClass:vr,template:IA,styles:Eb,shadowOptions:{delegatesFocus:!0}});function Af(s){return _c.getOrCreate(s).withPrefix("fluent")}var Ob={elements:[{name:"Hydrogen",appearance:"colorless gas",atomic_mass:1.008,boil:20.271,category:"diatomic nonmetal",color:null,density:.08988,discovered_by:"Henry Cavendish",melt:13.99,molar_heat:28.836,named_by:"Antoine Lavoisier",number:1,period:1,phase:"Gas",source:"https://en.wikipedia.org/wiki/Hydrogen",spectral_img:"https://en.wikipedia.org/wiki/File:Hydrogen_Spectra.jpg",summary:"Hydrogen is a chemical element with chemical symbol H and atomic number 1. With an atomic weight of 1.00794 u, hydrogen is the lightest element on the periodic table. Its monatomic form (H) is the most abundant chemical substance in the Universe, constituting roughly 75% of all baryonic mass.",symbol:"H",xpos:1,ypos:1,shells:[1],electron_configuration:"1s1",electron_configuration_semantic:"1s1",electron_affinity:72.769,electronegativity_pauling:2.2,ionization_energies:[1312],"cpk-hex":"ffffff"},{name:"Helium",appearance:"colorless gas, exhibiting a red-orange glow when placed in a high-voltage electric field",atomic_mass:4.0026022,boil:4.222,category:"noble gas",color:null,density:.1786,discovered_by:"Pierre Janssen",melt:.95,molar_heat:null,named_by:null,number:2,period:1,phase:"Gas",source:"https://en.wikipedia.org/wiki/Helium",spectral_img:"https://en.wikipedia.org/wiki/File:Helium_spectrum.jpg",summary:"Helium is a chemical element with symbol He and atomic number 2. It is a colorless, odorless, tasteless, non-toxic, inert, monatomic gas that heads the noble gas group in the periodic table. Its boiling and melting points are the lowest among all the elements.",symbol:"He",xpos:18,ypos:1,shells:[2],electron_configuration:"1s2",electron_configuration_semantic:"1s2",electron_affinity:-48,electronegativity_pauling:null,ionization_energies:[2372.3,5250.5],"cpk-hex":"d9ffff"},{name:"Lithium",appearance:"silvery-white",atomic_mass:6.94,boil:1603,category:"alkali metal",color:null,density:.534,discovered_by:"Johan August Arfwedson",melt:453.65,molar_heat:24.86,named_by:null,number:3,period:2,phase:"Solid",source:"https://en.wikipedia.org/wiki/Lithium",spectral_img:null,summary:'Lithium (from Greek:λίθος lithos, "stone") is a chemical element with the symbol Li and atomic number 3. It is a soft, silver-white metal belonging to the alkali metal group of chemical elements. Under standard conditions it is the lightest metal and the least dense solid element.',symbol:"Li",xpos:1,ypos:2,shells:[2,1],electron_configuration:"1s2 2s1",electron_configuration_semantic:"[He] 2s1",electron_affinity:59.6326,electronegativity_pauling:.98,ionization_energies:[520.2,7298.1,11815],"cpk-hex":"cc80ff"},{name:"Beryllium",appearance:"white-gray metallic",atomic_mass:9.01218315,boil:2742,category:"alkaline earth metal",color:null,density:1.85,discovered_by:"Louis Nicolas Vauquelin",melt:1560,molar_heat:16.443,named_by:null,number:4,period:2,phase:"Solid",source:"https://en.wikipedia.org/wiki/Beryllium",spectral_img:null,summary:"Beryllium is a chemical element with symbol Be and atomic number 4. It is created through stellar nucleosynthesis and is a relatively rare element in the universe. It is a divalent element which occurs naturally only in combination with other elements in minerals.",symbol:"Be",xpos:2,ypos:2,shells:[2,2],electron_configuration:"1s2 2s2",electron_configuration_semantic:"[He] 2s2",electron_affinity:-48,electronegativity_pauling:1.57,ionization_energies:[899.5,1757.1,14848.7,21006.6],"cpk-hex":"c2ff00"},{name:"Boron",appearance:"black-brown",atomic_mass:10.81,boil:4200,category:"metalloid",color:null,density:2.08,discovered_by:"Joseph Louis Gay-Lussac",melt:2349,molar_heat:11.087,named_by:null,number:5,period:2,phase:"Solid",source:"https://en.wikipedia.org/wiki/Boron",spectral_img:null,summary:"Boron is a metalloid chemical element with symbol B and atomic number 5. Produced entirely by cosmic ray spallation and supernovae and not by stellar nucleosynthesis, it is a low-abundance element in both the Solar system and the Earth's crust. Boron is concentrated on Earth by the water-solubility of its more common naturally occurring compounds, the borate minerals.",symbol:"B",xpos:13,ypos:2,shells:[2,3],electron_configuration:"1s2 2s2 2p1",electron_configuration_semantic:"[He] 2s2 2p1",electron_affinity:26.989,electronegativity_pauling:2.04,ionization_energies:[800.6,2427.1,3659.7,25025.8,32826.7],"cpk-hex":"ffb5b5"},{name:"Carbon",appearance:null,atomic_mass:12.011,boil:null,category:"polyatomic nonmetal",color:null,density:1.821,discovered_by:"Ancient Egypt",melt:null,molar_heat:8.517,named_by:null,number:6,period:2,phase:"Solid",source:"https://en.wikipedia.org/wiki/Carbon",spectral_img:"https://en.wikipedia.org/wiki/File:Carbon_Spectra.jpg",summary:'Carbon (from Latin:carbo "coal") is a chemical element with symbol C and atomic number 6. On the periodic table, it is the first (row 2) of six elements in column (group) 14, which have in common the composition of their outer electron shell. It is nonmetallic and tetravalent—making four electrons available to form covalent chemical bonds.',symbol:"C",xpos:14,ypos:2,shells:[2,4],electron_configuration:"1s2 2s2 2p2",electron_configuration_semantic:"[He] 2s2 2p2",electron_affinity:121.7763,electronegativity_pauling:2.55,ionization_energies:[1086.5,2352.6,4620.5,6222.7,37831,47277],"cpk-hex":"909090"},{name:"Nitrogen",appearance:"colorless gas, liquid or solid",atomic_mass:14.007,boil:77.355,category:"diatomic nonmetal",color:null,density:1.251,discovered_by:"Daniel Rutherford",melt:63.15,molar_heat:null,named_by:"Jean-Antoine Chaptal",number:7,period:2,phase:"Gas",source:"https://en.wikipedia.org/wiki/Nitrogen",spectral_img:"https://en.wikipedia.org/wiki/File:Nitrogen_Spectra.jpg",summary:"Nitrogen is a chemical element with symbol N and atomic number 7. It is the lightest pnictogen and at room temperature, it is a transparent, odorless diatomic gas. Nitrogen is a common element in the universe, estimated at about seventh in total abundance in the Milky Way and the Solar System.",symbol:"N",xpos:15,ypos:2,shells:[2,5],electron_configuration:"1s2 2s2 2p3",electron_configuration_semantic:"[He] 2s2 2p3",electron_affinity:-6.8,electronegativity_pauling:3.04,ionization_energies:[1402.3,2856,4578.1,7475,9444.9,53266.6,64360],"cpk-hex":"3050f8"},{name:"Oxygen",appearance:null,atomic_mass:15.999,boil:90.188,category:"diatomic nonmetal",color:null,density:1.429,discovered_by:"Carl Wilhelm Scheele",melt:54.36,molar_heat:null,named_by:"Antoine Lavoisier",number:8,period:2,phase:"Gas",source:"https://en.wikipedia.org/wiki/Oxygen",spectral_img:"https://en.wikipedia.org/wiki/File:Oxygen_spectre.jpg",summary:"Oxygen is a chemical element with symbol O and atomic number 8. It is a member of the chalcogen group on the periodic table and is a highly reactive nonmetal and oxidizing agent that readily forms compounds (notably oxides) with most elements. By mass, oxygen is the third-most abundant element in the universe, after hydrogen and helium.",symbol:"O",xpos:16,ypos:2,shells:[2,6],electron_configuration:"1s2 2s2 2p4",electron_configuration_semantic:"[He] 2s2 2p4",electron_affinity:140.976,electronegativity_pauling:3.44,ionization_energies:[1313.9,3388.3,5300.5,7469.2,10989.5,13326.5,71330,84078],"cpk-hex":"ff0d0d"},{name:"Fluorine",appearance:null,atomic_mass:18.9984031636,boil:85.03,category:"diatomic nonmetal",color:null,density:1.696,discovered_by:"André-Marie Ampère",melt:53.48,molar_heat:null,named_by:"Humphry Davy",number:9,period:2,phase:"Gas",source:"https://en.wikipedia.org/wiki/Fluorine",spectral_img:null,summary:"Fluorine is a chemical element with symbol F and atomic number 9. It is the lightest halogen and exists as a highly toxic pale yellow diatomic gas at standard conditions. As the most electronegative element, it is extremely reactive:almost all other elements, including some noble gases, form compounds with fluorine.",symbol:"F",xpos:17,ypos:2,shells:[2,7],electron_configuration:"1s2 2s2 2p5",electron_configuration_semantic:"[He] 2s2 2p5",electron_affinity:328.1649,electronegativity_pauling:3.98,ionization_energies:[1681,3374.2,6050.4,8407.7,11022.7,15164.1,17868,92038.1,106434.3],"cpk-hex":"90e050"},{name:"Neon",appearance:"colorless gas exhibiting an orange-red glow when placed in a high voltage electric field",atomic_mass:20.17976,boil:27.104,category:"noble gas",color:null,density:.9002,discovered_by:"Morris Travers",melt:24.56,molar_heat:null,named_by:null,number:10,period:2,phase:"Gas",source:"https://en.wikipedia.org/wiki/Neon",spectral_img:"https://en.wikipedia.org/wiki/File:Neon_spectra.jpg",summary:"Neon is a chemical element with symbol Ne and atomic number 10. It is in group 18 (noble gases) of the periodic table. Neon is a colorless, odorless, inert monatomic gas under standard conditions, with about two-thirds the density of air.",symbol:"Ne",xpos:18,ypos:2,shells:[2,8],electron_configuration:"1s2 2s2 2p6",electron_configuration_semantic:"[He] 2s2 2p6",electron_affinity:-116,electronegativity_pauling:null,ionization_energies:[2080.7,3952.3,6122,9371,12177,15238,19999,23069.5,115379.5,131432],"cpk-hex":"b3e3f5"},{name:"Sodium",appearance:"silvery white metallic",atomic_mass:22.989769282,boil:1156.09,category:"alkali metal",color:null,density:.968,discovered_by:"Humphry Davy",melt:370.944,molar_heat:28.23,named_by:null,number:11,period:3,phase:"Solid",source:"https://en.wikipedia.org/wiki/Sodium",spectral_img:"https://en.wikipedia.org/wiki/File:Sodium_Spectra.jpg",summary:"Sodium /ˈsoʊdiəm/ is a chemical element with symbol Na (from Ancient Greek Νάτριο) and atomic number 11. It is a soft, silver-white, highly reactive metal. In the Periodic table it is in column 1 (alkali metals), and shares with the other six elements in that column that it has a single electron in its outer shell, which it readily donates, creating a positively charged atom - a cation.",symbol:"Na",xpos:1,ypos:3,shells:[2,8,1],electron_configuration:"1s2 2s2 2p6 3s1",electron_configuration_semantic:"[Ne] 3s1",electron_affinity:52.867,electronegativity_pauling:.93,ionization_energies:[495.8,4562,6910.3,9543,13354,16613,20117,25496,28932,141362,159076],"cpk-hex":"ab5cf2"},{name:"Magnesium",appearance:"shiny grey solid",atomic_mass:24.305,boil:1363,category:"alkaline earth metal",color:null,density:1.738,discovered_by:"Joseph Black",melt:923,molar_heat:24.869,named_by:null,number:12,period:3,phase:"Solid",source:"https://en.wikipedia.org/wiki/Magnesium",spectral_img:"https://en.wikipedia.org/wiki/File:Magnesium_Spectra.jpg",summary:"Magnesium is a chemical element with symbol Mg and atomic number 12. It is a shiny gray solid which bears a close physical resemblance to the other five elements in the second column (Group 2, or alkaline earth metals) of the periodic table:they each have the same electron configuration in their outer electron shell producing a similar crystal structure. Magnesium is the ninth most abundant element in the universe.",symbol:"Mg",xpos:2,ypos:3,shells:[2,8,2],electron_configuration:"1s2 2s2 2p6 3s2",electron_configuration_semantic:"[Ne] 3s2",electron_affinity:-40,electronegativity_pauling:1.31,ionization_energies:[737.7,1450.7,7732.7,10542.5,13630,18020,21711,25661,31653,35458,169988,189368],"cpk-hex":"8aff00"},{name:"Aluminium",appearance:"silvery gray metallic",atomic_mass:26.98153857,boil:2743,category:"post-transition metal",color:null,density:2.7,discovered_by:null,melt:933.47,molar_heat:24.2,named_by:"Humphry Davy",number:13,period:3,phase:"Solid",source:"https://en.wikipedia.org/wiki/Aluminium",spectral_img:null,summary:"Aluminium (or aluminum; see different endings) is a chemical element in the boron group with symbol Al and atomic number 13. It is a silvery-white, soft, nonmagnetic, ductile metal. Aluminium is the third most abundant element (after oxygen and silicon), and the most abundant metal, in the Earth's crust.",symbol:"Al",xpos:13,ypos:3,shells:[2,8,3],electron_configuration:"1s2 2s2 2p6 3s2 3p1",electron_configuration_semantic:"[Ne] 3s2 3p1",electron_affinity:41.762,electronegativity_pauling:1.61,ionization_energies:[577.5,1816.7,2744.8,11577,14842,18379,23326,27465,31853,38473,42647,201266,222316],"cpk-hex":"bfa6a6"},{name:"Silicon",appearance:"crystalline, reflective with bluish-tinged faces",atomic_mass:28.085,boil:3538,category:"metalloid",color:null,density:2.329,discovered_by:"Jöns Jacob Berzelius",melt:1687,molar_heat:19.789,named_by:"Thomas Thomson (chemist)",number:14,period:3,phase:"Solid",source:"https://en.wikipedia.org/wiki/Silicon",spectral_img:"https://en.wikipedia.org/wiki/File:Silicon_Spectra.jpg",summary:"Silicon is a chemical element with symbol Si and atomic number 14. It is a tetravalent metalloid, more reactive than germanium, the metalloid directly below it in the table. Controversy about silicon's character dates to its discovery.",symbol:"Si",xpos:14,ypos:3,shells:[2,8,4],electron_configuration:"1s2 2s2 2p6 3s2 3p2",electron_configuration_semantic:"[Ne] 3s2 3p2",electron_affinity:134.0684,electronegativity_pauling:1.9,ionization_energies:[786.5,1577.1,3231.6,4355.5,16091,19805,23780,29287,33878,38726,45962,50502,235196,257923],"cpk-hex":"f0c8a0"},{name:"Phosphorus",appearance:"colourless, waxy white, yellow, scarlet, red, violet, black",atomic_mass:30.9737619985,boil:null,category:"polyatomic nonmetal",color:null,density:1.823,discovered_by:"Hennig Brand",melt:null,molar_heat:23.824,named_by:null,number:15,period:3,phase:"Solid",source:"https://en.wikipedia.org/wiki/Phosphorus",spectral_img:null,summary:"Phosphorus is a chemical element with symbol P and atomic number 15. As an element, phosphorus exists in two major forms—white phosphorus and red phosphorus—but due to its high reactivity, phosphorus is never found as a free element on Earth. Instead phosphorus-containing minerals are almost always present in their maximally oxidised state, as inorganic phosphate rocks.",symbol:"P",xpos:15,ypos:3,shells:[2,8,5],electron_configuration:"1s2 2s2 2p6 3s2 3p3",electron_configuration_semantic:"[Ne] 3s2 3p3",electron_affinity:72.037,electronegativity_pauling:2.19,ionization_energies:[1011.8,1907,2914.1,4963.6,6273.9,21267,25431,29872,35905,40950,46261,54110,59024,271791,296195],"cpk-hex":"ff8000"},{name:"Sulfur",appearance:"lemon yellow sintered microcrystals",atomic_mass:32.06,boil:717.8,category:"polyatomic nonmetal",color:null,density:2.07,discovered_by:"Ancient china",melt:388.36,molar_heat:22.75,named_by:null,number:16,period:3,phase:"Solid",source:"https://en.wikipedia.org/wiki/Sulfur",spectral_img:"https://en.wikipedia.org/wiki/File:Sulfur_Spectrum.jpg",summary:"Sulfur or sulphur (see spelling differences) is a chemical element with symbol S and atomic number 16. It is an abundant, multivalent non-metal. Under normal conditions, sulfur atoms form cyclic octatomic molecules with chemical formula S8.",symbol:"S",xpos:16,ypos:3,shells:[2,8,6],electron_configuration:"1s2 2s2 2p6 3s2 3p4",electron_configuration_semantic:"[Ne] 3s2 3p4",electron_affinity:200.4101,electronegativity_pauling:2.58,ionization_energies:[999.6,2252,3357,4556,7004.3,8495.8,27107,31719,36621,43177,48710,54460,62930,68216,311048,337138],"cpk-hex":"ffff30"},{name:"Chlorine",appearance:"pale yellow-green gas",atomic_mass:35.45,boil:239.11,category:"diatomic nonmetal",color:null,density:3.2,discovered_by:"Carl Wilhelm Scheele",melt:171.6,molar_heat:null,named_by:null,number:17,period:3,phase:"Gas",source:"https://en.wikipedia.org/wiki/Chlorine",spectral_img:"https://en.wikipedia.org/wiki/File:Chlorine_spectrum_visible.png",summary:"Chlorine is a chemical element with symbol Cl and atomic number 17. It also has a relative atomic mass of 35.5. Chlorine is in the halogen group (17) and is the second lightest halogen following fluorine.",symbol:"Cl",xpos:17,ypos:3,shells:[2,8,7],electron_configuration:"1s2 2s2 2p6 3s2 3p5",electron_configuration_semantic:"[Ne] 3s2 3p5",electron_affinity:348.575,electronegativity_pauling:3.16,ionization_energies:[1251.2,2298,3822,5158.6,6542,9362,11018,33604,38600,43961,51068,57119,63363,72341,78095,352994,380760],"cpk-hex":"1ff01f"},{name:"Argon",appearance:"colorless gas exhibiting a lilac/violet glow when placed in a high voltage electric field",atomic_mass:39.9481,boil:87.302,category:"noble gas",color:null,density:1.784,discovered_by:"Lord Rayleigh",melt:83.81,molar_heat:null,named_by:null,number:18,period:3,phase:"Gas",source:"https://en.wikipedia.org/wiki/Argon",spectral_img:"https://en.wikipedia.org/wiki/File:Argon_Spectrum.png",summary:"Argon is a chemical element with symbol Ar and atomic number 18. It is in group 18 of the periodic table and is a noble gas. Argon is the third most common gas in the Earth's atmosphere, at 0.934% (9,340 ppmv), making it over twice as abundant as the next most common atmospheric gas, water vapor (which averages about 4000 ppmv, but varies greatly), and 23 times as abundant as the next most common non-condensing atmospheric gas, carbon dioxide (400 ppmv), and more than 500 times as abundant as the next most common noble gas, neon (18 ppmv).",symbol:"Ar",xpos:18,ypos:3,shells:[2,8,8],electron_configuration:"1s2 2s2 2p6 3s2 3p6",electron_configuration_semantic:"[Ne] 3s2 3p6",electron_affinity:-96,electronegativity_pauling:null,ionization_energies:[1520.6,2665.8,3931,5771,7238,8781,11995,13842,40760,46186,52002,59653,66199,72918,82473,88576,397605,427066],"cpk-hex":"80d1e3"},{name:"Potassium",appearance:"silvery gray",atomic_mass:39.09831,boil:1032,category:"alkali metal",color:null,density:.862,discovered_by:"Humphry Davy",melt:336.7,molar_heat:29.6,named_by:null,number:19,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Potassium",spectral_img:"https://en.wikipedia.org/wiki/File:Potassium_Spectrum.jpg",summary:"Potassium is a chemical element with symbol K (derived from Neo-Latin, kalium) and atomic number 19. It was first isolated from potash, the ashes of plants, from which its name is derived. In the Periodic table, potassium is one of seven elements in column (group) 1 (alkali metals):they all have a single valence electron in their outer electron shell, which they readily give up to create an atom with a positive charge - a cation, and combine with anions to form salts.",symbol:"K",xpos:1,ypos:4,shells:[2,8,8,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s1",electron_configuration_semantic:"[Ar] 4s1",electron_affinity:48.383,electronegativity_pauling:.82,ionization_energies:[418.8,3052,4420,5877,7975,9590,11343,14944,16963.7,48610,54490,60730,68950,75900,83080,93400,99710,444880,476063],"cpk-hex":"8f40d4"},{name:"Calcium",appearance:null,atomic_mass:40.0784,boil:1757,category:"alkaline earth metal",color:null,density:1.55,discovered_by:"Humphry Davy",melt:1115,molar_heat:25.929,named_by:null,number:20,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Calcium",spectral_img:"https://en.wikipedia.org/wiki/File:Calcium_Spectrum.png",summary:"Calcium is a chemical element with symbol Ca and atomic number 20. Calcium is a soft gray alkaline earth metal, fifth-most-abundant element by mass in the Earth's crust. The ion Ca2+ is also the fifth-most-abundant dissolved ion in seawater by both molarity and mass, after sodium, chloride, magnesium, and sulfate.",symbol:"Ca",xpos:2,ypos:4,shells:[2,8,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2",electron_configuration_semantic:"[Ar] 4s2",electron_affinity:2.37,electronegativity_pauling:1,ionization_energies:[589.8,1145.4,4912.4,6491,8153,10496,12270,14206,18191,20385,57110,63410,70110,78890,86310,94e3,104900,111711,494850,527762],"cpk-hex":"3dff00"},{name:"Scandium",appearance:"silvery white",atomic_mass:44.9559085,boil:3109,category:"transition metal",color:null,density:2.985,discovered_by:"Lars Fredrik Nilson",melt:1814,molar_heat:25.52,named_by:null,number:21,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Scandium",spectral_img:null,summary:"Scandium is a chemical element with symbol Sc and atomic number 21. A silvery-white metallic d-block element, it has historically been sometimes classified as a rare earth element, together with yttrium and the lanthanoids. It was discovered in 1879 by spectral analysis of the minerals euxenite and gadolinite from Scandinavia.",symbol:"Sc",xpos:3,ypos:4,shells:[2,8,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d1",electron_configuration_semantic:"[Ar] 3d1 4s2",electron_affinity:18,electronegativity_pauling:1.36,ionization_energies:[633.1,1235,2388.6,7090.6,8843,10679,13310,15250,17370,21726,24102,66320,73010,80160,89490,97400,105600,117e3,124270,547530,582163],"cpk-hex":"e6e6e6"},{name:"Titanium",appearance:"silvery grey-white metallic",atomic_mass:47.8671,boil:3560,category:"transition metal",color:null,density:4.506,discovered_by:"William Gregor",melt:1941,molar_heat:25.06,named_by:"Martin Heinrich Klaproth",number:22,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Titanium",spectral_img:null,summary:"Titanium is a chemical element with symbol Ti and atomic number 22. It is a lustrous transition metal with a silver color, low density and high strength. It is highly resistant to corrosion in sea water, aqua regia and chlorine.",symbol:"Ti",xpos:4,ypos:4,shells:[2,8,10,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d2",electron_configuration_semantic:"[Ar] 3d2 4s2",electron_affinity:7.289,electronegativity_pauling:1.54,ionization_energies:[658.8,1309.8,2652.5,4174.6,9581,11533,13590,16440,18530,20833,25575,28125,76015,83280,90880,100700,109100,117800,129900,137530,602930,639294],"cpk-hex":"bfc2c7"},{name:"Vanadium",appearance:"blue-silver-grey metal",atomic_mass:50.94151,boil:3680,category:"transition metal",color:null,density:6,discovered_by:"Andrés Manuel del Río",melt:2183,molar_heat:24.89,named_by:"Isotopes of vanadium",number:23,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Vanadium",spectral_img:null,summary:"Vanadium is a chemical element with symbol V and atomic number 23. It is a hard, silvery grey, ductile and malleable transition metal. The element is found only in chemically combined form in nature, but once isolated artificially, the formation of an oxide layer stabilizes the free metal somewhat against further oxidation.",symbol:"V",xpos:5,ypos:4,shells:[2,8,11,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d3",electron_configuration_semantic:"[Ar] 3d3 4s2",electron_affinity:50.911,electronegativity_pauling:1.63,ionization_energies:[650.9,1414,2830,4507,6298.7,12363,14530,16730,19860,22240,24670,29730,32446,86450,94170,102300,112700,121600,130700,143400,151440,661050,699144],"cpk-hex":"a6a6ab"},{name:"Chromium",appearance:"silvery metallic",atomic_mass:51.99616,boil:2944,category:"transition metal",color:null,density:7.19,discovered_by:"Louis Nicolas Vauquelin",melt:2180,molar_heat:23.35,named_by:null,number:24,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Chromium",spectral_img:null,summary:"Chromium is a chemical element with symbol Cr and atomic number 24. It is the first element in Group 6. It is a steely-gray, lustrous, hard and brittle metal which takes a high polish, resists tarnishing, and has a high melting point.",symbol:"Cr",xpos:6,ypos:4,shells:[2,8,13,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s1 3d5",electron_configuration_semantic:"[Ar] 3d5 4s1",electron_affinity:65.21,electronegativity_pauling:1.66,ionization_energies:[652.9,1590.6,2987,4743,6702,8744.9,15455,17820,20190,23580,26130,28750,34230,37066,97510,105800,114300,125300,134700,144300,157700,166090,721870,761733],"cpk-hex":"8a99c7"},{name:"Manganese",appearance:"silvery metallic",atomic_mass:54.9380443,boil:2334,category:"transition metal",color:null,density:7.21,discovered_by:"Torbern Olof Bergman",melt:1519,molar_heat:26.32,named_by:null,number:25,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Manganese",spectral_img:null,summary:"Manganese is a chemical element with symbol Mn and atomic number 25. It is not found as a free element in nature; it is often found in combination with iron, and in many minerals. Manganese is a metal with important industrial metal alloy uses, particularly in stainless steels.",symbol:"Mn",xpos:7,ypos:4,shells:[2,8,13,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d5",electron_configuration_semantic:"[Ar] 3d5 4s2",electron_affinity:-50,electronegativity_pauling:1.55,ionization_energies:[717.3,1509,3248,4940,6990,9220,11500,18770,21400,23960,27590,30330,33150,38880,41987,109480,118100,127100,138600,148500,158600,172500,181380,785450,827067],"cpk-hex":"9c7ac7"},{name:"Iron",appearance:"lustrous metallic with a grayish tinge",atomic_mass:55.8452,boil:3134,category:"transition metal",color:null,density:7.874,discovered_by:"5000 BC",melt:1811,molar_heat:25.1,named_by:null,number:26,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Iron",spectral_img:"https://en.wikipedia.org/wiki/File:Iron_Spectrum.jpg",summary:"Iron is a chemical element with symbol Fe (from Latin:ferrum) and atomic number 26. It is a metal in the first transition series. It is by mass the most common element on Earth, forming much of Earth's outer and inner core.",symbol:"Fe",xpos:8,ypos:4,shells:[2,8,14,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d6",electron_configuration_semantic:"[Ar] 3d6 4s2",electron_affinity:14.785,electronegativity_pauling:1.83,ionization_energies:[762.5,1561.9,2957,5290,7240,9560,12060,14580,22540,25290,28e3,31920,34830,37840,44100,47206,122200,131e3,140500,152600,163e3,173600,188100,195200,851800,895161],"cpk-hex":"e06633"},{name:"Cobalt",appearance:"hard lustrous gray metal",atomic_mass:58.9331944,boil:3200,category:"transition metal",color:"metallic gray",density:8.9,discovered_by:"Georg Brandt",melt:1768,molar_heat:24.81,named_by:null,number:27,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Cobalt",spectral_img:null,summary:"Cobalt is a chemical element with symbol Co and atomic number 27. Like nickel, cobalt in the Earth's crust is found only in chemically combined form, save for small deposits found in alloys of natural meteoric iron. The free element, produced by reductive smelting, is a hard, lustrous, silver-gray metal.",symbol:"Co",xpos:9,ypos:4,shells:[2,8,15,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d7",electron_configuration_semantic:"[Ar] 3d7 4s2",electron_affinity:63.898,electronegativity_pauling:1.88,ionization_energies:[760.4,1648,3232,4950,7670,9840,12440,15230,17959,26570,29400,32400,36600,39700,42800,49396,52737,134810,145170,154700,167400,178100,189300,204500,214100,920870,966023],"cpk-hex":"f090a0"},{name:"Nickel",appearance:"lustrous, metallic, and silver with a gold tinge",atomic_mass:58.69344,boil:3003,category:"transition metal",color:null,density:8.908,discovered_by:"Axel Fredrik Cronstedt",melt:1728,molar_heat:26.07,named_by:null,number:28,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Nickel",spectral_img:null,summary:"Nickel is a chemical element with symbol Ni and atomic number 28. It is a silvery-white lustrous metal with a slight golden tinge. Nickel belongs to the transition metals and is hard and ductile.",symbol:"Ni",xpos:10,ypos:4,shells:[2,8,16,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d8",electron_configuration_semantic:"[Ar] 3d8 4s2",electron_affinity:111.65,electronegativity_pauling:1.91,ionization_energies:[737.1,1753,3395,5300,7339,10400,12800,15600,18600,21670,30970,34e3,37100,41500,44800,48100,55101,58570,148700,159e3,169400,182700,194e3,205600,221400,231490,992718,1039668],"cpk-hex":"50d050"},{name:"Copper",appearance:"red-orange metallic luster",atomic_mass:63.5463,boil:2835,category:"transition metal",color:null,density:8.96,discovered_by:"Middle East",melt:1357.77,molar_heat:24.44,named_by:null,number:29,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Copper",spectral_img:null,summary:"Copper is a chemical element with symbol Cu (from Latin:cuprum) and atomic number 29. It is a soft, malleable and ductile metal with very high thermal and electrical conductivity. A freshly exposed surface of pure copper has a reddish-orange color.",symbol:"Cu",xpos:11,ypos:4,shells:[2,8,18,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s1 3d10",electron_configuration_semantic:"[Ar] 3d10 4s1",electron_affinity:119.235,electronegativity_pauling:1.9,ionization_energies:[745.5,1957.9,3555,5536,7700,9900,13400,16e3,19200,22400,25600,35600,38700,42e3,46700,50200,53700,61100,64702,163700,174100,184900,198800,210500,222700,239100,249660,1067358,1116105],"cpk-hex":"c88033"},{name:"Zinc",appearance:"silver-gray",atomic_mass:65.382,boil:1180,category:"transition metal",color:null,density:7.14,discovered_by:"India",melt:692.68,molar_heat:25.47,named_by:null,number:30,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Zinc",spectral_img:null,summary:"Zinc, in commerce also spelter, is a chemical element with symbol Zn and atomic number 30. It is the first element of group 12 of the periodic table. In some respects zinc is chemically similar to magnesium:its ion is of similar size and its only common oxidation state is +2.",symbol:"Zn",xpos:12,ypos:4,shells:[2,8,18,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10",electron_configuration_semantic:"[Ar] 3d10 4s2",electron_affinity:-58,electronegativity_pauling:1.65,ionization_energies:[906.4,1733.3,3833,5731,7970,10400,12900,16800,19600,23e3,26400,29990,40490,43800,47300,52300,55900,59700,67300,71200,179100],"cpk-hex":"7d80b0"},{name:"Gallium",appearance:"silver-white",atomic_mass:69.7231,boil:2673,category:"post-transition metal",color:null,density:5.91,discovered_by:"Lecoq de Boisbaudran",melt:302.9146,molar_heat:25.86,named_by:null,number:31,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Gallium",spectral_img:null,summary:"Gallium is a chemical element with symbol Ga and atomic number 31. Elemental gallium does not occur in free form in nature, but as the gallium(III) compounds that are in trace amounts in zinc ores and in bauxite. Gallium is a soft, silvery metal, and elemental gallium is a brittle solid at low temperatures, and melts at 29.76 °C (85.57 °F) (slightly above room temperature).",symbol:"Ga",xpos:13,ypos:4,shells:[2,8,18,3],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p1",electron_configuration_semantic:"[Ar] 3d10 4s2 4p1",electron_affinity:41,electronegativity_pauling:1.81,ionization_energies:[578.8,1979.3,2963,6180],"cpk-hex":"c28f8f"},{name:"Germanium",appearance:"grayish-white",atomic_mass:72.6308,boil:3106,category:"metalloid",color:null,density:5.323,discovered_by:"Clemens Winkler",melt:1211.4,molar_heat:23.222,named_by:null,number:32,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Germanium",spectral_img:null,summary:"Germanium is a chemical element with symbol Ge and atomic number 32. It is a lustrous, hard, grayish-white metalloid in the carbon group, chemically similar to its group neighbors tin and silicon. Purified germanium is a semiconductor, with an appearance most similar to elemental silicon.",symbol:"Ge",xpos:14,ypos:4,shells:[2,8,18,4],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p2",electron_configuration_semantic:"[Ar] 3d10 4s2 4p2",electron_affinity:118.9352,electronegativity_pauling:2.01,ionization_energies:[762,1537.5,3302.1,4411,9020],"cpk-hex":"668f8f"},{name:"Arsenic",appearance:"metallic grey",atomic_mass:74.9215956,boil:null,category:"metalloid",color:null,density:5.727,discovered_by:"Bronze Age",melt:null,molar_heat:24.64,named_by:null,number:33,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Arsenic",spectral_img:null,summary:"Arsenic is a chemical element with symbol As and atomic number 33. Arsenic occurs in many minerals, usually in conjunction with sulfur and metals, and also as a pure elemental crystal. Arsenic is a metalloid.",symbol:"As",xpos:15,ypos:4,shells:[2,8,18,5],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p3",electron_configuration_semantic:"[Ar] 3d10 4s2 4p3",electron_affinity:77.65,electronegativity_pauling:2.18,ionization_energies:[947,1798,2735,4837,6043,12310],"cpk-hex":"bd80e3"},{name:"Selenium",appearance:"black, red, and gray (not pictured) allotropes",atomic_mass:78.9718,boil:958,category:"polyatomic nonmetal",color:null,density:4.81,discovered_by:"Jöns Jakob Berzelius",melt:494,molar_heat:25.363,named_by:null,number:34,period:4,phase:"Solid",source:"https://en.wikipedia.org/wiki/Selenium",spectral_img:null,summary:"Selenium is a chemical element with symbol Se and atomic number 34. It is a nonmetal with properties that are intermediate between those of its periodic table column-adjacent chalcogen elements sulfur and tellurium. It rarely occurs in its elemental state in nature, or as pure ore compounds.",symbol:"Se",xpos:16,ypos:4,shells:[2,8,18,6],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p4",electron_configuration_semantic:"[Ar] 3d10 4s2 4p4",electron_affinity:194.9587,electronegativity_pauling:2.55,ionization_energies:[941,2045,2973.7,4144,6590,7880,14990],"cpk-hex":"ffa100"},{name:"Bromine",appearance:null,atomic_mass:79.904,boil:332,category:"diatomic nonmetal",color:null,density:3.1028,discovered_by:"Antoine Jérôme Balard",melt:265.8,molar_heat:null,named_by:null,number:35,period:4,phase:"Liquid",source:"https://en.wikipedia.org/wiki/Bromine",spectral_img:null,summary:'Bromine (from Ancient Greek:βρῶμος, brómos, meaning "stench") is a chemical element with symbol Br, and atomic number 35. It is a halogen. The element was isolated independently by two chemists, Carl Jacob Löwig and Antoine Jerome Balard, in 1825–1826.',symbol:"Br",xpos:17,ypos:4,shells:[2,8,18,7],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p5",electron_configuration_semantic:"[Ar] 3d10 4s2 4p5",electron_affinity:324.537,electronegativity_pauling:2.96,ionization_energies:[1139.9,2103,3470,4560,5760,8550,9940,18600],"cpk-hex":"a62929"},{name:"Krypton",appearance:"colorless gas, exhibiting a whitish glow in a high electric field",atomic_mass:83.7982,boil:119.93,category:"noble gas",color:null,density:3.749,discovered_by:"William Ramsay",melt:115.78,molar_heat:null,named_by:null,number:36,period:4,phase:"Gas",source:"https://en.wikipedia.org/wiki/Krypton",spectral_img:"https://en.wikipedia.org/wiki/File:Krypton_Spectrum.jpg",summary:'Krypton (from Greek:κρυπτός kryptos "the hidden one") is a chemical element with symbol Kr and atomic number 36. It is a member of group 18 (noble gases) elements. A colorless, odorless, tasteless noble gas, krypton occurs in trace amounts in the atmosphere, is isolated by fractionally distilling liquefied air, and is often used with other rare gases in fluorescent lamps.',symbol:"Kr",xpos:18,ypos:4,shells:[2,8,18,8],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6",electron_configuration_semantic:"[Ar] 3d10 4s2 4p6",electron_affinity:-96,electronegativity_pauling:3,ionization_energies:[1350.8,2350.4,3565,5070,6240,7570,10710,12138,22274,25880,29700,33800,37700,43100,47500,52200,57100,61800,75800,80400,85300,90400,96300,101400,111100,116290,282500,296200,311400,326200],"cpk-hex":"5cb8d1"},{name:"Rubidium",appearance:"grey white",atomic_mass:85.46783,boil:961,category:"alkali metal",color:null,density:1.532,discovered_by:"Robert Bunsen",melt:312.45,molar_heat:31.06,named_by:null,number:37,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Rubidium",spectral_img:null,summary:"Rubidium is a chemical element with symbol Rb and atomic number 37. Rubidium is a soft, silvery-white metallic element of the alkali metal group, with an atomic mass of 85.4678. Elemental rubidium is highly reactive, with properties similar to those of other alkali metals, such as very rapid oxidation in air.",symbol:"Rb",xpos:1,ypos:5,shells:[2,8,18,8,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s1",electron_configuration_semantic:"[Kr] 5s1",electron_affinity:46.884,electronegativity_pauling:.82,ionization_energies:[403,2633,3860,5080,6850,8140,9570,13120,14500,26740],"cpk-hex":"702eb0"},{name:"Strontium",appearance:null,atomic_mass:87.621,boil:1650,category:"alkaline earth metal",color:null,density:2.64,discovered_by:"William Cruickshank (chemist)",melt:1050,molar_heat:26.4,named_by:null,number:38,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Strontium",spectral_img:null,summary:"Strontium is a chemical element with symbol Sr and atomic number 38. An alkaline earth metal, strontium is a soft silver-white or yellowish metallic element that is highly reactive chemically. The metal turns yellow when it is exposed to air.",symbol:"Sr",xpos:2,ypos:5,shells:[2,8,18,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2",electron_configuration_semantic:"[Kr] 5s2",electron_affinity:5.023,electronegativity_pauling:.95,ionization_energies:[549.5,1064.2,4138,5500,6910,8760,10230,11800,15600,17100,31270],"cpk-hex":"00ff00"},{name:"Yttrium",appearance:"silvery white",atomic_mass:88.905842,boil:3203,category:"transition metal",color:null,density:4.472,discovered_by:"Johan Gadolin",melt:1799,molar_heat:26.53,named_by:null,number:39,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Yttrium",spectral_img:null,summary:'Yttrium is a chemical element with symbol Y and atomic number 39. It is a silvery-metallic transition metal chemically similar to the lanthanides and it has often been classified as a "rare earth element". Yttrium is almost always found combined with the lanthanides in rare earth minerals and is never found in nature as a free element.',symbol:"Y",xpos:3,ypos:5,shells:[2,8,18,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d1",electron_configuration_semantic:"[Kr] 4d1 5s2",electron_affinity:29.6,electronegativity_pauling:1.22,ionization_energies:[600,1180,1980,5847,7430,8970,11190,12450,14110,18400,19900,36090],"cpk-hex":"94ffff"},{name:"Zirconium",appearance:"silvery white",atomic_mass:91.2242,boil:4650,category:"transition metal",color:null,density:6.52,discovered_by:"Martin Heinrich Klaproth",melt:2128,molar_heat:25.36,named_by:null,number:40,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Zirconium",spectral_img:null,summary:'Zirconium is a chemical element with symbol Zr and atomic number 40. The name of zirconium is taken from the name of the mineral zircon, the most important source of zirconium. The word zircon comes from the Persian word zargun زرگون, meaning "gold-colored".',symbol:"Zr",xpos:4,ypos:5,shells:[2,8,18,10,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d2",electron_configuration_semantic:"[Kr] 4d2 5s2",electron_affinity:41.806,electronegativity_pauling:1.33,ionization_energies:[640.1,1270,2218,3313,7752,9500],"cpk-hex":"94e0e0"},{name:"Niobium",appearance:"gray metallic, bluish when oxidized",atomic_mass:92.906372,boil:5017,category:"transition metal",color:null,density:8.57,discovered_by:"Charles Hatchett",melt:2750,molar_heat:24.6,named_by:null,number:41,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Niobium",spectral_img:null,summary:"Niobium, formerly columbium, is a chemical element with symbol Nb (formerly Cb) and atomic number 41. It is a soft, grey, ductile transition metal, which is often found in the pyrochlore mineral, the main commercial source for niobium, and columbite. The name comes from Greek mythology:Niobe, daughter of Tantalus since it is so similar to tantalum.",symbol:"Nb",xpos:5,ypos:5,shells:[2,8,18,12,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s1 4d4",electron_configuration_semantic:"[Kr] 4d4 5s1",electron_affinity:88.516,electronegativity_pauling:1.6,ionization_energies:[652.1,1380,2416,3700,4877,9847,12100],"cpk-hex":"73c2c9"},{name:"Molybdenum",appearance:"gray metallic",atomic_mass:95.951,boil:4912,category:"transition metal",color:null,density:10.28,discovered_by:"Carl Wilhelm Scheele",melt:2896,molar_heat:24.06,named_by:null,number:42,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Molybdenum",spectral_img:null,summary:"Molybdenum is a chemical element with symbol Mo and atomic number 42. The name is from Neo-Latin molybdaenum, from Ancient Greek Μόλυβδος molybdos, meaning lead, since its ores were confused with lead ores. Molybdenum minerals have been known throughout history, but the element was discovered (in the sense of differentiating it as a new entity from the mineral salts of other metals) in 1778 by Carl Wilhelm Scheele.",symbol:"Mo",xpos:6,ypos:5,shells:[2,8,18,13,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s1 4d5",electron_configuration_semantic:"[Kr] 4d5 5s1",electron_affinity:72.1,electronegativity_pauling:2.16,ionization_energies:[684.3,1560,2618,4480,5257,6640.8,12125,13860,15835,17980,20190,22219,26930,29196,52490,55e3,61400,67700,74e3,80400,87e3,93400,98420,104400,121900,127700,133800,139800,148100,154500],"cpk-hex":"54b5b5"},{name:"Technetium",appearance:"shiny gray metal",atomic_mass:98,boil:4538,category:"transition metal",color:null,density:11,discovered_by:"Emilio Segrè",melt:2430,molar_heat:24.27,named_by:null,number:43,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Technetium",spectral_img:null,summary:"Technetium (/tɛkˈniːʃiəm/) is a chemical element with symbol Tc and atomic number 43. It is the element with the lowest atomic number in the periodic table that has no stable isotopes:every form of it is radioactive. Nearly all technetium is produced synthetically, and only minute amounts are found in nature.",symbol:"Tc",xpos:7,ypos:5,shells:[2,8,18,13,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d5",electron_configuration_semantic:"[Kr] 4d5 5s2",electron_affinity:53,electronegativity_pauling:1.9,ionization_energies:[702,1470,2850],"cpk-hex":"3b9e9e"},{name:"Ruthenium",appearance:"silvery white metallic",atomic_mass:101.072,boil:4423,category:"transition metal",color:null,density:12.45,discovered_by:"Karl Ernst Claus",melt:2607,molar_heat:24.06,named_by:null,number:44,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Ruthenium",spectral_img:null,summary:"Ruthenium is a chemical element with symbol Ru and atomic number 44. It is a rare transition metal belonging to the platinum group of the periodic table. Like the other metals of the platinum group, ruthenium is inert to most other chemicals.",symbol:"Ru",xpos:8,ypos:5,shells:[2,8,18,15,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s1 4d7",electron_configuration_semantic:"[Kr] 4d7 5s1",electron_affinity:100.96,electronegativity_pauling:2.2,ionization_energies:[710.2,1620,2747],"cpk-hex":"248f8f"},{name:"Rhodium",appearance:"silvery white metallic",atomic_mass:102.905502,boil:3968,category:"transition metal",color:null,density:12.41,discovered_by:"William Hyde Wollaston",melt:2237,molar_heat:24.98,named_by:null,number:45,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Rhodium",spectral_img:null,summary:"Rhodium is a chemical element with symbol Rh and atomic number 45. It is a rare, silvery-white, hard, and chemically inert transition metal. It is a member of the platinum group.",symbol:"Rh",xpos:9,ypos:5,shells:[2,8,18,16,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s1 4d8",electron_configuration_semantic:"[Kr] 4d8 5s1",electron_affinity:110.27,electronegativity_pauling:2.28,ionization_energies:[719.7,1740,2997],"cpk-hex":"0a7d8c"},{name:"Palladium",appearance:"silvery white",atomic_mass:106.421,boil:3236,category:"transition metal",color:null,density:12.023,discovered_by:"William Hyde Wollaston",melt:1828.05,molar_heat:25.98,named_by:null,number:46,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Palladium",spectral_img:null,summary:"Palladium is a chemical element with symbol Pd and atomic number 46. It is a rare and lustrous silvery-white metal discovered in 1803 by William Hyde Wollaston. He named it after the asteroid Pallas, which was itself named after the epithet of the Greek goddess Athena, acquired by her when she slew Pallas.",symbol:"Pd",xpos:10,ypos:5,shells:[2,8,18,18],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 4d10",electron_configuration_semantic:"[Kr] 4d10",electron_affinity:54.24,electronegativity_pauling:2.2,ionization_energies:[804.4,1870,3177],"cpk-hex":"006985"},{name:"Silver",appearance:"lustrous white metal",atomic_mass:107.86822,boil:2435,category:"transition metal",color:null,density:10.49,discovered_by:"unknown, before 5000 BC",melt:1234.93,molar_heat:25.35,named_by:null,number:47,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Silver",spectral_img:null,summary:'Silver is a chemical element with symbol Ag (Greek:άργυρος árguros, Latin:argentum, both from the Indo-European root *h₂erǵ- for "grey" or "shining") and atomic number 47. A soft, white, lustrous transition metal, it possesses the highest electrical conductivity, thermal conductivity and reflectivity of any metal. The metal occurs naturally in its pure, free form (native silver), as an alloy with gold and other metals, and in minerals such as argentite and chlorargyrite.',symbol:"Ag",xpos:11,ypos:5,shells:[2,8,18,18,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s1 4d10",electron_configuration_semantic:"[Kr] 4d10 5s1",electron_affinity:125.862,electronegativity_pauling:1.93,ionization_energies:[731,2070,3361],"cpk-hex":"c0c0c0"},{name:"Cadmium",appearance:"silvery bluish-gray metallic",atomic_mass:112.4144,boil:1040,category:"transition metal",color:null,density:8.65,discovered_by:"Karl Samuel Leberecht Hermann",melt:594.22,molar_heat:26.02,named_by:"Isotopes of cadmium",number:48,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Cadmium",spectral_img:null,summary:"Cadmium is a chemical element with symbol Cd and atomic number 48. This soft, bluish-white metal is chemically similar to the two other stable metals in group 12, zinc and mercury. Like zinc, it prefers oxidation state +2 in most of its compounds and like mercury it shows a low melting point compared to transition metals.",symbol:"Cd",xpos:12,ypos:5,shells:[2,8,18,18,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10",electron_configuration_semantic:"[Kr] 4d10 5s2",electron_affinity:-68,electronegativity_pauling:1.69,ionization_energies:[867.8,1631.4,3616],"cpk-hex":"ffd98f"},{name:"Indium",appearance:"silvery lustrous gray",atomic_mass:114.8181,boil:2345,category:"post-transition metal",color:null,density:7.31,discovered_by:"Ferdinand Reich",melt:429.7485,molar_heat:26.74,named_by:null,number:49,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Indium",spectral_img:null,summary:"Indium is a chemical element with symbol In and atomic number 49. It is a post-transition metallic element that is rare in Earth's crust. The metal is very soft, malleable and easily fusible, with a melting point higher than sodium, but lower than lithium or tin.",symbol:"In",xpos:13,ypos:5,shells:[2,8,18,18,3],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p1",electron_configuration_semantic:"[Kr] 4d10 5s2 5p1",electron_affinity:37.043,electronegativity_pauling:1.78,ionization_energies:[558.3,1820.7,2704,5210],"cpk-hex":"a67573"},{name:"Tin",appearance:"silvery-white (beta, β) or gray (alpha, α)",atomic_mass:118.7107,boil:2875,category:"post-transition metal",color:null,density:7.365,discovered_by:"unknown, before 3500 BC",melt:505.08,molar_heat:27.112,named_by:null,number:50,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Tin",spectral_img:null,summary:"Tin is a chemical element with the symbol Sn (for Latin:stannum) and atomic number 50. It is a main group metal in group 14 of the periodic table. Tin shows a chemical similarity to both neighboring group-14 elements, germanium and lead, and has two possible oxidation states, +2 and the slightly more stable +4.",symbol:"Sn",xpos:14,ypos:5,shells:[2,8,18,18,4],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p2",electron_configuration_semantic:"[Kr] 4d10 5s2 5p2",electron_affinity:107.2984,electronegativity_pauling:1.96,ionization_energies:[708.6,1411.8,2943,3930.3,7456],"cpk-hex":"668080"},{name:"Antimony",appearance:"silvery lustrous gray",atomic_mass:121.7601,boil:1908,category:"metalloid",color:null,density:6.697,discovered_by:"unknown, before 3000 BC",melt:903.78,molar_heat:25.23,named_by:null,number:51,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Antimony",spectral_img:null,summary:"Antimony is a chemical element with symbol Sb (from Latin:stibium) and atomic number 51. A lustrous gray metalloid, it is found in nature mainly as the sulfide mineral stibnite (Sb2S3). Antimony compounds have been known since ancient times and were used for cosmetics; metallic antimony was also known, but it was erroneously identified as lead upon its discovery.",symbol:"Sb",xpos:15,ypos:5,shells:[2,8,18,18,5],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p3",electron_configuration_semantic:"[Kr] 4d10 5s2 5p3",electron_affinity:101.059,electronegativity_pauling:2.05,ionization_energies:[834,1594.9,2440,4260,5400,10400],"cpk-hex":"9e63b5"},{name:"Tellurium",appearance:null,atomic_mass:127.603,boil:1261,category:"metalloid",color:null,density:6.24,discovered_by:"Franz-Joseph Müller von Reichenstein",melt:722.66,molar_heat:25.73,named_by:null,number:52,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Tellurium",spectral_img:null,summary:"Tellurium is a chemical element with symbol Te and atomic number 52. It is a brittle, mildly toxic, rare, silver-white metalloid. Tellurium is chemically related to selenium and sulfur.",symbol:"Te",xpos:16,ypos:5,shells:[2,8,18,18,6],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p4",electron_configuration_semantic:"[Kr] 4d10 5s2 5p4",electron_affinity:190.161,electronegativity_pauling:2.1,ionization_energies:[869.3,1790,2698,3610,5668,6820,13200],"cpk-hex":"d47a00"},{name:"Iodine",appearance:"lustrous metallic gray, violet as a gas",atomic_mass:126.904473,boil:457.4,category:"diatomic nonmetal",color:null,density:4.933,discovered_by:"Bernard Courtois",melt:386.85,molar_heat:null,named_by:null,number:53,period:5,phase:"Solid",source:"https://en.wikipedia.org/wiki/Iodine",spectral_img:null,summary:"Iodine is a chemical element with symbol I and atomic number 53. The name is from Greek ἰοειδής ioeidēs, meaning violet or purple, due to the color of iodine vapor. Iodine and its compounds are primarily used in nutrition, and industrially in the production of acetic acid and certain polymers.",symbol:"I",xpos:17,ypos:5,shells:[2,8,18,18,7],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p5",electron_configuration_semantic:"[Kr] 4d10 5s2 5p5",electron_affinity:295.1531,electronegativity_pauling:2.66,ionization_energies:[1008.4,1845.9,3180],"cpk-hex":"940094"},{name:"Xenon",appearance:"colorless gas, exhibiting a blue glow when placed in a high voltage electric field",atomic_mass:131.2936,boil:165.051,category:"noble gas",color:null,density:5.894,discovered_by:"William Ramsay",melt:161.4,molar_heat:null,named_by:null,number:54,period:5,phase:"Gas",source:"https://en.wikipedia.org/wiki/Xenon",spectral_img:"https://en.wikipedia.org/wiki/File:Xenon_Spectrum.jpg",summary:"Xenon is a chemical element with symbol Xe and atomic number 54. It is a colorless, dense, odorless noble gas, that occurs in the Earth's atmosphere in trace amounts. Although generally unreactive, xenon can undergo a few chemical reactions such as the formation of xenon hexafluoroplatinate, the first noble gas compound to be synthesized.",symbol:"Xe",xpos:18,ypos:5,shells:[2,8,18,18,8],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6",electron_configuration_semantic:"[Kr] 4d10 5s2 5p6",electron_affinity:-77,electronegativity_pauling:2.6,ionization_energies:[1170.4,2046.4,3099.4],"cpk-hex":"429eb0"},{name:"Cesium",appearance:"silvery gold",atomic_mass:132.905451966,boil:944,category:"alkali metal",color:null,density:1.93,discovered_by:"Robert Bunsen",melt:301.7,molar_heat:32.21,named_by:null,number:55,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Cesium",spectral_img:null,summary:"Caesium or cesium is a chemical element with symbol Cs and atomic number 55. It is a soft, silvery-gold alkali metal with a melting point of 28 °C (82 °F), which makes it one of only five elemental metals that are liquid at or near room temperature. Caesium is an alkali metal and has physical and chemical properties similar to those of rubidium and potassium.",symbol:"Cs",xpos:1,ypos:6,shells:[2,8,18,18,8,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s1",electron_configuration_semantic:"[Xe] 6s1",electron_affinity:45.505,electronegativity_pauling:.79,ionization_energies:[375.7,2234.3,3400],"cpk-hex":"57178f"},{name:"Barium",appearance:null,atomic_mass:137.3277,boil:2118,category:"alkaline earth metal",color:null,density:3.51,discovered_by:"Carl Wilhelm Scheele",melt:1e3,molar_heat:28.07,named_by:null,number:56,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Barium",spectral_img:null,summary:"Barium is a chemical element with symbol Ba and atomic number 56. It is the fifth element in Group 2, a soft silvery metallic alkaline earth metal. Because of its high chemical reactivity barium is never found in nature as a free element.",symbol:"Ba",xpos:2,ypos:6,shells:[2,8,18,18,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2",electron_configuration_semantic:"[Xe] 6s2",electron_affinity:13.954,electronegativity_pauling:.89,ionization_energies:[502.9,965.2,3600],"cpk-hex":"00c900"},{name:"Lanthanum",appearance:"silvery white",atomic_mass:138.905477,boil:3737,category:"lanthanide",color:null,density:6.162,discovered_by:"Carl Gustaf Mosander",melt:1193,molar_heat:27.11,named_by:null,number:57,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Lanthanum",spectral_img:null,summary:"Lanthanum is a soft, ductile, silvery-white metallic chemical element with symbol La and atomic number 57. It tarnishes rapidly when exposed to air and is soft enough to be cut with a knife. It gave its name to the lanthanide series, a group of 15 similar elements between lanthanum and lutetium in the periodic table:it is also sometimes considered the first element of the 6th-period transition metals.",symbol:"La",xpos:3,ypos:9,shells:[2,8,18,18,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 5d1",electron_configuration_semantic:"[Xe] 5d16s2",electron_affinity:53,electronegativity_pauling:1.1,ionization_energies:[538.1,1067,1850.3,4819,5940],"cpk-hex":"70d4ff"},{name:"Cerium",appearance:"silvery white",atomic_mass:140.1161,boil:3716,category:"lanthanide",color:null,density:6.77,discovered_by:"Martin Heinrich Klaproth",melt:1068,molar_heat:26.94,named_by:null,number:58,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Cerium",spectral_img:null,summary:"Cerium is a chemical element with symbol Ce and atomic number 58. It is a soft, silvery, ductile metal which easily oxidizes in air. Cerium was named after the dwarf planet Ceres (itself named after the Roman goddess of agriculture).",symbol:"Ce",xpos:4,ypos:9,shells:[2,8,18,19,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 5d1 4f1",electron_configuration_semantic:"[Xe] 4f1 5d1 6s2",electron_affinity:55,electronegativity_pauling:1.12,ionization_energies:[534.4,1050,1949,3547,6325,7490],"cpk-hex":"ffffc7"},{name:"Praseodymium",appearance:"grayish white",atomic_mass:140.907662,boil:3403,category:"lanthanide",color:null,density:6.77,discovered_by:"Carl Auer von Welsbach",melt:1208,molar_heat:27.2,named_by:null,number:59,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Praseodymium",spectral_img:null,summary:"Praseodymium is a chemical element with symbol Pr and atomic number 59. Praseodymium is a soft, silvery, malleable and ductile metal in the lanthanide group. It is valued for its magnetic, electrical, chemical, and optical properties.",symbol:"Pr",xpos:5,ypos:9,shells:[2,8,18,21,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f3",electron_configuration_semantic:"[Xe] 4f3 6s2",electron_affinity:93,electronegativity_pauling:1.13,ionization_energies:[527,1020,2086,3761,5551],"cpk-hex":"d9ffc7"},{name:"Neodymium",appearance:"silvery white",atomic_mass:144.2423,boil:3347,category:"lanthanide",color:null,density:7.01,discovered_by:"Carl Auer von Welsbach",melt:1297,molar_heat:27.45,named_by:null,number:60,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Neodymium",spectral_img:null,summary:"Neodymium is a chemical element with symbol Nd and atomic number 60. It is a soft silvery metal that tarnishes in air. Neodymium was discovered in 1885 by the Austrian chemist Carl Auer von Welsbach.",symbol:"Nd",xpos:6,ypos:9,shells:[2,8,18,22,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f4",electron_configuration_semantic:"[Xe] 4f4 6s2",electron_affinity:184.87,electronegativity_pauling:1.14,ionization_energies:[533.1,1040,2130,3900],"cpk-hex":"c7ffc7"},{name:"Promethium",appearance:"metallic",atomic_mass:145,boil:3273,category:"lanthanide",color:null,density:7.26,discovered_by:"Chien Shiung Wu",melt:1315,molar_heat:null,named_by:"Isotopes of promethium",number:61,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Promethium",spectral_img:null,summary:"Promethium, originally prometheum, is a chemical element with the symbol Pm and atomic number 61. All of its isotopes are radioactive; it is one of only two such elements that are followed in the periodic table by elements with stable forms, a distinction shared with technetium. Chemically, promethium is a lanthanide, which forms salts when combined with other elements.",symbol:"Pm",xpos:7,ypos:9,shells:[2,8,18,23,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f5",electron_configuration_semantic:"[Xe] 4f5 6s2",electron_affinity:12.45,electronegativity_pauling:1.13,ionization_energies:[540,1050,2150,3970],"cpk-hex":"a3ffc7"},{name:"Samarium",appearance:"silvery white",atomic_mass:150.362,boil:2173,category:"lanthanide",color:null,density:7.52,discovered_by:"Lecoq de Boisbaudran",melt:1345,molar_heat:29.54,named_by:null,number:62,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Samarium",spectral_img:null,summary:"Samarium is a chemical element with symbol Sm and atomic number 62. It is a moderately hard silvery metal that readily oxidizes in air. Being a typical member of the lanthanide series, samarium usually assumes the oxidation state +3.",symbol:"Sm",xpos:8,ypos:9,shells:[2,8,18,24,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f6",electron_configuration_semantic:"[Xe] 4f6 6s2",electron_affinity:15.63,electronegativity_pauling:1.17,ionization_energies:[544.5,1070,2260,3990],"cpk-hex":"8fffc7"},{name:"Europium",appearance:null,atomic_mass:151.9641,boil:1802,category:"lanthanide",color:null,density:5.264,discovered_by:"Eugène-Anatole Demarçay",melt:1099,molar_heat:27.66,named_by:null,number:63,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Europium",spectral_img:null,summary:"Europium is a chemical element with symbol Eu and atomic number 63. It was isolated in 1901 and is named after the continent of Europe. It is a moderately hard, silvery metal which readily oxidizes in air and water.",symbol:"Eu",xpos:9,ypos:9,shells:[2,8,18,25,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f7",electron_configuration_semantic:"[Xe] 4f7 6s2",electron_affinity:11.2,electronegativity_pauling:1.2,ionization_energies:[547.1,1085,2404,4120],"cpk-hex":"61ffc7"},{name:"Gadolinium",appearance:"silvery white",atomic_mass:157.253,boil:3273,category:"lanthanide",color:null,density:7.9,discovered_by:"Jean Charles Galissard de Marignac",melt:1585,molar_heat:37.03,named_by:null,number:64,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Gadolinium",spectral_img:null,summary:"Gadolinium is a chemical element with symbol Gd and atomic number 64. It is a silvery-white, malleable and ductile rare-earth metal. It is found in nature only in combined (salt) form.",symbol:"Gd",xpos:10,ypos:9,shells:[2,8,18,25,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f7 5d1",electron_configuration_semantic:"[Xe] 4f7 5d1 6s2",electron_affinity:13.22,electronegativity_pauling:1.2,ionization_energies:[593.4,1170,1990,4250],"cpk-hex":"45ffc7"},{name:"Terbium",appearance:"silvery white",atomic_mass:158.925352,boil:3396,category:"lanthanide",color:null,density:8.23,discovered_by:"Carl Gustaf Mosander",melt:1629,molar_heat:28.91,named_by:null,number:65,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Terbium",spectral_img:null,summary:"Terbium is a chemical element with symbol Tb and atomic number 65. It is a silvery-white rare earth metal that is malleable, ductile and soft enough to be cut with a knife. Terbium is never found in nature as a free element, but it is contained in many minerals, including cerite, gadolinite, monazite, xenotime and euxenite.",symbol:"Tb",xpos:11,ypos:9,shells:[2,8,18,27,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f9",electron_configuration_semantic:"[Xe] 4f9 6s2",electron_affinity:112.4,electronegativity_pauling:1.1,ionization_energies:[565.8,1110,2114,3839],"cpk-hex":"30ffc7"},{name:"Dysprosium",appearance:"silvery white",atomic_mass:162.5001,boil:2840,category:"lanthanide",color:null,density:8.54,discovered_by:"Lecoq de Boisbaudran",melt:1680,molar_heat:27.7,named_by:null,number:66,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Dysprosium",spectral_img:null,summary:"Dysprosium is a chemical element with the symbol Dy and atomic number 66. It is a rare earth element with a metallic silver luster. Dysprosium is never found in nature as a free element, though it is found in various minerals, such as xenotime.",symbol:"Dy",xpos:12,ypos:9,shells:[2,8,18,28,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f10",electron_configuration_semantic:"[Xe] 4f10 6s2",electron_affinity:33.96,electronegativity_pauling:1.22,ionization_energies:[573,1130,2200,3990],"cpk-hex":"1fffc7"},{name:"Holmium",appearance:"silvery white",atomic_mass:164.930332,boil:2873,category:"lanthanide",color:null,density:8.79,discovered_by:"Marc Delafontaine",melt:1734,molar_heat:27.15,named_by:null,number:67,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Holmium",spectral_img:null,summary:"Holmium is a chemical element with symbol Ho and atomic number 67. Part of the lanthanide series, holmium is a rare earth element. Holmium was discovered by Swedish chemist Per Theodor Cleve.",symbol:"Ho",xpos:13,ypos:9,shells:[2,8,18,29,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f11",electron_configuration_semantic:"[Xe] 4f11 6s2",electron_affinity:32.61,electronegativity_pauling:1.23,ionization_energies:[581,1140,2204,4100],"cpk-hex":"00ff9c"},{name:"Erbium",appearance:"silvery white",atomic_mass:167.2593,boil:3141,category:"lanthanide",color:null,density:9.066,discovered_by:"Carl Gustaf Mosander",melt:1802,molar_heat:28.12,named_by:null,number:68,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Erbium",spectral_img:null,summary:"Erbium is a chemical element in the lanthanide series, with symbol Er and atomic number 68. A silvery-white solid metal when artificially isolated, natural erbium is always found in chemical combination with other elements on Earth. As such, it is a rare earth element which is associated with several other rare elements in the mineral gadolinite from Ytterby in Sweden, where yttrium, ytterbium, and terbium were discovered.",symbol:"Er",xpos:14,ypos:9,shells:[2,8,18,30,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f12",electron_configuration_semantic:"[Xe] 4f12 6s2",electron_affinity:30.1,electronegativity_pauling:1.24,ionization_energies:[589.3,1150,2194,4120],"cpk-hex":"00e675"},{name:"Thulium",appearance:"silvery gray",atomic_mass:168.934222,boil:2223,category:"lanthanide",color:null,density:9.32,discovered_by:"Per Teodor Cleve",melt:1818,molar_heat:27.03,named_by:null,number:69,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Thulium",spectral_img:null,summary:"Thulium is a chemical element with symbol Tm and atomic number 69. It is the thirteenth and antepenultimate (third-last) element in the lanthanide series. Like the other lanthanides, the most common oxidation state is +3, seen in its oxide, halides and other compounds.",symbol:"Tm",xpos:15,ypos:9,shells:[2,8,18,31,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f13",electron_configuration_semantic:"[Xe] 4f13 6s2",electron_affinity:99,electronegativity_pauling:1.25,ionization_energies:[596.7,1160,2285,4120],"cpk-hex":"00d452"},{name:"Ytterbium",appearance:null,atomic_mass:173.0451,boil:1469,category:"lanthanide",color:null,density:6.9,discovered_by:"Jean Charles Galissard de Marignac",melt:1097,molar_heat:26.74,named_by:null,number:70,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Ytterbium",spectral_img:null,summary:"Ytterbium is a chemical element with symbol Yb and atomic number 70. It is the fourteenth and penultimate element in the lanthanide series, which is the basis of the relative stability of its +2 oxidation state. However, like the other lanthanides, its most common oxidation state is +3, seen in its oxide, halides and other compounds.",symbol:"Yb",xpos:16,ypos:9,shells:[2,8,18,32,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14",electron_configuration_semantic:"[Xe] 4f14 6s2",electron_affinity:-1.93,electronegativity_pauling:1.1,ionization_energies:[603.4,1174.8,2417,4203],"cpk-hex":"00bf38"},{name:"Lutetium",appearance:"silvery white",atomic_mass:174.96681,boil:3675,category:"lanthanide",color:null,density:9.841,discovered_by:"Georges Urbain",melt:1925,molar_heat:26.86,named_by:null,number:71,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Lutetium",spectral_img:null,summary:"Lutetium is a chemical element with symbol Lu and atomic number 71. It is a silvery white metal, which resists corrosion in dry, but not in moist air. It is considered the first element of the 6th-period transition metals and the last element in the lanthanide series, and is traditionally counted among the rare earths.",symbol:"Lu",xpos:17,ypos:9,shells:[2,8,18,32,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d1",electron_configuration_semantic:"[Xe] 4f14 5d1 6s2",electron_affinity:33.4,electronegativity_pauling:1.27,ionization_energies:[523.5,1340,2022.3,4370,6445],"cpk-hex":"00ab24"},{name:"Hafnium",appearance:"steel gray",atomic_mass:178.492,boil:4876,category:"transition metal",color:null,density:13.31,discovered_by:"Dirk Coster",melt:2506,molar_heat:25.73,named_by:null,number:72,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Hafnium",spectral_img:"https://en.wikipedia.org/wiki/File:Hafnium_spectrum_visible.png",summary:"Hafnium is a chemical element with symbol Hf and atomic number 72. A lustrous, silvery gray, tetravalent transition metal, hafnium chemically resembles zirconium and is found in zirconium minerals. Its existence was predicted by Dmitri Mendeleev in 1869, though it was not identified until 1923, making it the penultimate stable element to be discovered (rhenium was identified two years later).",symbol:"Hf",xpos:4,ypos:6,shells:[2,8,18,32,10,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d2",electron_configuration_semantic:"[Xe] 4f14 5d2 6s2",electron_affinity:17.18,electronegativity_pauling:1.3,ionization_energies:[658.5,1440,2250,3216],"cpk-hex":"4dc2ff"},{name:"Tantalum",appearance:"gray blue",atomic_mass:180.947882,boil:5731,category:"transition metal",color:null,density:16.69,discovered_by:"Anders Gustaf Ekeberg",melt:3290,molar_heat:25.36,named_by:null,number:73,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Tantalum",spectral_img:"https://en.wikipedia.org/wiki/File:Tantalum_spectrum_visible.png",summary:"Tantalum is a chemical element with symbol Ta and atomic number 73. Previously known as tantalium, its name comes from Tantalus, an antihero from Greek mythology. Tantalum is a rare, hard, blue-gray, lustrous transition metal that is highly corrosion-resistant.",symbol:"Ta",xpos:5,ypos:6,shells:[2,8,18,32,11,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d3",electron_configuration_semantic:"[Xe] 4f14 5d3 6s2",electron_affinity:31,electronegativity_pauling:1.5,ionization_energies:[761,1500],"cpk-hex":"4da6ff"},{name:"Tungsten",appearance:"grayish white, lustrous",atomic_mass:183.841,boil:6203,category:"transition metal",color:null,density:19.25,discovered_by:"Carl Wilhelm Scheele",melt:3695,molar_heat:24.27,named_by:null,number:74,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Tungsten",spectral_img:null,summary:"Tungsten, also known as wolfram, is a chemical element with symbol W and atomic number 74. The word tungsten comes from the Swedish language tung sten, which directly translates to heavy stone. Its name in Swedish is volfram, however, in order to distinguish it from scheelite, which in Swedish is alternatively named tungsten.",symbol:"W",xpos:6,ypos:6,shells:[2,8,18,32,12,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d4",electron_configuration_semantic:"[Xe] 4f14 5d4 6s2",electron_affinity:78.76,electronegativity_pauling:2.36,ionization_energies:[770,1700],"cpk-hex":"2194d6"},{name:"Rhenium",appearance:"silvery-grayish",atomic_mass:186.2071,boil:5869,category:"transition metal",color:null,density:21.02,discovered_by:"Masataka Ogawa",melt:3459,molar_heat:25.48,named_by:"Walter Noddack",number:75,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Rhenium",spectral_img:null,summary:"Rhenium is a chemical element with symbol Re and atomic number 75. It is a silvery-white, heavy, third-row transition metal in group 7 of the periodic table. With an estimated average concentration of 1 part per billion (ppb), rhenium is one of the rarest elements in the Earth's crust.",symbol:"Re",xpos:7,ypos:6,shells:[2,8,18,32,13,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d5",electron_configuration_semantic:"[Xe] 4f14 5d5 6s2",electron_affinity:5.8273,electronegativity_pauling:1.9,ionization_energies:[760,1260,2510,3640],"cpk-hex":"267dab"},{name:"Osmium",appearance:"silvery, blue cast",atomic_mass:190.233,boil:5285,category:"transition metal",color:null,density:22.59,discovered_by:"Smithson Tennant",melt:3306,molar_heat:24.7,named_by:null,number:76,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Osmium",spectral_img:null,summary:'Osmium (from Greek osme (ὀσμή) meaning "smell") is a chemical element with symbol Os and atomic number 76. It is a hard, brittle, bluish-white transition metal in the platinum group that is found as a trace element in alloys, mostly in platinum ores. Osmium is the densest naturally occurring element, with a density of 22.59 g/cm3.',symbol:"Os",xpos:8,ypos:6,shells:[2,8,18,32,14,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d6",electron_configuration_semantic:"[Xe] 4f14 5d6 6s2",electron_affinity:103.99,electronegativity_pauling:2.2,ionization_energies:[840,1600],"cpk-hex":"266696"},{name:"Iridium",appearance:"silvery white",atomic_mass:192.2173,boil:4403,category:"transition metal",color:null,density:22.56,discovered_by:"Smithson Tennant",melt:2719,molar_heat:25.1,named_by:null,number:77,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Iridium",spectral_img:null,summary:"Iridium is a chemical element with symbol Ir and atomic number 77. A very hard, brittle, silvery-white transition metal of the platinum group, iridium is generally credited with being the second densest element (after osmium) based on measured density, although calculations involving the space lattices of the elements show that iridium is denser. It is also the most corrosion-resistant metal, even at temperatures as high as 2000 °C. Although only certain molten salts and halogens are corrosive to solid iridium, finely divided iridium dust is much more reactive and can be flammable.",symbol:"Ir",xpos:9,ypos:6,shells:[2,8,18,32,15,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d7",electron_configuration_semantic:"[Xe] 4f14 5d7 6s2",electron_affinity:150.94,electronegativity_pauling:2.2,ionization_energies:[880,1600],"cpk-hex":"175487"},{name:"Platinum",appearance:"silvery white",atomic_mass:195.0849,boil:4098,category:"transition metal",color:null,density:21.45,discovered_by:"Antonio de Ulloa",melt:2041.4,molar_heat:25.86,named_by:null,number:78,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Platinum",spectral_img:null,summary:'Platinum is a chemical element with symbol Pt and atomic number 78. It is a dense, malleable, ductile, highly unreactive, precious, gray-white transition metal. Its name is derived from the Spanish term platina, which is literally translated into "little silver".',symbol:"Pt",xpos:10,ypos:6,shells:[2,8,18,32,17,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s1 4f14 5d9",electron_configuration_semantic:"[Xe] 4f14 5d9 6s1",electron_affinity:205.041,electronegativity_pauling:2.28,ionization_energies:[870,1791],"cpk-hex":"d0d0e0"},{name:"Gold",appearance:"metallic yellow",atomic_mass:196.9665695,boil:3243,category:"transition metal",color:null,density:19.3,discovered_by:"Middle East",melt:1337.33,molar_heat:25.418,named_by:null,number:79,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Gold",spectral_img:null,summary:"Gold is a chemical element with symbol Au (from Latin:aurum) and atomic number 79. In its purest form, it is a bright, slightly reddish yellow, dense, soft, malleable and ductile metal. Chemically, gold is a transition metal and a group 11 element.",symbol:"Au",xpos:11,ypos:6,shells:[2,8,18,32,18,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s1 4f14 5d10",electron_configuration_semantic:"[Xe] 4f14 5d10 6s1",electron_affinity:222.747,electronegativity_pauling:2.54,ionization_energies:[890.1,1980],"cpk-hex":"ffd123"},{name:"Mercury",appearance:"silvery",atomic_mass:200.5923,boil:629.88,category:"transition metal",color:null,density:13.534,discovered_by:"unknown, before 2000 BCE",melt:234.321,molar_heat:27.983,named_by:null,number:80,period:6,phase:"Liquid",source:"https://en.wikipedia.org/wiki/Mercury (Element)",spectral_img:null,summary:"Mercury is a chemical element with symbol Hg and atomic number 80. It is commonly known as quicksilver and was formerly named hydrargyrum (/haɪˈdrɑːrdʒərəm/). A heavy, silvery d-block element, mercury is the only metallic element that is liquid at standard conditions for temperature and pressure; the only other element that is liquid under these conditions is bromine, though metals such as caesium, gallium, and rubidium melt just above room temperature.",symbol:"Hg",xpos:12,ypos:6,shells:[2,8,18,32,18,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10",electron_configuration_semantic:"[Xe] 4f14 5d10 6s2",electron_affinity:-48,electronegativity_pauling:2,ionization_energies:[1007.1,1810,3300],"cpk-hex":"b8b8d0"},{name:"Thallium",appearance:"silvery white",atomic_mass:204.38,boil:1746,category:"post-transition metal",color:null,density:11.85,discovered_by:"William Crookes",melt:577,molar_heat:26.32,named_by:null,number:81,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Thallium",spectral_img:null,summary:"Thallium is a chemical element with symbol Tl and atomic number 81. This soft gray post-transition metal is not found free in nature. When isolated, it resembles tin, but discolors when exposed to air.",symbol:"Tl",xpos:13,ypos:6,shells:[2,8,18,32,18,3],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p1",electron_configuration_semantic:"[Xe] 4f14 5d10 6s2 6p1",electron_affinity:36.4,electronegativity_pauling:1.62,ionization_energies:[589.4,1971,2878],"cpk-hex":"a6544d"},{name:"Lead",appearance:"metallic gray",atomic_mass:207.21,boil:2022,category:"post-transition metal",color:null,density:11.34,discovered_by:"Middle East",melt:600.61,molar_heat:26.65,named_by:null,number:82,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Lead_(element)",spectral_img:null,summary:"Lead (/lɛd/) is a chemical element in the carbon group with symbol Pb (from Latin:plumbum) and atomic number 82. Lead is a soft, malleable and heavy post-transition metal. Metallic lead has a bluish-white color after being freshly cut, but it soon tarnishes to a dull grayish color when exposed to air.",symbol:"Pb",xpos:14,ypos:6,shells:[2,8,18,32,18,4],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p2",electron_configuration_semantic:"[Xe] 4f14 5d10 6s2 6p2",electron_affinity:34.4204,electronegativity_pauling:1.87,ionization_energies:[715.6,1450.5,3081.5,4083,6640],"cpk-hex":"575961"},{name:"Bismuth",appearance:"lustrous silver",atomic_mass:208.980401,boil:1837,category:"post-transition metal",color:null,density:9.78,discovered_by:"Claude François Geoffroy",melt:544.7,molar_heat:25.52,named_by:null,number:83,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Bismuth",spectral_img:null,summary:"Bismuth is a chemical element with symbol Bi and atomic number 83. Bismuth, a pentavalent post-transition metal, chemically resembles arsenic and antimony. Elemental bismuth may occur naturally, although its sulfide and oxide form important commercial ores.",symbol:"Bi",xpos:15,ypos:6,shells:[2,8,18,32,18,5],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p3",electron_configuration_semantic:"[Xe] 4f14 5d10 6s2 6p3",electron_affinity:90.924,electronegativity_pauling:2.02,ionization_energies:[703,1610,2466,4370,5400,8520],"cpk-hex":"9e4fb5"},{name:"Polonium",appearance:"silvery",atomic_mass:209,boil:1235,category:"post-transition metal",color:null,density:9.196,discovered_by:"Pierre Curie",melt:527,molar_heat:26.4,named_by:null,number:84,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Polonium",spectral_img:null,summary:"Polonium is a chemical element with symbol Po and atomic number 84, discovered in 1898 by Marie Curie and Pierre Curie. A rare and highly radioactive element with no stable isotopes, polonium is chemically similar to bismuth and tellurium, and it occurs in uranium ores. Applications of polonium are few.",symbol:"Po",xpos:16,ypos:6,shells:[2,8,18,32,18,6],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p4",electron_configuration_semantic:"[Xe] 4f14 5d10 6s2 6p4",electron_affinity:136,electronegativity_pauling:2,ionization_energies:[812.1],"cpk-hex":"ab5c00"},{name:"Astatine",appearance:"unknown, probably metallic",atomic_mass:210,boil:610,category:"metalloid",color:null,density:6.35,discovered_by:"Dale R. Corson",melt:575,molar_heat:null,named_by:null,number:85,period:6,phase:"Solid",source:"https://en.wikipedia.org/wiki/Astatine",spectral_img:null,summary:"Astatine is a very rare radioactive chemical element with the chemical symbol At and atomic number 85. It occurs on Earth as the decay product of various heavier elements. All its isotopes are short-lived; the most stable is astatine-210, with a half-life of 8.1 hours.",symbol:"At",xpos:17,ypos:6,shells:[2,8,18,32,18,7],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p5",electron_configuration_semantic:"[Xe] 4f14 5d10 6s2 6p5",electron_affinity:233,electronegativity_pauling:2.2,ionization_energies:[899.003],"cpk-hex":"754f45"},{name:"Radon",appearance:"colorless gas, occasionally glows green or red in discharge tubes",atomic_mass:222,boil:211.5,category:"noble gas",color:null,density:9.73,discovered_by:"Friedrich Ernst Dorn",melt:202,molar_heat:null,named_by:null,number:86,period:6,phase:"Gas",source:"https://en.wikipedia.org/wiki/Radon",spectral_img:"https://en.wikipedia.org/wiki/File:Radon_spectrum.png",summary:"Radon is a chemical element with symbol Rn and atomic number 86. It is a radioactive, colorless, odorless, tasteless noble gas, occurring naturally as a decay product of radium. Its most stable isotope, 222Rn, has a half-life of 3.8 days.",symbol:"Rn",xpos:18,ypos:6,shells:[2,8,18,32,18,8],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6",electron_configuration_semantic:"[Xe] 4f14 5d10 6s2 6p6",electron_affinity:-68,electronegativity_pauling:2.2,ionization_energies:[1037],"cpk-hex":"428296"},{name:"Francium",appearance:null,atomic_mass:223,boil:950,category:"alkali metal",color:null,density:1.87,discovered_by:"Marguerite Perey",melt:300,molar_heat:null,named_by:null,number:87,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Francium",spectral_img:null,summary:"Francium is a chemical element with symbol Fr and atomic number 87. It used to be known as eka-caesium and actinium K. It is the second-least electronegative element, behind only caesium. Francium is a highly radioactive metal that decays into astatine, radium, and radon.",symbol:"Fr",xpos:1,ypos:7,shells:[2,8,18,32,18,8,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s1",electron_configuration_semantic:"[Rn] 7s1",electron_affinity:46.89,electronegativity_pauling:.79,ionization_energies:[380],"cpk-hex":"420066"},{name:"Radium",appearance:"silvery white metallic",atomic_mass:226,boil:2010,category:"alkaline earth metal",color:null,density:5.5,discovered_by:"Pierre Curie",melt:1233,molar_heat:null,named_by:null,number:88,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Radium",spectral_img:null,summary:"Radium is a chemical element with symbol Ra and atomic number 88. It is the sixth element in group 2 of the periodic table, also known as the alkaline earth metals. Pure radium is almost colorless, but it readily combines with nitrogen (rather than oxygen) on exposure to air, forming a black surface layer of radium nitride (Ra3N2).",symbol:"Ra",xpos:2,ypos:7,shells:[2,8,18,32,18,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2",electron_configuration_semantic:"[Rn] 7s2",electron_affinity:9.6485,electronegativity_pauling:.9,ionization_energies:[509.3,979],"cpk-hex":"007d00"},{name:"Actinium",appearance:null,atomic_mass:227,boil:3500,category:"actinide",color:null,density:10,discovered_by:"Friedrich Oskar Giesel",melt:1500,molar_heat:27.2,named_by:null,number:89,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Actinium",spectral_img:null,summary:"Actinium is a radioactive chemical element with symbol Ac (not to be confused with the abbreviation for an acetyl group) and atomic number 89, which was discovered in 1899. It was the first non-primordial radioactive element to be isolated. Polonium, radium and radon were observed before actinium, but they were not isolated until 1902.",symbol:"Ac",xpos:3,ypos:10,shells:[2,8,18,32,18,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 6d1",electron_configuration_semantic:"[Rn] 6d1 7s2",electron_affinity:33.77,electronegativity_pauling:1.1,ionization_energies:[499,1170],"cpk-hex":"70abfa"},{name:"Thorium",appearance:"silvery, often with black tarnish",atomic_mass:232.03774,boil:5061,category:"actinide",color:null,density:11.724,discovered_by:"Jöns Jakob Berzelius",melt:2023,molar_heat:26.23,named_by:null,number:90,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Thorium",spectral_img:null,summary:"Thorium is a chemical element with symbol Th and atomic number 90. A radioactive actinide metal, thorium is one of only two significantly radioactive elements that still occur naturally in large quantities as a primordial element (the other being uranium). It was discovered in 1828 by the Norwegian Reverend and amateur mineralogist Morten Thrane Esmark and identified by the Swedish chemist Jöns Jakob Berzelius, who named it after Thor, the Norse god of thunder.",symbol:"Th",xpos:4,ypos:10,shells:[2,8,18,32,18,10,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 6d2",electron_configuration_semantic:"[Rn] 6d2 7s2",electron_affinity:112.72,electronegativity_pauling:1.3,ionization_energies:[587,1110,1930,2780],"cpk-hex":"00baff"},{name:"Protactinium",appearance:"bright, silvery metallic luster",atomic_mass:231.035882,boil:4300,category:"actinide",color:null,density:15.37,discovered_by:"William Crookes",melt:1841,molar_heat:null,named_by:"Otto Hahn",number:91,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Protactinium",spectral_img:null,summary:"Protactinium is a chemical element with symbol Pa and atomic number 91. It is a dense, silvery-gray metal which readily reacts with oxygen, water vapor and inorganic acids. It forms various chemical compounds where protactinium is usually present in the oxidation state +5, but can also assume +4 and even +2 or +3 states.",symbol:"Pa",xpos:5,ypos:10,shells:[2,8,18,32,20,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f2 6d1",electron_configuration_semantic:"[Rn] 5f2 6d1 7s2",electron_affinity:53.03,electronegativity_pauling:1.5,ionization_energies:[568],"cpk-hex":"00a1ff"},{name:"Uranium",appearance:null,atomic_mass:238.028913,boil:4404,category:"actinide",color:null,density:19.1,discovered_by:"Martin Heinrich Klaproth",melt:1405.3,molar_heat:27.665,named_by:null,number:92,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Uranium",spectral_img:null,summary:"Uranium is a chemical element with symbol U and atomic number 92. It is a silvery-white metal in the actinide series of the periodic table. A uranium atom has 92 protons and 92 electrons, of which 6 are valence electrons.",symbol:"U",xpos:6,ypos:10,shells:[2,8,18,32,21,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f3 6d1",electron_configuration_semantic:"[Rn] 5f3 6d1 7s2",electron_affinity:50.94,electronegativity_pauling:1.38,ionization_energies:[597.6,1420],"cpk-hex":"008fff"},{name:"Neptunium",appearance:"silvery metallic",atomic_mass:237,boil:4447,category:"actinide",color:null,density:20.45,discovered_by:"Edwin McMillan",melt:912,molar_heat:29.46,named_by:null,number:93,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Neptunium",spectral_img:null,summary:"Neptunium is a chemical element with symbol Np and atomic number 93. A radioactive actinide metal, neptunium is the first transuranic element. Its position in the periodic table just after uranium, named after the planet Uranus, led to it being named after Neptune, the next planet beyond Uranus.",symbol:"Np",xpos:7,ypos:10,shells:[2,8,18,32,22,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f4 6d1",electron_configuration_semantic:"[Rn] 5f4 6d1 7s2",electron_affinity:45.85,electronegativity_pauling:1.36,ionization_energies:[604.5],"cpk-hex":"0080ff"},{name:"Plutonium",appearance:"silvery white, tarnishing to dark gray in air",atomic_mass:244,boil:3505,category:"actinide",color:null,density:19.816,discovered_by:"Glenn T. Seaborg",melt:912.5,molar_heat:35.5,named_by:null,number:94,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Plutonium",spectral_img:null,summary:"Plutonium is a transuranic radioactive chemical element with symbol Pu and atomic number 94. It is an actinide metal of silvery-gray appearance that tarnishes when exposed to air, and forms a dull coating when oxidized. The element normally exhibits six allotropes and four oxidation states.",symbol:"Pu",xpos:8,ypos:10,shells:[2,8,18,32,24,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f6",electron_configuration_semantic:"[Rn] 5f6 7s2",electron_affinity:-48.33,electronegativity_pauling:1.28,ionization_energies:[584.7],"cpk-hex":"006bff"},{name:"Americium",appearance:"silvery white",atomic_mass:243,boil:2880,category:"actinide",color:null,density:12,discovered_by:"Glenn T. Seaborg",melt:1449,molar_heat:62.7,named_by:null,number:95,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Americium",spectral_img:"https://en.wikipedia.org/wiki/File:Americium_spectrum_visible.png",summary:"Americium is a radioactive transuranic chemical element with symbol Am and atomic number 95. This member of the actinide series is located in the periodic table under the lanthanide element europium, and thus by analogy was named after the Americas. Americium was first produced in 1944 by the group of Glenn T.Seaborg from Berkeley, California, at the metallurgical laboratory of University of Chicago.",symbol:"Am",xpos:9,ypos:10,shells:[2,8,18,32,25,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f7",electron_configuration_semantic:"[Rn] 5f7 7s2",electron_affinity:9.93,electronegativity_pauling:1.13,ionization_energies:[578],"cpk-hex":"545cf2"},{name:"Curium",appearance:"silvery metallic, glows purple in the dark",atomic_mass:247,boil:3383,category:"actinide",color:null,density:13.51,discovered_by:"Glenn T. Seaborg",melt:1613,molar_heat:null,named_by:null,number:96,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Curium",spectral_img:null,summary:"Curium is a transuranic radioactive chemical element with symbol Cm and atomic number 96. This element of the actinide series was named after Marie and Pierre Curie – both were known for their research on radioactivity. Curium was first intentionally produced and identified in July 1944 by the group of Glenn T. Seaborg at the University of California, Berkeley.",symbol:"Cm",xpos:10,ypos:10,shells:[2,8,18,32,25,9,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f7 6d1",electron_configuration_semantic:"[Rn] 5f7 6d1 7s2",electron_affinity:27.17,electronegativity_pauling:1.28,ionization_energies:[581],"cpk-hex":"785ce3"},{name:"Berkelium",appearance:"silvery",atomic_mass:247,boil:2900,category:"actinide",color:null,density:14.78,discovered_by:"Lawrence Berkeley National Laboratory",melt:1259,molar_heat:null,named_by:null,number:97,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Berkelium",spectral_img:null,summary:"Berkelium is a transuranic radioactive chemical element with symbol Bk and atomic number 97. It is a member of the actinide and transuranium element series. It is named after the city of Berkeley, California, the location of the University of California Radiation Laboratory where it was discovered in December 1949.",symbol:"Bk",xpos:11,ypos:10,shells:[2,8,18,32,27,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f9",electron_configuration_semantic:"[Rn] 5f9 7s2",electron_affinity:-165.24,electronegativity_pauling:1.3,ionization_energies:[601],"cpk-hex":"8a4fe3"},{name:"Californium",appearance:"silvery",atomic_mass:251,boil:1743,category:"actinide",color:null,density:15.1,discovered_by:"Lawrence Berkeley National Laboratory",melt:1173,molar_heat:null,named_by:null,number:98,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Californium",spectral_img:null,summary:"Californium is a radioactive metallic chemical element with symbol Cf and atomic number 98. The element was first made in 1950 at the University of California Radiation Laboratory in Berkeley, by bombarding curium with alpha particles (helium-4 ions). It is an actinide element, the sixth transuranium element to be synthesized, and has the second-highest atomic mass of all the elements that have been produced in amounts large enough to see with the unaided eye (after einsteinium).",symbol:"Cf",xpos:12,ypos:10,shells:[2,8,18,32,28,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f10",electron_configuration_semantic:"[Rn] 5f10 7s2",electron_affinity:-97.31,electronegativity_pauling:1.3,ionization_energies:[608],"cpk-hex":"a136d4"},{name:"Einsteinium",appearance:"silver-colored",atomic_mass:252,boil:1269,category:"actinide",color:null,density:8.84,discovered_by:"Lawrence Berkeley National Laboratory",melt:1133,molar_heat:null,named_by:null,number:99,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Einsteinium",spectral_img:null,summary:"Einsteinium is a synthetic element with symbol Es and atomic number 99. It is the seventh transuranic element, and an actinide. Einsteinium was discovered as a component of the debris of the first hydrogen bomb explosion in 1952, and named after Albert Einstein.",symbol:"Es",xpos:13,ypos:10,shells:[2,8,18,32,29,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f11",electron_configuration_semantic:"[Rn] 5f11 7s2",electron_affinity:-28.6,electronegativity_pauling:1.3,ionization_energies:[619],"cpk-hex":"b31fd4"},{name:"Fermium",appearance:null,atomic_mass:257,boil:null,category:"actinide",color:null,density:null,discovered_by:"Lawrence Berkeley National Laboratory",melt:1800,molar_heat:null,named_by:null,number:100,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Fermium",spectral_img:null,summary:"Fermium is a synthetic element with symbol Fm and atomic number 100. It is a member of the actinide series. It is the heaviest element that can be formed by neutron bombardment of lighter elements, and hence the last element that can be prepared in macroscopic quantities, although pure fermium metal has not yet been prepared.",symbol:"Fm",xpos:14,ypos:10,shells:[2,8,18,32,30,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f12",electron_configuration_semantic:"[Rn] 5f12 7s2",electron_affinity:33.96,electronegativity_pauling:1.3,ionization_energies:[627],"cpk-hex":"b31fba"},{name:"Mendelevium",appearance:null,atomic_mass:258,boil:null,category:"actinide",color:null,density:null,discovered_by:"Lawrence Berkeley National Laboratory",melt:1100,molar_heat:null,named_by:null,number:101,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Mendelevium",spectral_img:null,summary:"Mendelevium is a synthetic element with chemical symbol Md (formerly Mv) and atomic number 101. A metallic radioactive transuranic element in the actinide series, it is the first element that currently cannot be produced in macroscopic quantities through neutron bombardment of lighter elements. It is the antepenultimate actinide and the ninth transuranic element.",symbol:"Md",xpos:15,ypos:10,shells:[2,8,18,32,31,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f13",electron_configuration_semantic:"[Rn] 5f13 7s2",electron_affinity:93.91,electronegativity_pauling:1.3,ionization_energies:[635],"cpk-hex":"b30da6"},{name:"Nobelium",appearance:null,atomic_mass:259,boil:null,category:"actinide",color:null,density:null,discovered_by:"Joint Institute for Nuclear Research",melt:1100,molar_heat:null,named_by:null,number:102,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Nobelium",spectral_img:null,summary:"Nobelium is a synthetic chemical element with symbol No and atomic number 102. It is named in honor of Alfred Nobel, the inventor of dynamite and benefactor of science. A radioactive metal, it is the tenth transuranic element and is the penultimate member of the actinide series.",symbol:"No",xpos:16,ypos:10,shells:[2,8,18,32,32,8,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14",electron_configuration_semantic:"[Rn] 5f14 7s2",electron_affinity:-223.22,electronegativity_pauling:1.3,ionization_energies:[642],"cpk-hex":"bd0d87"},{name:"Lawrencium",appearance:null,atomic_mass:266,boil:null,category:"actinide",color:null,density:null,discovered_by:"Lawrence Berkeley National Laboratory",melt:1900,molar_heat:null,named_by:null,number:103,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Lawrencium",spectral_img:null,summary:"Lawrencium is a synthetic chemical element with chemical symbol Lr (formerly Lw) and atomic number 103. It is named in honor of Ernest Lawrence, inventor of the cyclotron, a device that was used to discover many artificial radioactive elements. A radioactive metal, lawrencium is the eleventh transuranic element and is also the final member of the actinide series.",symbol:"Lr",xpos:17,ypos:10,shells:[2,8,18,32,32,8,3],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 7p1",electron_configuration_semantic:"[Rn] 5f14 7s2 7p1",electron_affinity:-30.04,electronegativity_pauling:1.3,ionization_energies:[470],"cpk-hex":"c70066"},{name:"Rutherfordium",appearance:null,atomic_mass:267,boil:5800,category:"transition metal",color:null,density:23.2,discovered_by:"Joint Institute for Nuclear Research",melt:2400,molar_heat:null,named_by:null,number:104,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Rutherfordium",spectral_img:null,summary:"Rutherfordium is a chemical element with symbol Rf and atomic number 104, named in honor of physicist Ernest Rutherford. It is a synthetic element (an element that can be created in a laboratory but is not found in nature) and radioactive; the most stable known isotope, 267Rf, has a half-life of approximately 1.3 hours. In the periodic table of the elements, it is a d - block element and the second of the fourth - row transition elements.",symbol:"Rf",xpos:4,ypos:7,shells:[2,8,18,32,32,10,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d2",electron_configuration_semantic:"[Rn] 5f14 6d2 7s2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[580],"cpk-hex":"cc0059"},{name:"Dubnium",appearance:null,atomic_mass:268,boil:null,category:"transition metal",color:null,density:29.3,discovered_by:"Joint Institute for Nuclear Research",melt:null,molar_heat:null,named_by:null,number:105,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Dubnium",spectral_img:null,summary:"Dubnium is a chemical element with symbol Db and atomic number 105. It is named after the town of Dubna in Russia (north of Moscow), where it was first produced. It is a synthetic element (an element that can be created in a laboratory but is not found in nature) and radioactive; the most stable known isotope, dubnium-268, has a half-life of approximately 28 hours.",symbol:"Db",xpos:5,ypos:7,shells:[2,8,18,32,32,11,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d3",electron_configuration_semantic:"*[Rn] 5f14 6d3 7s2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":"d1004f"},{name:"Seaborgium",appearance:null,atomic_mass:269,boil:null,category:"transition metal",color:null,density:35,discovered_by:"Lawrence Berkeley National Laboratory",melt:null,molar_heat:null,named_by:null,number:106,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Seaborgium",spectral_img:null,summary:"Seaborgium is a synthetic element with symbol Sg and atomic number 106. Its most stable isotope 271Sg has a half-life of 1.9 minutes. A more recently discovered isotope 269Sg has a potentially slightly longer half-life (ca.",symbol:"Sg",xpos:6,ypos:7,shells:[2,8,18,32,32,12,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d4",electron_configuration_semantic:"*[Rn] 5f14 6d4 7s2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":"d90045"},{name:"Bohrium",appearance:null,atomic_mass:270,boil:null,category:"transition metal",color:null,density:37.1,discovered_by:"Gesellschaft für Schwerionenforschung",melt:null,molar_heat:null,named_by:null,number:107,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Bohrium",spectral_img:null,summary:"Bohrium is a chemical element with symbol Bh and atomic number 107. It is named after Danish physicist Niels Bohr. It is a synthetic element (an element that can be created in a laboratory but is not found in nature) and radioactive; the most stable known isotope, 270Bh, has a half-life of approximately 61 seconds.",symbol:"Bh",xpos:7,ypos:7,shells:[2,8,18,32,32,13,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d5",electron_configuration_semantic:"*[Rn] 5f14 6d5 7s2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":"e00038"},{name:"Hassium",appearance:null,atomic_mass:269,boil:null,category:"transition metal",color:null,density:40.7,discovered_by:"Gesellschaft für Schwerionenforschung",melt:126,molar_heat:null,named_by:null,number:108,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Hassium",spectral_img:null,summary:"Hassium is a chemical element with symbol Hs and atomic number 108, named after the German state of Hesse. It is a synthetic element (an element that can be created in a laboratory but is not found in nature) and radioactive; the most stable known isotope, 269Hs, has a half-life of approximately 9.7 seconds, although an unconfirmed metastable state, 277mHs, may have a longer half-life of about 130 seconds. More than 100 atoms of hassium have been synthesized to date.",symbol:"Hs",xpos:8,ypos:7,shells:[2,8,18,32,32,14,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d6",electron_configuration_semantic:"*[Rn] 5f14 6d6 7s2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":"e6002e"},{name:"Meitnerium",appearance:null,atomic_mass:278,boil:null,category:"unknown, probably transition metal",color:null,density:37.4,discovered_by:"Gesellschaft für Schwerionenforschung",melt:null,molar_heat:null,named_by:null,number:109,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Meitnerium",spectral_img:null,summary:"Meitnerium is a chemical element with symbol Mt and atomic number 109. It is an extremely radioactive synthetic element (an element not found in nature that can be created in a laboratory). The most stable known isotope, meitnerium-278, has a half-life of 7.6 seconds.",symbol:"Mt",xpos:9,ypos:7,shells:[2,8,18,32,32,15,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d7",electron_configuration_semantic:"*[Rn] 5f14 6d7 7s2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":"eb0026"},{name:"Darmstadtium",appearance:null,atomic_mass:281,boil:null,category:"unknown, probably transition metal",color:null,density:34.8,discovered_by:"Gesellschaft für Schwerionenforschung",melt:null,molar_heat:null,named_by:null,number:110,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Darmstadtium",spectral_img:null,summary:"Darmstadtium is a chemical element with symbol Ds and atomic number 110. It is an extremely radioactive synthetic element. The most stable known isotope, darmstadtium-281, has a half-life of approximately 10 seconds.",symbol:"Ds",xpos:10,ypos:7,shells:[2,8,18,32,32,16,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d8",electron_configuration_semantic:"*[Rn] 5f14 6d9 7s1",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Roentgenium",appearance:null,atomic_mass:282,boil:null,category:"unknown, probably transition metal",color:null,density:28.7,discovered_by:"Gesellschaft für Schwerionenforschung",melt:null,molar_heat:null,named_by:null,number:111,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Roentgenium",spectral_img:null,summary:"Roentgenium is a chemical element with symbol Rg and atomic number 111. It is an extremely radioactive synthetic element (an element that can be created in a laboratory but is not found in nature); the most stable known isotope, roentgenium-282, has a half-life of 2.1 minutes. Roentgenium was first created in 1994 by the GSI Helmholtz Centre for Heavy Ion Research near Darmstadt, Germany.",symbol:"Rg",xpos:11,ypos:7,shells:[2,8,18,32,32,17,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d9",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s1",electron_affinity:151,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Copernicium",appearance:null,atomic_mass:285,boil:3570,category:"transition metal",color:null,density:23.7,discovered_by:"Gesellschaft für Schwerionenforschung",melt:null,molar_heat:null,named_by:null,number:112,period:7,phase:"Gas",source:"https://en.wikipedia.org/wiki/Copernicium",spectral_img:null,summary:"Copernicium is a chemical element with symbol Cn and atomic number 112. It is an extremely radioactive synthetic element that can only be created in a laboratory. The most stable known isotope, copernicium-285, has a half-life of approximately 29 seconds, but it is possible that this copernicium isotope may have a nuclear isomer with a longer half-life, 8.9 min.",symbol:"Cn",xpos:12,ypos:7,shells:[2,8,18,32,32,18,2],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Nihonium",appearance:null,atomic_mass:286,boil:1430,category:"unknown, probably transition metal",color:null,density:16,discovered_by:"RIKEN",melt:700,molar_heat:null,named_by:null,number:113,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Ununtrium",spectral_img:null,summary:"Nihonium is a chemical element with atomic number 113. It has a symbol Nh. It is a synthetic element (an element that can be created in a laboratory but is not found in nature) and is extremely radioactive; its most stable known isotope, nihonium-286, has a half-life of 20 seconds.",symbol:"Nh",xpos:13,ypos:7,shells:[2,8,18,32,32,18,3],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10 7p1",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s2 7p1",electron_affinity:66.6,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Flerovium",appearance:null,atomic_mass:289,boil:420,category:"post-transition metal",color:null,density:14,discovered_by:"Joint Institute for Nuclear Research",melt:340,molar_heat:null,named_by:null,number:114,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Flerovium",spectral_img:null,summary:"Flerovium is a superheavy artificial chemical element with symbol Fl and atomic number 114. It is an extremely radioactive synthetic element. The element is named after the Flerov Laboratory of Nuclear Reactions of the Joint Institute for Nuclear Research in Dubna, Russia, where the element was discovered in 1998.",symbol:"Fl",xpos:14,ypos:7,shells:[2,8,18,32,32,18,4],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10 7p2",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s2 7p2",electron_affinity:null,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Moscovium",appearance:null,atomic_mass:289,boil:1400,category:"unknown, probably post-transition metal",color:null,density:13.5,discovered_by:"Joint Institute for Nuclear Research",melt:670,molar_heat:null,named_by:null,number:115,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Ununpentium",spectral_img:null,summary:"Moscovium is the name of a synthetic superheavy element in the periodic table that has the symbol Mc and has the atomic number 115. It is an extremely radioactive element; its most stable known isotope, moscovium-289, has a half-life of only 220 milliseconds. It is also known as eka-bismuth or simply element 115.",symbol:"Mc",xpos:15,ypos:7,shells:[2,8,18,32,32,18,5],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10 7p3",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s2 7p3",electron_affinity:35.3,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Livermorium",appearance:null,atomic_mass:293,boil:1085,category:"unknown, probably post-transition metal",color:null,density:12.9,discovered_by:"Joint Institute for Nuclear Research",melt:709,molar_heat:null,named_by:null,number:116,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Livermorium",spectral_img:null,summary:"Livermorium is a synthetic superheavy element with symbol Lv and atomic number 116. It is an extremely radioactive element that has only been created in the laboratory and has not been observed in nature. The element is named after the Lawrence Livermore National Laboratory in the United States, which collaborated with the Joint Institute for Nuclear Research in Dubna, Russia to discover livermorium in 2000.",symbol:"Lv",xpos:16,ypos:7,shells:[2,8,18,32,32,18,6],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10 7p4",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s2 7p4",electron_affinity:74.9,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Tennessine",appearance:null,atomic_mass:294,boil:883,category:"unknown, probably metalloid",color:null,density:7.17,discovered_by:"Joint Institute for Nuclear Research",melt:723,molar_heat:null,named_by:null,number:117,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Tennessine",spectral_img:null,summary:"Tennessine is a superheavy artificial chemical element with an atomic number of 117 and a symbol of Ts. Also known as eka-astatine or element 117, it is the second-heaviest known element and penultimate element of the 7th period of the periodic table. As of 2016, fifteen tennessine atoms have been observed:six when it was first synthesized in 2010, seven in 2012, and two in 2014.",symbol:"Ts",xpos:17,ypos:7,shells:[2,8,18,32,32,18,7],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10 7p5",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s2 7p5",electron_affinity:165.9,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Oganesson",appearance:null,atomic_mass:294,boil:350,category:"unknown, predicted to be noble gas",color:null,density:4.95,discovered_by:"Joint Institute for Nuclear Research",melt:null,molar_heat:null,named_by:null,number:118,period:7,phase:"Solid",source:"https://en.wikipedia.org/wiki/Oganesson",spectral_img:null,summary:"Oganesson is IUPAC's name for the transactinide element with the atomic number 118 and element symbol Og. It is also known as eka-radon or element 118, and on the periodic table of the elements it is a p-block element and the last one of the 7th period. Oganesson is currently the only synthetic member of group 18.",symbol:"Og",xpos:18,ypos:7,shells:[2,8,18,32,32,18,8],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10 7p6",electron_configuration_semantic:"*[Rn] 5f14 6d10 7s2 7p6",electron_affinity:5.40318,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null},{name:"Ununennium",appearance:null,atomic_mass:315,boil:630,category:"unknown, but predicted to be an alkali metal",color:null,density:3,discovered_by:"GSI Helmholtz Centre for Heavy Ion Research",melt:null,molar_heat:null,named_by:null,number:119,period:8,phase:"Solid",source:"https://en.wikipedia.org/wiki/Ununennium",spectral_img:null,summary:"Ununennium, also known as eka-francium or simply element 119, is the hypothetical chemical element with symbol Uue and atomic number 119. Ununennium and Uue are the temporary systematic IUPAC name and symbol respectively, until a permanent name is decided upon. In the periodic table of the elements, it is expected to be an s-block element, an alkali metal, and the first element in the eighth period.",symbol:"Uue",xpos:1,ypos:8,shells:[2,8,18,32,32,18,8,1],electron_configuration:"1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6 7s2 5f14 6d10 7p6 8s1",electron_configuration_semantic:"*[Uuo] 8s1",electron_affinity:63.87,electronegativity_pauling:null,ionization_energies:[],"cpk-hex":null}]};const bb=(s,e)=>De`
	${lb(s,e)}

  :host {
    min-width:30px;
    height:30px;
  }
  
	:host .control {
		padding:0px;
    
	}

`;class vb extends El{connectedCallback(){super.connectedCallback()}}const kb=vb.compose({baseName:"element-button",baseClass:El,template:mc,styles:bb,shadowOptions:{delegatesFocus:!0}});var Ib=Object.defineProperty,Db=Object.getOwnPropertyDescriptor,Rb=(s,e,t,n)=>{for(var i=n>1?void 0:n?Db(e,t):e,r=s.length-1,a;r>=0;r--)(a=s[r])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Ib(e,t,i),i};De`
  .hidden {
    display: none;
  }
  .control{
	  overflow-x:scroll;
  }
  
`;let hp=class extends Kr{};hp=Rb([sc({name:"fluent-dialog-ex"})],hp);var Pb=Object.defineProperty,Nb=Object.getOwnPropertyDescriptor,Mc=(s,e,t,n)=>{for(var i=n>1?void 0:n?Nb(e,t):e,r=s.length-1,a;r>=0;r--)(a=s[r])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Pb(e,t,i),i};Af().register(Cf()).register(_f()).register(gb()).register(pb()).register(hb()).register(kb());const Mb=ht`
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous" /> -->

<fluent-design-system-provider use-defaults>
	<fluent-dialog ${tr("mainModal")} modal ?hidden="${s=>!s.visible}" style="width:auto;"> 
		<div class="modal-header">
        	<h5 class="modal-title" id="exampleModalLabel">Periodic Table Element Picker</h5>
      	</div>

		<div class="modal-body" >
			<div style="margin-left:auto;margin-right:auto;">
				<fluent-data-grid ${tr("periodicTableGrid")} grid-template-columns="34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px 34px" ></fluent-data-grid>
			</div>
		</div>
		<div class="modal-footer">
			<fluent-button class="btn btn-primary" appearance="accent" primary @click="${s=>s.cancelClick()}">Close</fluent-button>
		</div>
	</fluent-dialog-ex>


</fluent-design-system-provider>
`,xb=De`
  .hidden {
    display: none;
  }

`;let xs=class extends to{constructor(){super(...arguments);oe(this,"visible",!1);oe(this,"hideTransitionMetals",!0);oe(this,"cancelButton");oe(this,"overlay");oe(this,"mainModal");oe(this,"periodicTableGrid")}connectedCallback(){super.connectedCallback(),this.overlay=this.ownerDocument.createElement("div"),this.overlay.classList.add("modal-backdrop"),this.overlay.classList.add("fade"),this.querySelectorAll(".element");let e=Ob.elements;var t=new Array,n=new Map;for(let u=1;u<(this.hideTransitionMetals?7:11);u++){for(let c=1;c<=18;c++){let d=e.find(h=>h.xpos==c&&h.ypos==u);d!==void 0?n.set(c,d):n.set(c,{number:-1})}t.push(n),n=new Map}this.periodicTableGrid.rowsData=t;const i=ht`
			<template>
				${vi(u=>u.rowData===null||u.columnDefinition===null||u.columnDefinition.columnDataKey===null?!1:u.columnDefinition.columnDataKey!="0"&&u.rowData.get(+u.columnDefinition.columnDataKey)!=null&&u.rowData.get(+u.columnDefinition.columnDataKey).number!=-1,ht`
				<fluent-element-button style="padding:0;" @click="${u=>u.rowData===null||u.columnDefinition===null||u.columnDefinition.columnDataKey===null?null:this.$emit("change",u.rowData.get(+u.columnDefinition.columnDataKey).symbol)}">
						${u=>u.rowData===null||u.columnDefinition===null||u.columnDefinition.columnDataKey===null?null:u.rowData.get(+u.columnDefinition.columnDataKey).symbol}
				</fluent-element-button>
				`)}
			</template>
			`,r=ht`
			<fluent-data-grid-cell
				style="padding:0;"
				grid-column="${(u,c)=>c.index+1}"
				:rowData="${(u,c)=>c.parent.rowData}"
				:columnDefinition="${u=>u}"
			></fluent-data-grid-cell>
			`,a=ht`
		<fluent-data-grid-row
					style="padding:0;border-bottom:0;"
			:rowData="${u=>u}"
			:cellItemTemplate="${(u,c)=>c.parent.cellItemTemplate}"
			:headerCellItemTemplate="${(u,c)=>c.parent.headerCellItemTemplate}"
		></fluent-data-grid-row>
		`,o=ht`
			<fluent-data-grid-cell style="width:32px;"
				cell-type="columnheader"
				grid-column="${(u,c)=>c.index+1}"
				:columnDefinition="${u=>u}"
			></fluent-data-grid-cell>
		`;let l;this.hideTransitionMetals?l=[{columnDataKey:"1",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"2",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"0",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"13",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"14",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"15",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"16",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"17",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"18",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget}]:l=[{columnDataKey:"1",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"2",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"3",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"4",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"5",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"6",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"7",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"8",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"9",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"10",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"11",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"12",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"13",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"14",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"15",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"16",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"17",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget},{columnDataKey:"18",cellTemplate:i,cellFocusTargetCallback:this.getFocusTarget}],this.periodicTableGrid.columnDefinitions=l,this.periodicTableGrid.rowItemTemplate=a,this.periodicTableGrid.cellItemTemplate=r,this.periodicTableGrid.headerCellItemTemplate=o}visibleChanged(e,t){this.overlay!=null&&t&&this.periodicTableGrid.focus()}getFocusTarget(e){return e.querySelector("fluent-element-button")}mousedown(e){this.cancelClick()}cancelClick(){this.visible=!1,this.$emit("dismiss")}};Mc([Ee({mode:"boolean"})],xs.prototype,"visible",2);Mc([Ee({mode:"boolean"})],xs.prototype,"hideTransitionMetals",2);xs=Mc([sc({name:"periodic-table-modal",template:Mb,styles:xb})],xs);var Vu=function(s,e){return Vu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},Vu(s,e)};function ho(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Vu(s,e);function t(){this.constructor=s}s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Lb(s,e,t,n){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function o(c){try{u(n.next(c))}catch(d){a(d)}}function l(c){try{u(n.throw(c))}catch(d){a(d)}}function u(c){c.done?r(c.value):i(c.value).then(o,l)}u((n=n.apply(s,[])).next())})}function Tf(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,i,r,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(r=u[0]&2?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){t.label=u[1];break}if(u[0]===6&&t.label<r[1]){t.label=r[1],r=u;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(u);break}r[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(s,t)}catch(c){u=[6,c],i=0}finally{n=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function eo(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],n=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ls(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var n=t.call(s),i,r=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)r.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return r}function Ks(s,e,t){if(arguments.length===2)for(var n=0,i=e.length,r;n<i;n++)(r||!(n in e))&&(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return s.concat(r||Array.prototype.slice.call(e))}function Gn(s){return this instanceof Gn?(this.v=s,this):new Gn(s)}function Kb(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),i,r=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(h){n[h]&&(i[h]=function(p){return new Promise(function(g,f){r.push([h,p,g,f])>1||o(h,p)})})}function o(h,p){try{l(n[h](p))}catch(g){d(r[0][3],g)}}function l(h){h.value instanceof Gn?Promise.resolve(h.value.v).then(u,c):d(r[0][2],h)}function u(h){o("next",h)}function c(h){o("throw",h)}function d(h,p){h(p),r.shift(),r.length&&o(r[0][0],r[0][1])}}function wb(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],t;return e?e.call(s):(s=typeof eo=="function"?eo(s):s[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=s[r]&&function(a){return new Promise(function(o,l){a=s[r](a),i(o,l,a.done,a.value)})}}function i(r,a,o,l){Promise.resolve(l).then(function(u){r({value:u,done:o})},a)}}function rr(s){return typeof s=="function"}function Ef(s){var e=function(n){Error.call(n),n.stack=new Error().stack},t=s(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var fu=Ef(function(s){return function(t){s(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ju(s,e){if(s){var t=s.indexOf(e);0<=t&&s.splice(t,1)}}var Sl=function(){function s(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return s.prototype.unsubscribe=function(){var e,t,n,i,r;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=eo(a),l=o.next();!l.done;l=o.next()){var u=l.value;u.remove(this)}}catch(f){e={error:f}}finally{try{l&&!l.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var c=this.initialTeardown;if(rr(c))try{c()}catch(f){r=f instanceof fu?f.errors:[f]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=eo(d),p=h.next();!p.done;p=h.next()){var g=p.value;try{pp(g)}catch(f){r=r??[],f instanceof fu?r=Ks(Ks([],Ls(r)),Ls(f.errors)):r.push(f)}}}catch(f){n={error:f}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}if(r)throw new fu(r)}},s.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)pp(e);else{if(e instanceof s){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},s.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},s.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},s.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ju(t,e)},s.prototype.remove=function(e){var t=this._finalizers;t&&ju(t,e),e instanceof s&&e._removeParent(this)},s.EMPTY=function(){var e=new s;return e.closed=!0,e}(),s}(),Sf=Sl.EMPTY;function Of(s){return s instanceof Sl||s&&"closed"in s&&rr(s.remove)&&rr(s.add)&&rr(s.unsubscribe)}function pp(s){rr(s)?s():s.unsubscribe()}var bf={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},vf={setTimeout:function(s,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];return setTimeout.apply(void 0,Ks([s,e],Ls(t)))},clearTimeout:function(s){var e=vf.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(s)},delegate:void 0};function kf(s){vf.setTimeout(function(){throw s})}function gp(){}function hs(s){s()}var xc=function(s){ho(e,s);function e(t){var n=s.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Of(t)&&t.add(n)):n.destination=Vb,n}return e.create=function(t,n,i){return new Wu(t,n,i)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,s.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Sl),Bb=Function.prototype.bind;function mu(s,e){return Bb.call(s,e)}var Ub=function(){function s(e){this.partialObserver=e}return s.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){es(n)}},s.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){es(n)}else es(e)},s.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){es(t)}},s}(),Wu=function(s){ho(e,s);function e(t,n,i){var r=s.call(this)||this,a;if(rr(t)||!t)a={next:t??void 0,error:n??void 0,complete:i??void 0};else{var o;r&&bf.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=function(){return r.unsubscribe()},a={next:t.next&&mu(t.next,o),error:t.error&&mu(t.error,o),complete:t.complete&&mu(t.complete,o)}):a=t}return r.destination=new Ub(a),r}return e}(xc);function es(s){kf(s)}function Fb(s){throw s}var Vb={closed:!0,next:gp,error:Fb,complete:gp},Lc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Kc(s){return s}function jb(s){return s.length===0?Kc:s.length===1?s[0]:function(t){return s.reduce(function(n,i){return i(n)},t)}}var Jr=function(){function s(e){e&&(this._subscribe=e)}return s.prototype.lift=function(e){var t=new s;return t.source=this,t.operator=e,t},s.prototype.subscribe=function(e,t,n){var i=this,r=Hb(e)?e:new Wu(e,t,n);return hs(function(){var a=i,o=a.operator,l=a.source;r.add(o?o.call(r,l):l?i._subscribe(r):i._trySubscribe(r))}),r},s.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},s.prototype.forEach=function(e,t){var n=this;return t=fp(t),new t(function(i,r){var a=new Wu({next:function(o){try{e(o)}catch(l){r(l),a.unsubscribe()}},error:r,complete:i});n.subscribe(a)})},s.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},s.prototype[Lc]=function(){return this},s.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jb(e)(this)},s.prototype.toPromise=function(e){var t=this;return e=fp(e),new e(function(n,i){var r;t.subscribe(function(a){return r=a},function(a){return i(a)},function(){return n(r)})})},s.create=function(e){return new s(e)},s}();function fp(s){var e;return(e=s??bf.Promise)!==null&&e!==void 0?e:Promise}function Wb(s){return s&&rr(s.next)&&rr(s.error)&&rr(s.complete)}function Hb(s){return s&&s instanceof xc||Wb(s)&&Of(s)}function Gb(s){return rr(s==null?void 0:s.lift)}function wc(s){return function(e){if(Gb(e))return e.lift(function(t){try{return s(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Bc(s,e,t,n,i){return new zb(s,e,t,n,i)}var zb=function(s){ho(e,s);function e(t,n,i,r,a,o){var l=s.call(this,t)||this;return l.onFinalize=a,l.shouldUnsubscribe=o,l._next=n?function(u){try{n(u)}catch(c){t.error(c)}}:s.prototype._next,l._error=r?function(u){try{r(u)}catch(c){t.error(c)}finally{this.unsubscribe()}}:s.prototype._error,l._complete=i?function(){try{i()}catch(u){t.error(u)}finally{this.unsubscribe()}}:s.prototype._complete,l}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;s.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(xc),$b=Ef(function(s){return function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Uc=function(s){ho(e,s);function e(){var t=s.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new mp(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new $b},e.prototype.next=function(t){var n=this;hs(function(){var i,r;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=eo(n.currentObservers),o=a.next();!o.done;o=a.next()){var l=o.value;l.next(t)}}catch(u){i={error:u}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;hs(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;hs(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),s.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,r=i.hasError,a=i.isStopped,o=i.observers;return r||a?Sf:(this.currentObservers=null,o.push(t),new Sl(function(){n.currentObservers=null,ju(o,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,r=n.thrownError,a=n.isStopped;i?t.error(r):a&&t.complete()},e.prototype.asObservable=function(){var t=new Jr;return t.source=this,t},e.create=function(t,n){return new mp(t,n)},e}(Jr),mp=function(s){ho(e,s);function e(t,n){var i=s.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:Sf},e}(Uc),aa=function(s){ho(e,s);function e(t){var n=s.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=s.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,r=t._value;if(n)throw i;return this._throwIfClosed(),r},e.prototype.next=function(t){s.prototype.next.call(this,this._value=t)},e}(Uc);function Yb(s){return s&&rr(s.schedule)}function If(s){return s[s.length-1]}function Xb(s){return rr(If(s))?s.pop():void 0}function Jb(s){return Yb(If(s))?s.pop():void 0}var Df=function(s){return s&&typeof s.length=="number"&&typeof s!="function"};function Rf(s){return rr(s==null?void 0:s.then)}function Pf(s){return rr(s[Lc])}function Nf(s){return Symbol.asyncIterator&&rr(s==null?void 0:s[Symbol.asyncIterator])}function Mf(s){return new TypeError("You provided "+(s!==null&&typeof s=="object"?"an invalid object":"'"+s+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function qb(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var xf=qb();function Lf(s){return rr(s==null?void 0:s[xf])}function Kf(s){return Kb(this,arguments,function(){var t,n,i,r;return Tf(this,function(a){switch(a.label){case 0:t=s.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Gn(t.read())];case 3:return n=a.sent(),i=n.value,r=n.done,r?[4,Gn(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Gn(i)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function wf(s){return rr(s==null?void 0:s.getReader)}function Fc(s){if(s instanceof Jr)return s;if(s!=null){if(Pf(s))return Zb(s);if(Df(s))return Qb(s);if(Rf(s))return ev(s);if(Nf(s))return Bf(s);if(Lf(s))return tv(s);if(wf(s))return rv(s)}throw Mf(s)}function Zb(s){return new Jr(function(e){var t=s[Lc]();if(rr(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Qb(s){return new Jr(function(e){for(var t=0;t<s.length&&!e.closed;t++)e.next(s[t]);e.complete()})}function ev(s){return new Jr(function(e){s.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,kf)})}function tv(s){return new Jr(function(e){var t,n;try{for(var i=eo(s),r=i.next();!r.done;r=i.next()){var a=r.value;if(e.next(a),e.closed)return}}catch(o){t={error:o}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}function Bf(s){return new Jr(function(e){iv(s,e).catch(function(t){return e.error(t)})})}function rv(s){return Bf(Kf(s))}function iv(s,e){var t,n,i,r;return Lb(this,void 0,void 0,function(){var a,o;return Tf(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),t=wb(s),l.label=1;case 1:return[4,t.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(a=n.value,e.next(a),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(r=t.return)?[4,r.call(t)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Fi(s,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var r=e.schedule(function(){t(),i?s.add(this.schedule(null,n)):this.unsubscribe()},n);if(s.add(r),!i)return r}function Uf(s,e){return e===void 0&&(e=0),wc(function(t,n){t.subscribe(Bc(n,function(i){return Fi(n,s,function(){return n.next(i)},e)},function(){return Fi(n,s,function(){return n.complete()},e)},function(i){return Fi(n,s,function(){return n.error(i)},e)}))})}function Ff(s,e){return e===void 0&&(e=0),wc(function(t,n){n.add(s.schedule(function(){return t.subscribe(n)},e))})}function nv(s,e){return Fc(s).pipe(Ff(e),Uf(e))}function ov(s,e){return Fc(s).pipe(Ff(e),Uf(e))}function av(s,e){return new Jr(function(t){var n=0;return e.schedule(function(){n===s.length?t.complete():(t.next(s[n++]),t.closed||this.schedule())})})}function sv(s,e){return new Jr(function(t){var n;return Fi(t,e,function(){n=s[xf](),Fi(t,e,function(){var i,r,a;try{i=n.next(),r=i.value,a=i.done}catch(o){t.error(o);return}a?t.complete():t.next(r)},0,!0)}),function(){return rr(n==null?void 0:n.return)&&n.return()}})}function Vf(s,e){if(!s)throw new Error("Iterable cannot be null");return new Jr(function(t){Fi(t,e,function(){var n=s[Symbol.asyncIterator]();Fi(t,e,function(){n.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function lv(s,e){return Vf(Kf(s),e)}function uv(s,e){if(s!=null){if(Pf(s))return nv(s,e);if(Df(s))return av(s,e);if(Rf(s))return ov(s,e);if(Nf(s))return Vf(s,e);if(Lf(s))return sv(s,e);if(wf(s))return lv(s,e)}throw Mf(s)}function jf(s,e){return e?uv(s,e):Fc(s)}function cv(s,e){return wc(function(t,n){var i=0;t.subscribe(Bc(n,function(r){n.next(s.call(e,r,i++))}))})}var dv=Array.isArray;function hv(s,e){return dv(e)?s.apply(void 0,Ks([],Ls(e))):s(e)}function pv(s){return cv(function(e){return hv(s,e)})}var gv=Array.isArray,fv=Object.getPrototypeOf,mv=Object.prototype,Cv=Object.keys;function _v(s){if(s.length===1){var e=s[0];if(gv(e))return{args:e,keys:null};if(yv(e)){var t=Cv(e);return{args:t.map(function(n){return e[n]}),keys:t}}}return{args:s,keys:null}}function yv(s){return s&&typeof s=="object"&&fv(s)===mv}function Av(s,e){return s.reduce(function(t,n,i){return t[n]=e[i],t},{})}function Tv(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var t=Jb(s),n=Xb(s),i=_v(s),r=i.args,a=i.keys;if(r.length===0)return jf([],t);var o=new Jr(Ev(r,t,a?function(l){return Av(a,l)}:Kc));return n?o.pipe(pv(n)):o}function Ev(s,e,t){return t===void 0&&(t=Kc),function(n){Cp(e,function(){for(var i=s.length,r=new Array(i),a=i,o=i,l=function(c){Cp(e,function(){var d=jf(s[c],e),h=!1;d.subscribe(Bc(n,function(p){r[c]=p,h||(h=!0,o--),o||n.next(t(r.slice()))},function(){--a||n.complete()}))},n)},u=0;u<i;u++)l(u)},n)}}function Cp(s,e,t){s?Fi(t,s,e):e()}var Sv=Object.defineProperty,Ov=(s,e,t,n)=>{for(var i=void 0,r=s.length-1,a;r>=0;r--)(a=s[r])&&(i=a(e,t,i)||i);return i&&Sv(e,t,i),i},un=(s=>(s[s.draw=0]="draw",s[s.move=1]="move",s[s.erase=2]="erase",s[s.none=3]="none",s))(un||{}),dt=(s=>(s[s.single=0]="single",s[s.double=1]="double",s[s.triple=2]="triple",s[s.solid=3]="solid",s[s.dashed=4]="dashed",s[s.lonePair=5]="lonePair",s[s.positive=6]="positive",s[s.negative=7]="negative",s))(dt||{});class Wf{constructor(){oe(this,"keyboardDiv");oe(this,"readAloudAtoms",!0);oe(this,"eraserCursor","url('data:/x-123;base64,AAACAAEAICAAAA8ADgCoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAgBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///////////////////////////8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///////////////////////////////////////////8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////////////////8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////////////////////8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP///////////////////////////////////////////wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////////////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////H////g////wH///4A///8AH///AB///YAf//jAH//wYB//4DA//8AYf//ADP//wAf//8AD///AB///wA///8Af///gP///8H////j/////////////////////////////////////////////////////////////////8=')");oe(this,"_modeSubject",new aa(0));oe(this,"whenMode");oe(this,"_elementSubject",new aa("C"));oe(this,"whenElement");oe(this,"currentBondType");oe(this,"hoveredVertex",null);this.whenMode=this._modeSubject.asObservable(),this.currentBondType=0,this.whenElement=this._elementSubject.asObservable()}setDrawMode(e){this._modeSubject.next(e)}get isReadonly(){return this._modeSubject.value==3}get isMoveable(){return this._modeSubject.value==1}get isDrawMode(){return this._modeSubject.value==0}get isEraseMode(){return this._modeSubject.value==2}get currentElement(){return this._elementSubject.value}setElement(e){this._elementSubject.next(e)}}Ov([tt],Wf.prototype,"readAloudAtoms");const sa="#00FF00";var Hu;(function(s){s[s.Transient=0]="Transient",s[s.Singleton=1]="Singleton",s[s.ResolutionScoped=2]="ResolutionScoped",s[s.ContainerScoped=3]="ContainerScoped"})(Hu||(Hu={}));const Er=Hu;function Hf(s){return!!s.useClass}function Gu(s){return!!s.useFactory}var Gf=function(){function s(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return s.prototype.createProxy=function(e){var t=this,n={},i=!1,r,a=function(){return i||(r=e(t.wrap()),i=!0),r};return new Proxy(n,this.createHandler(a))},s.prototype.createHandler=function(e){var t={},n=function(i){t[i]=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r[0]=e();var o=Reflect[i];return o.apply(void 0,ln(r))}};return this.reflectMethods.forEach(n),t},s}();function xn(s){return typeof s=="string"||typeof s=="symbol"}function bv(s){return typeof s=="object"&&"token"in s&&"multiple"in s}function _p(s){return typeof s=="object"&&"token"in s&&"transform"in s}function vv(s){return typeof s=="function"||s instanceof Gf}function ps(s){return!!s.useToken}function gs(s){return s.useValue!=null}function kv(s){return Hf(s)||gs(s)||ps(s)||Gu(s)}var Vc=function(){function s(){this._registryMap=new Map}return s.prototype.entries=function(){return this._registryMap.entries()},s.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},s.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},s.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},s.prototype.setAll=function(e,t){this._registryMap.set(e,t)},s.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},s.prototype.clear=function(){this._registryMap.clear()},s.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},s}(),Iv=function(s){hc(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e}(Vc),yp=function(){function s(){this.scopedResolutions=new Map}return s}();function Dv(s,e){if(s===null)return"at position #"+e;var t=s.split(",")[e].trim();return'"'+t+'" at position #'+e}function Rv(s,e,t){return t===void 0&&(t="    "),ln([s],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function Pv(s,e,t){var n=ys(s.toString().match(/constructor\(([\w, ]+)\)/)||[],2),i=n[1],r=i===void 0?null:i,a=Dv(r,e);return Rv("Cannot inject the dependency "+a+' of "'+s.name+'" constructor. Reason:',t)}function Nv(s){if(typeof s.dispose!="function")return!1;var e=s.dispose;return!(e.length>0)}var Mv=function(s){hc(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e}(Vc),xv=function(s){hc(e,s);function e(){return s!==null&&s.apply(this,arguments)||this}return e}(Vc),Lv=function(){function s(){this.preResolution=new Mv,this.postResolution=new xv}return s}(),Kv=new Map,wv=function(){function s(e){this.parent=e,this._registry=new Iv,this.interceptors=new Lv,this.disposed=!1,this.disposables=new Set}return s.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:Er.Transient}),this.ensureNotDisposed();var i;if(kv(t)?i=t:i={useClass:t},ps(i))for(var r=[e],a=i;a!=null;){var o=a.useToken;if(r.includes(o))throw new Error("Token registration cycle detected! "+ln(r,[o]).join(" -> "));r.push(o);var l=this._registry.get(o);l&&ps(l.provider)?a=l.provider:a=null}if((n.lifecycle===Er.Singleton||n.lifecycle==Er.ContainerScoped||n.lifecycle==Er.ResolutionScoped)&&(gs(i)||Gu(i)))throw new Error('Cannot use lifecycle "'+Er[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},s.prototype.registerType=function(e,t){return this.ensureNotDisposed(),xn(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},s.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},s.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),xn(e)){if(xn(t))return this.register(e,{useToken:t},{lifecycle:Er.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Er.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!xn(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:Er.Singleton})},s.prototype.resolve=function(e,t){t===void 0&&(t=new yp),this.ensureNotDisposed();var n=this.getRegistration(e);if(!n&&xn(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"Single"),n){var i=this.resolveRegistration(n,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(vv(e)){var i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},s.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var r=[];try{for(var a=Ha(this.interceptors.preResolution.getAll(e)),o=a.next();!o.done;o=a.next()){var l=o.value;l.options.frequency!="Once"&&r.push(l),l.callback(e,t)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,r)}},s.prototype.executePostResolutionInterceptor=function(e,t,n){var i,r;if(this.interceptors.postResolution.has(e)){var a=[];try{for(var o=Ha(this.interceptors.postResolution.getAll(e)),l=o.next();!l.done;l=o.next()){var u=l.value;u.options.frequency!="Once"&&a.push(u),u.callback(e,t,n)}}catch(c){i={error:c}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,a)}},s.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Er.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===Er.Singleton,i=e.options.lifecycle===Er.ContainerScoped,r=n||i,a;return gs(e.provider)?a=e.provider.useValue:ps(e.provider)?a=r?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Hf(e.provider)?a=r?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Gu(e.provider)?a=e.provider.useFactory(this):a=this.construct(e.provider,t),e.options.lifecycle===Er.ResolutionScoped&&t.scopedResolutions.set(e,a),a},s.prototype.resolveAll=function(e,t){var n=this;t===void 0&&(t=new yp),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&xn(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"All"),i){var r=i.map(function(o){return n.resolveRegistration(o,t)});return this.executePostResolutionInterceptor(e,r,"All"),r}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},s.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},s.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},s.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=Ha(this._registry.entries()),i=n.next();!i.done;i=n.next()){var r=ys(i.value,2),a=r[0],o=r[1];this._registry.setAll(a,o.filter(function(l){return!gs(l.provider)}).map(function(l){return l.instance=void 0,l}))}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},s.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new s(this);try{for(var i=Ha(this._registry.entries()),r=i.next();!r.done;r=i.next()){var a=ys(r.value,2),o=a[0],l=a[1];l.some(function(u){var c=u.options;return c.lifecycle===Er.ContainerScoped})&&n._registry.setAll(o,l.map(function(u){return u.options.lifecycle===Er.ContainerScoped?{provider:u.provider,options:u.options}:u}))}}catch(u){e={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},s.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},s.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},s.prototype.dispose=function(){return dy(this,void 0,void 0,function(){var e;return hy(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var i=n.dispose();i&&e.push(i)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},s.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},s.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},s.prototype.construct=function(e,t){var n=this;if(e instanceof Gf)return e.createProxy(function(r){return n.resolve(r,t)});var i=function(){var r=Kv.get(e);if(!r||r.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var a=r.map(n.resolveParams(t,e));return new(e.bind.apply(e,ln([void 0],a)))}();return Nv(i)&&this.disposables.add(i),i},s.prototype.resolveParams=function(e,t){var n=this;return function(i,r){var a,o,l;try{return bv(i)?_p(i)?i.multiple?(a=n.resolve(i.transform)).transform.apply(a,ln([n.resolveAll(i.token)],i.transformArgs)):(o=n.resolve(i.transform)).transform.apply(o,ln([n.resolve(i.token,e)],i.transformArgs)):i.multiple?n.resolveAll(i.token):n.resolve(i.token,e):_p(i)?(l=n.resolve(i.transform,e)).transform.apply(l,ln([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(u){throw new Error(Pv(t,r,u))}}},s.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},s}(),ya=new wv;if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);class Fo{constructor(e){oe(this,"_svg");oe(this,"_group");oe(this,"_selectableCircle");oe(this,"_line1");oe(this,"_line2");oe(this,"_line3");oe(this,"_polygon");oe(this,"_pattern");oe(this,"_div");oe(this,"_foreignObject");oe(this,"_vertex1");oe(this,"_vertex2");oe(this,"_vertex1PositionSubscription");oe(this,"_vertex2PositionSubscription");oe(this,"_vertex1SymbolSubscription");oe(this,"_vertex2SymbolSubscription");oe(this,"_center");oe(this,"_lastEndpoints");oe(this,"_molecule");oe(this,"bond");oe(this,"_bondType");oe(this,"BondType");oe(this,"_runner");oe(this,"_vertexChange");oe(this,"VertexChange$");oe(this,"settingsService");this._bondType=new aa(e.bondType),this.BondType=this._bondType.asObservable(),this._vertexChange=new Uc,this.VertexChange$=this._vertexChange.asObservable(),this._vertex1=e.vertex1,this._vertex2=e.vertex2,this._svg=e.svg,this.settingsService=ya.resolve(this._svg.tag),e.bond?this.bond=e.bond:(this._molecule=e.molecule,this.bond=new Kekule.Bond,this.bond.setConnectedObjs([e.vertex1.atom,e.vertex2.atom]),this._molecule.appendConnector(this.bond)),this._bondType.subscribe(t=>{switch(t){case dt.single:this.bond.setBondOrder(1),this.bond.stereo=Kekule.BondStereo.NONE;break;case dt.solid:this.bond.setBondOrder(1),this.bond.stereo=Kekule.BondStereo.UP;break;case dt.dashed:this.bond.setBondOrder(1),this.bond.stereo=Kekule.BondStereo.DOWN;break;case dt.double:this.bond.setBondOrder(2),this.bond.stereo=Kekule.BondStereo.NONE;break;case dt.triple:this.bond.setBondOrder(3),this.bond.stereo=Kekule.BondStereo.NONE;break}}),this._svg=e.svg,this._group=this._svg.group().cx(0).cy(0).attr("tabindex","0").attr("aria-label","Bond"),this._selectableCircle=this._group.ellipse().attr({"fill-opacity":0,fill:sa}).stroke({color:sa,width:1,opacity:0}).filterWith(t=>{t.gaussianBlur(2,2)}),this.adjustSelectableCircle(),this._selectableCircle.addClass("interactive"),this._line1=this._group.line(this._vertex1.Position.x,this._vertex1.Position.y,this._vertex2.Position.x,this._vertex2.Position.y).stroke("#000000").attr("pointer-events","none"),Tv([this._vertex1.Position$,this._vertex2.Position$]).subscribe(t=>{this.moveLine(t),this.adjustSelectableCircle(),this._lastEndpoints=t}),this._selectableCircle.mouseover(this.mouseOverObject.bind(this)),this._selectableCircle.mouseout(this.mouseOutObject.bind(this)),this._selectableCircle.mousedown(this.mouseDown.bind(this)),this._molecule=e.molecule,this._vertex1=e.vertex1,this._vertex2=e.vertex2,this._vertex1SymbolSubscription=e.vertex1.Symbol$.subscribe(t=>{this._vertexChange.next(e.vertex1)}),this._vertex1PositionSubscription=e.vertex1.Position$.subscribe(t=>{this._vertexChange.next(e.vertex1)}),this._vertex2SymbolSubscription=e.vertex2.Symbol$.subscribe(t=>{this._vertexChange.next(e.vertex2)}),this._vertex2PositionSubscription=e.vertex2.Position$.subscribe(t=>{this._vertexChange.next(e.vertex2)})}get CurrentBondType(){var e;return(e=this._bondType)==null?void 0:e.value}getAngleFrom(e){let t;if(this._vertex1==e)t=this._vertex2;else if(this._vertex2==e)t=this._vertex1;else return 0;return Math.atan2(t.Position.y-e.Position.y,t.Position.x-e.Position.x)}adjustSelectableCircle(){const e=this._vertex1.Position,t=this._vertex2.Position;let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),i=Math.atan2(t.y-e.y,t.x-e.x),r={x:(t.x+e.x)/2,y:(t.y+e.y)/2};n=n>2*ze.circleRadius?n-2*ze.circleRadius:n*2/3,this._selectableCircle.width(n).height(14).cx(r.x).cy(r.y),this._selectableCircle.untransform().rotate(i*360/2/Math.PI)}moveLine(e){e===void 0&&(e=this._lastEndpoints);let t={x:e[1].x-e[0].x,y:e[1].y-e[0].y},n=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),i={x:t.x/n,y:t.y/n},r={x:i.y,y:-i.x},a=`0 ${ze.circleRadius} ${Math.floor(n-ze.circleRadius*3).toString()}`,o=ze.circleRadius;switch(n<ze.circleRadius*3&&(a=`0 ${ze.circleRadius/2} ${Math.floor(n-ze.circleRadius*3/2).toString()}`,o=o/2),this._bondType.value){case dt.single:this._line2!=null&&(this._line2.remove(),this._line2=null),this._line3!=null&&(this._line3.remove(),this._line3=null),this._line1==null?this._line1=this._group.line(e[0].x,e[0].y,e[1].x,e[1].y).stroke("#000000").attr("pointer-events","none"):this._line1.plot(e[0].x,e[0].y,e[1].x,e[1].y),this._line1.attr("stroke-dasharray",a),this._polygon!=null&&(this._polygon.remove(),this._polygon=null);break;case dt.double:r={x:r.x*4,y:r.y*4},this._line1==null?this._line1=this._group.line(e[0].x+r.x,e[0].y+r.y,e[1].x+r.x,e[1].y+r.y).attr("pointer-events","none"):this._line1.plot(e[0].x+r.x,e[0].y+r.y,e[1].x+r.x,e[1].y+r.y),this._line1.attr("stroke-dasharray",a),this._line2==null?this._line2=this._group.line(e[0].x-r.x,e[0].y-r.y,e[1].x-r.x,e[1].y-r.y).attr("pointer-events","none"):this._line2.plot(e[0].x-r.x,e[0].y-r.y,e[1].x-r.x,e[1].y-r.y),this._line2.stroke("#000000"),this._line2.attr("stroke-dasharray",a),this._line3!=null&&(this._line3.remove(),this._line3=null),this._polygon!=null&&(this._polygon.remove(),this._polygon=null);break;case dt.triple:r={x:r.x*6,y:r.y*6},this._line1==null?this._line1=this._group.line(e[0].x,e[0].y,e[1].x,e[1].y):this._line1.plot(e[0].x,e[0].y,e[1].x,e[1].y),this._line1.attr("stroke-dasharray",a),this._line2==null?this._line2=this._group.line(e[0].x-r.x,e[0].y-r.y,e[1].x-r.x,e[1].y-r.y).attr("pointer-events","none"):this._line2.plot(e[0].x-r.x,e[0].y-r.y,e[1].x-r.x,e[1].y-r.y),this._line2.stroke("#000000"),this._line2.attr("stroke-dasharray",a),this._line3==null?this._line3=this._group.line(e[0].x+r.x,e[0].y+r.y,e[1].x+r.x,e[1].y+r.y).attr("pointer-events","none"):this._line3.plot(e[0].x+r.x,e[0].y+r.y,e[1].x+r.x,e[1].y+r.y),this._line3.stroke("#000000"),this._line3.attr("stroke-dasharray",a),this._polygon!=null&&(this._polygon.remove(),this._polygon=null);break;case dt.dashed:let u=Math.atan2(r.x,r.y);r={x:r.x*6,y:r.y*6},this._pattern!=null&&this._pattern.remove(),this._pattern=this._svg.pattern(8,8,c=>{c.rect(4,8).fill("#000000"),c.rect(4,8).move(4,0).fill("#ffffff00")}).rotate(-u*360/2/Math.PI),this._line1!=null&&(this._line1.remove(),this._line1=null),this._line2!=null&&(this._line2.remove(),this._line2=null),this._line3!=null&&(this._line3.remove(),this._line3=null),this._polygon==null?this._polygon=this._group.polygon(`
						${e[0].x+i.x*o},${e[0].y+i.y*o}, 
						${e[1].x-i.x*o+r.x},${e[1].y-i.y*o+r.y},
						${e[1].x-i.x*o-r.x},${e[1].y-i.y*o-r.y}`).attr("pointer-events","none"):this._polygon.plot(`
						${e[0].x+i.x*o},${e[0].y+i.y*o}, 
						${e[1].x-i.x*o+r.x},${e[1].y-i.y*o+r.y},
						${e[1].x-i.x*o-r.x},${e[1].y-i.y*o-r.y}`),this._polygon.fill(this._pattern);break;case dt.solid:r={x:r.x*6,y:r.y*6},this._line1!=null&&(this._line1.remove(),this._line1=null),this._line2!=null&&(this._line2.remove(),this._line2=null),this._line3!=null&&(this._line3.remove(),this._line3=null),this._polygon==null?this._polygon=this._group.polygon(`
						${e[0].x+i.x*o},${e[0].y+i.y*o}, 
						${e[1].x-i.x*o+r.x},${e[1].y-i.y*o+r.y},
						${e[1].x-i.x*o-r.x},${e[1].y-i.y*o-r.y}`).attr("pointer-events","none"):this._polygon.plot(`
						${e[0].x+i.x*o},${e[0].y+i.y*o}, 
						${e[1].x-i.x*o+r.x},${e[1].y-i.y*o+r.y},
						${e[1].x-i.x*o-r.x},${e[1].y-i.y*o-r.y}`),this._polygon.fill("#000000");break}let l=this._line1;this._line1==null&&this._polygon!=null&&(l=this._polygon),l!=null}setBondType(e){this._bondType.value!=e&&(this._bondType.next(e),this._svg.fire("change",this),this.moveLine())}dispose(){var e,t,n,i,r,a,o,l;this._molecule.removeConnector(this.bond),(e=this._vertex1)==null||e.removeAttachment(this),(t=this._vertex2)==null||t.removeAttachment(this),(n=this._line1)==null||n.remove(),(i=this._line2)==null||i.remove(),(r=this._line3)==null||r.remove(),(a=this._polygon)==null||a.remove(),(o=this._pattern)==null||o.remove(),(l=this._group)==null||l.remove(),this._vertex1PositionSubscription.unsubscribe(),this._vertex2PositionSubscription.unsubscribe(),this._vertex1SymbolSubscription.unsubscribe(),this._vertex2SymbolSubscription.unsubscribe()}mouseDown(e){if(e.stopPropagation(),this.settingsService.isEraseMode)this.dispose();else if(this.settingsService.isDrawMode){if(this.settingsService.currentBondType===dt.lonePair)return;this._bondType.value!==this.settingsService.currentBondType&&(this.setBondType(this.settingsService.currentBondType),this.moveLine())}}mouseOverObject(e){this._runner!=null&&this._runner.finish(),this._runner=this._selectableCircle.animate().attr("fill-opacity","0.5")}mouseOutObject(e){this._runner!=null&&this._runner.finish(),this._runner=this._selectableCircle.animate().attr("fill-opacity","0")}}class Bv{constructor(e){oe(this,"discontinuousRanges",[]);oe(this,"radians",[]);oe(this,"moddedRadians",[]);oe(this,"coordinationNumber");this.coordinationNumber=e}addRadian(e){this.radians.push(e),e<0?this.moddedRadians.push(e+Math.PI*2):this.moddedRadians.push(e)}getFirstOpenSpace(){const e=this.moddedRadians.sort(),t=[];for(let a=0;a<this.moddedRadians.length;a++)if(a<this.moddedRadians.length-1)t.push(this.moddedRadians[a+1]-this.moddedRadians[a]);else{let o=this.moddedRadians[a]-2*Math.PI;t.push(this.moddedRadians[0]-o)}var n=t.reduce((a,o,l,u)=>o>u[a]?l:a,0);let i=e[n],r=n==e.length-1?e[0]+Math.PI*2:e[n+1];if(this.coordinationNumber==0)return r-i>=Math.PI?i+Math.PI/2:(r+i)/2;switch(this.coordinationNumber){case 2:return i+Math.PI;case 3:return i+Math.PI*2/3;case 4:return r-i>=Math.PI?i+Math.PI/2:(r+i)/2;case 5:return r-i>=Math.PI&&e.length<3?i+Math.PI/2:e.length==3?i+Math.PI/3:e.length==4?r-Math.PI/3:(r+i)/2;case 6:return i+Math.PI*2/6;default:return r-i>=Math.PI?i+Math.PI/2:(r+i)/2}}}const jt=class jt{constructor(e){oe(this,"owner");oe(this,"_ownerSubscription");oe(this,"_svg");oe(this,"_group");oe(this,"_circle1");oe(this,"_circle2");oe(this,"_selectionEllipse");oe(this,"radians");oe(this,"_mouseMoveEventRef");oe(this,"_mouseUpEventRef");oe(this,"_position$");oe(this,"Position$");oe(this,"_molecule");oe(this,"_electrons");oe(this,"settingsService");this._svg=e.svg,this.settingsService=ya.resolve(this._svg.tag),this._group=this._svg.group().attr("aria-label","Lone Pair"),this._circle1=this._group.circle(jt.dotRadius*2).cx(0).cy(ze.circleRadius/3).fill("#000000"),this._circle2=this._group.circle(jt.dotRadius*2).cx(0).cy(-ze.circleRadius/3).fill("#000000"),this._selectionEllipse=this._group.ellipse(jt.extraMargin*2,ze.circleRadius*2).cx(0).cy(0).rotate(this.radians).attr({"fill-opacity":0}).stroke({color:sa,width:1,opacity:0}).filterWith(t=>{t.gaussianBlur(1,1)}),this._selectionEllipse.addClass("interactive"),this.owner=e.owner,this.radians=e.radians!=null?e.radians:0,this._molecule=e.molecule,this._electrons=e.electronSet,this.moveUsingRadians(this.radians),this._ownerSubscription=this.owner.Position$.subscribe(t=>{if(this.radians==null)return;let n={x:Math.cos(this.radians),y:Math.sin(this.radians)};this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(t.x,t.y).translate(n.x*(jt.extraMargin+ze.circleRadius),n.y*(jt.extraMargin+ze.circleRadius)),this._electrons.coord2D={x:t.x+n.x*(jt.extraMargin+ze.circleRadius),y:t.y+n.y*(jt.extraMargin+ze.circleRadius)}}),this._group.mouseover(this.mouseOver.bind(this)),this._group.mouseout(this.mouseOut.bind(this)),this._group.mousedown(this.mouseDown.bind(this))}updateKekulePosition(e,t){this._electrons.coord2D={x:e,y:t}}dispose(){this.owner.atom.removeMarker(this._electrons),this._circle1.remove(),this._circle2.remove(),this._group.remove()}mouseDown(e){this.settingsService.isMoveable?(this._mouseMoveEventRef=this.mouseMoveBondDrawing.bind(this),window.addEventListener("pointermove",this._mouseMoveEventRef),this._mouseUpEventRef=this.mouseUp.bind(this),window.addEventListener("pointerup",this._mouseUpEventRef)):this.settingsService.isEraseMode&&(this.owner.removeAttachment(this),this._ownerSubscription.unsubscribe(),this.dispose(),this._svg.fire("change",this))}mouseMoveBondDrawing(e){const t=this._svg.node.getBoundingClientRect();let n={x:e.clientX-t.left,y:e.clientY-t.top};if(n!=null&&this.settingsService.isMoveable){let i=this.owner.Position,r={x:n.x-i.x,y:n.y-i.y},a=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),o={x:r.x/a,y:r.y/a},l=Math.atan2(o.y,o.x);this.radians=l,this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(i.x,i.y).translate(o.x*(jt.extraMargin+ze.circleRadius),o.y*(jt.extraMargin+ze.circleRadius)),this._electrons.coord2D={x:i.x+o.x*(jt.extraMargin+ze.circleRadius),y:i.y+o.y*(jt.extraMargin+ze.circleRadius)}}}moveUsingCoord(e){let t=this.owner.Position,n={x:e.x-t.x,y:e.y-t.y},i=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)),r={x:n.x/i,y:n.y/i},a=Math.atan2(r.y,r.x);this.radians=a,this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(t.x,t.y).translate(r.x*(jt.extraMargin+ze.circleRadius),r.y*(jt.extraMargin+ze.circleRadius)),this._electrons.coord2D={x:t.x+r.x*(jt.extraMargin+ze.circleRadius),y:t.y+r.y*(jt.extraMargin+ze.circleRadius)}}moveUsingRadians(e){this.radians=e;let t=this.owner.Position,n=Math.cos(e),i=Math.sin(e);this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(t.x,t.y).translate(n*(jt.extraMargin+ze.circleRadius),i*(jt.extraMargin+ze.circleRadius)),this._electrons.coord2D={x:t.x+n*(jt.extraMargin+ze.circleRadius),y:t.y+i*(jt.extraMargin+ze.circleRadius)}}mouseUp(e){window.removeEventListener("pointermove",this._mouseMoveEventRef),window.removeEventListener("pointerup",this._mouseUpEventRef),this._svg.fire("change",this)}mouseOver(e){this._selectionEllipse.animate(200,0,"now").attr({"stroke-opacity":1})}mouseOut(e){this._selectionEllipse.animate(200,0,"now").attr({"stroke-opacity":0})}};oe(jt,"dotRadius",3),oe(jt,"extraMargin",2);let $t=jt;const pi=class pi{constructor(e){oe(this,"owner");oe(this,"_ownerSubscription");oe(this,"_svg");oe(this,"_group");oe(this,"_circle");oe(this,"_text");oe(this,"_selectionCircle");oe(this,"radians");oe(this,"_mouseMoveEventRef");oe(this,"_mouseUpEventRef");oe(this,"_position$");oe(this,"Position$");oe(this,"_molecule");oe(this,"_charge");oe(this,"settingsService");this._svg=e.svg,this.settingsService=ya.resolve(this._svg.tag),this._group=this._svg.group().attr("aria-label","Formal Charge"),this._circle=this._group.circle(pi.circleRadius*2).cx(0).cy(pi.chargeDistance).stroke("#000000").fill("#ffffff").attr({"stroke-width":.5}),this._text=this._group.text(this.numberToCharge(e.charge.value)).font({size:9,family:"sans-serif"}).x(0).cy(pi.chargeDistance).attr({"text-anchor":"middle","alignment-baseline":"middle"}),this._selectionCircle=this._group.circle(pi.circleRadius*2+1).cx(0).cy(pi.chargeDistance).attr({"fill-opacity":0}).stroke({color:sa,width:1,opacity:0}).filterWith(t=>{t.gaussianBlur(1,1)}),this._selectionCircle.addClass("interactive"),this.owner=e.owner,this.radians=e.radians!=null?e.radians:0,this._molecule=e.molecule,this._charge=e.charge,this.moveUsingRadians(this.radians),this._ownerSubscription=this.owner.Position$.subscribe(t=>{if(this.radians==null)return;let n={x:Math.cos(this.radians),y:Math.sin(this.radians)};this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(t.x,t.y).translate(n.x*($t.extraMargin+ze.circleRadius),n.y*($t.extraMargin+ze.circleRadius)),this._charge.coord2D={x:t.x+n.x*($t.extraMargin+ze.circleRadius),y:t.y+n.y*($t.extraMargin+ze.circleRadius)}}),this._group.mouseover(this.mouseOver.bind(this)),this._group.mouseout(this.mouseOut.bind(this)),this._group.mousedown(this.mouseDown.bind(this))}numberToCharge(e){return e==0?"":e==1?"+":e==-1?"-":e>1?e.toString()+"+":Math.abs(e).toString()+"-"}updateCharge(e){this._text.text(this.numberToCharge(e))}updateKekulePosition(e,t){this._charge.coord2D={x:e,y:t}}dispose(){this.owner.removeAttachment(this),this.owner.atom.removeMarker(this._charge),this._circle.remove(),this._text.remove(),this._group.remove()}mouseDown(e){if(e.button!=0){e.preventDefault();return}e.stopPropagation(),console.log("formal charge mousedown!"),this.settingsService.isMoveable?(this._mouseMoveEventRef=this.mouseMoveBondDrawing.bind(this),window.addEventListener("pointermove",this._mouseMoveEventRef),this._mouseUpEventRef=this.mouseUp.bind(this),window.addEventListener("pointerup",this._mouseUpEventRef)):this.settingsService.isEraseMode?(this.owner.removeAttachment(this),this._ownerSubscription.unsubscribe(),this.dispose(),this._svg.fire("change",this)):(this._charge.value+=this.settingsService.currentBondType==dt.positive?1:-1,this.owner.atom.setCharge(this._charge.value),this._charge.value==0?this.dispose():this.updateCharge(this._charge.value),this._svg.fire("change",this))}mouseMoveBondDrawing(e){const t=this._svg.node.getBoundingClientRect();let n={x:e.clientX-t.left,y:e.clientY-t.top};if(n!=null&&this.settingsService.isMoveable){let i=this.owner.Position,r={x:n.x-i.x,y:n.y-i.y},a=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),o={x:r.x/a,y:r.y/a},l=Math.atan2(o.y,o.x);this.radians=l,this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(i.x,i.y).translate(o.x*($t.extraMargin+ze.circleRadius),o.y*($t.extraMargin+ze.circleRadius)),this._text.untransform(),this._text.rotate(-this.radians/Math.PI/2*360),this._charge.coord2D={x:i.x+o.x*($t.extraMargin+ze.circleRadius),y:i.y+o.y*($t.extraMargin+ze.circleRadius)}}}moveUsingCoord(e){let t=this.owner.Position,n={x:e.x-t.x,y:e.y-t.y},i=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)),r={x:n.x/i,y:n.y/i},a=Math.atan2(r.y,r.x);this.radians=a,this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(t.x,t.y).translate(r.x*($t.extraMargin+ze.circleRadius),r.y*($t.extraMargin+ze.circleRadius)),this._charge.coord2D={x:t.x+r.x*($t.extraMargin+ze.circleRadius),y:t.y+r.y*($t.extraMargin+ze.circleRadius)}}moveUsingRadians(e){this.radians=e;let t=this.owner.Position,n=Math.cos(e),i=Math.sin(e);this._group.untransform().rotate(this.radians/Math.PI/2*360).translate(t.x,t.y).translate(n*($t.extraMargin+ze.circleRadius),i*($t.extraMargin+ze.circleRadius)),this._charge.coord2D={x:t.x+n*($t.extraMargin+ze.circleRadius),y:t.y+i*($t.extraMargin+ze.circleRadius)}}mouseUp(e){window.removeEventListener("pointermove",this._mouseMoveEventRef),window.removeEventListener("pointerup",this._mouseUpEventRef),this._svg.fire("change",this)}mouseOver(e){this._selectionCircle.animate(200,0,"now").attr({"stroke-opacity":1})}mouseOut(e){this._selectionCircle.animate(200,0,"now").attr({"stroke-opacity":0})}};oe(pi,"circleRadius",6),oe(pi,"chargeDistance",5),oe(pi,"extraMargin",2);let cn=pi;const qo=class qo{constructor(e){oe(this,"attachments");oe(this,"attachmentSubs");oe(this,"_svg");oe(this,"_group");oe(this,"_text");oe(this,"_circle");oe(this,"_foreignObject");oe(this,"_div");oe(this,"_runner");oe(this,"_tempLine");oe(this,"_tempVertex");oe(this,"_tempLP");oe(this,"disableEvents",!1);oe(this,"_hasMoved");oe(this,"_mouseMoveEventRef");oe(this,"_mouseUpEventRef");oe(this,"_position$");oe(this,"Position$");oe(this,"_symbol$");oe(this,"Symbol$");oe(this,"_subscription");oe(this,"_molecule");oe(this,"atom");oe(this,"_tabDiv");oe(this,"_ariaLabel");oe(this,"type");oe(this,"settingsService");var t;this._svg=e.svg,this.settingsService=ya.resolve(this._svg.tag),this._group=e.svg.group().attr("tabindex","0").attr("aria-label","Atom"),this._group.translate(e.x,e.y),this._group.on("dragmove.namespace",n=>{const{handler:i,box:r}=n.detail;n.preventDefault(),this._group.translate((r.x2+r.x)/2,(r.y2+r.y)/2)}),this._circle=this._group.circle(qo.circleRadius*2-4),this._circle.addClass("interactive"),this._circle.cx(0).cy(0),this._circle.fill({color:"#FFFFFF",opacity:0}),this._circle.stroke({color:sa,width:4,opacity:0}).filterWith(n=>{n.gaussianBlur(2,2)}),this._text=this._group.text(e.identity!==void 0?e.identity:""),this._text.font({size:20}),this._text.css({cursor:"default"}),this._text.cx(0).cy(0),this.type="Vertex",this._position$=new aa({x:e.x,y:e.y}),this.Position$=this._position$.asObservable(),this._symbol$=new aa(e.identity),this.Symbol$=this._symbol$.asObservable(),this._molecule=e.molecule,e.atom?this.atom=e.atom:(this.atom=new Kekule.Atom,this._molecule.appendNode(this.atom)),this._tabDiv=document.createElement("div"),this._tabDiv.tabIndex=0,this._tabDiv.onfocus=n=>{},this._tabDiv.onblur=n=>{},(t=this.settingsService.keyboardDiv)==null||t.appendChild(this._tabDiv),this._position$.subscribe(n=>{this._group.transform({translateX:n.x,translateY:n.y}),this.atom.setCoord2D({x:n.x,y:n.y})}),this._symbol$.subscribe(n=>{this.atom.setSymbol(n)}),this.attachments=[],this.attachmentSubs=new Map,this.updateAriaLabel(),this._group.on("dragmove",n=>{const i=this._group.transform();this._position$.next({x:i.translateX??0,y:i.translateY??0})}),this._group.on("dragend",n=>{this._svg.fire("change",this)}),this._group.click(n=>{n.preventDefault(),n.stopPropagation()}),this._group.mousedown(this.mouseDown.bind(this)),this._group.mouseenter(this.mouseEnter.bind(this)),this._group.mouseleave(this.mouseLeave.bind(this)),this._group.mouseover(this.mouseOver.bind(this)),this._group.mouseout(this.mouseOut.bind(this)),this._subscription=this.settingsService.whenMode.subscribe(n=>{switch(n){case un.move:this._group.draggable();break;default:this._group.draggable(!1);break}}),this._svg.fire("change",this)}get Position(){return this._position$.value}setDraggable(e){this._group.draggable(!!e)}moveTo(e,t){this._position$.next({x:e,y:t})}mouseOver(e){this.settingsService.hoveredVertex=this}mouseOut(e){this.settingsService.hoveredVertex=null}mouseEnter(e){var t;if(this.disableEvents){e.preventDefault();return}(t=this._runner)==null||t.reset(),this._runner=this._circle.animate({duration:200,delay:0,when:"now",swing:!1,times:1,wait:0}).attr({"stroke-opacity":1})}mouseLeave(e){var t;if(this.disableEvents){e.preventDefault();return}this._circle.transform({rotate:0}),(t=this._runner)==null||t.reset(),this._runner=this._circle.animate(200).attr({"stroke-opacity":0})}dispose(){this._group.mousedown(null),this._circle.remove(),this._text.remove(),this._group.remove();let e=this.attachments.length-1;for(;e>=0;)this.attachments[e].dispose(),e-=1;this._position$.complete(),this._symbol$.complete(),this._molecule.removeNode(this.atom),this._subscription.unsubscribe()}_render(e){}static fromObject(e){}updateAriaLabel(){if(this.atom.symbol===void 0)return;let e=new Kekule.Element(this.atom.symbol);this._ariaLabel=e.name.toString()+" atom ";let t=this.atom.getLinkedChemNodes(),n=this.atom.getLinkedBonds(),i=this.atom.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet,!1);i.length>0&&(this._ariaLabel+="with "+i.length+" lone pair"+(i.length>1?"s":"")+" of electrons "),t.length>0&&(this._ariaLabel+="bonded to ");for(let r=0;r<t.length;r++){let a=t[r],o=new Kekule.Element(a.symbol),l=Math.atan2(-(a.coord2D.y-this.atom.coord2D.y),a.coord2D.x-this.atom.coord2D.x);l*=360/2/Math.PI,l=Math.round(l);let u=null;for(let c=0;c<n.length;c++){let d=n[c].getConnectedChemNodes();for(let h=0;h<d.length;h++)if(d[h]==a){u=n[c];break}if(u!=null)break}this._ariaLabel+=o.name.toString()+" at "+l+" degrees ",r==t.length-2&&(this._ariaLabel+="and ")}this._tabDiv.innerText=this._ariaLabel}mouseDown(e){if(e.button!=0){e.preventDefault();return}if(e.stopPropagation(),this._hasMoved=!1,!this.settingsService.isMoveable){if(this.settingsService.isEraseMode)this.dispose(),this._svg.fire("change",this);else if(this.settingsService.isDrawMode){this._mouseMoveEventRef=this.mouseMove.bind(this),this._mouseUpEventRef=this.mouseUp.bind(this),this._svg.mousemove(this._mouseMoveEventRef),this._svg.mouseup(this._mouseUpEventRef);let t=this._group.transform().translateX,n=this._group.transform().translateY;if(t===void 0)throw"Translate X was not defined.";if(n===void 0)throw"Translate Y was not defined.";if(this.settingsService.currentBondType==dt.lonePair){let i=[];for(let o=0;o<this.attachments.length;o++)if(this.attachments[o]instanceof $t){let l=this.attachments[o];i.push(l.radians)}else if(this.attachments[o]instanceof cn){let l=this.attachments[o];i.push(l.radians)}else{let u=this.attachments[o].getAngleFrom(this);i.push(u)}let r=this.findNewAngle(i);const a=new Kekule.ChemMarker.UnbondedElectronSet;this.atom.appendMarker(a),this._tempLP=new $t({radians:r,owner:this,molecule:this._molecule,svg:this._svg,electronSet:a}),console.log("created temp LP"),this.attachments.push(this._tempLP)}else if(this.settingsService.currentBondType==dt.positive||this.settingsService.currentBondType==dt.negative){let i,r=null;const a=this.atom.getMarkersOfType(Kekule.ChemMarker.Charge);a!=null&&a.length>0?(i=a[0],r=this.attachments.find(o=>o instanceof cn)):(i=new Kekule.ChemMarker.Charge,this.atom.appendMarker(i),i.value=0),i.value+=this.settingsService.currentBondType==dt.positive?1:-1,this.atom.setCharge(i.value),i.value==0?r!=null&&r.dispose():r==null?(r=new cn({owner:this,molecule:this._molecule,svg:this._svg,charge:i,radians:0}),this.attachments.push(r)):r.updateCharge(i.value)}else{const i=this._svg.node.getBoundingClientRect();this._tempVertex=new qo({identity:this.settingsService.currentElement,x:e.clientX-i.left,y:e.clientY-i.top,molecule:this._molecule,svg:this._svg}),this._tempVertex._group.addClass("eventless"),this._tempLine=new Fo({vertex1:this,vertex2:this._tempVertex,bondType:this.settingsService.currentBondType,molecule:this._molecule,svg:this._svg}),this._tempLine._group.addClass("eventless"),this.addConnector(this._tempLine),this._tempVertex.addConnector(this._tempLine)}}}}mouseUp(e){var n,i,r,a,o,l;if(e.stopImmediatePropagation(),this._svg.off("mousemove",this._mouseMoveEventRef),this._svg.off("mouseup",this._mouseUpEventRef),this.settingsService.currentBondType!=dt.lonePair){if(!(this.settingsService.currentBondType==dt.positive||this.settingsService.currentBondType==dt.negative))if((n=this._tempVertex)==null||n._group.removeClass("eventless"),(i=this._tempLine)==null||i._group.removeClass("eventless"),this.settingsService.hoveredVertex!==null||!this._hasMoved)if(this.settingsService.hoveredVertex==this||!this._hasMoved)console.log("Overwriting vertex with temp one"),this._text.text(this.settingsService.currentElement),this.atom.setSymbol(this.settingsService.currentElement),this._symbol$.next(this.settingsService.currentElement),(r=this._tempLine)==null||r.dispose(),(a=this._tempVertex)==null||a.dispose();else{(o=this._tempVertex)==null||o.dispose(),(l=this._tempLine)==null||l.dispose(),this._tempLine!=null&&this.attachments.splice(this.attachments.indexOf(this._tempLine),1);let u=!1;for(var t=0;t<this.attachments.length;t++)if(this.attachments[t]instanceof Fo){let c=this.attachments[t];(c._vertex1==this.settingsService.hoveredVertex||c._vertex2==this.settingsService.hoveredVertex)&&(c.setBondType(this.settingsService.currentBondType),u=!0)}if(!u){if(this.settingsService.hoveredVertex==null)throw"Hovered vertex should not be null.";this._tempLine=new Fo({vertex1:this,vertex2:this.settingsService.hoveredVertex,bondType:this.settingsService.currentBondType,molecule:this._molecule,svg:this._svg}),this.addConnector(this._tempLine),this.settingsService.hoveredVertex.addConnector(this._tempLine)}}else this._tempLine=null,this._tempVertex=null}this._svg.fire("change",this)}addConnector(e){this.attachments.push(e)}addLonePair(e){this.attachments.push(e)}addFormalCharge(e){this.attachments.push(e)}removeAttachment(e){let t=this.attachmentSubs.get(e);t!=null&&(t.forEach(n=>{n.unsubscribe()}),this.attachmentSubs.delete(e)),this.attachments.splice(this.attachments.indexOf(e),1)}mouseMove(e){var i;if(this.disableEvents){e.preventDefault();return}const t=this._svg.node.getBoundingClientRect(),n=this._group.transform();if(this._hasMoved=!0,n.translateX===void 0||n.translateY===void 0)throw"ERROR!";if(!this.settingsService.isMoveable)if(this.settingsService.currentBondType==dt.lonePair){let r={x:e.clientX-t.left,y:e.clientY-t.top};this._tempLP.moveUsingCoord(r)}else this.settingsService.currentBondType==dt.positive||this.settingsService.currentBondType==dt.negative||(i=this._tempVertex)==null||i.moveTo(e.clientX-t.left,e.clientY-t.top)}bondCount(){let e=0;for(let t=0;t<this.attachments.length;t++)this.attachments[t]instanceof Fo&&e++;return e}getAngleThatFits(e=0){let t=[];for(let i=0;i<this.attachments.length;i++)if(this.attachments[i]instanceof $t){let r=this.attachments[i];t.push(r.radians)}else if(this.attachments[i]instanceof cn){let r=this.attachments[i];t.push(r.radians)}else{let a=this.attachments[i].getAngleFrom(this);t.push(a)}return this.findNewAngle(t,e)}findNewAngle(e,t=0){let n=0;if(t==0||e.length>=t){if(e.length==0)return n;if(e.length==1)return e[0]+Math.PI/2;if(e.length==2){const r=e[1]-e[0];return Math.abs(r)-Math.PI/2<.1?r>0?e[1]+Math.PI/2:e[1]-Math.PI/2:this.useBlockedRangeMethod(e)}else if(e.length==3){e.forEach(o=>{});const r=[e[1]-e[0],e[2]-e[1],e[2]-e[0]];var i=r.reduce((o,l,u,c)=>Math.abs(l)>Math.abs(c[o])?u:o,0);let a=!0;if(r.forEach((o,l)=>{l!=i&&Math.abs(o)-Math.PI/2>.1&&(a=!1)}),a)switch(i){case 0:return e[2]+Math.PI;case 1:return e[0]+Math.PI;case 2:return e[1]+Math.PI;default:return this.useBlockedRangeMethod(e)}else return this.useBlockedRangeMethod(e)}else return this.useBlockedRangeMethod(e)}else return this.useBlockedRangeMethod(e,t)}useBlockedRangeMethod(e,t=0){let n=new Bv(t);for(let r=0;r<e.length;r++)n.addRadian(e[r]);return n.getFirstOpenSpace()}};oe(qo,"circleRadius",15);let ze=qo;const Uv=function(){var s;typeof window=="object"&&window&&window.document?s=window:typeof global=="object"?s=global:typeof self=="object"&&(s=self),s||(s=this),s._kekule_environment_||(s._kekule_environment_={});var e=s._kekule_environment_;function t(r,a,o){var l=new URL(a),u=l.pathname.lastIndexOf("/"),c=(l.protocol.startsWith("file")?l.protocol+"//":l.origin||"")+(u<l.pathname.length?l.pathname.substring(0,u+1):l.pathname),d=(c||"")+"kekule.js";r.scriptSrc=d,r.scriptPath=c}var n=import.meta.url,i=null;return(n||i)&&t(e,n),e.manualLoadScriptFiles=!0,function(){var r={Kekule:s.Kekule,ObjectEx:s.ObjectEx,ClassEx:s.ClassEx,Class:s.Class,DataType:s.DataType};return r}}();function Ap(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Vo={exports:{}},fs={exports:{}},Fv=fs.exports,Tp;function zf(){if(Tp)return fs.exports;Tp=1,Object.defineProperty(Fv,"__esModule",{value:!0});const s=function(){};function e(t,n={}){s.prototype.name=t;const i={};return new Proxy(s,{get(r,a){return a==="caller"?null:a==="__createMock__"?e:a==="__unenv__"?!0:a in n?n[a]:i[a]=i[a]||e(`${t}.${a.toString()}`)},apply(r,a,o){return e(`${t}()`)},construct(r,a,o){return e(`[${t}]`)},enumerate(){return[]}})}return fs.exports=e("mock"),fs.exports}var ts={exports:{}},er={},Ep;function Vv(){if(Ep)return er;Ep=1,Object.defineProperty(er,"__esModule",{value:!0}),er.WriteStream=er.StatsFs=er.Stats=er.ReadStream=er.FileWriteStream=er.FileReadStream=er.Dirent=er.Dir=void 0;var s=e(zf());function e(t){return t&&t.__esModule?t:{default:t}}return er.Dir=s.default.__createMock__("fs.Dir"),er.Dirent=s.default.__createMock__("fs.Dirent"),er.Stats=s.default.__createMock__("fs.Stats"),er.ReadStream=s.default.__createMock__("fs.ReadStream"),er.WriteStream=s.default.__createMock__("fs.WriteStream"),er.FileReadStream=s.default.__createMock__("fs.FileReadStream"),er.FileWriteStream=s.default.__createMock__("fs.FileWriteStream"),er.StatsFs=s.default.__createMock__("fs.StatsFs"),er}var xr={},Sp;function $f(){return Sp||(Sp=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.constants=xr.X_OK=xr.W_OK=xr.R_OK=xr.F_OK=void 0,xr.F_OK=0,xr.R_OK=4,xr.W_OK=2,xr.X_OK=1,xr.constants=Object.create({UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,UV_FS_O_FILEMAP:0,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DSYNC:4096,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4})),xr}var ee={},wi={},Op;function Yf(){if(Op)return wi;Op=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.createNotImplementedError=t,wi.mergeFns=e,wi.notImplemented=n,wi.notImplementedClass=i,wi.rawHeaders=s;function s(r){const a=[];for(const o in r)if(Array.isArray(r[o]))for(const l of r[o])a.push(o,l);else a.push(o,r[o]);return a}function e(...r){return function(...a){for(const o of r)o(...a)}}function t(r){throw new Error(`[unenv] ${r} is not implemented yet!`)}function n(r){return Object.assign(()=>{throw t(r)},{__unenv__:!0})}function i(r){return class{constructor(){oe(this,"__unenv__",!0);throw new Error(`[unenv] ${r} is not implemented yet!`)}}}return wi}var rs={exports:{}},bp;function Xf(){return bp||(bp=1,function(s,e){Object.defineProperty(e,"__esModule",{value:!0}),e.chown=e.chmod=e.appendFile=e.access=void 0,Object.defineProperty(e,"constants",{enumerable:!0,get:function(){return n.constants}}),e.writeFile=e.watch=e.utimes=e.unlink=e.truncate=e.symlink=e.statfs=e.stat=e.rmdir=e.rm=e.rename=e.realpath=e.readlink=e.readdir=e.readFile=e.opendir=e.open=e.mkdtemp=e.mkdir=e.lutimes=e.lstat=e.link=e.lchown=e.lchmod=e.default=e.cp=e.copyFile=void 0;var t=Yf(),n=$f();e.access=(0,t.notImplemented)("fs.access"),e.copyFile=(0,t.notImplemented)("fs.copyFile"),e.cp=(0,t.notImplemented)("fs.cp"),e.open=(0,t.notImplemented)("fs.open"),e.opendir=(0,t.notImplemented)("fs.opendir"),e.rename=(0,t.notImplemented)("fs.rename"),e.truncate=(0,t.notImplemented)("fs.truncate"),e.rm=(0,t.notImplemented)("fs.rm"),e.rmdir=(0,t.notImplemented)("fs.rmdir"),e.mkdir=(0,t.notImplemented)("fs.mkdir"),e.readdir=(0,t.notImplemented)("fs.readdir"),e.readlink=(0,t.notImplemented)("fs.readlink"),e.symlink=(0,t.notImplemented)("fs.symlink"),e.lstat=(0,t.notImplemented)("fs.lstat"),e.stat=(0,t.notImplemented)("fs.stat"),e.link=(0,t.notImplemented)("fs.link"),e.unlink=(0,t.notImplemented)("fs.unlink"),e.chmod=(0,t.notImplemented)("fs.chmod"),e.lchmod=(0,t.notImplemented)("fs.lchmod"),e.lchown=(0,t.notImplemented)("fs.lchown"),e.chown=(0,t.notImplemented)("fs.chown"),e.utimes=(0,t.notImplemented)("fs.utimes"),e.lutimes=(0,t.notImplemented)("fs.lutimes"),e.realpath=(0,t.notImplemented)("fs.realpath"),e.mkdtemp=(0,t.notImplemented)("fs.mkdtemp"),e.writeFile=(0,t.notImplemented)("fs.writeFile"),e.appendFile=(0,t.notImplemented)("fs.appendFile"),e.readFile=(0,t.notImplemented)("fs.readFile"),e.watch=(0,t.notImplemented)("fs.watch"),e.statfs=(0,t.notImplemented)("fs.statfs"),s.exports={}}(rs,rs.exports)),rs.exports}var vp;function jv(){if(vp)return ee;vp=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.writevSync=ee.writev=ee.writeSync=ee.writeFileSync=ee.writeFile=ee.write=ee.watchFile=ee.watch=ee.utimesSync=ee.utimes=ee.unwatchFile=ee.unlinkSync=ee.unlink=ee.truncateSync=ee.truncate=ee.symlinkSync=ee.symlink=ee.statfsSync=ee.statfs=ee.statSync=ee.stat=ee.rmdirSync=ee.rmdir=ee.rmSync=ee.rm=ee.renameSync=ee.rename=ee.realpathSync=ee.realpath=ee.readvSync=ee.readv=ee.readlinkSync=ee.readlink=ee.readdirSync=ee.readdir=ee.readSync=ee.readFileSync=ee.readFile=ee.read=ee.opendirSync=ee.opendir=ee.openSync=ee.openAsBlob=ee.open=ee.mkdtempSync=ee.mkdtemp=ee.mkdirSync=ee.mkdir=ee.lutimesSync=ee.lutimes=ee.lstatSync=ee.lstat=ee.linkSync=ee.link=ee.lchownSync=ee.lchown=ee.lchmodSync=ee.lchmod=ee.futimesSync=ee.futimes=ee.ftruncateSync=ee.ftruncate=ee.fsyncSync=ee.fsync=ee.fstatSync=ee.fstat=ee.fdatasyncSync=ee.fdatasync=ee.fchownSync=ee.fchown=ee.fchmodSync=ee.fchmod=ee.existsSync=ee.exists=ee.createWriteStream=ee.createReadStream=ee.cpSync=ee.cp=ee.copyFileSync=ee.copyFile=ee.closeSync=ee.close=ee.chownSync=ee.chown=ee.chmodSync=ee.chmod=ee.appendFileSync=ee.appendFile=ee.accessSync=ee.access=ee._toUnixTimestamp=void 0;var s=Yf(),e=n(Xf());function t(o){if(typeof WeakMap!="function")return null;var l=new WeakMap,u=new WeakMap;return(t=function(c){return c?u:l})(o)}function n(o,l){if(o&&o.__esModule)return o;if(o===null||typeof o!="object"&&typeof o!="function")return{default:o};var u=t(l);if(u&&u.has(o))return u.get(o);var c={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in o)if(h!=="default"&&{}.hasOwnProperty.call(o,h)){var p=d?Object.getOwnPropertyDescriptor(o,h):null;p&&(p.get||p.set)?Object.defineProperty(c,h,p):c[h]=o[h]}return c.default=o,u&&u.set(o,c),c}function i(o){const l=(0,s.notImplemented)(o);return l.__promisify__=()=>(0,s.notImplemented)(o+".__promisify__"),l.native=l,l}function r(o){const l=function(...u){const c=u.pop();o().catch(d=>c(d)).then(d=>c(void 0,d))};return l.__promisify__=o,l.native=l,l}ee.access=r(e.access),ee.appendFile=r(e.appendFile),ee.chown=r(e.chown),ee.chmod=r(e.chmod),ee.copyFile=r(e.copyFile),ee.cp=r(e.cp),ee.lchown=r(e.lchown),ee.lchmod=r(e.lchmod),ee.link=r(e.link),ee.lstat=r(e.lstat),ee.lutimes=r(e.lutimes),ee.mkdir=r(e.mkdir),ee.mkdtemp=r(e.mkdtemp),ee.realpath=r(e.realpath),ee.open=r(e.open),ee.opendir=r(e.opendir),ee.readdir=r(e.readdir),ee.readFile=r(e.readFile),ee.readlink=r(e.readlink),ee.rename=r(e.rename),ee.rm=r(e.rm),ee.rmdir=r(e.rmdir),ee.stat=r(e.stat),ee.symlink=r(e.symlink),ee.truncate=r(e.truncate),ee.unlink=r(e.unlink),ee.utimes=r(e.utimes),ee.writeFile=r(e.writeFile),ee.statfs=r(e.statfs),ee.close=i("fs.close"),ee.createReadStream=i("fs.createReadStream"),ee.createWriteStream=i("fs.createWriteStream"),ee.exists=i("fs.exists"),ee.fchown=i("fs.fchown"),ee.fchmod=i("fs.fchmod"),ee.fdatasync=i("fs.fdatasync"),ee.fstat=i("fs.fstat"),ee.fsync=i("fs.fsync"),ee.ftruncate=i("fs.ftruncate"),ee.futimes=i("fs.futimes"),ee.lstatSync=i("fs.lstatSync"),ee.read=i("fs.read"),ee.readv=i("fs.readv"),ee.realpathSync=i("fs.realpathSync"),ee.statSync=i("fs.statSync"),ee.unwatchFile=i("fs.unwatchFile"),ee.watch=i("fs.watch"),ee.watchFile=i("fs.watchFile"),ee.write=i("fs.write"),ee.writev=i("fs.writev"),ee._toUnixTimestamp=i("fs._toUnixTimestamp"),ee.openAsBlob=i("fs.openAsBlob"),ee.appendFileSync=(0,s.notImplemented)("fs.appendFileSync"),ee.accessSync=(0,s.notImplemented)("fs.accessSync"),ee.chownSync=(0,s.notImplemented)("fs.chownSync"),ee.chmodSync=(0,s.notImplemented)("fs.chmodSync"),ee.closeSync=(0,s.notImplemented)("fs.closeSync"),ee.copyFileSync=(0,s.notImplemented)("fs.copyFileSync"),ee.cpSync=(0,s.notImplemented)("fs.cpSync");const a=()=>!1;return ee.existsSync=a,ee.fchownSync=(0,s.notImplemented)("fs.fchownSync"),ee.fchmodSync=(0,s.notImplemented)("fs.fchmodSync"),ee.fdatasyncSync=(0,s.notImplemented)("fs.fdatasyncSync"),ee.fstatSync=(0,s.notImplemented)("fs.fstatSync"),ee.fsyncSync=(0,s.notImplemented)("fs.fsyncSync"),ee.ftruncateSync=(0,s.notImplemented)("fs.ftruncateSync"),ee.futimesSync=(0,s.notImplemented)("fs.futimesSync"),ee.lchownSync=(0,s.notImplemented)("fs.lchownSync"),ee.lchmodSync=(0,s.notImplemented)("fs.lchmodSync"),ee.linkSync=(0,s.notImplemented)("fs.linkSync"),ee.lutimesSync=(0,s.notImplemented)("fs.lutimesSync"),ee.mkdirSync=(0,s.notImplemented)("fs.mkdirSync"),ee.mkdtempSync=(0,s.notImplemented)("fs.mkdtempSync"),ee.openSync=(0,s.notImplemented)("fs.openSync"),ee.opendirSync=(0,s.notImplemented)("fs.opendirSync"),ee.readdirSync=(0,s.notImplemented)("fs.readdirSync"),ee.readSync=(0,s.notImplemented)("fs.readSync"),ee.readvSync=(0,s.notImplemented)("fs.readvSync"),ee.readFileSync=(0,s.notImplemented)("fs.readFileSync"),ee.readlinkSync=(0,s.notImplemented)("fs.readlinkSync"),ee.renameSync=(0,s.notImplemented)("fs.renameSync"),ee.rmSync=(0,s.notImplemented)("fs.rmSync"),ee.rmdirSync=(0,s.notImplemented)("fs.rmdirSync"),ee.symlinkSync=(0,s.notImplemented)("fs.symlinkSync"),ee.truncateSync=(0,s.notImplemented)("fs.truncateSync"),ee.unlinkSync=(0,s.notImplemented)("fs.unlinkSync"),ee.utimesSync=(0,s.notImplemented)("fs.utimesSync"),ee.writeFileSync=(0,s.notImplemented)("fs.writeFileSync"),ee.writeSync=(0,s.notImplemented)("fs.writeSync"),ee.writevSync=(0,s.notImplemented)("fs.writevSync"),ee.statfsSync=(0,s.notImplemented)("fs.statfsSync"),ee}var kp;function Wv(){return kp||(kp=1,function(s,e){Object.defineProperty(e,"__esModule",{value:!0});var t={promises:!0};e.promises=e.default=void 0;var n=l(Vv());Object.keys(n).forEach(function(c){c==="default"||c==="__esModule"||Object.prototype.hasOwnProperty.call(t,c)||c in e&&e[c]===n[c]||Object.defineProperty(e,c,{enumerable:!0,get:function(){return n[c]}})});var i=l($f());Object.keys(i).forEach(function(c){c==="default"||c==="__esModule"||Object.prototype.hasOwnProperty.call(t,c)||c in e&&e[c]===i[c]||Object.defineProperty(e,c,{enumerable:!0,get:function(){return i[c]}})});var r=l(jv());Object.keys(r).forEach(function(c){c==="default"||c==="__esModule"||Object.prototype.hasOwnProperty.call(t,c)||c in e&&e[c]===r[c]||Object.defineProperty(e,c,{enumerable:!0,get:function(){return r[c]}})});var a=l(Xf());function o(c){if(typeof WeakMap!="function")return null;var d=new WeakMap,h=new WeakMap;return(o=function(p){return p?h:d})(c)}function l(c,d){if(c&&c.__esModule)return c;if(c===null||typeof c!="object"&&typeof c!="function")return{default:c};var h=o(d);if(h&&h.has(c))return h.get(c);var p={__proto__:null},g=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in c)if(f!=="default"&&{}.hasOwnProperty.call(c,f)){var m=g?Object.getOwnPropertyDescriptor(c,f):null;m&&(m.get||m.set)?Object.defineProperty(p,f,m):p[f]=c[f]}return p.default=c,h&&h.set(c,p),p}const u=e.promises=a;s.exports={...n,...i,...r,promises:u}}(ts,ts.exports)),ts.exports}var Hv=Vo.exports,Ip;function Gv(){return Ip||(Ip=1,function(s,e){(function(t){var n;typeof window=="object"&&window&&window.document?n=window:typeof Ci=="object"?n=Ci:typeof self=="object"?n=self:n=t||{},Array.prototype.indexOf||(Array.prototype.indexOf=function(M,B){B||(B=0);var V=this.length;for(B<0&&(B=V+B);B<V;B++)if(this[B]===M)return B;return-1});var i=n.document;i||typeof window<"u"&&(i=window.document);var r=typeof navigator<"u"&&typeof window<"u"&&typeof i<"u",a=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u",o=a,l=typeof __webpack_require__=="function";if(typeof __webpack_require__!="function"&&o){var u={};try{var c=zf(),d=Wv()}catch{}}o||i&&i.readyState,o&&typeof Ci<"u"&&(n=Ci);function h(){if(o)return!0;var M=i&&i.readyState,B=window.attachEvent&&!window.opera;return M==="complete"||M==="loaded"||M==="interactive"&&!B}function p(M,B){M.write('<script type="text/javascript" src="'+B+'"><\/script>')}function g(M){if(o)try{var B=M.indexOf("file:///")===0?M.substr(8):M,V=d.readFileSync(B,"utf8");return c.runInThisContext(V,{filename:M}),!0}catch(J){return J}}var f=[];function m(M,B,V){if(f.indexOf(B)>=0){V&&V(null);return}if(o){var J=g(B);return V&&V(J===!0?null:J),J}else try{var $=M.createElement("script");return $.src=B,$.onerror=function(q){V&&V(new Error("Loading script file "+B+" failed"))},$.onload=$.onreadystatechange=function(q){if(!$._loaded){var Q=$.readyState;(Q===void 0||Q==="loaded"||Q==="complete")&&($._loaded=!0,$.onload=$.onreadystatechange=null,f.push(B),V&&V(null))}},(M.getElementsByTagName("head")[0]||M.body).appendChild($),$}catch(q){V&&V(q)}}function C(M,B,V){var J=[].concat(B);_(M,J,V,[])}function _(M,B,V,J){if(B.length<=0){V&&(J.length?V(new Error(J.join(", "))):V(null));return}var $=B.shift();m(M,$,function(q){q&&J.push(q?q.message||q:""),_(M,B,V,J)})}function y(M,B,V){if(o)C(i,M,function(Q){(this.Kekule||u.Kekule)._loaded(),V&&V(Q)});else if(!h()&&!B)try{for(var J=0,$=M.length;J<$;++J)p(i,M[J]);var q="if (this.Kekule) Kekule._loaded();";i.write('<script type="text/javascript">'+q+"<\/script>"),V&&V(null)}catch(Q){V(Q)}else C(i,M,function(Q){Q||Kekule._loaded(),V&&V(Q)})}var T={lan:{files:["lan/classes.js","lan/xmlJsons.js","lan/serializations.js"],category:"lan",minFile:"root.min.js"},root:{files:["core/kekule.root.js"],category:"root",minFile:"root.min.js"},localization:{requires:["lan","root"],files:["localization/kekule.localizations.js"],category:"localization",minFile:"localization.min.js"},localizationData:{requires:["localization"],files:["localization/en/kekule.localize.general.en.js","localization/en/kekule.localize.widget.en.js","localization/en/kekule.localize.objDefines.en.js"],category:"localization",minFile:"localization.min.js"},"localizationData.zh":{requires:["localization"],files:["localization/zh/kekule.localize.general.zh.js","localization/zh/kekule.localize.widget.zh.js"],category:"localizationData.zh",autoCompress:!1},common:{requires:["lan","root","localization"],files:["core/kekule.common.js","core/kekule.exceptions.js","utils/kekule.utils.js","utils/kekule.domHelper.js","utils/kekule.domUtils.js","core/kekule.externalResMgr.js","core/kekule.metrics.js"],category:"common",minFile:"common.min.js"},core:{requires:["lan","root","common","data"],files:["core/kekule.configs.js","core/kekule.elements.js","core/kekule.electrons.js","core/kekule.valences.js","core/kekule.structures.js","core/kekule.structureBuilder.js","core/kekule.reactions.js","core/kekule.chemUtils.js","chemdoc/kekule.glyph.base.js","chemdoc/kekule.glyph.utils.js","chemdoc/kekule.glyph.pathGlyphs.js","chemdoc/kekule.glyph.lines.js","chemdoc/kekule.glyph.chemGlyphs.js","chemdoc/kekule.contentBlocks.js","chemdoc/kekule.attachedMarkers.js","chemdoc/kekule.commonChemMarkers.js"],category:"core"},html:{requires:["lan","root","common"],files:["xbrowsers/kekule.x.js","html/kekule.nativeServices.js","html/kekule.predefinedResLoaders.js","utils/kekule.htmlDomUtils.js"],category:"core"},io:{requires:["lan","root","common","core","algorithm"],files:["utils/kekule.textHelper.js","io/kekule.io.js","io/cml/kekule.io.cml.js","io/mdl/kekule.io.mdlBase.js","io/mdl/kekule.io.mdl2000.js","io/mdl/kekule.io.mdl3000.js","io/mdl/kekule.io.mdlIO.js","io/smiles/kekule.io.smiles.js","io/native/kekule.io.native.js"],category:"io"},render:{requires:["lan","root","common","core","html"],files:["render/kekule.render.extensions.js","render/kekule.render.base.js","render/kekule.render.renderColorData.js","render/kekule.render.utils.js","render/kekule.render.configs.js","render/kekule.render.baseTextRender.js","render/kekule.render.boundInfoRecorder.js","render/2d/kekule.render.renderer2D.js","render/2d/kekule.render.glyphRender2D.js","render/2d/kekule.render.canvasRenderer.js","render/2d/kekule.render.raphaelRenderer.js","render/3d/kekule.render.renderer3D.js","render/3d/kekule.render.threeRenderer.js","render/kekule.render.painter.js"],category:"render"},spectroscopy:{requires:["root","common","io"],files:["spectroscopy/kekule.spectrum.core.js","io/jcamp/kekule.io.jcamp.base.js","io/jcamp/kekule.io.jcamp.labels.js","io/jcamp/kekule.io.jcamp.dx.js","io/jcamp/kekule.io.jcamp.cs.js","io/jcamp/kekule.io.jcampIO.js","io/cmlspect/kekule.io.cmlspect.js","spectroscopy/kekule.spectrum.render.js"]},widget:{requires:["lan","root","common","html"],files:["lib/hammer.js/hammer.min.js","widgets/operation/kekule.operations.js","widgets/operation/kekule.actions.js","widgets/kekule.widget.root.js","widgets/kekule.widget.bindings.js","widgets/kekule.widget.events.js","widgets/kekule.widget.base.js","widgets/kekule.widget.sys.js","widgets/kekule.widget.keys.js","widgets/kekule.widget.clipboards.js","widgets/kekule.widget.helpers.js","widgets/kekule.widget.styleResources.js","widgets/kekule.widget.autoLaunchers.js","widgets/transitions/kekule.widget.transitions.js","widgets/transitions/kekule.widget.transMgr.js","widgets/commonCtrls/kekule.widget.resizers.js","widgets/commonCtrls/kekule.widget.movers.js","widgets/commonCtrls/kekule.widget.images.js","widgets/commonCtrls/kekule.widget.containers.js","widgets/commonCtrls/kekule.widget.menus.js","widgets/commonCtrls/kekule.widget.buttons.js","widgets/commonCtrls/kekule.widget.formControls.js","widgets/commonCtrls/kekule.widget.nestedContainers.js","widgets/commonCtrls/kekule.widget.treeViews.js","widgets/commonCtrls/kekule.widget.listViews.js","widgets/commonCtrls/kekule.widget.dialogs.js","widgets/commonCtrls/kekule.widget.msgPanels.js","widgets/commonCtrls/kekule.widget.tabViews.js","widgets/advCtrls/kekule.widget.valueListEditors.js","widgets/advCtrls/kekule.widget.colorPickers.js","widgets/advCtrls/kekule.widget.textEditors.js","widgets/advCtrls/kekule.widget.widgetGrids.js","widgets/advCtrls/objInspector/kekule.widget.objInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.propEditors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.operations.js","widgets/advCtrls/kekule.widget.configurators.js","widgets/advCtrls/grids/kekule.widget.dataSets.js","widgets/advCtrls/grids/kekule.widget.dataGrids.js","widgets/sys/kekule.widget.sysMsgs.js","widgets/operation/kekule.operHistoryTreeViews.js"],category:"widget"},chemWidget:{requires:["lan","root","common","core","html","io","render","algorithm","widget"],files:["widgets/chem/kekule.chemWidget.base.js","widgets/chem/kekule.chemWidget.dialogs.js","widgets/chem/periodicTable/kekule.chemWidget.periodicTables.js","widgets/chem/kekule.chemWidget.chemObjDisplayers.js","widgets/chem/structureTreeView/kekule.chemWidget.structureTreeViews.js","widgets/chem/uiMarker/kekule.chemWidget.uiMarkers.js","widgets/chem/viewer/kekule.chemWidget.viewers.js","widgets/chem/viewer/kekule.chemWidget.spectrumViewers.js","widgets/chem/viewer/kekule.chemWidget.spectrumInspectors.js","widgets/chem/viewer/kekule.chemWidget.viewerGrids.js","widgets/chem/viewer/kekule.chemWidget.chemObjInserters.js","widgets/chem/editor/kekule.chemEditor.extensions.js","widgets/chem/editor/kekule.chemEditor.baseEditors.js","widgets/chem/editor/kekule.chemEditor.operations.js","widgets/chem/editor/kekule.chemEditor.editorUtils.js","widgets/chem/editor/kekule.chemEditor.configs.js","widgets/chem/editor/kekule.chemEditor.repositoryData.js","widgets/chem/editor/kekule.chemEditor.repositories.js","widgets/chem/editor/kekule.chemEditor.utilWidgets.js","widgets/chem/editor/kekule.chemEditor.chemSpaceEditors.js","widgets/chem/editor/kekule.chemEditor.nexus.js","widgets/chem/editor/kekule.chemEditor.actions.js","widgets/chem/editor/kekule.chemEditor.trackParser.js","widgets/chem/editor/kekule.chemEditor.objModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.styleModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.textModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.structureModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.glyphModifiers.js","chemdoc/issueCheckers/kekule.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.chemPropEditors.js","widgets/chem/editor/kekule.chemEditor.composers.js"],category:"chemWidget"},webComponent:{requires:["lan","root","common","core","html","io","render","algorithm","widget","chemWidget"],files:["webComponents/kekule.webComponent.base.js","webComponents/kekule.webComponent.widgetWrappers.js"]},algorithm:{requires:["lan","root","common","core"],files:["algorithm/kekule.graph.js","algorithm/kekule.structures.helpers.js","algorithm/kekule.structures.canonicalizers.js","algorithm/kekule.structures.ringSearches.js","algorithm/kekule.structures.aromatics.js","algorithm/kekule.structures.standardizers.js","algorithm/kekule.structures.searches.js","algorithm/kekule.structures.stereos.js"],category:"algorithm"},calculation:{requires:["lan","root","common","core","algorithm"],files:["calculation/kekule.calc.base.js"]},data:{requires:["root"],files:["data/kekule.chemicalElementsData.js","data/kekule.isotopesData.organSet.js","data/kekule.structGenAtomTypesData.js","data/kekule.dataUtils.js"]},emscripten:{requires:["root","common"],files:["_extras/kekule.emscriptenUtils.js"],category:"extra"},openbabel:{requires:["lan","root","core","emscripten","io"],files:["localization/en/kekule.localize.extras.openbabel.en.js","_extras/OpenBabel/kekule.openbabel.base.js","_extras/OpenBabel/kekule.openbabel.io.js","_extras/OpenBabel/kekule.openbabel.structures.js"],category:"extra"},indigo:{requires:["lan","root","core","emscripten","io"],files:["_extras/Indigo/kekule.indigo.base.js","_extras/Indigo/kekule.indigo.io.js","_extras/Indigo/kekule.indigo.structures.js"],category:"extra"},inchi:{requires:["lan","root","core","emscripten","io"],files:["_extras/InChI/kekule.inchi.js"],category:"extra"}},E=["lan","root","localization","localizationData","common"],b=E.concat(["core","html","io","spectroscopy","render","widget","chemWidget","algorithm","calculation","data"]);b.concat(["emscripten","inchi","openbabel","indigo"]);var v=E.concat(["core","io","spectroscopy","algorithm","calculation","data"]);function I(M){var B=M||b;B=E.concat(B);for(var V=[],J=function(ie,Y){if(ie.indexOf(Y)<0){var ne=T[Y];if(ne&&ne.requires)for(var de=0,Ae=ne.requires.length;de<Ae;++de){var Ce=ne.requires[de];J(ie,Ce)}ie.push(Y)}},$=0,q=B.length;$<q;++$){var Q=B[$];J(V,Q)}return V}function R(M,B,V){var J=[],$=T[M];if($&&$.files)if(B){var q=$.minFile||M+".min.js";V&&(q=V+q),J.indexOf(q)<0&&J.push(q)}else J=J.concat($.files);return J}function N(M,B,V){for(var J=I(M),$=[],q=0,Q=J.length;q<Q;++q){var ie=J[q];$=$.concat(R(ie,B,V))}return $}function L(M){return{src:"",path:"",modules:b,useMinFile:!0}}function U(M,B,V,J,$){typeof Kekule<"u"&&Kekule.LOADED&&(Kekule.LOADED=!1);for(var q=J.modules||[],Q=[],ie=I(M),Y=0,ne=ie.length;Y<ne;++Y)q.indexOf(ie[Y])<0&&Q.push(ie[Y]);if(!Q.length)$();else{for(var de=[],Y=0,ne=ie.length;Y<ne;++Y)de=de.concat(R(Q[Y],B,J.dividedMinSubPath));for(var Ae=[],Ce=V,pe=J.fileUrls||[],fe=[],Y=0,ne=de.length;Y<ne;++Y){var Te=Ce+de[Y];pe.indexOf(Te)<0&&(fe.push(Te),Ae.push(de[Y]))}fe.push(Ce+"kekule.loaded.js"),y(fe,null,function(xe){J.modules=J.modules.concat(Q),J.files=J.files.concat(Ae),J.fileUrls=J.fileUrls.concat(fe),$&&$(xe)})}return{modules:Q,files:Ae,fileUrls:fe}}function W(){var M,B=typeof _kekule_environment_=="object"?_kekule_environment_:typeof n._kekule_environment_=="object"?n._kekule_environment_:null;if(B&&(M=B.scriptInfo,!M&&B.scriptPath&&(M={src:B.scriptSrc,path:B.scriptPath,dividedMinSubPath:B.ScriptdividedMinSubPath,modules:B.scriptModules,useMinFile:B.scriptUseMinFile})),!M){if(r){M=L();var V=M.src&&M.path;V&&(o=!1),!V&&a&&(M.src=this.__filename||"",M.path=((typeof __dirname<"u"?__dirname:"")||".")+"/",o=!0)}else o&&(M={src:this.__filename||"",path:(typeof __dirname<"u"?__dirname:"")+"/",modules:r?b:v,useMinFile:!0,nodeModule:s,nodeRequire:typeof Ap<"u"?Ap:this.require});if(o){var J=M.path+T.root.minFile,$=!1;try{$=d.existsSync(J)}catch{$=!1}$||(M.useMinFile=!1)}}M.dividedMinSubPath||(M.dividedMinSubPath="mins/"),M.dividedModuleExporterSubPath||(M.dividedModuleExporterSubPath="jsmods/"),M.modules||(M.modules=r?b:v),M.useMinFile===void 0&&(M.useMinFile=!0),M.singleMinBundle=n&&n.__$kekule_single_min_bundle__,M.explicitModules=M.modules;var q=I(M.modules);M.modules=[],M.files=[],M.fileUrls=[],M.allModuleStructures=T,n.__$kekule_load_info__=M,n.__$kekule_scriptfile_utils__={appendScriptFile:m,appendScriptFiles:C,loadModuleScriptFiles:U,getModuleJsFiles:R,getEssentialFiles:N,getEssentialModules:I},M.manualLoadScriptFiles=B&&B.manualLoadScriptFiles,(!M.singleMinBundle||typeof M.singleMinBundle>"u")&&(!B||!B.manualLoadScriptFiles)&&U(q,M.useMinFile,M.path||"",M,function(Q){e.Kekule=this.Kekule||u.Kekule,e.Class=this.Class||u.Class,e.ClassEx=this.ClassEx||u.ClassEx,e.ObjectEx=this.ObjectEx||u.ObjectEx,e.DataType=this.DataType||u.DataType,this.Class=e.Class,this.ClassEx=e.ClassEx,this.ObjectEx=e.ObjectEx,this.DataType=e.DataType,this.Kekule.scriptSrcInfo=M})}l||W()})(Hv)}(Vo,Vo.exports)),Vo.exports}Gv();var Ln={},Dp;function zv(){if(Dp)return Ln;Dp=1,function(e){function t(){}function n(d){if(!d)return[];if(d.toArray)return d.toArray();for(var h=d.length||0,p=new Array(h);h--;)p[h]=d[h];return p}typeof self=="object"?e=self:typeof window=="object"&&window.document?e=window:typeof Ci=="object"&&(e=Ci);var i={createCore:function(){var d=null,h=n(arguments),p=h.length>1?h[1]:h[0],g=p&&p.CLASS_NAME;if(!h[0]&&h.length>1)throw"Can not create new class"+(g?" "+g:"")+" , base class not found";function f(){this.initialize.apply(this,arguments)}if(Object.isFunction(h[0])&&(d=h.shift()),Object.extend(f,i.Methods),f.superclass=d,f.subclasses=[],d){var m=function(){};m.prototype=d.prototype,f.prototype=new m,d.subclasses.push(f)}for(var C=0;C<h.length;C++)f.addMethods(h[C]);return f.prototype.initialize||(f.prototype.initialize=t),f.prototype.constructor=f,g&&(i._named_classes[g]=f),f},create:function(){return i.createCore.apply(this,arguments)},free:function(d){d.finalize&&d.finalize(),d=null},findClass:function(d,h){var p=i._named_classes[d];if(!p){var g=Object.getCascadeFieldValue(d,h);p=g&&Object.isFunction(g)&&(g.superclass||g.subclasses)?g:null}return p},_named_classes:{}};i.Methods={addMethods:function(d){if(!d)return this;var h=this.superclass&&this.superclass.prototype,p=Object.keys(d);Object.keys({toString:!0}).length||p.push("toString","valueOf");for(var g=function(){},f=0,m=p.length;f<m;f++){var C=p[f],_=d[C],y=Object.isFunction(_);if(h&&y&&r.argumentNames(_)[0]==="$super"){var T=_;(_=function(E){return function(){return(h[E]||g).apply(this,arguments)}}(C).wrap(T)).valueOf=T.valueOf.bind(T),_.toString=T.toString.bind(T)}this.prototype[C]=_}return this}},Object.extend=function(d,h,p,g){if(p||g)for(var f in h){var m=h[f];p&&m==null||g&&m===""||(d[f]=m)}else for(var f in h)d[f]=h[f];return d},Object.extendEx=function(d,h,p){var g=p||{};for(var f in h){var m=h[f];if((!g.ignoreUnsetValue||m!=null)&&(!g.ignoreEmptyString||m!=="")){var C=d[f];if(!p.preserveExisted||!C){var _=C&&C.constructor&&C.constructor.prototype,y=m&&m.constructor&&m.constructor.prototype;C&&typeof C=="object"&&_===y?Object.extendEx(C,m,p):d[f]=m}}}return d},Object._extendSupportMethods=function(d,h){return Object.extendEx(d,h,{ignoreUnsetValue:!0,preserveExisted:!0})},Object.getCascadeFieldValue=function(d,h){var p,g;g=d.length&&d.splice?d:d.split("."),!h&&(h=e||this);for(var f=0,m=g.length;f<m&&(p=h[g[f]]);++f)h=p;return p},Object.setCascadeFieldValue=function(d,h,p,g){for(var f,m=p,C=0,_=(f=d.length&&d.splice?d:d.split(".")).length;C<_;++C){var y=f[C];if(C===_-1)return m[y]=h,h;var T=m[y];if(!T&&g&&(T={},m[y]=T),!T)return!1;m=T}},Object._inherit=function(d){d===null&&(d={});var h=typeof d;if(!o.isFunctionType(h)&&!o.isObjectType(h))throw TypeError();function p(){}return p.prototype=d,new p},Object.create||(Object.create=Object._inherit),Object.copyValues=function(d,h,p){if(p){for(var g=0,f=p.length;g<f;++g){var m=p[g],C=h[m];C!==void 0&&(d[m]=C)}return d}return Object.extend(d,h)},Object._extendSupportMethods(Object,{keys:function(d){var h=[];for(var p in d)h.push(p);return h},isFunction:function(d){return typeof d=="function"},isUndefined:function(d){return d===void 0}}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(d){var h=[];for(var p in d)d.hasOwnProperty(p)&&h.push(p);return h});var r={argumentNames:function(d){var h=((d.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)||[])[1]||"").replace(/\s+/g,"").split(",");return h.length!=1||h[0]?h:[]}};Object._extendSupportMethods(Function.prototype,{argumentNames:function(){var d=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return d.length!=1||d[0]?d:[]},wrap:function(d){var h=this;return function(){return d.apply(this,[h.bind(this)].concat(n(arguments)))}},methodize:function(){if(this._methodized)return this._methodized;var d=this;return this._methodized=function(){var h=Array.prototype.slice.call(arguments);return h.unshift(this),d.apply(null,h)}},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var d=this,h=n(arguments),p=h.shift();return function(){return d.apply(p,h.concat(n(arguments)))}},delay:function(){var d=this,h=n(arguments),p=h.shift();return e.setTimeout(function(){return d.apply(d,h)},p)},defer:function(){var d=this,h=n(arguments);return h.shift(),e.setTimeout(function(){return d.apply(d,h)},10)}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(d,h){h||(h=0);var p=this.length;for(h<0&&(h=p+h);h<p;h++)if(this[h]===d)return h;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(d,h){h=isNaN(h)?this.length:(h<0?this.length+h:h)+1;var p=this.slice(0,h).reverse().indexOf(d);return p<0?p:h-p-1}),Array.prototype.map&&(Array.prototype.map=function(d){var h,p,g;if(this==null)throw new TypeError("this is null or not defined");var f=Object(this),m=f.length>>>0;if(typeof d!="function")throw new TypeError(d+" is not a function");for(arguments.length>1&&(h=arguments[1]),p=new Array(m),g=0;g<m;){var C,_;g in f&&(C=f[g],_=d.call(h,C,g,f),p[g]=_),g++}return p}),Object._extendSupportMethods(String.prototype,{gsub:function(d,h){for(var p="",g=this;g.length>0;)g.match(d)===void 0?(p+=g.slice(0,(void 0).index),p+=h,g=g.slice((void 0).index+(void 0)[0].length)):(p+=g,g="");return p},sub:function(d,h,p){return p=Object.isUndefined(p)?1:p,this.gsub(d,function(g){return--p<0?g[0]:h(g)})},scan:function(d,h){return this.gsub(d,h),String(this)},truncate:function(d,h){return d=d||30,h=Object.isUndefined(h)?"...":h,this.length>d?this.slice(0,d-h.length)+h:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var d=new RegExp(Prototype.ScriptFragment,"img"),h=new RegExp(Prototype.ScriptFragment,"im");return(this.match(d)||[]).map(function(p){return(p.match(h)||["",""])[1]})},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")},unescapeHTML:function(){return this.replace(/\<br \/\>/g,`
`).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},toQueryParams:function(d){var h=this.strip().match(/([^?#]*)(#.*)?$/);return h?h[1].split(d||"&").inject({},function(p,g){if((g=g.split("="))[0]){var f=decodeURIComponent(g.shift()),m=g.length>1?g.join("="):g[0];m!=null&&(m=decodeURIComponent(m)),f in p?(Object.isArray(p[f])||(p[f]=[p[f]]),p[f].push(m)):p[f]=m}return p}):{}},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(d){return d<1?"":new Array(d+1).join(this)},camelize:function(){var d=this.split("-"),h=d.length;if(h==1)return d[0];for(var p=this.charAt(0)=="-"?d[0].charAt(0).toUpperCase()+d[0].substring(1):d[0],g=1;g<h;g++)p+=d[g].charAt(0).toUpperCase()+d[g].substring(1);return p},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1-$2").replace(/([a-z\d])([A-Z])/g,"$1-$2").replace(/-/g,"-").toLowerCase()},inspect:function(d){var h=this.gsub(/[\x00-\x1f\\]/,function(p){var g=String.specialChar[p[0]];return g||"\\u00"+p[0].charCodeAt().toPaddedString(2,16)});return d?'"'+h.replace(/"/g,'\\"')+'"':"'"+h.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(!0)},unfilterJSON:function(d){return this.sub(d||Prototype.JSONFilter,"#{1}")},isJSON:function(){var d=this;return!d.blank()&&(d=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""),/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(d))},include:function(d){return this.indexOf(d)>-1},startsWith:function(d){return this.indexOf(d)===0},endsWith:function(d){var h=this.length-d.length;return h>=0&&this.lastIndexOf(d)===h},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(d,h){return new Template(this,h).evaluate(d)}}),Object._extendSupportMethods(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){for(var d=this,h=0;h<arguments.length;h++){var p=new RegExp("\\{"+h+"\\}","gi");d=d.replace(p,arguments[h])}return d},trim:function(){return this.replace(/^\s*|\s*$/g,"")},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},trimLeft:function(){return this.ltrim()},trimRight:function(){return this.rtrim()},pad:function(d,h,p){for(var g=h||" ",f=[],m=0,C=d-this.length;m<C;++m)f.push(g);return p?this+f.join(""):f.join("")+this},lpad:function(d,h){return this.pad(d,h,!1)},rpad:function(d,h){return this.pad(d,h,!0)},reverse:function(){for(var d=[],h=this.length-1;h>=0;--h)d.push(this.charAt(h));return d.join("")},toCharArray:function(){for(var d=[],h=0,p=this.length;h<p;++h)d.push(this.charAt(h));return d},hyphenize:function(d){d||(d="-");for(var h=this.length,p=[],g=0;g<h;++g){var f=this.charAt(g);g!==0&&f>="A"&&f<="Z"?p.push(d+f.toLowerCase()):p.push(f)}return p.join("")}});var a={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(d){for(var h=0,p=d.length;h<p;++h){var g=d.charAt(h);if(!(g>="0"&&g<="9")&&g!=".")return!1}return!0},isNumbericStr:function(d){var h=Number(d);return!isNaN(h)},serializeValue:function(d,h){var p=h||[],g=o.getType(d);if(p.indexOf(g)>=0)return d.toString();if(d===null)return a.SNULL;if(d===void 0)return a.SUNDEFINED;if(d!=d)return a.SNAN;switch(g){case"boolean":return d?a.STRUE:a.SFALSE;case"number":case o.INT:case o.FLOAT:return(d>=0?a.SPOSITIVE:"")+d;case o.DATE:return a.SDATEPREFIX+d.toString();default:return d.toString()}},deserializeValue:function(d,h){if(typeof d!="string")return d;switch(d){case a.STRUE:return!0;case a.SFALSE:return!1;case a.SNULL:return null;case a.SUNDEFINED:return;case a.SNAN:return NaN;default:if(h){if(!d&&[o.NUMBER,o.INT,o.FLOAT].indexOf(h)>=0)return;switch(h){case o.FLOAT:return parseFloat(d);case o.INT:return parseInt(d);case"number":return parseFloat(d);case"boolean":return!!d;default:return d}}else switch(d.charAt(0)){case a.SPOSITIVE:case a.SNEGATIVE:var p=d.substring(1);return a.isNumbericStr(p)?parseFloat(d):d;case a.SDATEPREFIX:p=d.substr(1);try{var g=new Date(p);return isNaN(g.getTime())?d:g}catch{return d}default:return d}}}};Object.extend(Date.prototype,{copyFrom:function(d){this.setFullYear(d.getFullYear(),d.getMonth(),d.getDate()),this.setTime(d.getTime())}}),Date.now||(Date.now=function(){return new Date().getTime()}),Math.sqr||(Math.sqr=function(d){return d*d}),Math.sign||(Math.sign=function(d){return d>0?1:d<0?-1:0}),Math.log10||(Math.log10=function(d){return Math.log(d)*Math.LOG10E}),e.Node===void 0&&(e.Node=function(){}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),i.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1},i.PropList=function(){this.props=[]},i.PropList.prototype={addProperty:function(d,h){var p;return h||(h={}),(p=this.getPropInfo(d))||(p={},this.props.push(p)),(p=Object.extend(p,h)).serializable===void 0&&(p.serializable=!0),p.name=d,p},removeProperty:function(d){var h=this.indexOf(d);h>=0&&this.props.splice(h,1)},removePropAt:function(d){d>=0&&this.props[d]&&this.props.splice(d,1)},getLength:function(){return this.props.length},indexOf:function(d){for(var h=0,p=this.props.length;h<p;++h)if(this.props[h].name===d)return h;return-1},getPropInfoAt:function(d){return d>=0?this.props[d]:null},getPropInfo:function(d){var h=this.indexOf(d);return this.getPropInfoAt(h)},hasProperty:function(d){return this.indexOf(d)>=0},clear:function(){this.props.clear()},clone:function(){var d=new i.PropList;return d.props=this.props.slice(),d},appendList:function(d){for(var h=0,p=d.props.length;h<p;++h)this.props.push(d.props[h])}},i.PropList.prototype.constructor=i.PropList,i.EventHandlerList=function(){this.handlers=[],this._$flag_="KekuleEventList"},i.EventHandlerList.prototype={add:function(d,h){h||(h=null),this.handlers.push({thisArg:h,handler:d})},remove:function(d,h){var p=this.indexesOf(d,h);if(p.length>0)for(var g=p.length-1;g>=0;--g)this.removeAt(p[g])},removeAt:function(d){for(var h=d,p=this.handlers.length;h<p;++h)this.handlers[h]=this.handlers[h+1];this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(d){return this.handlers[d]},indexOf:function(d,h){for(var p=0,g=this.handlers.length;p<g;++p)if(this.handlers[p].handler==d&&(h!==void 0&&this.handlers[p].thisArg===h||h===void 0))return p;return-1},indexesOf:function(d,h){for(var p=[],g=0,f=this.handlers.length;g<f;++g)this.handlers[g].handler==d&&(h!==void 0&&this.handlers[g].thisArg===h||h===void 0)&&p.push(g);return p},getLength:function(){return this.handlers.length}},i.EventHandlerList.constructor=i.EventHandlerList;var o={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(d){return d==o.STRING||d==o.NUMBER||d==o.INT||d==o.FLOAT||d==o.BOOL||d==o.UNDEFINED||d==o.PRIMARY},isComplexType:function(d){return!(o.isSimpleType(d)||o.isFunctionType(d))},isFunctionType:function(d){return d==o.FUNCTION},isObjectType:function(d){return d==o.OBJECT},isDateType:function(d){return d==o.DATE},isObjectExType:function(d){var h=o.isComplexType(d)&&!o.isObjectType(d)&&!o.isDateType(d);if(h){var p=u.findClass(d);h=p&&u.isOrIsDescendantOf(p,c)}return h},getType:function(d){var h=typeof d;switch(h){case"undefined":return o.UNDEFINED;case"function":return o.FUNCTION;case"boolean":return o.BOOL;case"string":return o.STRING;case"number":return Math.floor(d)==d?o.INT:o.FLOAT;case"object":return this.isDateValue(d)?o.DATE:o.isArrayValue(d)?o.ARRAY:u.isClass(d)?o.CLASS:o.isObjectExValue(d)&&d.getClassName?d.getClassName():o.OBJECT;default:return h}},isSimpleValue:function(d){return o.isSimpleType(typeof d)},isUndefinedValue:function(d){return d===void 0},isNullValue:function(d){return d===null},isFunctionValue:function(d){return typeof d=="function"},isObjectValue:function(d){return!!d&&typeof d=="object"&&!o.isArrayValue(d)&&!o.isDateValue(d)},isDateValue:function(d){return!!d&&typeof d=="object"&&d.getFullYear!==void 0},isArrayValue:function(d){return!!d&&typeof d=="object"&&d.length!==void 0},isObjectExValue:function(d){return d instanceof c},createInstance:function(d){switch(d){case o.UNDEFINED:return;case o.DATE:return new Date;case o.ARRAY:return new Array;case o.OBJECT:return new Object;case o.FUNCTION:return function(){};default:return new(u.findClass(d.capitalizeFirst()))}}},l=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),u={isClass:function(d){return!!d&&!(!d.superclass&&!d.subclasses)},findClass:function(d,h){return i.findClass(d,h||e)},getClassName:function(d){return d?d.prototype.CLASS_NAME:null},getClassLocalName:function(d){var h=u.getClassName(d),p=h.lastIndexOf(".");return p>=0?h.substring(p+1):h},getPrototype:function(d){return d.prototype},getSuperClass:function(d){return d.superclass||d.constructor.superclass},getSuperClassPrototype:function(d){return d.superclass?d.superclass.prototype:null},_getCommonSuperClass2:function(d,h){for(var p=d;p&&!u.isOrIsDescendantOf(h,p);)p=u.getSuperClass(p);return p},getCommonSuperClass:function(d){if(!d||!d.length)return null;var h=d[0].getClass?d[0].getClass():null;if(!h)return null;for(var p=1,g=d.length;p<g;++p){var f=d[p].getClass?d[p].getClass():null;if(!f)return null;h=u._getCommonSuperClass2(h,f)}return h},isDescendantOf:function(d,h){for(var p=u.getSuperClass(d);p&&p!==h;)p=u.getSuperClass(p);return!!p},isOrIsDescendantOf:function(d,h){return d===h||u.isDescendantOf(d,h)},isOrIsDescendantOfClasses:function(d,h){for(var p=0,g=h.length;p<g;++p)if(u.isOrIsDescendantOf(d,h[p]))return!0;return!1},_ensurePropertySystem:function(d){var h=u.getPrototype(d);if(h&&!h.hasOwnProperty("properties")){var p=u.getSuperClass(d);p&&u._ensurePropertySystem(p),u._createPropertyList(d),u._remapPropGetters(d),h.hasOwnProperty("initProperties")&&h.initProperties.apply(h)}},_createPropertyList:function(d){u.getPrototype(d).hasOwnProperty("properties")||(u.getPrototype(d).properties=new i.PropList)},_remapPropGetters:function(d,h){for(var p=u.getPrototype(d),g=h||Object.getOwnPropertyNames(p),f=0,m=g.length;f<m;++f){var C=g[f];if(C.length>5&&C.startsWith("doGet")){var _=p[C];if(typeof _=="function"){var y=C.charAt(5).toLowerCase()+C.substr(6);if(p.hasDirectProperty(y))continue;var T=u.getPropInfo(d,y);if(T&&T.getter&&(p["get"+y.capitalizeFirst()]=_,l)){var E=Object.extend({},T.descriptor);E.get=_;try{Object.defineProperty(p,y,E)}catch(b){throw b}}}}}},getOwnPropList:function(d){var h=u.getPrototype(d);return h?(h._initPropertySystem(),h.properties):null},getAllPropList:function(d){var h,p=u.getSuperClassPrototype(d);return p?(h=p.getAllPropList().clone()).appendList(u.getOwnPropList(d)):h=u.getOwnPropList(d),h},getPropListOfScopes:function(d,h){var p,g=function(m,C){var _=u.getOwnPropList(m).clone();if(_)for(var y=_.getLength()-1;y>=0;--y){var T=_.getPropInfoAt(y).scope||i.PropertyScope.DEFAULT;C.indexOf(T)<0&&_.removePropAt(y)}return _},f=u.getSuperClass(d);return f?(p=u.getPropListOfScopes(f,h).clone()).appendList(g(d,h)):p=g(d,h),p},defineProp:function(d,h,p){return u._ensurePropertySystem(d),u.getPrototype(d).defineProp(h,p)},defineProps:function(d,h){u._ensurePropertySystem(d);for(var p=u.getPrototype(d),g=0,f=h.length;g<f;++g){var m=h[g],C=m.name,_=m;p.defineProp(C,_)}},getPropInfo:function(d,h,p){return u.getPrototype(d).getPropInfo(h,p)},defineEvent:function(d,h){return u.getPrototype(d).defineEvent(h)},getUnusedMethodName:function(d,h,p){for(var g=p||0,f=u.getPrototype(d),m=h+Number(g).toString();f[m];)++g,m=h+Number(g).toString();return m},extendMethod:function(d,h,p){var g=u.getPrototype(d),f=g[h],m=u.getUnusedMethodName(d,"__$changed$_"+h+"__");g[m]=f;var C,_=(C=m,function(){return g[C].apply(this,arguments)}).wrap(p);g[h]=_,_.valueOf=p.valueOf.bind(p),_.toString=p.toString.bind(p)},extendMethods:function(d,h){for(var p=Object.keys(h),g=0,f=p.length;g<f;++g){var m=p[g],C=h[m];typeof C=="function"&&u.extendMethod(d,m,C)}},extend:function(d,h){var p=u.getPrototype(d),g=u.getSuperClassPrototype(d),f=Object.keys(h);Object.keys({toString:!0}).length||f.push("toString","valueOf");for(var m=0,C=f.length;m<C;m++){var _=f[m],y=h[_];if(typeof y=="function"){var T=r.argumentNames(y),E=T[0];if(E=="$origin"){var b=y,v=p[_],I=u.getUnusedMethodName(d,"__$changed$_"+_+"__");p[I]=v,(y=function(R){return function(){return p[R].apply(this,arguments)}}(I).wrap(b)).valueOf=b.valueOf.bind(b),y.toString=b.toString.bind(b),T.shift(),E=T.first()}E=="$super"&&(b=y,(y=function(R){return function(){return g[R].apply(this,arguments)}}(_).wrap(b)).valueOf=b.valueOf.bind(b),y.toString=b.toString.bind(b))}p[_]=y}return u._remapPropGetters(d,f),d}},c=i.create({CLASS_NAME:"ObjectEx",EVENT_HANDLERS_FIELD:"__$__k__eventhandlers__$__",initialize:function(){this._initPropertySystem(),this._updateStatus=0,this._childChangeEventSuppressed=!1,this._modifiedProps=[],this._finalized=!1,this.beginUpdate();try{this.initPropValues()}finally{this.endUpdate()}this.afterInitialization()},afterInitialization:function(){},finalize:function(){this._finalized||(this.doFinalize(),this.invokeEvent("finalize",{obj:this}),this[this.EVENT_HANDLERS_FIELD]=null,this._finalized=!0)},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:o.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("enablePropValueSetEvent",{dataType:o.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("enableObjectChangeEvent",{dataType:o.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("bubbleEvent",{dataType:o.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("suppressChildChangeEventInUpdating",{dataType:o.BOOL,serializable:!1,scope:i.PropertyScope.PUBLIC}),this.defineProp("eventHandlers",{dataType:o.HASH,serializable:!1,scope:i.PropertyScope.PRIVATE,setter:null,getter:function(){var d=this[this.EVENT_HANDLERS_FIELD];return d||(d={},this[this.EVENT_HANDLERS_FIELD]=d),d}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(d){},allSaved:function(d){},loaded:function(d){},allLoaded:function(d){},_initPropertySystem:function(){u._ensurePropertySystem(this.getClass())},_createPropertyList:function(){u._createPropertyList(this.getClass())},_remapPropGetters:function(){u._remapPropGetters(this.getClass())},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getClassLocalName:function(){return u.getClassLocalName(this.getClass())},getSerializationName:function(){return this.getClassName()},getPrototype:function(){return this.prototype?this.prototype:this.constructor.prototype},getSuperClassPrototype:function(){return this.constructor&&this.constructor.superclass?this.constructor.superclass.prototype:null},$super:function(d,h){var p=this.getSuperClassPrototype();return d?this.tryCallSuper.apply(this,arguments):p},applySuper:function(d,h,p){var g=this.__getLastSuperMethodCallTarget__(d),f=this.__getMethodBelongedPrototype__(d,g),m=this.__getMethodBelongedPrototype__(d,g.getSuperClassPrototype());m&&m===f&&(m=this.__getMethodBelongedPrototype__(d,m.getSuperClassPrototype()));var C=m&&m[d];if(C){var _;try{this.__pushSuperMethodCallTargetStack__(d,m),_=h?C.apply(this,h):C.apply(this)}finally{this.__popSuperMethodCallTargetStack__(d)}return _}if(!p)throw"Super method not found: "+d},tryApplySuper:function(d,h){return this.applySuper(d,h,!0)},tryCallSuper:function(){var d=n(arguments),h=d.shift();return this.tryApplySuper(h,d)},__getMethodBelongedPrototype__:function(d,h){if(!h)return null;if(h.hasOwnProperty(d))return h;var p=h.getSuperClassPrototype&&h.getSuperClassPrototype();return p&&p.__getMethodBelongedPrototype__?p.__getMethodBelongedPrototype__(d,p):null},__getSuperMethodCallTargetStack__:function(d){var h=this.__$superMethodCallTargetStacks__;h||(h={},this.__$superMethodCallTargetStacks__=h);var p=h[d];return p||(p=[],h[d]=p),p},__getLastSuperMethodCallTarget__:function(d){var h=this.__getSuperMethodCallTargetStack__(d);return h.length?h[h.length-1]:this.getPrototype()},__pushSuperMethodCallTargetStack__:function(d,h){this.__getSuperMethodCallTargetStack__(d).push(h)},__popSuperMethodCallTargetStack__:function(d){var h=null,p=this.__$superMethodCallTargetStacks__,g=p&&p[d];return g&&(h=g.pop(),g.length||delete p[d]),h},__changeClass__:function(d){var h=u.getPrototype(d);return this.prototype=h,this.__proto__=h,this.constructor=d,this.objectChange(["__proto__"]),this},getOwnPropList:function(){return this._initPropertySystem(),this.getPrototype().properties},getAllPropList:function(){var d,h=this.getSuperClassPrototype();return h?(d=h.getAllPropList().clone()).appendList(this.getOwnPropList()):d=this.getOwnPropList().clone(),d},getPropListOfScopes:function(d){return u.getPropListOfScopes(this.getClass(),d)},getPropInfoHashKey:function(d){return c._PROPINFO_HASHKEY_PREFIX+d},getDefPropStoreFieldName:function(d){return c._PROP_STOREFIELD_PREFIX+d},defineProp:function(d,h){var p;(p=h?Object.extend({},h):{}).serializable===void 0&&(p.serializable=!0),p.storeField=this.getDefPropStoreFieldName(d);var g,f,m=this.getOwnPropList().addProperty(d,p);if(p.getter!==null&&p.getter!==!1&&(g=this.createPropGetter(m,p.getter),m.getter=g.doGetterName),p.setter!==null&&p.setter!==!1&&(f=this.createPropSetter(m,p.setter),m.setter=f.doSetterName),this[this.getPropInfoHashKey(d)]=m,l){var C={enumerable:p.enumerable,configurable:!1};C.enumerable===void 0&&(C.enumerable=!0),g&&(C.get=this[g.getterName]),f&&(C.set=this[f.setterName]),m.descriptor=C;try{Object.defineProperty(this,d,C)}catch(_){throw _}}return m},createPropGetter:function(d,h){var p=d.name.toString().upperFirst(),g="get"+p,f="doGet"+p,m=this[f];if(!m){var C=d.storeField;m=h||function(){return this[C]},this.getPrototype()[f]=m}return this.getPrototype()[g]=m,{getterName:g,doGetterName:f}},createPropSetter:function(d,h){var p=d.name.toString(),g=p.upperFirst(),f="set"+g,m="doSet"+g,C=this[m];if(!this[m]){var _=d.storeField;C=h||function(y){this[_]=y},this.getPrototype()[m]=C}return this.getPrototype()[f]=function(){var y=arguments[0];return this[m].apply(this,arguments),this.notifyPropSet(p,y),this},{setterName:f,doSetterName:m}},hasProperty:function(d){return this.getPropInfo(d)!=null},hasDirectProperty:function(d){return this.getPropInfo(d,!0)!=null},getPropInfo:function(d,h){var p,g=d||"";if(h||(p=this[this.getPropInfoHashKey(g)||""]),!p&&!(p=this.getOwnPropList().getPropInfo(g))&&!h){var f=this.getSuperClassPrototype();p=f&&f.getPropInfo?f.getPropInfo(g):null}return p},getPropertyDataType:function(d){var h=this.getPropInfo(d);return h?h.dataType:null},isPropertySerializable:function(d){var h=this.getPropInfo(d),p=h&&h.serializable;return p===void 0||!!p},getPropStoreFieldValue:function(d){return this[c._PROP_STOREFIELD_PREFIX+d]},getPropValue:function(d){var h,p=this.getPropInfo(d);if(p){if(p.getter){var g=Array.prototype.slice.call(arguments);g.shift(),h=this[p.getter].apply(this,g)}else h=this[p.storeField];return h}return null},getCascadePropValue:function(d){for(var h,p,g=this,f=0,m=(p=d.length&&d.splice?d:d.split(".")).length;f<m&&(h=g.getPropValue(p[f]));++f)g=h;return h},getPropValues:function(d){var h={};if(o.isArrayValue(d))for(var p=0,g=d.length;p<g;++p)h[f=d[p]]=this.getPropValue(f);else if(o.isObjectValue(d))for(var f in d)d.hasOwnProperty(f)&&typeof d[f]!="function"&&(h[f]=this.getPropValue(f));return h},setPropStoreFieldValue:function(d,h){this[c._PROP_STOREFIELD_PREFIX+d]=h},setPropValue:function(d,h,p){var g=this.getPropInfo(d);return g&&(g.setter?this[g.setter].apply(this,[h]):p&&(this[g.storeField]=h),this.notifyPropSet(d,h)),this},setPropValueX:function(){var d=Array.prototype.slice.call(arguments),h=d.shift(),p=this.getPropInfo(h);return p&&(p.setter&&this[p.setter].apply(this,d),this.notifyPropSet(h,this.getPropValue(h))),this},setPropValues:function(d,h){for(var p in d)if(d.hasOwnProperty(p)&&this.hasProperty(p)){var g=d[p];this.setPropValue(p,g,h)}return this},setCascadePropValue:function(d){for(var h,p=Array.prototype.slice.call(arguments),g=this,f=0,m=(h=(d=p.shift()).length&&d.splice?d:d.split(".")).length-1;f<m&&(g=g.getPropValue(h[f]));++f);return g&&(p.unshift(h[m]),g.setPropValueX.apply(g,p)),this},_isPropGetOrSetEvent:function(d){return d=="propValueGet"||d=="propValueSet"},notifyPropSet:function(d,h,p){this.isUpdating()?this._modifiedProps.indexOf(d)<0&&this._modifiedProps.push(d):this._isPropGetOrSetEvent(d)||this.isEventPropName(d)||(this.doPropChanged(d,h),this.getPropStoreFieldValue("enablePropValueSetEvent")&&this.invokeEvent("propValueSet",{propName:d,propValue:h}),p||this.objectChange([d]))},objectChange:function(d){var h=[].concat(d);if(this.doObjectChange(d),this.getEnableObjectChangeEvent()){var p=h.indexOf("enableObjectChangeEvent");p>=0&&h.splice(p,1),this.invokeEvent("change",{changedPropNames:h})}},doObjectChange:function(d){},doPropChanged:function(d,h){},defineEvent:function(d){},eventNameToPropName:function(d){return"__event_"+d},isEventPropName:function(d){return typeof d=="string"&&d.indexOf("__event_")>=0},isEventHandlerList:function(d){return d&&typeof d=="object"&&d instanceof i.EventHandlerList},getEventHandlerList:function(d){var h=this.getEventHandlers(),p=h[d];return p||(p=new i.EventHandlerList,h[d]=p),p},addEventListener:function(d,h,p){var g=this.getEventHandlerList(d);return this.isEventHandlerList(g)?(d==="change"&&this.setEnableObjectChangeEvent(!0),g.add(h,p)):null},addOnceEventListener:function(d,h,p){var g=this,f=function(m){g.removeEventListener(d,f,p),h(m)};return this.addEventListener(d,f,p)},removeEventListener:function(d,h,p){var g=this.getEventHandlerList(d);if(this.isEventHandlerList(g))return g.remove(h,p)},on:function(d,h,p){return this.addEventListener(d,h,p)},once:function(d,h,p){return this.addOnceEventListener(d,h,p)},off:function(d,h,p){return this.removeEventListener(d,h,p)},invokeEvent:function(d,h){h?(h.name=d,h.target=this):h={name:d,target:this},h.stopImmediatePropagation||(h.stopImmediatePropagation=this._eventStopImmediatePropagation),h.stopPropagation||(h.stopPropagation=this._eventCancelBubble),h.preventDefault||(h.preventDefault=this._eventPreventDefault),this.dispatchEvent(d,h),this.dispatchEvent("eventInvoke",{event:h,target:this,name:"eventInvoke"})},_eventStopImmediatePropagation:function(){this._stopImmediatePropagation=!0,this._cancelBubble=!0},_eventCancelBubble:function(){this._cancelBubble=!0},_eventPreventDefault:function(){this._preventDefault=!0},relayEvent:function(d,h){h.currentTarget=this,d==="change"&&this.getSuppressChildChangeEventInUpdating()&&this.isUpdating()?this._childChangeEventSuppressed=!0:this.dispatchEvent(d,h)},dispatchEvent:function(d,h){for(var p=this.getEventHandlerList(d),g=0,f=p.getLength();g<f&&!h._stopImmediatePropagation;++g){var m=p.getHandlerInfo(g);m.handler.apply(m.thisArg,[h])}if(!h._cancelBubble&&this.getBubbleEvent()){var C=this.getHigherLevelObj();C&&C.relayEvent&&C.relayEvent(d,h)}},stopEventPropagation:function(d){d.cancelBubble=!0},overwriteMethod:function(d,h){var p=this,g=this[d];return this[d]=function(){var f=Array.prototype.slice.call(arguments);return f.unshift(g&&g.bind(p)),h.apply(p,f)},this},assign:function(d){return d.assignTo(this)},assignTo:function(d){var h={};this.saveObj(h,"json"),d.loadObj(h,"json")},clone:function(){var d=new(this.getClass());return this.assignTo(d),d},beginUpdate:function(){this.doBeginUpdate()},doBeginUpdate:function(){++this._updateStatus},endUpdate:function(){if(--this._updateStatus,this.checkUpdateStatus(),!this.isUpdating()){var d=this._modifiedProps||[];this._modifiedProps=[],this._childChangeEventSuppressed&&(d.push("[children]"),this._childChangeEventSuppressed=!1),this.doEndUpdate(d)}},doEndUpdate:function(d){if(d.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent"))for(var h=0,p=d.length;h<p;++h){var g=d[h],f=this.getPropValue(g);this.notifyPropSet(g,f,!0)}this.objectChange(d)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(d){return this._modifiedProps.indexOf(d)>=0},checkUpdateStatus:function(){this._updateStatus<=0&&(this._updateStatus=0)},copyPropsTo:function(d){for(var h=this.getAllPropList(),p=0,g=h.getLength();p<g;++p){var f=h.getPropInfoAt(p).name;if(d.hasProperty(f)){var m=this.getPropValue(f);d.setPropValue(f,m,!0)}}}});c._PROPINFO_HASHKEY_PREFIX="__$propInfo__",c._PROP_STOREFIELD_PREFIX="__$__k__p__",e.Class=i,e.ClassEx=u,e.ObjectEx=c,e.DataType=o,o.StringUtils=a}(Ln),function(e){var t={parse:function(i){return JSON.parse(i)},serializeToStr:function(i,r){return r&&r.prettyPrint?JSON.stringify(i,null,r.indentSpaces||2):JSON.stringify(i)}},n={DOM_PARSER:null,DOM_IMPLEMENTATION:null,XML_SERIALIZER:null,DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:2e4,DEF_BYPASS_ROOT_ELEM:!0,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(i,r){if(i||(i=""),r||(r=""),n.DOM_IMPLEMENTATION)return a=new n.DOM_IMPLEMENTATION().createDocument(r,i,null);if(typeof document<"u"){if(document.implementation&&document.implementation.createDocument)return a=document.implementation.createDocument(r,i,null);if(typeof ActiveXObject<"u"){var a=new ActiveXObject("MSXML2.DOMDocument");if(i){var o="",l=i,u=i.indexOf(":");u!=-1&&(o=i.substring(0,u),l=i.substring(u+1));var c="<"+(o?o+":":"")+l+(r?(o?" xmlns:":" xmlns")+o+'="'+r+'"':"")+"/>";a.loadXML(c)}return a}}},parse:function(i){if(n.DOM_PARSER)return new n.DOM_PARSER().parseFromString(i,"application/xml");if(typeof document<"u"){if(typeof DOMParser<"u")return new DOMParser().parseFromString(i,"application/xml");if(typeof ActiveXObject<"u"){var r=n.newDocument();return r.loadXML(i),r}var a="data:text/xml;charset=utf-8,"+encodeURIComponent(i),o=new XMLHttpRequest;return o.open("GET",a,!1),o.send(null),o.responseXML}},load:function(i,r,a){return n.loadHelper.loadSimple(i,r,(a||{}).timeout)},loadHelper:{loadSimple:function(i,r,a){var o=r!=null;if(a==null&&(a=n.DEF_LOAD_TIMEOUT),document.implementation&&document.implementation.createDocument){var l=new XMLHttpRequest,u=null;a&&(u=setTimeout(function(){c(null,!1)},a));var c=function(h,p){u&&clearTimeout(u),r&&r(h,p)};o&&(l.onreadystatechange=function(){if(l.readyState==4){var h=l.responseXML;h&&h.documentElement?c(h,!0):c(null,!1)}});try{l.open("get",i,o),l.send(null)}catch{c(null,!1)}var d=l.responseXML;return d&&d.documentElement?d:null}return n.loadHelper.loadSimpleViaDoc(i,r)},loadSimpleViaDoc:function(i,r){var a=r!=null,o=n.newDocument("dummy_dummy_dummy_dummy");return o.async=a,a&&(o.onreadystatechange=function(){o.readyState==4&&(o.documentElement&&o.documentElement.tag!="dummy_dummy_dummy_dummy"?r(o,!0):r(o,!1))}),o.load(i),o}},serializeNode:function(i,r){if(r&&r.prettyPrint)return n.serializeNodePretty(i);if(n.XML_SERIALIZER)return new n.XML_SERIALIZER().serializeToString(i);if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(i);if(i.xml)return i.xml;throw"XML.serialize is not supported or can't serialize "+i},serializeNodePretty:function(i){try{return n.XML_SERIALIZER?new n.XML_SERIALIZER().serializeToString(i).toXMLString():new XMLSerializer().serializeToString(i).toXMLString()}catch{return n.serializeNode(i)}},getXmlDocUrl:function(i){return i.url||i.documentURI||i.URL||i.location}};DataType.JsonUtility=t,DataType.XmlUtility=n}(),function(){var e=Class.create(ObjectEx,{CLASS_NAME:"ObjSerializer",SERIALIZER_NAME:null,getSerializerName:function(){return this.SERIALIZER_NAME},serializeValue:function(r){return r},deserializeValue:function(r,a){return r},propNameToStorageName:function(r){return r},storageNameToPropName:function(r){return r},getObjCustomSaveMethod:function(r){return r.doSaveObj},getObjCustomLoadMethod:function(r){return r.doLoadObj},getObjCustomPropSaveMethod:function(r){return r.doSaveProp},getObjCustomPropLoadMethod:function(r){return r.doLoadProp},isUndefined:function(r){return DataType.isUndefinedValue(r)},isNull:function(r){return r===null},isNaN:function(r){return r!=r},isFunction:function(r){return DataType.isFunctionValue(r)},isArray:function(r){return DataType.isArrayValue(r)},isDate:function(r){return DataType.isDateValue(r)},isObject:function(r){return DataType.isObjectValue(r)},isObjectEx:function(r){return DataType.isObjectExValue(r)},isSimpleType:function(r){var a=typeof r;return a=="string"||a=="number"||a=="boolean"||a=="undefined"||this.isNull(r)},isComplexType:function(r){return!this.isSimpleType(r)},createChildStorageNode:function(r,a,o){},appendArrayItemStorageNode:function(r,a,o){},getNameForArrayItemStorageNode:function(r){return this.getDefaultArrayItemStorageName()},getChildStorageNode:function(r,a){},getAllArrayItemStorageNodes:function(r){},getAllStoredStorageNames:function(r){},setStorageNodeExplicitType:function(r,a){},getStorageNodeExplicitType:function(r){},getStorageNodeName:function(r){},isComplexStorageNode:function(r){},isComplexArrayItemStorageNode:function(r){},isSimpleStorageNode:function(r){},getValueExplicitType:function(r){return r instanceof ObjectEx?r.getClassName():this.isObject(r)?DataType.OBJECT:this.isArray(r)?DataType.ARRAY:this.isDate(r)?DataType.DATE:typeof r},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function(r,a,o){var l=[],u=this.saveObj(r,a,o,r,a,l);if(u)for(var c=0,d=l.length;c<d;++c)l[c]&&this.isFunction(l[c].allSaved)&&l[c].allSaved(r);return u},saveObj:function(r,a,o,l,u,c){if(typeof r=="object"){var d=this.getObjCustomSaveMethod(r);if(d)return d(r,a,o||{},this,l,u,c)}var h=this.doSave(r,a,o||{},l,u,c);return h&&(c||console.log(r,r.getClassName&&r.getClassName()),c.push(r),this.isFunction(r.saved)&&r.saved(l)),h},doSave:function(r,a,o,l,u,c){return typeof r=="object"&&(r instanceof ObjectEx?this.doSaveObjectEx(r,a,o,l,u,c):this.isArray(r)?this.doSaveArray(r,a,o,l,u,c):this.isDate(r)?this.doSaveDate(r,a,o,l,u,c):this.doSaveSimpleObject(r,a,o,l,u,c)),this.setStorageNodeExplicitType(a,this.getValueExplicitType(r)),r},doSaveSimpleObject:function(r,a,o,l,u,c){for(var d in r)if(r.hasOwnProperty(d)){var h,p=r[d];this.isComplexType(p)&&(h=this.getValueExplicitType(p)),this.doSaveFieldValue(r,d,p,a,h,o,l,u,c)}},doSaveArray:function(r,a,o,l,u,c){for(var d=0,h=r.length;d<h;++d){var p=r[d],g=this.getNameForArrayItemStorageNode(p);if(this.isComplexType(p)){var f=this.appendArrayItemStorageNode(a,this.propNameToStorageName(g),this.isArray(p));this.setStorageNodeExplicitType(f,this.getValueExplicitType(p)),this.saveObj(p,f,o,l,u,c)}else this.doAppendArrayItemSimpleValue(this.serializeValue(p),typeof p,a)}},doSaveDate:function(r,a,o,l,u,c){var d=r.toUTCString();this.doSaveSimpleValue(r,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(d),DataType.DATE,a,o,l,u)},doSaveObjectEx:function(r,a,o,l,u,c){for(var d=r.getAllPropList(),h=o.propFilter,p=0,g=d.getLength();p<g;++p){var f=d.getPropInfoAt(p);if(!h||h(f,r)){var m=this.getObjCustomPropSaveMethod(r),C=!1;m&&(C=m(r,f,a,o,this,l,u,c)),!C&&f.serializable&&(typeof f.serializable=="function"?f.serializable.apply(r):f.serializable)&&this.doSaveObjectExProp(r,f,a,o,l,u,c)}}},doSaveObjectExProp:function(r,a,o,l,u,c,d){var h=a.name,p=a.dataType,g=r.getPropValue(h);if(l.saveDefaultValues||g!==a.defaultValue){var f;g instanceof ObjectEx?g.getClassName()!=p&&(f=g.getClassName()):this.isComplexType(g)&&(f=this.getValueExplicitType(g))==p&&(f=void 0);var m=r.getPropSerializationName(h,this.getSerializerName())||h;this.doSaveFieldValue(r,m,g,o,f,l,u,c,d)}},doSaveFieldValue:function(r,a,o,l,u,c,d,h,p){if(typeof o!="function")if(this.isComplexType(o)){var g=this.createChildStorageNode(l,this.propNameToStorageName(a),this.isArray(o));u&&this.setStorageNodeExplicitType(g,u),this.saveObj(o,g,c,d,h,p)}else this.doSaveSimpleValue(r,this.propNameToStorageName(a),this.serializeValue(o),this.getValueExplicitType(o),l,c,d,h,p)},doSaveSimpleValue:function(r,a,o,l,u,c,d,h,p){},doAppendArrayItemSimpleValue:function(r,a,o){},load:function(r,a){var o=[],l=this.loadObj(r,a,r,a,o);if(l)for(var u=0,c=o.length;u<c;++u)o[u]&&this.isFunction(o[u].allLoaded)&&o[u].allLoaded(r||l);return l},loadObj:function(r,a,o,l,u){if(!r){var c=this.getStorageNodeExplicitType(a);if(!c)return this.doLoadUntypedNode?this.doLoadUntypedNode(a,o,l):null;r=DataType.createInstance(c)}if(o||(o=r),typeof r=="object"){var d=this.getObjCustomLoadMethod(r);if(d)return d(r,a,this,o,l,u)}var h=this.doLoad(r,a,o,l,u);if(h){var p=r||h;u.push(p),this.isFunction(p.loaded)&&p.loaded(o)}return h},doLoad:function(r,a,o,l,u){if(this.getStorageNodeExplicitType(a),typeof r=="object")if(r instanceof ObjectEx){r.beginUpdate();try{r=this.doLoadObjectEx(r,a,o,l,u)}finally{r.endUpdate()}}else r=this.isArray(r)?this.doLoadArray(r,a,o,l,u):this.isDate(r)?this.doLoadDate(r,a,o,l,u):this.doLoadSimpleObject(r,a,o,l,u);return r},doLoadArray:function(r,a,o,l,u){for(var c=this.getAllArrayItemStorageNodes(a),d=0,h=c.length;d<h;++d){var p=c[d];if(this.isComplexArrayItemStorageNode(p)){var g,f=this.getStorageNodeExplicitType(p)||this.getStorageNodeName(p);f?(g=DataType.createInstance(f),this.loadObj(g,p,o,l,u)):(g={},this.loadObj(g,p,o,l,u)),r.push(g)}else{var m=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(p));r.push(m)}}return r},doLoadDate:function(r,a,o,l,u){var c=this.propNameToStorageName(this.getDefaultDateStorageName()),d=this.doLoadSimpleValue(r,c,DataType.DATE,a,o,l,u);if(d){var h=new Date(d);return r.copyFrom(h),r}},doLoadSimpleObject:function(r,a,o,l,u){for(var c=this.getAllStoredStorageNames(a),d=0,h=c.length;d<h;++d){var p=c[d],g=this.storageNameToPropName(p),f=this.getChildStorageNode(a,p);if(f){var m,C=this.getStorageNodeExplicitType(f);m=C?DataType.createInstance(C):{},this.loadObj(m,f,o,l,u),r[g]=m}else{var _=this.doLoadSimpleValue(r,p,null,a,o,l,u);r[g]=_}}return r},doLoadObjectEx:function(r,a,o,l,u){for(var c=r.getAllPropList(),d=0,h=c.getLength();d<h;++d){var p=c.getPropInfoAt(d);if(p.serializable){var g=this.getObjCustomPropLoadMethod(r),f=!1;g&&(f=g(r,p,a,this,o,l,u)),f||this.doLoadObjectExProp(r,p,a,o,l,u)}}return r},doLoadObjectExProp:function(r,a,o,l,u,c){var d=a.name,h=a.dataType,p=r.getPropSerializationName(d,this.getSerializerName())||d,g=this.doLoadFieldValue(r,p,o,h,l,u,c);g!=null&&r.setPropValue(d,g,!0)},doLoadFieldValue:function(r,a,o,l,u,c,d){var h,p=!1;if(DataType.isComplexType(l)){var g=this.getChildStorageNode(o,this.propNameToStorageName(a));if(g){var f=this.getStorageNodeExplicitType(g);h=f&&f!=l?DataType.createInstance(f):DataType.createInstance(l),this.loadObj(h,g,u,c,d),p=!0}}return!DataType.isSimpleType(l)&&p||(h=this.doLoadSimpleValue(r,this.propNameToStorageName(a),l,o,u,c,d)),h},doLoadSimpleValue:function(r,a,o,l,u,c,d){var h=this.doLoadSimpleStorageValue(a,l,u,c,d);return this.deserializeValue(h,o)},doLoadSimpleStorageValue:function(r,a,o,l,u){},doGetArrayItemSimpleStorageValue:function(r){}}),t=Class.create(e,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(r,a,o){var l=o?[]:{};return r[a]=l,l},appendArrayItemStorageNode:function(r,a,o){var l=o?[]:{};return r.push(l),l},getChildStorageNode:function(r,a){var o=r[a];return this.isSimpleType(o)&&(o=null),o},getAllArrayItemStorageNodes:function(r){return Array.prototype.slice.call(r)},getAllStoredStorageNames:function(r){var a=[];for(var o in r)r.hasOwnProperty(o)&&o!=this.TYPE_TAG_NAME&&a.push(o);return a},isComplexStorageNode:function(r){return this.isComplexType(r)},isComplexArrayItemStorageNode:function(r){return this.isComplexStorageNode(r)},isSimpleStorageNode:function(r){return this.isSimpleType(r)},setStorageNodeExplicitType:function(r,a){this.isArray(r)||(r[this.TYPE_TAG_NAME]=a)},getStorageNodeExplicitType:function(r){var a=r[this.TYPE_TAG_NAME]||null;return!a&&this.isArray(r)?DataType.ARRAY:a},doSaveSimpleValue:function(r,a,o,l,u,c,d,h,p){u[a]=o},doAppendArrayItemSimpleValue:function(r,a,o){return o.push(r)},doLoadSimpleStorageValue:function(r,a,o,l,u){return a[r]},doLoadUntypedNode:function(r,a,o,l){return r},doGetArrayItemSimpleStorageValue:function(r){return r}}),n=Class.create(e,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",UNSUIT_PROPNAME_PREFIX:"__.",getLocalName:function(r){return r.localName||r.baseName||r.nodeName},getElemTextValue:function(r){for(var a="",o=0,l=r.childNodes.length;o<l;++o)r.childNodes[o].nodeType==Node.TEXT_NODE&&(a+=r.childNodes[o].nodeValue);return a},serializeValue:function(r){return DataType.StringUtils.serializeValue(r)},deserializeValue:function(r,a){return DataType.StringUtils.deserializeValue(r,a)},propNameToStorageName:function(r){var a=r.toString().charAt(0).toLowerCase();return a==="_"||a>="a"&&a<="z"?r:this.UNSUIT_PROPNAME_PREFIX+r},storageNameToPropName:function(r){return typeof r!="string"?r:r.indexOf(this.UNSUIT_PROPNAME_PREFIX)===0?r.substr(this.UNSUIT_PROPNAME_PREFIX.length):r},createChildStorageNode:function(r,a,o){var l=r.ownerDocument.createElement(a);return r.appendChild(l),l},appendArrayItemStorageNode:function(r,a,o){return this.createChildStorageNode(r,a,o)},getAllArrayItemStorageNodes:function(r){for(var a=[],o=0,l=r.childNodes.length;o<l;++o){var u=r.childNodes[o];u.nodeType==Node.ELEMENT_NODE&&a.push(u)}return a},getAllStoredStorageNames:function(r){for(var a=[],o=0,l=r.childNodes.length;o<l;++o){var u=r.childNodes[o];u.nodeType==Node.ELEMENT_NODE&&this.getLocalName(u)!=this.TYPE_TAG_NAME&&a.push(this.getLocalName(u))}for(o=0,l=r.attributes.length;o<l;++o){var c=r.attributes[o];this.getLocalName(c)!=this.TYPE_TAG_NAME&&a.push(this.getLocalName(c))}return a},getChildStorageNode:function(r,a){for(var o=null,l=0,u=r.childNodes.length;l<u;++l){var c=r.childNodes[l];c.nodeType==Node.ELEMENT_NODE&&this.getLocalName(c)==a&&(o=c)}return o},isComplexStorageNode:function(r){return r.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(r){return this.isComplexStorageNode(r)&&r.attributes.length&&!this.getElemTextValue(r).trim()},isSimpleStorageNode:function(r){return r.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(r,a){r.setAttribute(this.TYPE_TAG_NAME,a)},getStorageNodeExplicitType:function(r){return r.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(r){var a=r.tagName;return a==this.getDefaultArrayItemStorageName()?null:a},doSaveSimpleObject:function(r,a,o,l,u,c){return this.tryApplySuper("doSaveSimpleObject",[r,a,o,l,u,c])},doSaveSimpleValue:function(r,a,o,l,u,c,d,h,p){u.setAttribute(a,o)},doAppendArrayItemSimpleValue:function(r,a,o){var l=this.appendArrayItemStorageNode(o,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),!1),u=l.ownerDocument.createTextNode(r);l.appendChild(u)},doLoadSimpleStorageValue:function(r,a,o,l,u){return a.getAttribute(r)||void 0},doGetArrayItemSimpleStorageValue:function(r){return this.getElemTextValue(r)}}),i={_serializerClasses:{},_defaultName:null,registerSerializer:function(r,a,o){var l=typeof a=="string"?ClassEx.findClass(a):a;i._serializerClasses[r]=l,o&&(i._defaultName=r),ClassEx.getPrototype(a).SERIALIZER_NAME=r},getSerializer:function(r){var a=r||i._defaultName;if(a){var o=i._serializerClasses[a];return o?new o:null}return null}};i.registerSerializer("json",t,!0),i.registerSerializer("xml",n),Class.ObjSerializerFactory=i,ClassEx.extend(ObjectEx,{getPropSerializationName:function(r,a){return r},saveObj:function(r,a,o){return(a?typeof a=="string"?i.getSerializer(a):a:i.getSerializer()).save(this,r,o)},loadObj:function(r,a){var o,l;o=a?typeof a=="string"?i.getSerializer(a):a:i.getSerializer(),this.beginUpdate();try{l=o.load(this,r)}finally{this.endUpdate()}return l}}),Object.extend(ClassEx,{saveObj:function(r,a,o,l){return(o?typeof o=="string"?i.getSerializer(o):o:i.getSerializer()).save(r,a,l)},loadObj:function(r,a,o){return(o?typeof o=="string"?i.getSerializer(o):o:i.getSerializer()).load(r,a)}}),Object.extend(DataType,{valueToJson:function(r,a){if(DataType.isSimpleValue(r))return JSON.stringify(r);var o=DataType.isArrayValue(r)?[]:{};return ClassEx.saveObj(r,o,"json",a),JSON.stringify(o)},jsonToValue:function(r){var a=JSON.parse(r);return!a||DataType.isSimpleValue(a)?a:ClassEx.loadObj(null,a,"json")}})}();var s=typeof s=="object"?s:{};return(s=Object.extend(s,{LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"1.0.0.23010100",LOADED:!1,_afterLoadSysProcedures:[],_afterLoadUserProcedures:[],PROP_AUTO_TITLE:!0}))._loaded=function(){if(!s.LOADED){s.LOADED=!0;for(var e=s._afterLoadSysProcedures;e.length;)(t=e.shift())&&t();for(e=s._afterLoadUserProcedures;e.length;){var t;(t=e.shift())&&t()}var n=s.$jsRoot&&s.$jsRoot.document;if(n&&n.createEvent&&n.body&&n.body.dispatchEvent){var i=n.createEvent("Event");i.initEvent("kekuleload",!0,!0),n.body.dispatchEvent(i)}}},s._isLoaded=function(){return s.LOADED},s._registerAfterLoadSysProc=function(e){e&&(s.LOADED?e():s._afterLoadSysProcedures.push(e))},s._ready=function(e){e&&(s.LOADED?e():s._afterLoadUserProcedures.push(e))},s._registerAfterLoadProc=s._ready,s.$jsRoot=Ln,typeof window=="object"&&window&&window.document?s.$jsRoot=window:typeof Ci=="object"?s.$jsRoot=Ci:typeof self=="object"&&(s.$jsRoot=self),s.$jsRoot.Kekule=s,typeof window=="object"&&window&&window.document&&(s.window=window),s.$document=Ln&&Ln.document||null,s.scriptSrcInfo||(s.scriptSrcInfo=s.$jsRoot.__$kekule_load_info__),s.scriptSrcInfo&&s.scriptSrcInfo.language&&(s.language=s.scriptSrcInfo.language),!s.scriptSrcInfo&&s.$jsRoot.document&&(s.scriptSrcInfo=function(e){var t,n=/^(.*\/?)kekule\..*\.js(\?.*)?$/;if(e&&e.currentScript&&e.currentScript.src)(t=decodeURIComponent(e.currentScript.src))&&(a=t.match(/^(.*[\/\\])[^\/\\]*\.js(\?.*)?$/));else for(var i=document.getElementsByTagName("script"),r=i.length-1;r>=0;--r){var a,o=i[r];if((t=decodeURIComponent(o.src))&&(a=t.match(n)))break}if(a){var l=a[2];return l&&(l=l.substr(1)),{src:t,path:a[1],paramStr:l,useMinFile:!0}}return null}(s.$jsRoot.document)),s.scriptSrcInfo||(s.scriptSrcInfo={useMinFile:!0}),s.environment={scriptInfo:s.scriptSrcInfo,isNode:!(typeof process!="object"||typeof process.versions!="object"||process.versions.node===void 0),isWeb:!(typeof window!="object"||!window.document),variables:{},getEnvVar:function(e){var t=s.environment.variables[e];return t===void 0&&(t=s.$jsRoot._kekule_environment_&&s.$jsRoot._kekule_environment_[e]),t},setEnvVar:function(e,t){s.environment.variables[e]=t}},s.scriptSrcInfo&&(s.environment.nodeModule=s.scriptSrcInfo.nodeModule,s.environment.nodeRequire=s.scriptSrcInfo.nodeRequire,s.environment.setEnvVar("kekule.path",s.scriptSrcInfo.path),s.environment.setEnvVar("kekule.scriptSrc",s.scriptSrcInfo.src),s.environment.setEnvVar("kekule.useMinJs",s.scriptSrcInfo.useMinFile),s.environment.setEnvVar("kekule.language",s.scriptSrcInfo.language)),s.$jsRoot.__$kekule_scriptfile_utils__&&(s._ScriptFileUtils_=s.$jsRoot.__$kekule_scriptfile_utils__,s.ScriptFileUtils=s._ScriptFileUtils_,s.modules=function(e,t){var n=[];n=typeof e=="string"?[e]:e;var i=s.scriptSrcInfo;return i?(s._ScriptFileUtils_.loadModuleScriptFiles(n,s.isUsingMinJs(),s.getScriptPath(),i,function(r){t&&t(r)}),this):(t&&t(new Error("Kekule script src info not found, can not load modules dynamicly.")),this)},s.loadModules=s.modules),s.scriptSrcInfo&&(s.scriptSrcInfo.getValue=function(e){return s.scriptSrcInfo[e]},s.scriptSrcInfo.setValue=function(e,t){s.scriptSrcInfo[e]=t}),s.getScriptPath=function(){return s.environment.getEnvVar("kekule.path")||s.scriptSrcInfo.path},s.getScriptSrc=function(){return s.environment.getEnvVar("kekule.scriptSrc")||s.scriptSrcInfo.src},s.getDividedMinSubPath=function(){return s.environment.getEnvVar("kekule.dividedMinSubPath")||s.scriptSrcInfo.dividedMinSubPath},s.isUsingMinJs=function(){var e=s.environment.getEnvVar("kekule.useMinJs");return e===void 0&&(e=s.scriptSrcInfo.useMinFile),e},s.getLanguage=function(){return s.environment.getEnvVar("kekule.language")||s.scriptSrcInfo.language},s._getStyleSheetBasePath=function(){return s.isUsingMinJs()?s.getScriptPath():s.getScriptPath()+"widgets/"},s.getStyleSheetUrl=function(){var e=s.environment.getEnvVar("kekule.themeUrl");return e||(e=s._getStyleSheetBasePath()+"themes/default/kekule.css"),e},s.$jsRoot&&s.$jsRoot.addEventListener&&s.$jsRoot.postMessage&&s.$jsRoot.addEventListener("message",function(e){e.data==="kekule-sys-info-query"&&s.$jsRoot.postMessage({msg:"kekule-sys-info-result",libName:s.LIBNAME,version:s.VERSION},"*")},!1),s.Dev={},s.Class=Class,s.ClassEx=ClassEx,s.ObjectEx=ObjectEx,s.DataType=DataType,Ln}zv();var Cu={},Rp;function $v(){return Rp||(Rp=1,function(s){function e(_){var y=_.split(/[-|_]/);return{language:y[0],local:y[1]}}var t=Kekule.$jsRoot||s||{},n=Kekule,i=Kekule.getLanguage()||(t&&t.navigator?navigator.language||navigator.browserLanguage:"en-US");n.language=i;var r=e(i),a=e("en-US"),o=[r.language+"_"+r.local,r.language,a.language+a.local,a.language];Kekule.Localization={},Kekule.LocalizationRes={};var l=Kekule.LocalizationRes;function u(_,y,T){var E=T||l[_];return!E&&y&&(E={},l[_]=E),E}function c(_,y,T){var E=u(y,!1,T);if(E){var b=Object.getCascadeFieldValue(_,E);if(b!==void 0)return b}}function d(_,y,T){for(var E=(y?[y]:[]).concat(o),b=0,v=E.length;b<v;++b){var I=c(_,E[b],T);if(I!==void 0)return I}}function h(_,y,T){var E=d(_,y,T);if(E!==void 0)return E;Kekule.error("Can not find localization resource: "+_)}var p,g=[],f=!!(t||t.window).__kekuleMarkLocalizationModuleInfo__,m={};function C(_,y,T,E){if(T){var b=c(y,_,E);(function(v,I,R,N,L){var U=u(R,N,L);U&&Object.setCascadeFieldValue(v,I,U,N)})(y,b?Object.extendEx(b,T,{cascade:!0}):JSON.parse(JSON.stringify(T)),_,!0,E)}}Kekule.$L=h,Kekule.Localization.getLanguages=function(){var _=[];for(var y in l)_.push(y);return _},Kekule.Localization.getValue=h,Kekule.Localization.findValue=d,Kekule.Localization.getModuleInfos=function(){return m},Kekule.Localization.setCurrModule=function(_){p=_,g.indexOf(_)<0&&g.push(_)},Kekule.Localization.getModuleNames=function(){return g},Kekule.Localization.addResource=function(_,y,T){C(_,y,T),f&&C(_,y,T,function(E,b){E=E||"GLOBAL";var v=Object.getCascadeFieldValue(E,m);return!v&&b&&(v=Object.setCascadeFieldValue(E,{},m,!0)),v}(p,!0))}}(Cu),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("general"),Kekule.Localization.addResource("en","Texts",{UNNAMED:"unnamed"}),Kekule.Localization.addResource("en","ErrorMsg",{MODULE_NOT_LOADED:"Module {0} is not loaded",UNIT_NOT_FOUND:"Unit not found: {0}",STANDARD_UNIT_OF_CATEGORY_NOT_FOUND:"Standard unit of category {0} not found",UNABLE_TO_CONVERT_BETWEEN_UNITS:"Unable to convert between units {0} and {1}",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"Only directly owned property of object can be replaced",EMPTY_DOC:"Document is empty",ELEMENT_NOTSET:"Element not set",EMPTY_RESURI:"Resource URI is empty",CANNOT_LOAD_RES_OF_URI:"Can not load resource of URI: ",LIST_ITEM_CLASS_MISMATCH:"Mismatched item class, can not add to list",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"Invalid chemical element",INVALID_ISOTOPE:"Invalid isotope",COORD_STICK_NOT_ALLOWED_ON_CLASS:"Coordinate sticking is not allowed in this type of object",INVALID_STICK_TARGET_OBJ:"Invalid sticking target",UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ:"Unable to stick to object with a different owner",UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD:"Unable to stick to object without absolute coordinates",STICK_RECURSION_NOT_ALLOWED:"Stick recursion is not allowed",UNABLE_ADD_MISTYPED_NODE:"Unable to link mistyped node to connector",UNABLE_ADD_DIFF_OWNER_OBJ:"Object with different owner can not be linked to connector",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"Mismatched group item class",SORT_FUNC_UNSET:"Sort function is not set",SOURCE_FRAGMENT_NOT_SET:"Source structure fragment not set",UNABLE_ADD_NONMOLECULE_MAP:"Unable to add non-molecule to reactants or products",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"Can not add object other than node or connector to structure object container",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"Can not find registered canonicalization executor",ERROR_LOADING_FILE:"Error loading file: ",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"Fail to load data of format: ",NO_SUITABLE_READER_FOR_FORMAT:"Can not read data of format: ",NO_SUITABLE_READER_FOR_MIMETYPE:"Can not read data of MIME type: ",NO_SUITABLE_READER_FOR_FILEEXT:"Can not read data of file extension: ",NO_SUITABLE_WRITER_FOR_FORMAT:"Can not write data of format: ",NO_SUITABLE_WRITER_FOR_MIMETYPE:"Can not write data of MIME type: ",NO_SUITABLE_WRITER_FOR_FILEEXT:"Can not write data of file extension: ",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"Fail to load file of URL: ",CML_ELEM_READER_NOT_FOUND:"Reader for element <{0}> not found",ATOMID_NOT_EXISTS:"Atom id not exists: ",BONDID_NOT_EXISTS:"Bond id not exists: ",CML_ELEM_WRITER_TYPE_INPROPER:"{0} is not a proper CML element writer for {1}",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"Can not output content to empty element",UNABLE_TO_OUTPUT_AS_CML:"Unable to output object <{0}> to CML data",MDL_CTAB_ATOM_CANNOT_CREATE:"Can not create atom from source MDL format data",MDL_CTAB_BOND_CANNOT_CREATE:"Can not create bond from source MDL format data",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"Object is not a molecule and can not be output to connection table",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"Molecule has no connection table and can not be output to MDL format",NOT_MDL2000_FORMAT_DATA:"Data format wrong: not MDL 2000",NOT_MDL_RXN_DATA:"Not MDL Reaction(RXN) data",MALFORMED_MDL3000_COUNTLINE:"Malformed MDL 3000 count line",MDL3000_ATOMBLOCK_NOT_FOUND:"Atom block not found, malformed MDL 3000 data?",NOT_MDL_FORMAT_DATA:"Data format wrong: not MDL 2000 or 3000",NOT_MDL2000_RXN_DATA:"Not MDL RXN 2000 data",NOT_MDL3000_RXN_DATA:"Not MDL RXN 3000 data",NOT_MDL3000_RXN_COUNTLINE:"Error in reading RXN 3000 count line",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL data can not be output to non text format",MDL_INPUT_DATATYPE_NOT_TEXT:"Non text format is not a legal MDL source data",UNABLE_TO_OUTPUT_AS_MDL:"Unable to output object <{0}> to MDL data",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"Non text or JSON format data is not a legal KCJ source",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"Can not output as non text or JSON data",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"Non text or DOM data is not a legal KCX source",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"Can not output as non text or DOM data",JSON_SERIALIZER_NOT_EXISTS:"Serializer for JSON not exists",XML_SERIALIZER_NOT_EXISTS:"Serializer for XML not exists",JCAMP_DATA_WITHOUT_TITLE_LINE:"Malformed JCAMP format data, not started with TITLE label",JCAMP_OTHER_LABEL_BEFORE_TITLE_LINE:"Malformed JCAMP format data, other labels before the TITLE label",JCAMP_MORE_THAN_ONE_ROOT_BLOCK:"Malformed JCAMP format data, root block not unique",JCAMP_MORE_THAN_TWO_NEST_LEVEL:"Malformed JCAMP format data, block nested level should not exceed 2",JCAMP_ASDF_FORMAT_ERROR_WITH_STR:"Malformed JCAMP ASDF String: {0}",JCAMP_DATA_TABLE_X_VALUE_CHECK_ERROR:"JCAMP data table X value check failed!",JCAMP_DATA_TABLE_Y_VALUE_CHECK_ERROR:"JCAMP data table Y value check failed!",JCAMP_DATA_TABLE_VALUE_FIRST_LAST_NOT_MATCH:"JCAMP data table first/last values not match",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR:"Malformed JCAMP variable list format: {0}",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_UNSUPPORTED:"Unsupported JCAMP variable list format: {0}",JCAMP_NTUPLES_BEGIN_END_NAME_NOT_MATCH:"Ntuples name not match in begin/end labels: {0} and {1}",JCAMP_NTUPLES_PAGE_DECLARATION_FORMAT_ERROR:"Malformed JCAMP ntuples page declaration: {0}",JCAMP_LDR_TARGET_UNIT_NOT_MATCH_WITH_DETAIL:"The unit of property {0} ({1}) can not be converted to the request one ({2}) for JCAMP {3} LDR",FAILED_TO_ASSIGN_SYMBOL_TO_VARIABLE:"Fail to assign a symbol to variable {0}",JCAMP_IMPLICIT_HYDROGEN_COUNT_NOT_MATCH_DETAIL:"Unmatched implicit hydrogen count for atom {0}({1}), expect {2} but found {3}",VISIBLE_DATA_RANGE_IS_EMPTY:"The visible range of data is empty, unable to draw the spectrum",INAVAILABLE_AUTOSCALE_REF_LENGTH:"Can not determine the length for calculation of auto scale",FORMULA_RENDERER_3D_NOT_AVAILABLE:"3D renderer for molecule formula is not available",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"Can not find suitable renderer for object",THREEJS_LIB_NOT_UNAVAILABLE:"Three.js not available, try to include it through the <script> tag or import the module by Kekule.externalResourceManager.register method",THREEJS_DRAWING_NOT_UNAVAILABLE:"Webgl, Canvas or SVG is not supported in this browser, please upgrade to a modern one",CANVAS2D_NOT_UNAVAILABLE:"Canvas is not supported in this browser, please upgrade to a modern one",RAPHAEL_LIB_NOT_UNAVAILABLE:"Raphael.js not available, try to import it through the <script> tag",RAPHAEL_SVG_VML_UNAVAILABLE:"SVG or VML is not supported in this browser, please upgrade to a modern one",CALC_TERMINATED_BY_USER:"Calculation terminated by user",CALC_SERVICE_UNAVAILABLE:'Calculation service "{0}" is unavailable'}),Kekule.Localization.addResource("en","ErrorCheckMsg",{GENERAL_ERROR_WITH_CODE:"Error code: {0}",ATOM_VALENCE_ERROR_WITH_SUGGEST:"Abnormal valence {1} of atom {0}, the possible value is {2}",ATOM_VALENCE_ERROR_WITH_SUGGESTS:"Abnormal valence {1} of atom {0}, the possible values are {2}",BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order ({0}) exceeds the maximum allowed value ({1})",BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order of {0} ({1}) exceeds the maximum allowed value {2}",NODE_DISTANCE_TOO_CLOSE:"Atoms/subgroups are very close to each other",NODE_DISTANCE_TOO_CLOSE_WITH_LABEL:"Atoms/subgroups ({0}) are very close to each other",TITLE_CHANGE_BOND_ORDER_TO:"Change bond order to {0}",DESCRIPTION_CHANGE_BOND_ORDER_TO:"Change bond order from {0} to {1}",TITLE_MERGE_TO:"Merge {0} to {1}",DESCRIPTION_MERGE_TO:"Merge node {0} to {1}"}),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("widget"),Kekule.Localization.addResource("en","WidgetTexts",{CAPTION_OK:"OK",CAPTION_CANCEL:"Cancel",CAPTION_YES:"Yes",CAPTION_NO:"No",CAPTION_BROWSE_COLOR:"Browse colors",HINT_BROWSE_COLOR:"Browse more colors",S_COLOR_UNSET:"(unset)",S_COLOR_DEFAULT:"(default)",S_COLOR_MIXED:"(mixed)",S_COLOR_TRANSPARENT:"(transparent)",S_OBJECT_UNSET:"(none)",S_ITEMS:"item(s)",S_OBJECT:"object",S_VALUE_UNSET:"(Unset)",CAPTION_MENU:"Menu",HINT_MENU:"Open menu",S_INSPECT_NONE:"(none)",S_INSPECT_OBJECTS:"({0} objects)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"Toggle text wrapping",CAPTION_INC_TEXT_SIZE:"Increase text size",CAPTION_DEC_TEXT_SIZE:"Decrease text size",HINT_TOGGLE_TEXTWRAP:"Toggle the state of text wrapping",HINT_INC_TEXT_SIZE:"Increase text size",HINT_DEC_TEXT_SIZE:"Decrease text size",HINT_CHOOSE_FONT_FAMILY:"Choose font family",CAPTION_FIRST_PAGE:"First",CAPTION_LAST_PAGE:"Last",CAPTION_PREV_PAGE:"Prev",CAPTION_NEXT_PAGE:"Next",HINT_FIRST_PAGE:"First page",HINT_LAST_PAGE:"Last page",HINT_PREV_PAGE:"Previous page",HINT_NEXT_PAGE:"Next page",HINT_CURR_PAGE:"Current page",MSG_RETRIEVING_DATA:"Loading data...",CAPTION_DATATABLE_EDIT:"Edit",CAPTION_DATATABLE_DELETE:"Delete",CAPTION_DATATABLE_INSERT:"Insert",HINT_DATATABLE_EDIT:"Edit",HINT_DATATABLE_DELETE:"Delete",HINT_DATATABLE_INSERT:"Insert",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"Add new cell",CAPTION_REMOVE_CELL:"Remove",HINT_REMOVE_CELL:"Remove cell",CAPTION_CONFIG:"Settings...",HINT_CONFIG:"Change settings",TITLE_IMG_FORMAT_PNG:"PNG format image",TITLE_IMG_FORMAT_JPG:"Jpeg format image",TITLE_IMG_FORMAT_GIF:"GIF format image",TITLE_IMG_FORMAT_SVG:"SVG format image"}),Kekule.Localization.addResource("en","ChemWidgetTexts",{CAPTION_CLEAROBJS:"Clear",CAPTION_LOADFILE:"Load...",CAPTION_LOADDATA:"Load...",CAPTION_SAVEFILE:"Save...",CAPTION_ZOOMIN:"Zoom In",CAPTION_ZOOMOUT:"Zoom Out",CAPTION_RESETZOOM:"Reset Zoom",CAPTION_RESETVIEW:"Reset",CAPTION_ROTATE:"Rotate",CAPTION_ROTATELEFT:"Left Rotate",CAPTION_ROTATERIGHT:"Right Rotate",CAPTION_ROTATEX:"X Rotate",CAPTION_ROTATEY:"Y Rotate",CAPTION_ROTATEZ:"Z Rotate",CAPTION_MOL_DISPLAY_TYPE:"Molecule Display Style",CAPTION_SKELETAL:"Skeletal",CAPTION_CONDENSED:"Condensed",CAPTION_WIRE:"Wire Frame",CAPTION_STICKS:"Sticks",CAPTION_BALLSTICK:"Ball Stick",CAPTION_SPACEFILL:"Space Fill",CAPTION_HIDEHYDROGENS:"Show/hide hydrogens",CAPTION_AUTO_COORD_GENERATION:"Auto Coordinates Generation",CAPTION_OPENEDITOR:"Edit...",CAPTION_CHANGE_SPECTRUM_SECTION:"Switch Spectrum/Section",CAPTION_SET_SPECTRUM_DATA_ASSIGNMENT:"Set Spectrum Data Assignments",CAPTION_EDITOR_DONE:"Done",CAPTION_EDITOR_CANCEL:"Cancel",CAPTION_EDIT_OBJ:"Edit",HINT_CLEAROBJS:"Clear objects",HINT_LOADFILE:"Load from file",HINT_LOADDATA:"Load data",HINT_SAVEFILE:"Save to file",HINT_ZOOMIN:"Zoom in",HINT_ZOOMOUT:"Zoom out",HINT_RESETZOOM:"Reset zoom",HINT_RESETVIEW:"Reset zoom and rotation",HINT_ROTATE:"Rotate",HINT_ROTATELEFT:"Rotate in anticlockwise direction",HINT_ROTATERIGHT:"Rotate in clockwise direction",HINT_ROTATEX:"Rotate around X axis",HINT_ROTATEY:"Rotate around Y axis",HINT_ROTATEZ:"Rotate around Z axis",HINT_MOL_DISPLAY_TYPE:"Change molecule display style",HINT_SKELETAL:"Show molecule in skeletal style",HINT_CONDENSED:"Show molecule in condensed style",HINT_WIRE:"Show molecule in wire frame style",HINT_STICKS:"Show molecule in sticks style",HINT_BALLSTICK:"Show molecule in ball-stick style",HINT_SPACEFILL:"Show molecule in space-fill style",HINT_HIDEHYDROGENS:"Show/hide hydrogen atoms in model",HINT_AUTO_COORD_GENERATION:"Generate coordinates for molecule atoms",HINT_OPENEDITOR:"Open an editor to modify displayed object",HINT_CHANGE_SPECTRUM_SECTION:"Switch spectrum or data section",HINT_SET_SPECTRUM_DATA_ASSIGNMENT:"Link chem object to spectrum data as assignment",HINT_EDITOR_DONE:"Save the modification",HINT_EDITOR_CANCEL:"Discard the modification",CAPTION_NEWDOC:"New",CAPTION_UNDO:"Undo",CAPTION_REDO:"Redo",CAPTION_COPY:"Copy",CAPTION_COPY_WHOLE:"Copy",CAPTION_CUT:"Cut",CAPTION_PASTE:"Paste",CAPTION_TOGGLE_SELECT:"Toggle select",CAPTION_SELECT_ALL:"Select all",CAPTION_CLONE_SELECTION:"Clone selection",CAPTION_TOGGLE_OBJ_INSPECTOR:"Object inspector",CAPTION_TOGGLE_ISSUE_INSPECTOR:"Issue inspector",CAPTION_TOGGLE_SHOW_ISSUE_MARKERS:"Toggle issue markers",CAPTION_ERASE_SELECTION:"Erase selection",CAPTION_RECHECK_ISSUES:"Recheck issues",CAPTION_MANIPULATE:"Select",CAPTION_MANIPULATE_MARQUEE:"Marquee select",CAPTION_MANIPULATE_LASSO:"Lasso select",CAPTION_MANIPULATE_BRUSH:"Brush select",CAPTION_MANIPULATE_ANCESTOR:"Select molecule",CAPTION_CLIENT_DRAGSCROLL:"Scroll",CAPTION_ERASE:"Erase",CAPTION_TRACK_INPUT:"Track",CAPTION_MOL_BOND:"Bond",CAPTION_MOL_BOND_SINGLE:"Single bond",CAPTION_MOL_BOND_DOUBLE:"Double bond",CAPTION_MOL_BOND_TRIPLE:"Triple bond",CAPTION_MOL_BOND_QUAD:"Quad bond",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"Aromatic bond",CAPTION_MOL_BOND_WEDGEUP:"Wedge up bond",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",CAPTION_MOL_BOND_WEDGEDOWN:"Wedge down bond",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",CAPTION_MOL_BOND_CLOSER:"Outer bond",CAPTION_MOL_BOND_WAVY:"Wavy bond",CAPTION_MOL_BOND_DOUBLE_EITHER:"Double Either bond",CAPTION_MOL_BOND_IONIC:"Ionic bond",CAPTION_MOL_BOND_COORDINATE:"Coordinate bond",CAPTION_MOL_BOND_METALLIC:"Metallic bond",CAPTION_MOL_BOND_HYDROGEN:"Hydrogen bond",CAPTION_MOL_BOND_KEKULIZE:"Kekulize",CAPTION_MOL_BOND_HUCKLIZE:"Hucklize",CAPTION_MOL_ATOM:"Atom",CAPTION_MOL_FORMULA:"Formula",CAPTION_MOL_ATOM_AND_FORMULA:"Atom & formula",CAPTION_MOL_CHARGE:"Charge",CAPTION_MOL_CHARGE_CLEAR:"Charge clear",CAPTION_MOL_CHARGE_POSITIVE:"Positive charge",CAPTION_MOL_CHARGE_NEGATIVE:"Negative charge",CAPTION_MOL_CHARGE_SINGLET:"Singlet radical",CAPTION_MOL_CHARGE_DOUBLET:"Monoradical",CAPTION_MOL_CHARGE_TRIPLET:"Triplet radical",CAPTION_MOL_ELECTRON_LONEPAIR:"Lone pair",CAPTION_TEXT_BLOCK:"Text block",CAPTION_IMAGE_BLOCK:"Image block",CAPTION_TEXT_IMAGE:"Text & image",CAPTION_MOL_FLEXCHAIN:"Flex chain",CAPTION_MOL_FLEXRING:"Flex ring",CAPTION_REPOSITORY_RING:"Rings",CAPTION_REPOSITORY_RING_3:"Cyclopropane",CAPTION_REPOSITORY_RING_4:"Cyclobutane",CAPTION_REPOSITORY_RING_5:"Cyclopentane",CAPTION_REPOSITORY_RING_6:"Cyclohexane",CAPTION_REPOSITORY_RING_7:"Cycloheptane",CAPTION_REPOSITORY_RING_8:"Cyclooctane",CAPTION_REPOSITORY_RING_AR_6:"Benzene",CAPTION_REPOSITORY_RING_AR_5:"Cyclopentadiene",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",CAPTION_REPOSITORY_METHANE:"Methane",CAPTION_REPOSITORY_FISCHER1:"Fischer projection 1",CAPTION_REPOSITORY_FISCHER2:"Fischer projection 2",CAPTION_REPOSITORY_FISCHER3:"Fischer projection 3",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",CAPTION_REPOSITORY_SUBBOND_MARK:"Substituent bond",CAPTION_REPOSITORY_ARROWLINE:"Arrows & symbols",CAPTION_REPOSITORY_GLYPH:"Glyphs",CAPTION_REPOSITORY_GLYPH_LINE:"Line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",CAPTION_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_DOUBLE:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_SINGLE:"Single electron pushing arrow",CAPTION_REPOSITORY_HEAT_SYMBOL:"Heat symbol",CAPTION_REPOSITORY_ADD_SYMBOL:"Add symbol",CAPTION_TEXT_FORMAT:"Text format",CAPTION_PICK_COLOR:"Color",CAPTION_FONTNAME:"Font name",CAPTION_FONTSIZE:"Font size",CAPTION_TEXT_DIRECTION:"Text direction",CAPTION_TEXT_DIRECTION_DEFAULT:"Default",CAPTION_TEXT_DIRECTION_LTR:"Left to right",CAPTION_TEXT_DIRECTION_RTL:"Right to left",CAPTION_TEXT_DIRECTION_TTB:"Top to bottom",CAPTION_TEXT_DIRECTION_BTT:"Bottom to top",CAPTION_TEXT_HORIZONTAL_ALIGN:"Text horizontal alignment",CAPTION_TEXT_VERTICAL_ALIGN:"Text vertical alignment",CAPTION_TEXT_ALIGN_DEFAULT:"Default",CAPTION_TEXT_ALIGN_LEADING:"Leading",CAPTION_TEXT_ALIGN_TRAILING:"Trailing",CAPTION_TEXT_ALIGN_CENTER:"Center",CAPTION_TEXT_ALIGN_LEFT:"Left",CAPTION_TEXT_ALIGN_RIGHT:"Right",CAPTION_TEXT_ALIGN_TOP:"Top",CAPTION_TEXT_ALIGN_BOTTOM:"Bottom",CAPTION_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT:"Default",CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN:"Show label",CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN:"Hide label",CAPTION_NODE_LABEL_DISPLAY_MODE_SMART:"Smart",CAPTION_ATOM_MODIFIER:"Atom",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"Bond",CAPTION_CHARGE_MODIFIER:"Charge",CAPTION_GLYPH_PATH_MODIFIER:"Path",CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Reaction arrow & segment",CAPTION_ARC_PATH_MODIFIER:"Arc",CAPTION_MULTI_ARC_PATH_MODIFIER:"Multi-Arc",CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER:"Electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Bond forming arrow",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"Create new document",HINT_UNDO:"Undo",HINT_REDO:"Redo",HINT_COPY_WHOLE:"Copy objects to internal clipboard",HINT_COPY:"Copy selection to internal clipboard",HINT_CUT:"Cut selection to internal clipboard",HINT_PASTE:"Paste from internal clipboard",HINT_CLONE_SELECTION:"Clone selection",HINT_SELECT_ALL:"Select all",HINT_TOGGLE_SELECT:"Toggle select",HINT_TOGGLE_OBJ_INSPECTOR:"Show or hide object inspector panel",HINT_TOGGLE_ISSUE_INSPECTOR:"Show or hide error inspector panel",HINT_TOGGLE_SHOW_ISSUE_MARKERS:"Show or hide issue markers",HINT_ERASE_SELECTION:"Delete all selected objects",HINT_RECHECK_ISSUES:"Recheck objects in editor for issues",HINT_MANIPULATE:"Select tool",HINT_MANIPULATE_MARQUEE:"Marquee select",HINT_MANIPULATE_LASSO:"Lasso select",HINT_MANIPULATE_BRUSH:"Brush select",HINT_MANIPULATE_ANCESTOR:"Select molecule",HINT_CLIENT_DRAGSCROLL:"Scroll",HINT_ERASE:"Erase tool",HINT_TRACK_INPUT:"Track tool",HINT_MOL_BOND:"Bond tool",HINT_MOL_BOND_SINGLE:"Single bond",HINT_MOL_BOND_DOUBLE:"Double bond",HINT_MOL_BOND_TRIPLE:"Triple bond",HINT_MOL_BOND_QUAD:"Quad bond",HINT_MOL_BOND_EXPLICIT_AROMATIC:"Explicit aromatic bond",HINT_MOL_BOND_WEDGEUP:"Wedge up bond",HINT_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",HINT_MOL_BOND_WEDGEDOWN:"Wedge down bond",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",HINT_MOL_BOND_CLOSER:"Outer bond",HINT_MOL_BOND_WAVY:"Wavy bond",HINT_MOL_BOND_DOUBLE_EITHER:"Double either bond",HINT_MOL_BOND_IONIC:"Ionic bond",HINT_MOL_BOND_COORDINATE:"Coordinate bond",HINT_MOL_BOND_METALLIC:"Metallic bond",HINT_MOL_BOND_HYDROGEN:"Hydrogen bond",HINT_MOL_BOND_KEKULIZE:"Kekulize, convert explicit aromatic bonds to compartmental single and double ones",HINT_MOL_BOND_HUCKLIZE:"Hucklize, mark bonds on aromatic rings as explicit aromatic ones",HINT_MOL_ATOM:"Atom tool",HINT_MOL_FORMULA:"Formula tool",HINT_MOL_ATOM_AND_FORMULA:"Atom and formula tool",HINT_MOL_CHARGE:"Charge tool",HINT_MOL_CHARGE_CLEAR:"Clear charge and radical",HINT_MOL_CHARGE_POSITIVE:"Positive charge",HINT_MOL_CHARGE_NEGATIVE:"Negative charge",HINT_MOL_CHARGE_SINGLET:"Singlet radical",HINT_MOL_CHARGE_DOUBLET:"Monoradical",HINT_MOL_CHARGE_TRIPLET:"Triplet radical",HINT_MOL_ELECTRON_LONEPAIR:"Lone pair electrons",HINT_TEXT_BLOCK:"Text block tool",HINT_IMAGE_BLOCK:"Image block tool",HINT_TEXT_IMAGE:"Text and image tool",HINT_MOL_FLEXCHAIN:"Flex carbon chain",HINT_MOL_FLEXRING:"Flex carbon ring",HINT_REPOSITORY_RING:"Ring structures tool",HINT_REPOSITORY_RING_3:"Cyclopropane",HINT_REPOSITORY_RING_4:"Cyclobutane",HINT_REPOSITORY_RING_5:"Cyclopentane",HINT_REPOSITORY_RING_6:"Cyclohexane",HINT_REPOSITORY_RING_7:"Cycloheptane",HINT_REPOSITORY_RING_8:"Cyclooctane",HINT_REPOSITORY_RING_AR_6:"Benzene",HINT_REPOSITORY_RING_AR_5:"Cyclopentadiene",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",HINT_REPOSITORY_SUBBOND_MARK:"Substituent bond",HINT_REPOSITORY_METHANE:"Methane",HINT_REPOSITORY_FISCHER1:"Fischer projection with one chiral center",HINT_REPOSITORY_FISCHER2:"Fischer projection with two chiral centers",HINT_REPOSITORY_FISCHER3:"Fischer projection with three chiral centers",HINT_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",HINT_REPOSITORY_ARROWLINE:"Arrows and symbols tool",HINT_REPOSITORY_GLYPH:"Glyphs",HINT_REPOSITORY_GLYPH_LINE:"Line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",HINT_REPOSITORY_HEAT_SYMBOL:"Heat symbol",HINT_REPOSITORY_ADD_SYMBOL:"Add symbol",HINT_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",HINT_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",HINT_TEXT_FORMAT:"Set text format",HINT_FONTNAME:"Set font name",HINT_FONTSIZE:"Set font size",HINT_PICK_COLOR:"Select color",HINT_TEXT_DIRECTION:"Set text direction",HINT_TEXT_HORIZONTAL_ALIGN:"Set text horizontal alignment",HINT_TEXT_VERTICAL_ALIGN:"Set text vertical alignment",HINT_CHARGE_NONE:"No charge",HINT_ATOM_MODIFIER:"Set atom",HINT_BOND_MODIFIER:"Set bond",HINT_CHARGE_MODIFIER:"Set charge",HINT_GLYPH_PATH_MODIFIER:"Set path properties",HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Set reaction arrow and segment properties",HINT_ARC_PATH_MODIFIER:"Set arc properties",HINT_MULTI_ARC_PATH_MODIFIER:"Set multi-arc properties",HINT_ELECTRON_PUSHING_ARROW_MODIFIER:"Set electron pushing arrow properties",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Set bond forming arrow properties",HINT_USE_ATOM_CUSTOM_COLOR:"(use atom custom color)",CAPTION_LOADDATA_DIALOG:"Load data",CAPTION_LOADDATA_DIALOG_APPENDMODE:"Append to current",CAPTION_SAVEDATA_DIALOG:"Save data",CAPTION_DATA_FORMAT:"Data format:",CAPTION_DATA_SRC:"Input or paste data below:",CAPTION_LOADDATA_FROM_FILE:"Load from file",CAPTION_CHOOSEFILEFORMAT:"Choose file format",CAPTION_SELECT_FORMAT:"Select format:",CAPTION_PREVIEW_FILE_CONTENT:"Preview: ",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"more...",CAPTION_RGROUP:"Sub group",CAPTION_VARIABLE_ATOM:"Variable Atom (list)",CAPTION_VARIABLE_NOT_ATOM:"Variable Atom (not list)",CAPTION_PSEUDOATOM:"Pseudoatom",CAPTION_DUMMY_ATOM:"Dummy Atom",CAPTION_HETERO_ATOM:"Hetero Atom",CAPTION_ANY_ATOM:"Any Atom",CAPTION_ATOM:"Atom",CAPTION_SUBGROUP:"Subgroup",CAPTION_PERIODIC_TABLE_DIALOG:"Periodic table",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"Select element",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"Select elements",CAPTION_TEXTBLOCK_INIT:"Enter text here",CAPTION_WIDTH:"Width",CAPTION_LENGTH:"Length",CAPTION_PATH_INDEX:"Path {0}",HINT_PATH_INDEX:"Path {0}",CAPTION_REACTION_ARROW_UNSET:"(Unset)",CAPTION_REACTION_ARROW_CUSTOM:"Custom",CAPTION_REACTION_ARROW_NORMAL:"Normal",CAPTION_REACTION_ARROW_RESONANCE:"Resonance",CAPTION_REACTION_ARROW_REVERSIBLE:"Reversible",CAPTION_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis",HINT_REACTION_ARROW_UNSET:"Unset",HINT_REACTION_ARROW_CUSTOM:"Custom",HINT_REACTION_ARROW_NORMAL:"Normal arrow",HINT_REACTION_ARROW_RESONANCE:"Resonance arrow",HINT_REACTION_ARROW_REVERSIBLE:"Reversible arrow",HINT_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis arrow",CAPTION_LINE_COUNT:"Line count",CAPTION_LINE_GAP:"Line gap",CAPTION_LINE:"Line",CAPTION_STARTING_ARROW:"Starting arrow",CAPTION_ENDING_ARROW:"Ending arrow",CAPTION_REACTION_ARROW_TYPE:"Reaction arrow type",CAPTION_ELECTRON_PUSHING_ARROW_TYPE:"Arrow type",CAPTION_OPPOSITE_ARROW_SIDES:"Opposite arrow sides",CAPTION_SAME_ARROW_SIDES:"Same arrow sides",CAPTION_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_1_ABBR:"Single",HINT_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2_ABBR:"Double",HINT_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",LEGEND_CAPTION:"Legend",LEGEND_ELEM_SYMBOL:"Symbol",LEGEND_ELEM_NAME:"name",LEGEND_ATOMIC_NUM:"atomic number",LEGEND_ATOMIC_WEIGHT:"atomic weight",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"Autosize",CAPTION_AUTOFIT:"Autofit",CAPTION_SHOWSIZEINFO:"Show size info",CAPTION_LABEL_SIZE:"Size: ",CAPTION_BACKGROUND_COLOR:"Background color: ",CAPTION_WIDTH_HEIGHT:"width: {0}, height: {1}",PLACEHOLDER_WIDTH:"width",PLACEHOLDER_HEIGHT:"height",HINT_AUTOSIZE:"Whether graph size is determined by object automatically",HINT_AUTOFIT:"Whether object is zoomed to fullfill the whole graph",CAPTION_CHEMOBJINSERTER_GENERATING_3D_STRUCTURE:"Generating molecule 3D structure...",CAPTION_SPECTRUM_WITH_INDEX:"Spectrum {0}",CAPTION_SPECTRUM_DATASECTION_WITH_INDEX:"Data section {0}",CAPTION_INTERACTIONS:"Interactions: ",CAPTION_ENABLE_HOTTRACK:"Enable hot track",CAPTION_ENABLE_SELECT:"Enable select",CAPTION_ENABLE_MULTISELECT:"Enable multi-select",CAPTION_ASSOC_VIEWER_SIZE:"Correlated molecule viewer size: ",CAPTION_ASSOC_VIEWER_VISUAL_MODE:"Correlated molecule display mode: ",CAPTION_ASSOC_VIEWER_VISUAL_MODE_AUTO:"Auto",CAPTION_ASSOC_VIEWER_VISUAL_MODE_VISIBLE:"Always displayed",CAPTION_ASSOC_VIEWER_VISUAL_MODE_INVISIBLE:"Always hidden",S_VALUE_DEFAULT:"(Default)"}),Kekule.Localization.addResource("en","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"Widget class not found",WIDGET_CAN_NOT_BIND_TO_ELEM:"Widget {0} can not be binded to element <{1}>",LOAD_CHEMDATA_FAILED:"Failed to load data",FILE_API_NOT_SUPPORTED:"File operations are not supported by your current web browser. Please update it.",DRAW_BRIDGE_NOT_SUPPORTED:"It seems that your web browser is not modern enough to support the drawing function. Please update it.",COMMAND_NOT_REVERSIBLE:"Command can not be undone",PAGE_INDEX_OUTOF_RANGE:"Page index out of range",FETCH_DATA_TIMEOUT:"Time out to fetch data",RENDER_TYPE_CHANGE_NOT_ALLOWED:"It is not allowed to change render type",CAN_NOT_CREATE_EDITOR:"Creating editor failed",CAN_NOT_LOAD_OBJ_OTHER_THAN_SPECTRUM:"Can not load non-spectrum object",FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_SPECTRUM:"Fail to export data URI for spectrum image",FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_ASSOC:"Fail to export data URI for associated image",CAN_NOT_SET_COORD_OF_CLASS:"Can not set coordinate of instance of {0}.",CAN_NOT_SET_DIMENSION_OF_CLASS:"Can not set dimension of instance of {0}.",CAN_NOT_MERGE_CONNECTORS:"Specified connectors can not be merged.",NOT_A_VALID_ATOM:"Not a valid atom",INVALID_ATOM_SYMBOL:"Invalid atom symbol",INVALID_OR_EMPTY_IMAGE:"Image is empty or invalidate"}),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("objDefines"),Kekule.OBJDEF_TEXTS={},Kekule.Localization.addResource("en","OBJDEF_TEXTS",{TITLE_PREFIX:"TITLE_",DESCRIPTION_PREFIX:"DES_",DES_ID:"Unique ID for object.",Render:{GeneralConfigs:{TITLE_drawOpacity:"Opacity",DES_drawOpacity:"Opacity (between 0-1) to draw objects"},Render2DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_displayLabelConfigs:"Display label settings",DES_displayLabelConfigs:"Settings of displayed label in molecule/chem object",TITLE_textFontConfigs:"Text and font settings",DES_textFontConfigs:"Settings about text and font of display",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule/chem object",TITLE_colorConfigs:"Color settings",DES_colorConfigs:"Color settings to display molecule/chem object",TITLE_spectrumDisplayConfigs:"Spectrum display settings",DES_spectrumDisplayConfigs:"Settings for displaying spectrum object"},MoleculeDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display mode",DES_defMoleculeDisplayType:"Default display type of molecule: in skeletal or in condensed mode",TITLE_defNodeDisplayMode:"Default atom display mode",DES_defNodeDisplayMode:"Default mode to display atom in molecule",TITLE_defHydrogenDisplayLevel:"Default hydrogen display level",DES_defHydrogenDisplayLevel:"How to display explicit or implicit hydrogens of atom",TITLE_defChargeMarkType:"Default charge mark type",DES_defChargeMarkType:null,TITLE_partialChargeDecimalsLength:"Decimal length of partial charge",DES_partialChargeDecimalsLength:"If an atom has a partical charge (e.g., +1.5), how many digits after decimal point should be displayed",TITLE_distinguishSingletAndTripletRadical:"Distinguish singlet/triplet radical",DES_distinguishSingletAndTripletRadical:"Whether use different mark to distinguish singlet(..) and triplet(^^) radical",TITLE_bondLineCap:"Bond line cap style",TITLE_bondLineJoin:"Bond line join style",TITLE_glyphLineCap:"Glyph line cap style",TITLE_glyphLineJoin:"Glyph line join style"},DisplayLabelConfigs:{TITLE_enableIsotopeAlias:"Enable isotope alias",DES_enableIsotopeAlias:"Whether isotope alias (e.g. D for 2H) is used to display atom label.",TITLE_unsetElement:"Unset element",DES_unsetElement:"Label for unset or unknown element",TITLE_dummyAtom:"Dummy atom",DES_dummyAtom:"Label for dummy atom",TITLE_heteroAtom:"Hetero atom",DES_heteroAtom:"Label for general hetero atom",TITLE_anyAtom:"Any atom",DES_anyAtom:"Label for atom wildcard",TITLE_variableAtom:"Variable atom",DES_variableAtom:"Label for variable atom or atom list",TITLE_rgroup:"RGroup",DES_rgroup:"Label for RGroup",TITLE_isoListLeadingBracket:"Atom list leading bracket",TITLE_isoListTailingBracket:"Atom list tailing bracket",TITLE_isoListDelimiter:"Atom delimiter in list",TITLE_isoListDisallowPrefix:"Prefix of not-atom list"},TextFontConfigs:{TITLE_labelFontFamily:"Label font",DES_labelFontFamily:"Font to draw general label",TITLE_atomFontFamily:"Atom font",DES_atomFontFamily:"Font to draw atom label",TITLE_supFontSizeRatio:"Superscript font size ratio",DES_supFontSizeRatio:"Ratio of Superscript text size to normal text size",TITLE_subFontSizeRatio:"Subscript font size ratio",DES_subFontSizeRatio:"Ratio of Subscript text size to normal text size",TITLE_superscriptOverhang:"Superscript text overhang",DES_superscriptOverhang:null,TITLE_subscriptOversink:"Subscript text oversink",DES_subscriptOversink:null,TITLE_textCharDirection:"Text direction",DES_textCharDirection:"Default text direction",TITLE_textHorizontalAlign:"Horizontal text alignment",DES_textHorizontalAlign:"Default horizontal text alignment of label",TITLE_textVerticalAlign:"Vertical text alignment",DES_textVerticalAlign:"Default vertical text alignment of label"},LengthConfigs:{TITLE_labelFontSize:"Label text size",DES_labelFontSize:"Size of general label text",TITLE_atomFontSize:"Atom text size",DES_atomFontSize:"Size of atom label text",TITLE_chemMarkerFontSize:"Chem marker text size",DES_chemMarkerFontSize:"Size of text in chem marker",TITLE_chemMarkerMargin:"Chem marker margin",DES_chemMarkerMargin:"Margin of chem marker to main object",TITLE_allenCenterAtomRadius:"Allen center radius",DES_allenCenterAtomRadius:"Radius to draw dot on center carbon atom in allen",TITLE_chargeMarkFontSize:"Charge mark size",DES_chargeMarkFontSize:"Font size of charge mark",TITLE_chargeMarkMargin:"Charge mark margin",DES_chargeMarkMargin:"Margin between charge mark and atom",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default length of a chemical bond",TITLE_bondLineWidth:"Bond line width",DES_bondLineWidth:"Line width to draw a chemical bond",TITLE_hashSpacing:"Hash spacing",DES_hashSpacing:"Spacing between small lines in hash bond",TITLE_multipleBondSpacingRatio:"Multiple bond spacing ratio",DES_multipleBondSpacingRatio:"Ratio of spacing between two lines in double or triple bond to bond length.",TITLE_multipleBondMaxAbsSpacing:"Max multiple bond spacing",DES_multipleBondMaxAbsSpacing:"Maximum spacing between multiple bond",TITLE_bondArrowLength:"Bond arrow length",DES_bondArrowLength:"The length of end triangle in arrow bond",TITLE_bondArrowWidth:"Bond arrow width",DES_bondArrowWidth:"The width of end triangle in arrow bond",TITLE_bondWedgeWidth:"Bond wedge max width",DES_bondWedgeWidth:"The width of ending point in wedge bond",TITLE_bondWedgeHashMinWidth:"Bond wedge min width",DES_bondWedgeHashMinWidth:"The width of starting point in wedge bond",TITLE_bondWavyRadius:"Bond wavy radius",DES_bondWavyRadius:"Radius to draw arc of wavy bond",TITLE_glyphStrokeWidth:"Glyph stroke width",DES_glyphStrokeWidth:"The default width of glyph strokes",TITLE_autofitContextPadding:"Autofit context padding",DES_autofitContextPadding:"Padding of autofit widget edge and drawn object",TITLE_glyphStickOffsetRelLength:"Glyph stick offset relative length",DES_glyphStickOffsetRelLength:"Glyph stick offset relative length",TITLE_defScaleRefLength:"Default scale reference length",DES_defScaleRefLength:"Length for calculating the auto-scale"},ColorConfigs:{TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element",TITLE_labelColor:"Label color",DES_labelColor:"Default color of general label",TITLE_atomColor:"Atom color",DES_atomColor:"Default color of atom label",TITLE_bondColor:"Bond color",DES_bondColor:"Default color of bond",TITLE_glyphStrokeColor:"Glyph stroke color",DES_glyphStrokeColor:"Default stroke color of glyph",TITLE_glyphFillColor:"Glyph fill color",DES_glyphFillColor:"Default fill color of glyph"},spectrumDisplayConfigs:{},Render3DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_environmentConfigs:"3D environment settings",DES_environmentConfigs:"Settings of 3D environment",TITLE_modelConfigs:"3D model settings",DES_modelConfigs:"Settings to render a 3D molecule model",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule"},Render3DEnvironmentConfigs:{TITLE_graphicQuality:"Graphic quality",DES_graphicQuality:"Quality of 3D graphic"},Molecule3DDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display type",DES_defMoleculeDisplayType:"Draw molecule in wire, stick, ball stick or space fill mode",TITLE_defBondSpliceMode:"Bond splice mode",DES_defBondSpliceMode:"How to draw a splice mode between two atoms with different color",TITLE_defDisplayMultipleBond:"Display multiple bond",DES_defDisplayMultipleBond:"Whether draw multiple bond lines for double or triple bond",TITLE_defBondColor:"Default bond color",DES_defBondColor:"Default bond color",TITLE_defAtomColor:"Default atom color",DES_defAtomColor:"Default atom color",TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element"},Model3DConfigs:{TITLE_hideHydrogens:"Hide hydrogens",DES_hideHydrogens:"Whether hide all hydrogen atoms in 3D model",TITLE_useVdWRadius:"Use von dar Waals radius",DES_useVdWRadius:"Whether use atom's von dar Waals radius to draw 3D model",TITLE_multiConnectorRadiusRatio:"Multi-bond radius ratio",DES_multiConnectorRadiusRatio:"If use multi-cylinder for multibond, this value is the radius ratio between multi and single bond",TITLE_multiConnectorMarginRatio:"Multi-bond margin ratio",DES_multiConnectorMarginRatio:"If multi-cylinder is used for multibond, ratio of margin between cylinders and radius of cylinder"},Length3DConfigs:{TITLE_fixedNodeRadius:"Fixed atom radius",DES_fixedNodeRadius:"If vdW radius of atom is not used, this value will be used for all atom's radius",TITLE_connectorRadius:"Bond radius",DES_connectorRadius:"Bond will be draw based on this radius in stick or ball_stick mode",TITLE_connectorLineWidth:"Bond line width",DES_connectorLineWidth:"Bond will be draw on this width in wire mode"}},Widget:{BaseWidget:{TITLE_settingFacade:"General settings",DES_settingFacade:"General settings"}},ChemWidget:{ChemObjDisplayer:{TITLE_enableLoadNewFile:"Enable load data",DES_enableLoadNewFile:"Whether loading new data is enabled"},ChemObjDisplayerConfigs:{TITLE_ioConfigs:"I/O settings",DES_ioConfigs:"Settings of input/output",TITLE_environment2DConfigs:"2D environment settings",DES_environment2DConfigs:"Settings of 2D drawing environment",TITLE_environment3DConfigs:"3D environment settings",DES_environment3DConfigs:"Settings of 3D drawing environment",TITLE_spectrumViewConfigs:"Spectrum view settings",DES_spectrumViewConfigs:"Display and interaction settings of spectrum sub view"},ChemObjDisplayerIOConfigs:{TITLE_canonicalizeBeforeSave:"Canonicalize before save",DES_canonicalizeBeforeSave:"Whether canonicalize molecule before saving it",TITLE_autoGenerateCoordsAfterLoad:"Auto generate coordinates after loading molecule",DES_autoGenerateCoordsAfterLoad:"Whether coordinates of atoms are automatically generated when loading a molecule without explicit coordinate information"},ChemObjDisplayerEnvironmentConfigs:{TITLE_antialias:"Antialias",DES_antialias:"Whether enable extra antialias strategy additional to the default one of browser",TITLE_antialiasBlurRatio:"Antialias blur ratio",DES_antialiasBlurRatio:"Antialias blur ratio",TITLE_overSamplingRatio:"Over sampling ratio",DES_overSamplingRatio:"Over sampling ratio of the drawing context"},ChemObjDisplayerSpectrumViewConfigs:{},Viewer:{TITLE_enableDirectInteraction:"Enable direct interaction",DES_enableDirectInteraction:"Whether interaction with chem object in viewer is enabled",TITLE_enableTouchInteraction:"Enable touch interaction",DES_enableTouchInteraction:"Whether touch interaction is enabled",TITLE_enableToolbar:"Enable toolbar",DES_enableToolbar:"Whether toolbar of viewer is displayed",TITLE_toolbarPos:"Toolbar Position",DES_toolbarPos:"Position of toolbar in viewer",TITLE_toolbarMarginHorizontal:"Toolbar horizontal margin",DES_toolbarMarginHorizontal:"Horizontal margin of toolbar to viewer edge",TITLE_toolbarMarginVertical:"Toolbar vertical margin",DES_toolbarMarginVertical:"Vertical margin of toolbar to viewer edge",TITLE_enableEdit:"Enable editing",DES_enableEdit:"Whether edit chem object in viewer is enabled",TITLE_modalEdit:"Modal editing",DES_modalEdit:"Using modal dialog or popup dialog to edit chem object"},ViewerConfigs:{TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ViewerHotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"}},Editor:{BaseEditorConfigs:{TITLE_uiMarkerConfigs:"UI marker settings",DES_uiMarkerConfigs:"Settings of interaction marker",TITLE_interactionConfigs:"Interaction settings",DES_interactionConfigs:"Settings about interaction of editor",TITLE_structureConfigs:"Structure settings",DES_structureConfigs:"Settings about creating molecule structure",TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ChemSpaceEditorConfigs:{TITLE_chemSpaceConfigs:"Chem space settings",DES_chemSpaceConfigs:"Settings about chem space/chem document",TITLE_styleSetterConfigs:"Style setter settings",DES_styleSetterConfigs:"Settings of style toolbar of editor"},InteractionConfigs:{TITLE_enableTrackOnNearest:"Enale track on nearest",DES_enableTrackOnNearest:"If setting to true, hot track or selection will focus on nearest object to current position, otherwise, the topmost object around will be focused.",TITLE_enableHotTrack:"Enable hot track",DES_enableHotTrack:"Whether highlighting objects under mouse position",TITLE_scrollToObjAfterLoading:"Scroll to object after loading",DES_scrollToObjAfterLoading:"Whether scroll to the newly loaded object after opening data",TITLE_autoExpandClientSizeAfterLoading:"Auto expand client size after loading",DES_autoExpandClientSizeAfterLoading:"Whether expand the client size automatically after loading a large object out of boundary",TITLE_autoExpandClientSizeAfterManipulation:"Auto expand client size after manipulation",DES_autoExpandClientSizeAfterManipulation:"Whether expand the client size automatically when moving a object out of the boundary of editor",TITLE_autoSelectNewlyInsertedObjects:"Auto select new inserted objects",DES_autoSelectNewlyInsertedObjects:"Whether select objects newly inserted or modified in editor automatically",TITLE_autoSelectNewlyInsertedObjectsOnTouch:"Auto select new inserted objects in touch device",DES_autoSelectNewlyInsertedObjectsOnTouch:"Whether select objects newly inserted or modified in editor automatically in touch device",TITLE_objBoundTrackMinInflation:"Object bound minimal inflation (default)",DES_objBoundTrackMinInflation:"The default minimal inflation of the bound of object to make it easier to select",TITLE_objBoundTrackMinInflationMouse:"Object bound minimal inflation (mouse)",DES_objBoundTrackMinInflationMouse:"The minimal inflation of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackMinInflationTouch:"Object bound minimal inflation (touch)",DES_objBoundTrackMinInflationTouch:"The minimal inflation of the bound of object to make it easier to select when touching on screen",TITLE_objBoundTrackMinInflationPen:"Object bound minimal inflation (pen)",DES_objBoundTrackMinInflationPen:"The minimal inflation of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatio:"Object bound inflation ratio (default)",DES_objBoundTrackInflationRatio:"The default inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select",TITLE_objBoundTrackInflationRatioMouse:"Object bound inflation ratio (mouse)",DES_objBoundTrackInflationRatioMouse:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackInflationRatioPen:"Object bound inflation ratio (pen)",DES_objBoundTrackInflationRatioPen:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatioTouch:"Object bound inflation ratio (touch)",DES_objBoundTrackInflationRatioTouch:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when touching on screen",TITLE_selectionMarkerInflation:"Selection marker inflation",DES_selectionMarkerInflation:"Inflation of object selection mark, makes it easier to see the containing objects",TITLE_selectionMarkerEdgeInflation:"Selection edge inflation",DES_selectionMarkerEdgeInflation:"Inflation when judging if a coord is on selection mark edge",TITLE_followPointerCoordOnDirectManipulatingSingleObj:"Follow pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObj:"If true, the new coordinate of manipulating object will be set directly by the position of pointer (rather than the delta coordinate to the original position)",TITLE_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold of following pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold when following pointer coordinate on direct manipulating object",TITLE_constrainedResizeStep:"Constrained resize step",DES_constrainedResizeStep:"Constrained resize step",TITLE_constrainedRotateStep:"Constrained rotation step",DES_constrainedRotateStep:"Constrained rotation step, in arc",TITLE_rotationLocationPointDistanceThreshold:"Rotation starting min distance",DES_rotationLocationPointDistanceThreshold:"Rotation will occur only when mouse point distance (from rotation center) larger than this value",TITLE_directedMoveDistanceThreshold:"Direct move min distance",DES_directedMoveDistanceThreshold:"Direct moving will only be done if moved distance large than this value",TITLE_enablePartialAreaSelecting:"Enable partial selecting",DES_enablePartialAreaSelecting:"If this value is true, when drag a selecting rubber band, object partly in the band will be totally selected",TITLE_selectingBrushWidth:"Brush selecting Width",DES_selectingBrushWidth:"Width of brush in brush selecting",TITLE_enableOffSelectionManipulation:"Enable off-selection manipulation",DES_enableOffSelectionManipulation:"When setting to true, you can still move, resize or rotate selected objects by holding mouse or touch outside selection for a while",TITLE_offSelectionManipulationActivatingTimeThreshold:"Off-selection manipulation hold time",DES_offSelectionManipulationActivatingTimeThreshold:"The minimal time (in ms) need for holding mouse or touch to invoke off-selection manipulation",TITLE_selectionMarkerDefPulseDuration:"Default selection mark pulse duration",DES_selectionMarkerDefPulseDuration:"The duration (in ms) of selection mark pulse when the selection is been emphasised",TITLE_selectionMarkerDefPulseCount:"Default selection mark pulse count",DES_selectionMarkerDefPulseCount:"The pulse count when the selection is been emphasised",TITLE_rotationRegionInflation:"Rotation region inflation",DES_rotationRegionInflation:"User can rotate the selected objects by pressing and move mouse in this inflated region outside selection",TITLE_enableMergePreview:"Enable merge preview",DES_enableMergePreview:"Whether a preview operation is used rather then the actual merge operation when merge two objects in editor during manipulation. Turn on this option may improve the performance of object manipulation.",TITLE_enableGestureManipulation:"Enable gesture manipulation",DES_enableGestureManipulation:"Whether user can use touch gestures (e.g. pinch) to scale or rotate selected objects in editor",TITLE_enableGestureZoomOnEditor:"Enable gesture zoom on editor",DES_enableGestureZoomOnEditor:"Whether user can use pinch gesture to zoom in or out the editor when there is no selection existed",TITLE_trackSimplifierDistanceThreshold:"Track-input curve simplification threshold",DES_trackSimplifierDistanceThreshold:"Distance threshold in simplifying curve drawn by track-input tool",TITLE_trackSimplifierIgnoreSegmentThreshold:"Track-input ignored segment threshold",DES_trackSimplifierIgnoreSegmentThreshold:"Segment length less than this threshold drawn by track-input will be ignored in parsing",TITLE_trackMergeDistanceThreshold:"Track-input merge distance threshold",DES_trackMergeDistanceThreshold:"If a joint or end point of line segment drawn by track-inpu tool is close to another line segment (less than this threshold), it will be regarded on that line.",TITLE_trackOptimizationAngleConstraint:"Track-input optimization line cross angle constraint",DES_trackOptimizationAngleConstraint:null,TITLE_trackOptimizationDistanceConstraints:"Track-input optimization line length constraint",DES_trackOptimizationDistanceConstraints:null,TITLE_trackOptimizationPrimaryDistanceConstraint:"Track-input optimization primary line length",DES_trackOptimizationPrimaryDistanceConstraint:null,TITLE_autoAdjustZoomLevelOnTrackTouching:null,DES_autoAdjustZoomLevelOnTrackTouching:null,TITLE_editorInitialZoom:"Editor initial zoom level",DES_editorInitialZoom:"The initial zoom level of editor",TITLE_atomSetterFontSize:"Atom setter font size",DES_atomSetterFontSize:"Font size of atom setter",TITLE_allowUnknownAtomSymbol:"Allow unknown atom symbol",DES_allowUnknownAtomSymbol:"Allow inputting unknown symbol and handle it as pseudo atom in atom setter",TITLE_clonedObjectScreenOffset:"Copied object coord offset",DES_clonedObjectScreenOffset:"The distance between copied objects and origin objects when doing paste selection action in editor",TITLE_enableBondKekulizeHucklize:"Enable Kekulize and Hucklize function of bond",DES_enableBondKekulizeHucklize:"Whether Kekulize and Hucklize buttons are shown in bond modifier of editor",TITLE_enableHotKey:"Enable hot keys",DES_enableHotKey:"Whether shortcut with key pressing is enabled in editor"},UiMarkerConfigs:{TITLE_hotTrackerColor:"Hot track mark color",DES_hotTrackerColor:"Color of hot track mark",TITLE_hotTrackerOpacity:"Hot track mark opacity",DES_hotTrackerOpacity:"Opacity of hot track marker, value from 0 to 1",TITLE_selectionMarkerStrokeColor:"Selection mark stroke color",DES_selectionMarkerStrokeColor:"Stroke color of selection mark",TITLE_selectionMarkerStrokeWidth:"Selection mark stroke width",DES_selectionMarkerStrokeWidth:"Width of selection mark stroke",TITLE_selectionMarkerFillColor:"Selection mark fill color",DES_selectionMarkerFillColor:"Fill color of selection mark.",TITLE_selectionMarkerOpacity:"Selection mark opacity",DES_selectionMarkerOpacity:"Opacity of selection mark, value from 0 to 1",TITLE_selectionMarkerEmphasisOpacity:"Emphasised selection mark opacity",DES_selectionMarkerEmphasisOpacity:"Opacity of emphasised selection marker, value from 0 to 1",TITLE_selectingMarkerStrokeColor:"Selecting mark stroke color",DES_selectingMarkerStrokeColor:"Stroke color of selecting rubber band mark",TITLE_selectingMarkerStrokeWidth:"Selecting mark stroke width",DES_selectingMarkerStrokeWidth:"Stroke width of selection rubber band",TITLE_selectingMarkerStrokeDash:"Selecting mark dash style",DES_selectingMarkerStrokeDash:"Dash style of selecting rubber band",TITLE_selectingMarkerFillColor:"Selecting mark fill color",DES_selectingMarkerFillColor:"Fill color of selecting mark. Usually this value should be left blank (not filled)",TITLE_selectingMarkerOpacity:"Selecting mark opacity",DES_selectingMarkerOpacity:"Opacity of selecting mark, value from 0 to 1",TITLE_selectingBrushMarkerStrokeColor:"Brush selecting mark stroke color",DES_selectingBrushMarkerStrokeColor:"Stroke color of brush selecting mark",TITLE_selectingBrushMarkerStrokeDash:"Brush selecting mark dash style",DES_selectingBrushMarkerStrokeDash:"Dash style of brush selecting track",TITLE_selectingBrushMarkerStrokeLineCap:"Brushing selecting mark line-cap style",DES_selectingBrushMarkerStrokeLineCap:"Line-cap style of both ends of brush selecting track",TITLE_selectingBrushMarkerStrokeLineJoin:"Brushing selecting mark join point style",DES_selectingBrushMarkerStrokeLineJoin:"Join style of brush selection track segments",TITLE_selectingBrushMarkerOpacity:"Brush selecting mark opacity",DES_selectingBrushMarkerOpacity:"Opacity of brush selecting mark, value from 0 to 1",TITLE_trackMarkerStrokeColor:"Track-input mark stroke color",DES_trackMarkerStrokeColor:"Stroke color of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeWidth:"Track-input mark stroke width",DES_trackMarkerStrokeWidth:"Stroke width of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeDash:"Track-input mark dash style",DES_trackMarkerStrokeDash:"Dash style of track mark when using track-input tool to draw a structure",TITLE_trackMarkerOpacity:"Track-input mark opacity",DES_trackMarkerOpacity:"Opacity of track mark when using track-input tool to draw a structure",TITLE_flexStructureAssocMarkerColor:"Flex structure association mark color",DES_flexStructureAssocMarkerColor:"Color of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerOpacity:"Flex structure association mark opacity",DES_flexStructureAssocMarkerOpacity:"Opacity of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontSize:"Flex structure association mark font size",DES_flexStructureAssocMarkerFontSize:"Font size of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontFamily:"Flex structure association mark font family",DES_flexStructureAssocMarkerFontFamily:"Font family of mark showing atom count of flex ring/chain tool",TITLE_issueCheckMarkerColors:"Issue check markers color",DES_issueCheckMarkerColors:"Color of issue check markers, different colors are used for different issue levels",TITLE_issueCheckMarkerStrokeWidth:"Issue check marker stroke width",DES_issueCheckMarkerStrokeWidth:"Stroke width of issue check marker outline",TITLE_issueCheckActiveMarkerStrokeWidth:"Active issue check marker stroke width",DES_issueCheckActiveMarkerStrokeWidth:"Stroke width of active issue check marker outline",TITLE_issueCheckMarkerOpacity:"Issue check marker opacity",DES_issueCheckMarkerOpacity:"Opacity of issue check marker",TITLE_issueCheckActiveMarkerOpacity:"Active Issue check marker opacity",DES_issueCheckActiveMarkerOpacity:"Opacity of active issue check marker"},StructureConfigs:{TITLE_defBondType:"Default bond type",DES_defBondType:"Default type of bond",TITLE_defBondOrder:"Default bond order",DES_defBondOrder:"Default bond order",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default bond length",TITLE_defIsotopeId:"Default isotope",DES_defIsotopeId:"Default isotope when adding a new atom",TITLE_maxFlexChainAtomCount:"Maximum flex chain atom count",DES_maxFlexChainAtomCount:"Maximum atom count when inputting with flex chain tool",TITLE_minFlexChainAtomCount:"Minimal flex chain atom count",DES_minFlexChainAtomCount:"Minimal atom count when inputting with flex chain tool",TITLE_maxFlexRingAtomCount:"Maximum flex ring atom count",DES_maxFlexRingAtomCount:"Maximum atom count when inputting with flex ring tool",TITLE_minFlexRingAtomCount:"Minimal flex ring atom count",DES_minFlexRingAtomCount:"Minimal atom count when inputting with flex ring tool",TITLE_enabledNonAtomNodeTypes:"Available non-atom structure node types",DES_enabledNonAtomNodeTypes:"Non-atom structure node types available in editor",TITLE_enabledBondForms:"Available bond forms",DES_enabledBondForms:"Bond forms available in editor"},ChemSpaceConfigs:{TITLE_defScreenSize2D:"Default 2D screen size",TITLE_defScreenSize3D:"Default 3D screen size",TITLE_autoExpandScreenSize2D:"Auto expanding size 2D",DES_autoExpandScreenSize2D:"The size used when automatically expanding editor client in 2D mode",TITLE_autoExpandScreenSize3D:"Auto expanding size 3D",DES_autoExpandScreenSize3D:"The size used when automatically expanding editor client in 3D mode",TITLE_defPadding:"Default padding",DES_defPadding:"Padding on top when adding an unpositioned object to container chem space"},HotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"},BaseEditor:{TITLE_enableCreateNewDoc:"Enable create new document",DES_enableCreateNewDoc:"Whether creating a new document is allowed",TITLE_initOnNewDoc:"Starts with a new document",DES_initOnNewDoc:"Whether create a new document automatically when composer is initialized",TITLE_enableOperHistory:"Enable undo",DES_enableOperHistory:"Whether undo/redo is enabled",TITLE_enableIssueCheck:"Enable issue check",DES_enableIssueCheck:"Whether enable issue checker to detect errors and warning among objects in editor"},ChemSpaceEditor:{TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"},Composer:{TITLE_enableStyleToolbar:"Enable style toolbar",DES_enableStyleToolbar:"Whether display style toolbar to set color, font and size of objects",TITLE_enableObjModifierToolbar:"Enable object modifier toolbar",DES_enableObjModifierToolbar:"Whether display toolbar with a series of object modification tools",TITLE_allowCreateNewChild:"Enable create new child object",DES_allowCreateNewChild:"Whether new direct child of document can be created",TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"}}})),Cu}$v();Kekule.Localization.setCurrModule("general"),Kekule.Localization.addResource("zh","Texts",{UNNAMED:"未命名"}),Kekule.Localization.addResource("zh","ErrorMsg",{MODULE_NOT_LOADED:"模块{0}未载入",UNIT_NOT_FOUND:"Unit not found: {0}",STANDARD_UNIT_OF_CATEGORY_NOT_FOUND:"类别{0}的标准单位未设置",UNABLE_TO_CONVERT_BETWEEN_UNITS:"无法在单位{0}与{1}间转换数据",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"只能替换对象的直接属性",EMPTY_DOC:"文档无内容",ELEMENT_NOTSET:"未设置元素",EMPTY_RESURI:"资源URI无内容",CANNOT_LOAD_RES_OF_URI:"无法载入资源URI：",LIST_ITEM_CLASS_MISMATCH:"条目类型错误，无法加入列表",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"无效的化学元素",INVALID_ISOTOPE:"无效的同位素",COORD_STICK_NOT_ALLOWED_ON_CLASS:"Coordinate sticking is not allowed in this type of object",INVALID_STICK_TARGET_OBJ:"Invalid sticking target",UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ:"Unable to stick to object with a different owner",UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD:"Unable to stick to object without absolute coordinates",STICK_RECURSION_NOT_ALLOWED:"Stick recursion is not allowed",UNABLE_ADD_MISTYPED_NODE:"无法向键/连接符上连接错误的原子/顶点",UNABLE_ADD_DIFF_OWNER_OBJ:"对象有着不同的宿主，无法连接在同一键/连接符上",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"条目类型不符",SORT_FUNC_UNSET:"排序函数未设置",SOURCE_FRAGMENT_NOT_SET:"未指定源分子",UNABLE_ADD_NONMOLECULE_MAP:"仅能向反应物或生成物中添加分子",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"仅能向结构中添加原子、键或顶点、连接符",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"无法找到注册的归一化执行器",ERROR_LOADING_FILE:"文件载入错误：",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"读入数据失败，格式：",NO_SUITABLE_READER_FOR_FORMAT:"无法读入数据，格式：",NO_SUITABLE_READER_FOR_MIMETYPE:"无法读入数据，MIME类型：",NO_SUITABLE_READER_FOR_FILEEXT:"无法读入数据，文件后缀：",NO_SUITABLE_WRITER_FOR_FORMAT:"无法写入数据，格式：",NO_SUITABLE_WRITER_FOR_MIMETYPE:"无法写入数据，MIME类型：",NO_SUITABLE_WRITER_FOR_FILEEXT:"无法写入数据，文件后缀：",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"载入文件或链接失败：",CML_ELEM_READER_NOT_FOUND:"CML元素<{0}>读入器不存在",ATOMID_NOT_EXISTS:"原子标识(ID)不存在：",BONDID_NOT_EXISTS:"键标识(ID)不存在：",CML_ELEM_WRITER_TYPE_INPROPER:"{0}不是合适的CML元素{1}的写入器",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"无法向空的CML元素中输出内容",UNABLE_TO_OUTPUT_AS_CML:"无法将对象<{0}>输出至CML",MDL_CTAB_ATOM_CANNOT_CREATE:"无法从源MDL格式数据中创建原子",MDL_CTAB_BOND_CANNOT_CREATE:"无法从源MDL格式数据中创建化学键",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"对象并非分子，无法输出至分子连接表",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"分子无连接表，无法输出至MDL格式数据",NOT_MDL2000_FORMAT_DATA:"数据格式错误：并非MDL 2000",NOT_MDL_RXN_DATA:"并非MDL反应(RXN)数据",MALFORMED_MDL3000_COUNTLINE:"MDL 3000计数行格式错误",MDL3000_ATOMBLOCK_NOT_FOUND:"无法找到原子块，错误的MDL 3000数据？",NOT_MDL_FORMAT_DATA:"数据格式错误：并非MDL 2000或3000",NOT_MDL2000_RXN_DATA:"并非MDL RXN 2000数据",NOT_MDL3000_RXN_DATA:"并非MDL RXN 3000数据",NOT_MDL3000_RXN_COUNTLINE:"读入RXN 3000计数行错误",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL数据无法输出为非文本格式",MDL_INPUT_DATATYPE_NOT_TEXT:"非文本格式数据，非法的MDL源数据",UNABLE_TO_OUTPUT_AS_MDL:"无法将对象<{0}>输出至MDL格式数据",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"非文本或JSON格式数据，非法的KCJ源数据",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"无法输出为非文本或JSON格式",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"非文本或DOM格式数据，非法的KCX源数据",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"无法输出为非文本或DOM格式",JSON_SERIALIZER_NOT_EXISTS:"JSON序列化器不存在",XML_SERIALIZER_NOT_EXISTS:"XML序列化器不存在",JCAMP_DATA_WITHOUT_TITLE_LINE:"不正确的JCAMP格式数据：TITLE标签缺失",JCAMP_OTHER_LABEL_BEFORE_TITLE_LINE:"不正确的JCAMP格式数据：未以TITLE标签起始",JCAMP_MORE_THAN_ONE_ROOT_BLOCK:"不正确的JCAMP格式数据：存在多个根数据块",JCAMP_MORE_THAN_TWO_NEST_LEVEL:"不正确的JCAMP格式数据：超过两层数据块嵌套",JCAMP_ASDF_FORMAT_ERROR_WITH_STR:"不正确的JCAMP ASDF字符串: {0}",JCAMP_DATA_TABLE_X_VALUE_CHECK_ERROR:"JCAMP数据表X值校验失败!",JCAMP_DATA_TABLE_Y_VALUE_CHECK_ERROR:"JCAMP数据表Y值校验失败!",JCAMP_DATA_TABLE_VALUE_FIRST_LAST_NOT_MATCH:"JCAMP数据表起始/终止数据不匹配",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR:"Malformed JCAMP variable list format: {0}",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_UNSUPPORTED:"Unsupported JCAMP variable list format: {0}",JCAMP_NTUPLES_BEGIN_END_NAME_NOT_MATCH:"Ntuples name not match in begin/end labels: {0} and {1}",JCAMP_NTUPLES_PAGE_DECLARATION_FORMAT_ERROR:"Malformed JCAMP ntuples page declaration: {0}",JCAMP_LDR_TARGET_UNIT_NOT_MATCH_WITH_DETAIL:"The unit of property {0} ({1}) can not be converted to the request one ({2}) for JCAMP {3} LDR",FAILED_TO_ASSIGN_SYMBOL_TO_VARIABLE:"Fail to assign a symbol to variable {0}",JCAMP_IMPLICIT_HYDROGEN_COUNT_NOT_MATCH_DETAIL:"Unmatched implicit hydrogen count for atom {0}({1}), expect {2} but found {3}",VISIBLE_DATA_RANGE_IS_EMPTY:"The visible range of data is empty, unable to draw the spectrum",INAVAILABLE_AUTOSCALE_REF_LENGTH:"无法计算自动缩放所需的长度",FORMULA_RENDERER_3D_NOT_AVAILABLE:"分子式3D渲染器暂不可用",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"无法找到合适的渲染器",THREEJS_LIB_NOT_UNAVAILABLE:"Three.js不可用，请使用<script>标签将其引入或使用Kekule.externalResourceManager.register方法指定Three实例",THREEJS_DRAWING_NOT_UNAVAILABLE:"浏览器不支持Webgl、Canvas或SVG，请将其升级或更换",CANVAS2D_NOT_UNAVAILABLE:"浏览器不支持Canvas，请将其升级或更换",RAPHAEL_LIB_NOT_UNAVAILABLE:"Raphael.js不可用，请使用<script>标签将其引入",RAPHAEL_SVG_VML_UNAVAILABLE:"浏览器不支持SVG或VML，请将其升级或更换。",CALC_TERMINATED_BY_USER:"计算过程被用户中断",CALC_SERVICE_UNAVAILABLE:"计算服务“{0}”不可用"}),Kekule.Localization.addResource("zh","ErrorCheckMsg",{GENERAL_ERROR_WITH_CODE:"错误代码: {0}",ATOM_VALENCE_ERROR_WITH_SUGGEST:"{0}原子价数（{1}）异于常见值（{2}）",ATOM_VALENCE_ERROR_WITH_SUGGESTS:"{0}原子价数（{1}）异于常见值（{2}）",BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"共价键键级（{0}）超出允许值（{1}）范围",BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"{0}键键级（{1}）超出允许值（{2}）范围",NODE_DISTANCE_TOO_CLOSE:"原子或基团位置过于接近",NODE_DISTANCE_TOO_CLOSE_WITH_LABEL:"原子或基团（{0}）位置过于接近",TITLE_CHANGE_BOND_ORDER_TO:"将键级修改为{0}",DESCRIPTION_CHANGE_BOND_ORDER_TO:"将键级由{0}修改为{1}",TITLE_MERGE_TO:"将{0}与{1}合并",DESCRIPTION_MERGE_TO:"将节点{0}与{1}合并"}),Kekule.Localization.setCurrModule("widget"),Kekule.Localization.addResource("zh","WidgetTexts",{CAPTION_OK:"确定",CAPTION_CANCEL:"取消",CAPTION_YES:"是",CAPTION_NO:"否",CAPTION_BROWSE_COLOR:"浏览颜色",HINT_BROWSE_COLOR:"浏览更多颜色",S_COLOR_UNSET:"(未设置)",S_COLOR_DEFAULT:"(缺省值)",S_COLOR_MIXED:"(多个值)",S_COLOR_TRANSPARENT:"(透明)",S_OBJECT_UNSET:"(无)",S_ITEMS:"条目",S_OBJECT:"对象",S_VALUE_UNSET:"(未设置)",CAPTION_MENU:"菜单",HINT_MENU:"打开菜单",S_INSPECT_NONE:"(无)",S_INSPECT_OBJECTS:"({0}个对象)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"切换文本换行",CAPTION_INC_TEXT_SIZE:"增大字号",CAPTION_DEC_TEXT_SIZE:"减小字号",HINT_TOGGLE_TEXTWRAP:"切换文本是否自动换行",HINT_INC_TEXT_SIZE:"增大字号",HINT_DEC_TEXT_SIZE:"减小字号",HINT_CHOOSE_FONT_FAMILY:"选择字体",CAPTION_FIRST_PAGE:"首页",CAPTION_LAST_PAGE:"末页",CAPTION_PREV_PAGE:"前一页",CAPTION_NEXT_PAGE:"后一页",HINT_FIRST_PAGE:"首页",HINT_LAST_PAGE:"末页",HINT_PREV_PAGE:"前一页",HINT_NEXT_PAGE:"后一页",HINT_CURR_PAGE:"当前页",MSG_RETRIEVING_DATA:"载入数据…",CAPTION_DATATABLE_EDIT:"编辑",CAPTION_DATATABLE_DELETE:"删除",CAPTION_DATATABLE_INSERT:"插入",HINT_DATATABLE_EDIT:"编辑数据",HINT_DATATABLE_DELETE:"删除数据",HINT_DATATABLE_INSERT:"插入数据",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"添加新单元格",CAPTION_REMOVE_CELL:"移除",HINT_REMOVE_CELL:"移除单元格",CAPTION_CONFIG:"设置…",HINT_CONFIG:"修改设置",TITLE_IMG_FORMAT_PNG:"PNG格式图像",TITLE_IMG_FORMAT_JPG:"Jpeg格式图像",TITLE_IMG_FORMAT_GIF:"GIF格式图像",TITLE_IMG_FORMAT_SVG:"SVG格式图像"}),Kekule.Localization.addResource("zh","ChemWidgetTexts",{CAPTION_CLEAROBJS:"清除",CAPTION_LOADFILE:"载入…",CAPTION_LOADDATA:"载入…",CAPTION_SAVEFILE:"保存…",CAPTION_ZOOMIN:"放大",CAPTION_ZOOMOUT:"缩小",CAPTION_RESETZOOM:"重置缩放",CAPTION_RESETVIEW:"重置",CAPTION_ROTATE:"旋转",CAPTION_ROTATELEFT:"向左旋转",CAPTION_ROTATERIGHT:"向右旋转",CAPTION_ROTATEX:"沿X轴旋转",CAPTION_ROTATEY:"沿Y轴旋转",CAPTION_ROTATEZ:"沿Z轴旋转",CAPTION_MOL_DISPLAY_TYPE:"分子显示样式",CAPTION_SKELETAL:"键线式",CAPTION_CONDENSED:"缩写式",CAPTION_WIRE:"单线模型",CAPTION_STICKS:"棍式模型",CAPTION_BALLSTICK:"球棍模型",CAPTION_SPACEFILL:"比例模型",CAPTION_HIDEHYDROGENS:"显示/隐藏氢原子",CAPTION_OPENEDITOR:"编辑…",CAPTION_EDITOR_DONE:"完成",CAPTION_EDITOR_CANCEL:"取消",CAPTION_EDIT_OBJ:"编辑",HINT_CLEAROBJS:"清除对象",HINT_LOADFILE:"自文件载入",HINT_LOADDATA:"载入数据",HINT_SAVEFILE:"存储到文件",HINT_ZOOMIN:"放大",HINT_ZOOMOUT:"缩小",HINT_RESETZOOM:"重置缩放",HINT_RESETVIEW:"重置缩放与旋转",HINT_ROTATE:"旋转",HINT_ROTATELEFT:"逆时针旋转",HINT_ROTATERIGHT:"顺时针旋转",HINT_ROTATEX:"沿X轴旋转",HINT_ROTATEY:"沿Y轴旋转",HINT_ROTATEZ:"沿Z轴旋转",HINT_MOL_DISPLAY_TYPE:"改变分子显示样式",HINT_SKELETAL:"以键线式显示",HINT_CONDENSED:"以缩写式显示",HINT_WIRE:"以单线模型显示",HINT_STICKS:"以棍式模型显示",HINT_BALLSTICK:"以球棍模型显示",HINT_SPACEFILL:"以比例模型显示",HINT_HIDEHYDROGENS:"模型中显示/隐藏氢原子",HINT_OPENEDITOR:"编辑当前对象",HINT_EDITOR_DONE:"关闭并保存编辑器中的修改",HINT_EDITOR_CANCEL:"关闭并取消编辑器中的修改",CAPTION_NEWDOC:"新建",CAPTION_UNDO:"撤销",CAPTION_REDO:"重做",CAPTION_COPY:"复制",CAPTION_COPY_WHOLE:"复制",CAPTION_CUT:"剪切",CAPTION_PASTE:"粘贴",CAPTION_TOGGLE_SELECT:"叠加选择",CAPTION_SELECT_ALL:"全选",CAPTION_CLONE_SELECTION:"克隆选区",CAPTION_TOGGLE_OBJ_INSPECTOR:"对象检视器",CAPTION_TOGGLE_ISSUE_INSPECTOR:"问题检视器",CAPTION_TOGGLE_SHOW_ISSUE_MARKERS:"显示问题标记",CAPTION_RECHECK_ISSUES:"重新检查问题",CAPTION_MANIPULATE:"选取",CAPTION_MANIPULATE_MARQUEE:"矩形选框",CAPTION_MANIPULATE_LASSO:"套索选择",CAPTION_MANIPULATE_BRUSH:"选择刷",CAPTION_MANIPULATE_ANCESTOR:"选择分子",CAPTION_CLIENT_DRAGSCROLL:"移动画布",CAPTION_ERASE:"删除",CAPTION_TRACK_INPUT:"手写输入",CAPTION_MOL_BOND:"键",CAPTION_MOL_BOND_SINGLE:"单键",CAPTION_MOL_BOND_DOUBLE:"双键",CAPTION_MOL_BOND_TRIPLE:"三键",CAPTION_MOL_BOND_QUAD:"四键",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"芳香键",CAPTION_MOL_BOND_WEDGEUP:"实楔线键",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"实楔线键2",CAPTION_MOL_BOND_WEDGEDOWN:"虚楔线键",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"虚楔线键2",CAPTION_MOL_BOND_CLOSER:"突出(加粗)键",CAPTION_MOL_BOND_WAVY:"波浪键",CAPTION_MOL_BOND_DOUBLE_EITHER:"顺或反式双键",CAPTION_MOL_BOND_IONIC:"离子键",CAPTION_MOL_BOND_COORDINATE:"配位键",CAPTION_MOL_BOND_METALLIC:"金属键",CAPTION_MOL_BOND_HYDROGEN:"氢键",CAPTION_MOL_BOND_KEKULIZE:"Kekulize",CAPTION_MOL_BOND_HUCKLIZE:"Hucklize",CAPTION_MOL_ATOM:"原子",CAPTION_MOL_FORMULA:"分子式",CAPTION_MOL_ATOM_AND_FORMULA:"原子与分子式",CAPTION_MOL_CHARGE:"电荷",CAPTION_MOL_CHARGE_CLEAR:"清除电荷",CAPTION_MOL_CHARGE_POSITIVE:"正电荷",CAPTION_MOL_CHARGE_NEGATIVE:"负电荷",CAPTION_MOL_CHARGE_SINGLET:"单线态",CAPTION_MOL_CHARGE_DOUBLET:"双线态自由基",CAPTION_MOL_CHARGE_TRIPLET:"三线态",CAPTION_MOL_ELECTRON_LONEPAIR:"孤对电子",CAPTION_TEXT_BLOCK:"文字",CAPTION_IMAGE_BLOCK:"图像",CAPTION_TEXT_IMAGE:"文字与图像",CAPTION_MOL_FLEXCHAIN:"可变碳链",CAPTION_MOL_FLEXRING:"可变碳环",CAPTION_REPOSITORY_RING:"环",CAPTION_REPOSITORY_RING_3:"环丙烷",CAPTION_REPOSITORY_RING_4:"环丁烷",CAPTION_REPOSITORY_RING_5:"环戊烷",CAPTION_REPOSITORY_RING_6:"环己烷",CAPTION_REPOSITORY_RING_7:"环庚烷",CAPTION_REPOSITORY_RING_8:"环辛烷",CAPTION_REPOSITORY_RING_AR_6:"苯",CAPTION_REPOSITORY_RING_AR_5:"环戊二烯",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"环己烷椅式1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"环己烷椅式2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"环己烷Haworth式1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"环己烷Haworth式2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"环戊烷Haworth式1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"环戊烷Haworth式2",CAPTION_REPOSITORY_METHANE:"甲烷",CAPTION_REPOSITORY_FISCHER1:"单手性中心Fischer投影式",CAPTION_REPOSITORY_FISCHER2:"双手性中心Fischer投影式",CAPTION_REPOSITORY_FISCHER3:"三手性中心Fischer投影式",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"交叉式锯架式",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"重叠式锯架式",CAPTION_REPOSITORY_SUBBOND_MARK:"取代基键",CAPTION_REPOSITORY_ARROWLINE:"线段与箭头",CAPTION_REPOSITORY_GLYPH:"图符",CAPTION_REPOSITORY_GLYPH_LINE:"直线",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"开放箭头线",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"三角箭头线",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"双向开放箭头线",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"双向三角箭头线",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"可逆箭头线",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"开放箭头双线",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"开放箭头弧线",CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"单侧开放箭头弧线",CAPTION_ELECTRON_PUSHING_ARROW:"电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_DOUBLE:"双电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_SINGLE:"单电子转移箭头",CAPTION_REPOSITORY_HEAT_SYMBOL:"加热符号",CAPTION_REPOSITORY_ADD_SYMBOL:"加号",CAPTION_TEXT_FORMAT:"文字格式",CAPTION_PICK_COLOR:"颜色",CAPTION_FONTNAME:"字体",CAPTION_FONTSIZE:"字号",CAPTION_TEXT_DIRECTION:"文字方向",CAPTION_TEXT_DIRECTION_DEFAULT:"缺省",CAPTION_TEXT_DIRECTION_LTR:"由左至右",CAPTION_TEXT_DIRECTION_RTL:"由右至左",CAPTION_TEXT_DIRECTION_TTB:"由上至下",CAPTION_TEXT_DIRECTION_BTT:"由下至上",CAPTION_TEXT_HORIZONTAL_ALIGN:"文字水平对齐",CAPTION_TEXT_VERTICAL_ALIGN:"文字垂直对齐",CAPTION_TEXT_ALIGN_DEFAULT:"缺省",CAPTION_TEXT_ALIGN_LEADING:"首对齐",CAPTION_TEXT_ALIGN_TRAILING:"尾对齐",CAPTION_TEXT_ALIGN_CENTER:"居中对齐",CAPTION_TEXT_ALIGN_LEFT:"左对齐",CAPTION_TEXT_ALIGN_RIGHT:"右对齐",CAPTION_TEXT_ALIGN_TOP:"上对齐",CAPTION_TEXT_ALIGN_BOTTOM:"下对齐",CAPTION_NODE_LABEL_DISPLAY_MODE:"原子标签显示模式",CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT:"默认",CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN:"显示文本",CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN:"隐藏文本",CAPTION_NODE_LABEL_DISPLAY_MODE_SMART:"智能",CAPTION_ATOM_MODIFIER:"原子",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"键",CAPTION_CHARGE_MODIFIER:"电荷",CAPTION_GLYPH_PATH_MODIFIER:"线段",CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"反应箭头与线段",CAPTION_ARC_PATH_MODIFIER:"弧线",CAPTION_MULTI_ARC_PATH_MODIFIER:"多弧线",CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER:"电子转移箭头",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"电子转移成键箭头",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"创建新文档",HINT_UNDO:"撤销",HINT_REDO:"重做",HINT_COPY_WHOLE:"将对象复制至内部剪贴板",HINT_COPY:"将选定对象复制至内部剪贴板",HINT_CUT:"将选定对象剪切至内部剪贴板",HINT_PASTE:"自内部剪贴板复制",HINT_CLONE_SELECTION:"克隆当前选区",HINT_SELECT_ALL:"选择全部对象",HINT_TOGGLE_SELECT:"叠加选择",HINT_TOGGLE_OBJ_INSPECTOR:"显示或隐藏对象检视器",HINT_TOGGLE_ISSUE_INSPECTOR:"显示或隐藏问题检视器",HINT_TOGGLE_SHOW_ISSUE_MARKERS:"显示或隐藏问题标记",HINT_RECHECK_ISSUES:"重新检查编辑内容中的问题",HINT_MANIPULATE:"选择工具",HINT_MANIPULATE_MARQUEE:"矩形选框",HINT_MANIPULATE_LASSO:"套索选择",HINT_MANIPULATE_BRUSH:"选择刷",HINT_MANIPULATE_ANCESTOR:"选择分子",HINT_CLIENT_DRAGSCROLL:"移动画布",HINT_ERASE:"删除工具",HINT_TRACK_INPUT:"手写输入工具",HINT_MOL_BOND:"化学键工具",HINT_MOL_BOND_SINGLE:"单键",HINT_MOL_BOND_DOUBLE:"双键",HINT_MOL_BOND_TRIPLE:"叁键",HINT_MOL_BOND_QUAD:"四键",HINT_MOL_BOND_EXPLICIT_AROMATIC:"显式芳香键",HINT_MOL_BOND_WEDGEUP:"实楔线键",HINT_MOL_BOND_WEDGEUP_INVERTED:"实楔线键2",HINT_MOL_BOND_WEDGEDOWN:"虚楔线键",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"虚楔线键2",HINT_MOL_BOND_CLOSER:"突出(加粗)键",HINT_MOL_BOND_WAVY:"波浪键",HINT_MOL_BOND_DOUBLE_EITHER:"顺或反式双键",HINT_MOL_BOND_IONIC:"离子键",HINT_MOL_BOND_COORDINATE:"配位键",HINT_MOL_BOND_METALLIC:"金属键",HINT_MOL_BOND_HYDROGEN:"氢键",HINT_MOL_BOND_KEKULIZE:"Kekulize, 将显式的芳香键转换为单双键间隔形式",HINT_MOL_BOND_HUCKLIZE:"Hucklize, 将芳环上的键转换为显式的芳香键",HINT_MOL_ATOM:"原子工具",HINT_MOL_FORMULA:"分子式工具",HINT_MOL_ATOM_AND_FORMULA:"原子与分子式工具",HINT_MOL_CHARGE:"电荷工具",HINT_MOL_CHARGE_CLEAR:"清除电荷或自由基",HINT_MOL_CHARGE_POSITIVE:"正电荷",HINT_MOL_CHARGE_NEGATIVE:"负电荷",HINT_MOL_CHARGE_SINGLET:"单线态自由基",HINT_MOL_CHARGE_DOUBLET:"双线态自由基",HINT_MOL_CHARGE_TRIPLET:"三线态自由基",HINT_MOL_ELECTRON_LONEPAIR:"孤对电子",HINT_TEXT_BLOCK:"文字工具",HINT_IMAGE_BLOCK:"图像工具",HINT_TEXT_IMAGE:"文字与图像工具",HINT_MOL_FLEXCHAIN:"可变碳链",HINT_MOL_FLEXRING:"可变碳环",HINT_REPOSITORY_RING:"环工具",HINT_REPOSITORY_RING_3:"环丙烷",HINT_REPOSITORY_RING_4:"环丁烷",HINT_REPOSITORY_RING_5:"环戊烷",HINT_REPOSITORY_RING_6:"环己烷",HINT_REPOSITORY_RING_7:"环庚烷",HINT_REPOSITORY_RING_8:"环辛烷",HINT_REPOSITORY_RING_AR_6:"苯",HINT_REPOSITORY_RING_AR_5:"环戊二烯",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"环己烷椅式1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"环己烷椅式2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"环己烷Haworth式1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"环己烷Haworth式2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"环戊烷Haworth式1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"环戊烷Haworth式2",HINT_REPOSITORY_SUBBOND_MARK:"取代基键",HINT_REPOSITORY_METHANE:"甲烷",HINT_REPOSITORY_FISCHER1:"单手性中心Fischer投影式",HINT_REPOSITORY_FISCHER2:"双手性中心Fischer投影式",HINT_REPOSITORY_FISCHER3:"三手性中心Fischer投影式",HINT_REPOSITORY_SAWHORSE_STAGGERED:"交叉式锯架式",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"重叠式锯架式",HINT_REPOSITORY_ARROWLINE:"线段与箭头",HINT_REPOSITORY_GLYPH:"图符",HINT_REPOSITORY_GLYPH_LINE:"直线",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"开放箭头线",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"三角箭头线",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"双向开放箭头线",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"双向三角箭头线",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"可逆箭头线",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"开放箭头双线",HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"开放箭头弧线",HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"单侧开放箭头弧线",HINT_REPOSITORY_HEAT_SYMBOL:"加热符号",HINT_REPOSITORY_ADD_SYMBOL:"加号",HINT_ELECTRON_PUSHING_ARROW:"电子转移箭头",HINT_NODE_LABEL_DISPLAY_MODE:"原子标签显示模式",HINT_TEXT_FORMAT:"设置文字格式",HINT_FONTNAME:"设置字体",HINT_FONTSIZE:"设置字号",HINT_PICK_COLOR:"选择颜色",HINT_TEXT_DIRECTION:"设置文字方向",HINT_TEXT_HORIZONTAL_ALIGN:"设置文字水平对齐方式",HINT_TEXT_VERTICAL_ALIGN:"设置文字水平垂直方式",HINT_CHARGE_NONE:"无电荷",HINT_ATOM_MODIFIER:"设置原子",HINT_BOND_MODIFIER:"设置键",HINT_CHARGE_MODIFIER:"设置电荷",HINT_GLYPH_PATH_MODIFIER:"设置线段",HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"设置反应箭头与线段",HINT_ARC_PATH_MODIFIER:"设置弧线",HINT_MULTI_ARC_PATH_MODIFIER:"设置多重弧线",HINT_ELECTRON_PUSHING_ARROW_MODIFIER:"设置电子转移箭头",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"设置电子转移成键箭头",HINT_USE_ATOM_CUSTOM_COLOR:"(使用原子特征颜色)",CAPTION_LOADDATA_DIALOG:"载入数据",CAPTION_LOADDATA_DIALOG_APPENDMODE:"附加到当前文档",CAPTION_SAVEDATA_DIALOG:"保存数据",CAPTION_DATA_FORMAT:"数据格式：",CAPTION_DATA_SRC:"在下方输入或粘贴数据：",CAPTION_LOADDATA_FROM_FILE:"载入文件",CAPTION_CHOOSEFILEFORMAT:"选择文件格式",CAPTION_SELECT_FORMAT:"选择格式：",CAPTION_PREVIEW_FILE_CONTENT:"预览文件内容…",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"更多…",CAPTION_RGROUP:"取代基",CAPTION_VARIABLE_ATOM:"(包含)原子列表",CAPTION_VARIABLE_NOT_ATOM:"(不包含)原子列表",CAPTION_PSEUDOATOM:"赝原子(Pseudoatom)",CAPTION_DUMMY_ATOM:"虚原子(Dummy atom)",CAPTION_HETERO_ATOM:"杂原子",CAPTION_ANY_ATOM:"任意原子",CAPTION_ATOM:"原子",CAPTION_SUBGROUP:"基团",CAPTION_PERIODIC_TABLE_DIALOG:"元素周期表",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"选择元素",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"选择多个元素",CAPTION_TEXTBLOCK_INIT:"在此输入文字",CAPTION_WIDTH:"宽",CAPTION_LENGTH:"长",CAPTION_PATH_INDEX:"Path {0}",HINT_PATH_INDEX:"Path {0}",CAPTION_REACTION_ARROW_UNSET:"(未设置)",CAPTION_REACTION_ARROW_CUSTOM:"自定义",CAPTION_REACTION_ARROW_NORMAL:"普通反应箭头",CAPTION_REACTION_ARROW_RESONANCE:"共振式箭头",CAPTION_REACTION_ARROW_REVERSIBLE:"可逆反应箭头",CAPTION_REACTION_ARROW_RETROSYNTHESIS:"逆合成分析箭头",HINT_REACTION_ARROW_UNSET:"未设置",HINT_REACTION_ARROW_CUSTOM:"自定义",HINT_REACTION_ARROW_NORMAL:"普通反应箭头",HINT_REACTION_ARROW_RESONANCE:"共振式箭头",HINT_REACTION_ARROW_REVERSIBLE:"可逆反应箭头",HINT_REACTION_ARROW_RETROSYNTHESIS:"逆合成分析箭头",CAPTION_LINE_COUNT:"直线数目",CAPTION_LINE_GAP:"直线间隙",CAPTION_LINE:"直线",CAPTION_STARTING_ARROW:"起始箭头",CAPTION_ENDING_ARROW:"终止箭头",CAPTION_REACTION_ARROW_TYPE:"反应箭头类型",CAPTION_ELECTRON_PUSHING_ARROW_TYPE:"电子转移箭头类型",CAPTION_OPPOSITE_ARROW_SIDES:"箭头位置相反",CAPTION_SAME_ARROW_SIDES:"箭头位置相同",CAPTION_ELECTRON_PUSHING_ARROW_1:"单电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_1_ABBR:"单电子",HINT_ELECTRON_PUSHING_ARROW_1:"单电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_2:"双电子转移箭头",CAPTION_ELECTRON_PUSHING_ARROW_2_ABBR:"双电子",HINT_ELECTRON_PUSHING_ARROW_2:"双电子转移箭头",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"电子转移成键箭头",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"电子转移成键箭头",LEGEND_CAPTION:"图例",LEGEND_ELEM_SYMBOL:"元素符号",LEGEND_ELEM_NAME:"名称",LEGEND_ATOMIC_NUM:"原子序数",LEGEND_ATOMIC_WEIGHT:"原子量",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"自动尺寸",CAPTION_AUTOFIT:"自动缩放",CAPTION_SHOWSIZEINFO:"显示尺寸信息",CAPTION_LABEL_SIZE:"尺寸：",CAPTION_BACKGROUND_COLOR:"背景颜色：",CAPTION_WIDTH_HEIGHT:"宽：{0}、高：{1}",PLACEHOLDER_WIDTH:"宽",PLACEHOLDER_HEIGHT:"高",HINT_AUTOSIZE:"图形尺寸是否由对象大小自动调整",HINT_AUTOFIT:"对象是否填满图形区域",S_VALUE_DEFAULT:"(缺省)",CAPTION_TOGGLE_INSPECTOR:"对象检视器",HINT_TOGGLE_INSPECTOR:"显示或隐藏对象检视器"}),Kekule.Localization.addResource("zh","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"控件类不存在",WIDGET_CAN_NOT_BIND_TO_ELEM:"控件{0}无法绑定到HTML元素<{1}>",LOAD_CHEMDATA_FAILED:"载入数据失败",FILE_API_NOT_SUPPORTED:"您当前的浏览器不支持HTML文件操作，请升级浏览器。",DRAW_BRIDGE_NOT_SUPPORTED:"您当前的浏览器不支持该绘图功能，请升级浏览器。",COMMAND_NOT_REVERSIBLE:"命令无法撤销",PAGE_INDEX_OUTOF_RANGE:"页面超出范围",FETCH_DATA_TIMEOUT:"加载数据超时",RENDER_TYPE_CHANGE_NOT_ALLOWED:"渲染类型无法改变",CAN_NOT_CREATE_EDITOR:"创建编辑器失败",CAN_NOT_SET_COORD_OF_CLASS:"无法设置对象{0}实例的坐标",CAN_NOT_SET_DIMENSION_OF_CLASS:"无法设置对象{0}实例的尺寸",CAN_NOT_MERGE_CONNECTORS:"化学键或连接符无法合并",NOT_A_VALID_ATOM:"无效的原子",INVALID_ATOM_SYMBOL:"原子符号无效",INVALID_OR_EMPTY_IMAGE:"空白或不合法的图像"});(function(){if(Kekule.PROP_AUTO_TITLE){var s=ClassEx.getPrototype(ObjectEx).defineProp;ClassEx.getPrototype(ObjectEx).defineProp=function(e,t){if(!t.title&&!t.description){var n=this.getClassName();n.startsWith("Kekule.")&&(n=n.substr(7));var i="TITLE_"+e,r="DES_"+e,a=Kekule.Localization.findValue("OBJDEF_TEXTS."+n+"."+i),o=Kekule.Localization.findValue("OBJDEF_TEXTS."+n+"."+r);t.title=a,t.description=o}return s.apply(this,[e,t])}}Kekule.ExceptionLevel={ERROR:-1,NOT_FATAL_ERROR:-10,WARNING:-2,NOTE:-3,LOG:-4,getAllLevels:function(){var e=Kekule.ExceptionLevel;return[e.ERROR,e.NOT_FATAL_ERROR,e.WARNING,e.NOTE,e.LOG]},levelToString:function(e){var t=Kekule.ExceptionLevel;return e===t.ERROR||e===t.NOT_FATAL_ERROR?"error":e===t.WARNING?"warning":e===t.NOTE?"note":"log"}},Kekule.ErrorLevel=Kekule.ExceptionLevel,Kekule.throwException=function(e,t){if(Kekule.exceptionHandler)return Kekule.exceptionHandler.throwException(e,t);var n=Kekule.ExceptionLevel;if(!t||t===n.ERROR)throw typeof e=="string"&&(e=new Kekule.Exception(e)),e;if(typeof console<"u"){typeof e!="string"&&(e=e.message);var i=t===n.NOT_FATAL_ERROR?console.error:t===n.WARNING?console.warn:t===n.NOTE?console.info:console.log;i?i(e):console.log(e)}},Kekule.getExceptionMsg=function(e){return typeof e=="string"?e:typeof e=="object"?e.message:""},Kekule.raise=Kekule.throwException,Kekule.error=function(e,t){var n=t?Kekule.ExceptionLevel.NOT_FATAL_ERROR:Kekule.ExceptionLevel.ERROR;return Kekule.raise(e,n)},Kekule.chemError=function(e,t){return typeof e=="string"&&(e=new Kekule.ChemError(e)),Kekule.error(e,t)},Kekule.warn=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.WARNING)},Kekule.notify=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.NOTE)},Kekule.log=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.LOG)},Kekule.hasLocalRes=function(){return!!Kekule.LOCAL_RES},Kekule.globalOptions={add:function(e,t){var n=Object.getCascadeFieldValue(e,Kekule.globalOptions);n&&DataType.isObjectValue(n)&&DataType.isObjectValue(t)?Object.extend(n,t):Object.setCascadeFieldValue(e,t,Kekule.globalOptions,!0)},get:function(e,t){var n=Object.getCascadeFieldValue(e,Kekule.globalOptions);return n===void 0&&(n=t),n}},Kekule.HashEx=Class.create({CLASS_NAME:"Kekule.HashEx",PROP_NAME_PREFIX:"__$key$__",initialize:function(){this._map={}},finalize:function(){this._map=null},keyToPropName:function(e){return this.PROP_NAME_PREFIX+e},has:function(e){return this._map.hasOwnProperty(this.keyToPropName(e))},set:function(e,t){return this._map[this.keyToPropName(e)]=t,this},get:function(e,t){var n=this.keyToPropName(e);return this._map.hasOwnProperty(n)?this._map[n]:t},remove:function(e){var t=this.keyToPropName(e);return this._map.hasOwnProperty(t)&&delete this._map[t],this},clear:function(){this._map={}}}),Kekule.MapEx=Class.create({CLASS_NAME:"Kekule.MapEx",initialize:function(e,t){this.isWeak=!e,Kekule.MapEx._inited||Kekule.MapEx._init();var n=e?Kekule.MapEx._implementationNonWeak:Kekule.MapEx._implementationWeak;n?this._implementation=new n:(this._keys=[],this._values=[]),t&&(this._cache={})},finalize:function(){this._implementation||(this._keys=null,this._values=null,this._cache=null)},set:function(e,t){if(this._implementation)this._implementation.set(e,t);else{var n=this._keys.indexOf(e);n>=0?this._values[n]=t:(this._keys.push(e),this._values.push(t))}return this._cache&&this._cache.key===e&&(this._cache.value=t),this},get:function(e,t){if(this._cache&&this._cache.key===e)return this._cache.value;var n,i=!1;if(this._implementation)this._implementation.has(e)&&(n=this._implementation.get(e),i=!0);else{var r=this._keys.indexOf(e);r>=0&&(n=this._values[r],i=!0)}return i&&this._cache&&(this._cache.key=e,this._cache.value=n),i?n:t},has:function(e){return this._implementation?this._implementation.has(e):this._keys.indexOf(e)>=0},remove:function(e){if(this._cache&&this._cache.key===e&&(this._cache={}),this._implementation)return this._implementation[!this._implementation||"delete"](e);var t=this._keys.indexOf(e);return t>=0&&(this._keys.splice(t,1),this._values.splice(t,1)),this},clear:function(){return this._cache&&(this._cache={}),this._implementation&&!this._debug||(this._keys=[],this._values=[]),this._implementation&&(this.isWeak?Kekule.error(Kekule.$L("ErrorMsg.CANNOT_CLEAR_WEAKMAP")):this._implementation.clear()),this},getKeys:function(){if(this._implementation){if(this.isWeak)return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_KEY_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.keys();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var n=t.next();!n.done;)e.push(n.value),n=t.next()}else for(var i in e=[],t)e.push(i);return e}return[].concat(this._keys)},getValues:function(){if(this._implementation){if(this.isWeak)return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_VALUE_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.values();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var n=t.next();!n.done;)e.push(n.value),n=t.next()}else for(var i in e=[],t)e.push(i);return e}return this._values},getLength:function(){return this.getKeys().length}}),Kekule.MapEx._init=function(){Kekule.MapEx._implementationWeak=null,Kekule.MapEx._implementationNonWeak=null,Kekule.$jsRoot.WeakMap&&(Kekule.MapEx._implementationWeak=Kekule.$jsRoot.WeakMap),Kekule.$jsRoot.Map&&Kekule.$jsRoot.Map.prototype.keys&&(Kekule.MapEx._implementationNonWeak=Kekule.$jsRoot.Map),Kekule.MapEx._inited=!0},Kekule.MapEx._inited=!1,Kekule.TwoTupleMapEx=Class.create({CLASS_NAME:"Kekule.TwoTupleMapEx",initialize:function(e,t){this.nonWeak=e,this.map=new Kekule.MapEx(e,t),t&&(this._level1Cache={})},finalize:function(){this._level1Cache=null,this.map.finalize()},getSecondLevelMap:function(e,t){if(e&&this._level1Cache&&e===this._level1Cache.key&&this._level1Cache.value)return this._level1Cache.value;var n=this.map.get(e);return!n&&t&&(n=new Kekule.MapEx(this.nonWeak),this.map.set(e,n)),n},set:function(e,t,n){return this.getSecondLevelMap(e,!0).set(t,n),this},get:function(e,t,n){var i=this.getSecondLevelMap(e,!1);return i?i.get(t,n):n},has:function(e,t){var n=this.getSecondLevelMap(e,!1);return!!n&&n.has(t)},remove:function(e,t){var n=this.getSecondLevelMap(e,!1);if(n)return n.remove(t)},clear:function(){this.map.clear(),this._level1Cache&&(this._level1Cache={})}}),Kekule.CoordMode={UNKNOWN:0,COORD2D:2,COORD3D:3},Kekule.ObjAnchorPosition={CORNER:0,CENTER:1,DEFAULT:0},Kekule.ClassDefineUtils={CommonSizeMethods:{getSizeOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getSize3D(t):this.getSize2D(t)},setSizeOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setSize3D(e):this.setSize2D(e)},getBoxOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getBox3D(t):this.getBox2D(t)}},Size2DMethods:{fetchSize2D:function(){var e=this.getPropStoreFieldValue("size2D");return e||(e={},this.setPropStoreFieldValue("size2D",e)),e},notifySize2DChanged:function(e){this.notifyPropSet("size2D",e)},hasSize2D:function(e){var t=this.getPropStoreFieldValue("size2D"),n=t&&(t.x!==void 0||t.y!==void 0);return!n&&e&&(n=!!this.hasSize3D&&this.hasSize3D()),n},getBox2D:function(e){var t=this.getCoord2D(e)||{x:0,y:0},n=this.getSize2D(e);if(n&&(n.x||n.y)){var i={x:n.x,y:-n.y},r=Kekule.CoordUtils.add(t,i);return{x1:t.x,y1:t.y,x2:r.x,y2:r.y}}return{x1:t.x,y1:t.y,x2:t.x,y2:t.y}},get2DSizeX:function(e){var t=this.getSize2D(e);return t&&t.x||0},set2DSizeX:function(e){var t=this.fetchSize2D();t.x!=e&&(t.x=e,this.notifySize2DChanged(t))},get2DSizeY:function(e){var t=this.getSize2D(e);return t&&t.y||0},set2DSizeY:function(e){var t=this.fetchSize2D();t.y!=e&&(t.y=e,this.notifySize2DChanged(t))}},Size3DMethods:{fetchSize3D:function(){var e=this.getPropStoreFieldValue("size3D");return e||(e={},this.setPropStoreFieldValue("size3D",e)),e},notifySize3DChanged:function(e){this.notifyPropSet("size3D",e)},hasSize3D:function(e){var t=this.getPropStoreFieldValue("size3D"),n=t&&(t.x!==void 0||t.y!==void 0||t.z!==void 0);return!n&&e&&(n=!!this.hasSize2D&&this.hasSize2D()),n},getBox3D:function(e){var t=this.getCoord3D(e),n=this.getSize3D(e);if(t&&n){var i=Kekule.CoordUtils.add(t,n);return{x1:t.x,y1:t.y,z1:t.z,x2:i.x,y2:i.y,z2:i.z}}},get3DSizeX:function(e){var t=this.getSize3D(e);return t&&t.x||0},set3DSizeX:function(e){var t=this.fetchSize3D();t.x!=e&&(t.x=e,this.notifySize3DChanged(t))},get3DSizeY:function(e){var t=this.getSize3D(e);return t&&t.y||0},set3DSizeY:function(e){var t=this.fetchSize3D();t.y!=e&&(t.y=e,this.notifySize3DChanged(t))},get3DSizeZ:function(e){var t=this.getSize3D(e);return t&&t.z||0},set3DSizeZ:function(e){var t=this.fetchSize3D();t.z!=e&&(t.z=e,this.notifySize3DChanged(t))}},addStandardSizeSupport:function(e,t){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonSizeMethods),(!t||t.indexOf("size2D")>=0)&&(ClassEx.defineProp(e,"size2D",{dataType:DataType.HASH,getter:function(n,i){var r=this.getPropStoreFieldValue("size2D");!r&&n&&this.hasSize3D()&&(r=this.getSize3D()),!r&&i&&(r={x:0,y:0},this.setPropStoreFieldValue("size2D",r));var a=r?{x:r.x,y:r.y}:void 0;return a&&(a=Kekule.CoordUtils.absValue(a)),a},setter:function(n){var i=this.fetchSize2D();n.x!==void 0&&(i.x=n.x),n.y!==void 0&&(i.y=n.y),this.notifySize2DChanged(i)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Size2DMethods)),(!t||t.indexOf("size3D")>=0)&&(ClassEx.defineProp(e,"size3D",{dataType:DataType.HASH,getter:function(n,i){var r=this.getPropStoreFieldValue("size3D");return!r&&n&&this.hasSize2D()&&((r=this.getSize2D()).z=0),!r&&i&&(r={x:0,y:0,z:0},this.setPropStoreFieldValue("size3D",r)),r?{x:r.x,y:r.y,z:r.z}:void 0},setter:function(n){var i=this.fetchSize3D();n.x!==void 0&&(i.x=n.x),n.y!==void 0&&(i.y=n.y),n.z!==void 0&&(i.z=n.z),this.notifySize3DChanged(i)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Size3DMethods))},CommonCoordMethods:{getObjAnchorPosition:function(e){var t=this.doGetObjAnchorPosition&&this.doGetObjAnchorPosition(e);return t=t||Kekule.ObjAnchorPosition.DEFAULT},getCoordParent:function(e){return this.getParent&&this.getParent()||null},getCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getCoord3D(t):this.getCoord2D(t)},setCoordOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setCoord3D(e):this.setCoord2D(e)},getAbsCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getAbsCoord3D(t):this.getAbsCoord2D(t)},setAbsCoordOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setAbsCoord3D(e):this.setAbsCoord2D(e)},hasCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.hasCoord3D(t):this.hasCoord2D(t)},getIndirectCoordStorageOfMode:function(e){var t=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return t&&t[e]},setIndirectCoordStorageOfMode:function(e,t){var n=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return n&&(n[e]=t),this},calcIndirectCoordValue:function(e,t){var n=["x","y"];e===Kekule.CoordMode.COORD3D&&n.push("z");var i=this.getIndirectCoordStorage()[e],r=this.getIndirectCoordRefCoords(e,t);Kekule.ArrayUtils.isArray(r)&&(r=r[0]);var a=this.getIndirectCoordRefLengths(e,t);if(i&&r&&a){for(var o={},l=Kekule.ObjUtils.notUnset,u=0,c=n.length;u<c;++u){var d,h=n[u],p=i[h],g=r[h],f=a[h];l(p)&&l(g)&&l(f)&&(d=f===0?g:g+f*p,o[h]=d)}return o}return null},calcIndirectCoordStorage:function(e,t,n,i){var r=["x","y"];e===Kekule.CoordMode.COORD3D&&r.push("z");var a=this.getIndirectCoordStorageOfMode(e),o=this.getIndirectCoordRefCoords(e,i);Kekule.ArrayUtils.isArray(o)&&(o=o[0]);var l=this.getIndirectCoordRefLengths(e,i);if(a&&o&&l){for(var u={},c=Kekule.ObjUtils.notUnset,d=0,h=r.length;d<h;++d){var p,g=r[d],f=t[g],m=o[g],C=l[g];if(!(c(f)&&c(m)&&c(C)))return null;p=C!==0?(f-m)/C:1,u[g]=p}return u}return null},saveIndirectCoordValue:function(e,t,n,i){if(t){var r=this.calcIndirectCoordStorage(e,t,n,i);if(r)return this.setIndirectCoordStorageOfMode(e,r),r}return null},getIndirectCoordRefLengths:function(e,t){return null},getIndirectCoordRefCoords:function(e,t){return null}},Coord2DMethods:{fetchCoord2D:function(){var e=this.getPropStoreFieldValue("coord2D");return e||(e={},this.setPropStoreFieldValue("coord2D",e)),e},notifyCoord2DChanged:function(e){this.notifyPropSet("coord2D",e)},hasCoord2D:function(e){var t=this.getPropStoreFieldValue("coord2D"),n=t&&(t.x!==void 0||t.y!==void 0);return!n&&e&&(n=!!this.hasCoord3D&&this.hasCoord3D()),n},get2DX:function(e){var t=this.getCoord2D(e);return t&&t.x||0},set2DX:function(e){var t=this.fetchCoord2D();t.x!=e&&(t.x=e,this.notifyCoord2DChanged(t))},get2DY:function(e){var t=this.getCoord2D(e);return t&&t.y||0},set2DY:function(e){var t=this.fetchCoord2D();t.y!=e&&(t.y=e,this.notifyCoord2DChanged(t))}},Coord3DMethods:{fetchCoord3D:function(){var e=this.getPropStoreFieldValue("coord3D");return e||(e={},this.setPropStoreFieldValue("coord3D",e)),e},notifyCoord3DChanged:function(e){this.notifyPropSet("coord3D",e)},hasCoord3D:function(e){var t=this.getPropStoreFieldValue("coord3D"),n=t&&(t.x!==void 0||t.y!==void 0||t.z!==void 0);return!n&&e&&(n=!!this.hasCoord2D&&this.hasCoord2D()),n},get3DX:function(e){var t=this.getCoord3D(e);return t&&t.x||0},set3DX:function(e){var t=this.fetchCoord3D();t.x!=e&&(t.x=e,this.notifyCoord3DChanged(t))},get3DY:function(e){var t=this.getCoord3D(e);return t&&t.y||0},set3DY:function(e){var t=this.fetchCoord3D();t.y!=e&&(t.y=e,this.notifyCoord3DChanged(t))},get3DZ:function(e){var t=this.getCoord3D(e);return t&&t.z||0},set3DZ:function(e){var t=this.fetchCoord3D();t.z!=e&&(t.z=e,this.notifyCoord3DChanged(t))}},addStandardCoordSupport:function(e,t){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonCoordMethods),(!t||t.indexOf("coord2D")>=0)&&(ClassEx.defineProp(e,"coord2D",{dataType:DataType.HASH,getter:function(n,i){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(Kekule.CoordMode.COORD2D,n);if(r)return r}var a=this.getPropStoreFieldValue("coord2D");return!a&&n&&this.hasCoord3D()&&(a=this.getCoord3D()),!a&&i&&(a={x:0,y:0},this.setPropStoreFieldValue("coord2D",a)),a?{x:a.x,y:a.y}:void 0},setter:function(n){var i=this.fetchCoord2D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD2D,n,i),n.x!==void 0&&(i.x=n.x),n.y!==void 0&&(i.y=n.y),this.notifyCoord2DChanged(i)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Coord2DMethods)),(!t||t.indexOf("coord3D")>=0)&&(ClassEx.defineProp(e,"coord3D",{dataType:DataType.HASH,getter:function(n,i){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(Kekule.CoordMode.COORD2D,n);if(r)return r}var a=this.getPropStoreFieldValue("coord3D");return!a&&n&&this.hasCoord2D()&&((a=this.getCoord2D()).z=0),!a&&i&&(a={x:0,y:0,z:0},this.setPropStoreFieldValue("coord3D",a)),a?{x:a.x,y:a.y,z:a.z}:void 0},setter:function(n){var i=this.fetchCoord3D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD3D,n,i),n.x!==void 0&&(i.x=n.x),n.y!==void 0&&(i.y=n.y),n.z!==void 0&&(i.z=n.z),this.notifyCoord3DChanged(i)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Coord3DMethods)),(!t||t.indexOf("absCoord2D")>=0)&&ClassEx.defineProp(e,"absCoord2D",{dataType:DataType.HASH,serializable:!1,getter:function(n){var i=this.getCoord2D(n)||{},r=this.getCoordParent(Kekule.CoordMode.COORD2D);return r&&r.getAbsCoord2D?Kekule.CoordUtils.add(i,r.getAbsCoord2D(n)||{}):{x:i.x,y:i.y}},setter:function(n,i){var r=n,a=this.getCoordParent(Kekule.CoordMode.COORD2D);a&&a.getAbsCoord2D&&(r=Kekule.CoordUtils.substract(n,a.getAbsCoord2D(i))),this.setCoord2D(r)}}),(!t||t.indexOf("absCoord3D")>=0)&&ClassEx.defineProp(e,"absCoord3D",{dataType:DataType.HASH,serializable:!1,getter:function(n){var i=this.getCoord3D(n)||{},r=this.getCoordParent(Kekule.CoordMode.COORD3D);return r&&r.getAbsCoord3D?Kekule.CoordUtils.add(i,r.getAbsCoord3D(n)||{}):{x:i.x,y:i.y,z:i.z}},setter:function(n,i){var r=n,a=this.getCoordParent(Kekule.CoordMode.COORD2D);a&&a.getAbsCoord3D&&(r=Kekule.CoordUtils.substract(n,a.getAbsCoord3D(i))),this.setCoord3D(r)}}),(!t||t.indexOf("enableIndirectCoord")>=0)&&ClassEx.defineProp(e,"enableIndirectCoord",{scope:Class.PropertyScope.PUBLIC,dataType:DataType.BOOL,serializable:!0,setter:function(n){if(this.getPropStoreFieldValue("enableIndirectCoord")!=n){if(n){var i=this.getCoord2D(),r=this.getCoord3D();i&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD2D,i,i,!0),r&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD3D,r,r,!0)}this.setPropStoreFieldValue("enableIndirectCoord",n)}}}),(!t||t.indexOf("indirectCoordStorage")>=0)&&ClassEx.defineProp(e,"indirectCoordStorage",{dataType:DataType.HASH,serializable:function(){return!!this.getEnableIndirectCoord()},setter:null,getter:function(){var n=this.getPropStoreFieldValue("indirectCoordStorage");return n||((n={})[Kekule.CoordMode.COORD2D]={},n[Kekule.CoordMode.COORD3D]={},this.setPropStoreFieldValue("indirectCoordStorage",n)),n}})},ExtraObjMapMethods:{getExtraProp:function(e,t){var n=this.getExtraObjMap().get(e);return n?t?n[t]:n:void 0},setExtraProp:function(e,t,n){var i;(i=this.getExtraProp(e))?i[t]=n:((i={})[t]=n,this.getExtraObjMap().set(e,i))},removeExtraProp:function(e,t){if(t){var n=this.getExtraProp(e);n[t]=void 0,delete n[t]}else this.getExtraObjMap().remove(e)}},addExtraObjMapSupport:function(e){ClassEx.defineProp(e,"extraObjMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var t=this.getPropStoreFieldValue("extraObjMap");return t||(t=new Kekule.MapEx(!0,!0),this.setPropStoreFieldValue("extraObjMap",t)),t}}),ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraObjMapMethods)},ExtraTwoTupleObjMapMethods:{getExtraProp2:function(e,t,n){var i=(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).get(e,t);return i?n?i[n]:i:void 0},setExtraProp2:function(e,t,n,i){var r;(r=this.getExtraProp2(e,t))?r[n]=i:((r={})[n]=i,(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).set(e,t,r))},removeExtraProp2:function(e,t,n){if(n){var i=this.getExtraProp2(e,t);i[n]=void 0,delete i[n]}else this.getExtraTwoTupleObjMap().remove(e,t)}},addExtraTwoTupleObjMapSupport:function(e){var t="extraTwoTupleObjMap";ClassEx.defineProp(e,t,{dataType:"Kekule.TwoTupleMapEx",serializable:!1,getter:function(){var n=this.getPropStoreFieldValue(t);return n||(n=new Kekule.TwoTupleMapEx(!0,!0),this.setPropStoreFieldValue(t,n),this.__$__k__extraTwoTupleObjMap__$__=n),n}}),ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraTwoTupleObjMapMethods)}},Kekule.ObjPropSettingManager={_items:new Kekule.MapEx(!0),register:function(e,t){Kekule.ObjPropSettingManager._items.set(e,t)},unregister:function(e){Kekule.ObjPropSettingManager._items.remove(e)},getSetting:function(e){return Kekule.ObjPropSettingManager._items.get(e)}},ClassEx.defineProp(ObjectEx,"predefinedSetting",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=Kekule.StrUtils.splitTokens(e||"",",");if(t.length){for(var n=0,i=t.length;n<i;++n){for(var r=this.getClass(),a=t[n],o=null,l="";r&&!o;)l=ClassEx.getClassName(r)+"."+a,o=Kekule.ObjPropSettingManager.getSetting(l),r=ClassEx.getSuperClass(r);o||(o=Kekule.ObjPropSettingManager.getSetting(a)),o&&this.setPropValues(o)}this.setPropStoreFieldValue("predefinedSetting",l)}}}),Kekule.ObjectTreeOperation={MODIFY:0,ADD:1,REMOVE:2},Kekule.ChemObjInteractMode={DEFAULT:0,UNMOVABLE:1,UNSELECTABLE:2,HIDDEN:3},Kekule.ComparisonMethod={DEFAULT:0,PROPERTIES:1,CHEM_STRUCTURE:10},Kekule.ObjComparer={equal:function(e,t,n){return Kekule.ObjComparer.compare(e,t,n)===0},compare:function(e,t,n){return Kekule.ObjComparer._compareValue(e,t,n)},_compareValue:function(e,t,n){var i=DataType;if(e===t)return 0;var r=i.getType(e),a=i.getType(t);if(r==="number"&&Kekule.NumUtils.isFloatEqual(e,t))return 0;if(e<t&&!(e>t))return-1;if(e>t&&!(e<t))return 1;var o=null;if(r!==a){var l=[i.UNKNOWN,i.VARIANT,i.UNDEFINED,i.BOOL,i.NUMBER,i.INT,i.FLOAT,i.STRING,i.ARRAY,i.FUNCTION,i.DATE,i.OBJECT,i.OBJECTEX,i.CLASS],u=l.indexOf(r),c=l.indexOf(a);o=u<0&&c<0?null:u-c}else if(!e&&t)o=-1;else if(e&&!t)o=1;else if(e.doCompare)o=e.doCompare(t,n);else if(t.doCompare)o=-t.doCompare(e,n);else if(r===DataType.ARRAY){if(!(o=e.length-t.length))for(var d=0,h=e.length;d<h&&!(o=Kekule.ObjComparer._compareValue(e[d],t[d],n));++d);}else o=r===DataType.OBJECT?Kekule.ObjComparer._compareHash(e,t,n):null;if(o===null){var p=e.toString&&e.toString()||"",g=t.toString&&t.toString()||"";(o=p<g?-1:p>g?1:null)===null&&(o=-1)}return o},_compareHash:function(e,t,n){var i=Kekule.ObjUtils.getOwnedFieldNames(e)||[],r=Kekule.ObjUtils.getOwnedFieldNames(t)||[],a=i.length-r.length;if(!(a||(i.sort(),r.sort(),a=Kekule.ArrayUtils.compare(i,r))))for(var o=0,l=i.length;o<l;++o){var u=i[o],c=e[u],d=t[u];if(a=Kekule.ObjComparer.compare(c,d,n)){console.log(u,a,c,d);break}}return a}},Kekule.ChemObject=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemObject",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setId(e),this.setBubbleEvent(!0),this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.__load_parentRoot_objRef_props__=null,this.addEventListener("change",function(t){var n=this.getPropStoreFieldValue("srcInfo");if(n&&n.data){for(var i=t.target,r=t.changedPropNames,a=!1,o=0,l=r.length;o<l;++o){var u=r[o];if(u&&u!=="srcInfo"&&i.isPropertySerializable(u)){a=!0;break}if(u==="[children]"){a=!0;break}}a&&(n.data=null)}},this)},doFinalize:function(){this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.__load_parentRoot_objRef_props__=null,this.setPropStoreFieldValue("attachedCoordStickNodes",null),this.removeSelf(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("id",{dataType:DataType.STRING}),this.defineProp("interactMode",{dataType:DataType.INT,enumSource:Kekule.ChemObjInteractMode}),this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var t=this.getPropStoreFieldValue("info");return!t&&e&&(t={},this.setPropStoreFieldValue("info",t)),t}}),this.defineProp("scalarAttribs",{dataType:DataType.ARRAY,setter:null}),this.defineProp("parent",{dataType:"Kekule.ChemObject",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getParent();t!==e&&(t&&t._removeChildObj&&(t._removeChildObj(this),this.invokeEvent("removeFromObjTree",{obj:this,parent:t})),this.setPropStoreFieldValue("parent",e),e&&e._appendChildObj&&(e._appendChildObj(this),this.invokeEvent("addToObjTree",{obj:this,parent:e})),this.parentChanged(e,t))}}),this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getOwner();t!==e&&(t&&(t._removeOwnedObj(this),this.invokeEvent("removeFromSpace",{obj:this,owner:t})),this.setPropStoreFieldValue("owner",e),e&&(e._appendOwnedObj(this),this.invokeEvent("addToSpace",{obj:this,owner:t})),this.ownerChanged(e,t))}}),this.defineProp("srcInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("srcInfo");return e||(e={},this.setPropStoreFieldValue("srcInfo",e)),e}}),this.defineProp("isEditing",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getOwner();return e&&e.getIsEditing?e.getIsEditing():this.getPropStoreFieldValue("isEditing")}}),this.defineProp("attachedCoordStickNodes",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("attachedCoordStickNodes");return e||(e=[],this.setPropStoreFieldValue("attachedCoordStickNodes",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableObjectChangeEvent(!0)},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},getAutoIdPrefix:function(){return"o"},_parentObjectLoaded:function(e){},_ownerObjectLoaded:function(e){},_handleObjRefProps:function(e,t){var n=t;if(n)for(var i=Kekule.ObjUtils.getOwnedFieldNames(n),r=0,a=i.length;r<a;++r){var o=i[r],l=this.getPropInfo(o),u=this._doGetPropObjRefObjInfo(this,l,e).rootObj,c=n[o];if(DataType.isArrayValue(c)){var d=[];for(r=0,a=c.length;r<a;++r)if(g=this._doUnwrapObjRefSerializationStr(this,c[r])){var h=u.getChildAtIndexStack(g);d.push(h)}else d.push(void 0);this.setPropValue(o,d)}else{var p,g;(g=this._doUnwrapObjRefSerializationStr(this,c))&&(p=u.getChildAtIndexStack(g)),p&&this.setPropValue(o,p)}try{delete n[o]}catch{}}},doSaveProp:function(e,t,n,i,r,a,o,l){if(t.serializable&&e._doGetObjRefSerializationValue&&t.objRef){var u=e._doGetPropObjRefObjInfo(e,t,a);if(u){var c=u.rootObj;if(c){var d=e.getPropValue(t.name);if(d){if(Kekule.ArrayUtils.isArray(d)){for(var h=[],p=0,g=d.length;p<g;++p){var f=e._doGetObjRefSerializationValue(c,e,d[p],u.objRefRoot);f?h.push(f):h.push(d[p])}return r.doSaveFieldValue(e,t.name,h,n,r.getValueExplicitType(h),i,c,o,l),!0}var m=e._doGetObjRefSerializationValue(c,e,d,u.objRefRoot);if(m)return r.doSaveFieldValue(e,t.name,m,n,r.getValueExplicitType(m),i,c,o,l),!0}}}}},_doGetObjRefSerializationValue:function(e,t,n,i){var r=e.indexStackOfChild&&e.indexStackOfChild(n);return r&&r.length?"@"+JSON.stringify(r):null},doLoadProp:function(e,t,n,i,r,a,o){if(t.serializable&&t.objRef){var l=i.doLoadFieldValue(e,t.name,n,null,r,a,o);if(l){var u=(e._doGetPropObjRefObjInfo&&e._doGetPropObjRefObjInfo(e,t,a)).storageObjName,c=e[u];return c||(c={},e[u]=c),c[t.name]=l,!0}}},_doUnwrapObjRefSerializationStr:function(e,t){try{var n=t.startsWith("@")?t.substr(1):t,i=JSON.parse(n);return DataType.isArrayValue(i)?i:null}catch(r){Kekule.error(r)}},_doGetPropObjRefObjInfo:function(e,t,n){var i=t.objRefRoot,r=i==="owner",a=i==="storageRoot",o=i==="parent"?e.getParent&&e.getParent():r?e.getOwner&&e.getOwner():a?n:null;if(!o){var l=e.getOwner&&e.getOwner();l?(i="owner",r=!0,o=l):(i="storageRoot",a=!0,o=n)}return{objRefRoot:i,rootObj:o,storageObjName:"__load_objRef_props__"}},loaded:function(e){this.tryApplySuper("loaded",[e]),this.notifyParentLoaded()},allLoaded:function(e){this.tryApplySuper("allLoaded",[e]),this._handleObjRefProps(e,this.__load_objRef_props__)},notifyParentLoaded:function(){for(var e=0,t=this.getChildCount();e<t;++e){var n=this.getChildAt(e);n&&n._parentObjectLoaded&&n._parentObjectLoaded(this)}},isObjRefProperty:function(e){return!(!e||!e.objRef)},notifyPropSet:function(e,t,n){this.tryApplySuper("notifyPropSet",[e,t,n]);var i=this.getPropInfo(e);if(i&&this.isObjRefProperty(i)){var r=this.getOwner();r&&r.modifyObjRefRelation&&r.modifyObjRefRelation(this,i,this.getPropValue(i.name))}},getObjRefProperties:function(){for(var e=[],t=this.getAllPropList(),n=0,i=t.getLength();n<i;++n){var r=t.getPropInfoAt(n);this.isObjRefProperty(r)&&e.push(r)}return e},_registerObjRefRelations:function(e){if(e&&e.modifyObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var n=0,i=t.length;n<i;++n){var r=t[n],a=this.getPropValue(r.name);e.modifyObjRefRelation(this,r,a)}}},_unregisterObjRefRelations:function(e){if(e&&e.releaseObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var n=0,i=t.length;n<i;++n){var r=t[n];e.releaseObjRefRelation(this,r)}}},isSelectable:function(){var e=Kekule.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNSELECTABLE)},isMovable:function(){var e=Kekule.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNMOVABLE)},getNearestSelectableObject:function(){return this.isSelectable()?this:this.getParent()?this.getParent().getNearestSelectableObject():null},getNearestMovableObject:function(){return this.isMovable()?this:this.getParent()?this.getParent().getNearestMovableObject():null},getNearestAncestorOfType:function(e){var t=this.getParent();return t?t instanceof e?t:t.getNearestAncestorOfType?t.getNearestAncestorOfType(e):null:null},removeSelf:function(){this.setParent(null),this.setOwner(null)},notifyScalarAttribsChange:function(){this.notifyPropSet("scalarAttribs",this.getPropStoreFieldValue("scalarAttribs"))},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},_removeChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,Kekule.ObjectTreeOperation.REMOVE)},_appendChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,Kekule.ObjectTreeOperation.ADD)},_notifyOwnerObjTreeOperation:function(e,t,n){var i=this.getOwner();i&&i._notifyObjTreeOperation&&i._notifyObjTreeOperation(e,t,n)},objTreeOfOwnerUpdated:function(e,t,n){},objSpaceOfOwnerUpdated:function(e,t,n){},ownerChanged:function(e,t){for(var n=0,i=this.getScalarAttribCount();n<i;++n)this.getScalarAttribAt(n).setOwner(e);for(n=0,i=this.getChildCount();n<i;++n){var r=this.getChildAt(n);r&&r.setOwner&&r.setOwner(e)}},parentChanged:function(e,t){},getParentList:function(){var e=[],t=this.getParent();return t&&(t.getParentList&&(e=t.getParentList()||[]),e.unshift(t)),e},getParentRoot:function(){var e=this.getParent();return e&&e.getParentRoot&&(e=e.getParentRoot()||e),e},isChildOf:function(e){for(var t=this.getParent();t&&t!==e;)t=t.getParent?t.getParent():null;return!!t},getNextSibling:function(){var e=this.getParent();return e&&e.getNextSiblingOfChild?e.getNextSiblingOfChild(this):null},isSiblingWith:function(e){var t=this.getParent(),n=e.getParent&&e.getParent();return t&&n&&t===n},getChildHolder:function(){return this},getChildSubgroupNames:function(){return[]},getBelongChildSubGroupName:function(e){return null},_getPrevSubgroupChildrenCount:function(e){for(var t=this.getChildSubgroupNames(),n=0,i=0,r=t.length;i<r;++i){if(t[i]===e)return n;var a=this._getSubGroupChildCountMethod(t[i]);n+=a&&a.apply(this)||0}return n},_getSubgroupChildIndexInfoFromChildIndex:function(e){for(var t=this.getChildSubgroupNames(),n=0,i=0,r=t.length;i<r;++i){var a=this._getSubGroupChildCountMethod(t[i]),o=a&&a.apply(this)||0;if(e<n+o)return{name:t[i],index:e-n};n+=o}return null},_getSubGroupChildCountMethod:function(e){return this["get"+e.upperFirst()+"Count"]},_getSubGroupChildAtMethod:function(e){return this["get"+e.upperFirst()+"At"]},_getSubGroupChildIndexOfMethod:function(e){return this["indexOf"+e.upperFirst()]},_getSubGroupChildRemoveMethod:function(e){return this["remove"+e.upperFirst()]},_getSubGroupChildRemoveAtMethod:function(e){return this["remove"+e.upperFirst()+"At"]},_getSubGroupChildAppendMethod:function(e){return this["append"+e.upperFirst()]},_getSubGroupChildInsertBeforeMethod:function(e){return this["insert"+e.upperFirst()+"Before"]},_getSubGroupChildInsertAtMethod:function(e){return this["insert"+e.upperFirst()+"At"]},_ensureSubGroupChildMethodsExist:function(){for(var e=["_getSubGroupChildCountMethod","_getSubGroupChildAtMethod","_getSubGroupChildIndexOfMethod","_getSubGroupChildRemoveMethod","_getSubGroupChildRemoveAtMethod","_getSubGroupChildInsertBeforeMethod","_getSubGroupChildInsertAtMethod"],t=this.getChildSubgroupNames(),n=0,i=t.length;n<i;++n)for(var r=0,a=e.length;r<a;++r)this[e[r]].apply(this,[t[n]])||Kekule.warn("Subgroup child method not exisits: "+e[r]+" / "+this.getClassName())},getChildCount:function(){var e=this.getChildHolder();return e&&e!==this?e.getChildCount():this.doGetChildCount()},doGetChildCount:function(){for(var e=0,t=this.getChildSubgroupNames(),n=0,i=t.length;n<i;++n){var r=this._getSubGroupChildCountMethod(t[n]);r&&(e+=r.apply(this))}return e},getChildAt:function(e){var t=this.getChildHolder();return t&&t!==this?t.getChildAt(e):this.doGetChildAt(e)},doGetChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var n=this._getSubGroupChildAtMethod(t.name);return n&&n.apply(this,[t.index])}return null},indexOfChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.indexOfChild(e):this.doIndexOfChild(e)},doIndexOfChild:function(e){for(var t=this.getChildSubgroupNames(),n=0,i=t.length;n<i;++n){var r=this._getSubGroupChildIndexOfMethod(t[n]);if(r){var a=r.apply(this,[e]);if(a>=0)return this._getPrevSubgroupChildrenCount(t[n])+a}}return-1},hasChild:function(e){return this.indexOfChild(e)>=0},filterChildren:function(e,t){for(var n=[],i=0,r=this.getChildCount();i<r;++i){var a=this.getChildAt(i);if(a){if(e(a,i))n.push(a);else if(t&&a.filterChildren){var o=a.filterChildren(e,t);o&&o.length&&(n=n.concat(o))}}}return n},iterateChildren:function(e,t){for(var n=0,i=this.getChildCount();n<i;++n){var r=this.getChildAt(n);r&&(e(r,n),t&&r.iterateChildren&&r.iterateChildren(e,t))}},removeChildAt:function(e){return this.doRemoveChildAt(e)},doRemoveChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var n=this._getSubGroupChildRemoveAtMethod(t.name);return n&&n.apply(this,[t.index])}return null},removeChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.removeChild(e):this.doRemoveChild(e)},doRemoveChild:function(e){for(var t,n=this.getChildSubgroupNames(),i=0,r=n.length;i<r;++i){var a=this._getSubGroupChildRemoveMethod(n[i]);if(a&&(t=a.apply(this,[e])))return t}return null},removeChildren:function(e){for(var t=e.length-1;t>=0;--t)this.removeChild(e[t])},insertChildAt:function(e,t){var n=this.getChildHolder();return n&&n!==this?n.insertChildAt(e,t):this.doInsertChildAt(e,t)},doInsertChildAt:function(e,t){if(t>=this.getChildCount())return this.appendChild(e);var n=this._getSubgroupChildIndexInfoFromChildIndex(t);if(n){var i=this._getSubGroupChildInsertAtMethod(n.name);if(i){var r=i.apply(this,[e,n.index]);if(r>=0)return this._getPrevSubgroupChildrenCount(n.name)+r}}return-1},insertBefore:function(e,t){return this.insertChildBefore(e,t)},insertChildBefore:function(e,t){var n=this.getChildHolder();return n&&n!==this?n.insertChildBefore(e,t):this.doInsertChildBefore(e,t)},doInsertChildBefore:function(e,t){var n=this.getBelongChildSubGroupName(e);if(!n||t&&n!==this.getBelongChildSubGroupName(t))return-1;this.getChildSubgroupNames();var i=this._getSubGroupChildInsertBeforeMethod(n);return i?this._getPrevSubgroupChildrenCount(n)+i.apply(this,[e,t]):-1},appendChild:function(e){return this.insertChildBefore(e,null)},appendChildren:function(e){for(var t=0,n=e.length;t<n;++t)this.appendChild(e[t])},cascadeOnChildren:function(e){if(!e)return this;for(var t=0,n=this.getChildCount();t<n;++t){var i=this.getChildAt(t);i.cascadeOnChildren&&i.cascadeOnChildren(e),e(i)}return this},cascade:function(e){return e?(this.cascadeOnChildren(e),e(this),this):this},indexStackOfChild:function(e){var t=e.getParentList&&e.getParentList(),n=-1;if(t&&t.length&&(n=t.indexOf(this)),n<0)return null;for(var i,r=[],a=this,o=n-1;o>=0;--o){var l=t[o];if(!((i=a.indexOfChild(l))>=0))return null;r.push(i),a=l}return(i=a.indexOfChild(e))>=0?(r.push(i),r):null},getChildAtIndexStack:function(e){if(!e||(e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),n=1,i=e.length;n<i;++n){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[n])}return t},isEmpty:function(){return!1},clearIds:function(){this.setId(void 0);for(var e=0,t=this.getChildCount();e<t;++e){var n=this.getChildAt(e);n.clearIds&&n.clearIds()}},assignTo:function(e,t){var n=this.tryApplySuper("assignTo",[e]);return!t&&e.clearIds&&e.clearIds(),n},assign:function(e,t){return e.assignTo(this,t)},clone:function(e){var t=new(this.getClass());return this.assignTo(t,e),t},getScalarAttribCount:function(){var e=this.getScalarAttribs();return e?e.length:0},getScalarAttribAt:function(e){var t=this.getScalarAttribs();return t?t[e]:null},appendScalarAttrib:function(e){this.getScalarAttribs()||this.setPropStoreFieldValue("scalarAttribs",[]);var t=Kekule.ArrayUtils.pushUniqueEx(this.getScalarAttribs(),e);return t.isPushed&&(e.setParent(this),this.notifyScalarAttribsChange()),t.index},removeScalarAttribAt:function(e){if(this.getScalarAttribs()){var t=Kekule.ArrayUtils.removeAt(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},removeScalarAttrib:function(e){if(this.getScalarAttribs()){var t=Kekule.ArrayUtils.remove(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,t){this.doGetInfo(!0)[e]=t,this.notifyInfoChange()},getContainerBox:function(e,t){if(this.getAbsCoordOfMode){var n=this.getAbsCoordOfMode(e,t)||{},i=n;if(this.getSizeOfMode){var r=this.getSizeOfMode(e,t)||{};if(this.getObjAnchorPosition(e)===Kekule.ObjAnchorPosition.CENTER){var a=Kekule.CoordUtils.divide(r,2);e!==Kekule.CoordMode.COORD3D&&(a.y=-a.y),n=Kekule.CoordUtils.substract(n,a)}i=e===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.add(n,this.getSizeOfMode(e,t)||{}):{x:(n.x||0)+(r.x||0),y:(n.y||0)-(r.y||0)}}return Kekule.BoxUtils.createBox(n,i)}return null},equal:function(e,t){return this.compare(e,t)===0},compare:function(e,t){if(e===this)return 0;if(!e)return 1;var n,i=this.doGetActualCompareOptions(t);return(n=i.customMethod?i.customMethod(this,e,i):this.doCompare(e,i))===0?0:n<0?-1:1},doGetActualCompareOptions:function(e){return e||{}},doCompare:function(e,t){if(e===this)return 0;if(this.getClass()!==(e.getClass&&e.getClass()))return this.getClassName()<(e.getClassName&&e.getClassName()||"")?-1:1;var n=this.doCompareOnProperties(e,t);if(!n&&t.extraComparisonProperties)for(var i=0,r=t.extraComparisonProperties.length;i<r;++i){var a=t.extraComparisonProperties[i];if(this.hasProperty(a)&&e.hasProperty&&e.hasProperty(a)){var o=this.getPropValue(a),l=e.getPropValue(a);if((n=this.doCompareOnValue(o,l,t))!==0)break}}return n},doCompareOnProperties:function(e,t){var n;n=t.properties?t.properties:this.getComparisonPropNames(t);for(var i=t&&t.ignoredProperties,r=0,a=0,o=n.length;a<o;++a){var l=n[a];if(!(i&&i.indexOf(l)>=0)&&(r=this.doCompareProperty(e,n[a],t))!==0)return r}return 0},getComparisonPropNames:function(e){var t=this.doGetComparisonPropNames(e);return t||(t=this.doGetDefaultComparisonPropNames()),t},doGetComparisonPropNames:function(e){return null},doGetDefaultComparisonPropNames:function(){for(var e=[],t=this.getPropListOfScopes([Class.PropertyScope.PUBLIC,Class.PropertyScope.PUBLISHED]),n=0,i=t.getLength();n<i;++n){var r=t.getPropInfoAt(n);e.push(r.name)}return e},doCompareProperty:function(e,t,n){var i=e.getPropValue&&e.getPropValue(t),r=this.getPropValue(t);return r===i?0:this.doCompareOnValue(r,i,n)},doCompareOnValue:function(e,t,n){return Kekule.ObjComparer._compareValue(e,t,n)},attachCoordStickNodes:function(e){var t=Kekule.ArrayUtils,n=t.toArray(e),i=this.getAttachedCoordStickNodes();return t.pushUnique(i,n),this},detachCoordStickNodes:function(e){for(var t=Kekule.ArrayUtils,n=t.toArray(e),i=this.getAttachedCoordStickNodes(),r=0,a=n.length;r<a;++r)t.remove(i,n[r]);return this}}),Kekule.VarDependency={INDEPENDENT:0,DEPENDENT:1},Kekule.VarDefinition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.VarDefinition",initialize:function(e){this.tryApplySuper("initialize"),this.beginUpdate();try{e&&this.setPropValues(e),Kekule.ObjUtils.isUnset(this.getDependency())&&this.setDependency(Kekule.VarDependency.INDEPENDENT)}finally{this.endUpdate()}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("symbol",{dataType:DataType.STRING}),this.defineProp("unit",{dataType:DataType.STRING}),this.defineProp("units",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getUnit()},setter:function(e){this.setUnit(e)}}),this.defineProp("dependency",{dataType:DataType.INT,enumSource:Kekule.VarDependency}),this.defineProp("displayLabel",{dataType:DataType.VARIANT}),this.defineProp("description",{dataType:DataType.STRING}),this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var t=this.getPropStoreFieldValue("info");return!t&&e&&(t={},this.setPropStoreFieldValue("info",t)),t}})},isIndependent:function(){return this.getDependency()!==Kekule.VarDependency.DEPENDENT},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,t){this.doGetInfo(!0)[e]=t,this.notifyInfoChange()},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},doCompare:function(e,t){for(var n,i=0,r=0,a=(n=t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?["unit","dependency","info"]:["name","symbol","unit","dependency","info","displayLabel","description"]).length;r<a;++r){var o=n[r],l=this.getPropValue(o),u=e.getPropValue(o);if(!(i=Kekule.ObjComparer._compareValue(l,u,t)))break}return i}}),Kekule.Scalar=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Scalar",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e]),t&&this.setName(t),n!==void 0&&this.setValue(n),i&&this.setUnit(i)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("value",{dataType:DataType.PRIMARY}),this.defineProp("errorValue",{dataType:DataType.PRIMARY}),this.defineProp("unit",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING})},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?(t||[]).concat(["name","value","errorValue","unit","title"]):t}}),Kekule.Scalar.create=function(e,t,n){var i=new Kekule.Scalar(null,null,e,t);return n!==void 0&&i.setErrorValue(n),i},Kekule.ChemObjList=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemObjList",initialize:function(e,t,n){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("itemBaseClass",t),this.setPropStoreFieldValue("items",[]),this._transparent=!!n},initProperties:function(){this.defineProp("itemBaseClass",{dataType:DataType.CLASS,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("items",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("items");return!t&&e&&(t=[],this.setPropStoreFieldValue("items",t)),t}})},loaded:function(e){this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded",[e])},parentChanged:function(e,t){this.changeAllItemsParent(),this.tryApplySuper("parentChanged",[e,t])},isEmpty:function(){return this.getItemCount()<=0},isValidItemType:function(e){var t=this.getItemBaseClass();return!t||e instanceof t},checkItemType:function(e){var t=this.isValidItemType(e);return t||Kekule.raise(Kekule.$L("ErrorMsg.LIST_ITEM_CLASS_MISMATCH")),t},notifyItemsChange:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},getItemOwner:function(){return this.getOwner()},changeAllItemsOwner:function(){var e=this.getItems();if(e)for(var t=this.getItemOwner(),n=0,i=e.length;n<i;++n){var r=e[n];r&&r.setOwner&&r.setOwner(t)}},getItemParent:function(){return this._transparent&&this.getParent()||this},changeAllItemsParent:function(){var e=this.getItems();if(e)for(var t=this.getItemParent(),n=0,i=e.length;n<i;++n){var r=e[n];r&&r.setParent&&r.setParent(t)}},getItemCount:function(){var e=this.getPropStoreFieldValue("items");return e?e.length:0},getItemAt:function(e){var t=this.getPropStoreFieldValue("items");return t?t[e]:null},indexOf:function(e){var t=this.getPropStoreFieldValue("items");return t?t.indexOf(e):-1},indexOfItem:function(e){return this.indexOf(e)},getNextSiblingOfChild:function(e){var t=this.indexOf(e);return t>=0?this.getItemAt(t+1):null},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return this.isValidItemType(e)?"item":this.tryApplySuper("getBelongChildSubGroupName",[e])},append:function(e){if(this.checkItemType(e),e){var t=Kekule.ArrayUtils.pushUniqueEx(this.doGetItems(!0),e);return t.isPushed&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),t.index}return-1},insert:function(e,t){if(this.checkItemType(e),e){var n=Kekule.ArrayUtils.insertUniqueEx(this.doGetItems(!0),e,t);return n.isInserted&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),n.index}return-1},insertItemAt:function(e,t){return this.insert(e,t)},insertItemBefore:function(e,t){if(t){var n=this.indexOfItem(t);return n>=0?this.insertItemAt(e,n):this.appendItem(e)}return this.append(e)},removeAt:function(e){if(this.getItems()){var t=Kekule.ArrayUtils.removeAt(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItemAt:function(e){return this.removeAt(e)},remove:function(e){if(this.getItems()){var t=Kekule.ArrayUtils.remove(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItem:function(e){return this.remove(e)},toArray:function(){return this.getItems()||[]},getContainerBox:function(e,t){for(var n,i=this.toArray(),r=0,a=i.length;r<a;++r){var o=i[r],l=o.getContainerBox?o.getContainerBox(e,t):null;l&&(n=n?Kekule.BoxUtils.getContainerBox(n,l):Kekule.BoxUtils.clone(l))}return n},getComparisonPropNames:function(e){var t=this.tryApplySuper("getComparisonPropNames",[e]);return t&&this._transparent&&(t=Kekule.ArrayUtils.exclude(t,["parent","owner"])),t}}),Kekule.ChemSpaceElement=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpaceElement",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=new Kekule.ChemObjList(null,Kekule.ChemObject,!0);t.setParent(this),t.addEventListener("change",function(){this.objectChange(["children"])},this),this.setPropStoreFieldValue("children",t)},initProperties:function(){this.defineProp("children",{dataType:"Kekule.ChemObjList",scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getChildren();t&&t.finalize(),e&&(e.setParent(this),e.setOwner(this.getOwner()),e._transparent=!0),this.setPropStoreFieldValue("children",e)}})},loaded:function(e){var t=this.getChildren();t&&(t.parentChanged(this),t.ownerChanged(this.getOwner())),this.tryApplySuper("loaded",[e])},ownerChanged:function(e,t){this.getChildren().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfChild(e);t>=0&&this.removeChildAt(t),this.tryApplySuper("_removeChildObj",[e])},getChildHolder:function(){return this.getChildren()},getNextSiblingOfChild:function(e){return this.getChildren().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getChildren().insert(e,t)}}),Kekule.ChemSpace=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this._autoIdMap={},this._enableObjRefRelations=!0,this._autoUpdateObjRefRelations=!0,this.setPropStoreFieldValue("enableAutoId",!0),this.setPropStoreFieldValue("ownedObjs",[]);var t=new Kekule.ChemSpaceElement;this.setPropStoreFieldValue("root",t),this.setPropStoreFieldValue("objRefRelationManager",new Kekule.ObjRefRelationManager(this)),t.setParent(this),t.setOwner(this)},initProperties:function(){this.defineProp("ownedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("root",{dataType:"Kekule.ChemSpaceElement",setter:null}),this.defineProp("enableAutoId",{dataType:DataType.BOOL}),this.defineProp("objScreenLengthRatio",{dataType:DataType.FLOAT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("screenSize",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("screenSize")||{};return{x:e.x,y:e.y}},setter:function(e){var t=this.getPropStoreFieldValue("screenSize");t||(t={},this.setPropStoreFieldValue("screenSize",t)),t.x=e.x,t.y=e.y}}),this.defineProp("objRefRelationManager",{dataType:"Kekule.ObjRefRelationManager",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null})},loaded:function(e){var t=this.getRoot();t&&(t.setParent(this),t.setOwner(this)),this.tryApplySuper("loaded",[e]),this.notifyOwnerLoaded()},notifyOwnedObjsChange:function(){this.notifyPropSet("ownedObjs",this.getPropStoreFieldValue("ownedObjs"))},_notifyOwnedObjsSpaceUpdate:function(e,t,n){for(var i=0,r=this.getOwnedObjCount();i<r;++i){var a=this.getOwnedObjAt(i);a&&a.objSpaceOfOwnerUpdated&&a.objSpaceOfOwnerUpdated(e,t,n)}if(this._enableObjRefRelations&&this._autoUpdateObjRefRelations&&n===Kekule.ObjectTreeOperation.REMOVE){var o=Kekule.ArrayUtils,l=this.findObjRefRelations({dest:e})||[];for(i=0,r=l.length;i<r;++i){var u=l[i];if(u.srcProp.autoUpdate){var c=u.dest,d=o.isArray(c)?o.exclude(c,[e]):null;u.srcObj.setPropValue(u.srcProp.name,d)}}}},notifyOwnerLoaded:function(){for(var e=this.getOwnedObjs()||[],t=0,n=e.length;t<n;++t){var i=e[t];i&&i._ownerObjectLoaded&&i._ownerObjectLoaded(this)}},getChildren:function(){return this.getRoot().getChildren().toArray()},getChildHolder:function(){return this.getRoot()},getNextSiblingOfChild:function(e){return this.getRoot().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getRoot().insertChild(e,t)},indexStackOfChild:function(e){return this.getRoot().indexStackOfChild(e)},getChildAtIndexStack:function(e){return this.getRoot().getChildAtIndexStack(e)},getObjById:function(e){for(var t=0,n=this.getOwnedObjCount();t<n;++t){var i=this.getOwnedObjAt(t);if(i.getId&&i.getId()===e)return i}return null},getAutoId:function(e,t){n=e&&e.getAutoIdPrefix?e.getAutoIdPrefix():"o";var n=e.getAutoIdPrefix?e.getAutoIdPrefix():"o";i=Kekule.ObjUtils.notUnset(t)?t:1;var i=this._getAutoIdIndex(n,i);return this._autoIdMap[n]=i,n+Number(i).toString()},_getAutoIdIndex:function(e,t){for(var n=t||0,i=e+Number(n).toString();this.getObjById(i);)++n,i=e+Number(n).toString();return n},assignAutoIdToObj:function(e){if(e.setId){var t=this.getAutoId(e);e.setId(t)}},getOwnedObjCount:function(){return this.getOwnedObjs().length},getOwnedObjAt:function(e){return this.getOwnedObjs()[e]},indexOfOwnedObj:function(e){return this.getOwnedObjs().indexOf(e)},_appendOwnedObj:function(e){this.indexOfOwnedObj(e)>=0||(this.getEnableAutoId()&&e.getId&&!e.getId()&&this.assignAutoIdToObj(e),this.getOwnedObjs().push(e),e._registerObjRefRelations&&e._registerObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(e,this,Kekule.ObjectTreeOperation.ADD),this.notifyOwnedObjsChange())},_removeOwnedObjAt:function(e){var t=this.getOwnedObjAt(e);t&&(this.getOwnedObjs().splice(e,1),t._unregisterObjRefRelations&&t._unregisterObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(t,this,Kekule.ObjectTreeOperation.REMOVE),this.notifyOwnedObjsChange())},_removeOwnedObj:function(e){var t=this.getOwnedObjs().indexOf(e);t>=0&&this._removeOwnedObjAt(t)},_notifyObjTreeOperation:function(e,t,n){for(var i=0,r=this.getOwnedObjCount();i<r;++i){var a=this.getOwnedObjAt(i);a.objTreeOfOwnerUpdated&&a.objTreeOfOwnerUpdated(e,t,n)}},getObjRefRelations:function(){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelations():null},createObjRefRelation:function(e,t,n){return this._enableObjRefRelations?this.getObjRefRelationManager().createRelation(e,t,n):null},modifyObjRefRelation:function(e,t,n){return this._enableObjRefRelations?this.getObjRefRelationManager().modifyRelation(e,t,n):null},getObjRefRelationIndex:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelationIndex(e,t):-1},getObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelation(e,t):null},releaseObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().releaseRelation(e,t):null},findObjRefRelations:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().findRelations(e,t):[]}}),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ChemSpace),Kekule.IntermediateChemSpace=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.IntermediateChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("enableAutoId",!1),this._enableObjRefRelations=!1,this._autoUpdateObjRefRelations=!1}}),Kekule.ChemDocument=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.ChemDocument",initProperties:function(){},getAutoIdPrefix:function(){return"d"}}),Kekule.ObjRefRelationManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ObjRefRelationManager",initialize:function(e){this.tryApplySuper("initialize"),this.setOwner(e),this.setPropStoreFieldValue("relations",[])},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("relations",{dataType:DataType.ARRAY,serializable:!1,setter:null})},createRelation:function(e,t,n){var i={srcObj:e,srcProp:t,dest:n};return this.getRelations().push(i),i},modifyRelation:function(e,t,n){var i=!n||Kekule.ArrayUtils.isArray(n)&&!n.length,r=this.getRelation(e,t);return i?(r&&this.removeRelation(r),null):(r?r.dest=n:r=this.createRelation(e,t,n),r)},getRelationIndex:function(e,t){for(var n=this.getRelations(),i=0,r=n.length;i<r;++i){var a=n[i];if(a.srcObj===e&&a.srcProp===t)return i}return-1},getRelation:function(e,t){var n=this.getRelations(),i=this.getRelationIndex(e,t);return i>=0?n[i]:null},releaseRelation:function(e,t){var n=this.getRelations(),i=this.getRelationIndex(e,t);i>=0&&n.splice(i,1)},removeRelation:function(e){var t=this.getRelations(),n=t.indexOf(e);n>=0&&t.splice(n,1)},findRelations:function(e,t){var n,i=t||{},r=[],a=Object.extend({},e),o=!1;a.dest&&(delete a.dest,o=!0,n=Kekule.ArrayUtils.toArray(e.dest));for(var l=this.getRelations(),u=0,c=l.length;u<c;++u){var d=l[u],h=!1;if((h=Kekule.ObjUtils.match(d,a))&&o){var p=Kekule.ArrayUtils.toArray(d.dest);h=i.checkDestChildren?this._hasChildOrSelfOfParents(p,n):Kekule.ArrayUtils.intersect(p,n).length===n.length}h&&r.push(d)}return r},_hasChildOrSelfOfParents:function(e,t){for(var n=0,i=e.length;n<i;++n)for(var r=e[n],a=0,o=t.length;a<o;++a){var l=t[a];if(r===l||r.isChildOf&&r.isChildOf(l))return!0}return!1}})})(),Kekule.ExceptionHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExceptionHandler",initProperties:function(){this.defineEvent("exceptionThrown")},notifyExceptionThrown:function(s,e){var t={exception:s,level:e};return this.invokeEvent("exceptionThrown",t),t},throwException:function(s,e){var t=Kekule.ExceptionLevel;if(e||(e=t.ERROR),!this.notifyExceptionThrown(s,e||t.ERROR).stop){if(!e||e===t.ERROR){var n=s;throw typeof s=="string"&&(n=new Kekule.Exception(s)),n}if(typeof console<"u"){typeof s!="string"&&(s=s.message);var i=e===t.NOT_FATAL_ERROR?"error":e===t.WARNING?"warn":e===t.NOTE?"info":"log";i?console[i](s):console.log(s)}}},raise:function(s,e){return this.throwException(s,e||Kekule.ExceptionLevel.ERROR)}}),Kekule.ExceptionHandler.getInstance=function(){return this.instance||(this.instance=new Kekule.ExceptionHandler),this.instance},Kekule.exceptionHandler=Kekule.ExceptionHandler.getInstance(),Kekule.Exception=function(s,e){this.message=s,this.name=e},Kekule.Exception.prototype=new Error,Kekule.Exception.prototype.constructor=Kekule.Exception,Object.extend(Kekule.Exception.prototype,{getMessage:function(){return this.message}}),Kekule.Error=function(s,e){this.message=s,this.name=e},Kekule.Error.prototype=Kekule.Exception.prototype,Kekule.Error.prototype.constructor=Kekule.Error,Kekule.ChemError=function(s,e){this.message=s,this.name=e},Kekule.ChemError.prototype=Kekule.Error.prototype,Kekule.ChemError.prototype.constructor=Kekule.ChemError,typeof console>"u"&&(console={log:function(){},warn:function(){},info:function(){},error:function(){}}),Kekule.oneOf=function(){for(var s=arguments,e=Kekule.ObjUtils.notUnset,t=0,n=s.length;t<n;++t)if(e(s[t]))return s[t];return null},Kekule.ClassUtils={getShortClassName:function(s){var e=s.indexOf(".");return e>=0?s.substring(e+1):s},getLastClassName:function(s){var e=s.lastIndexOf(".");return e>=0?s.substring(e+1):s},makeSingleton:function(s){return Object.extend(s,{_instance:null,getInstance:function(e,t,n,i,r,a,o,l,u,c){return s._instance||(s._instance=new s(e,t,n,i,r,a,o,l,u,c)),s._instance}})}},Kekule.NumUtils={isNormalNumber:function(s){return typeof s=="number"&&!isNaN(s)},isInteger:function(s){return typeof s=="number"&&parseInt(s,10)===parseFloat(s)},toDecimals:function(s,e){if(Kekule.NumUtils.isInteger(s))return s.toString();var t=Math.pow(10,e),n=Math.round(s*t);n/=t;var i=parseInt(n),r=(n-i).toString();return r.length>e+2?(r=r.substr(2,e),i.toString()+"."+r):n.toString()},toPrecision:function(s,e,t,n){var i,r=Math.sign(s),a=Math.abs(s),o=Kekule.NumUtils.getDecimalPointPos(a)+1-e;if(o>=0)i=n?Math.round(a):a.toPrecision(e);else{var l=Math.round(a*Math.pow(10,-o)).toString(),u=l.length,c=Math.abs(o);if(i=u===c?"0."+l:u>c?l.substr(0,u-c)+"."+l.substr(u-c):0 .toFixed(c-u)+l,t){for(var d=0,h=i.charAt(i.length-1-d);(h==="0"||h===".")&&(++d,h!==".");)h=i.charAt(i.length-1-d);i=i.substr(0,i.length-d)}}return r<0&&(i="-"+i),i},getDecimalPointPos:function(s){if(Kekule.NumUtils.isFloatEqual(s,0))return 0;for(var e=Math.abs(s),t=e>1?10:.1,n=e>1?1:-1,i=1,r=0;e>1&&i<=e||e<1&&i>e;)i*=t,r+=n;return e>1?r-1:r},getHeadingDigit:function(s){if(Kekule.NumUtils.isFloatEqual(s,0))return 0;var e=Math.abs(s),t=Kekule.NumUtils.getDecimalPointPos(e),n=Math.pow(10,t);return Math.floor(e/n)},isFloatEqual:function(s,e,t){return Kekule.ObjUtils.isUnset(t)&&(t=1e-15*Math.min(Math.abs(s),Math.abs(e))),Math.abs(s-e)<=t},compareFloat:function(s,e,t){return Kekule.NumUtils.isFloatEqual(s,e,t)?0:s<e?-1:1},getPrimes:function(s){var e,t,n=[],i=[];for(e=2;e<=s;++e)if(!n[e])for(i.push(e),t=e<<1;t<=s;t+=e)n[t]=!0;return i}},Kekule.ObjUtils={getPrototypeOf:function(s){return Object.getPrototypeOf?Object.getPrototypeOf(s):s.prototype||s.__proto__},getPropertyDescriptor:function(s,e,t){var n=Object.getOwnPropertyDescriptor;if(n){var i=n(s,e);return!i&&t&&(s.prototype||s.__proto__)&&(i=Kekule.ObjUtils.getPropertyDescriptor(s.prototype||s.__proto__,e,t)),i}return null},getOwnedFieldNames:function(s,e){var t=[];for(var n in s)s.hasOwnProperty(n)&&(e||typeof s[n]!="function")&&t.push(n);return t},replacePropName:function(s,e,t){return s[e]!==void 0&&(s.hasOwnProperty(e)?(s[t]=s[e],delete s[e]):Kekule.raise(Kekule.$L("ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED"))),s},isUnset:function(s){return s==null},notUnset:function(s){return s!=null},equal:function(s,e,t){var n=[];for(var i in s)if(!(t&&t.indexOf(i)>=0)){if(s[i]!==e[i])return!1;n.push(i)}for(var i in e)if(!(t&&t.indexOf(i)>=0)&&n.indexOf(i)<0)return!1;return!0},match:function(s,e){var t=s instanceof ObjectEx;for(var n in e)if(e.hasOwnProperty(n)&&(t?s.getPropValue(n):s[n])!==e[n])return!1;return!0},isInstanceOf:function(s,e){if(DataType.isArrayValue(e)){for(var t=0,n=e.length;t<n;++t)if(s instanceof e[t])return!0;return!1}return s instanceof e},getLeafFieldCascadeNames:function(s,e){var t=function(i,r,a,o){for(var l in a)if(a.hasOwnProperty(l)&&(o||typeof a[l]!="function")){var u=a[l];typeof u=="object"?t(i,r+l+".",u,o):i.push(r+l)}},n=[];return t(n,"",s,e),n}},Kekule.ArrayUtils={isArray:function(s){return!!s&&typeof s=="object"&&s.length!==void 0},toArray:function(s){return Kekule.ArrayUtils.isArray(s)?s:[s]},clone:function(s){return s.slice(0)},filter:function(s,e,t){if(!e)return Kekule.ArrayUtils.clone(s);if(s.filter)return s.filter(e,t);for(var n=[],i=0,r=s.length;i<r;++i){var a=s[i];e.apply(t,[a,i,s])&&n.push(a)}return n},divide:function(s,e){for(var t=[],n=[],i=0,r=0,a=s.length;r<a;++r)n.push(s[r]),++i>=e&&(t.push(n),n=[],i=0);return n.length&&t.push(n),t},pushUnique:function(s,e,t){var n=Kekule.ArrayUtils.pushUniqueEx(s,e,t);return n?n.index:null},pushUniqueEx:function(s,e,t){if(DataType.isArrayValue(e)){for(var n,i=t?Kekule.ArrayUtils._pushUniqueItemEx:Kekule.ArrayUtils.pushUniqueEx,r=0,a=e.length;r<a;++r)Kekule.ObjUtils.isUnset(n)?n=i(s,e[r],t):i(s,e[r],t);return n}return Kekule.ArrayUtils._pushUniqueItemEx(s,e)},_pushUniqueItemEx:function(s,e){if(!e)return{index:-1,isPushed:!1};var t=s.indexOf(e);return t<0?{index:s.push(e),isPushed:!0}:{index:t,isPushed:!1}},insertUnique:function(s,e,t){return Kekule.ArrayUtils.insertUniqueEx(s,e,t).index},insertUniqueEx:function(s,e,t){if(!e)return{index:-1,isInserted:!1};(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=s.length);var n=s.indexOf(e);return n<0?(s.splice(t,0,e),{index:t,isInserted:!0}):n!=t?(s.splice(n,1),s.splice(t,0,e),{index:t,isInserted:!1}):void 0},removeAt:function(s,e){var t=s[e];return t!==void 0?(s.splice(e,1),t):null},remove:function(s,e,t){var n=s.indexOf(e);return n>=0?(Kekule.ArrayUtils.removeAt(s,n),t&&Kekule.ArrayUtils.remove(s,e,t),e):null},replace:function(s,e,t,n){var i=s.indexOf(e);return i>=0?(s[i]=t,n&&Kekule.ArrayUtils.replace(s,e,t,n),e):null},changeIndex:function(s,e,t){if(e>=0&&e<=s.length){var n=s[e];return s.splice(e,1),s.splice(t,0,n),n}return null},changeItemIndex:function(s,e,t){var n=s.indexOf(e);return Kekule.ArrayUtils.changeIndex(s,n,t)},toUnique:function(s){for(var e=[],t=0,n=s.length;t<n;++t){var i=s[t];e.indexOf(i)<0&&e.push(i)}return e},getUniqueElemCount:function(s){return Kekule.ArrayUtils.toUnique(s).length},reverse:function(s){for(var e=[],t=0,n=s.length;t<n;++t)Kekule.ObjUtils.notUnset(s[t])&&(e[n-t-1]=s[t]);return e},randomize:function(s){if(!s)return null;if(!s.length)return[];for(var e=[],t=s.slice(0);t.length>1;){var n=Math.round(Math.random()*(t.length-1));e.push(t.splice(n,1)[0])}return e.push(t[0]),e},exclude:function(s,e){for(var t=[],n=Kekule.ArrayUtils.toArray(e),i=0,r=s.length;i<r;++i){var a=s[i];n.indexOf(a)<0&&t.push(a)}return t},intersect:function(s,e){for(var t=[],n=0,i=s.length;n<i;++n)e.indexOf(s[n])>=0&&t.push(s[n]);return t},flatten:function(s){for(var e=[],t=0,n=s.length;t<n;++t){var i=s[t];if(Kekule.ArrayUtils.isArray(i)){var r=Kekule.ArrayUtils.flatten(i);e=e.concat(r)}else e.push(i)}return e},compare:function(s,e,t){t||(t=function(a,o){return a>o?1:a<o?-1:0});for(var n=Math.min(s.length,e.length),i=0;i<n;++i){var r=t(s[i],e[i]);if(r!==0)return r}return s.length>n?1:e.length>n?-1:0},compareNestedArray:function(s,e,t){var n=Math.min(s.length,e.length);t||(t=function(c,d){return c-d});for(var i=0;i<n;++i){var r=0,a=s[i],o=e[i],l=DataType.isArrayValue(a),u=DataType.isArrayValue(o);if((r=l&&u?Kekule.ArrayUtils.compareNestedArray(a,o,t):l?1:u?-1:t(a,o))!=0)return r}return s.length>n?1:e.length>n?-1:0},group:function(s,e){e||(e=function(u,c){return u<c?-1:u>c?1:0});var t=Kekule.ArrayUtils.clone(s);t.sort(e);for(var n,i=[],r=0,a=t.length;r<a;++r){var o=t[r];if(n&&e(o,n)===0){var l=i.length?i[i.length-1]:null;Kekule.ArrayUtils.isArray(l)||(i.pop(),l=[n],i.push(l)),l.push(o)}else i.push(o);n=o}return i},indexStackOfElem:function(s,e){for(var t=0,n=e.length;t<n;++t){var i=e[t];if(i===s)return[t];if(Kekule.ArrayUtils.isArray(i)){var r=Kekule.ArrayUtils.indexStackOfElem(s,i);if(r)return r.unshift(t),r}}return null},getElemByIndexStack:function(s,e){var t=Kekule.ArrayUtils.isArray(e)?Kekule.ArrayUtils.clone(e):[e],n=s[t.shift()];return n?t.length?Kekule.ArrayUtils.isArray(n)?Kekule.ArrayUtils.getElemByIndexStack(n,t):null:n:null},getMedian:function(s){var e=[].concat(s),t=e.length;return t===0?null:t<=1?e[0]:(e.sort(function(n,i){return n-i}),t%2?e[t+1>>1]:(e[t>>1]+e[(t>>1)-1])/2)},sortHashArray:function(s,e){for(var t=[],n=0,i=e.length;n<i;++n){var r={},a=e[n]||"";a.startsWith("!")?(r.field=a.substr(1),r.desc=!0):(r.field=a,r.desc=!1),t.push(r)}return s.sort(function(o,l){for(var u=0,c=0,d=t.length;c<d;++c){var h=t[c].field,p=o[h]||"",g=l[h]||"";if(u=p>g?1:p<g?-1:0,t[c].desc&&(u=-u),u!==0)break}return u}),s}},Kekule.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(s){return s.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(s){return s.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(s){return""+s},convertToType:function(s,e){if(typeof s!="string")return s;switch(e){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(s);case DataType.INT:return parseInt(s);case DataType.BOOL:return Kekule.StrUtils.strToBool(s);default:return s}},boolToStr:function(s){return s?Kekule.StrUtils.STR_TRUES[0]:Kekule.StrUtils.STR_FALSES[0]},strToBool:function(s){for(var e=s.toLowerCase(),t=0,n=Kekule.StrUtils.STR_FALSES.length;t<n;++t)if(e==Kekule.StrUtils.STR_FALSES[t])return!1;return!!s},removeAroundPair:function(s,e,t){return s.startsWith(e)&&s.endsWith(t)?s.substring(e.length,s.length-e.length-t.length+1):s},unquote:function(s){var e=Kekule.StrUtils.removeAroundPair,t=s;return t=e(t,"'","'"),t=e(t,'"','"')},splitTokens:function(s,e){if(!s)return[];if(DataType.isArrayValue(s))return s;var t=e?new RegExp(e,"g"):/\s+/g;return s.split(t)},hasToken:function(s,e,t){return Kekule.StrUtils.splitTokens(s,t).indexOf(e)>=0},addTokens:function(s,e,t){for(var n=Kekule.StrUtils.splitTokens(s,t),i=Kekule.StrUtils.splitTokens(e,t),r=0,a=i.length;r<a;++r)n.indexOf(i[r])<0&&n.push(i[r]);return n.join(t||" ")},removeTokens:function(s,e,t){for(var n=Kekule.StrUtils.splitTokens(s,t),i=Kekule.StrUtils.splitTokens(e,t),r=0,a=i.length;r<a;++r){var o=n.indexOf(i[r]);o>=0&&n.splice(o,1)}return n.join(t||" ")},toggleTokens:function(s,e,t){for(var n=Kekule.StrUtils.splitTokens(s,t),i=Kekule.StrUtils.splitTokens(e,t),r=[],a=0,o=i.length;a<o;++a){var l=n.indexOf(i[a]);l>=0?n.splice(l,1):r.push(i[a])}return(n=n.concat(r)).join(t||" ")},getLineCount:function(s,e){return e||(e=`
`),s.split(e).length},getMaxLineCharCount:function(s,e){e||(e=`
`);for(var t=s.split(e),n=0,i=0,r=t.length;i<r;++i){var a=t[i];n=Math.max(a.length,n)}return n},isNumbericStr:function(s){var e=Number(s);return!isNaN(e)},splitIndexEndingStr:function(s){for(var e=s.length-1,t=s.charAt(e),n="";t&&Kekule.StrUtils.isNumbericStr(t);)--e,n=t+n,t=s.charAt(e);return n?{prefix:s.substring(0,e+1),index:parseInt(n)}:null}},Kekule.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(s,e){var t={};return e=e||Kekule.RoleMapUtils.NON_EXPLICIT_ROLE,t[Kekule.RoleMapUtils.KEY_ITEM]=s,t[Kekule.RoleMapUtils.KEY_ROLE]=e,t},getItem:function(s){return s[Kekule.RoleMapUtils.KEY_ITEM]},setItem:function(s,e){s[Kekule.RoleMapUtils.KEY_ITEM]=e},getRole:function(s){return s[Kekule.RoleMapUtils.KEY_ROLE]},setRole:function(s,e){s[Kekule.RoleMapUtils.KEY_ROLE]=e}},Kekule.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(s){var e=Kekule.FactoryUtils,t={_items:new Kekule.MapEx(!0),_matchMethod:s||Kekule.FactoryUtils.MATCH_EXACTLY,register:function(n,i){t._items.set(n,i)},unregister:function(n){t._items.remove(n)},getClass:function(n){if(t._matchMethod===e.MATCH_EXACTLY)return t._items.get(n);if(t._matchMethod===e.MATCH_BY_CLASS){var i=t._items.get(n);if(!i){var r=n&&ClassEx.getSuperClass(n);r&&(i=t.getClass(r))}return i}},getInstance:function(n,i,r,a,o,l,u,c,d,h){var p=t.getClass(n);if(p)return new p(i,r,a,o,l,u,c,d,h)}};return t}},Kekule.UrlUtils={PROTOCAL_DELIMITER:"://",EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",HASH_DELIMITER:"#",normalizePath:function(s){return s.replace(/\\/g,"/")},extractProtocal:function(s){if(!s)return null;var e=s.indexOf(Kekule.UrlUtils.PROTOCAL_DELIMITER);return e>=0?s.substr(0,e):""},extractFileName:function(s){if(!s)return null;var e=s.lastIndexOf(Kekule.UrlUtils.PATH_DELIMITER);return e>=0?s.substr(e+1):s},extractFileExt:function(s){var e=Kekule.UrlUtils.extractFileName(s);if(e){var t=e.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);return t>=0?e.substr(t+1):""}return null},extractFileCoreName:function(s){var e=Kekule.UrlUtils.extractFileName(s);if(e){var t=e.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);return t>=0?e.substr(0,t):""}return null},extractSearch:function(s){if(!s)return null;var e=s.lastIndexOf(Kekule.UrlUtils.SEARCH_DELIMITER);return e>=0?s.substr(e):null},analysisSearch:function(s,e){for(var t=Kekule.UrlUtils.extractSearch(s)||"",n=(t=t.substr(1)).split(Kekule.UrlUtils.SEARCH_PAIR_DELIMITER),i=e?{}:[],r=0,a=n.length;r<a;++r){var o=n[r].split(Kekule.UrlUtils.KEY_VALUE_DELIMITER);o[0]&&(e?i[o[0]]=o[1]:i.push({key:o[0],value:o[1]}))}return i},generateSearchString:function(s){for(var e=Kekule.UrlUtils,t=[],n=Kekule.ObjUtils.getOwnedFieldNames(s),i=0,r=n.length;i<r;++i){var a=n[i],o=s[a];Kekule.ObjUtils.notUnset(o)&&(o=encodeURIComponent(""+o),t.push(a+e.KEY_VALUE_DELIMITER+o))}return t.join(e.SEARCH_PAIR_DELIMITER)},generateUrl:function(s,e,t){var n=Kekule.UrlUtils,i=s;if(e){var r=n.generateSearchString(e);i+=n.SEARCH_DELIMITER+r}return t&&(i+=n.HASH_DELIMITER+t),i}},Kekule.MatrixUtils={create:function(s,e,t){var n=!1,i=!1,r=Kekule.ObjUtils;r.notUnset(t)&&(n=!0,Kekule.ArrayUtils.isArray(t)&&(i=!0));for(var a=0,o=new Array(s),l=0,u=o.length;l<u;++l){var c=new Array(e);if(n)for(var d=0,h=c.length;d<h;++d)i&&r.notUnset(t[a])?(c[d]=t[a],++a):c[d]=t;o[l]=c}return o},createIdentity:function(s){for(var e=Kekule.MatrixUtils.create(s,s,0),t=0;t<s-1;++t)e[t][t]=1;return e},getRowCount:function(s){return s.length},getColCount:function(s){return Kekule.MatrixUtils.getRowCount(s)>0?s[0].length:0},getValue:function(s,e,t){return s[e-1][t-1]||0},setValue:function(s,e,t,n){s[e-1][t-1]=n},transpose:function(s){for(var e=Kekule.MatrixUtils,t=e.getColCount(s),n=e.getRowCount(s),i=e.create(t,n),r=1;r<=t;++r)for(var a=i[r-1],o=1;o<=n;++o)a[o-1]=e.getValue(s,o,r);return i},minus:function(s){for(var e=Kekule.MatrixUtils,t=e.getRowCount(s),n=e.getColCount(s),i=this.create(t,n),r=0;r<t;++r)for(var a=i[r],o=s[r],l=0;l<n;++l)a[l]=-(o[l]||0);return i},add:function(s,e){for(var t=Kekule.MatrixUtils,n=t.getRowCount(s),i=t.getColCount(s),r=this.create(n,i),a=1;a<=n;++a)for(var o=1;o<=i;++o)t.setValue(r,a,o,t.getValue(s,a,o)+t.getValue(e,a,o));return r},substract:function(s,e){var t=Kekule.MatrixUtils;return t.add(s,t.minus(e))},multiply:function(s,e){for(var t=Kekule.MatrixUtils,n=t.getRowCount(s),i=t.getColCount(e),r=t.create(n,i),a=1;a<=n;++a)for(var o=1;o<=i;++o){for(var l=0,u=1;u<=n;++u)l+=t.getValue(s,a,u)*t.getValue(e,u,o);t.setValue(r,a,o,l)}return r}},Kekule.CoordUtils={create:function(s,e,t){var n={x:s,y:e};return(t||t===0)&&(n.z=t),n},clone:function(s){var e={x:s.x,y:s.y};return(s.z||s.z===0)&&(e.z=s.z),e},is3D:function(s){return s.z||s.z===0},isEqual:function(s,e){var t=s.x===e.x&&s.y===e.y,n=Kekule.ObjUtils;return t&&(n.notUnset(s.z)||n.notUnset(e.z))&&(t=s.z===e.z),t},isZero:function(s,e){var t=Kekule.ObjUtils.notUnset(e)?e:0;return Math.abs(s.x||0)<=t&&Math.abs(s.y||0)<=t&&Math.abs(s.z||0)<=t},absValue:function(s){if(s){var e={};return Kekule.ObjUtils.isUnset(s.x)||(e.x=Math.abs(s.x)),Kekule.ObjUtils.isUnset(s.y)||(e.y=Math.abs(s.y)),Kekule.ObjUtils.isUnset(s.z)||(e.z=Math.abs(s.z)),e}},add:function(s,e){var t={};return Kekule.ObjUtils.isUnset(s.x)&&Kekule.ObjUtils.isUnset(e.x)||(t.x=(s.x||0)+(e.x||0)),Kekule.ObjUtils.isUnset(s.y)&&Kekule.ObjUtils.isUnset(e.y)||(t.y=(s.y||0)+(e.y||0)),Kekule.ObjUtils.isUnset(s.z)&&Kekule.ObjUtils.isUnset(e.z)||(t.z=(s.z||0)+(e.z||0)),t},substract:function(s,e){var t={};return Kekule.ObjUtils.isUnset(s.x)&&Kekule.ObjUtils.isUnset(e.x)||(t.x=(s.x||0)-(e.x||0)),Kekule.ObjUtils.isUnset(s.y)&&Kekule.ObjUtils.isUnset(e.y)||(t.y=(s.y||0)-(e.y||0)),Kekule.ObjUtils.isUnset(s.z)&&Kekule.ObjUtils.isUnset(e.z)||(t.z=(s.z||0)-(e.z||0)),t},multiply:function(s,e){var t={};return Kekule.ObjUtils.isUnset(s.x)||(t.x=s.x*e),Kekule.ObjUtils.isUnset(s.y)||(t.y=s.y*e),Kekule.ObjUtils.isUnset(s.z)||(t.z=s.z*e),t},divide:function(s,e){return Kekule.CoordUtils.multiply(s,1/e)},standardize:function(s){var e=Math.sqrt(Math.sqr(s.x||0)+Math.sqr(s.y||0)+Math.sqr(s.z||0));return Kekule.CoordUtils.divide(s,e||1)},toArray:function(s){var e=[];e.push(s.x,s.y),Kekule.CoordUtils.is3D(s)&&e.push(s.z)},isSameTransform2DOptions:function(s,e,t){var n=Kekule.ObjUtils.isUnset,i=Kekule.NumUtils.isFloatEqual;t||(t={});var r=t.translate||.01,a=t.scale||.01,o=t.rotate||.01,l=!1,u=s.center,c=e.center;if(l=!(!u||!c)&&i(u.x,c.x,r)&&i(u.y,c.y,r))for(var d=["scale","scaleX","scaleY","rotateAngle","translateX","translateY"],h=0,p=d.length;h<p;++h){var g=d[h],f=s[g],m=e[g];if((!n(f)||!n(m))&&!(l=!n(f)&&!n(m)&&i(f,m,g.indexOf("scale")===0?a:g.indexOf("rotate")===0?o:r)))break}return l},isSameTransform3DOptions:function(s,e,t){var n=Kekule.ObjUtils.isUnset,i=Kekule.NumUtils.isFloatEqual;t||(t={});var r=t.translate||.01,a=t.scale||.01,o=t.rotate||.01,l=!1,u=s.center,c=e.center;if(l=u&&c?i(u.x,c.x,r)&&i(u.y,c.y,r)&&i(u.z,c.z,r):!u&&!c){var d=s.rotateAxisVector,h=e.rotateAxisVector;l=d&&h?i(d.x,h.x,r)&&i(d.y,h.y,r)&&i(d.z,h.z,r):!d&&!h}if(l)for(var p=["scale","scaleX","scaleY","scaleZ","rotateAngle","rotateX","rotateY","rotateZ","translateX","translateY","translateZ"],g=0,f=p.length;g<f;++g){var m=p[g],C=s[m],_=e[m];if((!n(C)||!n(_))&&!(l=!n(C)&&!n(_)&&i(C,_,m.indexOf("scale")===0?a:m.indexOf("rotate")===0?o:r)))break}return l},transform2D:function(s,e){var t=Kekule.CoordUtils.calcTransform2DMatrix(e);return Kekule.CoordUtils.transform2DByMatrix(s,t)},inverseTransform2D:function(s,e){var t=Kekule.CoordUtils.calcInverseTransform2DMatrix(e);return Kekule.CoordUtils.transform2DByMatrix(s,t)},transform2DByMatrix:function(s,e){var t=Kekule.MatrixUtils,n=t.create(3,1,[s.x||0,s.y||0,1]);return{x:(n=t.multiply(e,n))[0][0],y:n[1][0]}},calcTransform2DMatrix:function(s,e){var t=Kekule.MatrixUtils,n=Kekule.ObjUtils.notUnset,i=s||{},r=i.center;if(r)var a=t.create(3,3,[1,0,-(r.x||0),0,1,-(r.y||0),0,0,1]),o=t.create(3,3,[1,0,r.x||0,0,1,r.y||0,0,0,1]);if(i.rotateAngle)var l=i.rotateAngle,u=Math.cos(l),c=Math.sin(l),d=t.create(3,3,[u,-c,0,c,u,0,0,0,1]);var h=i.scale,p=i.scaleX,g=i.scaleY,f=Kekule.oneOf(h,1);if(n(h)||n(p)||n(g)){var m=t.create(3,3);t.setValue(m,1,1,Kekule.oneOf(p,f)),t.setValue(m,2,2,Kekule.oneOf(g,f)),t.setValue(m,3,3,1)}var C=i.translateX,_=i.translateY;if(C||_){var y=t.create(3,3);t.setValue(y,1,1,1),t.setValue(y,2,2,1),t.setValue(y,3,3,1),t.setValue(y,1,3,C||0),t.setValue(y,2,3,_||0)}var T=t.create(3,3,[1,0,0,0,1,0,0,0,1]);return e?(a&&(T=t.multiply(a,T)),y&&(T=t.multiply(y,T)),m&&(T=t.multiply(m,T)),d&&(T=t.multiply(d,T)),o&&(T=t.multiply(o,T))):(a&&(T=t.multiply(a,T)),d&&(T=t.multiply(d,T)),m&&(T=t.multiply(m,T)),y&&(T=t.multiply(y,T)),o&&(T=t.multiply(o,T))),T},calcInverseTransform2DMatrix:function(s){var e=Kekule.ObjUtils.notUnset,t=Object.create(s);return s.center&&(t.center={x:s.center.x,y:s.center.y}),e(t.scale)&&(t.scale=1/t.scale),e(t.scaleX)&&(t.scaleX=1/t.scaleX),e(t.scaleY)&&(t.scaleY=1/t.scaleY),t.translateX&&(t.translateX=-t.translateX),t.translateY&&(t.translateY=-t.translateY),t.rotateAngle&&(t.rotateAngle=-t.rotateAngle),Kekule.CoordUtils.calcTransform2DMatrix(t,!0)},transform3D:function(s,e){var t=Kekule.CoordUtils.calcTransform3DMatrix(e);return Kekule.CoordUtils.transform3DByMatrix(s,t)},transform3DByMatrix:function(s,e){var t=Kekule.MatrixUtils,n=t.create(4,1,[s.x||0,s.y||0,s.z||0,1]);return{x:(n=t.multiply(e,n))[0][0],y:n[1][0],z:n[2][0]}},_calcRotateXYZ3DMatrixCore:function(s){var e=Kekule.MatrixUtils,t=e.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=[];if(s.rotateAngle&&s.rotateAxisVector){var i=Kekule.CoordUtils.standardize(s.rotateAxisVector);n.push({vector:[i.x,i.y,i.z],angle:-s.rotateAngle})}else{var r=s.rotateX,a=s.rotateY,o=s.rotateZ;r&&n.push({vector:[1,0,0],angle:-r}),a&&n.push({vector:[0,1,0],angle:-a}),o&&n.push({vector:[0,0,1],angle:-o})}for(var l=0,u=n.length;l<u;++l){var c,d=e.create(4,4),h=n[l].angle,p=n[l].vector,g=Math.cos(h),f=Math.sin(h);for(l=1;l<=4;++l)for(var m=1;m<=4;++m){if(l<4&&m<4){for(var C=1;C<=3&&(C===l||C===m);++C);var _=p[l-1]*p[m-1];c=l<m?_*(1-g)-Math.pow(-1,l+m)*p[C-1]*f:l>m?_*(1-g)+Math.pow(-1,l+m)*p[C-1]*f:_+(1-_)*g}else c=l===m?1:0;e.setValue(d,l,m,c)}t=e.multiply(d,t)}return t},calcRotate3DMatrix:function(s){var e=Kekule.MatrixUtils,t=Object.create(s||{});if(t.rotateMatrix)a=t.rotateMatrix;else{var n=t.center;if(n)var i=e.create(4,4,[1,0,0,-(n.x||0),0,1,0,-(n.y||0),0,0,1,-(n.z||0),0,0,0,1]),r=e.create(4,4,[1,0,0,n.x||0,0,1,0,n.y||0,0,0,1,n.z||0,0,0,0,1]);var a=Kekule.CoordUtils._calcRotateXYZ3DMatrixCore(s);i&&(a=e.multiply(i,a)),r&&(a=e.multiply(r,a))}return a},calcTransform3DMatrix:function(s){var e=Kekule.ObjUtils.notUnset,t=Kekule.MatrixUtils,n=s||{},i=n.center;if(i)var r=t.create(4,4,[1,0,0,-(i.x||0),0,1,0,-(i.y||0),0,0,1,-(i.z||0),0,0,0,1]),a=t.create(4,4,[1,0,0,i.x||0,0,1,0,i.y||0,0,0,1,i.z||0,0,0,0,1]);var o=Object.copyValues({},n,["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"]),l=Kekule.CoordUtils.calcRotate3DMatrix(o),u=n.scale,c=n.scaleX,d=n.scaleY,h=n.scaleZ;if(e(u)||e(c)||e(d)||e(h)){var p=Kekule.oneOf(u,1),g=t.create(4,4);t.setValue(g,1,1,Kekule.oneOf(c,p)),t.setValue(g,2,2,Kekule.oneOf(d,p)),t.setValue(g,3,3,Kekule.oneOf(h,p)),t.setValue(g,4,4,1)}var f=n.translateX,m=n.translateY,C=n.translateZ;if(f||m||C){var _=t.create(4,4);t.setValue(_,1,1,1),t.setValue(_,2,2,1),t.setValue(_,3,3,1),t.setValue(_,4,4,1),t.setValue(_,1,4,f||0),t.setValue(_,2,4,m||0),t.setValue(_,3,4,C||0)}var y=t.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return r&&(y=t.multiply(r,y)),l&&(y=t.multiply(l,y)),g&&(y=t.multiply(g,y)),_&&(y=t.multiply(_,y)),a&&(y=t.multiply(a,y)),y},calcInverseTransform3DMatrix:function(s){var e=Kekule.ObjUtils.notUnset,t=Object.create(s);return s.center&&(t.center={x:s.center.x,y:s.center.y,z:s.center.z}),e(t.scale)&&(t.scale=1/t.scale),e(t.scaleX)&&(t.scaleX=1/t.scaleX),e(t.scaleY)&&(t.scaleY=1/t.scaleY),e(t.scaleZ)&&(t.scaleZ=1/t.scaleZ),t.translateX&&(t.translateX=-t.translateX),t.translateY&&(t.translateY=-t.translateY),t.translateZ&&(t.translateZ=-t.translateZ),t.rotateAngle&&(t.rotateAngle=-t.rotateAngle),t.rotateX&&(t.rotateX=-t.rotateX),t.rotateX&&(t.rotateY=-t.rotateY),t.rotateZ&&(t.rotateZ=-t.rotateZ),Kekule.CoordUtils.calcTransform3DMatrix(t,!0)},calcCoordGroup2DTransformParams:function(s,e,t,n){var i=Kekule.CoordUtils,r=i.getDistance(s,e),a=i.substract(e,s),o=Math.atan2(a.y,a.x),l=i.getDistance(t,n),u=i.substract(n,t),c=Math.atan2(u.y,u.x),d=i.substract(t,s);return{translateX:d.x,translateY:d.y,scale:l/r,rotateAngle:c-o,center:s}},getDistance:function(s,e){e||(e={x:0,y:0,z:0});var t=Math.sqr(e.x-s.x)+Math.sqr(e.y-s.y);return Kekule.ObjUtils.notUnset(s.z)&&Kekule.ObjUtils.notUnset(e.z)&&(t+=Math.sqr(e.z-s.z)),Math.sqrt(t)},getCenter:function(s){var e=s.length;if(e<=0)return null;for(var t=Object.extend(s[0]),n=1;n<e;++n)t=Kekule.CoordUtils.add(t,s[n]);return Kekule.CoordUtils.divide(t,e)},insideRect:function(s,e,t){return(s.x-e.x)*(s.x-t.x)<=0&&(s.y-e.y)*(s.y-t.y)<=0},isInsideBox:function(s,e){var t=e,n=Math.sign(s.x-t.x1)*Math.sign(s.x-t.x2)<=0&&Math.sign(s.y-t.y1)*Math.sign(s.y-t.y2)<=0;return Kekule.ObjUtils.notUnset(s.z)&&(n=n&&Math.sign(s.z-t.z1)*Math.sign(s.z-t.z2)<=0),n},getContainerBoxCorners:function(s){var e={},t={},n=s.length;if(!(n>0))return null;e=Kekule.CoordUtils.clone(s[0]),t=Kekule.CoordUtils.clone(s[0]);for(var i=1;i<n;++i){var r=s[i];e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),t.x=Math.max(t.x,r.x),t.y=Math.max(t.y,r.y),Kekule.ObjUtils.notUnset(e.z)&&(e.z=Math.min(e.z,r.z),t.z=Math.max(t.z,r.z))}return{min:e,max:t}},getContainerBox:function(s){var e=Kekule.CoordUtils.getContainerBoxCorners(s),t=e.min,n=e.max;return Kekule.BoxUtils.createBox(t,n)}},Kekule.GeometryUtils={standardizeAngle:function(s,e,t){return e=e||0,s-Math.floor((s-e)/Math.PI/2)*Math.PI*2},polarToCartesian:function(s,e,t,n){return{x:s+t*Math.cos(n),y:e+t*Math.sin(n)}},getVectorScalarProduct:function(s,e){return(s.x||0)*(e.x||0)+(s.y||0)*(e.y||0)+(s.z||0)*(e.z||0)},getVectorCrossProduct:function(s,e){return{x:(s.y||0)*(e.z||0)-(s.z||0)*(e.y||0),y:(s.z||0)*(e.x||0)-(s.x||0)*(e.z||0),z:(s.x||0)*(e.y||0)-(s.y||0)*(e.x||0)}},getVectorIncludedAngle:function(s,e){var t=Kekule.CoordUtils,n=Kekule.GeometryUtils.getVectorCrossProduct(s,e),i={x:0,y:0,z:0},r=t.getDistance(s,i)*t.getDistance(e,i),a=t.getDistance(n,i)/r;return Math.asin(a)},getVectorIncludedAngle2:function(s,e){return Kekule.GeometryUtils.standardizeAngle(Math.atan2(e.y,e.x)-Math.atan2(s.y,s.x))},getDihedralAngleOfVectors:function(s,e,t){var n=Kekule.CoordUtils,i=Kekule.GeometryUtils,r=i.getVectorCrossProduct(s,e),a=i.getVectorCrossProduct(e,t),o=n.getDistance(e)/1e5;if(n.isZero(r,o)||n.isZero(a,o))return-1;var l=n.standardize(e),u=i.getVectorScalarProduct(i.getVectorCrossProduct(r,a),l),c=i.getVectorScalarProduct(r,a),d=Math.atan2(u,c);return d<0&&(d+=2*Math.PI),d},getDihedralAngleOfPoints:function(s,e,t,n){var i=Kekule.CoordUtils,r=i.substract(e,s),a=i.substract(t,e),o=i.substract(n,t);return Kekule.GeometryUtils.getDihedralAngleOfVectors(r,a,o)},getPerpendicularCrossPointFromCoordToLine:function(s,e,t,n){var i,r={};if(Math.abs(e.x-t.x)<1e-10)r.x=e.x,r.y=s.y;else{var a=(t.y-e.y)/(t.x-e.x);r.x=(a*a*e.x+a*(s.y-e.y)+s.x)/(a*a+1),r.y=a*(r.x-e.x)+e.y}if(n)i=!0;else{var o={x:e.x-t.x,y:e.y-t.y};i=Math.abs(o.y)>Math.abs(o.x)?Math.sign(r.y-e.y)*Math.sign(r.y-t.y)<=0:Math.sign(r.x-e.x)*Math.sign(r.x-t.x)<=0}return i?r:null},getDistanceFromPointToLine:function(s,e,t,n){var i=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(s,e,t,n);if(i)return Kekule.CoordUtils.getDistance(s,i);var r=Kekule.CoordUtils.getDistance(s,e),a=Kekule.CoordUtils.getDistance(s,t);return Math.min(r,a)},getCrossPointOfLines:function(s,e,t,n){var i=(s.x-t.x)*(e.y-t.y)-(s.y-t.y)*(e.x-t.x),r=(s.x-n.x)*(e.y-n.y)-(s.y-n.y)*(e.x-n.x);if(i*r>=0)return null;var a=(t.x-s.x)*(n.y-s.y)-(t.y-s.y)*(n.x-s.x);if(a*(a+i-r)>=0)return null;var o=a/(r-i),l=o*(e.x-s.x),u=o*(e.y-s.y);return{x:s.x+l,y:s.y+u}},getCrossPointOfVectors:function(s,e){return Kekule.GeometryUtils.getCrossPointOfLines(s[0],s[1],e[0],e[1])},getCrossPointsOfVectorToCircle:function(s,e,t,n){var i=[],r=Kekule.CoordUtils,a=Kekule.NumUtils.isFloatEqual,o=n,l=[r.substract(s[0],e),r.substract(s[1],e)],u=l[1].y-l[0].y,c=l[0].x-l[1].x,d=l[1].x*l[0].y-l[0].x*l[1].y,h=t,p=[],g=4*u*u*d*d-4*(u*u+c*c)*(d*d-h*h*c*c);if(a(g,0,o))p=[-u*d/(u*u+c*c)];else if(g<0)p=[];else{var f=Math.sqrt(g);p=[(-2*u*d+f)/(2*(u*u+c*c)),(-2*u*d-f)/(2*(u*u+c*c))]}if(p&&p.length){var m=[];if(p.length===1&&a(c,0,o)){var C=Math.sqrt(h*h-p[0]*p[0]);a(C,0,o)?m=[0]:(m[0]=C,m[1]=-C,p[1]=p[0])}else for(var _=0,y=p.length;_<y;++_)m[_]=-(u*p[_]+d)/c;for(_=0,y=p.length;_<y;++_){var T=(p[_]-l[0].x)*(p[_]-l[1].x),E=(m[_]-l[0].y)*(m[_]-l[1].y);(a(u,0,o)&&T<=0||a(c,0,o)&&E<=0||T<=0&&E<=0)&&i.push(r.add({x:p[_],y:m[_]},e))}}return i},getCrossPointsOfCircles:function(s,e,t,n,i){if(Kekule.CoordUtils.getDistance(s,t)>e+n)return[];for(var r=e,a=n,o=s.x,l=t.x,u=s.y,c=t.y,d=(r*r-a*a+(l*l-o*o)+(c*c-u*u))/(2*(c-u)),h=(l-o)/(c-u),p=1+h*h,g=-(2*o+2*(d-u)*h),f=o*o+Math.sqr(d-u)-r*r,m=Math.sqrt(g*g-4*p*f),C=2*p,_=Kekule.NumUtils.isFloatEqual(m,0,i)?[-g]:[(-g+m)/C,(-g-m)/C],y=[],T=[],E=0,b=_.length;E<b;++E)y[E]=d-h*_[E],T.push({x:_[E],y:y[E]});return T},clipLineSegmentByBox:function(s,e){for(var t=e[0].x,n=e[0].y,i=e[1].x,r=e[1].y,a=s[0].x,o=s[0].y,l=s[1].x,u=s[1].y,c=function(_){var y=0;return _.x<t?y|=1:_.x>i&&(y|=2),_.y<n?y|=4:_.y>r&&(y|=8),y},d=c(s[0]),h=c(s[1]),p=!1;;){if(!(d|h)){p=!0;break}if(d&h){p=!1;break}var g,f,m=d||h;8&m?(g=a+(l-a)*(r-o)/(u-o),f=r):4&m?(g=a+(l-a)*(n-o)/(u-o),f=n):2&m?(f=o+(u-o)*(i-a)/(l-a),g=i):1&m&&(f=o+(u-o)*(t-a)/(l-a),g=t),m===d?(o=f,d=c(a=g)):(u=f,h=c(l=g))}if(p){var C=Kekule.CoordUtils.create;return[C(a,o),C(l,u)]}return null},simplifyCurveToLineSegments:function(s,e){return e?s.length<=2?Kekule.ArrayUtils.clone(s):Kekule.GeometryUtils._simplifyCurvePartToLineSegments(s,0,s.length-1,e):s},_simplifyCurvePartToLineSegments:function(s,e,t,n){var i=Kekule.GeometryUtils,r=s[e],a=s[t];if(t-e<=1)return[r,a];for(var o=n,l=null,u=e+1;u<t;++u){var c=Kekule.GeometryUtils.getDistanceFromPointToLine(s[u],r,a);c>o&&(o=c,l=u)}if(l===null)return[r,a];var d=i._simplifyCurvePartToLineSegments(s,e,l,n),h=i._simplifyCurvePartToLineSegments(s,l,t,n);return h.shift(),[].concat(d).concat(h)}},Kekule.IntersectionState={EQUAL:0,CONTAINING:1,CONTAINED:2,OVERLAPPED:3,SEPARATED:4},Kekule.BoxUtils={createBox:function(s,e){var t={},n=s.x||0,i=s.y||0,r=e.x||0,a=e.y||0;return n<=r?(t.x1=n,t.x2=r):(t.x1=r,t.x2=n),i<=a?(t.y1=i,t.y2=a):(t.y1=a,t.y2=i),Kekule.ObjUtils.notUnset(s.z)&&Kekule.ObjUtils.notUnset(e.z)&&(s.z<=e.z?(t.z1=s.z,t.z2=e.z):(t.z1=e.z,t.z2=s.z)),t},clone:function(s){var e={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2};return Kekule.ObjUtils.notUnset(s.z1)&&Kekule.ObjUtils.notUnset(s.z2)&&(e.z1=s.z1,e.z2=s.z2),e},convertToRect:function(s){var e=Kekule.BoxUtils.normalize(s);return Kekule.RectUtils.createRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1)},normalize:function(s){var e={x1:Math.min(s.x1,s.x2),y1:Math.min(s.y1,s.y2),x2:Math.max(s.x1,s.x2),y2:Math.max(s.y1,s.y2)};return Kekule.ObjUtils.notUnset(s.z1)&&Kekule.ObjUtils.notUnset(s.z2)&&(e.z1=Math.min(s.z1,s.z2),e.z2=Math.max(s.z1,s.z2)),e},shiftBox:function(s,e,t,n){var i=e||0,r=t||0,a=n||0,o={x:s.x1+i,y:s.y1+r},l={x:s.x2+i,y:s.y2+r};return Kekule.ObjUtils.notUnset(s.z1)&&Kekule.ObjUtils.notUnset(s.z2)&&(o.z=s.z1+a,l.z=s.z2+a),Kekule.BoxUtils.createBox(o,l)},inflateBox:function(s,e,t,n){Kekule.ObjUtils.isUnset(t)&&(t=e),Kekule.ObjUtils.isUnset(n)&&(n=e);var i={x1:(i=Kekule.BoxUtils.normalize(s)).x1-e,y1:i.y1-t,x2:i.x2+e,y2:i.y2+t};return Kekule.ObjUtils.notUnset(i.z1)&&Kekule.ObjUtils.notUnset(i.z2)&&(i.z1=i.z1-n,i.z2=i.z2+n),i},getContainerBox:function(s,e){if(!s)return Kekule.BoxUtils.clone(e);if(!e)return Kekule.BoxUtils.clone(s);var t=Kekule.BoxUtils.normalize(s),n=Kekule.BoxUtils.normalize(e),i={x1:Math.min(t.x1,n.x1),y1:Math.min(t.y1,n.y1),x2:Math.max(t.x2,n.x2),y2:Math.max(t.y2,n.y2)};return Kekule.ObjUtils.notUnset(t.z1)&&Kekule.ObjUtils.notUnset(t.z2)&&Kekule.ObjUtils.notUnset(n.z1)&&Kekule.ObjUtils.notUnset(n.z2)&&(i.z1=Math.min(t.z1,n.z1),i.z2=Math.max(t.z2,n.z2)),i},getIntersection:function(s,e){var t=Kekule.BoxUtils.normalize(s),n=Kekule.BoxUtils.normalize(e),i={x1:Math.max(t.x1,n.x1),y1:Math.max(t.y1,n.y1),x2:Math.min(t.x2,n.x2),y2:Math.min(t.y2,n.y2)};return i.x1>i.x2||i.y1>i.y2||Kekule.ObjUtils.notUnset(t.z1)&&Kekule.ObjUtils.notUnset(t.z2)&&Kekule.ObjUtils.notUnset(n.z1)&&Kekule.ObjUtils.notUnset(n.z2)&&(i.z1=Math.max(t.z1,n.z1),i.z2=Math.min(t.z2,n.z2),i.z1>i.z2)?null:i},hasIntersection:function(s,e){return!!Kekule.BoxUtils.getIntersection(s,e)},isEqual:function(s,e){return Math.min(s.x1,s.x2)===Math.min(e.x1,e.x2)&&Math.max(s.x1,s.x2)===Math.max(e.x1,e.x2)&&Math.min(s.y1,s.y2)===Math.min(e.y1,e.y2)&&Math.max(s.y1,s.y2)===Math.max(e.y1,e.y2)},isInside:function(s,e){var t=s,n=e;return Math.min(t.x1,t.x2)>=Math.min(n.x1,n.x2)&&Math.max(t.x1,t.x2)<=Math.max(n.x1,n.x2)&&Math.min(t.y1,t.y2)>=Math.min(n.y1,n.y2)&&Math.max(t.y1,t.y2)<=Math.max(n.y1,n.y2)},getIntersectionState:function(s,e){var t=Kekule.BoxUtils,n=Kekule.IntersectionState;return t.isEqual(s,e)?n.EQUAL:t.isInside(s,e)?n.CONTAINED:t.isInside(e,s)?n.CONTAINING:t.hasIntersection(s,e)?n.OVERLAPPED:n.SEPARATED},getCenterCoord:function(s){var e={x:((s.x1||0)+(s.x2||0))/2,y:((s.y1||0)+(s.y2||0))/2};return(Kekule.ObjUtils.notUnset(s.z1)||Kekule.ObjUtils.notUnset(s.z2))&&(e.z=(s.z1||0+s.z2||0)/2),e},getMinMaxCoords:function(s){var e=Kekule.BoxUtils.normalize(s),t={min:{x:e.x1,y:e.y1},max:{x:e.x2,y:e.y2}};return Kekule.ObjUtils.notUnset(e.z1)&&(t.min.z=e.z1,t.max.z=e.z2),t},getCornerCoords:function(s){var e=Kekule.BoxUtils.normalize(s);return Kekule.ObjUtils.isUnset(e.z1)?[{x:e.x1,y:e.y1},{x:e.x1,y:e.y2},{x:e.x2,y:e.y1},{x:e.x2,y:e.y2}]:[{x:e.x1,y:e.y1,z:e.z1},{x:e.x1,y:e.y2,z:e.z1},{x:e.x2,y:e.y1,z:e.z1},{x:e.x2,y:e.y2,z:e.z1},{x:e.x1,y:e.y1,z:e.z2},{x:e.x1,y:e.y2,z:e.z2},{x:e.x2,y:e.y1,z:e.z2},{x:e.x2,y:e.y2,z:e.z2}]},transform2D:function(s,e){for(var t=Kekule.BoxUtils.getCornerCoords(s),n=[],i=0,r=t.length;i<r;++i)n.push(Kekule.CoordUtils.transform2D(t[i],e));return Kekule.CoordUtils.getContainerBox(n)},transform3D:function(s,e){for(var t=Kekule.BoxUtils.getCornerCoords(s),n=[],i=0,r=t.length;i<r;++i)n.push(Kekule.CoordUtils.transform3D(t[i],e));return Kekule.CoordUtils.getContainerBox(n)}},Kekule.RectUtils={createRect:function(s,e,t,n){return{left:s,top:e,width:t,height:n}},clone:function(s){return{left:s.left,top:s.top,width:s.width,height:s.height}},isZero:function(s){return s.width===0&&s.height===0},convertToBox:function(s){var e=Kekule.CoordUtils.create(s.left,s.top),t=Kekule.CoordUtils.create(s.left+s.width,s.top+s.height);return Kekule.BoxUtils.createBox(e,t)},inflateRect:function(s,e,t){return Kekule.ObjUtils.isUnset(t)&&(t=e),Kekule.RectUtils.createRect(s.left,s.top,s.width+e,s.height+t)},shiftRect:function(s,e,t){var n=e||0,i=t||0;return Kekule.RectUtils.createRect(s.left+n,s.top+i,s.width,s.height)},getContainerRect:function(s,e){var t=Kekule.RectUtils.convertToBox(s),n=Kekule.RectUtils.convertToBox(e),i=Kekule.BoxUtils.getContainerBox(t,n);return Kekule.BoxUtils.convertToRect(i)},getIntersection:function(s,e){var t=Kekule.RectUtils.convertToBox(s),n=Kekule.RectUtils.convertToBox(e),i=Kekule.BoxUtils.getIntersection(t,n);return i?Kekule.BoxUtils.convertToRect(i):null},hasIntersection:function(s,e){return!!Kekule.RectUtils.getIntersection(s,e)}},Kekule.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[.1,.3,.5,.66,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],RATIO_INT_BASE:100,getNearestZoomLevel:function(s,e){var t=e||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,n=t.length;if(s>t[n-1])return t[n-1];if(s<t[0])return t[0];for(var i=0;i<n-1;++i){var r=t[i],a=t[i+1];if(s>=r&&s<=a)return r===1||a===1?1:(s-r)/(a-r)<=.5?r:a}},getNextZoomInRatio:function(s,e,t){e||(e=1);var n=t||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,i=n.length,r=Math.round(s*Kekule.ZoomUtils.RATIO_INT_BASE);if(r<Math.round(n[i-1]*Kekule.ZoomUtils.RATIO_INT_BASE)){for(var a=0;a<i;++a)if(Math.round(n[a]*Kekule.ZoomUtils.RATIO_INT_BASE)>r)return n[Math.min(a+e,i)-1]}return s},getNextZoomOutRatio:function(s,e,t){e||(e=1);var n=t||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,i=n.length,r=Math.round(s*Kekule.ZoomUtils.RATIO_INT_BASE);if(r>Math.round(n[0]*Kekule.ZoomUtils.RATIO_INT_BASE)){for(var a=i-1;a>=0;--a)if(Math.round(n[a]*Kekule.ZoomUtils.RATIO_INT_BASE)<r)return n[Math.max(a-e+1,0)]}return s}},Kekule.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",XMLNS_URI:"http://www.w3.org/2000/xmlns/",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function(s){this.tryApplySuper("initialize"),this._supportNsMethods=null,s&&this.setDocument(s)},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var s=this.getPropStoreFieldValue("document");if(!s){var e=this.getPropStoreFieldValue("rootElement");s=e?e.ownerDocument:null}return s},setter:function(s){s!=this.getPropStoreFieldValue("document")&&(this.setPropStoreFieldValue("document",s),this.analysisRootElem())}}),this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var s=this.getPropStoreFieldValue("rootElement");if(!s){var e=this.getPropStoreFieldValue("document");s=e?e.documentElement:null}return s},setter:function(s){this.setPropStoreFieldValue("rootElement",s),this.analysisRootElem()}}),this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("namespaces")||this.setPropStoreFieldValue("namespaces",[]),this.getPropStoreFieldValue("namespaces")}}),this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:!1}),this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]),this.setDefNamespaceURI(null);var s=this.getRootElement();if(s){var e=s.ownerDocument;if(this._supportNsMethods=!!e.getElementsByTagNameNS,!this._supportNsMethods||this.getForceAnalysisDoc())for(var t=0,n=s.attributes.length;t<n;++t){var i=s.attributes[t],r=i.name;if(r&&r.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var a=i.value,o=r.indexOf(this.NAMESPACE_DELIMITER),l=o>=0?r.substring(o+1):null;this.getNamespaces().push({namespaceURI:a,prefix:l}),l||this.setDefNamespaceURI(a)}}}},_getEmptyDocErrorMsg:function(){return Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.EMPTY_DOC"):this.ERR_EMPTY_DOC},_getElementNotSetErrorMsg:function(){return Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.ELEMENT_NOTSET"):this.ELEMENT_NOTSET},assertDocAvailable:function(s){return!!s||(Kekule.raise(this._getEmptyDocErrorMsg()),!1)},assertElementAvailable:function(s){return!!s||(Kekule.raise(this._getElementNotSetErrorMsg()),!1)},getNsPrefix:function(s){if(s==this.getDefNamespaceURI())return"";for(var e=this.getNamespaces(),t=0,n=e.length;t<n;++t)if(e[t].namespaceURI==s)return e[t].prefix;return null},getQualifiedName:function(s,e){var t=this.getNsPrefix(s);return t===null?null:t?t+this.NAMESPACE_DELIMITER+e:e},addNamespace:function(s,e,t,n){n||(n=s.documentElement);var i=e?this.NAMESPACE_DEFINE_PREFIX+this.NAMESPACE_DELIMITER+e:this.NAMESPACE_DEFINE_PREFIX,r=this.XMLNS_URI;this.setAttributeNS(r,i,t,n)},createElementNS:function(s,e){var t=this.getDocument();return this.assertDocAvailable(t)?this._supportNsMethods?t.createElementNS(s,e):t.createElement(e):null},getElementsByTagNameNS:function(s,e,t){var n=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement"),i=this.getDocument();if(!this.assertDocAvailable(i))return null;if(this._supportNsMethods)return s||(s="*"),t?t.getElementsByTagNameNS(s,e):n.getElementsByTagNameNS(s,e);var r=this.getQualifiedName(s,e);return r===null?[]:t?t.getElementsByTagName(r):n.getElementsByTagName(r)},getAttributeNodeNS:function(s,e,t){if(!this.assertElementAvailable(t))return null;if(this._supportNsMethods)return s||(s="*"),t.getAttributeNodeNS(s,e);var n=this.getQualifiedName(s,e);return n===null?null:t.getAttributeNode(n)},getAttributeNS:function(s,e,t){if(!this.assertElementAvailable(t))return null;if(this._supportNsMethods)return s||(s="*"),t.getAttributeNS(s,e);var n=this.getQualifiedName(s,e);return n===null?null:t.getAttribute(n)},setAttributeNS:function(s,e,t,n){if(!this.assertElementAvailable(n))return null;if(this._supportNsMethods)return n.setAttributeNS(s,e,t);var i=this.getQualifiedName(s,e);return i===null?null:n.setAttribute(i,t)}}),Kekule.DomUtils={namespaceMatched:function(s,e,t){return t===void 0&&(t=!0),s.namespaceURI==e||t&&!s.namespaceURI},isElement:function(s){return s&&s.tagName&&s.nodeType},getElementText:function(s){for(var e="",t=0,n=s.childNodes.length;t<n;++t)s.childNodes[t].nodeType==3&&(e+=s.childNodes[t].nodeValue);return e},setElementText:function(s,e,t){for(var n=0,i=s.childNodes.length;n<i;++n)if(s.childNodes[n].nodeType==3)return s.childNodes[n].nodeValue=e,e;var r=t?(e||"").split(`
`):[e||""];for(n=0,i=r.length;n<i;++n){if(n>0){var a=s.ownerDocument.createElement("br");s.appendChild(a)}var o=s.ownerDocument.createTextNode(r[n]);s.appendChild(o)}return e},getLocalName:function(s){return s.localName||s.baseName||s.nodeName},getChildNodesOfTypes:function(s,e){for(var t=[],n=Kekule.ArrayUtils.toArray(e),i=0,r=s.childNodes.length;i<r;++i){var a=s.childNodes[i];(!e||n.indexOf(a.nodeType)>=0)&&t.push(a)}return t},getFirstChildElem:function(s,e,t,n){for(var i=0,r=s.childNodes.length;i<r;++i){var a=s.childNodes[i];if(a.nodeType===Node.ELEMENT_NODE&&(e&&e.toLowerCase()===a.tagName.toLowerCase()||t&&t.toLowerCase()===Kekule.DomUtils.getLocalName(a).toLowerCase()||!e&&!t)&&(!n||Kekule.DomUtils.namespaceMatched(a,n)))return a}},getDirectChildElems:function(s,e,t,n){for(var i=[],r=0,a=s.childNodes.length;r<a;++r){var o=s.childNodes[r];o.nodeType===Node.ELEMENT_NODE&&(e&&e.toLowerCase()===o.tagName.toLowerCase()||t&&t.toLowerCase()===Kekule.DomUtils.getLocalName(o).toLowerCase()||!e&&!t)&&(n&&!Kekule.DomUtils.namespaceMatched(o,n)||i.push(o))}return i},getDirectChildElemsOfAttribValues:function(s,e,t,n,i){for(var r=Kekule.DomUtils.getDirectChildElems(s,t,n,i),a=[],o=0,l=r.length;o<l;++o){for(var u=!0,c=0,d=e.length;c<d;++c){var h=Kekule.ObjUtils.getOwnedFieldNames(e[c])[0];if(r[o].getAttribute(h)!=e[c][h]){u=!1;break}}u&&a.push(r[o])}return a},getParentNode:function(s,e){var t=e||{},n=s.parentNode;return n||(t.acrossShadowRoot&&s.host?s.host:null)},isDescendantOf:function(s,e,t){var n=t||{};try{if(s&&e){if(s.documentElement)return!1;if(s.ownerDocument===e)return!0;for(var i=Kekule.DomUtils.getParentNode,r=i(s,n);r;){if(r===e)return!0;r=i(r,n)}}return!1}catch{return!1}},isOrIsDescendantOf:function(s,e,t){return s===e||Kekule.DomUtils.isDescendantOf(s,e,t)},getNearestAncestorByTagName:function(s,e,t){var n=e.toLowerCase();if(t&&s.tagName&&s.tagName.toLowerCase()===n)return s;for(var i=s.parentNode;i&&i.tagName;){if(i.tagName.toLowerCase()===n)return i;i=i.parentNode}return null},getSameNSAttributeValue:function(s,e,t){return s.getAttribute(e)},setSameNSAttributeValue:function(s,e,t,n){return s.setAttribute(e,t)},fetchAttributeValuesToArray:function(s,e,t){for(var n=[],i=0,r=s.attributes.length;i<r;++i){var a=s.attributes[i];if(!e||Kekule.DomUtils.namespaceMatched(a,e,!0)){var o;if(t)try{o=Kekule.DomUtils.getLocalName(a)}catch{o=a.name}else o=a.name;n.push({name:o,value:a.value})}}return n},fetchAttributeValuesToJson:function(s,e,t){for(var n={},i=0,r=s.attributes.length;i<r;++i){var a=s.attributes[i];if(!e||Kekule.DomUtils.namespaceMatched(a,e,!0)){var o;if(t)try{o=Kekule.DomUtils.getLocalName(a)}catch{o=a.name}else o=a.name;n[o]=a.value}}return n},hasAttribute:function(s,e){return s.hasAttribute?s.hasAttribute(e):!!s.getAttribute(e)},isDataAttribName:function(s){return s.toString().startsWith("data-")},getDataAttribCoreName:function(s){return Kekule.DomUtils.isDataAttribName(s)?s.substr(5):null},getDataAttrib:function(s,e){return s.dataset?s.dataset[e]:s.getAttribute("data-"+e.toString().hyphenize())},setDataAttrib:function(s,e,t){s.dataset?s.dataset[e]=t:s.setAttribute("data-"+e.toString().hyphenize(),t)},getDataset:function(s){if(s.dataset)return s.dataset;for(var e={},t=s.attributes,n=0,i=t.length;n<i;++n){var r=t[n],a=r.name;a.toLowerCase().indexOf("data-")===0&&(e[a.substring(5).camelize()]=r.value)}return e},clearChildContent:function(s){for(var e=Kekule.ArrayUtils.toArray(s.childNodes),t=e.length-1;t>=0;--t){var n=e[t];n.nodeType!==Node.ATTRIBUTE_NODE&&s.removeChild(n)}return s},replaceTagName:function(s,e){if(s.tagName.toLowerCase()!==e.toLowerCase()){for(var t=s.ownerDocument.createElement(e),n=Kekule.DomUtils.fetchAttributeValuesToArray(s),i=0,r=n.length;i<r;++i)t.setAttribute(n[i].name,n[i].value);var a=Kekule.DomUtils.getDirectChildElems(s);for(i=0,r=a.length;i<r;++i)t.appendChild(a[i]);var o=s.parentNode,l=s.nextSibling;return o.removeChild(s),l?o.insertBefore(t,l):o.appendChild(t),t}return s},setElemAttributes:function(s,e){for(var t=Kekule.ObjUtils.getOwnedFieldNames(e),n=0,i=t.length;n<i;++n){var r=t[n],a=e[r];r&&a&&s.setAttribute(r,a)}return s},isInDomTree:function(s,e,t){var n=t||{};if(!s)return!1;if(e||(e=s.ownerDocument),e){if(!n.acrossShadowRoot&&s.getRootNode)return s.getRootNode()===e;var i=e.documentElement;return Kekule.DomUtils.isDescendantOf(s,i,t)||s===i}return!1},isInShadowRoot:function(s){if(typeof ShadowRoot>"u")return!1;try{return(s.getRootNode&&s.getRootNode())instanceof ShadowRoot}catch{return!1}}},Kekule.DataSrcAttribUtils={isUrlBasedValue:function(s){return s.toLowerCase().indexOf("url(")===0},getUrl:function(s){var e=s.trim();if(e.toLowerCase().indexOf("url(")===0){var t=e.lastIndexOf(")");return e=e.substring(4,t)}return null},getElementContent:function(s){if(!s)return null;var e=s.innerHTML;return e=e.ltrim()},getElementMimeType:function(s){return s.getAttribute("type")}},Kekule.ScriptFileUtils={_existedScriptUrls:new Kekule.MapEx,appendScriptFile:function(s,e,t){var n;if(s){if((n=Kekule.ScriptFileUtils._existedScriptUrls.get(s))||(n=[],Kekule.ScriptFileUtils._existedScriptUrls.set(s,n)),n.indexOf(e)>=0)return void(t&&t(null));var i=s.createElement("script");return i.src=e,i.onerror=function(a){t&&t(a)},i.onload=i.onreadystatechange=function(a){if(!i._loaded){var o=i.readyState;o!==void 0&&o!=="loaded"&&o!=="complete"||(i._loaded=!0,i.onload=i.onreadystatechange=null,n.push(e),t&&t(null))}},(s.getElementsByTagName("head")[0]||s.body).appendChild(i),i}var r=Kekule.$jsRoot.__$kekule_scriptfile_utils__;if(r&&r.appendScriptFile)return r.appendScriptFile(s,e,t)},appendScriptFiles:function(s,e,t){var n=[].concat(e),i=function(r,a,o,l){if(a.length<=0)o&&(l.length?o(new Error("Error in loading: "+l.join("; "))):o(null));else{var u=a.shift();Kekule.ScriptFileUtils.appendScriptFile(r,u,function(c){c&&l.push(u+": "+c?c.message||c:""),i(r,a,o,l)})}};i(s,n,t,[])}},Kekule.ExternalResourceType={JS_OBJ:"jsObject",STYLESHEET:"stylesheet",DATA:"data",OTHER:"other"},Kekule.ExternalResourceType.DEFAULT=Kekule.ExternalResourceType.JS_OBJ,Kekule.ExternalResourceManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExternalResourceManager",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("resources",{})},doFinalize:function(){this.setPropStoreFieldValue("resources",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("resources",{dataType:DataType.HASH,serializable:!1,setter:null})},register:function(s,e,t,n){var i=this.getResources();i[s]&&this.unregister(s),i[s]={name:s,resource:e,resourceType:t||Kekule.ExternalResourceType.DEFAULT},this.invokeEvent("resourceRegistered",{name:s,resource:e,resourceType:t}),this.invokeEvent(s+"Registered",{name:s,resource:e,resourceType:t})},unregister:function(s){var e=this.getResources();if(e[s]){var t=e[s];this.invokeEvent("resourceUnregistered",t),this.invokeEvent(s+"Unregistered",t),delete e[s]}},getResourceDetails:function(s){return this.getResources()[s]},getResource:function(s){var e=this.getResourceDetails(s);return e&&e.resource}}),Kekule.ClassUtils.makeSingleton(Kekule.ExternalResourceManager),Kekule.externalResourceManager=Kekule.ExternalResourceManager.getInstance(),function(){Kekule.Unit={ALL:{},_KEY_MAP:{},register:function(t,n,i,r,a){var o=s[i];o||(o=s._createCategoryObj(i),s[i]=o);var l=n.toUpperCase();return o[l]=s._createUnitObj(t,n,o,r,a),r===1&&o.setStandardUnit(o[l]),s.ALL[l]=o[l],s._KEY_MAP[o[l].getKey()]=o[l],o[l]},unregister:function(t){var n=s.getUnit(t);if(n){var i=n.getKey().toUpperCase();delete s.ALL[i],delete s._KEY_MAP[i],delete n.category[i]}},getUnit:function(t,n){if(typeof t=="object")return t.getKey?t:null;var i=s._KEY_MAP[t];if(!i&&n){for(var r=t.toLowerCase(),a=Kekule.ObjUtils.getOwnedFieldNames(s._KEY_MAP),o=0,l=a.length;o<l;++o)if(r===a[o].toLowerCase()){i=s._KEY_MAP[a[o]];break}}return i},getUnitByName:function(t,n){for(var i=Kekule.ObjUtils.getOwnedFieldNames(s._KEY_MAP),r=n&&t.toLowerCase(),a=0,o=i.length;a<o;++a){var l=s._KEY_MAP[i[a]],u=l.name;if(t===u||n&&r===u.toLowerCase())return l}return null},_createCategoryObj:function(t){var n=Object.create(s._categoryObjProto);return n.name=t,n},_createUnitObj:function(t,n,i,r,a){var o=Object.create(Kekule.Unit._unitObjProto);return Object.extend(o,{symbol:t,name:n,category:i,rateToStandard:r}),a&&Object.extend(o,a),o}};var s=Kekule.Unit;Kekule.Unit._categoryObjProto={getName:function(){return this.name},getStandardUnit:function(){return this._standardUnit},setStandardUnit:function(t){this._standardUnit=t},getUnitsOf:function(t){for(var n=Kekule.ObjUtils.getOwnedFieldNames(this,!1),i=[],r=0,a=n.length;r<a;++r)if(n[r]!=="_standardUnit"){var o=this[n[r]];Kekule.ObjUtils.getPrototypeOf(o)!==Kekule.Unit._unitObjProto||t&&!t(o)||i.push(o)}return i},getAllUnits:function(){return this.getUnitsOf()},getConvertableUnits:function(){return this.getUnitsOf(function(t){return!!t.rateToStandard})}},Kekule.Unit._unitObjProto={getKey:function(){return this.symbol||this.name},isStandard:function(){return this.rateToStandard===1},canConvertValueTo:function(t,n){return t.category===this.category},convertValueTo:function(t,n,i){var r=typeof n=="string"?s.getUnit(n):n;if(r)return this.doConvertValueTo(t,r,i);Kekule.error(Kekule.$L("ErrorMsg.UNIT_NOT_FOUND").format(n.symbol||n.name||n))},convertValueFromStandard:function(t,n){var i=this.category.getStandardUnit();if(i)return this._convFromStandard?this._convFromStandard(t,n):i.convertValueTo(t,this,n);Kekule.error(Kekule.$L("ErrorMsg.STANDARD_UNIT_OF_CATEGORY_NOT_FOUND").format(this.category.name))},convertValueToStandard:function(t,n){return this.convertValueToStandardEx(t,n).value},convertValueToStandardEx:function(t,n){var i=this.category.getStandardUnit();if(i)return{value:this._convToStandard?this._convToStandard(t,n):this.convertValueTo(t,i,n),unit:i};Kekule.error(Kekule.$L("ErrorMsg.STANDARD_UNIT_OF_CATEGORY_NOT_FOUND").format(this.category.name))},doConvertValueTo:function(t,n,i){if(n===this)return t;if(this.canConvertValueTo(n,i)){var r=n.rateToStandard,a=this.rateToStandard;if(r&&a)return t*a/r;var o=a||this._convToStandard,l=r||n._convFromStandard;if(o&&l){var u=this.convertValueToStandard(t,i);return n.convertValueFromStandard(u,i)}Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),n.getKey()))}else Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),n.getKey()))}},Kekule.UnitUtils={convertValue:function(t,n,i,r){return s.getUnit(n).convertValueTo(t,i,r)}};var e=s.register;e("unk","Unknown","Unknown",null),e("","counts","Counts",1),e("arb","arbitrary","Arbitrary",null),e("","one","Dimensionless",1),e("%","percent","Dimensionless",.01),e("‰","thousandth","Dimensionless",.001),e("ppm","parts_per_million","Dimensionless",1e-6),e("pH","pH","AcidicScake",1),e("sec","second","Time",1),e("hr","hour","Time",3600),e("min","minute","Time",60),e("ms","millisecond","Time",.001),e("μs","microsecond","Time",1e-6),e("ns","nanosecond","Time",1e-9),e("m","meter","Length",1),e("cm","centimeter","Length",.01),e("mm","millimeter","Length",.001),e("μm","micrometer","Length",1e-6),e("nm","nanometer","Length",1e-9),e("Å","Angstrom","Length",1e-10),e("A-1","Angstrom-1","InverseLength",1e10,{symbolHtml:"A<sup>-1</sup>"}),e("A","ampere","ElectricCurrent",1),e("μA","microampere","ElectricCurrent",1e-6),e("nA","nanoampere","ElectricCurrent",1e-9),e("pA","picoampere","ElectricCurrent",1e-12),e("kg","kilogram","Mass",1),e("g","gram","Mass",.001),e("K","kelvin","Temperature",1),e("℃","Celsius","Temperature",null,{_convToStandard:function(t){return t+273.15},_convFromStandard:function(t){return t-273.15}}),e("mol","mole","AmountOfSubstance",1),e("cd","candela","LuminousIntensity",1),e("rad","radian","Angle",1),e("deg","degree","Angle",.01745329,{symbolHtml:"°"}),e("sr","steradian","SolidAngle",1),e("Hz","Hertz","Frequency",1),e("kHz","kilohertz","Frequency",1e3),e("MHz","megahertz","Frequency",1e6),e("N","Newton","Force",1),e("kcal/Å","kilocalorie_per_angstrom","Force",null),e("J","Joule","Energy",1),e("cal","calorie","Energy",4.184),e("kcal","kilocalorie","Energy",4184),e("kcal/rad","kilocalorie_per_radian","Energy",null),e("eV","electron_volt","Energy",160217733e-27),e("hart","Hartree","Energy",43597482e-25),e("W","Watt","Power",1),e("Pa","Pascal","Pressure",1),e("GPa","gigaPascal","Pressure",1e9),e("bar","Bar","Pressure",1e5),e("kbar","kbar","Pressure",1e8),e("atm","Atmosphere","Pressure",101325.027),e("GPa-1","gigaPascal-1","InversePressure",1e-9,{symbolHtml:"GPa<sup>-1</sup>"}),e("C","Coulomb","ElectricCharge",1),e("e","electron_charge","ElectricCharge",160217733e-27),e("V","Volt","ElectricPotentialDifference",1),e("Ω","Ohm","ElectricResistance",1),e("F","Farad","ElectricCapacitance",1),e("S","Siemens","ElectricConductance",1),e("Wb","Weber","MagneticFlux",1),e("T","Tesla","MagneticFluxDensity",1),e("H","Henry","MagneticInductance",1),e("Bq","Becquerel","Radioactivity",1),e("Gy","Gray","RadioactiveAbsorbedDose",1),e("Sv","Sievert","RadioactiveEquivalentDose",1),e("kat","Katal","CatalyticActivity",1),e("cp","Centipoise","DynamicVicosity",null),e("mol/L","Molarity","Molarity",1),e("mol/kg","Molality","Molality",1),e("m2","Square_meter","Area",1,{symbolHtml:"m<sup>2</sup>"}),e("cm2","centimeter_squared","Area",1e-4,{symbolHtml:"cm<sup>2</sup>"}),e("m3","Cubic_meter","Volume",1,{symbolHtml:"m<sup>3</sup>"}),e("Å3","Angstrom_cubed","Volume",1e-30,{symbolHtml:"Å<sup>3</sup>"}),e("L","litre","Volume",.001),e("mL","millilitre","Volume",1e-6),e("m/s","Meter_per_second","Velocity",1),e("km/s","kilometers_per_second","Velcity",1e3),e("m·s-2","Meter_per_second_squared","Acceleration",1,{symbolHtml:"m·s<sup>-2</sup>"}),e("rad/s","radian_per_second","AngularVelocity",1),e("N·s","newton_second","Momentum",1),e("N·m·s","newton_meter_second","AngularMomentum",1),e("N·m","newton_meter","Torque",1),e("m-1","reciprocal_meter","WaveNumber",1,{symbolHtml:"m<sup>-1</sup>"}),e("cm-1","reciprocal_centimeter","WaveNumber",100,{symbolHtml:"cm<sup>-1</sup>"}),e("kg·m-3","Kilogram_per_cubic_meter","MassDensity",1,{symbolHtml:"kg·m<sup>-3</sup>"}),e("kg-1·m3","cubic_meter_per_kilogram","SpecificVolume",1,{symbolHtml:"kg<sup>-1</sup>·m<sup>3</sup>"}),e("m-3·mol","mole_per_cubic_meter","AmountConcentration",1,{symbolHtml:"m<sup>-3</sup>·mol"}),e("m3/mol","cubic_meter_per_mole","MolarVolume",1,{symbolHtml:"m<sup>3</sup>/mol"}),e("J/K","joule_per_kelvin","HeatCapacity",1),e("J·K-1·mol-1","joule_per_kelvin_mole","MolarHeatCapacity",1,{symbolHtml:"J·K<sup>-1</sup>·mol<sup>-1</sup>"}),e("J·K-1·kg-1","joule_per_kilogram_kelvin","SpecificHeatCapacity",1,{symbolHtml:"J·K<sup>-1</sup>·kg<sup>-1</sup>"}),e("J/mol","joule_per_mole","MolarEnergy",1),e("J/kg","joule_per_kilogram","SpecificEnergy",1),e("J·m-3","joule_per_cubic_meter","EnergyDensity",1,{symbolHtml:"J·m<sup>-3</sup>"}),e("N/m","newton_per_meter","SurfaceTension",1),e("W·m-2","watt_per_square_meter","HeatFluxDensity",1,{symbolHtml:"W·m<sup>-2</sup>"}),e("W·m-1·K-1","watt_per_meter_kelvin","ThermalConductivity",1,{symbolHtml:"W·m<sup>-1</sup>·K<sup>-1</sup>"}),e("m2/s","square_meter_per_second","KinematicViscosity",1,{symbolHtml:"m<sup>2</sup>/s"}),e("Pa·s","Pascal_second","DynamicViscosity",1),e("C·m-3","coulomb_per_cubic_meter","ElectricChargeDensity",1,{symbolHtml:"C·m<sup>-3</sup>"}),e("A·m-2","ampere_per_square_meter","ElectricCurrentDensity",1,{symbolHtml:"A·m<sup>-2</sup>"}),e("S/m","siemens_per_meter","ElectricalConductivity",1),e("S·m2/mol","siemens_square_meter_per_mole","MolarConductivity",1,{symbolHtml:"S·m<sup>2</sup>/mol"}),e("F/m","farad_per_meter","Permittivity",1),e("H/m","henry_per_meter","Permeability",1),e("V/m","volt_per_meter","ElectricFieldStrength",1),e("A/m","ampere_per_meter","MagneticFieldStrength",1),e("cd·m-2","candela_per_square_meter","Luminance",1,{symbolHtml:"cd·m<sup>-2</sup>"}),e("C/kg","coulomb_per_kilogram","Exposure",1),e("Gy/s","gray_per_second","AbsorbedDoseRate",1),e("J/m","joule_per_meter","EnergyLengthGradient",1),e("kj/mol","kj_per_mole","MolarEnergy",1e3),e("D","debye","Dipole",3335641e-36)}();Kekule.AbstractConfigs=Class.create(ObjectEx,{CLASS_NAME:"Kekule.AbstractConfigs",CONFIG_PROP_FLAG:"__$config_prop__",initialize:function(s){this.tryApplySuper("initialize"),s===void 0&&(s=!0),s&&this.initPropDefValues()},addConfigProp:function(s,e,t,n){var i={dataType:e};n&&(i=Object.extend(i,n)),t!==void 0&&(i.defaultValue=t);var r=this.defineProp(s,i);return r[this.CONFIG_PROP_FLAG]=!0,r},addHashConfigProp:function(s,e,t){return this.addConfigProp(s,DataType.HASH,e,t)},addStrConfigProp:function(s,e,t){return this.addConfigProp(s,DataType.STRING,e,t)},addNumConfigProp:function(s,e,t){return this.addConfigProp(s,DataType.NUM,e,t)},addIntConfigProp:function(s,e,t){return this.addConfigProp(s,DataType.INT,e,t)},addFloatConfigProp:function(s,e,t){return this.addConfigProp(s,DataType.FLOAT,e,t)},addBoolConfigProp:function(s,e,t){return this.addConfigProp(s,DataType.BOOL,e,t)},initPropDefValues:function(){this.beginUpdate();try{for(var s=this.getAllPropList(),e=0,t=s.getLength();e<t;++e){var n=s.getPropInfoAt(e),i=n.name,r=n.defaultValue;r!==void 0&&this.setPropValue(i,r)}}finally{this.endUpdate()}},isConfigProp:function(s){return!!s[this.CONFIG_PROP_FLAG]},assign:function(s){s.copyPropsTo(this)},doTransformPropNameToHash:function(s){return this.doGetPropNameToHashPrefix()+s},doGetPropNameToHashPrefix:function(){return""},toHash:function(s){var e={},t=this.CONFIG_PROP_FLAG;this.saveObj(e,"json",{saveDefaultValues:!0,propFilter:function(l,u){return l[t]}});for(var n=s||this.doTransformPropNameToHash.bind(this),i={},r=Kekule.ObjUtils.getOwnedFieldNames(e,!1),a=0,o=r.length;a<o;++a)i[n(r[a])]=e[r[a]];return i}}),Kekule.ConfigPresetMap=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ConfigPresetMap",initialize:function(){this.tryApplySuper("initialize"),this.map=new Kekule.MapEx(!0)},doFinalize:function(){this.map=null,this.tryApplySuper("doFinalize")},set:function(s,e){this.map.set(s,e)},get:function(s){return this.map.get(s)},getHash:function(s){var e=this.get(s);return e?e.toHash?e.toHash():e:null},remove:function(s){this.map.remove(s)},has:function(s){return this.map.has(s)},clear:function(){this.map.clear()}}),Kekule.ElementSeries={NONMETAL:"Nonmetals",METAL:"Metals",ALKALI_METAL:"Alkali Metals",ALKALI_EARTH_METAL:"Alkali Earth Metals",TRANSITION_METAL:"Transition Metals",METALLOID:"Metalloids",HALOGEN:"Halogens",NOBLE_GAS:"Noble Gases",LANTHANIDE:"Lanthanides",ACTINIDE:"Actinides"},Kekule.ElementCategory={NONMETAL:1,METAL:21,ALKALI_METAL:22,ALKALI_EARTH_METAL:23,TRANSITION_METAL:24,METALLOID:11,HALOGEN:3,NOBLE_GAS:2,LANTHANIDE:25,ACTINIDE:26},Kekule.Element=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Element",initialize:function(s){if(this.tryApplySuper("initialize"),s!=Kekule.Element.UNSET_ELEMENT){var e=this.getElementInfo(s);e?(this.setPropStoreFieldValue("symbol",e.symbol),this.setPropStoreFieldValue("atomicNumber",e.atomicNumber),this.setPropStoreFieldValue("group",e.group),this.setPropStoreFieldValue("period",e.period),this.setPropStoreFieldValue("series",e.chemicalSerie),this.setPropStoreFieldValue("naturalMass",e.naturalMass),this.setPropStoreFieldValue("categories",this._getElementCategoriesFromSeries(e.chemicalSerie)),e.name&&this.setPropStoreFieldValue("name",e.name)):Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_CHEMELEMENT")+": "+s:"Invalid chemical element: "+s)}else this.setPropStoreFieldValue("symbol",Kekule.Element.UNSET_ELEMENT),this.setPropStoreFieldValue("atomicNumber",Kekule.Element.UNSET_ELEMENT)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("atomicNumber",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("group",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("period",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("series",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("categories",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("naturalMass",{dataType:DataType.FLOAT,serializable:!1,setter:null})},getElementInfo:function(s){return s==Kekule.Element.UNSET_ELEMENT?{symbol:Kekule.Element.UNSET_ELEMENT,atomicNumber:Kekule.Element.UNSET_ELEMENT}:Kekule.Element.isDummyElement(s)?{symbol:Kekule.Element.DUMMY_ELEMENT,atomicNumber:Kekule.Element.DUMMY_ELEMENT_ATOMICNUM}:Kekule.Element.isRGroup(s)?{symbol:Kekule.Element.RGROUP_ELEMENT,atomicNumber:Kekule.Element.RGROUP_ELEMENT_ATMOICNUM}:Kekule.ChemicalElementsDataUtil.getElementInfo(s)},_getElementCategoriesFromSeries:function(s){var e=Kekule.ElementSeries,t=Kekule.ElementCategory,n=[];switch(s){case e.NONMETAL:n=[t.NONMETAL];break;case e.METAL:n=[t.METAL];break;case e.ALKALI_METAL:n=[t.METAL,t.ALKALI_METAL];break;case e.ALKALI_EARTH_METAL:n=[t.METAL,t.ALKALI_EARTH_METAL];break;case e.TRANSITION_METAL:n=[t.METAL,t.TRANSITION_METAL];break;case e.METALLOID:n=[t.METALLOID];break;case e.HALOGEN:n=[t.NONMETAL,t.HALOGEN];break;case e.NOBLE_GAS:n=[t.NONMETAL,t.NOBLE_GAS];break;case e.LANTHANIDE:n=[t.METAL,t.LANTHANIDE];break;case e.ACTINIDE:n=[t.METAL,t.ACTINIDE]}return n},getTheoreticValence:function(){return this.getGroup()?Kekule.Element.getTheoreticValenceOfGroup(this.getGroup()):null},isDummyElement:function(){return this.getAtomicNumber()==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},isRGroupElement:function(){return this.getAtomicNumber()==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},isNormalElement:function(){return Kekule.Element.isNormalElement(this.getAtomicNumber())},isSameElement:function(s){return s==Kekule.Element.UNSET_ELEMENT?this.getAtomicNumber()==Kekule.Element.UNSET_ELEMENT:typeof s=="number"?this.getAtomicNumber()==s:this.getSymbol()==s},isHetero:function(){return(this.getSeries()===Kekule.ElementSeries.NONMETAL||this.getSeries()===Kekule.ElementSeries.HALOGEN)&&this.getAtomicNumber()!==6&&this.getAtomicNumber()!==1},belongToCategory:function(s){return(this.getCategories()||[]).indexOf(s)>=0},getLabel:function(){return this.getSymbol()}}),Object.extend(Kekule.Element,Kekule.ChemicalElementsDataUtil),Kekule.Element.UNSET_ELEMENT=void 0,Kekule.Element.DUMMY_ELEMENT="DU",Kekule.Element.DUMMY_ELEMENT_ATOMICNUM=-1,Kekule.Element.RGROUP_ELEMENT="R",Kekule.Element.RGROUP_ELEMENT_ATOMICNUM=-2,Kekule.Element.DEUTERIUM="D",Kekule.Element.isNormalElement=function(s){return s!=Kekule.Element.UNSET_ELEMENT&&!Kekule.Element.isPseudoElement(s)},Kekule.Element.isPseudoElement=function(s){return typeof s=="string"?s==Kekule.Element.DUMMY_ELEMENT||s==Kekule.Element.RGROUP_ELEMENT:s==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM||s==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},Kekule.Element.isDummyElement=function(s){return s===Kekule.Element.DUMMY_ELEMENT||s===Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},Kekule.Element.isRGroup=function(s){return s===Kekule.Element.RGROUP_ELEMENT||s===Kekule.Element.RGROUP_ELEMENT_ATOMICNUM},Kekule.Element.getTheoreticValenceOfGroup=function(s){return s<=2?s:s<=12?null:s<=17?s-10:0},Kekule.Element.getTheoreticValence=function(s){var e=Kekule.ChemicalElementsDataUtil.getElementInfo(s);return e.group?Kekule.Element.getTheoreticValenceOfGroup(e.group):null},Object.extend(Kekule.Element,{isAtomicNumberAvailable:function(s){return Kekule.ChemicalElementsDataUtil.isAtomicNumberAvailable(s)},isElementSymbolAvailable:function(s){return Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(s)}}),Kekule.Isotope=Class.create(Kekule.Element,{CLASS_NAME:"Kekule.Isotope",initialize:function(s,e){var t=s,n=e,i=Kekule.IsotopesDataUtil.getIsotopeInfo(s,e);if(i&&(i.atomicNumber&&(t=i.atomicNumber),n=i.massNumber),this.tryApplySuper("initialize",[t]),this.setPropStoreFieldValue("massNumber",n),i&&i.isotopeAlias&&this.setPropStoreFieldValue("isotopeAlias",i.isotopeAlias),Kekule.Element.isNormalElement(t)&&n!==Kekule.Isotope.UNSET_MASSNUMBER){var r=Kekule.IsotopesDataUtil.getIsotopeInfo(this.getAtomicNumber(),n);r?(this.setPropStoreFieldValue("exactMass",r.exactMass),this.setPropStoreFieldValue("naturalAbundance",r.naturalAbundance)):Kekule.chemError((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_ISOTOPE"):"Invalid isotope")+": "+this.getSymbol()+"/"+e)}},initProperties:function(){this.defineProp("massNumber",{dataType:DataType.INTEGER,serializable:!1,setter:null}),this.defineProp("exactMass",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("naturalAbundance",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,serializable:!1,setter:null})},isSame:function(s){return s instanceof Kekule.Isotope&&(s===this||s.getAtomicNumber()==this.getAtomicNumber()&&s.getMassNumber()==this.getMassNumber())},getIsotopeId:function(){return Kekule.IsotopesDataUtil.getIsotopeId(this.getAtomicNumber(),this.getMassNumber())},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()}}),Object.extend(Kekule.Isotope,Kekule.IsotopesDataUtil),Kekule.Isotope.UNSET_MASSNUMBER=void 0,Kekule.Isotope.getIsotopeId=function(s,e){return Kekule.IsotopesDataUtil.getIsotopeId(s,e)},Object.extend(Kekule.Isotope,{isMassNumberAvailable:function(s,e){return Kekule.IsotopesDataUtil.isMassNumberAvailable(s,e)}}),Kekule.IsotopeFactory={GENERIC_ELEMENT_ID:"__GENERIC__",_isotopes:{},getIsotopeId:function(s,e){return s?Kekule.IsotopesDataUtil.getIsotopeId(s,e):Kekule.IsotopeFactory.GENERIC_ELEMENT_ID},getIsotope:function(s,e){var t=Kekule.IsotopeFactory.getIsotopeId(s,e);if(!Kekule.IsotopeFactory._isotopes[t]){var n=new Kekule.Isotope(s,e);Kekule.IsotopeFactory._isotopes[t]=n}return Kekule.IsotopeFactory._isotopes[t]},getIsotopeById:function(s){if(Kekule.IsotopeFactory._isotopes[s])return Kekule.IsotopeFactory._isotopes[s];var e=Kekule.IsotopesDataUtil.getIsotopeIdDetail(s);return e?Kekule.IsotopeFactory.getIsotope(e.symbol,e.massNumber):null}},Kekule.AtomType={UNSET_ATOMTYPE:void 0},Kekule.ElectronSet=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ElectronSet",initialize:function(s){this.tryApplySuper("initialize"),this.setElectronCount(s||Kekule.ElectronSet.UNSET_ELECTRONCOUNT)},initProperties:function(){this.defineProp("electronCount",{dataType:DataType.FLOAT})}}),Kekule.ElectronSet.UNSET_ELECTRONCOUNT=null,Kekule.UnbondedElectronSet=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.UnBondedElectronSet",initialize:function(s){this.tryApplySuper("initialize",[s])},initProperties:function(){}}),Kekule.BondType={COVALENT:"covalent",IONIC:"ionic",COORDINATE:"coordinate",METALLIC:"metallic",HYDROGEN:"hydrogen",UNKNOWN:null,DEFAULT:"covalent"},Kekule.BondOrder={SINGLE:1,DOUBLE:2,TRIPLE:3,QUAD:4,EXPLICIT_AROMATIC:10,OTHER:20,UNSET:null,DEFAULT:1,getBondValence:function(s){return s===Kekule.BondOrder.UNSET?0:s==Kekule.BondOrder.EXPLICIT_AROMATIC?1.5:s}},Kekule.BondForm=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.BondForm",initialize:function(s,e,t){this.tryApplySuper("initialize",[e]),this.setBondOrder(s||Kekule.BondOrder.DEFAULT),Kekule.ObjUtils.notUnset(t)&&this.setBondType(t),Kekule.ObjUtils.notUnset(e)&&this.setElectronCount(e)},initProperties:function(){this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var s=this.getPropStoreFieldValue("bondType");return s||Kekule.BondType.DEFAULT}}),this.defineProp("bondOrder",{dataType:DataType.FLOAT,enumSource:Kekule.BondOrder,setter:function(s){this.getPropStoreFieldValue("bondOrder")!=s&&(this.setPropStoreFieldValue("bondOrder",s),s?this.getBondType()==Kekule.BondType.COVALENT&&this.setElectronCount(2*this.getBondValence()):s===Kekule.BondOrder.UNSET&&this.setElectronCount(Kekule.ElectronSet.UNSET_ELECTRONCOUNT))}}),this.defineProp("electronCount",{dataType:DataType.FLOAT}),this.defineProp("bondValence",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return Kekule.BondOrder.getBondValence(this.getBondOrder())},setter:null})}}),Kekule.BondFormFactory={_bondForms:{},getBondFormId:function(s,e,t){var n="";return t&&(n+=t+"_"),s&&(n+=Number(s).toString()),e&&(n+="_"+Number(e).toString()),n},getBondForm:function(s,e,t){if(s||e||t){t||(t=Kekule.BondType.DEFAULT),!e&&s&&t===Kekule.BondType.COVALENT&&(e=2*Kekule.BondOrder.getBondValence(s));var n=Kekule.BondFormFactory.getBondFormId(s,e,t);return Kekule.BondFormFactory._bondForms[n]||(Kekule.BondFormFactory._bondForms[n]=new Kekule.BondForm(s,e,t)),Kekule.BondFormFactory._bondForms[n]}}},Kekule.RadicalOrder={NONE:0,SINGLET:1,DOUBLET:2,TRIPLET:3,DEFAULT:0,getRadicalElectronCount:function(s){var e=Kekule.RadicalOrder;return Kekule.ObjUtils.isUnset(s)||s===e.NONE?0:s===e.DOUBLET?1:2}},Kekule.HybridizationType={UNKNOWN:null,SP:1,SP2:2,SP3:3,NONE:0},Kekule.ValenceUtils={getPossibleMdlValenceInfo:function(s,e){var t=Math.round(e),n=[],i=0,r=!1;switch(s){case 1:case 3:case 11:case 19:case 37:case 55:case 87:t===0?n=[1]:t===1?n=[0]:r=!0,i=1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(t){case 0:n=[2];break;case 1:n=[1];break;case 2:n=[0];break;default:r=!0}i=2;break;case 5:switch(t){case-4:n=[1];break;case-3:n=[2];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 1:n=[2];break;case 2:n=[1];break;case 3:n=[0];break;default:r=!0}i=3;break;case 6:switch(t){case-4:n=[0];break;case-3:n=[1];break;case-2:n=[2];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 2:n=[2];break;case 3:n=[1];break;case 4:n=[0];break;default:r=!0}i=4;break;case 7:switch(t){case-3:n=[0];break;case-2:n=[1];break;case-1:n=[2];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 3:n=[2];break;case 4:n=[1];break;case 5:n=[0];break;default:r=!0}i=5;break;case 8:switch(t){case-2:n=[0];break;case-1:n=[1];break;case 0:n=[2];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 4:n=[2];break;case 5:n=[1];break;case 6:n=[0];break;default:r=!0}i=6;break;case 9:switch(t){case-1:n=[0];break;case 0:n=[1];break;case 1:n=[2];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 5:n=[2];break;case 6:n=[1];break;case 7:n=[0];break;default:r=!0}i=7;break;case 13:switch(t){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 1:n=[2];break;case 2:n=[1];break;case 3:n=[0];break;default:r=!0}i=3;break;case 14:switch(t){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 2:n=[2];break;case 3:n=[1];break;case 4:n=[0]}i=4;break;case 15:switch(t){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 3:n=[2];break;case 4:n=[1];break;case 5:n=[0]}i=5;break;case 16:switch(t){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 4:n=[2];break;case 5:n=[1];break;case 6:n=[0]}i=6;break;case 17:switch(t){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 5:n=[2];break;case 6:n=[1];break;case 7:n=[0]}i=7;break;case 31:switch(t){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 2:n=[1];break;case 3:n=[0];break;default:r=!0}i=3;break;case 32:switch(t){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 3:n=[1];break;case 4:n=[0]}i=4;break;case 33:switch(t){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 4:n=[1];break;case 5:n=[0]}i=5;break;case 34:switch(t){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 5:n=[1];break;case 6:n=[0]}i=6;break;case 35:switch(t){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 6:n=[1];break;case 7:n=[0]}i=7;break;case 49:switch(t){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 2:n=[1];break;case 3:n=[0];break;default:r=!0}i=3;break;case 50:case 82:switch(t){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[2,4];break;case 1:n=[3];break;case 3:n=[1];break;case 4:n=[0]}i=4;break;case 51:case 83:switch(t){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[2,4];break;case 2:n=[3];break;case 4:n=[1];break;case 5:n=[0]}i=5;break;case 52:case 84:switch(t){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[2,4];break;case 3:n=[3];break;case 5:n=[1];break;case 6:n=[0]}i=6;break;case 53:case 85:switch(t){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[2,4];break;case 4:n=[3];break;case 6:n=[1];break;case 7:n=[0]}i=7;break;case 81:switch(t){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[2,4];break;case 0:n=[1,3];break;case 3:n=[0];break;default:r=!0}i=3}if(r){var a=i-e;(a<0||a>8)&&(n=[])}return{valences:n,valenceElectronCount:i,unexpectedCharge:r}},getMaxPossibleMdlValence:function(s,e){var t=Kekule.ValenceUtils.getPossibleMdlValenceInfo(s,e).valences;return t.length?t[t.length-1]:0},getImplicitMdlValence:function(s,e,t){var n=e,i=t;switch(s){case 1:case 3:case 11:case 19:case 37:case 55:case 87:if(n==0&&i<=1)return 1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(n){case 0:if(i<=2)return 2;break;case 1:if(i<=1)return 1}break;case 5:switch(n){case-4:if(i<=1)return 1;break;case-3:if(i<=2)return 2;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 1:if(i<=2)return 2;break;case 2:if(i<=1)return 1}break;case 6:switch(n){case-3:if(i<=1)return 1;break;case-2:if(i<=2)return 2;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 2:if(i<=2)return 2;break;case 3:if(i<=1)return 1}break;case 7:switch(n){case-2:if(i<=1)return 1;break;case-1:if(i<=2)return 2;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 3:if(i<=2)return 2;break;case 4:if(i<=1)return 1}break;case 8:switch(n){case-1:if(i<=1)return 1;break;case 0:if(i<=2)return 2;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 4:if(i<=2)return 2;break;case 5:if(i<=1)return 1}break;case 9:switch(n){case 0:if(i<=1)return 1;break;case 1:if(i<=2)return 2;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=4)return 4;break;case 4:if(i<=3)return 3;break;case 5:if(i<=2)return 2;break;case 6:if(i<=1)return 1}break;case 13:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 1:if(i<=2)return 2;break;case 2:if(i<=1)return 1}break;case 14:switch(n){case-3:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-2:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 2:if(i<=2)return 2;break;case 3:if(i<=1)return 1}break;case 15:switch(n){case-2:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 3:if(i<=2)return 2;break;case 4:if(i<=1)return 1}break;case 16:switch(n){case-1:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 0:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 4:if(i<=2)return 2;break;case 5:if(i<=1)return 1}break;case 17:switch(n){case 0:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=4)return 4;break;case 4:if(i<=3)return 3;break;case 5:if(i<=2)return 2;break;case 6:if(i<=1)return 1}break;case 31:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 2:if(i<=1)return 1}break;case 32:switch(n){case-3:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-2:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 3:if(i<=1)return 1}break;case 33:switch(n){case-2:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 4:if(i<=1)return 1}break;case 34:switch(n){case-1:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 0:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 5:if(i<=1)return 1}break;case 35:switch(n){case 0:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=4)return 4;break;case 4:if(i<=3)return 3;break;case 6:if(i<=1)return 1}break;case 49:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=2)return 2;if(i<=4)return 4;break;case 0:if(i<=3)return 3;break;case 2:if(i<=1)return 1}break;case 50:case 82:switch(n){case-3:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-2:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-1:if(i<=3)return 3;if(i<=5)return 5;break;case 0:if(i<=2)return 2;if(i<=4)return 4;break;case 1:if(i<=3)return 3;break;case 3:if(i<=1)return 1}break;case 51:case 83:switch(n){case-2:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 0:if(i<=3)return 3;if(i<=5)return 5;break;case 1:if(i<=2)return 2;if(i<=4)return 4;break;case 2:if(i<=3)return 3;break;case 4:if(i<=1)return 1}break;case 52:case 84:switch(n){case-1:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 0:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 1:if(i<=3)return 3;if(i<=5)return 5;break;case 2:if(i<=2)return 2;if(i<=4)return 4;break;case 3:if(i<=3)return 3;break;case 5:if(i<=1)return 1}break;case 53:case 85:switch(n){case 0:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case 1:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case 2:if(i<=3)return 3;if(i<=5)return 5;break;case 3:if(i<=2)return 2;if(i<=4)return 4;break;case 4:if(i<=3)return 3;break;case 6:if(i<=1)return 1}break;case 81:switch(n){case-4:if(i<=1)return 1;if(i<=3)return 3;if(i<=5)return 5;if(i<=7)return 7;break;case-3:if(i<=2)return 2;if(i<=4)return 4;if(i<=6)return 6;break;case-2:if(i<=3)return 3;if(i<=5)return 5;break;case-1:if(i<=2)return 2;if(i<=4)return 4;break;case 0:if(i<=1)return 1;if(i<=3)return 3}}return i},getImplicitHydValence:function(s,e,t){var n=s,i=e,r=t,a=0;return n==6?a=4-Math.abs(i):n==7||n==15?a=3+i:n!=8&&n!=16||(a=2+i),a<0&&(a=0),r>a&&(a=r),a}},Kekule.ValenceUtils.getImplicitValence=Kekule.ValenceUtils.getImplicitMdlValence,Kekule.ValenceUtils.getMaxPossibleValence=Kekule.ValenceUtils.getMaxPossibleMdlValence,function(){var s=Kekule.ArrayUtils;Kekule.StructureComparationLevel={SKELETAL:1,CONSTITUTION:2,CONFIGURATION:3,EXACT:4,DEFAULT:4},Kekule.globalOptions.add("structure",{defaultBondLength2D:.8,defaultBondLength3D:1.5}),Kekule.globalOptions.add("algorithm.structureComparation",{structureComparationLevel:Kekule.StructureComparationLevel.DEFAULT}),Kekule.globalOptions.add("algorithm.structureClean",{structureCleanOptions:{orphanChemNode:!0,hangingChemConnector:!0}}),Kekule.globalOptions.add("structure.implicitHydrogenEstimationStrategy",{targetElementCategories:{},targetElements:{},targetOrphanAtomElementCategories:{},targetOrphanAtomElements:{}}),Kekule.globalOptions.structure.implicitHydrogenEstimationStrategy.targetOrphanAtomElementCategories[Kekule.ElementCategory.METAL]=!1,Kekule.ObjComparer.compareStructure=function(e,t,n){var i=Object.create(n||{});return i.method=Kekule.ComparisonMethod.CHEM_STRUCTURE,Kekule.ObjComparer.compare(e,t,i)},Kekule.ObjComparer.equalStructure=function(e,t,n){return Kekule.ObjComparer.compareStructure(e,t,n)===0},Kekule.ObjComparer.getStructureComparisonDetailOptions=function(e){var t=Object.extend({},e);if(e){var n,i=Kekule.StructureComparationLevel,r=e.structureLevel||e.level||Kekule.globalOptions.algorithm.structureComparation.structureComparationLevel,a=["atom","mass","linkedConnectorCount","charge","radical","stereo","hydrogenCount","connectedObjCount","bondType","bondOrder"];r===i.SKELETAL?n={atom:!1,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!1,connectedObjCount:!0,bondType:!1,bondOrder:!1}:r===i.CONSTITUTION?n={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:r===i.CONFIGURATION?n={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:r===i.EXACT&&(n={atom:!0,mass:!0,linkedConnectorCount:!0,charge:!0,radical:!0,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0});for(var o=0,l=a.length;o<l;++o){var u=a[o],c="compare"+u.capitalizeFirst(),d=t[u];Kekule.ObjUtils.isUnset(d)&&(d=t[c]),Kekule.ObjUtils.isUnset(d)?(t[u]=n[u],t[c]=n[u]):(t[u]=d,t[c]=d)}}return t},Kekule.ChemStructureObject=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemStructureObject",initialize:function(e){this.setPropStoreFieldValue("autoClearStructureCache",!0),this.tryApplySuper("initialize",[e])},doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null}),this.defineProp("linkedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,n=this.getLinkedConnectorCount();t<n;++t)for(var i=this.getLinkedConnectorAt(t).getConnectedObjs(),r=0,a=i.length;r<a;++r){var o=i[r];o===this||this.hasChildObj&&this.hasChildObj(o)||Kekule.ArrayUtils.pushUnique(e,i[r])}return e}}),this.defineProp("linkedSiblings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getParent(),n=0,i=this.getLinkedConnectorCount();n<i;++n)for(var r=this.getLinkedConnectorAt(n).getConnectedObjs(),a=0,o=r.length;a<o;++a){var l=r[a];l!==this&&e.indexOf(l)<0&&(l.getParent()!==t&&(l=t.getDirectChildOfNestedNode(l)),l&&e.push(l))}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("structureCache");return!t&&e&&(t={},this.setPropStoreFieldValue("structureCache",t)),t}}),this.defineProp("autoClearStructureCache",{dataType:DataType.BOOL,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("linkedConnectors",[]),this.setSuppressChildChangeEventInUpdating(!0)},getAutoIdPrefix:function(){return"o"},getAcceptCoordStickFrom:function(e){return!1},doGetActualCompareOptions:function(e){if(e&&e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var t=Kekule.ObjComparer.getStructureComparisonDetailOptions(e);return e.customMethod&&(t.customMethod=e.customMethod),e.extraComparisonProperties&&(t.extraComparisonProperties=e.extraComparisonProperties),t}return this.tryApplySuper("doGetActualCompareOptions",[e])},_getComparisonOptionFlagValue:function(e,t){var n=e["compare"+t.capitalizeFirst()];return Kekule.ObjUtils.isUnset(n)&&(n=e[t]),n},doGetComparisonPropNames:function(e){return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?[]:this.tryApplySuper("doGetComparisonPropNames",[e])},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"linkedConnectorCount")){var i=this.getLinkedNonHydrogenConnectors(),r=e.getLinkedNonHydrogenConnectors&&e.getLinkedNonHydrogenConnectors();n=this.doCompareOnValue(i.length,r&&r.length,t)}return n},compareStructure:function(e,t){var n=Object.create(t||{});return n.method=Kekule.ComparisonMethod.CHEM_STRUCTURE,this.compare(e,n)},equalStructure:function(e,t){return this.compareStructure(e,t)===0},getParentFragment:function(){var e=this.getParent();return e instanceof Kekule.StructureFragment?e:null},getRootFragment:function(){var e=this.getParentFragment();return e&&e.getRootFragment()||e},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){return this.getStructureCache(!0)[e]=t,this},clearStructureCache:function(){return this.setPropStoreFieldValue("structureCache",null),this},needAutoClearStructureCache:function(){var e=this.getParent();return this.getAutoClearStructureCache()&&(!e||!e.needAutoClearStructureCache||e.needAutoClearStructureCache())},notifyLinkedConnectorsChanged:function(){this.notifyPropSet("linkedConnectors",this.getPropStoreFieldValue("linkedConnectors"))},getCurrConnectableObj:function(){return this},getActualConnectedObjToConnector:function(e){return this},getLinkedConnectorCount:function(){return this.getLinkedConnectors().length},getLinkedConnectorAt:function(e){return this.getLinkedConnectors()[e]},indexOfLinkedConnector:function(e){return this.getLinkedConnectors().indexOf(e)},appendLinkedConnector:function(e){var t=this._doAppendLinkedConnector(e);return e&&e._doAppendConnectedObj(this),t},_doAppendLinkedConnector:function(e){if(!e)return-1;var t=this.getPropStoreFieldValue("linkedConnectors"),n=Kekule.ArrayUtils.pushUniqueEx(t,e);return n.isPushed&&this.notifyLinkedConnectorsChanged(),n.index},insertLinkedConnectorAt:function(e,t){t||(t=0);var n=this.indexOfLinkedConnector(e),i=this.getLinkedConnectors();n>=0?(i.splice(n,1),i.splice(t,0,e),this.notifyLinkedConnectorsChanged()):(i.splice(t,0,e),e&&e._doAppendConnectedObj(this),this.notifyLinkedConnectorsChanged())},insertLinkedConnectorBefore:function(e,t){var n=t?this.indexOfLinkedConnector(t):-1;return n<0?this.appendLinkedConnector(e):this.insertLinkedConnectorAt(e,n)},removeLinkedConnectorAt:function(e){var t=this.getLinkedConnectorAt(e);return t&&t._doRemoveConnectedObjAt(t.indexOfConnectedObj(this)),this._doRemoveLinkedConnectorAt(e)},_doRemoveLinkedConnectorAt:function(e){var t=Kekule.ArrayUtils.removeAt(this.getLinkedConnectors(),e);return t&&this.notifyLinkedConnectorsChanged(),t},removeLinkedConnector:function(e){var t=this.getLinkedConnectors().indexOf(e);t>=0&&this.removeLinkedConnectorAt(t)},getConnectorTo:function(e){for(var t=0,n=this.getLinkedConnectorCount();t<n;++t){var i=this.getLinkedConnectorAt(t);if(i.hasConnectedObj(e))return i}return null},removeThisFromLinkedConnector:function(){for(var e=this.getLinkedConnectorCount()-1;e>=0;--e)this.getLinkedConnectorAt(e).removeConnectedObj(this)},getLinkedObjsOnConnector:function(e){for(var t=[],n=e.getConnectedObjs(),i=0,r=n.length;i<r;++i)n[i]!==this&&Kekule.ArrayUtils.pushUnique(t,n[i]);return t},filterConnector:function(e){for(var t=[],n=0,i=this.getLinkedConnectorCount();n<i;++n){var r=this.getLinkedConnectorAt(n);e(r)&&Kekule.ArrayUtils.pushUnique(t,r)}return t},getLinkedNonHydrogenConnectors:function(){var e=this;return this.filterConnector(function(t){var n=e.getLinkedObjsOnConnector(t);return n.length>1||!(n[0].isHydrogenAtom&&n[0].isHydrogenAtom())})},getLinkedHydrogenConnectors:function(){var e=this;return this.filterConnector(function(t){var n=e.getLinkedObjsOnConnector(t);return n.length===1&&n[0].isHydrogenAtom&&n[0].isHydrogenAtom()})},getLinkedNonHydrogenObjs:function(){for(var e=[],t=0,n=this.getLinkedConnectorCount();t<n;++t)for(var i=this.getLinkedConnectorAt(t).getConnectedObjs(),r=0,a=i.length;r<a;++r)i[r]===this||i[r].isHydrogenAtom&&i[r].isHydrogenAtom()||Kekule.ArrayUtils.pushUnique(e,i[r]);return e},getLinkedHydrogenAtoms:function(){for(var e=[],t=0,n=this.getLinkedConnectorCount();t<n;++t){var i=this.getLinkedConnectorAt(t);if(i instanceof Kekule.Bond)for(var r=i.getConnectedObjs(),a=0,o=r.length;a<o;++a)r[a]!==this&&r[a].isHydrogenAtom&&r[a].isHydrogenAtom()&&Kekule.ArrayUtils.pushUnique(e,r[a])}return e},getLinkedHydrogenAtomsWithSingleBond:function(){for(var e=[],t=0,n=this.getLinkedConnectorCount();t<n;++t){var i=this.getLinkedConnectorAt(t);if(i instanceof Kekule.Bond&&i.isSingleBond()){var r=i.getConnectedObjs();if(r.length===2)for(var a=0,o=r.length;a<o;++a)r[a]!==this&&r[a].isHydrogenAtom&&r[a].isHydrogenAtom()&&Kekule.ArrayUtils.pushUnique(e,r[a])}}return e},getLinkedHydrogenAtomsWithSingleBondCount:function(e){var t=this.getLinkedHydrogenAtomsWithSingleBond().length||0;return e&&(t+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0),t},getPathesToDest:function(e){return this._doGetPathesToDest(e,[])},_doGetPathesToDest:function(e,t){if(e===this)return[];for(var n,i=[],r=s.clone(t),a=0,o=this.getLinkedConnectorCount();a<o;++a){var l=this.getLinkedConnectorAt(a);if(!(r.indexOf(l)>=0)){r.push(l);for(var u=l.getConnectedObjs(),c=0,d=u.length;c<d;++c){var h=u[c];if(h===e)n=[[]];else{if(h===this)continue;n=h&&h._doGetPathesToDest&&h._doGetPathesToDest(e,r)}if(n){for(var p={connector:l,object:h},g=0,f=n.length;g<f;++g)n[g].unshift(p);i=i.concat(n)}}}}return i.length||(i=null),i},getStructureRelatedPropNames:function(){return["linkedConnectors"]},structureChange:function(e){this.needAutoClearStructureCache()&&(this.clearStructureFlags(),this.clearStructureCache()),this.invokeEvent("structureChange",{origin:e||this})},clearStructureFlags:function(){},relayEvent:function(e,t){e==="structureChange"?this.structureChange(t.origin):this.tryApplySuper("relayEvent",[e,t])},doObjectChange:function(e){Kekule.ArrayUtils.intersect(e||[],this.getStructureRelatedPropNames()).length&&this.structureChange()}}),Kekule.SimpleStructureNode=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.SimpleStructureNode",initialize:function(e,t,n){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),n&&this.setCoord3D(n)},initProperties:function(){this.defineProp("zIndex2D",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["coord2D","coord3D"])},getAutoIdPrefix:function(){return"n"},getContainerBox:function(e,t){var n=this.getAbsCoordOfMode(e,t);return Kekule.BoxUtils.createBox(n,n)},getContainerBox2D:function(e){return this.getContainerBox(Kekule.CoordMode.COORD2D,e)},getContainerBox3D:function(e){return this.getContainerBox(Kekule.CoordMode.COORD3D,e)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.SimpleStructureNode),Kekule.BaseStructureNode=Class.create(Kekule.SimpleStructureNode,{CLASS_NAME:"Kekule.BaseStructureNode",initProperties:function(){this.defineProp("coordStickTarget",{dataType:"Kekule.ChemStructureObject",objRef:!0,autoUpdate:!0,getter:function(){return this.getPropStoreFieldValue("coordStickTarget")},setter:function(e){if(e){if(!this.getAllowCoordStickTo(e))return void Kekule.chemError(Kekule.$L("ErrorMsg.COORD_STICK_NOT_ALLOWED_ON_CLASS"));var t=this.getOwner(),n=e.getOwner&&e.getOwner();if(n&&t!==n)return void Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ"));if(!e.getAcceptCoordStickFrom&&!e.getAcceptCoordStickFrom(this))return void Kekule.chemError(Kekule.$L("ErrorMsg.INVALID_STICK_TARGET_OBJ"));if(!e.getAbsCoordOfMode)return void Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD"));if(e.getCoordStickTarget&&e.getCoordStickTarget()===this)return void Kekule.chemError(Kekule.$L("ErrorMsg.STICK_RECURSION_NOT_ALLOWED"))}var i=this.getCoordStickTarget();this.setPropStoreFieldValue("coordStickTarget",e),this._coordStickTargetChanged(i,e)}})},getAllowCoordStickTo:function(e){return!1},notifyCoordStickTargetChanged:function(e,t){},_getParentAbsCoord:function(e,t){var n=this.getCoordParent();return n&&n.getAbsCoordOfMode&&n.getAbsCoordOfMode(e,t)},_coordStickTargetChanged:function(e,t){e&&!t?this._copyAbsCoordFromStickedTarget(e,this.getCoordParent()):t&&this._copyAbsCoordFromStickedTarget(t,this.getCoordParent()),e&&e.detachCoordStickNodes&&e.detachCoordStickNodes(this),t&&t.attachCoordStickNodes&&t.attachCoordStickNodes(this),this.notifyCoordStickTargetChanged(e,t)},_copyAbsCoordFromStickedTarget:function(e,t,n){var i=Kekule.CoordUtils,r=Kekule.CoordMode;t||(t=this.getCoordParent());var a=n&&n!==r.COORD2D?null:e.getAbsCoord2D(),o=n&&n!==r.COORD2D?null:e.getAbsCoord3D();if(t){if(a){var l=t.getAbsCoord2D&&t.getAbsCoord2D();l&&(a=i.substract(a,l))}if(o){var u=t.getAbsCoord3D&&t.getAbsCoord3D();u&&(o=i.substract(o,u))}}a&&this.setPropStoreFieldValue("coord2D",a),o&&this.setPropStoreFieldValue("coord3D",o)},doGetCoord2D:function(e,t){var n=this.getCoordStickTarget();if(n&&n.getAbsCoord2D){var i=n.getAbsCoord2D(e,t),r=this._getParentAbsCoord(Kekule.CoordMode.COORD2D,e);return r&&(i=Kekule.CoordUtils.substract(i,r)),i}return this.tryApplySuper("doGetCoord2D",[e,t])},doGetCoord3D:function(e,t){var n=this.getCoordStickTarget();if(n&&n.getAbsCoord3D){var i=n.getAbsCoord3D(e,t),r=this._getParentAbsCoord(Kekule.CoordMode.COORD3D,e);return r&&(i=Kekule.CoordUtils.substract(i,r)),i}return this.tryApplySuper("doGetCoord3D",[e,t])},isOrphan:function(){var e=this.getParent();return!e||e.getChildCount()<=1}}),Kekule.StereoParity={NONE:null,ODD:1,EVEN:2,UNKNOWN:0},Kekule.ChemStructureNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.ChemStructureNode",initialize:function(e,t,n){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),n&&this.setCoord3D(n)},initProperties:function(){this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("radical",{dataType:DataType.INT}),this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("isAnchor",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getParent();return!(!e||!e.indexOfAnchorNode)&&e.indexOfAnchorNode(this)>=0},setter:function(e){if(e!==this.getIsAnchor()){var t=this.getParent();t&&(e&&t.appendAnchorNode()?t.appendAnchorNode(this):!e&&t.removeAnchorNode&&t.removeAnchorNode(this))}}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["charge","radical"])},getLabel:function(){return null},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode)},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"charge")&&t.push("charge"),this._getComparisonOptionFlagValue(e,"radical")&&t.push("radical")),t},doCompareProperty:function(e,t,n){if(n.method!==Kekule.ComparisonMethod.CHEM_STRUCTURE||t!=="charge"&&t!=="radical")return this.tryApplySuper("doCompareProperty",[e,t,n]);var i=e.getPropValue&&e.getPropValue(t)||0;return(this.getPropValue(t)||0)-i},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var i=this.getParity()||Kekule.StereoParity.UNKNOWN,r=e.getParity&&e.getParity()||Kekule.StereoParity.UNKNOWN;n=this.doCompareOnValue(i,r,t)}return n},getPrimaryIsotope:function(){return null},getLinkedChemNodes:function(e){for(var t=this.getLinkedObjs(),n=[],i=0,r=t.length;i<r;++i){var a=t[i];!(a instanceof Kekule.ChemStructureNode)||e&&a.isHydrogenAtom&&a.isHydrogenAtom()||n.push(a)}return n},getLinkedBonds:function(e){for(var t=[],n=0,i=this.getLinkedConnectorCount();n<i;++n){var r=this.getLinkedConnectorAt(n);r instanceof Kekule.Bond&&(!e||r.getBondType()===e)&&t.push(r)}return t},getLinkedMultiCenterBonds:function(){for(var e=[],t=0,n=this.getLinkedConnectorCount();t<n;++t){var i=this.getLinkedConnectorAt(t);i instanceof Kekule.Bond&&i.getConnectedObjCount()>2&&e.push(i)}return e},getLinkedMultipleBonds:function(){for(var e=Kekule.BondOrder,t=[],n=0,i=this.getLinkedConnectorCount();n<i;++n){var r=this.getLinkedConnectorAt(n);if(r instanceof Kekule.Bond&&r.getBondType()===Kekule.BondType.COVALENT){var a=r.getBondOrder();a!==e.DOUBLE&&a!==e.TRIPLE&&a!==e.QUAD&&a!==e.EXPLICIT_AROMATIC||t.push(r)}}return t},getLinkedDoubleBonds:function(){for(var e=Kekule.BondOrder,t=[],n=0,i=this.getLinkedConnectorCount();n<i;++n){var r=this.getLinkedConnectorAt(n);r instanceof Kekule.Bond&&r.getBondType()===Kekule.BondType.COVALENT&&r.getBondOrder()===e.DOUBLE&&t.push(r)}return t},clearStructureFlags:function(){this.setPropStoreFieldValue("parity",Kekule.StereoParity.NONE)},isHydrogenAtom:function(){return!1},_getBondsValenceInfo:function(e){for(var t=0,n=0,i=this.getStructureCacheData("piElectronCount")||null,r=0,a=e.length;r<a;++r){var o,l=e[r];l instanceof Kekule.Bond&&(t+=o=l.getBondType()==Kekule.BondType.COVALENT&&l.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC&&i>=2?1:l.getBondValence(),o>n&&(n=o))}return{valenceSum:t,maxValence:n}},_getCurrCovalentBondsInfo:function(){return this._getBondsValenceInfo(this.filterConnector(function(e){return e instanceof Kekule.Bond&&e.getBondType()==Kekule.BondType.COVALENT}))},_getCurrIonicBondsInfo:function(e){return this._getBondsValenceInfo(this.filterConnector(function(t){return t instanceof Kekule.Bond&&t.getBondType()==Kekule.BondType.IONIC}))}}),Kekule.RadicalType=Kekule.RadicalOrder,Kekule.AbstractAtom=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.AbstractAtom",initialize:function(e,t,n){this.tryApplySuper("initialize",[e,t,n])},initProperties:function(){this.defineProp("explicitHydrogenCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=parseFloat(e),n=isNaN(t)||t<0?void 0:t;this.setPropStoreFieldValue("explicitHydrogenCount",n)}})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["explicitHydrogenCount"])},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"hydrogenCount")){var i=this.getHydrogenCount(!0),r=e.getHydrogenCount&&e.getHydrogenCount(!0);n=this.doCompareOnValue(i,r,t)}return n},getHydrogenCount:function(e){var t=this.getExplicitHydrogenCount()||0;return e&&(t+=this.getLinkedHydrogenAtomsWithSingleBondCount(!1)),t+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0},setHydrogenCount:function(e){return this.setExplicitHydrogenCount(e)},hasExplicitHydrogens:function(){return Kekule.ObjUtils.notUnset(this.getExplicitHydrogenCount())},isSaturated:function(){return!this.getLinkedMultipleBonds().length},mayContainElement:function(e){var t;return t=typeof e=="string"?Kekule.ChemicalElementsDataUtil.getAtomicNumber(e):e,this.doMayContainElement(t)},doMayContainElement:function(e){return!1}}),Kekule.Atom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Atom",initialize:function(e,t,n,i,r){this.tryApplySuper("initialize",[e,i,r]),(t||n)&&this.changeIsotope(t,n)},initProperties:function(){this.defineProp("isotope",{dataType:"Kekule.Isotope",serializable:!1}),this.defineProp("isotopeId",{dataType:DataType.STRING,serializable:!0,getter:function(){var e=this.getIsotope();return e?e.getIsotopeId():Kekule.Element.UNSET_ELEMENT},setter:function(e){var t=Kekule.IsotopeFactory.getIsotopeById(e);t&&this.setIsotope(t)}}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getSymbol():Kekule.Element.UNSET_ELEMENT},setter:function(e){this.changeElement(e)}}),this.defineProp("atomicNumber",{dataType:DataType.INTEGER,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getAtomicNumber():0},setter:function(e){this.changeElement(e)}}),this.defineProp("massNumber",{dataType:DataType.INTEGER,getter:function(){var e=this.getIsotope();return e?e.getMassNumber():Kekule.Isotope.UNSET_MASSNUMBER},setter:function(e){this.changeMassNumber(e)}}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,getter:function(){var e=this.getIsotope();return e?e.getIsotopeAlias():void 0},setter:function(e){this.changeElement(e)}}),this.defineProp("atomType",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("atomTypeId",{dataType:DataType.STRING,getter:function(){var e=this.getPropStoreFieldValue("atomType");return e?e.id:Kekule.AtomType.UNSET_ATOMTYPE},setter:function(e){if(this.isNormalAtom()){var t=Kekule.AtomTypeDataUtil.getAtomTypeFromId(this.getAtomicNumber(),e);this.setAtomType(t)}}}),this.defineProp("hybridizationType",{dataType:DataType.INT,enumSource:Kekule.HybridizationType}),this.defineProp("disableImplicitHydrogenEstimation",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["isotope","atomType"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"mass")&&t.unshift("massNumber"),this._getComparisonOptionFlagValue(e,"atom")&&t.unshift("atomicNumber")),t},getPrimaryIsotope:function(){return this.getIsotope()},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()},doMayContainElement:function(e){return this.getAtomicNumber()===e},changeIsotope:function(e,t){e===Kekule.Element.UNSET_ELEMENT?t=Kekule.Isotope.UNSET_MASSNUMBER:e||(e=this.getAtomicNumber()),t||(t=Kekule.Isotope.UNSET_MASSNUMBER),this.getAtomicNumber()!==e&&this.setAtomType(Kekule.AtomType.UNSET_ATOMTYPE);var n=Kekule.IsotopeFactory.getIsotope(e,t);this.setIsotope(n)},changeElement:function(e){return this.changeIsotope(e,Kekule.Isotope.UNSET_MASSNUMBER)},changeMassNumber:function(e){return this.changeIsotope(null,e)},isElement:function(e){return this.getSymbol()===e||this.getAtomicNumber()===e},getElementSeries:function(){var e=this.getIsotope();return e&&e.getSeries()},isNormalAtom:function(){var e=this.getIsotope();return!!e&&e.isNormalElement()},isHydrogenAtom:function(){return this.isElement(1)&&(!this.getMassNumber()||this.getMassNumber()<=1)},guessAtomType:function(){if(this.isNormalAtom()){var e=null,t=null,n=this._getCurrCovalentBondsInfo(),i=Kekule.AtomTypeDataUtil.getAllAtomTypes(this.getAtomicNumber());if(i){for(var r=0,a=i.length;r<a;++r){var o=i[r];if(t=o,o.bondOrderSum>=n.valenceSum&&(e=o,o.maxBondOrder>=n.maxValence))return o}return e||t}}return null},getProximalAtomType:function(){return this.getAtomType()||this.guessAtomType()},getImplicitValence:function(){if(this.isNormalAtom()){var e=this._getCurrCovalentBondsInfo().valenceSum,t=Math.round(this.getCharge()||0);return Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),t,e)}return 0},getExplicitValence:function(e){var t=e||{};if(this.isNormalAtom()){var n=this._getCurrCovalentBondsInfo().valenceSum;return t.ignoreBondHydrogens?n-=(this.getLinkedHydrogenAtomsWithSingleBond()||[]).length:n+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0,t.ignoreExplicitHydrogens||(n+=this.getExplicitHydrogenCount()||0),n}return 0},getValence:function(e){var t=e||{};if(this.isNormalAtom()){var n,i=this.getExplicitValence(t);if(this.hasExplicitHydrogens())n=i;else{var r=t.ignoreCharge?0:Math.round(this.getCharge()||0);n=Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),r,i)}return n}return 0},getImplicitHydrogenCount:function(e){if(this.isNormalAtom()&&this._needToEsitmateImplicityHydrogens()){var t=this._getCurrCovalentBondsInfo(),n=this._getCurrIonicBondsInfo(),i=Math.round(this.getCharge()||0),r=Kekule.RadicalOrder.getRadicalElectronCount(this.getRadical()),a=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0;return Kekule.ChemStructureUtils.getImplicitHydrogenCount(this.getAtomicNumber()||0,{coValenceBondValenceSum:(t.valenceSum||0)+a,otherBondValenceSum:n.valenceSum||0,charge:i,radicalECount:r})}return 0},_needToEsitmateImplicityHydrogens:function(){var e=!this.getDisableImplicitHydrogenEstimation();if(e){var t=this.isOrphan(),n=this.getSymbol(),i=Kekule.globalOptions.get("structure.implicitHydrogenEstimationStrategy")||{};if((i.targetElements&&i.targetElements[n]===!1||t&&i.targetOrphanAtomElements&&i.targetOrphanAtomElements[n]===!1)&&(e=!1),e)for(var r=i.targetElementCategories,a=i.targetOrphanAtomElementCategories,o=this.getIsotope().getCategories(),l=0,u=o.length;l<u;++l){var c=o[l];if(r&&r[c]===!1||t&&a&&a[c]===!1){e=!1;break}}}return e},getHydrogenCount:function(e){var t=this.tryApplySuper("getHydrogenCount",[e]);return Kekule.ObjUtils.isUnset(this.getExplicitHydrogenCount())&&(t+=this.getImplicitHydrogenCount()||0),t},getAtomicMass:function(){var e=null,t=this.getIsotope();return t&&(e=t.getExactMass()||t.getNaturalMass()),e}}),Kekule.PseudoatomType={DUMMY:"dummy",ANY:"any",HETERO:"hetero",CUSTOM:"custom"},Kekule.Pseudoatom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Pseudoatom",initialize:function(e,t,n,i,r){this.tryApplySuper("initialize",[e,i,r]),t&&this.setAtomType(t),n&&t==Kekule.PseudoatomType.CUSTOM&&this.setSymbol(n)},initProperties:function(){this.defineProp("atomType",{dataType:DataType.STRING,enumSource:Kekule.PseudoatomType}),this.defineProp("symbol",{dataType:DataType.STRING,getter:function(){var e=this.getAtomType(),t=Kekule.PseudoatomType,n=Kekule.ChemStructureNodeLabels;return e===t.DUMMY?n.DUMMY_ATOM:e===t.ANY?n.ANY_ATOM:e===t.HETERO?n.HETERO_ATOM:this.getPropStoreFieldValue("symbol")||n.CUSTOM_ATOM},setter:function(e){var t=Kekule.PseudoatomType,n=Kekule.ChemStructureNodeLabels;if(e){var i=e===n.DUMMY_ATOM?t.DUMMY:e===n.ANY_ATOM?t.ANY:e===n.HETERO_ATOM?t.HETERO:t.CUSTOM;this.setAtomType(i)}this.setPropStoreFieldValue("symbol",e)}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["atomType","symbol"])},getPrimaryIsotope:function(){return null},getLabel:function(){return this.getSymbol()},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"atom")&&t.push("atomType"),t},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")&&this.getAtomType()===Kekule.PseudoatomType.CUSTOM){var i=this.getSymbol(),r=e.getSymbol&&e.getSymbol();n=this.doCompareOnValue(i,r,t)}return n},doMayContainElement:function(e){var t=Kekule.PseudoatomType,n=this.getAtomType();return n===t.ANY||n===t.HETERO&&!([1,6].indexOf(e)>=0)&&Kekule.ChemicalElementsDataUtil.getElementInfo(e).chemicalSerie==="Nonmetals"}}),Kekule.VariableAtom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.VariableAtom",initProperties:function(){this.defineProp("allowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("allowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("allowedIsotopeIds",t)),t}}),this.defineProp("disallowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("disallowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("disallowedIsotopeIds",t)),t}}),this.defineProp("allowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getAllowedIsotopeIds())}}),this.defineProp("disallowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getDisallowedIsotopeIds())}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["allowedIsotopeIds","disallowedIsotopeIds"])},getPrimaryIsotope:function(){if(this.isDisallowedList())return null;var e=this.getAllowedIsotopeIds(),t=e?e[0]:null;return t?Kekule.IsotopeFactory.getIsotopeById(t):null},getLabel:function(){return Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")){var i=Kekule.ArrayUtils,r=this.getAllowedIsotopeIds(),a=e.getAllowedIsotopeIds&&e.getAllowedIsotopeIds();if(r)r=i.clone(r).sort(),a&&a.length&&(a=i.clone(a).sort()),n=this.doCompareOnValue(r,a,t);else if(a)n=1;else{var o=this.getDisallowedIsotopeIds(),l=e.getDisallowedIsotopeIds&&e.getDisallowedIsotopeIds();o&&o.length&&(o=i.clone(o).sort()),l&&l.length&&(l=i.clone(l).sort()),n=this.doCompareOnValue(o,l,t)}}return n},doMayContainElement:function(e){var t=function(i,r){if(!r)return!1;for(var a=0,o=r.length;a<o;++a){var l=r[a],u=Kekule.IsotopesDataUtil.getIsotopeIdDetail(l).symbol;if(Kekule.ChemicalElementsDataUtil.getAtomicNumber(u)===i)return!0}return!1},n=this.getAllowedIsotopeIds();return n?t(e,n):(n=this.getDisallowedIsotopeIds())?!t(e,n):void 0},isDisallowedList:function(){return this.getDisallowedIsotopeIds()&&!this.getAllowedIsotopeIds()},isListEmpty:function(){var e=this.getAllowedIsotopeIds(),t=!e||!e.length;return t&&(t=!(e=this.getDisallowedIsotopeIds())||!e.length),t},fetchAllowedIsotopeIds:function(){return this.doGetAllowedIsotopeIds(!0)},fetchDisallowedIsotopeIds:function(){return this.doGetDisallowedIsotopeIds(!0)},_getIsotopesFromIds:function(e){if(!e)return null;for(var t=[],n=0,i=e.length;n<i;++n){var r=e[n],a=Kekule.IsotopeFactory.getIsotopeById(r);a&&t.push(a)}return t}}),Kekule.MolecularFormula=Class.create(ObjectEx,{CLASS_NAME:"Kekule.MolecularFormula",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("sections",[]),e&&this.setPropStoreFieldValue("parent",e),this.setBubbleEvent(!0)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("sections",{dataType:DataType.ARRAY,setter:null}),this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("radical",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("radical")||0}})},getHigherLevelObj:function(){return this.getParent()},isEmpty:function(){return this.getSectionCount()<=0},notifySectionsChanged:function(){this.notifyPropSet("sections",this.getPropStoreFieldValue("sections"))},createSectionItem:function(e,t,n){var i={obj:e,count:t||1};return n&&e.setCharge(n),e.setParent&&e.setParent(this.getParent()),i},getTotalCharge:function(){for(var e=0,t=this.getSections(),n=0,i=t.length;n<i;++n)t[n].obj.getCharge&&(e+=t[n].obj.getCharge()*(t.count||1));return this.getCharge()&&(e+=this.getCharge()),e},indexOfObj:function(e){for(var t=this.getSections(),n=0,i=t.length;n<i;++n)if(t[n].obj==e)return n;return-1},getSectionCount:function(){return this.getSections().length},getSectionAt:function(e){return this.getSections()[e]},getSectionCharge:function(e){var t,n=0;return(t=typeof e!="object"?this.getSectionAt(e):e).obj.getCharge&&(n+=t.obj.getCharge()||0),n},appendSection:function(e,t,n){var i=this.createSectionItem(e,t,n);return this.getSections().push(i),this.notifySectionsChanged(),i},insertSection:function(e,t,n,i){var r=this.createSectionItem(t,n,i);return this.getSections().splice(e,0,r),this.notifySectionsChanged(),r},removeSectionAt:function(e){var t=this.getSections().splice(e,1);return t&&this.notifySectionsChanged(),t},clear:function(){this.beginUpdate();try{this.setCharge(null),this.setRadical(null),this.setPropStoreFieldValue("sections",[]),this.notifySectionsChanged()}finally{this.endUpdate()}},removeObj:function(e){var t=this.indexOfObj(e);if(!(t>=0))return null;this.removeSectionAt(t),this.notifySectionsChanged()},getMaxNestedLevel:function(){for(var e=0,t=0,n=this.getSectionCount();t<n;++t){var i=this.getSectionAt(t);if(i.obj instanceof Kekule.MolecularFormula){var r=i.obj.getMaxNestedLevel()+1;r>e&&(e=r)}}return e},getSimpleIsotopeMaps:function(){}}),Kekule.StructureConnectionTable=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureConnectionTable",TRAVERS_VISITED_KEY:"__$ctabTraversVisited__",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setOwner(e),t&&this.setPropStoreFieldValue("parent",t)},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("owner")&&(this.setPropStoreFieldValue("owner",e),this.ownerChanged(e))}}),this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("parent")&&(this.setPropStoreFieldValue("parent",e),this.parentChanged(e))}}),this.defineProp("nodes",{dataType:DataType.ARRAY}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,n=this.getNodeCount();t<n;++t){var i=this.getNodeAt(t);i instanceof Kekule.ChemStructureNode&&(i.isHydrogenAtom&&i.isHydrogenAtom()||e.push(i))}return e}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,n=this.getConnectorCount();t<n;++t){var i=this.getConnectorAt(t);i.isNormalConnectorToHydrogen&&i.isNormalConnectorToHydrogen()||e.push(i)}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getParent();return t&&t.getStructureCache(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("anchorNodes",[]),this.setPropStoreFieldValue("connectors",[])},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},doSaveProp:function(e,t,n,i,r,a,o,l){var u=t.name;switch(u){case"anchorNodes":for(var c=[],d=0,h=e.getAnchorNodeCount();d<h;++d){var p=e.getAnchorNodeAt(d),g=e.indexOfNode(p);c.push(g)}var f=r.createChildStorageNode(n,r.propNameToStorageName(u),!0);return r.saveObj(c,f,i,a,o,l),!0;case"connectors":for(f=r.createChildStorageNode(n,r.propNameToStorageName(u),!0),d=0,h=e.getConnectorCount();d<h;++d){var m=e.getConnectorAt(d),C=r.getNameForArrayItemStorageNode(m),_=r.appendArrayItemStorageNode(f,r.propNameToStorageName(C),r.isArray(m));r.setStorageNodeExplicitType(_,r.getValueExplicitType(m)),r.saveObj(m,_,i,a,o,l);for(var y=[],T=0,E=m.getConnectedObjCount();T<E;++T){var b=m.getConnectedObjAt(T);if((g=e.indexOfChild(b))>=0)y.push(g);else{var v=e.indexStackOfChild(b);v!=null&&y.push(v)}}if(y.length){var I=r.createChildStorageNode(_,r.propNameToStorageName("connectedObjs"),!0);r.saveObj(y,I,i,a,o,l)}}return!0;default:return!1}},doLoadProp:function(e,t,n,i,r,a,o){var l=t.name;switch(l){case"anchorNodes":var u=[],c=i.getChildStorageNode(n,i.propNameToStorageName(l));return i.loadObj(u,c,r,a,o),e.__load_anchorNodes_indexes=u,!0;case"connectors":c=i.getChildStorageNode(n,i.propNameToStorageName(l));for(var d,h=i.getAllArrayItemStorageNodes(c),p=0,g=h.length;p<g;++p){var f=h[p],m=i.getStorageNodeExplicitType(f)||i.getStorageNodeName(f);if(m){d=DataType.createInstance(m),i.loadObj(d,f,r,a,o);var C=i.getChildStorageNode(f,i.propNameToStorageName("connectedObjs"));if(C){var _=[];i.loadObj(_,C,r,a,o),d.__load_connectedObj_indexes=_}var y=i.getChildStorageNode(f,i.propNameToStorageName("connectedNodes"));if(y){var T=[];i.loadObj(T,y,r,a,o),d.__load_connectedNode_indexes=T}var E=i.getChildStorageNode(f,i.propNameToStorageName("connectedConnectors"));if(E){var b=[];i.loadObj(b,E,r,a,o),d.__load_connectedConnector_indexes=b}e.appendConnector(d)}}return!0;default:return!1}},loaded:function(e){if(this.__load_anchorNodes_indexes){for(var t=0,n=this.__load_anchorNodes_indexes.length;t<n;++t){var i=this.__load_anchorNodes_indexes[t];this.appendAnchorNode(this.getNodeAt(i))}delete this.__load_anchorNodes_indexes}for(t=0,n=this.getConnectorCount();t<n;++t){var r=this.getConnectorAt(t);if(r.__load_connectedObj_indexes){for(var a=0,o=r.__load_connectedObj_indexes.length;a<o;++a){var l;(l=typeof(i=r.__load_connectedObj_indexes[a])=="object"?this.getChildAtIndexStack(i):this.getChildAt(i))&&r.appendConnectedObj(l)}delete r.__load_connectedObj_indexes}if(r.__load_connectedNode_indexes){for(a=0,o=r.__load_connectedNode_indexes.length;a<o;++a)typeof(i=r.__load_connectedNode_indexes[a])=="object"?r.appendConnectedObj(this.getNodeAtIndexStack(i)):r.appendConnectedObj(this.getNodeAt(i));delete r.__load_connectedNode_indexes}if(r.__load_connectedConnector_indexes){for(a=0,o=r.__load_connectedConnector_indexes.length;a<o;++a)i=r.__load_connectedConnector_indexes[a],r.appendConnectedObj(this.getConnectorAt(i));delete r.__load_connectedConnector_indexes}}this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded",[e])},notifyNodesChanged:function(){this.notifyPropSet("nodes",this.getPropStoreFieldValue("nodes"))},notifyAnchorNodesChanged:function(){this.notifyPropSet("anchorNodes",this.getPropStoreFieldValue("anchorNodes"))},notifyConnectorsChanged:function(){this.notifyPropSet("connectors",this.getPropStoreFieldValue("connectors"))},ownerChanged:function(e){for(var t=0,n=this.getNodeCount();t<n;++t)this.getNodeAt(t).setOwner(e);for(t=0,n=this.getConnectorCount();t<n;++t)this.getConnectorAt(t).setOwner(e)},parentChanged:function(e,t){for(var n=0,i=this.getNodeCount();n<i;++n)this.getNodeAt(n).setParent(e);for(n=0,i=this.getConnectorCount();n<i;++n)this.getConnectorAt(n).setParent(e)},isEmpty:function(){return this.getNodeCount()<=0&&this.getConnectorCount()<=0},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){var n=this.getParent();return n&&n.setStructureCacheData&&n.setStructureCacheData(e,t),this},clearStructureCache:function(){var e=this.getParent();return e&&e.clearStructureCache(),this},getNodeById:function(e){for(var t=this.getNodes(),n=0,i=t.length;n<i;++n)if(t[n].getId()==e)return t[n];return null},getConnectorById:function(e){for(var t=this.getConnectors(),n=0,i=t.length;n<i;++n)if(t[n].getId()==e)return t[n];return null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.getNodes().length},getNodeAt:function(e){return this.getNodes()[e]},indexOfNode:function(e){return this.getNodes().indexOf(e)},hasNode:function(e,t){var n=this.indexOfNode(e)>=0;if(!n&&t)for(var i=0,r=this.getNodeCount();i<r;++i){var a=this.getNodeAt(i);if(a.hasNode&&(n=a.hasNode(e,!0)),n)break}return n},indexStackOfNode:function(e){var t=this.indexOfNode(e);if(t>=0)return t;for(var n=null,i=0,r=this.getNodeCount();i<r;++i){var a=this.getNodeAt(i);if(a.indexStackOfNode&&(n=a.indexStackOfNode(e),!Kekule.ObjUtils.isUnset(n)))return typeof n!="object"&&(n=[n]),n.unshift(i),n}return n},getNodeAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getNodeAt(e[0]),n=1,i=e.length;n<i;++n){if(!t||!t.getNodeAt)return null;t=t.getNodeAt(e[n])}return t},insertNodeBefore:function(e,t){var n=this.indexOfNode(t);n?this.insertNodeAt(e,n):this.appendNode(e)},appendNode:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getNodes(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyNodesChanged()),t.index},insertNodeAt:function(e,t){var n=this.indexOfNode(e),i=this.getNodes();return(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=i.length),n>=0?(i.splice(n,1),i.splice(t,0,e)):(i.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyNodesChanged(),t},setNodeIndex:function(e,t){var n=this.getNodes(),i=this.indexOfNode(e);i>=0&&(n.splice(i,1),n.splice(t,0,e))},removeNodeAt:function(e,t){var n=this.getNodes()[e];n&&(t||n.removeThisFromLinkedConnector(),this.getNodes().splice(e,1),n.setOwner&&n.setOwner(null),n.setParent&&n.setParent(null),this.notifyNodesChanged())},removeNode:function(e,t){var n=this.getNodes().indexOf(e);n>=0&&this.removeNodeAt(n,t)},replaceNode:function(e,t){if(!this.hasNode(e))return this;this.insertBefore(t,e);var n=this.getAnchorNodes(),i=n.indexOf(e);i>=0&&n.splice(i,1,[t]);for(var r=Kekule.ArrayUtils.clone(e.getLinkedConnectors()),a=0,o=r.length;a<o;++a)(u=r[a]).replaceConnectedObj(e,t);if(e.getNodes&&e.getCrossConnectors){var l=Kekule.ArrayUtils.clone(e.getCrossConnectors());for(a=0,o=l.length;a<o;++a){var u=l[a];if(this.indexOfConnector(u)>=0)for(var c=0,d=u.getConnectedObjCount();c<d;++c){var h=u.getConnectedObjAt(c);e.indexOfChild(h)>=0&&u.replaceConnectedObj(h,t)}u.replaceConnectedObj(e,t)}}this.removeNode(e)},clearNodes:function(){this.clearAnchorNodes(),this.setPropStoreFieldValue("nodes",[]),this.notifyAnchorNodesChanged(),this.notifyNodesChanged()},sortNodes:function(e){e?(this.getNodes().sort(e),this.notifyNodesChanged()):Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))},nodesHasCoord2D:function(e,t){return this.nodesHasCoordOfMode(Kekule.CoordMode.COORD2D,e,t)},nodesHasCoord3D:function(e,t){return this.nodesHasCoordOfMode(Kekule.CoordMode.COORD3D,e,t)},nodesHasCoordOfMode:function(e,t,n){for(var i=Kekule.CoordUtils.isZero,r=0,a=this.getNodes(),o=0,l=a.length;o<l;++o)if(a[o].hasCoordOfMode(e,t)){if(!n||!i(a[o].getCoordOfMode(e,t)))return!0;++r}return!!(n&&r===a.length&&r<=1)},_createAtom:function(e,t,n,i){return new Kekule.Atom(null,e,t,n,i)},appendAtom:function(e,t,n,i){var r=this._createAtom(e,t,n,i);return r&&this.appendNode(r),r},getAnchorNodeCount:function(){return this.getAnchorNodes().length},indexOfAnchorNode:function(e){return this.getAnchorNodes().indexOf(e)},getAnchorNodeAt:function(e){return this.getAnchorNodes()[e]},appendAnchorNode:function(e){if(!e)return-1;if(this.getNodes().indexOf(e)>=0){var t=Kekule.ArrayUtils.pushUniqueEx(this.getAnchorNodes(),e);return t.isPushed&&this.notifyAnchorNodesChanged(),t.index}return-1},removeAnchorNodeAt:function(e){this.getAnchorNodes()[e]&&(this.getAnchorNodes().splice(e,1),this.notifyAnchorNodesChanged())},removeAnchorNode:function(e){var t=this.getAnchorNodes().indexOf(e);t>=0&&this.removeAnchorNodeAt(t)},clearAnchorNodes:function(){this.setPropStoreFieldValue("anchorNodes",[]),this.notifyAnchorNodesChanged()},getConnectorCount:function(){return this.getConnectors().length},indexOfConnector:function(e){return this.getConnectors().indexOf(e)},getConnectorAt:function(e){return this.getConnectors()[e]},indexStackOfConnector:function(e){var t=this.indexOfConnector(e);if(t>=0)return t;for(var n=null,i=0,r=this.getNodeCount();i<r;++i){var a=this.getNodeAt(i);if(a.indexStackOfConnector&&(n=a.indexStackOfConnector(e),!Kekule.ObjUtils.isUnset(n)))return typeof n!="object"&&(n=[n]),n.unshift(i),n}return n},getConnectorAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;if(e.length===1)return this.getConnectorAt(e[0]);for(var t=e.length-1,n=this.getNodeAt(e[0]),i=1;i<t;++i){if(!n||!n.getNodeAt)return null;n=n.getNodeAt(e[i])}return n?n.getConnectorAt(e[t]):null},insertConnectorBefore:function(e,t){var n=this.indexOfConnector(t);n?this.insertConnectorAt(e,n):this.appendConnector(e)},appendConnector:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getConnectors(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyConnectorsChanged()),t.index},insertConnectorAt:function(e,t){var n=this.indexOfConnector(e),i=this.getConnectors();(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=i.length),n>=0?(i.splice(n,1),i.splice(t,0,e)):(i.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyConnectorsChanged()},setConnectorIndex:function(e,t){var n=this.getConnectors(),i=this.indexOfConnector(e);i>=0&&(n.splice(i,1),n.splice(t,0,e))},removeConnectorAt:function(e,t){var n=this.getConnectors()[e];n&&(t||n.removeThisFromConnectedObjs(),this.getConnectors().splice(e,1),n.setOwner&&n.setOwner(null),n.setParent&&n.setParent(null),this.notifyConnectorsChanged())},removeConnector:function(e,t){var n=this.getConnectors().indexOf(e);n>=0&&this.removeConnectorAt(n,t)},clearConnectors:function(){this.setPropStoreFieldValue("connectors",[]),this.notifyConnectorsChanged()},hasConnector:function(e,t){var n=this.indexOfConnector(e)>=0;if(!n&&t)for(var i=0,r=this.getNodeCount();i<r;++i){var a=this.getNodeAt(i);if(a.hasConnector&&(n=a.hasConnector(e,!0)),n)break}return n},sortConnectors:function(e){e?(this.getConnectors().sort(e),this.notifyConnectorsChanged()):Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))},_createBond:function(e,t,n){for(var i=[],r=0,a=e.length;r<a;++r){var o=e[r];DataType.isSimpleValue(o)&&(o=this.getNodeAt(o)),i.push(o)}return new Kekule.Bond(null,i,t,null,n)},appendBond:function(e,t,n){var i=this._createBond(e,t,n);return i&&this.appendConnector(i),i},_getObjsNeedToBeCascadeRemoved:function(e,t){for(var n=[],i=e.getLinkedConnectors?e.getLinkedConnectors():[],r=0,a=i.length;r<a;++r){var o=i[r];(!t||t.indexOf(o)<0)&&o.getConnectedObjs().length<=2&&Kekule.ArrayUtils.pushUnique(n,o)}if(!(e instanceof Kekule.ChemStructureNode)){if(e instanceof Kekule.ChemStructureConnector){var l=e.getConnectedObjs();for(r=0,a=l.length;r<a;++r){var u=l[r];(!t||t.indexOf(u)<0)&&u instanceof Kekule.ChemStructureNode&&u.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(n,u)}}}var c=[].concat(n);c.push(e);var d=[];for(r=0,a=n.length;r<a;++r){if((u=n[r])!==e)var h=this._getObjsNeedToBeCascadeRemoved(u,c);Kekule.ArrayUtils.pushUnique(d,h)}return Kekule.ArrayUtils.pushUnique(n,d),n},removeChildObj:function(e,t,n){var i;t?(i=this._getObjsNeedToBeCascadeRemoved(e),Kekule.ArrayUtils.pushUnique(i,e)):i=[e];for(var r=0,a=i.length;r<a;++r)(o=i[r])instanceof Kekule.BaseStructureConnector?this.removeConnector(o):o instanceof Kekule.BaseStructureNode&&this.removeNode(o);if(n)for(r=i.length-1;r>=0;--r){var o;(o=i[r]).finalize&&o.finalize()}},removeChild:function(e){return this.removeChildObj(e)||this.tryApplySuper("removeChild",[e])},deleteChildObj:function(e,t){return this.removeChildObj(e,t,!0)},hasChildObj:function(e){return this.hasNode(e)||this.hasConnector(e)},getNextSiblingOfChild:function(e){if(e instanceof Kekule.SimpleStructureNode){if((t=this.indexOfNode(e))>=0)return this.getNodeAt(t+1)}else if(e instanceof Kekule.BaseStructureConnector){var t;if((t=this.indexOfConnector(e))>=0)return this.getConnectorAt(t+1)}return null},insertBefore:function(e,t){if(e instanceof Kekule.SimpleStructureNode){var n=this.indexOfNode(t);return this.insertNodeAt(e,n)}return e instanceof Kekule.BaseStructureConnector?(n=this.indexOfConnector(t),this.insertConnectorAt(e,n)):-1},clear:function(){this.clearNodes(),this.clearConnectors()},getChildCount:function(){return this.getNodeCount()+this.getConnectorCount()},getChildAt:function(e){var t=this.getNodeCount();return e<t?this.getNodeAt(e):e<t+this.getConnectorCount()?this.getConnectorAt(e-t):null},indexOfChild:function(e){var t;return e instanceof Kekule.BaseStructureNode?t=this.indexOfNode(e):e instanceof Kekule.BaseStructureConnector?(t=this.indexOfConnector(e))>=0&&(t+=this.getNodeCount()):t=-1,t},indexStackOfChild:function(e){var t;if(e instanceof Kekule.BaseStructureNode)t=this.indexStackOfNode(e);else if(e instanceof Kekule.BaseStructureConnector){var n=this.getNodeCount();(t=this.indexStackOfConnector(e)).length?t[t.length-1]+=n:t+=n}else t=-1;return t},getChildAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),n=1,i=e.length;n<i;++n){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[n])}return t},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){for(var e=[],t=0,n=this.getNodeCount();t<n;++t){var i=this.getNodeAt(t);this.isSubFragment(i)&&e.push(i)}return e},hasSubFragments:function(){var e=this.getSubFragments();return e&&e.length},getLeafNodes:function(){for(var e=[],t=0,n=this.getNodeCount();t<n;++t){var i=this.getNodeAt(t);if(this.isSubFragment(i)){if(i.getLeafNodes){var r=i.getLeafNodes();e=e.concat(r)}}else e.push(i)}return e},findDirectChildOfObj:function(e){for(var t=e;t&&this.indexOfChild(t)<0;)t=t.getParent?t.getParent():null;return t},getAllChildConnectors:function(){for(var e=[].concat(this.getConnectors()),t=this.getSubFragments(),n=0,i=t.length;n<i;++n)t[n].getAllChildConnectors&&(e=e.concat(t[n].getAllChildConnectors()));return e},getAllContainingConnectors:function(){return this.getAllChildConnectors()},getIsotopeMaps:function(){var e=this.getNodes();if(e.length<=0)return[];for(var t=function(u,c,d,h){for(var p=!1,g=0,f=u.length;g<f;++g)c.isSame(u[g].isotope)&&(p=!0,u[g].count+=d,u[g].charge+=h||0);if(!p){var m={isotope:c,count:d,charge:a.getCharge()||0};u.push(m)}return u},n=[],i=0,r=e.length;i<r;++i){var a=e[i];if(a instanceof Kekule.StructureFragment){var o=a.getIsotopeMaps();for(i=0,r=o.length;i<r;++i)n=t(n,o[i].isotope,o[i].count,o[i].charge||0)}else if(a instanceof Kekule.Atom){a.getIsotope(),n=t(n,a.getIsotope(),1,a.getCharge()||0);var l=a.getHydrogenCount();l>0&&(n=t(n,Kekule.IsotopeFactory.getIsotope(1),l,0))}}return n},calcFormula:function(){var e=this.getIsotopeMaps();if(e.length<=0)return null;for(var t=new Kekule.MolecularFormula,n=0,i=e.length;n<i;++n){var r=new Kekule.Atom;r.setIsotope(e[n].isotope),t.appendSection(r,e[n].count,e[n].charge)}return t},getNodesContainBox:function(e,t,n){for(var i=t===Kekule.CoordMode.COORD3D,r={},a=0,o=e.length;a<o;++a){var l=e[a].getAbsCoordOfMode(t,n);a==0?(r.x1=r.x2=l.x,r.y1=r.y2=l.y,i&&(r.z1=r.z2=l.z)):(l.x<r.x1?r.x1=l.x:l.x>r.x2&&(r.x2=l.x),l.y<r.y1?r.y1=l.y:l.y>r.y2&&(r.y2=l.y),i&&(l.z<r.z1?r.z1=l.z:l.z>r.z2&&(r.z2=l.z)))}return r},getContainerBox:function(e,t){return this.getNodesContainBox(this.getNodes(),e,t)},getContainerBox2D:function(e){var t=this.getContainerBox(Kekule.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getContainerBox3D:function(e){var t=this.getContainerBox(Kekule.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t},traverse:function(e,t,n,i){for(var r={nodes:[],connectors:[]},a=s.clone(i||this.getNodes()),o=0,l=a.length;o<l;++o)a[o][this.TRAVERS_VISITED_KEY]=!1;for(;a.length;){var u;u=t&&a.indexOf(t)>=0?t:a[0];var c=this._doTravers(e,u,n,i);r.nodes=r.nodes.concat(c.nodes),r.connectors=r.connectors.concat(c.connectors),a=s.exclude(a,c.nodes)}return r},_doTravers:function(e,t,n,i){var r={nodes:[],connectors:[]},a=t;a[this.TRAVERS_VISITED_KEY]||(r.nodes.push(a),a[this.TRAVERS_VISITED_KEY]=!0,e&&e(a,!1));var o=s.clone(a.getLinkedConnectors()),l=this.getConnectors();o.sort(function(y,T){return l.indexOf(y)-l.indexOf(T)});for(var u=[],c=0,d=o.length;c<d;++c){var h=o[c],p=a.getLinkedObjsOnConnector(h);i&&(p=s.intersect(p,i));for(var g=0,f=p.length;g<f;++g){var m=p[g];if(m instanceof Kekule.BaseStructureNode)break}if(m&&!m[this.TRAVERS_VISITED_KEY])if(r.nodes.push(m),r.connectors.push(h),m[this.TRAVERS_VISITED_KEY]=!0,e&&(e(h,!0),e(m,!1)),n)u.push(m);else{var C=this._doTravers(e,m,n,i);r.nodes=r.nodes.concat(C.nodes),r.connectors=r.connectors.concat(C.connectors)}}if(n)for(c=0,d=u.length;c<d;++c){var _=u[c];C=this._doTravers(e,_,n,i),r.nodes=r.nodes.concat(C.nodes),r.connectors=r.connectors.concat(C.connectors)}return r}}),Kekule.StructureFragment=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.StructureFragment",initialize:function(e,t,n){this.tryApplySuper("initialize",[e,t,n])},doFinalize:function(){this.hasFormula()&&this.getFormula().finalize(),this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("formula",{dataType:"Kekule.MolecularFormula",getter:function(e){return this.getPropStoreFieldValue("formula")||e&&this.createFormula(),this.getPropStoreFieldValue("formula")},setter:function(e){var t=this.getPropStoreFieldValue("formula");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.addEventListener("change",function(n){this.notifyPropSet("formula",this.getFormula())},this)),this.setPropStoreFieldValue("formula",e)}}),this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",getter:function(e){return this.getPropStoreFieldValue("ctab")||e&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(e){var t=this.getPropStoreFieldValue("ctab");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.setOwner(this.getOwner()),e.addEventListener("propValueSet",function(n){n.propName!="nodes"&&n.propName!="anchorNodes"&&n.propName!="connectors"||this.notifyPropSet(n.propName,n.propValue)},this),e.setEnablePropValueSetEvent(!0)),this.setPropStoreFieldValue("ctab",e)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getAnchorNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}}),this.defineProp("crossConnectors",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){for(var e=[].concat(this.getPropStoreFieldValue("linkedConnectors")),t=0,n=this.getNodeCount();t<n;++t)for(var i=this.getNodeAt(t).getLinkedConnectors()||[],r=0,a=i.length;r<a;++r)this.indexOfConnector(i[r])<0&&Kekule.ArrayUtils.pushUnique(e,i[r]);return e}}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenNodes():[]}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenConnectors():[]}}),this.defineProp("canonicalizationInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getStructureCacheData("canonicalizationInfo")},setter:function(e){this.setStructureCacheData("canonicalizationInfo",e)}}),this.defineProp("aromaticRings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getStructureCacheData("aromaticRings");return e||(e=[],this.setStructureCacheData("aromaticRings",e)),e},setter:function(e){this.setStructureCacheData("aromaticRings",e)}}),this.defineProp("flattenedShadow",{dataType:"Kekule.StructureFragmentShadow",serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=null;if(Kekule.ObjUtils.isUnset(e)&&(e=!0),this.getFlattenedShadowOnSelf())return null;if(!(t=this.getPropStoreFieldValue("flattenedShadow"))&&e){var n=(t=new Kekule.StructureFragmentShadow(this)).getShadowFragment();n.unmarshalAllSubFragments(!0),this._copyAdditionalInfoToShadowFragment(n,t.getSourceToShadowMap(),t.getShadowToSourceMap()),this.setPropStoreFieldValue("flattenedShadow",t)}return t}}),this.defineProp("flattenedShadowOnSelf",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PROVATE,setter:null,getter:function(){var e=this.setPropStoreFieldValue("flattenedShadowOnSelf");return Kekule.ObjUtils.isUnset(e)&&(e=!this.hasSubFragments(),this.setPropStoreFieldValue("flattenedShadowOnSelf",e)),e}})},getAutoIdPrefix:function(){return"f"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["ctab","formula","nodes","anchorNodes","connectors"])},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var i=this.hasCtab(),r=e.hasCtab&&e.hasCtab();if(!(n=i?r?0:1:r?-1:0)){var a=this.hasFormula(),o=e.hasFormula&&e.hasFormula();n=a?o?0:1:o?-1:0}if(!n&&this.hasCtab()){if(n===0&&this.getNonHydrogenNodes&&e.getNonHydrogenNodes){var l=function(R,N){var L;R instanceof Kekule.ChemStructureConnector?L=R.getConnectedNonHydrogenObjs():R instanceof Kekule.ChemStructureNode&&(L=R.getLinkedNonHydrogenObjs());for(var U=[],W=0,M=L.length;W<M;++W){var B=L[W],V=N.indexOfNode(B);V>=0&&U.push(V)}return U.sort(),U},u=this.getNonHydrogenNodes(),c=e.getNonHydrogenNodes();if((n=u.length-c.length)===0)for(var d=0,h=u.length;d<h&&(n=this.doCompareOnValue(u[d],c[d],t))===0;++d){var p=l(u[d],this),g=l(c[d],e);if((n=Kekule.ArrayUtils.compare(p,g))!==0)break}}if(n===0&&this.getConnectors&&e.getConnectors){var f=this.getNonHydrogenConnectors(),m=e.getNonHydrogenConnectors();if((n=f.length-m.length)===0)for(d=0,h=f.length;d<h&&(n=this.doCompareOnValue(f[d],m[d],t))===0&&(p=l(f[d],this),g=l(m[d],e),(n=Kekule.ArrayUtils.compare(p,g))===0);++d);}if(n===0){var C=this.getNonHydrogenNodes(),_=e.getNonHydrogenNodes(),y=this.traverse(null,C[C.length-1],!0,C),T=e.traverse(null,_[_.length-1],!0,_);for(d=0,h=y.nodes.length;d<h;++d){var E=y.nodes[d],b=T.nodes[d];if((n=this.doCompareOnValue(E,b,t))!==0)break}if(n===0)for(d=0,h=y.connectors.length;d<h;++d){var v=y.connectors[d],I=T.connectors[d];if((n=this.doCompareOnValue(v,I,t))!==0)break}}}}return n},structureChange:function(e){this.setPropStoreFieldValue("flattenedShadowOnSelf",null);var t=this.getFlattenedShadow(!1);t&&(t.finalize(),this.setPropStoreFieldValue("flattenedShadow",null)),this.tryApplySuper("structureChange",[e])},clearStructureFlags:function(){this.tryApplySuper("clearStructureFlags");for(var e=0,t=this.getChildCount();e<t;++e){var n=this.getChildAt(e);n.clearStructureFlags&&n.clearStructureFlags()}},ownerChanged:function(e,t){this.hasCtab()&&this.getCtab().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){if(this.hasFormula())this.getFormula()===e&&this.removeFormula();else if(this.hasCtab()){var t=this.getCtab();t===e?this.removeCtab():t.hasChildObj(e)&&t.removeChildObj(e)}this.tryApplySuper("_removeChildObj",[e])},isEmpty:function(){var e;return(e=!this.hasFormula())&&((e=!this.hasCtab())||(e=this.getCtab().isEmpty())),e},isCtabEmpty:function(){return!this.hasCtab()||this.getCtab().isEmpty()},doGetLinkedConnectors:function(){return this.getCrossConnectors()},appendLinkedConnector:function(e){var t=this.getCurrConnectableObj();return t&&t!==this?t.appendLinkedConnector(e):this.tryApplySuper("appendLinkedConnector",[e])},getCurrConnectableObj:function(){var e=this.getAnchorNodeCount()>0?this.getAnchorNodes():this.getNodes();if(e.length<=0)return this;for(var t=this.getCrossConnectors(),n=null,i=null,r=0,a=e.length;r<a;++r){var o=e[r],l=o.getLinkedConnectors(),u=Kekule.ArrayUtils.intersect(l,t).length;(n===null||n>u)&&(n=u,i=o)}return i},getActualConnectedObjToConnector:function(e){if(this.indexOfConnector(e)>=0)return null;if(e.indexOfConnectedObj(this)>=0)return this;for(var t=0,n=e.getConnectedObjCount();t<n;++t){var i=e.getConnectedObjAt(t);if(i.isChildOf(this))return i}return null},createCtab:function(){var e=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setCtab(e)},createFormula:function(){var e=new Kekule.MolecularFormula(this);this.setFormula(e)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},hasFormula:function(){return!!this.getPropStoreFieldValue("formula")},removeFormula:function(){var e=this.getPropStoreFieldValue("formula");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("formula",null)),this},removeCtab:function(){var e=this.getPropStoreFieldValue("ctab");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("ctab",null)),this},getContainerBox:function(e,t){return this.hasCtab()?this.getCtab().getContainerBox(e,t):this.tryApplySuper("getContainerBox",[e])},getNodeById:function(e){return this.hasCtab()?this.getCtab().getNodeById(e):null},getConnectorById:function(e){return this.hasCtab()?this.getCtab().getConnectorById(e):null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(e){return this.hasCtab()?this.getCtab().getNodeAt(e):null},indexOfNode:function(e){return this.hasCtab()?this.getCtab().indexOfNode(e):-1},hasNode:function(e,t){return this.hasCtab()?this.getCtab().hasNode(e,t):null},indexStackOfNode:function(e){return this.hasCtab()?this.getCtab().indexStackOfNode(e):-1},getNodeAtIndexStack:function(e){return this.hasCtab()?this.getCtab().getNodeAtIndexStack(e):null},getDirectChildOfNestedNode:function(e){var t=e.getParent();if(t){if(t===this)return t;for(var n=e;t&&t.getParent&&t!==this;)n=t,t=t.getParent();return t===this?n:null}return null},insertNodeBefore:function(e,t){return this.doGetCtab(!0).insertNodeBefore(e,t)},appendNode:function(e){return this.doGetCtab(!0).appendNode(e)},insertNodeAt:function(e,t){return this.doGetCtab(!0).insertNodeAt(e,t)},removeNodeAt:function(e,t){return this.hasCtab()?this.getCtab().removeNodeAt(e,t):null},removeNode:function(e,t){return this.hasCtab()?this.getCtab().removeNode(e,t):null},replaceNode:function(e,t){return this.hasCtab()?this.getCtab().replaceNode(e,t):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},sortNodes:function(e){if(this.hasCtab())return this.getCtab().sortNodes(e)},nodesHasCoord2D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(e,t)},nodesHasCoord3D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(e,t)},nodesHasCoordOfMode:function(e,t,n){return!!this.hasCtab()&&this.getCtab().nodesHasCoordOfMode(e,t,n)},isNodeInAromaticRing:function(e){for(var t=this.getAromaticRings(),n=0,i=t.length;n<i;++n)if(t[n].nodes.indexOf(e)>=0)return!0;return!1},appendAtom:function(e,t,n,i){return this.doGetCtab(!0).appendAtom(e,t,n,i)},getAnchorNodeCount:function(){return this.hasCtab()?this.getCtab().getAnchorNodeCount():0},getAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().getAnchorNodeAt(e):null},indexOfAnchorNode:function(e){return this.hasCtab()?this.getCtab().indexOfAnchorNode(e):-1},appendAnchorNode:function(e){return this.doGetCtab(!0).appendAnchorNode(e)},removeAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().removeAnchorNodeAt(e):null},removeAnchorNode:function(e){return this.hasCtab()?this.getCtab().removeAnchorNode(e):null},clearAnchorNodes:function(){if(this.hasCtab())return this.getCtab().clearAnchorNodes()},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(e){return this.hasCtab()?this.getCtab().getConnectorAt(e):null},indexOfConnector:function(e){return this.hasCtab()?this.getCtab().indexOfConnector(e):-1},hasConnector:function(e,t){return this.hasCtab()?this.getCtab().hasConnector(e,t):null},insertConnectorBefore:function(e,t){return this.doGetCtab(!0).insertConnectorBefore(e,t)},appendConnector:function(e){return this.doGetCtab(!0).appendConnector(e)},insertConnectorAt:function(e,t){return this.doGetCtab(!0).insertConnectorAt(e,t)},removeConnectorAt:function(e,t){return this.hasCtab()?this.getCtab().removeConnectorAt(e,t):null},removeConnector:function(e,t){return this.hasCtab()?this.getCtab().removeConnector(e,t):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},sortConnectors:function(e){if(this.hasCtab())return this.getCtab().sortConnectors(e)},isConnectorInAromaticRing:function(e){for(var t=this.getAromaticRings(),n=0,i=t.length;n<i;++n)if(t[n].connectors.indexOf(e)>=0)return!0;return!1},appendBond:function(e,t,n){return this.doGetCtab(!0).appendBond(e,t,n)},_getObjsNeedToBeCascadeRemoved:function(e,t){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(e,t):[]},removeChildObj:function(e,t,n){this.hasCtab()&&this.getCtab().removeChildObj(e,t,n)},hasChildObj:function(e){return!!this.hasCtab()&&this.getCtab().hasChildObj(e)},getNextSiblingOfChild:function(e){return this.hasCtab()&&this.getCtab().getNextSiblingOfChild(e)||this.tryApplySuper("getNextSiblingOfChild",[e])},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.SimpleStructureNode?"node":e instanceof Kekule.BaseStructureConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[e])},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){return this.hasCtab()?this.getCtab().getSubFragments():[]},hasSubFragments:function(){return!!this.hasCtab()&&this.getCtab().hasSubFragments()},getLeafNodes:function(){return this.hasCtab()?this.getCtab().getLeafNodes():[]},findDirectChildOfObj:function(e){return this.hasCtab()?this.getCtab().findDirectChildOfObj(e):null},getAllChildConnectors:function(){return this.hasCtab()?this.getCtab().getAllChildConnectors():[]},getAllContainingConnectors:function(){return this.hasCtab()?this.getCtab().getAllContainingConnectors():[]},getIsotopeMaps:function(){return this.hasCtab()?this.getCtab().getIsotopeMaps():[]},clear:function(){this.hasCtab()&&this.setCtab(void 0),this.hasFormula()&&this.setFormula(void 0)},clean:function(e){var t=Object.extend({},Kekule.globalOptions.algorithm.structureClean.structureCleanOptions);return t=Object.extend(t,e||{}),this.doClean(t)},doClean:function(e){if(e.hangingChemConnector)for(var t=this.getConnectorCount()-1;t>=0;--t){var n=this.getConnectorAt(t);n instanceof Kekule.ChemStructureConnector&&n.getConnectedObjCount()<2&&this.removeConnectorAt(t)}var i=this.getNodeCount();for(t=i-1;t>=0;--t){var r=this.getNodeAt(t);r instanceof Kekule.ChemStructureNode&&(this.isSubFragment(r)&&r.doClean?r.doClean(e):e.orphanChemNode&&r.getLinkedConnectorCount()<1&&i>1&&this.removeNodeAt(t))}return this},clearExplicitBondHydrogens:function(e,t){var n=this,i=function(c){var d=c.getLinkedConnectors(),h=d.length===1;if(h){var p=d[0];h=p.isSingleBond&&p.isSingleBond()&&p.getStereo&&(!p.getStereo()||p.getStereo()===Kekule.BondStereo.NONE)}return h},r=function(c,d){for(var h=c.getLinkedConnectors(),p=h.length;p>=0;--p){var g=h[p];n.hasConnector(g,!0)&&n.removeConnector(g,!1)}n.removeNodeAt(d,!1)},a=function(c,d,h){for(var p=c.getLinkedConnectors(),g=p.length;g>=0;--g){var f=p[g];if(n.hasConnector(f,!0)){{var m=c.getLinkedObjsOnConnector(f)[0],C=m.getStructureCacheData("omittedBondHydrogenAtomCount")||0;m.setStructureCacheData("omittedBondHydrogenAtomCount",C+1)}n.removeConnector(f,!1)}}n.removeNodeAt(d,!1)};if(e){var o=this.getAutoClearStructureCache();this.setAutoClearStructureCache(!1)}this.beginUpdate();try{for(var l=this.getNodeCount()-1;l>=0;--l){var u=this.getNodeAt(l);u instanceof Kekule.ChemStructureNode&&(this.isSubFragment(u)&&u.clearExplicitBondHydrogens?(u.clearExplicitBondHydrogens(e,t),u.getNodeCount()<=0&&r(u,l)):u.isHydrogenAtom()&&(t||i(u))&&a(u,l,!0))}}finally{this.endUpdate(),e&&this.setAutoClearStructureCache(o)}return this},calcFormula:function(){return this.hasCtab()?this.getCtab().calcFormula():this.hasFormula()?this.getFormula():null},marshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{this.appendNode(t);for(var n=[],i=[],r=[],a=[],o=0,l=e.length;o<l;++o){var u=e[o];if(!(this.indexOfNode(u)<0)){for(var c=!1,d=u.getLinkedConnectors(),h=0,p=d.length;h<p;++h){for(var g=d[h],f=!1,m=g.getConnectedObjs(),C=0,_=m.length;C<_;++C){var y=m[C];y!=u&&e.indexOf(y)<0&&(c=!0,f=!0)}f?Kekule.ArrayUtils.pushUnique(a,g):Kekule.ArrayUtils.pushUnique(r,g)}Kekule.ArrayUtils.pushUnique(n,u),c&&Kekule.ArrayUtils.pushUnique(i,u)}}for(o=r.length-1;o>=0;--o)this.removeConnector(r[o],!0);for(o=n.length-1;o>=0;--o)this.removeNode(n[o],!0);t.beginUpdate();try{for(o=0,l=n.length;o<l;++o)t.appendNode(n[o]);for(o=0,l=i.length;o<l;++o)t.appendAnchorNode(i[o]);for(o=0,l=r.length;o<l;++o)t.appendConnector(r[o])}finally{t.endUpdate()}}finally{this.endUpdate()}return t}return null},unmarshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{e.beginUpdate();try{t&&e.unmarshalAllSubFragments&&e.unmarshalAllSubFragments(t);var n=this.getCtab();Kekule.StructureFragment.moveChildBetweenStructFragment(e,this,e.getNodes(),e.getConnectors(),!0),e.clear(),n.removeNode(e)}finally{e.endUpdate(),e.finalize()}}finally{this.endUpdate()}}},unmarshalAllSubFragments:function(e){var t=this.getSubFragments();if(t)for(var n=0,i=t.length;n<i;++n)this.unmarshalSubFragment(t[n],e)},recalcCoords:function(){if(this.hasCtab()){this.beginUpdate();try{for(var e={},t={},n=this.getAnchorNodeCount(),i=0,r=n;i<r;++i){var a=this.getAnchorNodeAt(i);e=Kekule.CoordUtils.add(e,a.getCoord2D()||{}),t=Kekule.CoordUtils.add(t,a.getCoord3D()||{})}var o=Kekule.ObjUtils.notUnset,l=o(e.x)||o(e.y),u=o(t.x)||o(t.y)||o(t.z);if(l){var c=Kekule.CoordUtils.substract({},e);this.setCoord2D(Kekule.CoordUtils.substract(this.fetchCoord2D(),c))}if(u){var d=Kekule.CoordUtils.substract({},t);this.setCoord3D(Kekule.CoordUtils.substract(this.fetchCoord3D(),d))}for(i=0,r=this.getNodeCount();i<r;++i)a=this.getNodeAt(i),l&&a.setCoord2D(Kekule.CoordUtils.add(a.fetchCoord2D(),c)),u&&a.setCoord3D(Kekule.CoordUtils.add(a.fetchCoord3D(),d))}finally{this.endUpdate()}}},_copyAdditionalInfoToShadowFragment:function(e,t,n){var i=this.getAromaticRings();if(i&&i.length){for(var r=[],a=0,o=i.length;a<o;++a){for(var l=i[a],u=[],c=[],d=0,h=l.nodes.length;d<h;++d)(p=t.get(l.nodes[d]))&&u.push(p);for(d=0,h=l.connectors.length;d<h;++d){var p;(p=t.get(l.connectors[d]))&&c.push(p)}var g=Object.extend({},l);g.nodes=u,g.connectors=c,r.push(g)}e.setAromaticRings(r)}},getFlattenedShadowFragment:function(e){if(this.getFlattenedShadowOnSelf())return this;var t=this.getFlattenedShadow(e);return t?t.getShadowFragment():null},getFlatternedShadowShadowObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var n=this.getFlattenedShadow(t);return n?n.getShadowObj(e):null},getFlatternedShadowSourceObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var n=this.getFlattenedShadow(t);return n?n.getSourceObj(e):null},getFlatternedShadowShadowObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var n=this.getFlattenedShadow(t),i=[];if(n)for(var r=0,a=e.length;r<a;++r)i.push(n.getShadowObj(e[r]));return i},getFlatternedShadowSourceObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var n=this.getFlattenedShadow(t),i=[];if(n)for(var r=0,a=e.length;r<a;++r)i.push(n.getSourceObj(e[r]));return i},createShadow:function(){var e=new Kekule.StructureFragmentShadow(this);return this._copyAdditionalInfoToShadowFragment(e.getShadowFragment(),e.getSourceToShadowMap(),e.getShadowToSourceMap()),e},traverse:function(e,t,n,i){return this.hasCtab()?this.getCtab().traverse(e,t,n,i):null}}),Kekule.StructureFragment.moveChildBetweenStructFragment=function(e,t,n,i,r){var a=Kekule.CoordUtils;e.beginUpdate(),t.beginUpdate();var o=e.getAnchorNodes();try{for(var l=e.getAbsCoord2D(),u=e.getAbsCoord3D(),c=t.getAbsCoord2D(),d=t.getAbsCoord3D(),h=a.substract(l,c),p=a.substract(u,d),g=Kekule.ArrayUtils.clone(n),f=Kekule.ArrayUtils.clone(i),m=0,C=g.length;m<C;++m){var _=g[m];if((v=e.indexOfNode(_))>=0){e.removeNodeAt(v,!0);var y=_.getCoord2D();if(y){var T=a.add(y,h);_.setCoord2D(T)}var E=_.getCoord3D();if(E){var b=a.add(E,p);_.setCoord2D(b)}t.appendNode(_),o.indexOf(_)>=0&&(e.removeAnchorNode(_),r||t.appendAnchorNode(_))}}for(m=0,C=f.length;m<C;++m){var v,I=f[m];(v=e.indexOfConnector(I))>=0&&(e.removeConnectorAt(v,!0),t.appendConnector(I))}}finally{t.endUpdate(),e.endUpdate()}},Kekule.StructureFragmentShadow=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureFragmentShadow",initialize:function(e){if(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("shadowToSourceMap",new Kekule.MapEx),this.setPropStoreFieldValue("sourceToShadowMap",new Kekule.MapEx);var t=this._createShadowFragment(e,this.getSourceToShadowMap(),this.getShadowToSourceMap());this.setPropStoreFieldValue("shadowFragment",t)}else Kekule.error(Kekule.$L("ErrorMsg.SOURCE_FRAGMENT_NOT_SET"))},doFinalize:function(){this.getShadowToSourceMap().finalize(),this.getSourceToShadowMap().finalize(),this.getShadowFragment().finalize(),this.setPropStoreFieldValue("shadowToSourceMap",null),this.setPropStoreFieldValue("sourceToShadowMap",null),this.setPropStoreFieldValue("shadowFragment",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("shadowFragment",{dataType:"Kekule.StructureFragment",setter:null}),this.defineProp("sourceToShadowMap",{dataType:"Kekule.MapEx",setter:null}),this.defineProp("shadowToSourceMap",{dataType:"Kekule.MapEx",setter:null})},_createShadowFragment:function(e,t,n){var i=e.clone();return this._mapFragmentChildren(e,i,t,n),i},_mapFragmentChildren:function(e,t,n,i){for(var r=0,a=e.getChildCount();r<a;++r){var o=e.getChildAt(r),l=t.getChildAt(r);n.set(o,l),i.set(l,o),o.getChildCount&&l.getChildCount&&this._mapFragmentChildren(o,l,n,i)}},getShadowObj:function(e){return this.getSourceToShadowMap().get(e)},getSourceObj:function(e){return this.getShadowToSourceMap().get(e)}}),Kekule.SubGroup=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.SubGroup",initialize:function(e,t,n,i,r){this.tryApplySuper("initialize",[e,i,r]),this.setPropStoreFieldValue("abbr",t),this.setPropStoreFieldValue("name",n)},initProperties:function(){this.defineProp("abbr",{dataType:DataType.STRING}),this.defineProp("formulaText",{dataType:DataType.STRING}),this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"g"},doPropChanged:function(e,t){return e=="anchorNodes"&&this.recalcCoords(),this.tryApplySuper("doPropChanged",[e,t])},getLabel:function(){return this.getName()||this.getAbbr()||this.getFormulaText()||Kekule.ChemStructureNodeLabels.SUBGROUP}}),Kekule.RGroup=Kekule.SubGroup,Kekule.Molecule=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.Molecule",initialize:function(e,t,n){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("name",t),n&&this.setCtab(new Kekule.StructureConnectionTable)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"m"}}),Kekule.BaseStructureConnector=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureConnector",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setConnectedObjs(t||[])},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=this.getPropStoreFieldValue("connectedObjs");t||(this.setPropStoreFieldValue("connectedObjs",[]),t=this.getPropStoreFieldValue("connectedObjs"));for(var n=0,i=t.length;n<i;++n)t[n].removeLinkedConnector(this);if(e){for(n=0,i=e.length;n<i;++n)this.assertConnectedObjLegal(e[n]);for(n=0,i=e.length;n<i;++n){var r=e[n],a=r.getCurrConnectableObj?r.getCurrConnectableObj():r;Kekule.ArrayUtils.pushUnique(t,a)}}else this.setPropStoreFieldValue("connectedObjs",[]);for(n=0,i=(t=this.getPropStoreFieldValue("connectedObjs")).length;n<i;++n)t[n].appendLinkedConnector(this);this.notifyConnectedObjsChanged()}}),this.defineProp("neighboringConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getConnectedObjs(),n=0,i=t.length;n<i;++n){var r=t[n];r.getLinkedConnectors&&Kekule.ArrayUtils.pushUnique(e,r.getLinkedConnectors()||[])}return Kekule.ArrayUtils.remove(e,this),e}})},getAutoIdPrefix:function(){return"c"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["connectedObjs"])},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"connectedObjCount")){var i=this.getConnectedObjCount(),r=e.getConnectedObjCount&&e.getConnectedObjCount();n=this.doCompareOnValue(i,r,t)}return n},notifyConnectedObjsChanged:function(){this.notifyPropSet("connectedObjs",this.getPropStoreFieldValue("connectedObjs"))},assertConnectedObjLegal:function(e){if(e&&e.getOwner)return!e.getOwner()||e.getOwner()==this.getOwner()||(Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_DIFF_OWNER_OBJ"):"Object with different owner can not be linked to connector"),!1);Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_MISTYPED_NODE"):"Unable to link mistyped node to connector")},connectedObjAdded:function(e){this.notifyConnectedObjsChanged()},getConnectedObjCount:function(){return this.getConnectedObjs().length},indexOfConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)},getConnectedObjAt:function(e){return this.getConnectedObjs()[e]},setConnectedObjAt:function(e,t){this.assertConnectedObjLegal(t);var n=this.getConnectedObjs()[e];n&&n.removeLinkedConnector(this),this.insertConnectedObjAt(t,e),this.connectedObjAdded(t)},appendConnectedObj:function(e){this.assertConnectedObjLegal(e);var t=e.getCurrConnectableObj?e.getCurrConnectableObj():e,n=this._doAppendConnectedObj(t);return t&&t.appendLinkedConnector(this),n},_doAppendConnectedObj:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getConnectedObjs(),e);return t.isPushed&&this.connectedObjAdded(e),t.index},insertConnectedObjBefore:function(e,t){this.assertConnectedObjLegal(e);var n=t?t.getCurrConnectableObj?t.getCurrConnectableObj():t:null,i=n?this.indexOfConnectedObj(n):-1;return i<0?this.appendConnectedObj(e):this.insertConnectedObjAt(e,i)},insertConnectedObjAt:function(e,t){t||(t=0),this.assertConnectedObjLegal(e);var n=e.getCurrConnectableObj?e.getCurrConnectableObj():e,i=this.indexOfConnectedObj(n),r=this.getConnectedObjs();i>=0?(r.splice(i,1),r.splice(t,0,n),this.notifyConnectedObjsChanged()):(r.splice(t,0,n),n&&n.appendLinkedConnector(this),this.connectedObjAdded(n))},removeConnectedObjAt:function(e){var t=this.getConnectedObjs()[e];t&&(this._doRemoveConnectedObjAt(e),t._doRemoveLinkedConnectorAt(t.indexOfLinkedConnector(this)),this.notifyConnectedObjsChanged())},_doRemoveConnectedObjAt:function(e){this.getConnectedObjs().splice(e,1)},removeConnectedObj:function(e){var t=this.getConnectedObjs().indexOf(e);t>=0&&this.removeConnectedObjAt(t)},replaceConnectedObj:function(e,t){var n=this.indexOfConnectedObj(e);n>=0&&this.setConnectedObjAt(n,t)},clearConnectedObjs:function(){this.setConnectedObjs([])},hasConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)>=0},isConnectingWithObj:function(e){return this.hasConnectedObj(e)},sortConnectedObjs:function(e){this.getConnectedObjs().sort(e)},reverseConnectedObjOrder:function(){this.setPropStoreFieldValue("connectedObjs",Kekule.ArrayUtils.reverse(this.getConnectedObjs())),this.notifyConnectedObjsChanged()},removeThisFromConnectedObjs:function(){for(var e=this.getConnectedObjCount()-1;e>=0;--e)this.getConnectedObjAt(e).removeLinkedConnector(this)},getConnectedSiblings:function(){for(var e=this.getConnectedObjs(),t=[],n=this.getParent(),i=function(u){if(u.getParent){var c=u.getParent();return c===n?c:i(c)}return u},r=0,a=e.length;r<a;++r){var o=e[r];if(o.getParent&&o.getParent()!==n){var l=i(o);l&&t.push(l)}else t.push(o)}return t},isConnectingConnector:function(){for(var e=0,t=this.getConnectedObjCount();e<t;++e)if(this.getConnectedObjAt(e)instanceof Kekule.ChemStructureConnector)return!0;return!1}}),Kekule.ChemStructureConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.ChemStructureConnector",initProperties:function(){this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("connectedChemNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,n=this.getConnectedObjCount();t<n;++t){var i=this.getConnectedObjAt(t);i instanceof Kekule.ChemStructureNode&&e.push(i)}return e}})},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode||e instanceof Kekule.BaseStructureConnector)},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var i=this.getParity()||Kekule.StereoParity.UNKNOWN,r=e.getParity&&e.getParity()||Kekule.StereoParity.UNKNOWN;n=this.doCompareOnValue(i,r,t)}return n},clearStructureFlags:function(){this.setParity(Kekule.StereoParity.NONE)},getConnectedChemNodeCount:function(){return this.getConnectedChemNodes().length},getConnectedNonHydrogenObjs:function(){for(var e=[],t=this.getConnectedObjs(),n=0,i=t.length;n<i;++n){var r=t[n];r.isHydrogenAtom&&r.isHydrogenAtom()||e.push(r)}return e},isNormalConnectorToHydrogen:function(){return this.getConnectedNonHydrogenObjs().length<=1}}),Kekule.BondStereo={NONE:0,UP:1,UP_INVERTED:2,DOWN:3,DOWN_INVERTED:4,UP_OR_DOWN:8,UP_OR_DOWN_INVERTED:9,CLOSER:10,E_OR_Z:20,E:21,Z:22,E_Z_BY_COORDINATES:23,CIS_OR_TRANS:30,CIS:31,TRANS:32,getInvertedDirection:function(e){var t=Kekule.BondStereo;switch(e){case t.UP:return t.UP_INVERTED;case t.UP_INVERTED:return t.UP;case t.DOWN:return t.DOWN_INVERTED;case t.DOWN_INVERTED:return t.DOWN;case t.UP_OR_DOWN:return t.UP_OR_DOWN_INVERTED;default:return e}}},Kekule.Bond=Class.create(Kekule.ChemStructureConnector,{CLASS_NAME:"Kekule.Bond",initialize:function(e,t,n,i,r){this.tryApplySuper("initialize",[e,t||[]]),(n||i||r)&&this.setBondForm(Kekule.BondFormFactory.getBondForm(n,i,r))},initProperties:function(){this.defineProp("bondForm",{dataType:"Kekule.BondForm",serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var e=this.getBondForm();return e?e.getBondType():Kekule.BondType.DEFAULT},setter:function(e){this.changeBondForm(this.getBondOrder(),Kekule.ElectronSet.UNSET_ELECTRONCOUNT,e)}}),this.defineProp("bondOrder",{dataType:DataType.INT,enumSource:Kekule.BondOrder,getter:function(){var e=this.getBondForm();return e?e.getBondOrder():Kekule.BondOrder.UNSET},setter:function(e){this.changeBondForm(e,Kekule.ElectronSet.UNSET_ELECTRONCOUNT,this.getBondType())}}),this.defineProp("bondValence",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getBondForm();return e?e.getBondValence():0},setter:null}),this.defineProp("electronCount",{dataType:DataType.FLOAT,getter:function(){if(this.isAromatic())return 3;var e=this.getBondForm();return e?e.getElectronCount():Kekule.ElectronSet.UNSET_ELECTRONCOUNT},setter:function(e){var t=this.getBondOrder();this.changeBondForm(t,e,this.getBondType())}}),this.defineProp("stereo",{dataType:DataType.INT,enumSource:Kekule.BondStereo,defaultValue:Kekule.BondStereo.NONE}),this.defineProp("isInAromaticRing",{dataType:DataType.BOOL,setter:null,getter:function(){var e=this.getParent();return!(!e||!e.isConnectorInAromaticRing)&&e.isConnectorInAromaticRing(this)}}),this.defineProp("neighboringBonds",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=this.getNeighboringConnectors()||[],t=[],n=0,i=e.length;n<i;++n)e[n]instanceof Kekule.Bond&&t.push(e[n]);return t}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("stereo",Kekule.BondStereo.NONE)},getAutoIdPrefix:function(){return"b"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["bondForm","stereo"])},clearStructureFlags:function(){this.setPropStoreFieldValue("isInAromaticRing",null)},doGetParity:function(){return this.isDoubleBond()?this.tryApplySuper("doGetParity"):null},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"bondType")&&t.push("bondType"),t},doCompare:function(e,t){var n=this.tryApplySuper("doCompare",[e,t]);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(t,"connectedObjCount")){var i=this.getConnectedObjCount(),r=e.getConnectedObjCount&&e.getConnectedObjCount();n=this.doCompareOnValue(i,r,t)}if(!n&&this._getComparisonOptionFlagValue(t,"bondOrder")){var a=Math.round(this.getElectronCount()),o=Math.round(e.getElectronCount());n=this.doCompareOnValue(a,o,t)}}return n},changeBondForm:function(e,t,n){this.setBondForm(Kekule.BondFormFactory.getBondForm(e,t,n))},canInvertBondDirection:function(){var e=Kekule.BondType,t=this.getBondType();return[e.COVALENT,e.IONIC,e.METALLIC,e.HYDROGEN,e.UNKNOWN].indexOf(t)>=0},invertBondDirection:function(){this.setStereo(Kekule.BondStereo.getInvertedDirection(this.getStereo()))},reverseConnectedObjOrder:function(){this.canInvertBondDirection()&&(this.tryApplySuper("reverseConnectedObjOrder"),this.invertBondDirection())},normalizeDirection:function(){var e=Kekule.BondStereo,t=[e.UP_INVERTED,e.DOWN_INVERTED,e.UP_OR_DOWN_INVERTED],n=this.getBondStereo();t.indexOf(n)>=0&&this.reverseConnectedObjOrder()},isCovalentBond:function(){return this.getBondType()===Kekule.BondType.COVALENT},isSingleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.SINGLE&&!this.getIsInAromaticRing()},isDoubleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.DOUBLE&&!this.getIsInAromaticRing()},isTripleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.TRIPLE},isAromatic:function(){return(!!this.getIsInAromaticRing()||this.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)&&this.getBondType()===Kekule.BondType.COVALENT},isBondBetween:function(e,t){var n,i,r=this.getConnectedObjs();if(r.length!==2)return!1;for(var a=0,o=r.length;a<o;++a){var l=r[a];if(l instanceof Kekule.Atom&&(l.isElement(e)?n=!0:l.isElement(t)&&(i=!0),n&&i))return!0}return!1}}),Kekule.ChemStructureObjectGroup=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.ChemStructureObject","Kekule.ChemStructureObjectGroup"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("items",[]),this.setPropStoreFieldValue("raiseExceptionOnTypeMismatch",[])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY}),this.defineProp("raiseExceptionOnTypeMismatch",{dataType:DataType.BOOL,defaultValue:!0,scope:Class.PropertyScope.PUBLIC})},getAutoIdPrefix:function(){return"sg"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["items"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&t.push("items"),t},ownerChanged:function(e,t){for(var n=this.getItems(),i=0,r=n.length;i<r;++i){var a=n[i].obj;a&&a.setOwner&&a.setOwner(e)}this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfObj(e);t<0&&(t=this.indexOfItem(e)),t>=0&&this.removeObjAt(t),this.tryApplySuper("_removeChildObj",[e])},getObjectBaseClasses:function(){return this.getPrototype().ITEM_BASE_CLASSES},ensureItemClass:function(e){var t=this.getObjectBaseClasses();if(t.length>0){for(var n=0,i=t.length;n<i;++n)if(e instanceof ClassEx.findClass(t[n]))return!0;if(this.getRaiseExceptionOnTypeMismatch()){var r=Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH"):"Mismatched group item class";Kekule.raise(r)}return!1}return!0},notifyItemsChanged:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},indexOfItem:function(e){return this.getItems().indexOf(e)},indexOfObj:function(e){for(var t=this.getItems(),n=0,i=t.length;n<i;++n)if(t[n].obj==e)return n;return-1},hasObj:function(e){return this.indexOfObj(e)>=0},setAttributesAt:function(e,t){var n=this.getItems()[e];if(n)for(var i=Kekule.ObjUtils.getOwnedFieldNames(t),r=0,a=i.length;r<a;++r)n[i[r]]=t[i[r]]},getItemCount:function(){return this.getItems().length},getItemAt:function(e){return this.getItems()[e]},appendItem:function(e){return this.getItems().push(e),this},insertItem:function(e,t){return this.insertItemAt(e,t)},insertItemAt:function(e,t){return Kekule.ArrayUtils.insertUniqueEx(this.getItems(),e,t).index},removeItemAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeItem:function(e){var t=this.getItems().indexOf(e);t>=0&&this.removeItemAt(t)},getObjAt:function(e){var t=this.getItemAt(e);return t?t.obj:null},insertObj:function(e,t,n){return this.insertObjAt(e,t,n)},insertObjAt:function(e,t,n){if(e&&!(this.indexOfObj(e)>=0)){if(this.ensureItemClass(e)){var i={obj:e};this.beginUpdate();try{var r=this.insertItem(i,t);n&&this.setAttributesAt(r,n),this.notifyItemsChanged()}finally{this.endUpdate()}return r}}},appendObj:function(e,t){return this.insertObj(e,null,t)},removeObjAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeObj:function(e){var t=this.indexOfObj(e);t>=0&&this.removeObjAt(t)},getAllObjs:function(){for(var e=[],t=0,n=this.getItemCount();t<n;++t)e.push(this.getObjAt(t));return e},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return"item"},getNextSiblingOfChild:function(e){var t=this.indexOfItem(e);return t<0&&(t=this.indexOfObj(e)),t>=0?this.getChildAt(t+1):null},appendChild:function(e){return e instanceof Kekule.ChemObject?this.appendObj(e):this.appendItem(e)},insertChild:function(e,t){return e instanceof Kekule.ChemObject?this.insertObj(e,t):this.insertItem(e,t)},insertBefore:function(e,t){var n=this.indexOfItem(t);return n<0&&(n=this.indexOfObj(t)),this.insertChild(e,n)}}),Kekule.StructureFragmentGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.StructureFragment","Kekule.StructureFragmentGroup"]}),Kekule.MoleculeGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.MoleculeGroup",ITEM_BASE_CLASSES:["Kekule.Molecule","Kekule.MoleculeGroup"]}),Kekule.CompositeMolecule=Class.create(Kekule.Molecule,{CLASS_NAME:"Kekule.CompositeMolecule",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("subMolecules",{dataType:"Kekule.MoleculeGroup",getter:function(){return this.getPropStoreFieldValue("subMolecules")||this.setPropStoreFieldValue("subMolecules",new Kekule.MoleculeGroup),this.getPropStoreFieldValue("subMolecules")}})},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&t.push("subMolecules"),t},ownerChanged:function(e,t){var n=this.getPropStoreFieldValue("subMolecules");n&&n.setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},getSubMoleculeCount:function(){var e=this.getPropStoreFieldValue("subMolecules");return e?e.length:0},hasCtab:function(){return!1},hasFormula:function(){return!1},getAllContainingConnectors:function(){for(var e=this.getSubMolecules(),t=[],n=0,i=e.getItemCount();n<i;++n){var r=e.getObjAt(n);if(r.getAllContainingConnectors){var a=r.getAllContainingConnectors();a&&a.length&&(t=t.concat(a))}}return t},getContainerBox:function(e){var t=null,n=this.getPropStoreFieldValue("subMolecules");if(n)for(var i=0,r=n.getItemCount();i<r;++i){var a=n.getObjAt(i).getContainerBox(e);a&&(t=t?Kekule.BoxUtils.getContainerBox(t,a):Kekule.BoxUtils.clone(a))}return t},doGetCtab:function(){return null},doSetCtab:function(){},doGetFormula:function(){return null},doSetFormula:function(){},getChildSubgroupNames:function(){return["subMolecule"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Molecule?"subMolecule":this.tryApplySuper("getBelongChildSubGroupName",[e])},getNextSiblingOfChild:function(e){return this.getSubMolecules().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.insertChildAt(e,t)}}),Kekule.MoleculeList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.MoleculeList",initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.Molecule])}}),Kekule.ChemStructureNodeLabels={ENABLE_ISOTOPE_ALIAS:!0,UNSET_ELEMENT:"?",DUMMY_ATOM:"Du",HETERO_ATOM:"Q",ANY_ATOM:"A",CUSTOM_ATOM:"@",VARIABLE_ATOM:"L",SUBGROUP:"R",ISO_LIST_LEADING_BRACKET:"[",ISO_LIST_TAILING_BRACKET:"]",ISO_LIST_DELIMITER:",",ISO_LIST_DISALLOW_PREFIX:"NOT"},Kekule.ChemStructureNodeFactory={CANDIDATE_CLASSES:[Kekule.SubGroup,Kekule.VariableAtom,Kekule.Pseudoatom],getClassByLabel:function(e,t){t===void 0&&(t=Kekule.Pseudoatom);for(var n,i=Kekule.ChemStructureNodeLabels,r=[[i.SUBGROUP],[i.VARIABLE_ATOM],[i.DUMMY_ATOM,i.HETERO_ATOM,i.ANY_ATOM,i.CUSTOM_ATOM]],a=Kekule.ChemStructureNodeFactory.CANDIDATE_CLASSES,o=0,l=a.length;o<l;++o){var u=a[o];if(r[o].indexOf(e)>=0){n=u;break}}return n||(n=Kekule.IsotopesDataUtil.isIsotopeIdAvailable(e)?Kekule.Atom:t),n},createByLabel:function(e){var t=new(Kekule.ChemStructureNodeFactory.getClassByLabel(e));return t instanceof Kekule.Pseudoatom?t.setSymbol(e):t instanceof Kekule.Atom&&t.setIsotopeId(e),t}}}(),Kekule.ChemStructureBuilder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructureBuilder",initialize:function(s){this.tryApplySuper("initialize"),s&&this.setTarget(s)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.StructureFragment"})},setNodeCoord:function(){for(var s=Array.prototype.slice.call(arguments),e=s.shift(),t=s,n=0,i=t.length;n<i&&n<2;++n){var r=t[n];r.z!==void 0?e.setCoordOfMode(r,Kekule.CoordMode.COORD3D):e.setCoordOfMode(r,Kekule.CoordMode.COORD2D)}},createNode:function(){var s=Array.prototype.slice.call(arguments),e=s.shift(),t=s.shift(),n=s,i=new e(t);return this.setNodeCoord(i,n),this.appendNode(i),i},createConnector:function(s,e,t){var n=new s(e);return n.setConnectedObjs(t),n},appendNode:function(s){return s&&this.getTarget()?this.getTarget().appendNode(s):null},appendConnector:function(s){return s&&this.getTarget()?this.getTarget().appendConnector(s):null},createAtom:function(){var s=Array.prototype.slice.call(arguments),e=s.shift(),t=s.shift(),n=s.shift(),i=new Kekule.Atom(e,t,n);return s.unshift(i),this.setNodeCoord.apply(this,s),this.appendNode(i),i},createBond:function(s,e,t,n,i){var r=new Kekule.Bond(s,e,t);return r.changeBondForm(t,null,i),n&&r.setStereo(n),this.appendConnector(r),r},deleteNode:function(){},marshalSubGroup:function(s,e){var t=this.getTarget();if(t&&t.hasCtab()){var n=new Kekule.SubGroup(e);return t.marshalSubFragment(s,n),n}return null}}),Kekule.ReactionComponent={REACTANT:"reactant",PRODUCT:"product",SUBSTANCE:"substance",CONDITION:"condition"},Kekule.ReactionRole={REAGENT:"reagent",CATALYST:"catalyst",SOLVENT:"solvent",TEMPERATURE:"temperature",DURATION:"duration"},Kekule.ReactionDirection={FORWARD:1,BACKWARD:-1,BIDIRECTION:0},Kekule.Reaction=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Reaction",initialize:function(s){this.tryApplySuper("initialize",[s]),this.setDirection(Kekule.ReactionDirection.FORWARD)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("reactionType",{dataType:DataType.STRING}),this.defineProp("yield",{dataType:DataType.FLOAT}),this.defineProp("direction",{dataType:DataType.INT,defaultValue:Kekule.ReactionDirection.FORWARD,enumSource:Kekule.ReactionDirection}),this.defineProp("reactants",{dataType:DataType.ARRAY,setter:null,getter:function(s){var e=this.getPropStoreFieldValue("reactants");return!e&&s&&(e=[],this.setPropStoreFieldValue("reactants",e)),e}}),this.defineProp("products",{dataType:DataType.ARRAY,setter:null,getter:function(s){var e=this.getPropStoreFieldValue("products");return!e&&s&&(e=[],this.setPropStoreFieldValue("products",e)),e}}),this.defineProp("substances",{dataType:DataType.ARRAY,setter:null,getter:function(s){var e=this.getPropStoreFieldValue("substances");return!e&&s&&(e=[],this.setPropStoreFieldValue("substances",e)),e}}),this.defineProp("conditions",{dataType:DataType.ARRAY,setter:null,getter:function(s){var e=this.getPropStoreFieldValue("conditions");return!e&&s&&(e=[],this.setPropStoreFieldValue("conditions",e)),e}})},ownerChanged:function(s,e){for(var t=["reactants","products","substances","conditions"],n=0,i=t.length;n<i;++n){var r=t[n],a=this.getComponentArray(r);if(a)for(var o=0,l=a.length;o<l;++o){var u=a[o].item;u.setOwner&&u.setOwner(s)}}this.tryApplySuper("ownerChanged",[s,e])},assertAddingMolecule:function(s){s instanceof Kekule.Molecule||Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_ADD_NONMOLECULE_MAP"))},notifyReactantsChange:function(){this.notifyPropSet("reactants",this.getPropStoreFieldValue("reactants"))},notifyProductsChange:function(){this.notifyPropSet("products",this.getPropStoreFieldValue("products"))},notifySubstancesChange:function(){this.notifyPropSet("substances",this.getPropStoreFieldValue("substances"))},notifyConditionsChange:function(){this.notifyPropSet("conditions",this.getPropStoreFieldValue("conditions"))},notifyComponentChange:function(s){var e=this.componentToPropName(s);e&&this.notifyPropSet(e,this.getPropStoreFieldValue(e))},componentToPropName:function(s){return s+"s"},getComponentArray:function(s,e){var t=this.componentToPropName(s);if(!t)return null;switch(t){case"reactants":return this.doGetReactants(e);case"products":return this.doGetProducts(e);case"substances":return this.doGetSubstances(e);case"conditions":return this.doGetConditions(e);default:return null}},getComponentItemCount:function(s){var e=this.getComponentArray(s);return e?e.length:0},getMapAt:function(s,e){var t=this.getComponentArray(s);return t?t[e]:null},getMapItemAt:function(s,e){var t=this.getMapAt(s,e);return t?t.item:null},indexOfMap:function(s,e){var t=this.getComponentArray(s);return t?t.indexOf(e):-1},indexOfItem:function(s,e,t){var n=this.getComponentArray(s);if(n){for(var i=0,r=n.length;i<r;++i)if(n[i].item==e&&(t===void 0||t===n[i].role))return i}return-1},appendMap:function(s,e){s!=Kekule.ReactionComponent.PRODUCT&&s!=Kekule.ReactionComponent.REACTANT||this.assertAddingMolecule(e.item);var t=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(s,!0),e);return t.isPushed&&this.notifyComponentChange(s),t.index},appendItem:function(s,e,t,n){var i=this.indexOfItem(s,e,t);if(i<0){s!=Kekule.ReactionComponent.PRODUCT&&s!=Kekule.ReactionComponent.REACTANT||this.assertAddingMolecule(e);var r=Kekule.RoleMapUtils.createMap(e,t);n&&Object.extend(r,n);var a=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(s,!0),r);return this.notifyComponentChange(s),a.index}return i},removeMapAt:function(s,e){var t=null,n=this.getComponentArray(s);return n&&(t=Kekule.ArrayUtils.removeAt(n,e))&&this.notifyComponentChange(s),t},removeMap:function(s,e){var t=null,n=this.getComponentArray(s);return n&&(t=Kekule.ArrayUtils.remove(n,e))&&this.notifyComponentChange(s),t},removeItem:function(s,e,t){var n=this.indexOfItem(s,e,t);return n>=0?this.removeMapAt(s,n):null},clearComponent:function(s){this.getComponentArray(s),this.notifyComponentChange(s)},getReactantCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.REACTANT)},getProductCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.PRODUCT)},getSubstancesCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.SUBSTANCE)},getConditionCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.CONDITION)},getReactantMapAt:function(s){return this.getMapAt(Kekule.ReactionComponent.REACTANT,s)},getProductMapAt:function(s){return this.getMapAt(Kekule.ReactionComponent.PRODUCT,s)},getSubstanceMapAt:function(s){return this.getMapAt(Kekule.ReactionComponent.SUBSTANCE,s)},getConditionMapAt:function(s){return this.getMapAt(Kekule.ReactionComponent.CONDITION,s)},getReactantItemAt:function(s){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,s)},getReactantAt:function(s){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,s)},getProductItemAt:function(s){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,s)},getProductAt:function(s){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,s)},getSubstanceItemAt:function(s){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,s)},getSubstanceAt:function(s){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,s)},getConditionItemAt:function(s){return this.getMapItemAt(Kekule.ReactionComponent.CONDITION,s)},indexOfReactantMap:function(s){return this.indexOfMap(Kekule.ReactionComponent.REACTANT,s)},indexOfProductMap:function(s){return this.indexOfMap(Kekule.ReactionComponent.PRODUCT,s)},indexOfSubstanceMap:function(s){return this.indexOfMap(Kekule.ReactionComponent.SUBSTANCE,s)},indexOfConditionMap:function(s){return this.indexOfMap(Kekule.ReactionComponent.CONDITION,s)},indexOfReactant:function(s,e){return this.indexOfItem(Kekule.ReactionComponent.REACTANT,s,e)},indexOfProduct:function(s,e){return this.indexOfItem(Kekule.ReactionComponent.PRODUCT,s,e)},indexOfSubstance:function(s,e){return this.indexOfItem(Kekule.ReactionComponent.SUBSTANCE,s,e)},indexOfCondition:function(s,e){return this.indexOfItem(Kekule.ReactionComponent.CONDITION,s,e)},appendReactantMap:function(s){return this.appendMap(Kekule.ReactionComponent.REACTANT,s)},appendProductMap:function(s){return this.appendMap(Kekule.ReactionComponent.PRODUCT,s)},appendSubstanceMap:function(s){return this.appendMap(Kekule.ReactionComponent.SUBSTANCE,s)},appendConditionMap:function(s){return this.appendMap(Kekule.ReactionComponent.CONDITION,s)},appendReactant:function(s,e,t,n){var i=n||{};return t&&(i.amount=t),this.appendItem(Kekule.ReactionComponent.REACTANT,s,e,i)},appendProduct:function(s,e,t,n){var i=n||{};return t&&(i.amount=t),this.appendItem(Kekule.ReactionComponent.PRODUCT,s,e,i)},appendSubstance:function(s,e,t,n){var i=n||{};return t&&(i.amount=t),this.appendItem(Kekule.ReactionComponent.SUBSTANCE,s,e,i)},appendCondition:function(s,e,t){return this.appendItem(Kekule.ReactionComponent.CONDITION,s,e,t)},removeReactantAt:function(s){return this.removeMapAt(Kekule.ReactionComponent.REACTANT,s)},removeProductAt:function(s){return this.removeMapAt(Kekule.ReactionComponent.PRODUCT,s)},removeSubstanceAt:function(s){return this.removeMapAt(Kekule.ReactionComponent.SUBSTANCE,s)},removeConditionAt:function(s){return this.removeMapAt(Kekule.ReactionComponent.CONDITION,s)},removeReactantMap:function(s){return this.removeMap(Kekule.ReactionComponent.REACTANT,s)},removeProductMap:function(s){return this.removeMap(Kekule.ReactionComponent.PRODUCT,s)},removeSubstanceMap:function(s){return this.removeMap(Kekule.ReactionComponent.SUBSTANCE,s)},removeConditionMap:function(s){return this.removeMap(Kekule.ReactionComponent.CONDITION,s)},removeReactant:function(s,e){return this.removeItem(Kekule.ReactionComponent.REACTANT,s,e)},removeProduct:function(s,e){return this.removeItem(Kekule.ReactionComponent.PRODUCT,s,e)},removeSubstance:function(s,e){return this.removeItem(Kekule.ReactionComponent.SUBSTANCE,s,e)},removeCondition:function(s,e){return this.removeItem(Kekule.ReactionComponent.CONDITION,s,e)},clearReactants:function(){return this.clearComponent(Kekule.ReactionComponent.REACTANT)},clearProducts:function(){return this.clearComponent(Kekule.ReactionComponent.PRODUCT)},clearSubstance:function(){return this.clearComponent(Kekule.ReactionComponent.SUBSTANCE)},clearConditions:function(){return this.clearComponent(Kekule.ReactionComponent.CONDITION)},clearAll:function(){this.clearProducts(),this.clearProducts(),this.clearSubstance(),this.clearConditions()},getAllContainingConnectors:function(){for(var s=Kekule.ReactionComponent,e=[s.REACTANT,s.PRODUCT,s.SUBSTANCE],t=[],n=0,i=e.length;n<i;++n)for(var r=e[n],a=0,o=this.getComponentItemCount(r);a<o;++a){var l=this.getMapItemAt(r,a);if(l.getAllContainingConnectors){var u=l.getAllContainingConnectors();u&&u.length&&(t=t.concat(u))}}return t}}),Kekule.ReactionList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.ReactionList",initialize:function(s){this.tryApplySuper("initialize",[s,Kekule.Reaction])}}),function(){var s=Kekule.ArrayUtils;Kekule.ChemStructureUtils={getConnectorLengthMedian:function(n,i,r){for(var a=[],o=0,l=n.length;o<l;++o){var u=n[o];if(u&&u.getLength){var c=u.getLength(i,r);c&&a.push(c)}}if(l===0)return 1;if(l<=1)return a[0];a.sort();var d=a.length;return d%2?a[d+1>>1]:(a[d>>1]+a[(d>>1)-1])/2},getChildStructureObjs:function(n,i){var r,a=!0;if(n instanceof Kekule.CompositeMolecule)r=n.getSubMolecules().getAllObjs();else if(n instanceof Kekule.ChemStructureObjectGroup)r=n.getAllObjs();else if(n instanceof Kekule.ChemObjList)r=n.getItems();else if(n instanceof Kekule.ChemSpaceElement)r=n.getChildren().getItems();else{if(!(n instanceof Kekule.ChemSpace))return a=!1,[n];r=n.getChildren()}if(r=[].concat(r),i&&a){for(var o=[],l=0,u=r.length;l<u;++l){var c=r[l],d=Kekule.ChemStructureUtils.getChildStructureObjs(c,i);!d.length||d.length===1&&d[0]===c?Kekule.ArrayUtils.pushUnique(o,c):Kekule.ArrayUtils.pushUnique(o,d)}r=o}return r},getAllStructFragments:function(n,i){if(n instanceof Kekule.StructureFragment)return[n];for(var r=Kekule.ChemStructureUtils.getChildStructureObjs(n,i),a=[],o=0,l=r.length;o<l;++o)r[o]instanceof Kekule.StructureFragment&&Kekule.ArrayUtils.pushUnique(a,r[o]);return a},getTotalStructFragment:function(n,i){var r=Kekule.ChemStructureUtils.getAllStructFragments(n,!0),a=r.length;return a<=0?null:a===1?r[0]:Kekule.ChemStructureUtils.mergeStructFragments(r,i)},getCascadeDeleteObjs:function(n){for(var i=[],r=n.getLinkedConnectors?n.getLinkedConnectors():[],a=0,o=r.length;a<o;++a){var l=r[a];if(l.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(i,l);var u=Kekule.ChemStructureUtils.getCascadeDeleteObjs(l);Kekule.ArrayUtils.pushUnique(i,u)}}if(!(n instanceof Kekule.ChemStructureNode)){if(n instanceof Kekule.ChemStructureConnector){var c=n.getConnectedObjs();for(a=0,o=c.length;a<o;++a){var d=c[a];d instanceof Kekule.ChemStructureNode&&d.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(i,d)}}}return i},moveChildBetweenStructFragment:function(n,i,r,a,o){return Kekule.StructureFragment.moveChildBetweenStructFragment(n,i,r,a,o)},_getCascadeConnectedNodesAndConnectors:function(n,i){for(var r=[],a=[],o=n.getConnectedObjs(),l=0,u=o.length;l<u;++l){var c=o[l];if(c!==n){if(i&&(c=i.findDirectChildOfObj(c)),c instanceof Kekule.ChemStructureNode)Kekule.ArrayUtils.pushUnique(a,c);else if(c instanceof Kekule.ChemStructureConnector){Kekule.ArrayUtils.pushUnique(r,c);var d=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(c);Kekule.ArrayUtils.pushUnique(r,d.connectors),Kekule.ArrayUtils.pushUnique(a,d.nodes)}}}return{connectors:r,nodes:a}},mergeStructFragments:function(n,i){if(n.length<=1)return n[0];for(var r=new(i||Kekule.Molecule),a=0,o=n.length;a<o;++a){var l=n[a].clone();Kekule.ChemStructureUtils.moveChildBetweenStructFragment(l,r,l.getNodes(),l.getConnectors())}return r},splitStructFragment:function(n){if(!n.hasCtab())return[n];var i=n.getNodes();if(i.length<=0)return[n];var r=n.getConnectors(),a=[],o=[i[0]],l=[],u=0;do{var c=o[u],d=c.getLinkedConnectors();c.getCrossConnectors&&d.concat(c.getCrossConnectors()||[]),Kekule.ArrayUtils.pushUnique(l,d);for(var h=0,p=d.length;h<p;++h){var g=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(d[h],n);Kekule.ArrayUtils.pushUnique(l,g.connectors),Kekule.ArrayUtils.pushUnique(o,g.nodes)}++u}while(u<o.length);a.push(n);var f=Kekule.ArrayUtils.exclude(i,o),m=Kekule.ArrayUtils.exclude(r,l);if(f.length>0){var C=new(n.getClass());Kekule.ChemStructureUtils.moveChildBetweenStructFragment(n,C,f,m);var _=Kekule.ChemStructureUtils.splitStructFragment(C);a=a.concat(_)}return a},getAbsCoordVectorBetweenObjs:function(n,i,r,a){var o=n.getAbsCoordOfMode(r,a),l=i.getAbsCoordOfMode(r,a);return Kekule.CoordUtils.substract(l,o)},_getRef2DCoordOfObj:function(n,i){return n.getAbsBaseCoord2D?n.getAbsBaseCoord2D(i):n.getAbsCoord2D?n.getAbsCoord2D(i):n.getCoord2D(i)},_getStandardizedLinkedObj2DRelCoords:function(n,i,r,a,o){var l=[],u=Kekule.ChemStructureUtils._getRef2DCoordOfObj(n,r),c=o?n.getLinkedObjs():n.getLinkedExposedObjs();a&&n.getAttachedMarkers&&(c=c.concat(n.getAttachedMarkers()||[])),i&&i.length&&(c=s.exclude(c,i));for(var d=0,h=c.length;d<h;++d){var p=c[d],g=Kekule.ChemStructureUtils._getRef2DCoordOfObj(p,r),f=Kekule.CoordUtils.substract(g,u);f=Kekule.CoordUtils.standardize(f),l.push(f)}return l},_calcLinkedObj2DAnglesOfObj:function(n,i,r,a,o){for(var l=[],u=Kekule.ChemStructureUtils._getStandardizedLinkedObj2DRelCoords(n,i,r,a,o),c=0,d=u.length;c<d;++c){var h=u[c];if(h.x!==0||h.y!==0){var p=Math.atan2(h.y,h.x);p<0&&(p=2*Math.PI+p),l.push(p)}}return l.sort(),l},_getMostEmptyDirectionOfExistingAngles:function(n){var i=n.length;if(i===0)return 0;if(i===1)return Kekule.GeometryUtils.standardizeAngle(Math.PI+n[0]);for(var r=0,a=0,o=0;o<i;++o){var l=n[o],u=n[(o+1)%i]-l;u<0&&(u+=2*Math.PI),u>r&&(r=u,a=o)}return n[a]+r/2},getMostEmptyDirection2DAngleOfObj:function(n,i,r,a,o,l){var u=Kekule.ChemStructureUtils._calcLinkedObj2DAnglesOfObj(n,i,r,a,o);return l&&(u=u.concat(l)).sort(),Kekule.ChemStructureUtils._getMostEmptyDirectionOfExistingAngles(u)},isSameRing:function(n,i){return n.nodes.length===i.nodes.length&&n.connectors.length===i.connectors.length&&!(s.exclude(n.nodes,i.nodes).length>0)&&!(s.exclude(n.connectors,i.connectors).length>0)},isInRings:function(n,i){for(var r=0,a=i.length;r<a;++r){var o=i[r];if(n===o||Kekule.ChemStructureUtils.isSameRing(n,o))return!0}return!1},getImplicitHydrogenCount:function(n,i){var r=Object.extend({coValenceBondValenceSum:0,otherBondValenceSum:0,charge:0,radicalECount:0},i||{},!0),a=Kekule.ValenceUtils.getImplicitValence(n,r.charge,r.coValenceBondValenceSum),o=(a-=r.radicalECount)-r.coValenceBondValenceSum-r.otherBondValenceSum;return r.allowNegative||(o=Math.max(a-r.coValenceBondValenceSum-r.otherBondValenceSum,0)),o}},Kekule.TokenAnalyzer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TokenAnalyzer",initialize:function(n){this.tryApplySuper("initialize"),this.setSrcText(n)},initProperties:function(){this.defineProp("srcText",{dataType:DataType.STRING,setter:function(n){var i=n||"";this.setPropStoreFieldValue("srcText",i),this.setPropStoreFieldValue("srcLength",i.length),this.setCurrPos(0)}}),this.defineProp("srcLength",{dataType:DataType.INT,setter:null,serializable:!1}),this.defineProp("currPos",{dataType:DataType.INT,serializable:!1})},getCharType:function(n){return 0},isCharTypeMatched:function(n,i){return n===i},nextCharInfo:function(){var n=this.getCurrPos();if(n>=this.getSrcLength())return null;var i=this.getSrcText().charAt(n);return this.setCurrPos(n+1),{char:i,charType:this.getCharType(i)}},nextTokenInfo:function(){var n=this.nextCharInfo();if(n){for(var i=n.char,r=n.charType,a=this.nextCharInfo();a&&this.isCharTypeMatched(a.charType,n.charType);)i+=a.char,n=a,a=this.nextCharInfo();return a&&this.setCurrPos(this.getCurrPos()-1),{token:i,tokenType:r}}return null},getAllTokenInfos:function(){for(var n=[],i=this.nextTokenInfo();i;)n.push(i),i=this.nextTokenInfo();return n}}),Kekule.ChemTextTypes={CT_ATOM_SYMBOL_LEADING:1,CT_ATOM_SYMBOL_FOLLOWING:2,CT_CHARGE_SYMBOL:3,CT_NUMBER:4,CT_BRACKET_LEADING:10,CT_BRACKET_TAILING:11,CT_SEPARATOR:20,CT_UNKNOWN:0};var e=Kekule.ChemTextTypes;Kekule.ChemTextAnalyzer=Class.create(Kekule.TokenAnalyzer,{CLASS_NAME:"Kekule.ChemTextAnalyzer",getCharType:function(n){return n===" "?e.CT_SEPARATOR:n>="0"&&n<="9"?e.CT_NUMBER:["+","-"].indexOf(n)>=0?e.CT_CHARGE_SYMBOL:["(","[","{"].indexOf(n)>=0?e.CT_BRACKET_LEADING:[")","]","}"].indexOf(n)>=0?e.CT_BRACKET_TAILING:n>="A"&&n<="Z"?e.CT_ATOM_SYMBOL_LEADING:n>="a"&&n<="z"?e.CT_ATOM_SYMBOL_FOLLOWING:e.CT_UNKNOWN},isCharTypeMatched:function(n,i){return!Kekule.ArrayUtils.intersect([e.CT_BRACKET_LEADING,e.CT_BRACKET_TAILING],[n,i]).length&&(n===i&&i!==e.CT_ATOM_SYMBOL_LEADING||i===e.CT_ATOM_SYMBOL_LEADING&&n===e.CT_ATOM_SYMBOL_FOLLOWING)}}),Kekule.FormulaUtils={FORMULA_BRACKETS:[["(",")"],["[","]"],["{","}"]],FORMULA_BRACKET_TYPE_COUNT:3,textToFormula:function(n,i,r){var a=r||null;a&&a.clear();var o=new Kekule.ChemTextAnalyzer(n);try{var l=o.getAllTokenInfos();a||(a=new Kekule.MolecularFormula(i));var u=l.length;if(u){var c,d,h=null,p=a;c={};for(var g=function(){c={}},f=function(){c&&c.obj&&p.appendSection(c.obj,c.count,c.charge)},m=0;m<u;++m){var C=l[m],_=C.tokenType,y=C.token,T=!1;if(_===e.CT_BRACKET_LEADING){f();var E=new Kekule.MolecularFormula(i);E._parentFormula=p,p=E,g(),T=!0}else if(_===e.CT_BRACKET_TAILING)f(),g(),c.obj=p,p=p._parentFormula,C.asSymbol=!0,T=!0;else if([e.CT_ATOM_SYMBOL_LEADING,e.CT_ATOM_SYMBOL_FOLLOWING].indexOf(_)>=0){c.obj&&(f(),g());var b=c.massNum;b||h&&!h.handled&&h.tokenType===e.CT_NUMBER&&(b=parseInt(h.token,10)||null);var v=""+(b||"")+y;c.obj=Kekule.ChemStructureNodeFactory.createByLabel(v),C.asSymbol=!0,T=!0}else if(_===e.CT_CHARGE_SYMBOL){if(d=y==="+"?1:-1,C.asCharge=!0,h.tokenType===e.CT_NUMBER){var I;if(h.asCount)if(h.token.length>1){var R=h.token;I=R.substr(R.length-1),h.asCount&&(c.count=parseInt(R.substring(0,R.length-1),10))}else I=h.token,h.asCount&&(c.count=1);else I=h.token,h.asChargeCount=!0;d*=parseInt(I,10)}c.charge=d,T=!0}else if(_===e.CT_NUMBER){var N=parseInt(y,10);d&&h.tokenType===e.CT_CHARGE_SYMBOL&&h.asCharge?(d*=N,c.charge=d,C.asChargeCount=!0,T=!0):c.obj&&h.asSymbol?(c.count=N,C.asCount=!0,T=!0):c.obj||(c.massNum=N,T=!0)}C.handled=T,h=C}c&&c.obj&&f()}return a}finally{o.finalize()}},formulaToText:function(n,i,r){return Kekule.ObjUtils.isUnset(i)&&(i=!0),t._convFormulaToText(n,!1,i,r)},_convFormulaToText:function(n,i,r,a){var o="",l=n.getSections();if(i){var u=n.getMaxNestedLevel()%t.FORMULA_BRACKET_TYPE_COUNT,c=t.FORMULA_BRACKETS[u][0],d=t.FORMULA_BRACKETS[u][1];o+=c}for(var h=0,p=l.length;h<p;++h){var g=l[h].obj,f=n.getSectionCharge(l[h]),m=null;if(g instanceof Kekule.MolecularFormula?m=t._convFormulaToText(g,!0,!1,!1,a):g.getLabel&&(m=g.getLabel(),g.getMassNumber&&g.getMassNumber()&&(m=(o?" ":"")+m)),m){var C=!1;l[h].count!=1&&(m+=l[h].count,C=!0),r&&f&&(m+=(C?" ":"")+t._convChargeToText(f,a)),o+=m}}return i&&(o+=d),r&&(f=n.getCharge())&&(o+=t._convChargeToText(f,a)),o},_convChargeToText:function(n,i){if(!n)return null;var r=n>0?"+":"-",a=Math.abs(n),o=r;return a!=1&&(o=(i?Kekule.NumUtils.toDecimals(a,i):a.toString())+r),o}};var t=Kekule.FormulaUtils;ClassEx.defineProp(Kekule.MolecularFormula,"text",{dataType:DataType.STRING,serializable:!1,getter:function(){return t.formulaToText(this)},setter:function(n){t.textToFormula(n,this.getParent(),this)}})}(),function(){Kekule.Glyph={},Kekule.Glyph.Base=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Glyph.Base",initialize:function(s,e,t){this.tryApplySuper("initialize",[s]),e&&this.setCoord2D(e),t&&this.setCoord3D(t)},initProperties:function(){},getAutoIdPrefix:function(){return"g"},getAllowChildCoordStickTo:function(s,e){return!1},getChildAcceptCoordStickFrom:function(s,e){return!1},getChildUseCoordStickOffset:function(s,e){return null}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.Glyph.Base)}(),function(){Kekule.Glyph.ElectronArrowGlyphUtils={isValidChemNodeOrConnectorStickTarget:function(s){var e=s instanceof Kekule.ChemStructureNode||s instanceof Kekule.ChemStructureConnector;if(!e&&s instanceof Kekule.ChemMarker.BaseMarker){var t=s.getParent&&s.getParent();t&&(e=t instanceof Kekule.ChemStructureNode||t instanceof Kekule.ChemStructureConnector)}return e},isValidElectronTarget:function(s){return Kekule.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(s)},getValidElectronTarget:function(s){var e=s&&s.getCoordStickTarget&&s.getCoordStickTarget();return e&&Kekule.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(e)?e:null},setValidElectronTarget:function(s,e){s.getAllowCoordStickTo&&s.getAllowCoordStickTo(e)&&(e?Kekule.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(e)&&s.setCoordStickTarget(e):s.setCoordStickTarget(null))},getValidElectronTargetNodeOrConnector:function(s){var e=null,t=Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(s);return t&&(e=t instanceof Kekule.ChemMarker.BaseMarker?t.getParent():t),e}}}(),function(){var s=Kekule.CoordUtils,e=Kekule.CoordMode;Kekule.Glyph.PathGlyphNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphNode",initialize:function(t,n,i,r){this.tryApplySuper("initialize",[t]),i&&this.setCoord2D(i),r&&this.setCoord3D(r),this.setNodeType(n||Kekule.Glyph.NodeType.LOCATION)},initProperties:function(){this.defineProp("nodeType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC}),this.defineProp("pathNodeParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var t=this.getPropStoreFieldValue("pathNodeParams");return t||(t={},this.setPropStoreFieldValue("pathNodeParams",t)),t},setter:function(t){t?this.setPropStoreFieldValue("pathNodeParams",Object.extend({},t,!0)):this.setPropStoreFieldValue("pathNodeParams",null)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getAllowCoordStickTo:function(t){if(!t||!this.isSiblingWith(t)){var n=this.getParent();if(n&&n.getAllowChildCoordStickTo)return n.getAllowChildCoordStickTo(this,t)}return!1},getAcceptCoordStickFrom:function(t){var n=this.getParent();return!(!n||!n.getChildAcceptCoordStickFrom)&&n.getChildAcceptCoordStickFrom(this,t)},notifyCoordStickTargetChanged:function(t,n){this.tryApplySuper("notifyCoordStickTargetChanged",[t,n]);var i=this.getParent();if(Kekule.ObjUtils.isUnset(this.getPathNodeParams().useStickingOffset)&&i.getChildUseCoordStickOffset){var r=i.getChildUseCoordStickOffset(this,n);Kekule.ObjUtils.notUnset(r)&&(this.getPathNodeParams().useStickingOffset=r)}i.notifyChildCoordStickTargetChanged&&i.notifyChildCoordStickTargetChanged(this.oldTarget,n)}}),Kekule.Glyph.NodeType={LOCATION:"location",CONTROLLER:"controller",HIDDEN:"hidden"},Kekule.Glyph.PathGlyphConnectorControlNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnectorControlNode",initialize:function(t,n,i){this.tryApplySuper("initialize",[t]),n&&this.setCoord2D(n),i&&this.setCoord3D(i)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(Kekule.ChemObjInteractMode.UNSELECTABLE)},getAutoIdPrefix:function(){return"cn"},getAcceptCoordStickFrom:function(t){return!1},getParentConnector:function(){var t=this.getParent();return t&&t instanceof Kekule.Glyph.PathGlyphConnector?t:null},isPositioned:function(t,n){return t||(t=e.COORD2D),this.doCheckIsPositioned(t,n)},doCheckIsPositioned:function(t,n){return!0},resetPosition:function(t){return t?this.doResetPosition(t):(this.doResetPosition(e.COORD2D),this.doResetPosition(e.COORD3D)),this},doResetPosition:function(t){}}),Kekule.Glyph.PathType={LINE:"L",ARC:"A"},Kekule.Glyph.ArrowType={NONE:null,OPEN:"open",TRIANGLE:"triangle"},Kekule.Glyph.ArrowSide={DEFAULT:0,BOTH:0,SINGLE:1,REVERSED:-1},Kekule.Glyph.PathGlyphConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnector",initialize:function(t,n,i){this.tryApplySuper("initialize",[t,i]),this.setPathType(n)},initProperties:function(){this.defineProp("pathType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,enumSource:Kekule.Glyph.PathType}),this.defineProp("pathParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var t=this.getPropStoreFieldValue("pathParams");return t||(t={},this.setPropStoreFieldValue("pathParams",t)),t},setter:function(t){t?this.setPropStoreFieldValue("pathParams",Object.extend({},t,!0)):this.setPropStoreFieldValue("pathParams",null)}}),this.defineProp("controlPoints",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(t){var n=this.getPropStoreFieldValue("controlPoints");return!n&&t&&(n=[],this.setPropStoreFieldValue("controlPoints",n)),n&&!n.length&&this.doFillDefaultControlPoints(n),n},setter:function(t){this.clearControlPoints(),this.setPropStoreFieldValue("controlPoints",t),this._controlPointsChanged()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(Kekule.ChemObjInteractMode.UNSELECTABLE)},_appendChildObj:function(t){var n=this.tryApplySuper("_appendChildObj",[t]);return t instanceof Kekule.Glyph.PathGlyphConnectorControlNode&&this.tryResetControlPointPosition(t),n},doPropChanged:function(t,n){return t==="connectedObjs"&&this.tryResetAllControlPointPositions(),this.tryApplySuper("doPropChanged",[t,n])},getAbsCoord2D:function(t){return this.getAbsCoordOfMode(Kekule.CoordMode.COORD2D,t)},getAbsCoord3D:function(t){return this.getAbsCoordOfMode(Kekule.CoordMode.COORD2D,t)},getAbsCoordOfMode:function(t,n){for(var i=Kekule.CoordUtils,r={x:0,y:0},a=0,o=0,l=this.getConnectedObjCount();o<l;++o){var u=this.getConnectedObjAt(o);if(u&&u.getAbsCoordOfMode){var c=u.getAbsCoordOfMode(t,n);c&&(++a,r=i.add(r,c))}}return i.divide(r,a)},getChildSubgroupNames:function(){return["controlPoint"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(t){return t instanceof Kekule.Glyph.PathGlyphArcConnectorControlNode?"controlPoint":this.tryApplySuper("getBelongChildSubGroupName",[t])},getControlPointCount:function(){var t=this.getControlPoints();return t&&t.length||0},getControlPointAt:function(t){return(this.getControlPoints()||[])[t]},indexOfControlPoint:function(t){var n=this.getControlPoints();return n?n.indexOf(t):-1},removeControlPointAt:function(t){var n=null,i=this.getControlPoints();return i&&t>=0&&t<i.length&&((n=i.splice(t,1)).setOwner&&n.setOwner(null),n.setParent&&n.setParent(null),this.notifyPropSet("controlPoints",this.getControlPoints())),n},removeControlPoint:function(t){var n=null,i=this.getControlPoints();if(i){var r=i.indexOf(t);r>=0&&(i.splice(r,1),t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),n=t,this.notifyPropSet("controlPoints",this.getControlPoints()))}return n},insertControlPointAt:function(t,n){var i=this.getControlPoints();if(i&&n<i.length){var r=Kekule.ArrayUtils.insertUniqueEx(i,t,n);return r.isInserted&&(t.setOwner&&t.setOwner(this.getOwner()),t.setParent&&t.setParent(this),this.notifyPropSet("controlPoints",this.getControlPoints())),r.index}return-1},insertControlPointBefore:function(t,n){var i=this.getControlPoints();if(i){var r=n?this.indexOfControlPoint(n):-1;return r<0&&(r=i.length),this.insertControlPointAt(t,r)}return-1},tryResetControlPointPosition:function(t){if(t.isPositioned&&t.resetPosition)for(var n=[e.COORD2D,e.COORD3D],i=0,r=n.length;i<r;++i){var a=n[i];t.isPositioned(a,!0)||t.resetPosition(a)}},tryResetAllControlPointPositions:function(){for(var t=0,n=this.getControlPointCount();t<n;++t){var i=this.getControlPointAt(t);this.tryResetControlPointPosition(i)}},doFillDefaultControlPoints:function(t){},removeChildObj:function(t){return this.removeControlPoint(t)},hasChildObj:function(t){return this.hasChild(t)},getNextSiblingOfChild:function(t){var n=this.indexOfChild(t);return++n,this.getChildAt(n)},_controlPointsChanged:function(){this._updateControlPointsOwner(),this._updateControlPointsParent()},_updateControlPointsOwner:function(t){t||(t=this.getOwner());var n=this.getControlPoints();if(n)for(var i=0,r=n.length;i<r;++i){var a=n[i];a.setOwner&&a.setOwner(t)}},_updateControlPointsParent:function(t){t||(t=this);var n=this.getControlPoints();if(n)for(var i=0,r=n.length;i<r;++i){var a=n[i];a.setParent&&a.setParent(t)}},clearControlPoints:function(){var t=this.getControlPoints();if(t&&(t=Kekule.ArrayUtils.clone(t)),this.setPropStoreFieldValue("controlPoints",null),t)for(var n=0,i=t.length;n<i;++n){var r=t[n];r.setOwner&&r.setOwner(null),r.setParent&&r.setParent(null)}return this.notifyPropSet("controlPoints",null),this},modifyPathParams:function(t){if(t){var n=this.getPathParams();return n=Object.extend(n,t||{}),this.setPathParams(n),n}return null}}),Kekule.Glyph.PathGlyphArcConnectorControlNode=Class.create(Kekule.Glyph.PathGlyphConnectorControlNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnectorControlNode",initProperties:function(){this.defineProp("distanceToChord",{dataType:DataType.FLOAT})},doCheckIsPositioned:function(t,n){return this.getIndirectCoordRefCoords(t,n)&&Kekule.ObjUtils.notUnset(this.getDistanceToChord())},doResetPosition:function(t){if(t===e.COORD2D){var n=this.getIndirectCoordRefCoords(t,!0);if(n&&n[0]&&n[1]){var i=s.getDistance(n[0],n[1]);this.setDistanceToChord(.5*i),this.notifyPropSet("coord2D",this.getCoord2D())}}},doGetEnableIndirectCoord:function(){return!0},getIndirectCoordRefCoords:function(t,n){var i=this.getParentConnector();return i&&i.getConnectedObjCount()>=2?[i.getConnectedObjAt(0).getAbsCoordOfMode(n),i.getConnectedObjAt(1).getAbsCoordOfMode(n)]:this.tryApplySuper("getIndirectCoordRefCoords",[t])},calcIndirectCoordValue:function(t,n){if(t===e.COORD2D){var i=this.getDistanceToChord();if(Kekule.ObjUtils.notUnset(i)){var r=this.getIndirectCoordRefCoords();if(r){var a=r[0],o=r[1];if(a&&o){var l=s.substract(o,a),u=Math.sign(l.x),c=Math.sign(l.y);if(Kekule.NumUtils.isFloatEqual(l.x,0,1e-10))h={x:-i*c,y:0};else if(Kekule.NumUtils.isFloatEqual(l.y,0,1e-10))h={x:0,y:i*u};else{var d=-1/(l.y/l.x),h={x:-c*i/Math.sqrt(1+Math.sqr(d))};h.y=h.x*d}return h}}}}return this.tryApplySuper("calcIndirectCoordValue",[t,n])},saveIndirectCoordValue:function(t,n,i,r){if(t===e.COORD2D){var a=i,o=this.getIndirectCoordRefCoords();if(o){var l=o[0],u=o[1],c=s.substract(u,l),d=Math.atan2(c.y,c.x),h=(s.getDistance(l,u),s.substract(n,a)),p=Math.atan2(h.y,h.x),g=s.getDistance(n,a)*Math.sin(p-d),f=(this.getDistanceToChord()||0)+g;return this.setDistanceToChord(f),f}}return this.tryApplySuper("saveIndirectCoordValue",[t,n])}}),Kekule.Glyph.PathGlyphArcConnector=Class.create(Kekule.Glyph.PathGlyphConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnector",initialize:function(t,n){this.tryApplySuper("initialize",[t,Kekule.Glyph.PathType.ARC,n]);var i=this._createDefaultControlPoints();this.setControlPoints(i)},getControlPoint:function(){return(this.getControlPoints()||[])[0]},doFillDefaultControlPoints:function(t){var n=this._createDefaultControlPoints();Kekule.ArrayUtils.pushUnique(t,n)},_createDefaultControlPoints:function(){return[new Kekule.Glyph.PathGlyphArcConnectorControlNode(null,{x:0,y:0})]}}),Kekule.Glyph.PathGlyph=Class.create(Kekule.Glyph.Base,{CLASS_NAME:"Kekule.Glyph.PathGlyph",initialize:function(t,n,i,r,a){this.tryApplySuper("initialize",[t,r,a]),this.createDefaultStructure(n||1,i||{})},doFinalize:function(){this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",scope:Class.PropertyScope.PUBLIC,getter:function(t){return this.getPropStoreFieldValue("ctab")||t&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(t){var n=this.getPropStoreFieldValue("ctab");n&&(n.finalize(),n=null),t&&(t.setPropValue("parent",this,!0),t.setOwner(this.getOwner())),this.setPropStoreFieldValue("ctab",t)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}})},createDefaultStructure:function(t,n){t||(t=1);var i={},r=["startArrowLength","startArrowWidth","endArrowLength","endArrowWidth"];for(var a in n)r.indexOf(a)>=0?i[a]=n[a]*t:i[a]=n[a];return this.doCreateDefaultStructure(t,i)},doCreateDefaultStructure:function(t,n){},getAutoIdPrefix:function(){return"p"},ownerChanged:function(t,n){this.hasCtab()&&this.getCtab().setOwner(t),this.tryApplySuper("ownerChanged",[t,n])},_removeChildObj:function(t){if(this.hasCtab()){var n=this.getCtab();n===t?this.removeCtab():n.hasChildObj(t)&&n.removeChildObj(t)}this.tryApplySuper("_removeChildObj",[t])},isEmpty:function(){return this.getCtab().isEmpty()},createCtab:function(){var t=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setPropStoreFieldValue("ctab",t),t.addEventListener("propValueSet",function(n){n.propName=="nodes"&&this.notifyPropSet(n.propName,n.propValue)},this),t.setEnablePropValueSetEvent(!0)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},getContainerBox:function(t,n){return this.hasCtab()?this.getCtab().getContainerBox(t,n):this.tryApplySuper("getContainerBox",[t])},getNodeById:function(t){return this.hasCtab()?this.getCtab().getNodeById(t):null},getConnectorById:function(t){return this.hasCtab()?this.getCtab().getConnectorById(t):null},getObjectById:function(t){var n=this.getNodeById(t);return n||this.getConnectorById(t)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(t){return this.hasCtab()?this.getCtab().getNodeAt(t):null},indexOfNode:function(t){return this.hasCtab()?this.getCtab().indexOfNode(t):-1},hasNode:function(t,n){return this.hasCtab()?this.getCtab().hasNode(t,n):null},appendNode:function(t){return this.doGetCtab(!0).appendNode(t)},insertNodeAt:function(t,n){return this.doGetCtab(!0).insertNodeAt(t,n)},insertNodeBefore:function(t,n){var i=n?this.indexOfNode(n):-1;return i<0?this.appendNode(t):this.doGetCtab(!0).insertNodeAt(t,i)},removeNodeAt:function(t,n){return this.hasCtab()?this.getCtab().removeNodeAt(t,n):null},removeNode:function(t,n){return this.hasCtab()?this.getCtab().removeNode(t,n):null},replaceNode:function(t,n){return this.hasCtab()?this.getCtab().replaceNode(t,n):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},nodesHasCoord2D:function(t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(t)},nodesHasCoord3D:function(t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(t)},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(t){return this.hasCtab()?this.getCtab().getConnectorAt(t):null},indexOfConnector:function(t){return this.hasCtab()?this.getCtab().indexOfConnector(t):-1},hasConnector:function(t,n){return this.hasCtab()?this.getCtab().hasConnector(t,n):null},appendConnector:function(t){return this.doGetCtab(!0).appendConnector(t)},insertConnectorAt:function(t,n){return this.doGetCtab(!0).insertConnectorAt(t,n)},insertConnectorBefore:function(t,n){var i=n?this.indexOfConnector(n):-1;return i<0?this.appendConnector(t):this.doGetCtab(!0).insertConnectorAt(t,i)},removeConnectorAt:function(t,n){return this.hasCtab()?this.getCtab().removeConnectorAt(t,n):null},removeConnector:function(t,n){return this.hasCtab()?this.getCtab().removeConnector(t,n):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},_getObjsNeedToBeCascadeRemoved:function(t,n){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(t,n):[]},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(t){return t instanceof Kekule.Glyph.PathGlyphNode?"node":t instanceof Kekule.Glyph.PathGlyphConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[t])},removeChildObj:function(t,n,i){this.hasCtab()&&this.getCtab().removeChildObj(t,n,i)},hasChildObj:function(t){return!!this.hasCtab()&&this.getCtab().hasChildObj(t)},getNextSiblingOfChild:function(t){return this.hasCtab()?this.getCtab().getNextSiblingOfChild(t):null},getDirectManipulationTarget:function(){return null}})}(),function(){var s=Kekule.ObjUtils,e=(Kekule.Glyph.NodeType,Kekule.Glyph.PathType),t=Kekule.CoordUtils,n=Kekule.CoordMode;Kekule.Glyph.StraightLine=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.StraightLine",initialize:function(i,r,a,o,l){this.tryApplySuper("initialize",[i,r,a,o,l])},doCreateDefaultStructure:function(i,r){var a=Kekule.CoordUtils,o={x:0,y:0},l={x:0,y:0,z:0},u={x:i*(r.lineLength||1)},c=new Kekule.Glyph.PathGlyphNode(null,null,o,l),d=new Kekule.Glyph.PathGlyphNode(null,null,a.add(o,u),a.add(l,u)),h=new Kekule.Glyph.PathGlyphConnector(null,e.LINE,[c,d]);this._applyParamsToConnector(h,r),this.appendNode(c),this.appendNode(d),this.appendConnector(h)},_applyParamsToConnector:function(i,r){var a=Object.create(r);Kekule.ObjUtils.isUnset(r.autoOffset)&&(a.autoOffset=!1),i.setPathParams(a)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)}}),Kekule.Glyph.Polygon=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.Polygon",initialize:function(i,r,a,o,l){this.tryApplySuper("initialize",[i,r,a,o,l])},getRefLengthRatio:function(){return 1},doCreateDefaultStructure:function(i,r){for(var a,o,l=Kekule.CoordUtils,u={x:0,y:0},c={x:0,y:0,z:0},d=r.nodeProps,h=r.connectorProps,p=i*(r.lineLength||1)*this.getRefLengthRatio(),g=r.edgeCount||3,f=2*Math.PI/g,m=g%2?0:-f/2,C=0;C<g;++C){var _={x:p*Math.sin(m),y:p*Math.cos(m)},y=new Kekule.Glyph.PathGlyphNode(null,null,l.add(u,_),l.add(c,_));if(d&&y.setPropValues(d),this.appendNode(y),C===0&&(a=y),o){var T=new Kekule.Glyph.PathGlyphConnector(null,e.LINE,[o,y]);h&&T.setPropValues(h),this._applyParamsToConnector(T,r),this.appendConnector(T)}o=y,m+=f}T=new Kekule.Glyph.PathGlyphConnector(null,e.LINE,[y,a]),h&&T.setPropValues(h),this._applyParamsToConnector(T,r),this.appendConnector(T)},_applyParamsToConnector:function(i,r){i.setPathParams(r)}}),Kekule.Glyph.BaseArc=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseArc",initialize:function(i,r,a,o,l){this.tryApplySuper("initialize",[i,r,a,o,l])},doCreateDefaultStructure:function(i,r){var a=Kekule.CoordUtils,o={x:0,y:0},l={x:0,y:0,z:0},u={x:i*(r.lineLength||1)},c=new Kekule.Glyph.PathGlyphNode(null,null,o,l),d=new Kekule.Glyph.PathGlyphNode(null,null,a.add(o,u),a.add(l,u));this.appendNode(c),this.appendNode(d);var h=new Kekule.Glyph.PathGlyphArcConnector(null,[c,d]);this._applyParamsToConnector(h,r),this.appendConnector(h),h.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},_isValidChemNodeOrConnectorStickTarget:function(i){return Kekule.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(i)},_applyParamsToConnector:function(i,r){i.setPathParams(r)},getAllowChildCoordStickTo:function(i,r){return!r||this._isValidChemNodeOrConnectorStickTarget(r,i)&&!this._isChildrenStickingTo(r,[i])},getChildUseCoordStickOffset:function(i,r){return r instanceof Kekule.ChemStructureNode||r instanceof Kekule.ChemStructureConnector},_isChildrenStickingTo:function(i,r){for(var a=this.getNodes(),o=0,l=(a=Kekule.ArrayUtils.exclude(a,r||[])).length;o<l;++o)if(a[o].getCoordStickTarget()===i)return!0;return!1}}),Kekule.Glyph.BaseTwinArc=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseTwinArc",DEF_MIN_PATH_END_DISTANCE_RATIO:.05,DEF_INIT_PATH_END_GAP_RATIO:.2,FIELD_ARC_END_NODE_FLAG:"__$arcEndNode$__",initialize:function(i,r,a,o,l){this.setPropStoreFieldValue("minPathEndDistanceRatio",this.DEF_MIN_PATH_END_DISTANCE_RATIO),this.tryApplySuper("initialize",[i,r,a,o,l])},initProperties:function(){this.defineProp("minPathEndDistanceRatio",{dataType:DataType.FLOAT}),this.defineProp("oppositePathEndArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("end")},setter:function(i){this._setPathArrowSideOpposite("end",!!i)}}),this.defineProp("oppositePathStartArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("start")},setter:function(i){this._setPathArrowSideOpposite("start",!!i)}})},loaded:function(i){var r=this.tryApplySuper("loaded",[i]);return this._isTwinArcSetup()&&(this._setupArcEndNode(this.getNodeAt(1)),this._setupArcEndNode(this.getNodeAt(2))),r},_isPathArrowSideOpposite:function(i){var r=this.getConnectorCount();if(r<2)return null;for(var a,o=null,l=0;l<r;++l){var u=this.getConnectorAt(l).getPathParams();if(u[i+"ArrowType"]===Kekule.Glyph.ArrowType.NONE)return null;var c=u[i+"ArrowSide"];if(c===Kekule.Glyph.ArrowSide.BOTH)return null;if(l===0)a=c;else{var d=a!==c;if(s.isUnset(o))o=d;else if(o!==d)return null;a=c}}return o},_setPathArrowSideOpposite:function(i,r){var a=this.getConnectorCount();if(a<2)return null;for(var o,l=Kekule.Glyph.ArrowSide,u=!0,c=0;c<a;++c){var d=this.getConnectorAt(c).getPathParams();d[i+"ArrowType"]===Kekule.Glyph.ArrowType.NONE&&(u=!1);var h,p=d[i+"ArrowSide"];p===Kekule.Glyph.ArrowSide.BOTH&&(u=!1),u?s.isUnset(o)?o=p:(h=r?o===l.SINGLE?l.REVERSED:l.SINGLE:o,d[i+"ArrowSide"]=h,o=h):o=null}return null},_isTwinArcSetup:function(){return this.getConnectorCount()===2&&this.getNodeCount()===4},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},doCreateDefaultStructure:function(i,r){var a=Kekule.CoordUtils,o={x:0,y:0},l={x:0,y:0,z:0},u=r.lineLength||1,c=r.minPathEndDistanceRatio||this.getMinPathEndDistanceRatio()||this.DEF_MIN_PATH_END_DISTANCE_RATIO,d=u*c;this.setMinPathEndDistanceRatio(c);var h=r.pathEndGap||u*this.DEF_INIT_PATH_END_GAP_RATIO,p={x:i*((u-(h=Math.max(h,d)))/2)},g={x:i*h},f={x:i*u},m=new Kekule.Glyph.PathGlyphNode(null,null,o,l),C=new Kekule.Glyph.PathGlyphNode(null,null);this._setupArcEndNode(C);var _=new Kekule.Glyph.PathGlyphNode(null,null),y=new Kekule.Glyph.PathGlyphNode(null,null,a.add(o,f),a.add(l,f));this._setupArcEndNode(_),this.appendNode(m),this.appendNode(C),this.appendNode(_),this.appendNode(y),C.setCoord2D(a.add(o,p)).setCoord3D(a.add(l,p)),_.setCoord2D(a.add(o,t.add(p,g))).setCoord3D(a.add(l,t.add(p,g)));var T=new Kekule.Glyph.PathGlyphArcConnector(null,[m,C]),E=new Kekule.Glyph.PathGlyphArcConnector(null,[y,_]);this._applyParamsToConnector(T,r),this._applyParamsToConnector(E,r),E.getControlPointAt(0).setDistanceToChord(-E.getControlPointAt(0).getDistanceToChord()),this.appendConnector(T),this.appendConnector(E),T.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN),E.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN)},_applyParamsToConnector:function(i,r){i.setPathParams(r)},_setupArcEndNode:function(i){i[this.FIELD_ARC_END_NODE_FLAG]||(this._overwriteChildPathNodeMethods(i),i.setEnableIndirectCoord(!0),i[this.FIELD_ARC_END_NODE_FLAG]=!0)},_overwriteChildPathNodeMethods:function(i){i.overwriteMethod("getIndirectCoordRefLengths",this._insideNodeGetIndirectCoordRefLengths).overwriteMethod("getIndirectCoordRefCoords",this._insideNodeGetIndirectCoordRefCoords).overwriteMethod("calcIndirectCoordStorage",this._insideNodeCalcIndirectCoordStorage).overwriteMethod("calcIndirectCoordValue",this._insideNodeCalcIndirectCoordValue).overwriteMethod("_childPathNodeGetParentGlyph",this._childPathNodeGetParentGlyph).overwriteMethod("_childPathNodeGetGlyphMinPathEndDistanceRatio",this._childPathNodeGetGlyphMinPathEndDistanceRatio)},_getArrowStartingNodes:function(){var i=[];if(this._isTwinArcSetup())for(var r=0,a=this.getConnectorCount();r<a;++r){var o=this.getConnectorAt(r).getConnectedObjAt(0);o&&i.push(o)}return i},_childPathNodeGetParentGlyph:function(i){var r=this.getParent();return r instanceof Kekule.Glyph.BaseTwinArc?r:null},_childPathNodeGetGlyphMinPathEndDistanceRatio:function(i){var r=this._childPathNodeGetParentGlyph();return r&&r.getMinPathEndDistanceRatio()},_insideNodeGetIndirectCoordRefLengths:function(i,r,a){var o=this.getParent();if(!o||r!==Kekule.CoordMode.COORD2D)return i(r,a);var l=o.getNodeAt(0),u=o.getNodeAt(o.getNodeCount()-1);if(l&&u){var c=l.getAbsCoordOfMode(r),d=u.getAbsCoordOfMode(r),h=Kekule.CoordUtils.getDistance(d,c);return{x:h,y:h,length:h}}},_insideNodeGetIndirectCoordRefCoords:function(i,r,a){var o=this.getParent();if(!o||r!==n.COORD2D)return i(r,a);var l=o.getNodeAt(0),u=o.getNodeAt(o.getNodeCount()-1);return l&&u?[l.getCoordOfMode(r),u.getCoordOfMode(r)]:void 0},_insideNodeCalcIndirectCoordStorage:function(i,r,a,o,l){var u=this.getParent();if(u&&r===n.COORD2D){var c=this.getIndirectCoordRefCoords(r,l);if(c){var d=u.getNodeAt(0).getCoordOfMode(r),h=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(a,c[0],c[1],!1);h||(h=t.getDistance(a,c[0])<t.getDistance(a,c[1])?c[0]:c[1]);var p=t.getDistance(d,h),g=t.getDistance(c[1],c[0]),f=g?p/g:0,m=this._childPathNodeGetGlyphMinPathEndDistanceRatio()||0;return f<m?f=m:f>1-m&&(f=1-m),{x:f,y:f,ratio:f}}}return i(r,a,o,l)},_insideNodeCalcIndirectCoordValue:function(i,r,a){var o=this.getParent();if(o&&r===n.COORD2D){var l=this.getIndirectCoordRefCoords(r,a);if(l){var u=t.substract(l[1],l[0]),c=o.getNodeAt(0).getCoordOfMode(r),d=this.getIndirectCoordStorageOfMode(r).ratio;if(Kekule.ObjUtils.notUnset(d)){var h=t.multiply(u,d);return t.add(c,h)}}}return i(r,a)},_isValidChemNodeOrConnectorStickTarget:function(i){var r=i instanceof Kekule.ChemStructureNode||i instanceof Kekule.ChemStructureConnector;if(!r&&i instanceof Kekule.ChemMarker.BaseMarker){var a=i.getParent&&i.getParent();a&&(r=a instanceof Kekule.ChemStructureNode||a instanceof Kekule.ChemStructureConnector)}return r},getAllowChildCoordStickTo:function(i,r){var a=this.indexOfNode(i);return(a===0||a===this.getNodeCount()-1)&&(!r||this._isValidChemNodeOrConnectorStickTarget(r,i)&&!this._isChildrenStickingTo(r,[i]))},getChildUseCoordStickOffset:function(i,r){return r instanceof Kekule.ChemStructureNode||r instanceof Kekule.ChemStructureConnector},_isChildrenStickingTo:function(i,r){for(var a=this._getArrowStartingNodes(),o=0,l=(a=Kekule.ArrayUtils.exclude(a,r||[])).length;o<l;++o)if(a[o].getCoordStickTarget()===i)return!0;return!1}}),Kekule.Glyph.Arc=Class.create(Kekule.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.Arc"}),Kekule.Glyph.TwinArc=Class.create(Kekule.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.TwinArc"})}(),function(){var s=Kekule.ObjUtils,e=(Kekule.Glyph.NodeType,Kekule.Glyph.PathType),t=Kekule.Glyph.ElectronArrowGlyphUtils;Kekule.Glyph.HeatSymbol=Class.create(Kekule.Glyph.Polygon,{CLASS_NAME:"Kekule.Glyph.HeatSymbol",initialize:function(n,i,r,a,o){this.tryApplySuper("initialize",[n,i,r,a,o]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return .25},doCreateDefaultStructure:function(n,i){return i.edgeCount=3,i.nodeProps=Object.extend(i.nodeProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN}),i.connectorProps=Object.extend(i.connectorProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN}),this.tryApplySuper("doCreateDefaultStructure",[n,i])},_applyParamsToConnector:function(n,i){return this.tryApplySuper("_applyParamsToConnector",[n,i])}}),Kekule.Glyph.AddSymbol=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.AddSymbol",initialize:function(n,i,r,a,o){this.tryApplySuper("initialize",[n,i,r,a,o]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return .5},doCreateDefaultStructure:function(n,i){var r={interactMode:Kekule.ChemObjInteractMode.HIDDEN},a={interactMode:Kekule.ChemObjInteractMode.HIDDEN},o=Kekule.CoordUtils,l={x:0,y:0},u={x:0,y:0,z:0},c=n*this.getRefLengthRatio()*(i.lineLength||1)/2,d=new Kekule.Glyph.PathGlyphNode(null,null,l,u);d.setPropValues(r),this.appendNode(d);for(var h=[{x:-c,y:0},{x:0,y:-c},{x:c,y:0},{x:0,y:c}],p=0,g=h.length;p<g;++p){var f=h[p],m=new Kekule.Glyph.PathGlyphNode(null,null,o.add(l,f),o.add(u,f));m.setPropValues(r);var C=new Kekule.Glyph.PathGlyphConnector(null,e.LINE,[d,m]);C.setPropValues(a),this._applyParamsToConnector(C,i),this.appendNode(m),this.appendConnector(C)}},_applyParamsToConnector:function(n,i){n.setPathParams(i)}}),Kekule.Glyph.Segment=Class.create(Kekule.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.Segment"}),Kekule.Glyph.ReactionArrowType={NORMAL:"normal",REVERSIBLE:"reversible",RESONANCE:"resonance",RETROSYNTHESIS:"retrosynthesis",CUSTOM:"custom"},Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType=function(n){var i,r=Kekule.Glyph.ReactionArrowType,a=Kekule.Glyph.ArrowType,o=Kekule.Glyph.ArrowSide;switch(n){case r.NORMAL:i={startArrowType:a.NONE,endArrowType:a.OPEN,endArrowSide:o.BOTH,lineCount:1};break;case r.REVERSIBLE:i={startArrowType:a.OPEN,startArrowSide:o.REVERSED,endArrowType:a.OPEN,endArrowSide:o.SINGLE,lineGap:.1,lineCount:2};break;case r.RESONANCE:i={startArrowType:a.OPEN,startArrowSide:o.BOTH,endArrowType:a.OPEN,endArrowSide:o.BOTH,lineCount:1};break;case r.RETROSYNTHESIS:i={startArrowType:a.NONE,endArrowType:a.OPEN,endArrowSide:o.BOTH,lineGap:.1,lineCount:2};break;default:i=null}return i},Kekule.Glyph.ReactionArrow=Class.create(Kekule.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.ReactionArrow",initProperties:function(){this.defineProp("reactionType",{dataType:DataType.STRING,enumSource:Kekule.Glyph.ReactionArrowType,setter:function(n){this.setPropStoreFieldValue("reactionType",n),this.reactionTypeChanged(n)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setReactionType(Kekule.Glyph.ReactionArrowType.NORMAL)},doCreateDefaultStructure:function(n,i){var r=i,a=i.reactionType||this.getReactionType();if(a){var o=this._getPathParamOfArrowType(a);r=Object.extend(o,i)}var l=this.tryApplySuper("doCreateDefaultStructure",[n,r]);return a&&this.setReactionType(a),l},reactionTypeChanged:function(n){var i=this._getPathParamOfArrowType(n);if(i){var r=this.getConnectorAt(0);r&&r.modifyPathParams(i)}},_getPathParamOfArrowType:function(n){return Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType(n)}}),Kekule.Glyph.ElectronPushingArrow=Class.create(Kekule.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.ElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){var n=this._getValidArrowSide(),i=Kekule.Glyph.ArrowSide;return n===i.BOTH?2:[i.SINGLE,i.REVERSED].indexOf(n)>=0?1:null},setter:function(n){var i=Kekule.Glyph.ArrowSide,r=this._getValidArrowPos(),a=this.getConnectorAt(0);r||(a.getPathParams().endArrowType=Kekule.Glyph.ArrowType.OPEN,r="end");var o=a.getPathParams();n>=2?o[r+"ArrowSide"]=i.BOTH:n===1&&(o[r+"ArrowSide"]=i.SINGLE),a.setPathParams(o)}}),this.defineProp("directReceptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var n=this.getNodeAt(1);return this._getValidElectronTarget(n)},setter:function(n){var i=this.getNodeAt(1);this._setValidElectronTarget(i,n)}}),this.defineProp("directDonor",{dataType:"Kekule.ChemStructureObject",getter:function(){var n=this.getNodeAt(0);return this._getValidElectronTarget(n)},setter:function(n){var i=this.getNodeAt(0);this._setValidElectronTarget(i,n)}}),this.defineProp("receptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var n=this.getNodeAt(1);return this._getValidElectronTargetNodeOrConnector(n)},setter:function(n){var i=this.getNodeAt(1);this._setValidElectronTarget(i,n)}}),this.defineProp("donor",{dataType:"Kekule.ChemStructureObject",getter:function(){var n=this.getNodeAt(0);return this._getValidElectronTargetNodeOrConnector(n)},setter:function(n){var i=this.getNodeAt(0);this._setValidElectronTarget(i,n)}})},doCreateDefaultStructure:function(n,i){var r=this.tryApplySuper("doCreateDefaultStructure",[n,i]);return i.electronCount&&this.setElectronCount(i.electronCount),r},_isValidElectronTarget:function(n){return this._isValidChemNodeOrConnectorStickTarget(n)},_getValidElectronTarget:function(n){return Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(n)},_setValidElectronTarget:function(n,i){return Kekule.Glyph.ElectronArrowGlyphUtils.setValidElectronTarget(n,i),this},_getValidElectronTargetNodeOrConnector:function(n){return Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTargetNodeOrConnector(n)},_getValidArrowPos:function(){var n=this.getConnectorAt(0),i=n&&n.getPathParams();if(i){if(i.endArrowType)return"end";if(i.startArrowType)return"start"}return null},_getValidArrowSide:function(){var n=this.getConnectorAt(0),i=n&&n.getPathParams();if(i){if(i.endArrowType)return i.endArrowSide||Kekule.Glyph.ArrowSide.DEFAULT;if(i.startArrowType)return i.startArrowSide||Kekule.Glyph.ArrowSide.DEFAULT}return null},_applyParamsToConnector:function(n,i){var r=Object.create(i);Kekule.ObjUtils.isUnset(i.autoOffset)&&(r.autoOffset=!0),n.setPathParams(r)}}),Kekule.Glyph.BondFormingElectronPushingArrow=Class.create(Kekule.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.BondFormingElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){for(var n=null,i=0,r=this.getConnectorCount();i<r;++i){var a=this._getConnectorElectronCount(this.getConnectorAt(i));if(s.notUnset(a)){if(s.isUnset(n))n=a;else if(n!==a)return null}}return n*this.getConnectorCount()},setter:function(n){if(n!==this.getElectronCount()){var i=this.getConnectorCount()?n/this.getConnectorCount():n;(i=Math.round(i))<=0&&(i=1);for(var r=Kekule.Glyph.ArrowSide,a=this.getConnectors(),o=0,l=a.length;o<l;++o){var u=a[o];u.getPathParams().endArrowType=Kekule.Glyph.ArrowType.OPEN;var c=u.getPathParams();i>=2?c.endArrowSide=r.BOTH:i===1&&(c.endArrowSide=o%2?r.SINGLE:r.REVERSED),u.setPathParams(c)}}}}),this.defineProp("directDonors",{dataType:DataType.ARRAY,getter:function(){for(var n=this._getArrowStartingNodes(),i=[],r=0,a=n.length;r<a;++r){var o=t.getValidElectronTarget(n[r]);o&&i.push(o)}return i},setter:function(n){var i=this._getArrowStartingNodes();if(i.length)for(var r=0,a=i.length;r<a;++r){var o=i[r];n[r],t.setValidElectronTarget(o,n)}}}),this.defineProp("donors",{dataType:DataType.ARRAY,getter:function(){for(var n=this._getArrowStartingNodes(),i=[],r=0,a=n.length;r<a;++r){var o=t.getValidElectronTargetNodeOrConnector(n[r]);o&&i.push(o)}return i},setter:function(n){this.setDirectDonors(n)}})},_getConnectorElectronCount:function(n){var i=n&&n.getPathParams();if(i){var r=Kekule.Glyph.ArrowSide,a=i.endArrowType?i.endArrowSide||Kekule.Glyph.ArrowSide.DEFAULT:null;if(a===r.BOTH)return 2;if([r.SINGLE,r.REVERSED].indexOf(a)>=0)return 1}return null},doCreateDefaultStructure:function(n,i){var r=this.tryApplySuper("doCreateDefaultStructure",[n,i]);return this.setElectronCount(i.electronCount||1),r}})}(),function(){Kekule.CoordMode,Kekule.CoordUtils,Kekule.ContentBlock=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ContentBlock",initialize:function(s,e,t){this.tryApplySuper("initialize",[s]),e&&this.setCoord2D(e),t&&this.setCoord3D(t)},initProperties:function(){this.defineProp("needRecalcSize",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"b"},getCornerCoord1:function(s,e){return this.getCoordOfMode(s,e)},getCornerCoord2:function(s,e){var t=this.getCornerCoord1(s,e),n=this.getSizeOfMode(s,e);return Kekule.CoordUtils.add(t,n)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ContentBlock),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ContentBlock),Kekule.TextBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.TextBlock",initialize:function(s,e,t,n){this.tryApplySuper("initialize",[s,t,n]),this.setText(e||"")},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"t"},doObjectChange:function(s){Kekule.ArrayUtils.intersect(["text","renderOptions"],s).length&&this.setNeedRecalcSize(!0)}}),Kekule.ImageBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.ImageBlock",initialize:function(s,e,t,n){this.tryApplySuper("initialize",[s,t,n]),e&&this.setSrc(e)},initProperties:function(){this.defineProp("src",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,setter:function(s){s!==this.getSrc()&&(this.setPropStoreFieldValue("src",s),this._clearCacheImg())}}),this.defineProp("cacheImg",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){var s=this.getPropStoreFieldValue("cacheImg");return!s&&Kekule.$document&&(s=this._createCacheImg(this.getSrc())),s}})},getAutoIdPrefix:function(){return"g"},_createCacheImg:function(s){var e,t=Kekule.$document;return t&&t.body&&t.createElement&&((e=t.createElement("img")).src=s),e},_clearCacheImg:function(){var s=this.getPropStoreFieldValue("cacheImg");if(s){s.src="";try{delete s.width,delete s.height}catch{}}}})}(),function(){var s=Kekule.ArrayUtils;Kekule.ChemMarker={},ClassEx.extend(Kekule.ChemObject,{isAttachedMarker:function(){var e=this.getParent();return e&&e.hasMarker(this)},notifyAttachedMarkersChanged:function(){this.notifyPropSet("attachedMarkers",this.getPropStoreFieldValue("attachedMarkers"))},_attachedMarkerAdded:function(e){},_attachedMarkerRemoved:function(e){},getMarkerCount:function(){var e=this.getPropStoreFieldValue("attachedMarkers");return e?e.length:0},getMarkerAt:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t[e]:null},getMarkerOfType:function(e,t){for(var n=0,i=this.getMarkerCount();n<i;++n){var r=this.getMarkerAt(n);if(t&&r.getClass()===e||r instanceof e)return r}return null},getMarkersOfType:function(e,t){for(var n=[],i=0,r=this.getMarkerCount();i<r;++i){var a=this.getMarkerAt(i);(t&&a.getClass()===e||a instanceof e)&&n.push(a)}return n},fetchMarkerOfType:function(e,t,n,i){var r=this.getMarkerOfType(e,n);if(!r&&t){(r=new e).beginUpdate();try{i&&r.setPropValues(i),this.appendMarker(r)}finally{r.endUpdate()}}return r},getUnplacedMarkers:function(e){for(var t=[],n=0,i=this.getMarkerCount();n<i;++n){var r=this.getMarkerAt(n);r.getCoordOfMode(e)||t.push(r)}return t},indexOfMarker:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t.indexOf(e):-1},hasMarker:function(e){return this.indexOfMarker(e)>=0},hasMarkerOfType:function(e,t){return!!this.getMarkerOfType(e,t)},appendMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return t;var n=this.getAttachedMarkers(!0).push(e);e.beginUpdate();try{e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this._attachedMarkerAdded(e)}finally{e.endUpdate()}return this.notifyAttachedMarkersChanged(),n},insertMarkerBefore:function(e,t){var n=this.indexOfMarker(t);return this.insertMarkerAt(e,n)},insertMarkerAt:function(e,t){this.indexOfMarker(e);var n=this.getAttachedMarkers(!0);(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=n.length);var i=s.insertUniqueEx(n,e,t);return i.isInserted&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this._attachedMarkerAdded(e)),this.notifyAttachedMarkersChanged(),i.index},setMarkerIndex:function(e,t){var n=this.indexOfMarker(e);if(n>=0){var i=this.getPropStoreFieldValue("attachedMarkers");i.splice(n,1),i.splice(t,0,e)}},removeMarkerAt:function(e){var t=this.getMarkerAt(e);if(t){var n=this.getAttachedMarkers(!0).splice(e,1);return t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this._attachedMarkerRemoved(t),this.notifyAttachedMarkersChanged(),n}},removeMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return this.removeMarkerAt(t)},replaceMarker:function(e,t){var n=this.indexOfMarker(e);return n<0?this:(this.removeMarkerAt(n),this.insertMarkerAt(t,n),this)},clearMarkers:function(){var e=this.getPropStoreFieldValue("attachedMarkers");if(e&&(e=s.clone(e)),this.setPropStoreFieldValue("attachedMarkers",null),e)for(var t=0,n=e.length;t<n;++t){var i=e[t];i.setOwner&&i.setOwner(null),i.setParent&&i.setParent(null),this._attachedMarkerRemoved(i)}return this.notifyAttachedMarkersChanged(),this},autoSetMarker2DPos:function(e,t,n,i){if(this.hasMarker(e)){var r=Kekule.ChemStructureUtils.getMostEmptyDirection2DAngleOfObj(this,[e],n,!0,!1,i),a={x:t*Math.cos(r),y:t*Math.sin(r)};e.setCoord2D(a)}},_updateAttachedMarkersOwner:function(e){e||(e=this.getOwner());for(var t=0,n=this.getMarkerCount();t<n;++t){var i=this.getMarkerAt(t);i.setOwner&&i.setOwner(e)}},_updateAttachedMarkersParent:function(e){e||(e=this);for(var t=0,n=this.getMarkerCount();t<n;++t){var i=this.getMarkerAt(t);i.setParent&&i.setParent(e)}}}),ClassEx.extendMethod(Kekule.ChemObject,"ownerChanged",function(e,t){e(t),this._updateAttachedMarkersOwner(t)}),ClassEx.extendMethod(Kekule.ChemObject,"removeChild",function(e,t){var n=e(t);return n||(n=this.removeMarker(t)),n}),ClassEx.extendMethod(Kekule.ChemObject,"insertBefore",function(e,t,n){var i=e(t,n);return i<0&&(n&&this.hasMarker(n)||t instanceof Kekule.ChemMarker.BaseMarker)&&(i=this.insertMarkerBefore(t,n)),i}),ClassEx.extendMethod(Kekule.ChemObject,"getChildSubgroupNames",function(e){return e().concat("marker")}),ClassEx.defineProp(Kekule.ChemObject,"attachedMarkers",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return!t&&e&&(t=[],this.setPropStoreFieldValue("attachedMarkers",t)),t},setter:function(e){this.clearMarkers(),this.setPropStoreFieldValue("attachedMarkers",e),this._updateAttachedMarkersOwner(),this._updateAttachedMarkersParent()}})}(),function(){Kekule.ChemMarker.BaseMarker=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemMarker.BaseMarker",initialize:function(s,e,t){this.tryApplySuper("initialize",[s,e,t])},getAutoIdPrefix:function(){return"marker"},getAcceptCoordStickFrom:function(s){return!(this.isSiblingWith(s)||s instanceof Kekule.ChemStructureNode||s instanceof Kekule.BaseStructureConnector)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ChemMarker.BaseMarker),Kekule.ChemMarker.UnbondedElectronSet=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.UnbondedElectronSet",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.VARIANT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setElectronCount(2)},getAutoIdPrefix:function(){return"electron"}}),Kekule.ChemMarker.ChemPropertyMarker=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.ChemPropertyMarker",initProperties:function(){this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){var s,e=this.getParent(),t=this.getPropertyName();return e&&t?(s=e.getPropValue(t),this.setPropStoreFieldValue("value",s)):s=this.getPropStoreFieldValue("value"),s},setter:function(s){this.setPropStoreFieldValue("value",s),this.setParentPropValue(s)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},setParentPropValue:function(s){var e=this.getParent();if(e){var t=this.getPropertyName();t&&e&&e.setPropValue(t,s)}return this},resetParentPropValue:function(){return this.setParentPropValue(void 0)},getPropertyName:function(){return null},beforAddingByEditor:function(s,e){if(s){var t=this.getPropStoreFieldValue("value");Kekule.ObjUtils.notUnset(t)&&this.setParentPropValue(t)}this.tryApplySuper("beforAddingByEditor")},beforeRemovingByEditor:function(s){this.setPropStoreFieldValue("value",this.getValue()),this.resetParentPropValue()}}),Kekule.ChemMarker.Charge=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Charge",getPropertyName:function(){return"charge"},getAutoIdPrefix:function(){return"charge"}}),Kekule.ChemMarker.Radical=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Radical",getPropertyName:function(){return"radical"},getAutoIdPrefix:function(){return"radical"}}),ClassEx.extend(Kekule.ChemStructureNode,{fetchChargeMarker:function(s,e){return this.fetchMarkerOfType(Kekule.ChemMarker.Charge,s,!1,e)},fetchRadicalMarker:function(s,e){return this.fetchMarkerOfType(Kekule.ChemMarker.Radical,s,!1,e)}}),ClassEx.defineProp(Kekule.AbstractAtom,"lonePairCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,serializable:!1,setter:null,getter:function(){for(var s=0,e=this.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet),t=0,n=e.length;t<n;++t)e[t].getElectronCount()===2&&++s;return s}}),ClassEx.extendMethod(Kekule.AbstractAtom,"doCompare",function(s,e,t){var n=s(e,t);if(!n&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(t,"lonePair")||this._getComparisonOptionFlagValue(t,"unbondedElectron"))){var i=function(o){var l=[];if(o.getMarkersOfType)for(var u=o.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet),c=0,d=u.length;c<d;++c){var h=u[c];l.push(h.getElectronCount())}return l.sort(),l},r=i(this),a=i(e);return Kekule.ArrayUtils.compare(r,a)}return n})}();(function(s){typeof window<"u"&&(s=window);var e,t,n,i=s,r=i&&i.document;typeof Kekule>"u"&&(Kekule={}),typeof navigator>"u"?(Kekule.Browser={},Kekule.BrowserFeature={}):(Kekule.Browser={IE:!(!i.attachEvent||i.opera),Opera:!!i.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("like Gecko")<0&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),language:navigator.language||navigator.browserLanguage},Kekule.Browser.IEVersion=Kekule.Browser.IE&&(n=navigator.userAgent.toLowerCase()).indexOf("msie")!==-1&&parseInt(n.split("msie")[1]),Kekule.BrowserFeature={typedArray:typeof ArrayBuffer<"u",svg:!!i.SVGSVGElement,canvas:!!i.CanvasRenderingContext2D,webgl:!!function(){try{var C=r.createElement("canvas");return!!i.WebGLRenderingContext&&(C.getContext("webgl")||C.getContext("experimental-webgl"))}catch{return!1}}(),htmlTemplate:!!i.HTMLTemplateElement,htmlSlot:!!i.HTMLSlotElement,downloadHref:"download"in r.createElement("a"),blob:!!i.Blob,workers:!!i.Worker,fileapi:!!(i.File&&i.FileReader&&i.FileList&&i.Blob),sessionStorage:function(){try{return!!i.sessionStorage}catch{return!1}}(),localStorage:function(){try{return!!i.localStorage}catch{return!1}}(),cssTransition:(t=r.createElement("div").style,"transition"in t||"WebkitTransition"in t||"MozTransition"in t||"msTransition"in t||"OTransition"in t),cssTranform:function(C){return"transform"in C||"WebkitTransform"in C||"MozTransform"in C||"msTransform"in C||"OTransform"in C}(r.createElement("div").style),cssFlex:function(C){return"flex"in C||"WebkitFlex"in C||"MozFlex"in C||"msFlex"in C||"OFlex"in C}(r.createElement("div").style),cssGrid:function(C){return"grid"in C||"WebkitGrid"in C||"MozGrid"in C||"msGrid"in C||"OGrid"in C}(r.createElement("div").style),html5Form:{placeholder:"placeholder"in r.createElement("input"),supportType:function(C){var _=r.createElement("input");_.setAttribute("type",C);var y=_.type===C;return y&&["text","url","search"].indexOf(C.toLowerCase())<0&&(_.value=":)",y=_.value!==":)"),y}},mutationObserver:i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver,resizeObserver:!!i.ResizeObserver,touchEvent:!!i.touchEvent,pointerEvent:!!i.PointerEvent,draggable:(e=r.createElement("div"),"draggable"in e||"ondragstart"in e&&"ondrop"in e),webAssembly:typeof i.WebAssembly=="object"&&typeof i.WebAssembly.instantiate=="function"}),function(){for(var C=0,_=["ms","moz","webkit","o"],y=0;y<_.length&&!i.requestAnimationFrame;++y)i.requestAnimationFrame=i[_[y]+"RequestAnimationFrame"],i.cancelAnimationFrame=i[_[y]+"CancelAnimationFrame"]||i[_[y]+"CancelRequestAnimationFrame"];i.requestAnimationFrame||(i.requestAnimationFrame=function(T,E){var b=new Date().getTime(),v=Math.max(0,16-(b-C)),I=i.setTimeout(function(){T(b+v)},v);return C=b+v,I}),i.cancelAnimationFrame||(i.cancelAnimationFrame=function(T){clearTimeout(T)})}(),Kekule.X={};var a,o=Kekule.X,l=function(C){return!function(_){return _==null}(C)},u=function(C){var _=i.getComputedStyle?i.getComputedStyle(C,null).position:C.currentStyle?C.currentStyle.position:null;return!!_&&!!_&&((_=_.toString().toLowerCase())==="relative"||_==="absolute")};if(o.MutationObserver=i.MutationObserver||i.MozMutationObserver||i.WebkitMutationObserver,o.Event={MOUSE_BTN_LEFT:0,MOUSE_BTN_RIGHT:2,MOUSE_BTN_MID:1,MOUSE_BTN_LR:3},o.Event.PointerType={MOUSE:"mouse",TOUCH:"touch",PEN:"pen"},o.Event.MouseButton={LEFT:0,RIGHT:2,MID:1,LR:3},o.Event.KeyCode={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRTSC:44,INS:45,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145},o.Event.isSupported=(a={},function(C){if(C.indexOf("touch")===0)return Kekule.BrowserFeature.touchEvent;if(C.indexOf("pointer")===0)return Kekule.BrowserFeature.pointerEvent;var _={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img",unload:"win",resize:"win"},y=C.replace(/^on/,"");if(a[y])return a[y];var T=_[y]=="win"?i:r.createElement(_[y]||"div"),E=(C="on"+y)in T;return E||(T.setAttribute(C,"return;"),E=typeof T[C]=="function"),T=null,a[y]=E,E}),o.Event.Methods={getType:function(C){return C.__$type__||C.type},setType:function(C,_){C.__$type__=_;try{C.type=_}catch{}},getPointerType:function(C){return C.pointerType},getTarget:function(C){var _=C.__$target__||C.target||C.srcElement;return _.nodeType==3&&(_=_.parentNode),_},setTarget:function(C,_){C.__$target__=_;try{C.target=_}catch{}},getCurrentTarget:function(C){return C.currentTarget},getEventPhase:function(C){return C.eventPhase},getAltKey:function(C){return C.altKey},getCtrlKey:function(C){return C.ctrlKey},getShiftKey:function(C){return C.shiftKey},getMetaKey:function(C){return C.metaKey},getRepeat:function(C){return C.repeat},getCharCode:function(C){return l(C.charCode)?C.charCode:C.keyCode},getKeyCode:function(C){return C.keyCode},getKey:function(C){return C.key},getCode:function(C){return C.code},getClientX:function(C){var _;if(C.touches){var y=C.touches[0];_=y&&y.clientX}return _===void 0&&(_=C.clientX),_},getClientY:function(C){var _;if(C.touches){var y=C.touches[0];_=y&&y.clientY}return _===void 0&&(_=C.clientY),_},getScreenX:function(C){var _;if(C.touches){var y=C.touches[0];_=y&&y.screenX}return _===void 0&&(_=C.screenX),_},getScreenY:function(C){var _;if(C.touches){var y=C.touches[0];_=y&&y.screenY}return _===void 0&&(_=C.screenY),_},getPageX:function(C){var _;if(C.touches){var y=C.touches[0];y&&l(y.pageX)&&(_=y.pageX)}if(_===void 0&&l(C.pageX)&&(_=C.pageX),_===void 0){var T=o.Event.getTarget(C).ownerDocument||o.Event.getTarget(C),E=T?T.body:null;_=o.Event.getClientX(C)+(T&&T.scrollLeft||E&&E.scrollLeft||0)-(T&&T.clientLeft||E&&E.clientLeft||0)}return _},getPageY:function(C){var _;if(C.touches){var y=C.touches[0];if(y&&l(y.pageY))return y.pageY}else if(_===void 0&&l(C.pageY))return C.pageY;if(_===void 0){var T=o.Event.getTarget(C).ownerDocument||o.Event.getTarget(C),E=T?T.body:null;_=o.Event.getClientY(C)+(T&&T.scrollTop||E&&E.scrollTop||0)-(T&&T.clientTop||E&&E.clientTop||0)}return _},getOffsetX:function(C){if(l(C.offsetX))return C.offsetX;var _=o.Event.getTarget(C);if((_.defaultView||_.parentWindow)&&_.body&&(_=_.body),l(C.layerX)&&u(_)&&!C.touches)return C.layerX;var y=o.Event.getClientX(C);return Math.round(y-Kekule.HtmlElementUtils.getElemPagePos(_,!0).x)},getOffsetY:function(C){if(l(C.offsetY))return C.offsetY;var _=o.Event.getTarget(C);if((_.defaultView||_.parentWindow)&&_.body&&(_=_.body),l(C.layerY)&&u(_)&&!C.touches)return C.layerY;var y=o.Event.getClientY(C);return Math.round(y-Kekule.HtmlElementUtils.getElemPagePos(_,!0).y)},getOffsetCoord:function(C,_){var y,T=o.Event.getTarget(C);if(_&&Kekule.ObjUtils.isUnset(C.offsetX)&&(y=Kekule.StyleUtils.getTotalTransformMatrix(T)),y){var E=o.Event.getClientX(C),b=o.Event.getClientY(C),v={x:E-Kekule.HtmlElementUtils.getElemBoundingClientRect(T).x,y:b-Kekule.HtmlElementUtils.getElemBoundingClientRect(T).y},I=Kekule.StyleUtils.calcInvertTransformMatrix(y);if(I){var R=Kekule.MatrixUtils.create(3,1);R[0][0]=v.x,R[1][0]=v.y,R[2][0]=1;var N=Kekule.MatrixUtils.multiply(I,R);return v.x=N[0][0],v.y=N[1][0],v}}return{x:o.Event.getOffsetX(C),y:o.Event.getOffsetY(C)}},getWindowX:function(C){var _=o.Event.getPageX(C),y=C.target.ownerDocument||C.target,T=y&&(y.defaultView||y.parentWindow);return _-(T&&T.scrollX||0)},getWindowY:function(C){var _=o.Event.getPageY(C),y=C.target.ownerDocument||C.target,T=y&&(y.defaultView||y.parentWindow);return _-(T&&T.scrollY||0)},getRelXToCurrTarget:function(C){var _=o.Event.getCurrentTarget(C);(_.defaultView||_.parentWindow)&&_.body&&(_=_.body);var y=o.Event.getClientX(C);return Math.round(y-Kekule.HtmlElementUtils.getElemPagePos(_,!0).left)},getRelYToCurrTarget:function(C){var _=o.Event.getCurrentTarget(C);(_.defaultView||_.parentWindow)&&_.body&&(_=_.body);var y=o.Event.getClientY(C);return Math.round(y-Kekule.HtmlElementUtils.getElemPagePos(_,!0).top)},getTouches:function(C){return C.touches}},o.Event._MouseEventEx={isMouseEnterLeaveEvent:function(C){return C==="mouseenter"||C==="mouseleave"},addMouseEnterLeaveListener:function(C,_,y,T){if(_==="mouseenter"&&o.Event.isSupported("mouseenter")||_==="mouseleave"&&o.Event.isSupported("mouseleave"))return C.addEventListener(_,y,T);var E=function(v){var I=v.getTarget?v.getTarget():v.target,R=v.getCurrentTarget?v.getCurrentTarget():v.currentTarget;if(I===R||Kekule.DomUtils.isDescendantOf(I,R)){var N=v.getRelatedTarget?v.getRelatedTarget():v.relatedTarget;if(!N||!Kekule.DomUtils.isDescendantOf(N,R)){var L=new MouseEvent(_,{view:i,bubbles:!1,cancelable:!0,target:R,currentTarget:R,relatedTarget:N});y.call(R,L)}}};y.__$mouseExListenerWrapper__=E;var b=_==="mouseenter"?"mouseover":"mouseout";return C.addEventListener(b,E,T)},removeMouseEnterLeaveListener:function(C,_,y){if(_==="mouseenter"&&o.Event.isSupported("mouseenter")||_==="mouseleave"&&o.Event.isSupported("mouseleave"))return C.removeEventListener(_,y);var T=_==="mouseenter"?"mouseover":"mouseout";return C.removeEventListener(T,y.__$mouseExListenerWrapper__||y)}},o.Event._W3C={addListener:function(C,_,y,T){return o.Event._MouseEventEx.isMouseEnterLeaveEvent(_)?o.Event._MouseEventEx.addMouseEnterLeaveListener(C,_,y,T):C.addEventListener(_,y,T)},removeListener:function(C,_,y,T){return o.Event._MouseEventEx.isMouseEnterLeaveEvent(_)&&y.__$listenerWrapper__?o.Event._MouseEventEx.removeMouseEnterLeaveListener(C,_,y.__$listenerWrapper__):C.removeEventListener(_,y,T)},stopPropagation:function(C){C.stopPropagation()},preventDefault:function(C){C.preventDefault()}},o.Event._W3CMethods={getRelatedTarget:function(C){return C.relatedTarget},getButton:function(C){return C.button}},o.Event._Gecko={addListener:function(C,_,y,T){if(o.Event._MouseEventEx.isMouseEnterLeaveEvent(_))return o.Event._MouseEventEx.addMouseEnterLeaveListener(C,_,y,T);if(_==="mousewheel"){var E=function(b){b.wheelDeltaY=b.wheelDelta=40*-b.detail,b.__$type__="mousewheel",y.call(C,b)};y.__$mousewheelListenerWrapper__=E,C.addEventListener("DOMMouseScroll",E,T)}else C.addEventListener(_,y,T)},removeListener:function(C,_,y,T){_==="mousewheel"&&y.__$mousewheelListenerWrapper__?C.removeEventListener("DOMMouseScroll",y.__$mousewheelListenerWrapper__,T):C.removeEventListener(_,y,T)}},o.Event._IE={_handlers:{},WIN_UNLOAD_FLAG_FIELD:"__$win_unload_linked__",addListener:function(C,_,y,T){if(!(o.Event.findHandlerIndex(C,_,y)>=0)){var E=function(I){I||(I=v.event),I.currentTarget=C,I.eventPhase=I.srcElement===C?2:3,h||Object.extend(I,p),y.call(C,I)};C.attachEvent(o.Event.getEventName(_),E),o.Event.registerHandler(C,_,y,E);var b=C.ownerDocument||C,v=b.parentWindow||b;o.Event._linkUnloadEvent(v)}},removeListener:function(C,_,y,T){var E=o.Event.findHandlerIndex(C,_,y);if(E>=0){var b=o.Event._handlers[_][E].wrapper;C.detachEvent(o.Event.getEventName(_),b),o.Event._handlers[_].splice(E,1)}},stopPropagation:function(C){C.cancelBubble=!0},preventDefault:function(C){C.returnValue=!1},removeAllListeners:function(C){var _=o.Event._handlers;if(_){for(var y in _)if(_.hasOwnProperty(y)){var T=_[y];if(T&&T.length)for(var E=o.Event.getEventName(y),b=T.length-1;b>=0;--b){var v=T[b];C&&v.element.ownerDocument!==C||(v.element.detachEvent(E,v.wrapper),T.splice(b,1))}}}},getEventName:function(C){return"on"+C},registerHandler:function(C,_,y,T){var E=o.Event._handlers;E[_]||(E[_]=[]),E[_].push({element:C,handler:y,wrapper:T})},unregisterHandler:function(C,_,y){if(y[_]){var T=y[_],E=o.Event.findHandlerIndex(C,_,y);E>=0&&T.splice(E,1)}},findHandlerIndex:function(C,_,y){var T=o.Event._handlers[_];if(!T)return-1;for(var E=0,b=T.length;E<b;++E){var v=T[E];if(v.element===C&&v.handler===y)return E}return-1},_linkUnloadEvent:function(C){var _=o.Event.WIN_UNLOAD_FLAG_FIELD;C[_]||(C.attachEvent("onunload",o.Event.reactWinUnload),C[_]=!0)},reactWinUnload:function(){var C=this.ownerDocument;o.Event.removeAllListeners(C)}},o.Event._IEMethods={getRelatedTarget:function(C){var _=C.type;return["focusin","mouseenter","mouseover","pointerenter","pointerover","dragenter"].indexOf(_)>=0?C.fromElement||C.toElement:C.toElement||C.fromElement},getButton:function(C){switch(C.button){case 1:return 0;case 2:return 2;case 4:return 1;case 3:return 3;default:return C.button}},stopPropagation:function(C){C.cancelBubble=!0},preventDefault:function(C){C.returnValue=!1}},r){if(r.addEventListener)o.Event=Object.extend(o.Event,o.Event._W3C),o.Event.Methods=Object.extend(o.Event.Methods,o.Event._W3CMethods),Kekule.Browser.Gecko&&(o.Event=Object.extend(o.Event,o.Event._Gecko));else if(r.attachEvent&&(o.Event=Object.extend(o.Event,o.Event._IE),o.Event.Methods=Object.extend(o.Event.Methods,o.Event._IEMethods),i.Element)){var c=i.Element.prototype;c.addEventListener=o.Event.addListener.methodize(),c.removeEventListener=o.Event.removeListener.methodize()}}Object.extend(o.Event,o.Event.Methods);var d=null;i.Event&&(d=i.Event.prototype),d||r&&r.createEvent&&(d=r.createEvent("HTMLEvents").__proto__);var h=!!d,p={},g=o.Event.Methods;for(var f in g)g.hasOwnProperty(f)&&typeof g[f]=="function"&&(p[f]=g[f].methodize());d&&Object.extend(d,p),function(){if(r!==void 0){var C=r.createElement("div");!("draggable"in C)&&"ondragstart"in C&&"ondrop"in C&&Kekule.X.Event.addListener(r,"selectstart",function(_){for(var y=_.target;y;y=y.parentNode)if(y.attributes&&y.attributes.draggable)return _.preventDefault(),_.stopImmediatePropagation?_.stopImmediatePropagation():_.stopPropagation(),y.dragDrop(),!1})}}(),o.Ajax={XMLHttpFactories:[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],_availableFactoryIndex:-1,createXMLHTTPObject:function(){var C=!1,_=o.Ajax.XMLHttpFactories,y=o.Ajax._availableFactoryIndex;if(y>=0)C=_[y]();else for(var T=0;T<_.length;T++){try{C=_[T](),o.Ajax._availableFactoryIndex=T}catch{continue}break}return C},preparePostData:function(C){var _=C;return typeof C=="object"&&(_=Kekule.UrlUtils.generateSearchString(C)),_},request:function(C){return o.Ajax.sendRequest(C.url,C.callback,C.postData,C.xhrProps)},sendRequest:function(C,_,y,T,E){var b=!1,v=!0,I=o.Ajax.createXMLHTTPObject();if(I){var R,N,L=y?"POST":"GET";if(I.open(L,C,!0),I.setRequestHeader("User-Agent","XMLHTTP/1.0"),y&&I.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T&&(typeof T=="object"?(R=(N=T).responseType,E=N.overwriteMimeType):typeof T=="string"&&(R=T)),R){try{I.responseType=R}catch{}R!=="arraybuffer"&&R!=="blob"||(b=!0),I.responseType!==R&&(v=!1)}if(b&&!v&&I.overwriteMimeType&&I.overrideMimeType("text/plain; charset=x-user-defined"),E&&I.overwriteMimeType&&I.overwriteMimeType(E),N){for(var U in N)if(U in I)try{I[U]=N[U]}catch{}}if(I.onreadystatechange=function(){if(I.readyState==4){if(I.status!=200&&I.status!=304)throw _(null,I,!1),"HTTP error "+I.status;_(I.response||I.responseText,I,!0)}},I.readyState!=4)return I.send(o.Ajax.preparePostData(y)),I}},getResponseMimeType:function(C){return C.getResponseHeader("content-type")||""}},Kekule.Ajax=Kekule.X.Ajax,Kekule.X.DomReady={isReady:!1,suspendFlag:0,funcs:[],domReady:function(C,_){if(_||(_=r),m.initReady(_),!m.isReady){var y=_&&_.readyState;(y==="complete"||y==="loaded"||y==="interactive"&&!Kekule.Browser.IE)&&(m.isReady=!0)}m.isReady?C():m.funcs.push(C)},fireReady:function(){m.isReady||(m.isReady=!0,m._execFuncs())},_execFuncs:function(){var C=m.funcs;if(C&&C.length)for(;C.length&&!m.isSuspending();){var _=C.shift();_&&_()}},suspend:function(){++m.suspendFlag},resume:function(){m.suspendFlag>0&&--m.suspendFlag,m.isSuspending()||m._execFuncs()},isSuspending:function(){return m.suspendFlag>0},initReady:function C(_){_||(_=r),_&&_.addEventListener?_.addEventListener("DOMContentLoaded",function(){_.removeEventListener("DOMContentLoaded",C,!1),m.fireReady()},!1):_&&_.getElementById&&(_.write('<script id="ie-domReady" defer="defer" src="//:"><\/script>'),_.getElementById("ie-domReady").onreadystatechange=function(){this.readyState==="complete"&&(m.fireReady(),this.onreadystatechange=null,this.parentNode.removeChild(this))})}};var m=Kekule.X.DomReady;Kekule.X.domReady=m.domReady})(void 0),function(s){var e=!0;typeof window>"u"&&(e=!1),Kekule.NativeServices={MODE_OPEN:"open",MODE_SAVE:"save",FILTER_ALL_SUPPORT:"all",FILTER_ANY:"any",showFilePickerDialog:function(n,i,r){if(Kekule.NativeServices.doShowFilePickerDialog)return Kekule.NativeServices.doShowFilePickerDialog(n,i,r)},canLoadFileData:function(n){return!!t.doLoadFileData||!!t.doShowFilePickerDialog},loadFileData:function(n,i,r){if(Kekule.NativeServices.doLoadFileData)return Kekule.NativeServices.doLoadFileData(n,i,r);var a=Object.create(r||{});a.multiple=!1,a.mode=t.MODE_OPEN,t.showFilePickerDialog(n,function(o,l,u){if(o&&l)if(Kekule.BrowserFeature.fileapi){var c=l.name,d=a.binaryDetector&&a.binaryDetector(c,l),h=new FileReader;h.onload=function(p){var g=h.result;i&&i(!0,g,c)},h.onerror=function(){i&&i(!1),Kekule.error(Kekule.$L("ErrorMsg.ERROR_LOADING_FILE"+c))},d?h.readAsArrayBuffer(l):h.readAsText(l)}else Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"));else i(o,null,null)},a)},canSaveFileData:function(n){return!!t.doSaveFileData},saveFileData:function(n,i,r,a){if(Kekule.NativeServices.doSaveFileData)return Kekule.NativeServices.doSaveFileData(n,i,r,a)}};var t=Kekule.NativeServices;Kekule.HtmlNativeServiceImpl={doShowFilePickerDialog:function(n,i,r){Kekule.HtmlNativeServiceImpl._createFileInputElem(n,i,r||{}).click()},_getFileInputElemForPickerDialog:function(n,i,r){},_createFileInputElem:function(n,i,r){var a=n.createElement("input");a.setAttribute("type","file");var o=r||{};if(o.multiple&&a.setAttribute("multiple","multiple"),o.filters){for(var l=[],u=0,c=o.filters.length;u<c;++u){var d=o.filters[u];if(d!==Kekule.NativeServices.FILTER_ALL_SUPPORT&&d!==Kekule.NativeServices.FILTER_ANY){var h=d.filter;h&&l.push(h)}}var p=l.join(",");a.setAttribute("accept",p)}var g=a.style;g.position="absolute",g.left="-100000px",g.opacity=0,n.body.appendChild(a);var f=function(m){var C=m.getTarget(),_=C.files,y=_&&_[0];i&&i(!0,y,_),Kekule.X.Event.removeListener(C,"change",f),C.ownerDocument.body.focus(),C.parentNode&&C.parentNode.removeChild(C)};return Kekule.X.Event.addListener(a,"change",f),a},doSaveFileData:function(n,i,r,a){var o=a.initialFileName||null,l=Kekule.HtmlNativeServiceImpl._createDataElem(n,i,o);l.click(),l.parentNode.removeChild(l),r&&r(null,null)},_createDataElem:function(n,i,r){var a=n.createElement("a"),o="data:application/octet-stream,"+encodeURIComponent(i);return a.setAttribute("href",o),a.setAttribute("download",r||""),a.style,a.position="absolute",a.left="-100000px",a.opacity=0,n.body.appendChild(a),a},doSaveFileDataIe:function(n,i,r,a){var o=a.initialFileName||null;if(Kekule.BrowserFeature.blob&&e&&window.navigator.msSaveOrOpenBlob){var l=new Blob([i]);window.navigator.msSaveBlob(l,o)}else{var u=Kekule.HtmlNativeServiceImpl._createAndExecDataIframe(n,i,o);u.parentNode.removeChild(u)}r&&r(null,null)},_createAndExecDataIframe:function(n,i,r){var a=n.createElement("iframe");n.body.appendChild(a);var o=a.contentWindow||a.contentDocument;o.document.open("text/html","replace");var l=i.toString();return o.document.write(l),o.document.close(),o.focus(),o.document.execCommand("SaveAs",!0,Kekule.UrlUtils.extractFileCoreName(r)),a}},Kekule.BrowserFeature.fileapi&&(t.doShowFilePickerDialog=Kekule.HtmlNativeServiceImpl.doShowFilePickerDialog),Kekule.Browser.IE||e&&window.navigator.msSaveOrOpenBlob?t.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileDataIe:Kekule.BrowserFeature.downloadHref&&(t.doSaveFileData=Kekule.HtmlNativeServiceImpl.doSaveFileData)}(),Kekule.PredefinedResLoader=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PredefinedResLoader",initialize:function(s,e,t){this.tryApplySuper("initialize"),e?(this.setPropStoreFieldValue("resUri",e),this.setDoc(s),t&&this.setResType(t)):Kekule.Error(Kekule.$L("ErrorMsg.EMPTY_RESURI"))},initProperties:function(){this.defineProp("doc",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("resUri",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("resType",{dataType:DataType.STRING,serializable:!1})},getLinkedResUrl:function(s){var e=s.tagName.toLowerCase();return e==="link"?s.getAttribute("href"):e==="script"?s.getAttribute("src"):null},getElemResType:function(s){return s.getAttribute("type")},load:function(s){var e,t,n=this.getResUri(),i=Kekule.PredefinedResReferer.ID_MARK;if(n.startsWith(i)){var r=n.substr(i.length).trim();if(e=this.getDoc().getElementById(r)){t=this.getLinkedResUrl(e);var a=this.getElemResType(e);a&&this.setResType(a)}}else t=n;var o={resType:this.getResType(),resUri:n};if(t)Kekule.X.Ajax.sendRequest(t,function(d,h,p){if(p){if(!(o=Object.extend(o,{data:d,text:h.responseText,success:!0})).resType&&(o.resType=Kekule.X.Ajax.getResponseMimeType(h),o.resType===Kekule.IO.MimeType.OCTSTREAM)){var g=Kekule.UrlUtils.extractFileExt(t);if(g){var f=Kekule.IO.DataFormatsManager.findFormat(null,g);f&&(o.resType=f.mimeType)}}s(o,p)}else s(o,!1)},null,null,this.getResType()||null);else if(e){var l=e.innerHTML,u=2,c=l.indexOf(`\r
`);c<0&&(c=l.indexOf(`
`),u=1),c===0&&(l=l.substring(u)),o=Object.extend(o,{data:l,text:l,resType:o.resType||"text/plain",success:!0}),s(o,!0)}else s(o,!1)}}),Kekule.PredefinedResReferer={REFER_PATTERN:/^\s*url\((\S+)\)\s*$/,ID_MARK:"#",isResValue:function(s){return Kekule.PredefinedResReferer.isResReferrer(s)},isResReferrer:function(s){return Kekule.PredefinedResReferer.REFER_PATTERN.test(s)},extractReferedValue:function(s){var e=Kekule.PredefinedResReferer.REFER_PATTERN.exec(s);if(e){var t=e[1];if(t)return t=Kekule.StrUtils.unquote(t)}return null},loadResource:function(s,e,t,n){n||(n=document);var i,r=Kekule.PredefinedResReferer.extractReferedValue(s);(i=new Kekule.PredefinedResLoader(n,r))&&(t&&i.setResType(t),i.load(e))}},Kekule._registerAfterLoadSysProc(function(){Kekule.IO&&(Kekule.IO.loadResourceData=function(s,e,t,n){Kekule.PredefinedResReferer.loadResource(s,function(i,r){var a;r&&(a=Kekule.IO.loadTypedData(i.data,i.resType,i.resUri)),e&&e(a,r)},t,n)})}),Kekule.StyleUtils={removeStyleProperty:function(s,e){s.removeProperty?s.removeProperty(e):s.removeAttribute?s.removeAttribute(e):s[e]=null},analysisUnitsValue:function(s){var e,t={};if(t.total=s,t.value=parseFloat(s),s&&s.length&&t.value!==void 0&&!isNaN(t.value)){e="";for(var n=s.length-1;n>=0;--n){var i=s.charAt(n);i>="0"&&i<="9"||i==="."||i==="-"||(e=i+e)}}return t.units=e||"",t},multiplyUnitsValue:function(s,e){var t=Kekule.StyleUtils.analysisUnitsValue(s);return t.value*=e,""+t.value+t.units},colorStrToValue:function(s){var e=Kekule.StyleUtils.analysisCssColor(s,!0);return(Math.round(e.r)<<16)+(Math.round(e.g)<<8)+Math.round(e.b)},analysisCssColor:function(s,e){var t=Kekule.StyleUtils,n=(s||"").toLowerCase();if(n.indexOf("#")===0){var i=n.substr(1);return t._analyisCssColorHex(i)}if(n.indexOf("rgb")===0){var r=n.indexOf("("),a=n.indexOf(")");return r<0||a<0?null:t._analysisCssColorRgbOrHsl(n.substring(r+1,a),!1)}if(n.indexOf("hsl")===0){if(r=n.indexOf("("),a=n.indexOf(")"),r<0||a<0)return null;var o=t._analysisCssColorRgbOrHsl(n.substring(r+1,a),!0);return e&&(o=Object.extend(o,t._convertHslToRgb(o))),o}return null},_analyisCssColorHex:function(s){for(var e=s.length,t=e===3,n=t?1:2,i=Math.min(4,Math.floor(e/n)),r=[],a=0;a<i;++a){var o=a*n,l=s.substr(o,n);t&&(l+=l),r.push(parseInt(l,16))}var u={r:r[0]||0,g:r[1]||0,b:r[2]||0};return Kekule.ObjUtils.notUnset(r[3])?u.a=r[3]/255:u.a=1,u},_analysisCssColorRgbOrHsl:function(s,e){var t,n=Kekule.StyleUtils._convertCssNumOrPercentageToNum,i=s.split(",");return t=e?{h:n(i[0],360),s:n(i[1]),l:n(i[2])}:{r:n(i[0],255),g:n(i[1],255),b:n(i[2],255)},Kekule.ObjUtils.notUnset(i[3])?t.a=n(i[3]):t.a=1,t},_convertHslToRgb:function(s,e){e||(e=255);var t,n,i,r=s.h,a=s.s,o=s.l;if(a===0)t=n=i=o;else{var l=o<.5?o*(1+a):o+a-o*a,u=2*o-l,c=r/360,d=[c+1/3,c,c-1/3],h=0;for(o=d.length;h<o;++h)d[h]<0?d[h]=d[h]+1:d[h]>1&&(d[h]=d[h]-1),6*d[h]<1?d[h]=u+6*(l-u)*d[h]:2*d[h]<1?d[h]=l:3*d[h]<2?d[h]=u+6*(l-u)*(2/3-d[h]):d[h]=u;t=d[0],n=d[1],i=d[2]}return{r:t*e,g:n*e,b:i*e}},_convertCssNumOrPercentageToNum:function(s,e){var t=parseFloat(s)||0;return s.endsWith("%")&&(t=t/100*(e||1)),t},getComputedStyle:function(s,e){var t,n=s.ownerDocument;if(!n)return null;var i=n.defaultView;return i&&i.getComputedStyle?t=i.getComputedStyle(s,null):s.currentStyle&&(t=s.currentStyle),t?e?e.indexOf("-")>=0&&t.getPropertyValue?t.getPropertyValue(e):t[e]:t:null},isShown:function(s){var e=Kekule.StyleUtils;return e.isDisplayed(s)&&e.isVisible(s)},isDisplayed:function(s){return(Kekule.StyleUtils.getComputedStyle(s,"display")||"").toLowerCase()!=="none"},getDisplayed:function(s){return Kekule.StyleUtils.getComputedStyle(s,"display")},setDisplay:function(s,e){s&&(s.style.display=typeof e=="string"?e:e?"":"none")},isVisible:function(s){return(Kekule.StyleUtils.getComputedStyle(s,"visibility")||"").toLowerCase()!=="hidden"},getVisibility:function(s){return Kekule.StyleUtils.getComputedStyle(s,"visibility")},setVisibility:function(s,e){s&&(s.style.visibility=typeof e=="string"?e:e?"":"hidden")},isBlockElem:function(s){var e=Kekule.StyleUtils.getComputedStyle(s,"display");return["block","list-item","table","flex","grid"].indexOf(e)>=0},isAbsOrFixPositioned:function(s){var e=Kekule.StyleUtils.getComputedStyle(s,"position")||"";return(e=e.toLowerCase())==="absolute"||e==="fixed"},_fillAbsOrFixedPositionStyleStack:function(s,e){if(Kekule.DomUtils.isElement(s)){var t=Kekule.StyleUtils.getComputedStyle(s,"position")||"";(t=t.toLowerCase())!=="absolute"&&t!=="fixed"||e.push(t.toLocaleLowerCase())}var n=s.parentNode;return n&&n.ownerDocument&&Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(n,e),e},isAncestorPositionFixed:function(s){return!!s.parentNode&&Kekule.StyleUtils.isSelfOrAncestorPositionFixed(s)},isSelfOrAncestorPositionFixed:function(s){var e=[];if(Kekule.StyleUtils._fillAbsOrFixedPositionStyleStack(s,e),!e.length)return null;for(var t=e.length-1;t>=0;--t)if(e[t]==="fixed")return!0;return!1},setCursor:function(s,e){if(DataType.isArrayValue(e)){for(var t=0,n=e.length;t<n;++t){var i=e[t];if(s.style.cursor=i,s.style.cursor===i)return i}return s.style.cursor}return s.style.cursor=e,s.style.cursor},_cssTransformValuesToMatrix:function(s){var e=Kekule.MatrixUtils.create(3,3,0);return e[0][0]=s.a,e[1][0]=s.b,e[0][1]=s.c,e[1][1]=s.d,e[0][2]=s.tx,e[1][2]=s.ty,e},_matrixToCssTransformValues:function(s){return{a:s[0][0],b:s[1][0],c:s[0][1],d:s[1][1],tx:s[0][2],ty:s[1][2]}},hasTransform:function(s){var e=Kekule.StyleUtils.getComputedStyle(s,"transform");return e&&e!=="none"},getTransformMatrixValues:function(s){var e=(Kekule.StyleUtils.getComputedStyle(s,"transform")||"").match(/-?[\d\.]+/g);return e?{a:e[0],b:e[1],c:e[2],d:e[3],tx:e[4],ty:e[5]}:null},setTransformMatrixArrayValues:function(s,e){if(e){var t="matrix("+e.join(",")+")";s.style.transform=t}},getTransformMatrix:function(s){var e=Kekule.StyleUtils.getTransformMatrixValues(s);return e?Kekule.StyleUtils._cssTransformValuesToMatrix(e):null},getCascadeTranformMatrixes:function(s){for(var e=[],t=s;t;){if(t.nodeType===1){var n=Kekule.StyleUtils.getTransformMatrix(t);n&&e.unshift(n)}t=t.parentNode}return e},getTotalTransformMatrix:function(s){for(var e=Kekule.StyleUtils.getCascadeTranformMatrixes(s),t=null,n=e.length-1;n>=0;--n){var i=e[n];t=t?Kekule.MatrixUtils.multiply(t,i):i}return t},calcInvertTransformMatrix:function(s){var e=Kekule.StyleUtils._matrixToCssTransformValues(s),t=e.a*e.d-e.b*e.c;if(Math.abs(t)<1e-6)return!1;var n={a:e.d/t,b:-e.b/t,c:-e.c/t,d:e.a/t,tx:(e.c*e.ty-e.d*e.tx)/t,ty:(e.b*e.tx-e.a*e.ty)/t};return Kekule.StyleUtils._cssTransformValuesToMatrix(n)}},Kekule.HtmlElementUtils={getClassNames:function(s){return Kekule.StrUtils.splitTokens(s.getAttribute("class")||"")},hasClass:function(s,e){return Kekule.HtmlElementUtils.getClassNames(s).indexOf(e)>=0},addClass:function(s,e){for(var t=Kekule.HtmlElementUtils,n=Kekule.ArrayUtils.isArray(e)?e:Kekule.StrUtils.splitTokens(e),i=0,r=n.length;i<r;++i)t.hasClass(s,n[i])||(s.className+=" "+n[i]);return t},removeClass:function(s,e){for(var t=Kekule.HtmlElementUtils,n=Kekule.ArrayUtils.isArray(e)?e:Kekule.StrUtils.splitTokens(e),i=t.getClassNames(s),r=i.length;r>=0;--r)n.indexOf(i[r])>=0&&i.splice(r,1);return s.className=i.join(" "),t},toggleClass:function(s,e){for(var t=Kekule.HtmlElementUtils,n=Kekule.ArrayUtils.isArray(e)?e:Kekule.StrUtils.splitTokens(e),i=0,r=n.length;i<r;++i)t.hasClass(s,n[i])?t.removeClass(s,n[i]):t.addClass(s,n[i]);return t},getInnerText:function(s){return s.innerText||s.textContent},resizeElem:function(s,e,t,n){s.style.width=e+(n||"px"),s.style.height=t+(n||"px")},getElemClientDimension:function(s){return{width:s.clientWidth,height:s.clientHeight}},getElemScrollDimension:function(s){return{width:s.scrollWidth,height:s.scrollHeight}},getElemComputedDimension:function(s){var e=Kekule.StyleUtils,t={width:e.getComputedStyle(s,"width"),height:e.getComputedStyle(s,"height")},n=e.analysisUnitsValue(t.width),i=e.analysisUnitsValue(t.height),r={};return n.units==="px"&&(r.width=n.value),i.units==="px"&&(r.height=n.value),r},getElemOffsetDimension:function(s){return{width:s.offsetWidth,height:s.offsetHeight}},getViewportDimension:function(s){var e;if(s&&(e=s.ownerDocument?Kekule.DocumentUtils.getDefaultView(s.ownerDocument):s.defaultView?s.defaultView:s.parentWindow?s.parentWindow:s),(e=e||window).innerWidth!=null)return{width:e.innerWidth,height:e.innerHeight};var t=e.document;return t.compatMode=="CSS1Compat"?{width:t.documentElement.clientWidth,height:t.documentElement.clientHeight}:{width:t.body.clientWidth,height:t.body.clientHeight}},getViewportVisibleBox:function(s){var e;s&&(e=s.ownerDocument?Kekule.DocumentUtils.getDefaultView(s.ownerDocument):s.defaultView?s.defaultView:s.parentWindow?s.parentWindow:s);var t=(e=e||window).document,n=Kekule.HtmlElementUtils.getViewportDimension(e),i=Kekule.DocumentUtils.getScrollPosition(t),r={x1:i.left,y1:i.top,x2:n.width,y2:n.height};return r.left=r.x1,r.top=r.y1,r.right=r.x2,r.bottom=r.y2,r},getElemBoundingClientRect:function(s,e){var t=Object.extend({},s.getBoundingClientRect());if(Kekule.ObjUtils.isUnset(t.width)&&(t.width=t.right-t.left),Kekule.ObjUtils.isUnset(t.height)&&(t.height=t.bottom-t.top),e){var n=s.ownerDocument,i=n.documentElement.scrollTop||n.body.scrollTop||0,r=n.documentElement.scrollLeft||n.body.scrollLeft||0;t.left+=r,t.right+=r,t.top+=i,t.bottom+=i}var a=t;return a.x=a.left,a.y=a.top,a},getElemPagePos:function(s,e){for(var t=0,n=0,i=s;i;)t+=i.offsetLeft-i.scrollLeft+i.clientLeft,n+=i.offsetTop-i.scrollTop+i.clientTop,i=i.offsetParent;if(e){var r=s.ownerDocument,a=r.documentElement.scrollTop||r.body.scrollTop||0;t-=r.documentElement.scrollLeft||r.body.scrollLeft||0,n-=a}return{x:t,y:n}},getElemPageRect:function(s,e){var t=Kekule.HtmlElementUtils.getElemPagePos(s,e),n=Kekule.HtmlElementUtils.getElemClientDimension(s);return{x:t.x,y:t.y,left:t.x,top:t.y,right:t.x+n.width,bottom:t.y+n.height,width:n.width,height:n.height}},getElemViewportPos:function(s){var e=Kekule.HtmlElementUtils.getElemPagePos(s,!0);return{x:e.left,y:e.top}},makePositioned:function(s){var e=Kekule.StyleUtils.getComputedStyle(s,"position");e&&e.toLowerCase()!=="static"||(s.style.position="relative")},isFormCtrlElement:function(s){var e=s&&s.tagName.toLowerCase();return!!e&&["input","button","textarea","select"].indexOf(e)>=0},requestFullScreen:function(s){var e=s.requestFullScreen||s.mozRequestFullScreen||s.webkitRequestFullScreen||s.msRequestFullScreen;return e?e.apply(s):null},exitFullScreen:function(s){var e=s.exitFullScreen||s.mozExitFullScreen||s.webkitExitFullScreen||s.msExitFullScreen;return e?e.apply(s):null}},Kekule.DocumentUtils={getDefaultView:function(s){return s.defaultView||s.parentWindow},getScrollPosition:function(s){var e=Kekule.DocumentUtils.getDefaultView(s),t={left:(e.pageXOffset!==void 0?e.pageXOffset:(s.documentElement||s.body.parentNode||s.body).scrollLeft)||0,top:(e.pageYOffset!==void 0?e.pageYOffset:(s.documentElement||s.body.parentNode||s.body).scrollTop)||0};return t.x=t.left,t.y=t.top,t},getClientDimension:function(s){return s.compatMode=="BackCompat"?{width:s.body.clientWidth,height:s.body.clientHeight}:{width:s.documentElement.clientWidth,height:s.documentElement.clientHeight}},getClientVisibleBox:function(s){var e=Kekule.DocumentUtils.getScrollPosition(s),t=Kekule.DocumentUtils.getInnerClientDimension(s),n={};return n.left=n.x1=e.left,n.top=n.y1=e.top,n.right=n.x2=t.width+e.left,n.bottom=n.y2=t.height+e.top,n.width=t.width,n.height=t.height,n},getWindowInnerDimension:function(s){var e=Kekule.DocumentUtils.getDefaultView(s);return{width:Math.min(e.innerWidth,e.outerWidth),height:Math.min(e.innerHeight,e.outerHeight)}},getInnerClientDimension:function(s){var e=Kekule.DocumentUtils.getClientDimension(s),t=Kekule.DocumentUtils.getWindowInnerDimension(s);return{width:t.width?Math.min(t.width,e.width):e.width,height:t.height?Math.min(t.height,e.height):e.height}},getClientScaleLevel:function(s){return s.compatMode=="BackCompat"?s.body.clientWidth/window.innerWidth:s.documentElement.clientWidth/window.innerWidth},getPixelZoomLevel:function(s){return Kekule.DocumentUtils.getClientScaleLevel(s)*(Kekule.DocumentUtils.getDefaultView(s).devicePixelRatio||1)},getDevicePPI:function(s){var e=Kekule.DocumentUtils.getDefaultView(s);if(e.matchMedia){for(var t=0,n=0,i=200;!n||n-t>1;)e.matchMedia("(min-resolution: "+i+"dpi)").matches?n?(t=i,i=Math.round((t+n)/2)):(t=i,i*=2):(n=i,i=Math.round((t+n)/2));return i}return 96}};Kekule.TextLinesBuffer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TextLinesBuffer",LINEBREAK:`
`,initialize:function(s){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("lines",[]),s&&(typeof s=="string"?this.setText(s):this.setLines(s)),this.setCurrLineNo(0)},initProperties:function(){this.defineProp("lines",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getLines().join(this.LINEBREAK)},setter:function(s){this.setPropStoreFieldValue("lines",[]),this.reset(),this.appendText(s)}}),this.defineProp("currLineNo",{dataType:DataType.INT,serializable:!1})},getUnreadLines:function(){var s=[].concat(this.getLines());return s.splice(0,this.getCurrLineNo()),s},getUnreadText:function(){return this.getUnreadLines().join(this.LINEBREAK)},appendText:function(s){var e=s.split(this.LINEBREAK);this.appendLines(e)},appendLines:function(s){this.setPropStoreFieldValue("lines",this.getLines().concat(s)),this.notifyPropSet("lines",this.getPropStoreFieldValue("lines"))},clear:function(){this.setLines([]),this.setCurrLineNo(0)},incCurrLineNo:function(s){s==null&&(s=1);var e=this.getCurrLineNo();e+=s,this.setCurrLineNo(e)},getLineAt:function(s){var e=this.getLines()[s];return e&&e.length&&e.charAt(e.length-1)==="\r"&&(e=e.substring(0,e.length-1)),e},getCurrLine:function(){return this.getLineAt(this.getCurrLineNo())},readLine:function(){var s=this.getLineAt(this.getCurrLineNo());return this.incCurrLineNo(),s},writeLine:function(s){this.getLines().splice(this.getCurrLineNo(),0,s),this.incCurrLineNo()},writeLines:function(s){for(var e=0,t=s.length;e<t;++e)this.writeLine(s[e])},writeText:function(s){var e=s.split(this.LINEBREAK);this.writeLines(e)},eof:function(){return this.getCurrLineNo()>=this.getLines().length},reset:function(){this.setCurrLineNo(0)}}),function(){Kekule.globalOptions.add("IO",{}),Kekule.IO={},Kekule.IO.ChemDataType={TEXT:"text",DOM:"dom",JSON:"json",BINARY:"bin",OTHER:"other",UNKNOWN:"unknown",isBinaryType:function(e){var t=Kekule.IO.ChemDataType;return!e||e===t.BINARY||e===t.OTHER||e===t.UNKNOWN}},Kekule.IO.DataFormat={},Kekule.IO.MimeType={TEXT:"text/plain",HTML:"text/html",XML:"text/xml",JSON:"application/json",JAVASCRIPT:"application/javascript",GIF:"image/gif",JPEG:"image/jpeg",PNG:"image/png",XPNG:"image/x-png",OCTSTREAM:"application/octet-stream"},Kekule.IO.DataFormatsManager={_formats:{},register:function(e,t,n,i,r,a,o){var l=null;l||(l=s._formats[e]),l||(l={id:e},s._formats[e]=l),l.mimeType=t;var u=DataType.isArrayValue(n)?n:[n];return u=u.map(function(c){return c&&c.toLowerCase()}),l.fileExts?Kekule.ArrayUtils.pushUnique(l.fileExts,u):l.fileExts=u,i&&i!==Kekule.IO.ChemDataType.UNKNOWN&&(l.dataType=i),l.title=r,l.description=a,o&&(l=Object.extend(l,o)),l},unregister:function(e){s._formats[e]&&delete s._formats[e]},getAllIds:function(){return Kekule.ObjUtils.getOwnedFieldNames(s._formats)},getFormatInfo:function(e){return s._formats[e]||null},getMimeType:function(e){var t=s.getFormatInfo(e);return t?t.mimeType:null},getFileExts:function(e){var t=s.getFormatInfo(e);return t?t.fileExts:null},findFormat:function(e,t){if(!e&&!t)return null;for(var n=s.getAllIds(),i=!1,r=0,a=n.length;r<a;++r){var o=s.getFormatInfo(n[r]);if((i=e&&e===o.mimeType)||(i=t&&o.fileExts.indexOf(t.toLowerCase())>=0),i)return o}return null},findFormatId:function(e,t){var n=Kekule.IO.DataFormatsManager.findFormat(e,t);return n?n.id:null}};var s=Kekule.IO.DataFormatsManager;Kekule.IO.dataFormatsManager=Kekule.IO.DataFormatsManager,Kekule.IO.ChemDataReader=Class.create(ObjectEx,{initialize:function(e){this.tryApplySuper("initialize")},CLASS_NAME:"Kekule.IO.ChemDataReader",readData:function(e,t,n,i){if(!t){var r=Kekule.IO.DataFormatsManager.getFormatInfo(n);(t=r?r.dataType:null)||(t=typeof e=="string"?Kekule.IO.ChemDataType.TEXT:e.getElementsByTagName?Kekule.IO.ChemDataType.DOM:Kekule.IO.ChemDataType.BINARY)}var a=this.doReadData(e,t,n,i||{});if(a instanceof Kekule.ChemObject&&a.getSrcInfo){var o=a.getSrcInfo();o.data=e,o.dataType=t;var l=Kekule.IO.DataFormatsManager.getFormatInfo(n);l&&(o.format=n,o.mimeType=l.mimeType,o.possibleFileExts=l.fileExts)}return a},doReadData:function(e,t,n,i){}}),Kekule.IO.ChemDataWriter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.ChemDataWriter",initialize:function(e){this.tryApplySuper("initialize")},writeData:function(e,t,n,i){if(!t){var r=Kekule.IO.DataFormatsManager.getFormatInfo(n);t=r?r.dataType:null}return this.doWriteData(e,t,n,i||{})},doWriteData:function(e,t,n,i){}}),Kekule.IO.ChemDataReaderManager={_readers:[],register:function(e,t,n,i){if(e&&t&&n&&(!DataType.isArrayValue(n)||n.length)){if(Kekule.IO.ChemDataReaderManager.getReaderInfoById(e))return Kekule.raise(Kekule.$L("ErrorMsg.READER_ID_ALREADY_EXISTS")),null;var r={id:e,readerClass:t,formatId:DataType.isArrayValue(n)?n:[n]};return r=Object.extend(r,i),Kekule.IO.ChemDataReaderManager._readers.push(r),r}},unregister:function(e){for(var t=-1,n=Kekule.IO.ChemDataReaderManager._readers,i=0,r=n.length;i<r;++i)if(n[i].id===e){t=i;break}if(t>=0){var a=n[t];return n.splice(t,1),a}return null},getAllReadableFormatIds:function(){for(var e=[],t=Kekule.IO.ChemDataReaderManager._readers,n=0,i=t.length;n<i;++n){var r=t[n].formatId;Kekule.ArrayUtils.pushUnique(e,r)}return e},getAllReadableFormats:function(){for(var e=[],t=Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds(),n=0,i=t.length;n<i;++n){var r=s.getFormatInfo(t[n]);r&&e.push(r)}return e},getAvailableReaderInfos:function(e){for(var t=[],n=Kekule.IO.ChemDataReaderManager._readers,i=n.length-1;i>=0;--i)Kekule.ObjUtils.match(n[i],e)&&t.push(n[i]);return t},getReaderInfo:function(e){for(var t=Kekule.IO.ChemDataReaderManager._readers,n=t.length-1;n>=0;--n)if(Kekule.ObjUtils.match(t[n],e))return t[n];return null},getReaderInfoById:function(e){return Kekule.IO.ChemDataReaderManager.getReaderInfo({id:e})},getReaderInfoByFormat:function(e,t){for(var n=Kekule.IO.ChemDataReaderManager._readers,i=n.length-1;i>=0;--i)if((!t||Kekule.ObjUtils.match(n[i],t))&&n[i].formatId.indexOf(e)>=0)return n[i];return null},getReaderInfoByFileExt:function(e,t){var n=Kekule.IO.DataFormatsManager.findFormatId(null,e);return n?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(n,t):null},createReaderOfInfo:function(e){return new e.readerClass(e.createOptions)},getReaderOfInfo:function(e){return e.instance||(e.instance=Kekule.IO.ChemDataReaderManager.createReaderOfInfo(e)),e.instance},createReader:function(e){var t=Kekule.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return Kekule.IO.ChemDataReaderManager.createReaderOfInfo(t)},getReader:function(e){var t=Kekule.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return Kekule.IO.ChemDataReaderManager.getReaderOfInfo(t)},createReaderById:function(e){return Kekule.IO.ChemDataReaderManager.createReader({id:e})},getReaderById:function(e){return Kekule.IO.ChemDataReaderManager.getReader({id:e})},createReaderByFormat:function(e,t){var n=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return n?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(n):null},getReaderByFormat:function(e,t){var n=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return n?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(n):null},createReaderByFileExt:function(e,t){var n=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return n?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(n):null},getReaderByFileExt:function(e,t){var n=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return n?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(n):null},createReaderByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataReaderManager.createReaderByFormat(t):null},getReaderByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataReaderManager.getReaderByFormat(t):null}},Kekule.IO.ChemDataWriterManager={_writers:[],register:function(e,t,n,i,r){if(e&&t&&i&&(!DataType.isArrayValue(i)||i.length)){var a=Kekule.IO.ChemDataWriterManager.getWriterInfoById(e);if(a)return t===a.writerClass?(Kekule.ArrayUtils.pushUnique(a.srcClasses,n),Kekule.ArrayUtils.pushUnique(a.formatId,i),a):(Kekule.raise(Kekule.$L("ErrorMsg.WRITER_ID_ALREADY_EXISTS")),null);var o={id:e,writerClass:t,srcClasses:n,formatId:DataType.isArrayValue(i)?i:[i]};return o=Object.extend(o,r),Kekule.IO.ChemDataWriterManager._writers.push(o),o}},unregister:function(e){for(var t=-1,n=Kekule.IO.ChemDataWriterManager._writers,i=0,r=n.length;i<r;++i)if(n[i].id===e){t=i;break}if(t>=0){var a=n[t];return n.splice(t,1),a}return null},getAllWritableFormatIds:function(){for(var e=[],t=Kekule.IO.ChemDataWriterManager._writers,n=0,i=t.length;n<i;++n){var r=t[n].formatId;Kekule.ArrayUtils.pushUnique(e,r)}return e},getAllWritableFormats:function(){for(var e=[],t=Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds(),n=0,i=t.length;n<i;++n){var r=s.getFormatInfo(t[n]);r&&e.push(r)}return e},getAvailableWriterInfos:function(e,t){for(var n=[],i=ClassEx.isClass(t)?t:t.getClass?t.getClass():t?null:void 0,r=Kekule.IO.ChemDataWriterManager._writers,a=r.length-1;a>=0;--a)if(Kekule.ObjUtils.match(r[a],e))if(i!==void 0){if(i)for(var o=0,l=r[a].srcClasses.length;o<l;++o)ClassEx.isOrIsDescendantOf(i,r[a].srcClasses[o])&&n.push(r[a])}else n.push(r[a]);return n},getWriterInfo:function(e,t){for(var n=Kekule.IO.ChemDataWriterManager._writers,i=n.length-1;i>=0;--i)if(Kekule.ObjUtils.match(n[i],e)){if(t){for(var r=0,a=n[i].srcClasses.length;r<a;++r)if(t instanceof n[i].srcClasses[r])return n[i];return null}return n[i]}return null},getWriterInfoById:function(e,t){return Kekule.IO.ChemDataWriterManager.getWriterInfo({id:e},t)},getWriterInfoByFormat:function(e,t,n){for(var i=Kekule.IO.ChemDataWriterManager._writers,r=i.length-1;r>=0;--r)if((!t||Kekule.ObjUtils.match(i[r],t))&&i[r].formatId.indexOf(e)>=0){if(n){for(var a=0,o=i[r].srcClasses.length;a<o;++a)if(n instanceof i[r].srcClasses[a])return i[r];return null}return i[r]}return null},getWriterInfoByFileExt:function(e,t,n){var i=Kekule.IO.DataFormatsManager.findFormatId(null,e);return i?Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(i,t,n):null},createWriterOfInfo:function(e){return new e.writerClass(e.createOptions)},getWriterOfInfo:function(e){return e.instance||(e.instance=Kekule.IO.ChemDataWriterManager.createWriterOfInfo(e)),e.instance},createWriter:function(e,t){var n=Kekule.IO.ChemDataWriterManager.getWriterInfo(e,t);return n?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(n):null},getWriter:function(e,t){var n=Kekule.IO.ChemDataWriterManager.getWriterInfo(e,t);return n?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(n):null},createWriterById:function(e,t){return Kekule.IO.ChemDataWriterManager.createWriter({id:e},t)},getWriterById:function(e,t){return Kekule.IO.ChemDataWriterManager.getWriter({id:e},t)},createWriterByFormat:function(e,t,n){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,n);return i?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(i):null},getWriterByFormat:function(e,t,n){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,n);return i?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(i):null},createWriterByFileExt:function(e,t,n){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,n);return i?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(i):null},getWriterByFileExt:function(e,t,n){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,n);return i?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(i):null},createWriterByMimeType:function(e,t){var n=Kekule.IO.DataFormatsManager.findFormatId(e,null);return n?Kekule.IO.ChemDataWriterManager.createWriterByFormat(n,null,t):null},getWriterByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataWriterManager.getWriterByFormat(t,null):null}},Kekule.IO.loadFormatData=function(e,t,n){var i=Kekule.IO.ChemDataReaderManager.getReaderByFormat(t);if(i){var r=i.readData(e,null,t,n);if(r===!1){var a=Kekule.$L("ErrorMsg.FAIL_TO_READ_FORMAT")+t;Kekule.raise(a)}return r}return a=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FORMAT")+t,Kekule.raise(a),null},Kekule.IO.loadMimeData=function(e,t,n){return Kekule.IO.loadTypedData(e,t,null,n)},Kekule.IO.loadTypedData=function(e,t,n,i){var r;n&&(r=Kekule.UrlUtils.extractFileExt(n));var a,o=Kekule.IO.DataFormatsManager.findFormatId(t||null,r);if(o&&(a=Kekule.IO.loadFormatData(e,o,i)),a!==!1){if(a instanceof Kekule.ChemObject&&a.getSrcInfo){var l=a.getSrcInfo();t&&(l.mimeType=t),r&&(l.fileExt=r),n&&(l.url=n,l.fileName=n)}return a}var u=t?Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_MIMETYPE")+t:Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+r;return Kekule.raise(u),null},Kekule.IO.loadFileData=function(e,t,n,i){if(Kekule.BrowserFeature.fileapi){var r,a=e.name,o=Kekule.UrlUtils.extractFileExt(a);if(!(r=n?Kekule.IO.DataFormatsManager.getFormatInfo(n):Kekule.IO.DataFormatsManager.findFormat(null,o))){var l=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+o;return void Kekule.raise(l)}var u=Kekule.IO.ChemDataType.isBinaryType(r.dataType),c=new FileReader;c.onload=function(d){var h=c.result,p=Kekule.IO.loadFormatData(h,r.id,i);p&&p.getSrcInfo&&(p.getSrcInfo().fileName=a),t(p,p!==!1,h)},u?c.readAsArrayBuffer(e):c.readAsText(e)}else Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"))},Kekule.IO.loadUrlData=function(e,t,n,i){if(!Kekule.Ajax)return Kekule.raise(Kekule.$L("ErrorMsg.AJAX_FILELOADER_NOT_FOUND")),null;Kekule.Ajax.sendRequest(e,function(r,a,o){if(r&&o){var l;if(n&&(l=Kekule.IO.DataFormatsManager.getFormatInfo(n)),!n){var u=Kekule.Ajax.getResponseMimeType(a);l=Kekule.IO.DataFormatsManager.findFormat(u)}if(!n){var c=Kekule.UrlUtils.extractFileExt(e);l=Kekule.IO.DataFormatsManager.findFormat(null,c)}if(!l){var d=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+c;return void Kekule.raise(d)}var h=Kekule.IO.loadFormatData(r,l.id,i);h.getSrcInfo().fileName=e,t(h,o=h!==!1,r)}else Kekule.raise(Kekule.$L("ErrorMsg.FAIL_TO_LOAD_FILE_URL")+e)})},Kekule.IO.saveFormatData=function(e,t,n){var i=Kekule.IO.ChemDataWriterManager.getWriterByFormat(t,null,e);if(i)return i.writeData(e,null,t,n);var r=Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")+t;return Kekule.raise(r),null},Kekule.IO.saveMimeData=function(e,t,n){return Kekule.IO.saveTypedData(e,t,null,n)},Kekule.IO.saveTypedData=function(e,t,n,i){var r;n&&((r=Kekule.UrlUtils.extractFileExt(n))||(r=n));var a,o=Kekule.IO.DataFormatsManager.findFormatId(t||null,r);if(o&&(a=Kekule.IO.saveFormatData(e,o,i)),Kekule.ObjUtils.isUnset(a)){var l=t?Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_MIMETYPE")+t:Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FILEEXT")+r;return Kekule.raise(l),null}return a}}(),function(){Kekule.globalOptions.add("IO.cml",{prettyPrint:!0,enableReadRootObjList:!0,defaultRootObjListHolder:Kekule.ChemSpace}),Kekule.IO.CML={CML2CORE_NAMESPACE_URI:"http://www.xml-cml.org/schema/cml2/core",CML3_SCHEMA_NAMESPACE_URI:"http://www.xml-cml.org/schema",ARRAY_VALUE_DELIMITER:" ",TYPED_ELEM_NAMES:["string","integer","float"],TYPED_ARRAY_ELEM_NAMES:["stringArray","integerArray","floatArray"],ATOMS_REF_ATTRIBS:["atomRef","atomRefs2","atomRefs3","atomRefs4","atomRefs","atomRefArray"],BONDS_REF_ATTRIBS:["bondRef","bondRefs","bondRefArray"],MOL_REF_ATTRIBS:["moleculeRef","moleculeRefs"],DEFAULT_VALUE_DELIMITER_PATTERN:/\s+/gm},Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS=[Kekule.IO.CML.CML2CORE_NAMESPACE_URI,Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI],Kekule.IO.CmlUtils={_cmlUnitConvMap:[["m","m","m",!0],["second","s","sec",!0],["hour","h","hr",!1],["kg","kg","kg",!0],["k","K","K",!0],["mol","mol","mol",!0],["candela","cd","cd",!0],["radian","rad","rad",!0],["steradian","sr","sr",!0],["hertz","Hz","Hz",!0],["newton","N","N",!0],["joule","J","J",!0],["watt","W","W",!0],["pascal","Pa","Pa",!0],["coulomb","C","C",!0],["volt","V","V",!0],["ampere","A","A",!0],["ohm","[Omega]","Ω",!0],["farad","F","F",!0],["siemens","S","S",!0],["weber","Wb","Wb",!0],["tesla","T","T",!0],["henry","H","H",!0],["becquerel","Bq","Bq",!0],["gray","Gy","Gy",!0],["sievert","Sv","Sv",!0],["katal","kat","kat",!0],["molarity","_i_M__i_","mol/L",!0],["molality","_i_m__i_","mol/kg",!0],["m2","m2","m2",!0],["m3","m3","m3",!0],["m.s-1","m.s-1","m/s",!0],["m.s-2","m.s-2","m·s-2",!0],["rad.s-1","rad.s-1","rad/s",!0],["n.s","N.s","N·s",!0],["n.m.s","N.m.s","N·m·s",!0],["n.m","N.m","N·m",!0],["m-1","m-1","m-1",!0],["kg.m-3","kg.m-3","kg·m-3",!0],["kg-1.m3","kg-1.m3","kg-1·m3",!0],["m-3.mol","m-3.mol","m-3·mol",!0],["m3.mol-1","m3.mol-1","m3/mol",!0],["j.k-1","J.K-1","J/K",!0],["j.k-1.mol-1","J.K-1.mol-1","J·K-1·mol-1",!0],["j.k-1.kg-1","J.K-1.kg-1","J·K-1·kg-1",!0],["j.mol-1","J.mol-1","J/mol",!0],["j.kg-1","J.kg-1","J/kg",!0],["j.m-3","J.m-3","J·m-3",!0],["n.m-1","N.m-1 = J.m-2","N/m",!0],["w.m-2","W.m-2","W·m-2",!0],["w.m-1.k-1","W.m-1.K-1","W·m-1·K-1",!0],["m2.s-1","m2.s-1","m2/s",!0],["pa.s","Pa.s","Pa·s",!0],["pa.s","N.s.m-2","Pa·s",!0],["c.m-3","C.m-3","C·m-3",!0],["a.m-2","A.m-2","A·m-2",!0],["s.m-1","S.m-1","S/m",!0],["s.m2.mol-1","S.m2.mol-1","S·m2/mol",!0],["f.m-1","F.m-1","F/m",!0],["h.m-1","H.m-1","H/m",!0],["v.m-1","V.m-1","V/m",!0],["a.m-1","A.m-1","A/m",!0],["cd.m-2","cd.m-2","cd·m-2",!0],["c.kg-1","C.kg-1","C/kg",!0],["gy.s-1","Gy.s-1","Gy/s",!0],["j.m-1","J.m-1","J/m",!0],["ang","[Aring]","Å",!1],["deg","[deg]","deg",!1],["ang3","A3","Å3",!1],["celsius","[deg]C","℃",!1],["debye","D","D",!1],["electron","e","e",!1],["hartree","hart","hart",!1],["gpa","GPa","GPa",!1],["gpa-1","GPa-1","GPa-1",!1],["atmosphere","atm","atm",!1],["kcal.mol-1.ang-1","kcal mol-1 ang-1","kcal·mol-1·ang-1",!1],["kj.mol-1","kj mol-1","kj/mol",!1],["l","L","L",!1],["ml","mL","mL",!1],["kcal.ang-1","kcal.ang-1","kcal/Å",!1],["kcal.rad-1","kcal.rad-1","kcal/rad",!1],["ph","pH","pH",!1],["centipoise","cp","cp",!1],["km.s-1","km/s","km/s",!1],["arbitrary","arb","arb",!1]],tryParseFloat:function(t){var n=parseFloat(t);return Kekule.NumUtils.isNormalNumber(n)?n:t},convertSimpleValueByDataType:function(t,n,i){var r;switch(n){case"xsd:boolean":r=Kekule.StrUtils.strToBool(t);break;case"xsd:float":case"xsd:double":case"xsd:duration":case"xsd:decimal":r=parseFloat(t);break;case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:long":case"xsd:int":case"xsd:short":case"xsd:byte":case"xsd:nonNegativeInteger":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":case"xsd:positiveInteger":r=parseInt(t);break;default:r=t}return r},getCmlTypeForDataType:function(t){return t==DataType.INT?"xsd:integer":t==DataType.FLOAT?"xsd:float":t==DataType.BOOL?"xsd:boolean":null},cmlNsTokenToKekule:function(t){return t.replace(/\:/g,".")},kekuleNsTokenToCml:function(t){return t.replace(/\./g,":")},getCmlNsValueDetails:function(t){var n=t.indexOf(":");return{namespace:n>=0?t.substring(0,n):"",localName:n>=0?t.substr(n+1):t}},getCmlNsValueLocalPart:function(t){var n=t.indexOf(":");return n>=0?t.substr(n+1):t},cmlUnitStrToMetricsUnitSymbol:function(t){for(var n,i,r=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(t),a=r.toLowerCase(),o=a.length>3&&a.endsWith("s")?a.substr(0,a.length-1):null,l=(Kekule.Unit,Kekule.IO.CmlUtils._cmlUnitConvMap),u=0,c=l.length;u<c;++u)if(r===l[u][0]||r===l[u][1]){n=l[u][2];break}if(!n){for(u=0,c=l.length;u<c;++u)if(a===l[u][0].toLowerCase()||a===l[u][1].toLowerCase()){n=l[u][2];break}}if(!n&&o){for(u=0,c=l.length;u<c;++u)if(o===l[u][0].toLowerCase()||o===l[u][1].toLowerCase()){n=l[u][2];break}}return n||(n=(i=Kekule.Unit.getUnit(r,!0))&&i.symbol),n||(n=(i=Kekule.Unit.getUnitByName(r,!0))&&i.symbol),!n&&o&&(n=(i=Kekule.Unit.getUnitByName(o,!0))&&i.symbol),n||r},metricsUnitSymbolToCmlUnitStr:function(t){for(var n,i=Kekule.IO.CmlUtils._cmlUnitConvMap,r=0,a=i.length;r<a;++r){var o=i[r];if(t===o[2]){n=(o[3]?"siUnits:":"units:")+o[0];break}}return n||(n="units:"+t),n},cmlBondOrderToKekule:function(t){var n=parseInt(t);if(n!=n)switch(t.toUpperCase()){case"A":n=Kekule.BondOrder.EXPLICIT_AROMATIC;break;case"D":n=Kekule.BondOrder.DOUBLE;break;case"T":n=Kekule.BondOrder.TRIPLE;break;case"S":default:n=Kekule.BondOrder.SINGLE}return n},kekuleBondOrderToCml:function(t){switch(t){case Kekule.BondOrder.EXPLICIT_AROMATIC:return"A";case Kekule.BondOrder.QUAD:return"4";case Kekule.BondOrder.DOUBLE:return"D";case Kekule.BondOrder.TRIPLE:return"T";default:return"S"}},cmlBondStereoToKekule:function(t){var n;switch(t.toUpperCase()){case"E":n=Kekule.BondStereo.E;break;case"Z":n=Kekule.BondStereo.Z;break;case"C":n=Kekule.BondStereo.CIS;break;case"T":n=Kekule.BondStereo.TRANS;break;case"W":n=Kekule.BondStereo.UP;break;case"H":n=Kekule.BondStereo.DOWN;break;default:n=Kekule.BondStereo.NONE}return n},kekuleBondStereoToCml:function(t){switch(t){case Kekule.BondStereo.UP:return{value:"W"};case Kekule.BondStereo.UP_INVERTED:return{value:"W",invert:!0};case Kekule.BondStereo.DOWN:return{value:"H"};case Kekule.BondStereo.DOWN_INVERTED:return{value:"H",invert:!0};case Kekule.BondStereo.E:return{value:"E"};case Kekule.BondStereo.Z:return{value:"Z"};case Kekule.BondStereo.CIS:return{value:"C"};case Kekule.BondStereo.TRANS:return{value:"T"};default:return{value:null}}},reagentRoleToKekule:function(t){var n=Kekule.ReactionRole;switch(t){case"reagent":return n.REAGENT;case"catalyst":case"solvent":return n.CATALYST;default:return t}},kekuleReagentRoleToCml:function(t){var n=Kekule.ReactionRole;switch(t){case n.REAGENT:return"reagent";case n.CATALYST:return"catalyst";case n.SOLVENT:return"solvent";default:return t}},isDummyElementType:function(t){return t=="Du"||t=="Dummy"},isRGroupElementType:function(t){return t=="R"},isAtomListElementType:function(t){return t=="L"},getNodeElementType:function(t){if(t instanceof Kekule.Atom)return t.getSymbol();if(!(t instanceof Kekule.Pseudoatom))return t instanceof Kekule.VariableAtom||t instanceof Kekule.StructureFragment?"R":t.getSymbol?t.getSymbol():"*";switch(t.getAtomType()){case Kekule.PseudoatomType.DUMMY:return"Du";case Kekule.PseudoatomType.ANY:return"A";case Kekule.PseudoatomType.HETERO:return"Q";case Kekule.PseudoatomType.CUSTOM:default:return t.getSymbol()}},createNodeByCmdElementType:function(t,n,i){return Kekule.IO.CmlUtils.isDummyElementType(n)?new Kekule.Pseudoatom(t,Kekule.PseudoatomType.DUMMY):Kekule.IO.CmlUtils.isRGroupElementType(n)?new Kekule.RGroup(t):Kekule.IO.CmlUtils.isAtomListElementType(n)?new Kekule.VariableAtom(t):Kekule.Element.isElementSymbolAvailable(n)||n==Kekule.Element.UNSET_ELEMENT?new Kekule.Atom(t,n,Math.round(i)):new Kekule.Pseudoatom(t,Kekule.PseudoatomType.CUSTOM,n)}};var s=Kekule.IO.CmlUtils;Kekule.IO.CmlDomUtils={splitCmlArrayValue:function(t){return typeof t=="object"&&t.length?t:Kekule.StrUtils.normalizeSpace(Kekule.StrUtils.trim(t)).split(Kekule.IO.CML.ARRAY_VALUE_DELIMITER)},mergeToCmlArrayValue:function(t){return t.join(" ")},analysisCmlFormulaConciseValue:function(t){for(var n,i=Kekule.IO.CmlDomUtils.splitCmlArrayValue(t),r=0,a=i.length,o=[],l=null;r<a;){var u=i[r],c=parseFloat(u);c!=c?(l&&o.push(l),l={elementType:u}):l?(l.count=c,o.push(l),l=null):r==a-1&&(n=c),++r}return{isotopes:o,formalCharge:n}},getCmlBuiltinElemInfo:function(t,n,i){var r=t.getAttribute("builtin");return!r&&n&&(t.getAttributeNS?r=t.getAttributeNS(n,"builtin"):i&&(r=i.getAttributeNS(n,"builtin",t))),r?{name:r,value:Kekule.DomUtils.getElementText(t)}:null},readCmlTypedPropertyElem:function(t,n,i){var r;if(!(r=t.getAttribute("builtin"))&&n&&(t.getAttributeNS?r=t.getAttributeNS(n,"builtin"):i&&(r=i.getAttributeNS(n,"builtin",t))),r){var a=Kekule.DomUtils.getElementText(t);switch(Kekule.DomUtils.getLocalName(t)){case"float":a=parseFloat(a);break;case"integer":a=parseInt(a)}return{name:r,value:a}}return null},readCmlTypedPropertyArrayElem:function(t,n,i){var r;if(!(r=t.getAttribute("builtin"))&&n&&(t.getAttributeNS?r=t.getAttributeNS(n,"builtin"):i&&(r=i.getAttributeNS(n,"builtin",t))),r){var a=Kekule.DomUtils.getElementText(t),o=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a);switch(Kekule.DomUtils.getLocalName(t)){case"float":for(var l=0,u=o.length;l<u;++l)o[l]=parseFloat(o[l]);break;case"integer":for(l=0,u=o.length;l<u;++l)o[l]=parseInt(o[l])}return{name:r,values:o}}return null},hasDirectCmlTypedElemChildren:function(t,n){for(var i=0,r=Kekule.IO.CML.TYPED_ELEM_NAMES.length;i<r;++i){var a=Kekule.IO.CML.TYPED_ELEM_NAMES[i];if(Kekule.DomUtils.getDirectChildElems(t,null,a,n).length>0)return!0}return!1},hasDirectCmlTypedArrayElemChildren:function(t,n){for(var i=0,r=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.length;i<r;++i){var a=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES[i];if(Kekule.DomUtils.getDirectChildElems(t,null,a,n).length>0)return!0}return!1},isCmlTypedElem:function(t,n){var i=Kekule.IO.CML.TYPED_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(t))>=0;return n&&(i=i&&t.namespaceURI==n),i},isCmlTypedArrayElem:function(t,n){var i=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(t))>=0;return n&&(i=i&&t.namespaceURI==n),i},isCmlBuiltInMarkedElem:function(t,n){var i=Kekule.DomUtils.hasAttribute(t,"builtin");return n&&i&&(i=t.namespaceURI===n),i},FILTER_TYPED_ELEM:1,FILTER_TYPEDARRAY_ELEM:2,FILTER_ALL:3,getCmlTypedElem:function(t,n,i){var r=t.namespaceURI,a=Kekule.DomUtils.getDirectChildElemsOfAttribValues(t,[{builtin:n}],null,null,r);if(a&&a.length>0){for(var o=a.length-1;o>=0;--o)if(i&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedElem(a[o],r)||i&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(a[o],r))return a[o]}return null},getCmlTypedElems:function(t,n,i){var r=[],a=t.namespaceURI,o=Kekule.DomUtils.getDirectChildElemsOfAttribValues(t,[{builtin:n}],null,null,a);if(o&&o.length>0)for(var l=o.length-1;l>=0;--l)(i&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedElem(o[l],a)||i&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(o[l],a))&&r.push(o[l]);return r.length?r:null},getCmlTypedElemValue:function(t,n,i,r){i||(i=Kekule.IO.CmlDomUtils.FILTER_ALL);var a=Kekule.IO.CmlDomUtils.getCmlTypedElem(t,n,i);if(a)return Kekule.DomUtils.getElementText(a)},getMultipleCmlTypedElemValues:function(t,n,i,r){i||(i=Kekule.IO.CmlDomUtils.FILTER_ALL);var a=Kekule.IO.CmlDomUtils.getCmlTypedElems(t,n,i);if(a){for(var o=[],l=0,u=a.length;l<u;++l)o.push(Kekule.DomUtils.getElementText(a[l]));return o}return null},getCmlElemAttribute:function(t,n,i,r){i||(i=Kekule.IO.CmlDomUtils.FILTER_ALL);var a=Kekule.DomUtils.getSameNSAttributeValue(t,n,r);return a||(a=Kekule.IO.CmlDomUtils.getCmlTypedElemValue(t,n,i,r)),a},getMultipleCmlElemAttribute:function(t,n,i,r){i||(i=Kekule.IO.CmlDomUtils.FILTER_ALL);var a=Kekule.DomUtils.getSameNSAttributeValue(t,n,r);return a||(a=Kekule.IO.CmlDomUtils.getMultipleCmlTypedElemValues(t,n,i,r)),a},setCmlElemAttribute:function(t,n,i,r){return Kekule.DomUtils.setSameNSAttributeValue(t,n,i,r)},fetchCmlElemAttributeValuesToJson:function(t,n,i,r){n||(n=Kekule.IO.CmlDomUtils.FILTER_ALL);for(var a=t.namespaceURI,o=Kekule.DomUtils.fetchAttributeValuesToJson(t,a,!0),l=Kekule.DomUtils.getDirectChildElems(t,null,null,a),u=0,c=l.length;u<c;++u){var d=l[u];if(n&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&(Kekule.IO.CmlDomUtils.isCmlTypedElem(d,a)||Kekule.IO.CmlDomUtils.isCmlBuiltInMarkedElem(d,a)))(h=Kekule.IO.CmlDomUtils.readCmlTypedPropertyElem(d,a,r))&&(o[h.name]&&i?o[h.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+h.value:o[h.name]=h.value);else if(n&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(d,a)){var h;(h=Kekule.IO.CmlDomUtils.getCmlBuiltinElemInfo(d,a,r))&&(o[h.name]&&i?o[h.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+h.value:o[h.name]=h.value)}}return o},isScalarElem:function(t,n){var i=Kekule.DomUtils.getLocalName(t)=="scalar";return n&&(i=i&&t.namespaceURI==n),i},getCmlId:function(t,n){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"id",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,n)},setCmlId:function(t,n,i){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"id",n,i)},getCmlTitle:function(t,n){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"title",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,n)},setCmlTitle:function(t,n,i){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"title",n,i)}};var e=Kekule.IO.CmlDomUtils;Kekule.IO.CmlElementReaderFactory={_readers:{},register:function(t,n){if(Kekule.ArrayUtils.isArray(t))for(var i=0,r=t.length;i<r;++i)Kekule.IO.CmlElementReaderFactory.register(t[i],n);else Kekule.IO.CmlElementReaderFactory._readers[t.toLowerCase()]=n},getReader:function(t){var n;n=typeof t!="string"?Kekule.DomUtils.getLocalName(t):t;var i=Kekule.IO.CmlElementReaderFactory._readers[n.toLowerCase()];return i?new i:null}},Kekule.IO.CmlElementWriterFactory={_writers:{},register:function(t,n){if(Kekule.ArrayUtils.isArray(t))for(var i=0,r=t.length;i<r;++i)Kekule.IO.CmlElementWriterFactory.register(t[i],n);else Kekule.IO.CmlElementWriterFactory._writers[t]=n},getWriter:function(t){var n;n=typeof t!="string"?DataType.getType(t):t;var i=Kekule.IO.CmlElementWriterFactory._writers[n];if(!i&&t.getClassName)for(var r=t,a=Kekule.ObjUtils.getOwnedFieldNames(Kekule.IO.CmlElementWriterFactory._writers),o=a.length-1;o>=0;--o){var l=ClassEx.findClass(a[o]);if(l&&r instanceof l){i=Kekule.IO.CmlElementWriterFactory._writers[a[o]];break}}return i?new i:null}},Kekule.IO.CmlElementHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.CmlElementHandler",initialize:function(){this.tryApplySuper("initialize"),this._childHandlers=[]},doFinalize:function(){for(var t=this._childHandlers.length-1;t>=0;--t){var n=this._childHandlers[t];n&&n.finalize&&n.finalize()}this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("domHelper",{dataType:"Kekule.DomHelper",serializable:!1,getter:function(){return this.getPropStoreFieldValue("domHelper")||this.setPropStoreFieldValue("domHelper",new Kekule.DomHelper),this.getPropStoreFieldValue("domHelper")}}),this.defineProp("coreNamespaceURI",{dataType:DataType.STRING,serializable:!1}),this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("rootEvoker",{dataType:DataType.Object,serializable:!1})},getPrefixForNamespaceUri:function(t){var n=this.getNamespaces();if(n){for(var i=0,r=n.length;i<r;++i)if(n[i].namespaceURI===t)return n[i].prefix}},matchCoreNamespace:function(t){var n;return n=t?typeof t!="string"?t.namespaceURI:t:"",!this.getCoreNamespaceURI()&&!n||this.getCoreNamespaceURI()&&this.getCoreNamespaceURI()==n},copySettingsToChildHandler:function(t){t.setDomHelper(this.getDomHelper()),t.setCoreNamespaceURI(this.getCoreNamespaceURI()),t.setNamespaces(this.getNamespaces()),t.setRootEvoker(this.getRootEvoker())},_appendChildHandler:function(t){Kekule.ArrayUtils.pushUnique(this._childHandlers,t)},_iterateChildHandlers:function(t,n,i){if(t)for(var r=0,a=this._childHandlers.length;r<a;++r){var o=this._childHandlers[r];o&&(t.apply(n,[o]),i&&o._iterateChildHandlers&&o._iterateChildHandlers(t,n,i))}}}),Kekule.IO.CmlElementReader=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementReader",readElement:function(t,n,i,r){var a=this.doReadElement(t,n,i,r);if(a&&a.getId&&!a.getId()&&a.setId){var o=Kekule.IO.CmlDomUtils.getCmlId(t,this.getDomHelper);o&&this.setObjId(a,o)}return a},doReadElement:function(t,n,i,r){},readChildElement:function(t,n,i){return this.doReadChildElement(t,n,i)},doReadChildElement:function(t,n,i){return this.doReadChildElementDef(t,n,i)},readChildElementDef:function(t,n,i){return this.doReadChildElementDef(t,n,i)},doReadChildElementDef:function(t,n,i){var r=this.doGetChildElementReader(t,n,i);if(!r)return null;try{return r.readElement(t,n,i)}finally{}},doGetChildElementReader:function(t,n,i){var r=Kekule.IO.CmlElementReaderFactory.getReader(t);return r&&(this.copySettingsToChildHandler(r),this._appendChildHandler(r)),r},iterateChildElements:function(t,n,i,r){for(var a=[],o=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),l=0,u=o.length;l<u;++l){var c=this.readChildElement(o[l],n,i);c&&(a.push({element:o[l],result:c}),r&&r(o[l],c,n,i))}return a},doneReadingDocument:function(t){this.doDoneReadingDocument(),t&&this._iterateChildHandlers(function(n){n&&n.doneReadingDocument&&n.doneReadingDocument(t)})},doDoneReadingDocument:function(){},getLoadedObjById:function(t){var n=this.getRootEvoker();return n&&n.getLoadedObjById&&n.getLoadedObjById(t)},setObjIdMapValue:function(t,n){var i=this.getRootEvoker();i.setObjIdMapValue&&i.setObjIdMapValue(t,n)},setObjId:function(t,n){t.setId&&t.setId(n);var i=t.getId&&t.getId();i&&this.setObjIdMapValue(i,t)},_createChildObjsHolder:function(t,n){for(var i=new n,r=0,a=t.length;r<a;++r)i.appendChild(t[r]);return i}}),Kekule.IO.CmlElementWriter=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementWriter",writeObject:function(t,n,i){if(!n&&!r)return Kekule.error(Kekule.$L("ErrorMsg.CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT")),null;var r=n.ownerDocument;this.getDomHelper().getDocument!=r&&this.getDomHelper().setDocument(r);var a=this.doCreateElem(t,n,r);a?n.appendChild(a):a=n;var o=this.doWriteObject(t,a,i)||a;return o&&t&&(this.writeObjId(t,o),this.writeObjAdditionalInfo(t,o,i)),o},writeObjId:function(t,n){if(t.getId){var i=t.getId();!i&&t.setId&&(i=this.autoIdentifyForObj(t)),Kekule.IO.CmlDomUtils.setCmlId(n,i,this.getDomHelper())}},autoIdentifyForObj:function(t){return t.getId&&!t.getId()&&t.setId&&(t.getOwner&&t.getOwner()&&t.getOwner().getAutoId?t.setId(t.getOwner().getAutoId(t)):t.setId(this.getAutoIdForObj(t))),t.getId&&t.getId()},getAutoIdForObj:function(t){var n=t.getAutoIdPrefix?t.getAutoIdPrefix():"obj";return Kekule.IO.CmlElementWriter._UID_SEED||(Kekule.IO.CmlElementWriter._UID_SEED=new Date().getTime()),++Kekule.IO.CmlElementWriter._UID_SEED,""+n+Kekule.IO.CmlElementWriter._UID_SEED.toString()},writeScalarAttribs:function(t,n,i){if(t.getScalarAttribs){var r=this.doGetChildObjectWriter("Kekule.Scalar");if(r)for(var a=0,o=t.getScalarAttribCount();a<o;++a)r.writeObject(t.getScalarAttribAt(a),n,i)}},writeObjInfoValues:function(t,n,i){if(t.getInfo){var r,a=this.getObjInfoKeysNeedToSaveToMetaList(t);if(!a||!a.length)return;for(var o=0,l=a.length;o<l;++o){var u=a[o],c=t.getInfoValue(a[o]);u&&c&&!Kekule.IO.CmlDomUtils.getCmlElemAttribute(n,u,this.getDomHelper())&&(r||(r=this.getOrCreateChildElem("metaDataList",n)),this.doWriteObjInfoValueItem(u,c,t,r,i))}}},doWriteObjInfoValueItem:function(t,n,i,r,a){return this.writeObjMetaValueToListElem(i,t,null,n,r)},writeObjMetaValueToListElem:function(t,n,i,r,a,o,l){o||(o="metaData");var u=this.createChildElem(o,a);return Kekule.IO.CmlDomUtils.setCmlElemAttribute(u,"name",n,this.getDomHelper()),Kekule.IO.CmlDomUtils.setCmlElemAttribute(u,"content",DataType.StringUtils.serializeValue(i),this.getDomHelper()),r&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(u,"metadataType",r,this.getDomHelper()),u},getObjInfoKeysNeedToSaveToMetaList:function(t){return t.getInfoKeys?t.getInfoKeys():null},writeObjAdditionalInfo:function(t,n,i){this.writeScalarAttribs(t,n,i),this.writeObjInfoValues(t,n,i)},doCreateElem:function(t,n){},createChildElem:function(t,n,i){var r=i||this.getCoreNamespaceURI(),a=this.getDomHelper().createElementNS(r,t);return n&&n.appendChild(a),a},getOrCreateChildElem:function(t,n,i){var r=this.getDomHelper().getElementsByTagNameNS(i,t,n)[0];return r||(r=this.createChildElem(t,n,i)),r},doWriteObject:function(t,n,i){},doGetChildObjectWriter:function(t,n,i){var r=Kekule.IO.CmlElementWriterFactory.getWriter(t);return r&&(this.copySettingsToChildHandler(r),this._appendChildHandler(r)),r},reportTypeMismatchError:function(t){Kekule.error(Kekule.$L("ErrorMsg.CML_ELEM_WRITER_TYPE_INPROPER").format(this.getClassName(),DataType.getType(t)))},addNamespace:function(t,n,i,r){this.getDomHelper().addNamespace(t,n,i,r)},addNamespaces:function(t,n,i){for(var r=0,a=n.length;r<a;++r)this.addNamespace(t,n[r].prefix,n[r].namespaceURI,i)},doneWritingDocument:function(t){this.doDoneWritingDocument(),t&&this._iterateChildHandlers(function(n){n&&n.doneWritingDocument&&n.doneWritingDocument(t)})},doDoneWritingDocument:function(){}}),Kekule.IO.CmlBaseListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlBaseListReader",doReadElement:function(t,n,i,r){var a=this.doCreateList(t);return a=this.doReadList(a,t,n,i,this.getDomHelper())},doCreateList:function(t){return[]},doAppendObjToList:function(t,n){return n&&n.push&&n.push(t),n},doReadChildElem:function(t,n,i,r,a){return n.readElement(t,a,this)},doReadList:function(t,n,i,r,a){var o=Kekule.DomUtils.getDirectChildElems(n,null,null,this.getCoreNamespaceURI());if(o)for(var l=0,u=o.length;l<u;++l){var c=o[l],d=this.doGetChildElementReader(c,i,this);if(d){var h=this.doReadChildElem(c,d,i,r,t);h&&this.doAppendObjToList(h,t)}}return t}}),Kekule.IO.CmlBaseListWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlBaseListWriter",doCreateElem:function(t,n){var i=this.doGetListElemTagName(t,n);return i?this.createChildElem(i,n):null},doGetListElemTagName:function(t,n){return"list"},doWriteObject:function(t,n,i){var r=Kekule.ChemStructureUtils.getChildStructureObjs(t,!1);return this.writeList(r,n,i)},writeList:function(t,n,i){for(var r=0,a=t.length;r<a;++r){var o=t[r];if(o){var l=this.doGetChildObjectWriter(o);l&&l.writeObject(o,n,i)}}return n}}),Kekule.IO.CmlNameReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlNameReader",initialize:function(){this.tryApplySuper("initialize")},doReadElement:function(t,n,i,r){var a=Kekule.DomUtils.getElementText(t),o=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"convention");if(a){var l={};return l.name=a,o?l.convention=o:n&&n.setName&&n.setName(a),l}return null}}),Kekule.IO.CmlScalarReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlScalarReader",doReadElement:function(t,n,i,r){var a=this.readScalar(t);return n&&n.appendScalarAttrib&&n.appendScalarAttrib(a),a},readScalar:function(t){var n,i=Kekule.DomUtils.fetchAttributeValuesToJson(t,this.getCoreNamespaceURI(),!0);if((u=Kekule.DomUtils.getElementText(t))&&(i.value=u),i.value&&(i.dataType?(i.value=Kekule.IO.CmlUtils.convertSimpleValueByDataType(i.value,i.dataType),i.errorValue&&(i.errorValue=Kekule.IO.CmlUtils.convertSimpleValueByDataType(i.errorValue,i.dataType,!0))):i.value=Kekule.IO.CmlUtils.tryParseFloat(i.value)),i){n=new Kekule.Scalar;for(var r=Kekule.ObjUtils.getOwnedFieldNames(i),a=0,o=r.length;a<o;++a){var l=r[a],u=i[l];switch(l){case"value":n.setValue(u);break;case"errorValue":n.setErrorValue(u);break;case"units":n.setUnit(Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(u));break;case"title":n.setTitle(u);break;case"dictRef":n.setName(Kekule.IO.CmlUtils.cmlNsTokenToKekule(u)),n.setInfoValue("dictRef",u);break;default:n.setInfoValue(l,u)}}}return n}}),Kekule.IO.CmlScalarWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlScalarWriter",doCreateElem:function(t,n){return this.createChildElem("scalar",n)},doWriteObject:function(t,n,i){if(!(t instanceof Kekule.Scalar))return this.reportTypeMismatchError(t),null;var r;if(Kekule.ObjUtils.isUnset(t.getValue())||(Kekule.DomUtils.setElementText(n,t.getValue()),r=DataType.getType(t.getValue())),t.getName()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"dictRef",Kekule.IO.CmlUtils.kekuleNsTokenToCml(t.getName()),this.getDomHelper()),t.getErrorValue()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"errorValue",t.getErrorValue(),this.getDomHelper()),t.getUnit()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"units",Kekule.IO.CmlUtils.metricsUnitSymbolToCmlUnitStr(t.getUnit()),this.getDomHelper()),t.getTitle()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"title",t.getTitle(),this.getDomHelper()),r){var a=s.getCmlTypeForDataType(r);a&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"datatype",a,this.getDomHelper())}}}),Kekule.IO.CmlArrayReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlArrayReader",initProperties:function(){this.defineProp("expandSteppedArray",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("defaultItemDataType",{dataType:DataType.STRING,serializable:!1})},doReadElement:function(t,n,i,r){return this.readArray(t)},readArray:function(t){var n=Kekule.DomUtils.fetchAttributeValuesToJson(t,this.getCoreNamespaceURI(),!0);if(n.size&&(n.size=parseInt(n.size)),Kekule.ObjUtils.notUnset(n.start)&&Kekule.ObjUtils.notUnset(n.end))n.start=parseFloat(n.start),n.end=parseFloat(n.end),n.stepSize&&(n.stepSize=parseFloat(n.stepSize)),!n.size&&n.stepSize?n.size=Math.round(Math.abs((arrayJson.end-arrayJson.start)/n.stepSize)):n.size&&!n.stepSize&&(n.stepSize=(n.end-n.start)/n.size);else{var i=Kekule.DomUtils.getElementText(t);n.values=this._generateExplicitArray(n,i)}return n},_generateSteppedArray:function(t){var n=null;if(this.getExpandSteppedArray()){var i=t.size,r=t.stepSize,a=t.start;n=[a];for(var o=0;o<i;++o){if((a+=r)>t.end){n.push(t.end);break}n.push(a)}}return n},_generateExplicitArray:function(t,n){var i=!!t.delimiter,r=i?t.delimiter:Kekule.IO.CML.DEFAULT_VALUE_DELIMITER_PATTERN,a=n.split(r);i&&(a.shift(),a.pop());for(var o=t.dataType||this.getDefaultItemDataType(),l=[],u=0,c=a.length;u<c;++u){var d=a[u].trim();!i&&d&&(o?l.push(Kekule.IO.CmlUtils.convertSimpleValueByDataType(d,o)):l.push(d))}return l}}),Kekule.IO.CmlArrayWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlArrayWriter",DEF_TAGNAME:"array",DEF_DELIMITER:" ",initProperties:function(){this.defineProp("defaultItemDataType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("defaultItemDataUnit",{dataType:DataType.STRING,serializable:!1})},getArrayTagName:function(){return this.DEF_TAGNAME},getDefaultArrayValueDelimiter:function(){return this.DEF_DELIMITER},doCreateElem:function(t,n){return this.createChildElem(this.getArrayTagName(),n)},doWriteObject:function(t,n,i){var r;if(DataType.isObjectValue(t))r=Object.extend({},t);else{if(!DataType.isArrayValue(t))return this.reportTypeMismatchError(t),null;r={values:t}}return r=Object.extend(r,{unit:r.unit||i.unit||this.getDefaultItemDataUnit(),dataType:r.dataType||i.dataType||this.getDefaultItemDataType(),delimiter:r.delimiter||i.delimiter||this.getDefaultArrayValueDelimiter()}),this.writeArrayObj(r,n,i)},writeArrayObj:function(t,n,i){for(var r=this.getDomHelper(),a=["id","title","dictRef"],o=0,l=a.length;o<l;++o){var u=t[a[o]];Kekule.ObjUtils.notUnset(u)&&e.setCmlElemAttribute(n,a[o],u,r)}t.unit&&e.setCmlElemAttribute(n,"units",s.metricsUnitSymbolToCmlUnitStr(t.unit),r),t.dataType&&e.setCmlElemAttribute(n,"dataType",s.getCmlTypeForDataType(t.dataType),r);var c=t.values,d=c?c.length:t.size;if(d&&e.setCmlElemAttribute(n,"size",d,r),c){var h=t.delimiter||this.getDefaultArrayValueDelimiter();Kekule.DomUtils.setElementText(n,c.join(h)),h!==this.getDefaultArrayValueDelimiter()&&e.setCmlElemAttribute(n,"delimiter",h,r)}else Kekule.ObjUtils.notUnset(t.start)&&e.setCmlElemAttribute(n,"start",t.start,r),Kekule.ObjUtils.notUnset(t.end)&&e.setCmlElemAttribute(n,"end",t.end,r)}}),Kekule.IO.CmlMetaDataReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaReader",doReadElement:function(t,n,i,r){var a=this.readMeta(t);return n&&n.setInfoValue&&a.key&&a.value&&n.setInfoValue(a.key,a.value),a},readMeta:function(t){var n=Kekule.DomUtils.fetchAttributeValuesToJson(t,this.getCoreNamespaceURI(),!0);return{key:n.name,value:DataType.StringUtils.deserializeValue(n.content),metadataType:n.metadataType}}}),Kekule.IO.CmlMetaDataListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlMetaListReader",doReadChildElem:function(t,n,i,r,a){return n.readElement(t,i,this)}}),Kekule.IO.CmlConditionListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlConditionListReader"}),Kekule.IO.CmlParameterReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlParameterReader",doReadElement:function(t,n,i,r){return this.readParameter(t,n,i)},readParameter:function(t,n,i){var r=Kekule.DomUtils.fetchAttributeValuesToJson(t,this.getCoreNamespaceURI(),!0),a={key:r.name||r.dictRef,value:DataType.StringUtils.deserializeValue(r.value),title:r.title};return this.iterateChildElements(t,n,i,function(o,l){Kekule.DomUtils.getLocalName(o).toLowerCase()==="scalar"&&(a.value=l)}),a}}),Kekule.IO.CmlParameterListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlParameterListReader"}),Kekule.IO.CmlChemStructureReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlChemStructureReader",initialize:function(){this.tryApplySuper("initialize")},hasAtomChildren:function(t,n){return n.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",t).length},getAtomChildren:function(t,n){return n.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",t)},atomInfoToJSON:function(t,n){return Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,n)},arrayedAtomInfosToJSON:function(t,n){for(var i=["id","atomID","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],r=["id","id","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],a=[],o=0,l=i.length;o<l;++o){var u,c=[];(u=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,i[o],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,n))&&(c=Kekule.IO.CmlDomUtils.splitCmlArrayValue(u));for(var d=0,h=c.length;d<h;++d)a[d]||(a[d]={}),c[d]&&(a[d][r[o]]=c[d])}return a}}),Kekule.IO.CmlFormulaReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlFormulaReader",doReadElement:function(t,n,i,r){return this.readFormula(t,this.getDomHelper())},readFormula:function(t,n){var i=new Kekule.MolecularFormula,r=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"formalCharge",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,n);r&&i.setCharge(parseFloat(r));var a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"concise",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,n),o=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"inline",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,n);if(a)this.setConcise(i,a);else if(o)this.setInlineFormula(i,o);else for(var l=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),u=0,c=l.length;u<c;++u)switch(Kekule.DomUtils.getLocalName(l[u])){case"formula":this.readSubFormula(i,l[u],n);break;case"atomArray":this.readAtomArray(i,l[u],n);break;default:Kekule.IO.CmlDomUtils.isCmlTypedElem(t)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(t)||this.readChildElementDef(t,i)}return i},readConsice:function(t){var n=null;return t&&(n=new Kekule.MolecularFormula,this.setConcise(n,t)),n},setConcise:function(t,n){var i=Kekule.IO.CmlDomUtils.analysisCmlFormulaConciseValue(n);return i.isotopes&&i.isotopes.length&&this.createSectionsFromAtomAttribs(t,i.isotopes),i.formalCharge&&t.setCharge(i.formalCharge),t},setInlineFormula:function(t,n){return Kekule.FormulaUtils.textToFormula(n,null,t),t},readAtomArray:function(t,n,i){var r=[],a=this.getAtomChildren(n,i);if(a.length>0)for(var o=0,l=a.length;o<l;++o){var u=a[o],c=this.atomInfoToJSON(u,i);r.push(c)}else r=this.arrayedAtomInfosToJSON(n,i);return this.createSectionsFromAtomAttribs(t,r),t},createSectionsFromAtomAttribs:function(t,n){for(var i=0,r=n.length;i<r;++i){var a=n[i].elementType;if(a){var o=Kekule.IO.CmlUtils.createNodeByCmdElementType(null,a),l=n[i].formalCharge||0,u=n[i].count;t.appendSection(o,u,l)}}},readSubFormula:function(t,n,i){var r=this.readElement(n,i),a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(n,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,i);t.appendSection(r,parseFloat(a)||1,r.getCharge()||0)}}),Kekule.IO.CmlFormulaWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlFormulaWriter",doCreateElem:function(t,n){return this.createChildElem("formula",n)},doWriteObject:function(t,n,i){if(!(t instanceof Kekule.MolecularFormula))return this.reportTypeMismatchError(t),null;for(var r=[],a=[],o=[],l=0,u=t.getSectionCount();l<u;++l){var c=t.getSectionAt(l);c.obj instanceof Kekule.MolecularFormula?(this.createAtomArrayElem(r,a,o,n),r=[],a=[],o=[],this.writeSubFormula(c.obj,c.count||1,n,i)):(r.push(Kekule.IO.CmlUtils.getNodeElementType(c.obj)),a.push(c.count||1),o.push(t.getSectionCharge(c)||0),l==u-1&&this.createAtomArrayElem(r,a,o,n))}t.getCharge()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"formalCharge",t.getCharge(),this.getDomHelper())},writeSubFormula:function(t,n,i,r){var a=this.createChildElem("formula",i);return this.doWriteObject(t,a,r),n>1&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,"count",n,this.getDomHelper()),a},createAtomArrayElem:function(t,n,i,r){if(!(t.length<=0)){var a=this.createChildElem("atomArray",r),o=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(t),l=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(n);Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,"elementType",o,this.getDomHelper()),Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,"count",l,this.getDomHelper());for(var u=!1,c=0,d=i.length;c<d;++c)if(i[c]){u=!0;break}if(u){var h=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(n);Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,"formalCharge",h,this.getDomHelper())}return a}}}),Kekule.IO.CmlMoleculeReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlMoleculeReader",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("structureBuilder",{dataType:"Kekule.ChemStructureBuilder",serializable:!1,getter:function(){return this.getPropStoreFieldValue("structureBuilder")||this.setPropStoreFieldValue("structureBuilder",new Kekule.ChemStructureBuilder),this.getPropStoreFieldValue("structureBuilder")},setter:null})},doReadElement:function(t,n,i,r){return this.readMolecule(t,i,this.getDomHelper())},doReadChildElement:function(t,n,i){if(Kekule.DomUtils.getLocalName(t)=="molecule"&&this.matchCoreNamespace(t)){if(n&&n.getSubMolecules){var r=this.readElement(t,n,i);if(r){var a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"amount",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)||Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM),o=a?{amount:parseFloat(a)}:null;n.getSubMolecules().appendObj(r,o)}return r}return null}return this.tryApplySuper("doReadChildElement",[t,n,i])},hasSubMolecule:function(t){return Kekule.DomUtils.getDirectChildElems(t,null,"molecule",this.getCoreNamespaceURI()).length>0},readMolecule:function(t,n,i){var r;return this.hasSubMolecule(t)?(r=new Kekule.CompositeMolecule,this.iterateChildElements(t,r,n)):r=this.readMoleculeCore(t,i),this.readMoleculeAttribs(r,t,i),r},readMoleculeAttribs:function(t,n,i){for(var r=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(n,null,!0,i),a=Kekule.ObjUtils.getOwnedFieldNames(r),o=0,l=a.length;o<l;++o){var u=a[o],c=r[u];switch(u){case"id":this.setObjId(t,c);break;case"title":t.setInfoValue("title",c);break;case"formalCharge":c&&t.setCharge(parseFloat(c));break;case"formula":this.readFormulaAttrib(t,c);break;case"amount":case"count":break;default:t.setInfoValue(u,c)}}},readMoleculeCore:function(t,n){var i=new Kekule.Molecule;this.getStructureBuilder().setTarget(i);for(var r=t.firstChild;r;){if(r.nodeType==Node.ELEMENT_NODE){if(this.matchCoreNamespace(r))switch(Kekule.DomUtils.getLocalName(r)){case"atomArray":this.readMoleculeAtomArray(i,r,this.getStructureBuilder(),n);break;case"bondArray":this.readMoleculeBondArray(i,r,this.getStructureBuilder(),n);break;case"formula":this.readFormula(i,r,n);break;case"atom":this.getStructureBuilder().setTarget(i);var a=this.readAtom(r,n);this.getStructureBuilder().appendNode(a);break;case"bond":this.getStructureBuilder().setTarget(i);var o=this.readBond(i,r,n);this.getStructureBuilder().appendConnector(o);break;case"molecule":break;default:Kekule.IO.CmlDomUtils.isCmlTypedElem(r)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(r)||this.readChildElementDef(r,i)}}r=r.nextSibling}return i.hasCtab()&&this.connectUpBondAndAtom(i),i},connectUpBondAndAtom:function(t){for(var n=t.getConnectors(),i=0,r=n.length;i<r;++i){var a=n[i],o=a[this._BOND_ATOM_REF_TEMP_FIELD];if(o&&o.length)for(var l=0,u=o.length;l<u;++l){var c=t.getNodeById(o[l]);c?a.appendConnectedObj(c):Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.ATOMID_NOT_EXISTS"):"Atom id not exists: ")+o[l])}delete a[this._BOND_ATOM_REF_TEMP_FIELD];var d=a[this._BOND_BOND_REF_TEMP_FIELD];if(d&&d.length)for(l=0,u=d.length;l<u;++l){var h=t.getConnectorById(d[l]);h?a.appendConnectedObj(h):Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.BONDID_NOT_EXISTS"):"Bond id not exists: ")+d[l])}delete a[this._BOND_BOND_REF_TEMP_FIELD]}},readMoleculeAtomArray:function(t,n,i,r){i.setTarget(t);var a=this.getAtomChildren(n,r);if(a.length>0)for(var o=0,l=a.length;o<l;++o){var u=a[o],c=this.readAtom(u,r);i.appendNode(c)}else{var d=this.readArrayedAtoms(n,r);for(o=0,l=d.length;o<l;++o)i.appendNode(d[o])}},readAtom:function(t,n){var i,r=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(t,this.getCoreNamespaceURI()),a=this.atomInfoToJSON(t,n);if(i=this.createStructureNodeOfAttribs(a),r)for(var o=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),l=0,u=o.length;l<u;++l)t=o[l],this.readChildElementDef(t,i);return i},readArrayedAtoms:function(t,n){for(var i=this.arrayedAtomInfosToJSON(t,n),r=[],a=0,o=i.length;a<o;++a){var l=this.createStructureNodeOfAttribs(i[a]);l&&r.push(l)}return r},createStructureNodeOfAttribs:function(t){var n;t.elementType||(t.elementType=Kekule.Element.UNSET_ELEMENT);var i=null;t.id!==void 0&&(i=t.id),delete t.id;var r,a,o=t.isotope?Math.round(t.isotope):null;if(n=Kekule.IO.CmlUtils.createNodeByCmdElementType(i,t.elementType,o),delete t.elementType,t.hydrogenCount!==void 0&&n.setExplicitHydrogenCount&&n.setExplicitHydrogenCount(parseInt(t.hydrogenCount,10)),delete t.hydrogenCount,t.formalCharge&&n.setCharge(parseInt(t.formalCharge)),delete t.formalCharge,t.title&&n.setInfoValue("title",t.title),delete t.title,t.role&&n.setInfoValue("role",t.role),delete t.role,t.x2!==void 0&&t.y2!==void 0)r={x:parseFloat(t.x2),y:parseFloat(t.y2)};else if(t.xy2){var l=Kekule.IO.CmlDomUtils.splitCmlArrayValue(t.xy2);l.length==2&&(r={x:parseFloat(l[0]),y:parseFloat(l[1])})}if(delete t.x2,delete t.y2,delete t.xy2,t.x3!==void 0&&t.y3!==void 0&&t.z3!==void 0)a={x:parseFloat(t.x3),y:parseFloat(t.y3),z:parseFloat(t.z3)};else if(t.xyz3){var u=Kekule.IO.CmlDomUtils.splitCmlArrayValue(t.xyz3);u.length==3&&(r={x:parseFloat(u[0]),y:parseFloat(u[1]),z:parseFloat(u[2])})}for(var c in delete t.x3,delete t.y3,delete t.z3,delete t.xyz3,r&&n.setCoord2D(r),a&&n.setCoord3D(a),t)t.hasOwnProperty(c)&&typeof t[c]=="string"&&n.setInfoValue(c,t[c]);return n},_BOND_ATOM_REF_TEMP_FIELD:"__cml_atomRefs",_BOND_BOND_REF_TEMP_FIELD:"__cml_bondRefs",readMoleculeBondArray:function(t,n,i,r){i.setTarget(t);var a=r.getElementsByTagNameNS(this.getCoreNamespaceURI(),"bond",n);if(a.length>0)for(var o=0,l=a.length;o<l;++o){var u=a[o],c=this.readBond(t,u,r);i.appendConnector(c)}else{var d=this.readArrayedBonds(t,n,r);for(o=0,l=d.length;o<l;++o)i.appendConnector(d[o])}},readBond:function(t,n,i){var r,a,o;if(o=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(n,this.getCoreNamespaceURI()),a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(n,Kekule.IO.CmlUtils.FILTER_TYPED_ELEM,!0,i),r=this.createStructureConnectorOfAttribs(t,a),o)for(var l=Kekule.DomUtils.getDirectChildElems(n,null,null,this.getCoreNamespaceURI()),u=0,c=l.length;u<c;++u)if(n=l[u],Kekule.DomUtils.getLocalName(n)=="bondStereo"){var d=Kekule.DomUtils.getElementText(n);d||(d=Kekule.IO.CmlDomUtils.getCmlElemAttribute(n,"conversionValue",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,i)),d||(d=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(Kekule.IO.CmlDomUtils.getCmlElemAttribute(n,"dictRef",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,i)));var h=Kekule.IO.CmlUtils.cmlBondStereoToKekule(d);h!=Kekule.BondStereo.NONE&&r.setStereo&&r.setStereo(h)}else this.readChildElementDef(n,r);return r},readArrayedBonds:function(t,n,i){var r=["id","bondID","atomRef1","atomRef2","order","bondStereo"],a=["id","id","atomRefs2","atomRefs2","order","bondStereo"],o=[],l=Kekule.IO.CmlDomUtils.getMultipleCmlElemAttribute(n,"atomRefs",Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,i);if(l&&l.length)for(var u=0,c=l.length;u<c;++u)for(var d=l[u],h=0,p=(g=Kekule.IO.CmlDomUtils.splitCmlArrayValue(d)).length;h<p;++h)o[h]||(o[h]={}),o[h].atomRefs==null&&(o[h].atomRefs=[]),o[h].atomRefs.push(g[h]);for(u=0,c=r.length;u<c;++u){var g=[];for((d=Kekule.IO.CmlDomUtils.getCmlElemAttribute(n,r[u],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,i))&&(g=Kekule.IO.CmlDomUtils.splitCmlArrayValue(d)),h=0,p=g.length;h<p;++h)o[h]||(o[h]={}),g[h]&&(r[u]=="atomRef1"||r[u]=="atomRef2"?(o[h].atomRefs2==null&&(o[h].atomRefs2=[]),r[u]=="atomRef1"?o[h].atomRefs2[0]=g[h]:o[h].atomRefs2[1]=g[h]):o[h][a[u]]=g[h])}var f=[];for(u=0,c=o.length;u<c;++u){var m=this.createStructureConnectorOfAttribs(t,o[u]);m&&f.push(m)}return f},createStructureConnectorOfAttribs:function(t,n){var i,r,a;if(n.id&&(r=n.id),delete n.id,n.order!==void 0&&(a=Kekule.IO.CmlUtils.cmlBondOrderToKekule(n.order)),delete n.order,i=new Kekule.Bond(r,null,a),n.bondStereo){var o=Kekule.IO.CmlUtils.cmlBondStereoToKekule(n.bondStereo);o!=Kekule.BondStereo.NONE&&i.setStereo&&i.setStereo(o)}delete n.bondStereo;for(var l=0,u=Kekule.IO.CML.ATOMS_REF_ATTRIBS.length;l<u;++l)if(n[d=Kekule.IO.CML.ATOMS_REF_ATTRIBS[l]]!=null){var c=Kekule.IO.CmlDomUtils.splitCmlArrayValue(n[d]);c.length>0&&(i[this._BOND_ATOM_REF_TEMP_FIELD]=c),delete n[d];break}for(l=0,u=Kekule.IO.CML.BONDS_REF_ATTRIBS.length;l<u;++l){var d;if(n[d=Kekule.IO.CML.BONDS_REF_ATTRIBS[l]]!=null){var h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(n[d]);h.length>0&&(i[this._BOND_BOND_REF_TEMP_FIELD]=h),delete n[d];break}}for(var p in n)n.hasOwnProperty(p)&&typeof n[p]=="string"&&i.setInfoValue(p,n[p]);return i},readFormula:function(t,n,i){var r=this.doGetChildElementReader(n);if(r){this.copySettingsToChildHandler(r);var a=r.readElement(n,t,this);a&&t.setFormula(a)}},readFormulaAttrib:function(t,n){var i=this.doGetChildElementReader("formula");if(i){var r=i.readConsice?i.readConsice(n):null;r&&t.setFormula(r)}}}),Kekule.IO.CmlMoleculeWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlMoleculeWriter",initProperties:function(){this.defineProp("allowCascadeGroup",{dataType:DataType.BOOL})},doCreateElem:function(t,n){return this.createChildElem("molecule",n)},doWriteObject:function(t,n,i){return this.writeMolecule(t,n,i)},writeMolecule:function(t,n,i){return this.writeMoleculeAttribs(t,n),t instanceof Kekule.CompositeMolecule?this.writeCompositeMolecule(t,n,i):this.writeMoleculeCore(t,n,i)},writeMoleculeAttribs:function(t,n){var i=[];t.getCharge()&&i.push({key:"formalCharge",value:t.getCharge()});for(var r=["title","dictRef","chirality","ref","spinMultiplicity","symmetryOriented","role"],a=0,o=r.length;a<o;++a){var l=r[a],u=t.getInfoValue(l);Kekule.ObjUtils.isUnset(u)||i.push({key:l,value:t.getInfoValue(l)})}for(a=0,o=i.length;a<o;++a)Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,i[a].key,i[a].value,this.getDomHelper())},writeCompositeMolecule:function(t,n,i){for(var r=t.getSubMolecules(),a=0,o=r.getItemCount();a<o;++a){var l=r.getItemAt(a),u=l.obj,c=this.writeObject(u,n,i);l.amount&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"amount",l.amount,this.getDomHelper())}return n},writeMoleculeCore:function(t,n,i){if(t.hasFormula()){var r=t.getFormula();this.doGetChildObjectWriter(r).writeObject(r,n,i)}t.hasCtab()&&this.writeCtab(t.getCtab(),t,n,i)},writeCtab:function(t,n,i,r){this.identifyObjsInCtab(t,n);var a=this.getAllowCascadeGroup()?t.getNodes():t.getLeafNodes();if(a.length>0)for(var o=this.createChildElem("atomArray",i),l=0,u=a.length;l<u;++l)this.writeCtabNode(a[l],o,r);var c=this.getAllowCascadeGroup()?t.getConnectors():t.getAllChildConnectors();if(c.length>0){var d=this.createChildElem("bondArray",i);for(l=0,u=c.length;l<u;++l)this.writeCtabConnector(c[l],d,r)}},writeCtabNode:function(t,n,i){var r=this.createChildElem("atom",n);this.writeObjId(t,r);var a=Kekule.IO.CmlUtils.getNodeElementType(t);Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"elementType",a,this.getDomHelper());var o=t.getMassNumber?t.getMassNumber():null;o&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"isotope",o,this.getDomHelper());var l=t.getExplicitHydrogenCount?t.getExplicitHydrogenCount():null;Kekule.ObjUtils.isUnset(l)||Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"hydrogenCount",l,this.getDomHelper());var u=t.getCharge?t.getCharge():null;u&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"formalCharge",u,this.getDomHelper()),t.getParity&&t.getParity();var c=t.getInfoValue?t.getInfoValue("title"):null;c&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"title",c,this.getDomHelper());var d=t.getInfoValue?t.getInfoValue("role"):null;if(d&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"role",d,this.getDomHelper()),t.hasCoord2D&&t.hasCoord2D()){var h=t.getAbsCoord2D();!Kekule.ObjUtils.isUnset(h.x)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"x2",h.x,this.getDomHelper()),!Kekule.ObjUtils.isUnset(h.y)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"y2",h.y,this.getDomHelper())}if(t.hasCoord3D&&t.hasCoord3D()){var p=t.getAbsCoord3D();!Kekule.ObjUtils.isUnset(p.x)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"x3",p.x,this.getDomHelper()),!Kekule.ObjUtils.isUnset(p.y)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"y3",p.y,this.getDomHelper()),!Kekule.ObjUtils.isUnset(p.z)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"z3",p.z,this.getDomHelper())}for(var g=["occupancy","xFract","xyzFract","yFract","convention","dictRef","ref"],f=0,m=g.length;f<m;++f){var C=g[f],_=t.getInfoValue(C);_&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,C,_,this.getDomHelper())}return this.writeObjAdditionalInfo(t,r,i),r},writeCtabConnector:function(t,n,i){var r=!1,a=this.createChildElem("bond",n);this.writeObjId(t,a);var o=t.getBondOrder?t.getBondOrder():null;if(o){var l=Kekule.IO.CmlUtils.kekuleBondOrderToCml(o);l&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,"order",l,this.getDomHelper())}var u,c=t.getStereo?t.getStereo():null;if(c){var d=Kekule.IO.CmlUtils.kekuleBondStereoToCml(c);if(d.value){var h=this.createChildElem("bondStereo",a);Kekule.DomUtils.setElementText(h,d.value),d.invert&&(r=!0)}}for(var p=[],g=[],f=0,m=t.getConnectedObjCount();f<m;++f){var C=t.getConnectedObjAt(f);if(C.getId&&C.getId()){var _=C.getId();C instanceof Kekule.ChemStructureNode?r?p.unshift(_):p.push(_):C instanceof Kekule.ChemStructureConnector&&g.push(_)}}if(u=p.length){var y=u==1?"atomRefs":u>=2&&u<=4?"atomRefs"+u:"atomRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,y,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(p),this.getDomHelper())}(u=g.length)&&(y="bondRefs",Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,y,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(g),this.getDomHelper()));var T=["convention","dictRef","ref"];for(f=0,m=T.length;f<m;++f){var E=T[f],b=t.getInfoValue(E);b&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,E,b,this.getDomHelper())}return this.writeObjAdditionalInfo(t,a,i),a},identifyObjsInCtab:function(t,n){for(var i=0,r=t.getNodeCount();i<r;++i){var a=t.getNodeAt(i);a.getId()||this.autoIdentifyForObj(a,n),t.isSubFragment(a)&&a.hasCtab&&a.hasCtab()&&this.identifyObjsInCtab(a.getCtab(),n)}for(i=0,r=t.getConnectorCount();i<r;++i){var o=t.getConnectorAt(i);o.getId()||this.autoIdentifyForObj(o,n)}}}),Kekule.IO.CmlMoleculeWriter._UID_SEED=null,Kekule.IO.CmlReactionReagentReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReagentReader",doReadElement:function(t,n,i,r){return this.readReagent(t,i,this.getDomHelper())},readReagent:function(t,n,i){var r=null,a=Kekule.DomUtils.getDirectChildElems(t,null,"molecule",this.getCoreNamespaceURI());if(a&&a.length){var o=a[a.length-1],l=this.doGetChildElementReader(o).readElement(o,null,this);l&&(r={},Kekule.RoleMapUtils.setItem(r,l),this.readReagentAttribs(r,t,i))}return r},readReagentAttribs:function(t,n,i){for(var r=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(n,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,i),a=Kekule.ObjUtils.getOwnedFieldNames(r),o=0,l=a.length;o<l;++o){var u=a[o],c=r[u];switch(u){case"role":t.role=Kekule.IO.CmlUtils.reagentRoleToKekule(c);break;case"amount":case"count":t.amount=parseFloat(c);break;default:t[u]=c}}return t}}),Kekule.IO.CmlReactionReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReader",doReadElement:function(t,n,i,r){return this.readReaction(t,this.getDomHelper())},readReaction:function(t,n){for(var i=new Kekule.Reaction,r=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),a=0,o=r.length;a<o;++a)this.isComponentListElem(r[a])?this.readComponentList(i,r[a],n):this.readChildElement(r[a],i);var l=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,null,this.getDomHelper()),u=Kekule.ObjUtils.getOwnedFieldNames(l);for(a=0,o=u.length;a<o;++a){var c=u[a],d=l[c];switch(c){case"name":i.setName(d);break;case"title":i.setTitle(d);break;case"type":i.setReactionType(d);break;case"yield":i.setYield(parseFloat(d));break;default:i.setInfoValue(c,d)}}return i},readComponentList:function(t,n,i){var r=this.getListElemComponentName(n),a=t.getComponentArray(r,!0);if(a)for(var o=Kekule.DomUtils.getDirectChildElems(n,null,null,this.getCoreNamespaceURI()),l=0,u=o.length;l<u;++l){var c=this.readChildElement(o[l],a);c&&(r==Kekule.ReactionComponent.CONDITION&&c instanceof ObjectEx?t.appendItem(r,c):t.appendMap(r,c))}},isComponentListElem:function(t){return["reactantList","productList","substanceList","conditionList"].indexOf(Kekule.DomUtils.getLocalName(t))>=0},getListElemComponentName:function(t){switch(Kekule.DomUtils.getLocalName(t)){case"reactantList":return Kekule.ReactionComponent.REACTANT;case"productList":return Kekule.ReactionComponent.PRODUCT;case"conditionList":return Kekule.ReactionComponent.CONDITION;default:return Kekule.ReactionComponent.SUBSTANCE}}}),Kekule.IO.CmlReactionWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlReactionWriter",doCreateElem:function(t,n){return this.createChildElem("reaction",n)},doWriteObject:function(t,n,i){return this.writeReaction(t,n,i)},writeReaction:function(t,n,i){for(var r=[Kekule.ReactionComponent.REACTANT,Kekule.ReactionComponent.PRODUCT,Kekule.ReactionComponent.SUBSTANCE,Kekule.ReactionComponent.CONDITION],a=0,o=r.length;a<o;++a)this.writeCompList(t,r[a],n,i);return this.writeReactionAttribs(t,n,i),n},writeReactionAttribs:function(t,n,i){var r=[];t.getName()&&r.push({key:"name",value:t.getName()}),t.getTitle()&&r.push({key:"title",value:t.getTitle()}),t.getReactionType()&&r.push({key:"type",value:t.getReactionType()}),t.getYield()&&r.push({key:"yield",value:t.getYield()});for(var a=["dictRef","convention","format","ref","role","type","state","yield","atomMap","electronMap"],o=0,l=a.length;o<l;++o)Kekule.ObjUtils.isUnset(t.getInfoValue(a[o]))||r.push({key:a[o],value:t.getInfoValue(a[o])});for(o=0,l=r.length;o<l;++o)Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,r[o].key,r[o].value,this.getDomHelper())},writeCompList:function(t,n,i,r){if(t.getComponentItemCount(n)<=0)return null;for(var a=this.getReactionComponentCmlName(n),o=this.createChildElem(a+"List",i),l=0,u=t.getComponentItemCount(n);l<u;++l){var c=t.getMapAt(n,l),d=t.getMapItemAt(n,l);if(c&&d){var h;n!=Kekule.ReactionComponent.CONDITION?(h=this.createChildElem(a,o),Kekule.ObjUtils.isUnset(c.amount)||Kekule.IO.CmlDomUtils.setCmlElemAttribute(h,"amount",c.amount,this.getDomHelper()),c.role&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(h,"role",Kekule.IO.CmlUtils.kekuleReagentRoleToCml(c.role),this.getDomHelper())):h=o;var p=this.doGetChildObjectWriter(d);p&&p.writeObject(d,h,r)}}},getReactionComponentCmlName:function(t){switch(t){case Kekule.ReactionComponent.REACTANT:return"reactant";case Kekule.ReactionComponent.PRODUCT:return"product";case Kekule.ReactionComponent.CONDITION:return"condition";default:return"substance"}}}),Kekule.IO.CmlListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlListReader",doCreateList:function(t){switch(Kekule.DomUtils.getLocalName(t)){case"moleculeList":return new Kekule.MoleculeList;case"reactionList":return new Kekule.ReactionList;default:return new Kekule.ChemObjList}},doAppendObjToList:function(t,n){return n&&n.append?n.append(t):this.tryApplySuper("doAppendObjToList",[t,n]),n}}),Kekule.IO.CmlListWriter=Class.create(Kekule.IO.CmlBaseListWriter,{CLASS_NAME:"Kekule.IO.CmlListWriter",doGetListElemTagName:function(t,n){var i;switch(DataType.getType(t)){case"Kekule.MoleculeList":i="moleculeList";break;case"Kekule.ReactionList":i="reactionList";break;default:i=this.tryApplySuper("doGetListElemTagName",[t,n])}return i}}),Kekule.IO.CmlTransparentListWriter=Class.create(Kekule.IO.CmlBaseListWriter,{CLASS_NAME:"Kekule.IO.CmlTransparentListWriter",doGetListElemTagName:function(t,n){return null}}),Kekule.IO.CmlRootReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlRootReader",doReadElement:function(t,n,i,r){var a;if(this.analysisElem(t),Kekule.DomUtils.getLocalName(t)!="cml"&&(a=this.getReader(t)),a)return a.readElement(t,null,this,r);var o=r.defaultRootObjListHolder&&r.enableReadRootObjList,l=[],u=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI());if(u){for(var c=0,d=u.length;c<d;++c)if(a=this.getReader(u[c])){var h=a.readElement(u[c],null,this,r);if(!o)return h;l.push(h)}return l.length<=0?null:l.length<=1?l[0]:this._createChildObjsHolder(l,r.defaultRootObjListHolder)}return null},getReader:function(t){return this.doGetChildElementReader(t)},analysisElem:function(t){var n=this.getDomHelper();n.setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(t);for(var i=n.getNamespaces(),r=null,a=0,o=i.length;a<o;++a){var l=i[a].namespaceURI;if(Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS.indexOf(l)>=0){r=l;break}}this.setCoreNamespaceURI(r||null),this.setNamespaces(i)}}),Kekule.IO.CmlRootWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlRootWriter",getWriter:function(t){return this.doGetChildObjectWriter(t)},writeObject:function(t,n,i){var r;this.getDomHelper().setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(n),r=t instanceof Kekule.ChemSpace?t.getRoot():t;var a=this.getWriter(r);return a?a.writeObject(r,n,i):null}}),Kekule.IO.CmlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.CmlReader",initProperties:function(){this.defineProp("objIdMap",{dataType:DataType.HASH,serializable:!1})},doReadData:function(t,n,i,r){var a,o;n!=Kekule.IO.ChemDataType.DOM?a=DataType.XmlUtility.parse(t).documentElement:a=t.documentElement?t.documentElement:t;var l=Kekule.IO.CmlElementReaderFactory.getReader("cml");if(l)try{this.setObjIdMap({}),l.setRootEvoker(this);var u=Object.extend({},Kekule.globalOptions.IO.cml);u=Object.extend(u,r||{}),o=l.readElement(a,null,null,u),l.doneReadingDocument(!0)}finally{l.finalize(),this.setObjIdMap(null)}return o},getLoadedObjById:function(t){var n=this.getObjIdMap();return n&&n[t]},setObjIdMapValue:function(t,n){var i=this.getObjIdMap();i&&(i[t]=n)}}),Kekule.IO.CmlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.CmlWriter",initialize:function(t){this.tryApplySuper("initialize",[t]);var n=t||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(n.prettyPrint)?Kekule.globalOptions.IO.cml.prettyPrint:n.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0}),this.defineProp("rootElemWriter",{dataType:DataType.OBJECT,setter:null,serializable:!1})},doWriteData:function(t,n,i,r){var a=Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI,o=DataType.XmlUtility.newDocument("cml",a),l=Kekule.IO.CmlElementWriterFactory.getWriter("Kekule.ChemDocument");if(l){var u;try{this.setPropStoreFieldValue("rootElemWriter",l);var c=Object.extend({},Kekule.globalOptions.IO.cml);c=Object.extend(c,r||{}),l.setCoreNamespaceURI(a),u=l.writeObject(t,o.documentElement,c),l.doneWritingDocument(!0),n==Kekule.IO.ChemDataType.TEXT&&(u=DataType.XmlUtility.serializeNode(o.documentElement,{prettyPrint:c.prettyPrint||this.getPrettyPrint()}))}finally{this.setPropStoreFieldValue("rootElemWriter",null),l.finalize()}return u}return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_CML").format(DataType.getType(t))),null}}),function(){Kekule.IO.MimeType.CML="chemical/x-cml";var t=Kekule.IO.CmlElementReaderFactory;t.register("name",Kekule.IO.CmlNameReader),t.register("scalar",Kekule.IO.CmlScalarReader),t.register("metaData",Kekule.IO.CmlMetaDataReader),t.register("metaDataList",Kekule.IO.CmlMetaDataListReader),t.register("formula",Kekule.IO.CmlFormulaReader),t.register("molecule",Kekule.IO.CmlMoleculeReader),t.register(["reactant","product","substance"],Kekule.IO.CmlReactionReagentReader),t.register("reaction",Kekule.IO.CmlReactionReader),t.register(["list","moleculeList","reactionList"],Kekule.IO.CmlListReader),t.register(["conditionlist"],Kekule.IO.CmlConditionListReader),t.register(["parameter"],Kekule.IO.CmlParameterReader),t.register(["parameterlist"],Kekule.IO.CmlParameterListReader),t.register(["array"],Kekule.IO.CmlArrayReader),t.register("cml",Kekule.IO.CmlRootReader);var n=Kekule.IO.CmlElementWriterFactory;n.register(DataType.ARRAY,Kekule.IO.CmlArrayWriter),n.register("Kekule.Scalar",Kekule.IO.CmlScalarWriter),n.register("Kekule.MolecularFormula",Kekule.IO.CmlFormulaWriter),n.register(["Kekule.ChemStructureFragment","Kekule.Molecule","Kekule.CompositeMolecule"],Kekule.IO.CmlMoleculeWriter),n.register("Kekule.Reaction",Kekule.IO.CmlReactionWriter),n.register(["Kekule.ChemObjList","Kekule.ChemStructureObjectGroup"],Kekule.IO.CmlListWriter),n.register(["Kekule.ChemSpaceElement","Kekule.ChemSpace"],Kekule.IO.CmlTransparentListWriter),n.register("Kekule.ChemDocument",Kekule.IO.CmlRootWriter),Kekule.IO.DataFormat.CML="cml",Kekule.IO.DataFormatsManager.register("cml",Kekule.IO.MimeType.CML,"cml",Kekule.IO.ChemDataType.TEXT,"Chemical Markup Language");var i=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.CML);Kekule.IO.ChemDataReaderManager.register("cml",Kekule.IO.CmlReader,[i]),Kekule.IO.ChemDataWriterManager.register("cml",Kekule.IO.CmlWriter,[Kekule.Scalar,Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemSpace],[i])}()}(),Kekule.IO.MdlVersion={V2000:2,V3000:3},Kekule.IO.MDL={VER2000:"V2000",VER3000:"V3000",SYMBOL_ANYATOM:"A",SYMBOL_STARATOM:"*",SYMBOL_HETEROATOM:"Q",SYMBOL_RGROUP:"R",SYMBOL_RGROUP2:"R#",SYMBOL_LONEPAIR:"LP",SYMBOL_ATOMLIST:"L",SYMBOL_DUMMYATOM:"Du",SD_DATA_HEAD_PREFIX:">",MOL_DELIMITER:"$$$$"},Kekule.IO.MdlUtils={isUnspecifiedAtomSymbol:function(s){return s===Kekule.IO.MDL.SYMBOL_ANYATOM||s===Kekule.IO.MDL.SYMBOL_STARATOM},isHeteroAtomSymbol:function(s){return s===Kekule.IO.MDL.SYMBOL_HETEROATOM},isRGroupSymbol:function(s){return s===Kekule.IO.MDL.SYMBOL_RGROUP||s===Kekule.IO.MDL.SYMBOL_RGROUP2},isLonePairSymbol:function(s){return s===Kekule.IO.MDL.SYMBOL_LONEPAIR},isAtomListSymbol:function(s){return s===Kekule.IO.MDL.SYMBOL_ATOMLIST},analysisMdlDateTimeStr:function(s,e){var t=new Date,n=0,i=2,r=(parseInt(s.substr(n,i).trim(),10)||1)-1;n+=i;var a=parseInt(s.substr(n,i).trim(),10)||0;n+=i,i=e?4:2;var o=parseInt(s.substr(n,i),10)||0;e||(o+=o>=70?1900:2e3),t.setFullYear(o,r,a),n+=i,i=2;var l=parseInt(s.substr(n,i),10)||0;n+=i;var u=parseInt(s.substr(n,i),10)||0;return t.setHours(l,u),t},generateMdlDateTimeStr:function(s,e){var t="";return t+=(s.getMonth()+1).toString().lpad(2,"0"),t+=s.getDate().toString().lpad(2,"0"),t+=e?s.getFullYear().toString().lpad(4,"0"):(s.getFullYear()%100).toString().lpad(2,"0"),t+=s.getHours().toString().lpad(2,"0"),t+=s.getMinutes().toString().lpad(2,"0")},mdlRadicalToKekule:function(s){return s},kekuleRadicalToMdl:function(s){return s},bondTypeToKekuleOrder:function(s){switch(s){case 1:return Kekule.BondOrder.SINGLE;case 2:return Kekule.BondOrder.DOUBLE;case 3:return Kekule.BondOrder.TRIPLE;case 4:return Kekule.BondOrder.EXPLICIT_AROMATIC;default:return Kekule.BondOrder.UNSET}},kekuleBondOrderToMdlType:function(s){switch(s){case Kekule.BondOrder.SINGLE:return 1;case Kekule.BondOrder.DOUBLE:return 2;case Kekule.BondOrder.TRIPLE:return 3;case Kekule.BondOrder.EXPLICIT_AROMATIC:return 4;default:return 1}},getRxnMarkVersion:function(s){var e=s.substr(0,4);return e!="$RXN"?null:(e=s.substr(4).trim())==Kekule.IO.MDL.VER3000?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000},assertIlegalForCtabOutput:function(s){return s instanceof Kekule.StructureFragment?!!s.hasCtab()||(Kekule.error(Kekule.$L("ErrorMsg.MOLECULE_HAS_NO_CTAB_TO_OUTPUT")),!1):(Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_WRITE_NON_MOLECULE_TO_MOL")),!1)}},Kekule.IO.MdlStructureUtils={fillFragment:function(s,e,t){if(s.clear(),e){var n;if(n=t&&t!=Kekule.CoordMode.UNKNOWN?t==Kekule.CoordMode.COORD3D:e.atomInfos.isCoord3D,e.atomInfos){for(var i=0,r=e.atomInfos.length;i<r;++i)if(u=e.atomInfos[i]){var a=Kekule.IO.MdlStructureUtils.createStructureNode(s,u,n);a?s.appendNode(a):Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_ATOM_CANNOT_CREATE"))}}if(e.bondInfos){for(i=0,r=e.bondInfos.length;i<r;++i)if(u=e.bondInfos[i]){var o=Kekule.IO.MdlStructureUtils.createStructureConnector(s,u);o?s.appendConnector(o):Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_BOND_CANNOT_CREATE"))}}if(e.sgInfos&&e.sgInfos.length){var l=[];for(i=0,r=e.sgInfos.length;i<r;++i){var u;if((u=e.sgInfos[i])&&u.sgType=="SUP"){for(var c=[],d=0,h=u.atomIndexes.length;d<h;++d)c.push(s.getNodeAt(u.atomIndexes[d]));c.length&&l.push({atoms:c,text:u.label})}}for(i=0,r=l.length;i<r;++i)if((c=l[i].atoms).length){var p=s.marshalSubFragment(c,new Kekule.SubGroup),g=l[i].text;p.setFormulaText&&g.match(/.+\d/)?p.setFormulaText(l[i].text):p.setAbbr(l[i].text)}}}return s},createStructureNode:function(s,e,t){var n;if(e.atomListInfo||Kekule.IO.MdlUtils.isAtomListSymbol(e.symbol)){n=new Kekule.VariableAtom;var i=[];e.atomListInfo&&e.atomListInfo.symbols&&(i=i.concat(e.atomListInfo.symbols),e.atomListInfo.isAllowList?n.setAllowedIsotopeIds(i):n.setDisallowedIsotopeIds(i))}else if(Kekule.IO.MdlUtils.isRGroupSymbol(e.symbol))n=new Kekule.RGroup;else if(Kekule.IO.MdlUtils.isHeteroAtomSymbol(e.symbol))n=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.HETERO);else if(Kekule.IO.MdlUtils.isUnspecifiedAtomSymbol(e.symbol))n=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY);else{var r=Kekule.ChemicalElementsDataUtil.getElementInfo(e.symbol);if(r){var a=null;if(e.massNumber)a=e.massNumber;else if(e.massDiff&&r){var o=r.naturalMass,l=(a=Math.round(o+e.massDiff),Kekule.IsotopesDataUtil.getIsotopeInfo(r.atomicNumber,a));l||(a=Math.floor(o+e.massDiff),l=Kekule.IsotopesDataUtil.getIsotopeInfo(r.atomicNumber,a)),l||(a=Math.ceil(o+e.massDiff),l=Kekule.IsotopesDataUtil.getIsotopeInfo(r.atomicNumber,a)),l||(a=null)}n=new Kekule.Atom(null,e.symbol,a)}else{var u=Kekule.IsotopesDataUtil.getIsotopeInfo(e.symbol);n=u?new Kekule.Atom(null,u.atomicNumber,u.massNumber):new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY)}}return e.charge&&n.setCharge(e.charge),e.radical&&n.setRadical(e.radical),e.parity&&n.setParity&&n.setParity(e.parity),e.hydrongenCount!==void 0&&n.setExplicitHydrogenCount&&n.setExplicitHydrogenCount(e.hydrongenCount),t?n.setCoord3D({x:e.x,y:e.y,z:e.z}):n.setCoord2D({x:e.x,y:e.y}),n},createStructureConnector:function(s,e){var t=s.getNodeAt(e.atomIndex1),n=s.getNodeAt(e.atomIndex2);if(t&&n){var i=[t,n];if(e.endAtomIndexes)for(var r=0,a=e.endAtomIndexes.length;r<a;++r){var o=s.getNodeAt(e.endAtomIndexes[r]);o&&i.push(o)}var l=new Kekule.Bond(null,i,e.order);return e.stereo!==void 0&&l.setStereo(e.stereo),l}return null},isNodeVariableAtom:function(s){return s instanceof Kekule.VariableAtom},getAtomTypeStr:function(s,e){if(s instanceof Kekule.Atom)return s.getSymbol();if(!(s instanceof Kekule.Pseudoatom)){if(s instanceof Kekule.RGroup)return Kekule.IO.MDL.SYMBOL_RGROUP;if(s instanceof Kekule.VariableAtom){if(e)return Kekule.IO.MDL.SYMBOL_ATOMLIST;var t="[",n=s.getAllowedIsotopeIds();if(n&&n.length||(t="NOT[",n=s.getDisallowedIsotopeIds()),n&&n.length){for(var i=[],r=0,a=n.length;r<a;++r){var o=Kekule.IsotopesDataUtil.getIsotopeIdDetail(n[r]);o&&o.symbol&&i.push(o.symbol)}return t=t+i.join(",")+"]"}return Kekule.IO.MDL.SYMBOL_ATOMLIST}return"?"}switch(s.getAtomType()){case Kekule.PseudoatomType.ANY:return Kekule.IO.MDL.SYMBOL_ANYATOM;case Kekule.PseudoatomType.HETERO:return Kekule.IO.MDL.SYMBOL_HETEROATOM;default:return Kekule.IO.MDL.SYMBOL_DUMMYATOM}},getMoleculeCtabStructureInfo:function(s){var e={};e.atoms=s.getLeafNodes(),e.bonds=s.getAllChildConnectors(),e.subGroups=s.getSubFragments();for(var t=0,n=0,i=0,r=e.atoms.length;i<r;++i)e.atoms[i].hasCoord3D()&&++n,e.atoms[i].hasCoord2D()&&++t;return e.coordMode=t>n?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D,e},splitConnectedNodes:function(s){for(var e={primaryNodes:[]},t=0,n=s.getConnectedObjs(),i=0,r=n.length;i<r;++i)n[i]instanceof Kekule.ChemStructureNode&&(t<2?(e.primaryNodes.push(n[i]),++t):(e.remainNodes||(e.remainNodes=[]),e.remainNodes.push(n[i])));return e},generateClassicStyleCountLine:function(s,e){if(e==Kekule.IO.MdlVersion.V3000)return"  0  0  0     0  0              0 V3000";var t="";t+=s.atoms.length.toString().lpad(3),t+=s.bonds.length.toString().lpad(3),t+="0".lpad(3),t+="0".lpad(3),t+="0".lpad(3),t+="0".lpad(3);for(var n=0;n<4;++n)t+="0".lpad(3);return t+="999",t+=Kekule.IO.MDL.VER2000.lpad(6)}},Kekule.IO.MdlBlockHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.MdlBlockHandler",initProperties:function(){this.defineProp("textBuffer",{dataType:"Kekule.TextLinesBuffer",serializable:!1,getter:function(){var s=this.getPropStoreFieldValue("textBuffer");return s||(s=this.createTextBuffer(),this.setPropStoreFieldValue("textBuffer",s)),s},setter:null})},createTextBuffer:function(){return new Kekule.TextLinesBuffer}}),Kekule.IO.MdlBlockReader=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockReader",readBlock:function(s,e){return typeof s=="string"?this.getTextBuffer().setText(s):this.getTextBuffer().setLines(s),this.getTextBuffer().reset(),this.doReadBlock(this.getTextBuffer())},doReadBlock:function(s,e){}}),Kekule.IO.MdlBlockWriter=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockWriter",writeBlock:function(s){return this.getTextBuffer().clear(),this.doWriteBlock(s,this.getTextBuffer()),this.getTextBuffer().getText()},doWriteBlock:function(s,e){}}),Kekule.IO.Mdl2kUtils={atomLineChargeToKekule:function(s){switch(s){case 1:return 3;case 2:return 2;case 3:return 1;case 5:return-1;case 6:return-2;case 7:return-3;default:return 0}},chargeToMdlAtomLineValue:function(s){switch(s){case 1:return 3;case 2:return 2;case 3:return 1;case-1:return 5;case-2:return 6;case-3:return 7;default:return 0}},atomLineChargeToRadical:function(s){return s==4?Kekule.RadicalOrder.DOUBLET:0},radicalToMdlAtomLineValue:function(s){return s==Kekule.RadicalOrder.DOUBLET?4:0},chargeOrRadicalToMdlAtomLineValue:function(s,e){return s?Kekule.IO.Mdl2kUtils.chargeToMdlAtomLineValue(s):e?Kekule.IO.Mdl2kUtils.radicalToMdlAtomLineValue(s):0},bondStereoToKekule:function(s,e){if(e==Kekule.BondOrder.SINGLE)switch(s){case 1:return Kekule.BondStereo.UP;case 4:return Kekule.BondStereo.UP_OR_DOWN;case 6:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}else{if(e!=Kekule.BondOrder.DOUBLE)return Kekule.BondStereo.NONE;switch(s){case 3:return Kekule.BondStereo.E_Z_BY_COORDINATES;default:return Kekule.BondStereo.NONE}}},bondStereoToMdlBondLineValue:function(s,e,t){var n=Kekule.BondStereo,i={};if(e==Kekule.BondOrder.SINGLE)if(t&&[n.UP_INVERTED,n.DOWN_INVERTED].indexOf(s)>=0&&(i.inverted=!0),i.inverted)s===n.UP_INVERTED?i.stereo=1:s===n.DOWN_INVERTED&&(i.stereo=6);else switch(s){case n.DOWN_INVERTED:case n.UP:i.stereo=1;break;case n.UP_INVERTED:case n.DOWN:i.stereo=6;break;case n.UP_OR_DOWN_INVERTED:case n.UP_OR_DOWN:i.stereo=4;break;default:i.stereo=0}else if(e==Kekule.BondOrder.DOUBLE)switch(s){case Kekule.BondStereo.E_Z_BY_COORDINATES:i.stereo=3;break;default:i.stereo=0}else i.stereo=0;return i},coordToStr:function(s){return(s||0).toFixed(4)},getMassDiff:function(s){var e=Kekule.ChemicalElementsDataUtil.getElementInfo(s.getAtomicNumber()).naturalMass;return Math.round(s.getMassNumber()-e)},getAtomListPropLineValue:function(s){var e="",t=s.getAllowedIsotopeIds();if(t&&t.length?e=" F ":(e=" T ",t=s.getDisallowedIsotopeIds()),t&&t.length){for(var n=[],i=0,r=t.length;i<r;++i){var a=Kekule.IsotopesDataUtil.getIsotopeIdDetail(t[i]);a&&a.symbol&&n.push(a.symbol.rpad(4))}var o=n.join("");return e=n.length.toString().lpad(3)+e+o}return null},getCtabPropLineTag:function(s,e){return(e||"M")+"  "+s},getCtabPropLineCountTag:function(s,e,t){var n=(t||"M")+"  "+s;return e&&(n+=e.toString().lpad(3)),n},generateCtabPropLine:function(s,e,t,n){return Kekule.IO.Mdl2kUtils.getCtabPropLineCountTag(e,t,n)+" "+s.join(" ")}},Kekule.IO.Mdl2kCTabReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl2kCTabReader",doReadBlock:function(s,e){return this.analysisCTab(s)},analysisCTab:function(s){var e={},t=s.readLine(),n=this.analysisCountLine(t),i=[];i.isCoord3D=!1;for(var r=0;r<n.atomCount;++r){t=s.readLine();var a=this.analysisAtomLine(t);a.z&&(i.isCoord3D=!0),i.push(a)}var o=[];for(r=0;r<n.bondCount;++r){t=s.readLine();var l=this.analysisBondLine(t);o.push(l)}for(r=0;r<n.atomListCount;++r){t=s.readLine();var u=this.analysisAtomListInfoLine(t);i[u.atomIndex]&&(i[u.atomIndex].atomListInfo=u)}for(r=0;r<n.stextCount;++r)t=s.readLine(),t=s.readLine();for(var c=[];!s.eof();){t=s.readLine();var d=this.analysisPropertyLine(t,i,c);if(d.prop==="END")break;if(d.prop==="SKP")for(r=0;r<d.count&&!s.eof();++r)t=s.readLine();else if(d.leading==="A"){if(s.eof())break;var h=d.atomIndex;t=s.readLine(),i[h].symbol=t.trim()}}return e.countInfo=n,e.atomInfos=i,e.bondInfos=o,e.sgInfos=c,e},analysisCountLine:function(s){var e={},t=s.substr(33,6).trim();return t&&t!=Kekule.IO.MDL.VER2000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_FORMAT_DATA")),null):(t=s.substr(0,3),e.atomCount=parseInt(t,10),t=s.substr(3,3),e.bondCount=parseInt(t,10),t=s.substr(12,3),e.isChiral=parseInt(t,10)!=0,t=s.substr(15,3),e.stextCount=parseInt(t,10),e)},analysisAtomLine:function(s){var e={},t=s.substr(0,10);e.x=parseFloat(t),t=s.substr(10,10),e.y=parseFloat(t),t=s.substr(20,10),e.z=parseFloat(t),t=s.substr(31,3),e.symbol=t.trim(),t=s.substr(34,2),e.massDiff=parseInt(t,10),t=s.substr(36,3);var n=parseInt(t,10),i=Kekule.IO.Mdl2kUtils.atomLineChargeToRadical(n);return i?e.radical=i:e.charge=Kekule.IO.Mdl2kUtils.atomLineChargeToKekule(n),t=s.substr(39,3),(n=parseInt(t,10))&&(e.parity=n),t=s.substr(42,3),(n=parseInt(t,10))>0&&(e.hydrongenCount=n-1),e},analysisBondLine:function(s){var e={},t=s.substr(0,3);e.atomIndex1=parseInt(t,10)-1,t=s.substr(3,3),e.atomIndex2=parseInt(t,10)-1,t=s.substr(6,3),e.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(t,10)),t=s.substr(9,3);var n=Kekule.IO.Mdl2kUtils.bondStereoToKekule(parseInt(t,10),e.order);return n&&(e.stereo=n),e},analysisAtomListInfoLine:function(s){var e={},t=s.substr(0,3);e.atomIndex=parseInt(t,10)-1,t=s.substr(4,1),e.isAllowList=t.toLowerCase()=="f",t=s.substr(9,1);var n=Math.min(parseInt(t,10),5);e.atomicNumbers=[];for(var i=11,r=0;r<n;++r){i+=4*r,t=s.substr(i,3);var a=parseInt(t,10);a&&e.atomicNumbers.push(a)}return e},analysisPropertyLine:function(s,e,t){var n={},i=s.substr(0,1);if(n.leading=i,i=="M"){var r,a,o=s.substr(3,3).trim();if(n.prop=o,o==="END")return n;if(["CHG","RAD","ISO"].indexOf(o)>=0){var l=parseInt(s.substr(6,3).trim());n.entryCount=l,n.entries=[];for(var u=o==="CHG"?"charge":o==="RAD"?"radical":"massNumber",c=10,d=0;d<l;++d){var h=parseInt(s.substr(c,3).trim(),10)-1,p=parseInt(s.substr(c+4,3).trim(),10);c+=8,n.entries.push({atomIndex:h,propName:p}),e[h][u]=p}}else["STY","SLB"].indexOf(o)>=0?a=t[r=parseInt(s.substr(10,3),10)-1]:["SAL","SBL","SMT","SCL","SAP","SBV"].indexOf(o)>=0&&(a=t[r=parseInt(s.substr(7,3),10)-1]);switch(o){case"ALS":var g={},f=s.substr(7,3).trim();g.atomIndex=parseInt(f,10)-1,n.atomIndex=g.atomIndex;var m=parseInt(s.substr(10,3)),C=s.substr(14,1);for(g.isAllowList=C.toLowerCase()=="f",g.symbols=[],d=0;d<m;++d)C=s.substr(16+4*d,4).trim(),g.symbols.push(C);n.atomListInfo=g;var _=e[g.atomIndex].atomListInfo;_?_.isAllowList!==g.isAllowList?e[g.atomIndex].atomListInfo=g:_.symbols=Kekule.ArrayUtils.pushUnique(_.symbols,g.symbols):e[g.atomIndex].atomListInfo=g;break;case"STY":s.substr(14,3)=="SUP"&&(t[r]={sgType:"SUP"});break;case"SLB":a&&(a.labelId=s.substr(14).trim());break;case"SAL":if(a){var y=parseInt(s.substr(10,3));for(a.atomIndexes||(a.atomIndexes=[]),d=0;d<y;++d)C=s.substr(14+4*d,3),h=parseInt(C)-1,a.atomIndexes.push(h)}break;case"SBL":if(a&&a.sgType=="SUP"){var T=parseInt(s.substr(10,3));for(a.crossBondIndexes||(a.crossBondIndexes=[]),d=0;d<T;++d){C=s.substr(14+4*d,3);var E=parseInt(C)-1;a.crossBondIndexes.push(E)}}break;case"SMT":a&&(a.sgType=="SUP"?a.label=s.substr(11).trim():a.subscript=s.substr(11).trim());break;case"SCL":a&&(a.sgClass=s.substr(11).trim());break;case"SBV":if(a){var b=parseInt(s.substr(11,3),10)-1;a.bondVectors||(a.bondVectors=[]),a.bondVectors[b]={bondIndex:b,x:parseFloat(s.substr(14,10)),y:parseFloat(s.substr(24,10))};var v=s.substr(34,10).trim();v&&(a.bondVectors[b].z=parseFloat(v)||0)}}}else i==="A"?(c=3,h=parseInt(s.substr(c,3).trim(),10)-1,n.atomIndex=h):i==="V"||i==="G"||i==="S"&&(o=s.substr(3,3).trim(),n.prop=o,n.count=parseInt(s.substr(6,3),10));return n}}),Kekule.IO.Mdl2kCTabWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl2kCTabWriter",initialize:function(s){this.tryApplySuper("initialize"),this.setCoordMode(s||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(s,e){return Kekule.IO.MdlUtils.assertIlegalForCtabOutput(s),this.outputCtab(s,e)},outputCtab:function(s,e){var t=[],n=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(s);if(this.getCoordMode()!=Kekule.CoordMode.UNKNOWN&&(n.coordMode=this.getCoordMode()),e.writeLine(this.generateCountLine(n)),this.outputAtomBlock(s,n,e,t),this.outputBondBlock(s,n,e),t.length)for(var i=0,r=t.length;i<r;++i)e.writeLine(t[i]);this.outputSubgroupsPropLines(s,n,e),e.writeLine(Kekule.IO.Mdl2kUtils.getCtabPropLineTag("END"))},generateCountLine:function(s){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(s,Kekule.IO.MdlVersion.V2000)},outputAtomBlock:function(s,e,t,n){for(var i=0,r=e.atoms.length;i<r;++i){var a=e.atoms[i],o=this.generateAtomLine(i,e.coordMode,a,n);t.writeLine(o)}},generateAtomLine:function(s,e,t,n){var i=Kekule.IO.Mdl2kUtils.coordToStr,r="",a=(s+1).toString().lpad(3),o=e==Kekule.CoordMode.COORD3D?t.getAbsCoord3D():t.getAbsCoord2D();if(r+=i(o.x).lpad(10)+i(o.y).lpad(10)+i(o.z).lpad(10),r+=" "+Kekule.IO.MdlStructureUtils.getAtomTypeStr(t,!0).rpad(3),Kekule.IO.MdlStructureUtils.isNodeVariableAtom(t)){var l=Kekule.IO.Mdl2kUtils.getAtomListPropLineValue(t);if(l){var u=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("ALS")+" "+a+l;n.push(u)}}t.getMassNumber&&t.getMassNumber()?(r+=(Kekule.IO.Mdl2kUtils.getMassDiff(t.getIsotope())||0).toString().lpad(2),u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,t.getMassNumber().toString().lpad(3)],"ISO",1),n.push(u)):r+="0".lpad(2),r+=Kekule.IO.Mdl2kUtils.chargeOrRadicalToMdlAtomLineValue(t.getCharge?t.getCharge():null,t.getRadical?t.getRadical():null).toString().lpad(3),t.getCharge&&t.getCharge()&&(u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,t.getCharge().toString().lpad(3)],"CHG",1),n.push(u)),t.getRadical&&t.getRadical()&&(u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,Kekule.IO.MdlUtils.kekuleRadicalToMdl(t.getRadical()).toString().lpad(3)],"RAD",1),n.push(u)),r+=(t.getParity&&t.getParity()||0).toString().lpad(3);var c=t.getExplicitHydrogenCount?t.getExplicitHydrogenCount():null;r+=(Kekule.ObjUtils.isUnset(c)?"0":(c+1).toString()).lpad(3);for(var d=0,h="0".lpad(3);d<8;++d)r+=h;return r},outputBondBlock:function(s,e,t){for(var n=0,i=e.bonds.length;n<i;++n){var r=e.bonds[n],a=this.generateBondLine(n,r,e.atoms);t.writeLine(a)}},generateBondLine:function(s,e,t){var n,i,r="";e.getStereo&&e.getBondOrder?n=(i=Kekule.IO.Mdl2kUtils.bondStereoToMdlBondLineValue(e.getStereo(),e.getBondOrder(),!0)).stereo.toString().lpad(3):(i={},n+="0".lpad(3));var a,o,l=Kekule.IO.MdlStructureUtils.splitConnectedNodes(e);return a=(t.indexOf(l.primaryNodes[0])+1).toString().lpad(3),o=(t.indexOf(l.primaryNodes[1])+1).toString().lpad(3),i&&i.inverted?r+=o+a:r+=a+o,e.getBondOrder?r+=Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(e.getBondOrder()).toString().lpad(3):r+="0".lpad(3),r+=n,r+="0".lpad(3),r+="0".lpad(3),r+="0".lpad(3)},outputSubgroupsPropLines:function(s,e,t){for(var n=0,i=e.subGroups.length;n<i;++n)for(var r=this.generateSgroupLines(n,e.subGroups[n],e),a=0,o=r.length;a<o;++a)t.writeLine(r[a])},generateSgroupLines:function(s,e,t){var n=[],i=(s+1).toString().lpad(3),r=Kekule.IO.Mdl2kUtils.generateCtabPropLine([i,"SUP"],"STY",1);n.push(r),r=Kekule.IO.Mdl2kUtils.generateCtabPropLine([i,i],"SLB",1),n.push(r);var a=e.getAbbr&&e.getAbbr()||e.getFormulaText&&e.getFormulaText()||e.getName&&e.getName();a&&(r=Kekule.IO.Mdl2kUtils.generateCtabPropLine([i,a],"SMT"),n.push(r));for(var o=[],l=0,u=(m=e.getLeafNodes()).length;l<u;++l)(s=t.atoms.indexOf(m[l]))>=0&&o.push((s+1).toString().lpad(3));o=o.sort();var c=Kekule.ArrayUtils.divide(o,15);for(l=0,u=c.length;l<u;++l){var d=c[l];r=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SAL")+" "+i+d.length.toString().lpad(3)+" "+d.join(" "),n.push(r)}var h=e.getCrossConnectors(),p=[],g=[],f=Kekule.IO.Mdl2kUtils.coordToStr;for(l=0,u=h.length;l<u;++l)if((s=t.bonds.indexOf(h[l]))>=0){p.push((s+1).toString().lpad(3));var m,C=[s+1],_={};(m=Kekule.IO.MdlStructureUtils.splitConnectedNodes(h[l]).primaryNodes).length==2&&(t.coordMode==Kekule.CoordMode.COORD2D?(_=Kekule.CoordUtils.substract(m[0].getAbsCoord2D(),m[1].getAbsCoord2D()),C=C.concat([f(_.x).lpad(10),f(_.y).lpad(10)])):(_=Kekule.CoordUtils.substract(m[0].getAbsCoord3D(),m[1].getAbsCoord3D()),C=C.concat([f(_.x),f(_.y),f(_.z)]))),g.push(C)}p=p.sort();var y=Kekule.ArrayUtils.divide(p,15);for(l=0,u=y.length;l<u;++l){var T=y[l];r=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBL")+" "+i+T.length.toString().lpad(3)+" "+T.join(" "),n.push(r)}for(l=0,u=g.length;l<u;++l){var E=g[l].shift(),b=g[l].join("");r=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBV")+" "+i+" "+E.toString().lpad(3)+b,n.push(r)}return n}}),Kekule.IO.Mdl3kUtils={get3kBlockStartTag:function(s){return"BEGIN "+s.toUpperCase()},get3kBlockEndTag:function(s){return"END "+s.toUpperCase()},isAtomList:function(s){return s.search(/\[.+\]/)>=0},analysisAtomList:function(s){var e=/\[(.+)\]/g.exec(s);if(e&&e.length>=2){e=e[1].split(",");var t={};t.isAllowList=s.trim().indexOf("NOT")!=0,t.symbols=[];for(var n=0,i=e.length;n<i;++n)t.symbols.push(e[n].trim());return t}return null},bondCfgToKekule:function(s){switch(s){case 0:return Kekule.BondStereo.NONE;case 1:return Kekule.BondStereo.UP;case 2:return Kekule.BondStereo.UP_OR_DOWN;case 3:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}},bondStereoToMdlCfg:function(s,e){var t=Kekule.BondStereo,n={};if(e&&[t.UP_INVERTED,t.DOWN_INVERTED].indexOf(s)>=0&&(n.inverted=!0),n.inverted)s===t.UP_INVERTED?n.cfg=1:s===t.DOWN_INVERTED&&(n.cfg=3);else switch(s){case t.UP:case t.DOWN_INVERTED:n.cfg=1;break;case t.UP_OR_DOWN:n.cfg=2;break;case t.DOWN:case t.UP_INVERTED:n.cfg=3;break;default:n.cfg=0}return n},coordToStr:function(s){return(s||0).toFixed(6)}},Kekule.IO.Mdl3kValueUtils={SEPARATOR:" ",KEYVALUE_CONNECTOR:"=",STR_QUOTE:'"',ESC_QUOTE:'""',VALUELIST_PATTERN:/\(.+\)/g,split:function(s,e){for(var t=e||Kekule.IO.Mdl3kValueUtils.SEPARATOR,n=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,i=[],r=!1,a=!1,o=!1,l="",u=0,c=s.length;u<c;++u){var d=s.charAt(u);d==n?!r&&s.charAt(u+1)==n||r&&s.charAt(u-1)==n||(r=!r):d=="["?a=!0:d=="]"?a=!1:d=="("?o=!0:d==")"&&(o=!1),d==t?r||a||o||!l?l+=d:(i.push(l),l=""):l+=d}return l&&i.push(l),i},merge:function(s,e){var t=e||Kekule.IO.Mdl3kValueUtils.SEPARATOR;return s.join(t)},isKeyValuePair:function(s){return s.indexOf(Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR)>=0},splitKeyValue:function(s){var e={},t=Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR,n=s.indexOf(t);return n<0?e.value=s:(e.key=s.substr(0,n),e.value=s.substr(n+t.length)),e},mergeKeyValue:function(s,e){return e?""+e+Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR+s:s},isValueList:function(s){return s.search(Kekule.IO.Mdl3kValueUtils.VALUELIST_PATTERN)>=0},splitValueList:function(s){var e=/\((.+)\)/.exec(s);if(e&&e.length>1){var t=e[1],n=Kekule.IO.Mdl3kValueUtils.split(t);return n.shift(),n}return[s]},mergeValueList:function(s){for(var e="("+s.length,t=0,n=s.length;t<n;++t)e+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+s[t];return e+=")"},unquoteValue:function(s){var e=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,t=s.trim();t.substr(0,e.length)==e&&(t=t.substr(e.length)),t.substr(t.length-e.length)==e&&(t=t.substr(0,t.length-e.length));var n=new RegExp(e+e,"g");return t=t.replace(n,e),Kekule.IO.Mdl3kValueUtils.isValueList(t)&&(t=Kekule.IO.Mdl3kValueUtils.splitValueList(t)),t},quoteValue:function(s){var e=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,t=""+s,n=new RegExp(e,"g");return(t=t.replace(n,e+e)).indexOf(Kekule.IO.Mdl3kValueUtils.SEPARATOR)>=0&&(t=e+t+e),t},splitValues:function(s){for(var e=[],t=Kekule.IO.Mdl3kValueUtils.split(s),n=0,i=t.length;n<i;++n){var r=Kekule.IO.Mdl3kValueUtils.splitKeyValue(t[n]);r.value&&(r.value=Kekule.IO.Mdl3kValueUtils.unquoteValue(r.value)),e.push(r)}return e},mergeValues:function(s){for(var e,t=0,n=s.length;t<n;++t){var i,r,a,o=s[t];typeof o!="object"||Kekule.ArrayUtils.isArray(o)?r=o:(i=o.key,r=o.value),a=Kekule.ArrayUtils.isArray(r)?Kekule.IO.Mdl3kValueUtils.mergeValueList(r):Kekule.IO.Mdl3kValueUtils.quoteValue(r),i&&(a=Kekule.IO.Mdl3kValueUtils.mergeKeyValue(a,i)),e=Kekule.IO.Mdl3kValueUtils.appendToken(e,a)}return e},appendToken:function(s,e,t){var n=t||Kekule.IO.Mdl3kValueUtils.SEPARATOR,i=s||"";return i&&i.substr(i.length-n.length,n.length)!=n?i+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+e:i=e,i}},Kekule.IO.Mdl3kTextBuffer=Class.create(Kekule.TextLinesBuffer,{CLASS_NAME:"Kekule.Mdl3kTextBuffer",LEADING_TAG:"M  V30 ",LINE_CONTI_MARK:"-",MAX_COL_WIDTH:80,initialize:function(s){this.tryApplySuper("initialize",[s])},isStartWithLeadingTag:function(s){return s.substr(0,this.LEADING_TAG.length)==this.LEADING_TAG},isEndWithContinueMark:function(s){var e=s.trim();return e.substr(e.length-this.LINE_CONTI_MARK.length)==this.LINE_CONTI_MARK},getLineWithout3kTag:function(s){if(!s)return s;var e=this.LEADING_TAG.length;return s.substr(0,e)==this.LEADING_TAG?s.substr(e):s},getLineAtEx:function(s){var e=this.getLineAt(s),t=1;if(e&&this.isEndWithContinueMark(e)&&this.isStartWithLeadingTag(this.getLines()[s])){var n=e.lastIndexOf(this.LINE_CONTI_MARK);e=e.substr(0,n);var i=this.getLineAtEx(s+1);e+=i.line,t+=i.lineCount}return{line:e,lineCount:t}},getLineAt:function(s){var e=this.tryApplySuper("getLineAt",[s]);return this.getLineWithout3kTag(e)},readLine:function(){var s=this.getLineAtEx(this.getCurrLineNo());return this.incCurrLineNo(s.lineCount),s.line||""},writeLine:function(s,e){if(e)return this.tryApplySuper("writeLine",[s]);var t,n=s;if(this.isStartWithLeadingTag(s)||(n=this.LEADING_TAG+n),n.length>this.MAX_COL_WIDTH){var i=this.LINE_CONTI_MARK,r=(Kekule.IO.Mdl3kValueUtils.SEPARATOR,this.MAX_COL_WIDTH-i.length);t=n.substr(r),n=n.substr(0,r),n+=i}var a=this.tryApplySuper("writeLine",[n]);return t&&(a=this.writeLine(t,e)),a},writeLines:function(s,e){for(var t=0,n=s.length;t<n;++t)this.writeLine(s[t],e)},getBlockBuffer:function(s,e){for(var t,n=Kekule.IO.Mdl3kUtils.get3kBlockStartTag(s),i=Kekule.IO.Mdl3kUtils.get3kBlockEndTag(s),r=this.getCurrLineNo(),a=this.readLine().trim();a!=n&&!this.eof();)a=this.readLine().trim();if(this.eof())t=null;else{var o=this.getCurrLineNo(),l=this.getCurrLineNo();for(a=this.readLine().trim();a!=i&&!this.eof();)l=this.getCurrLineNo(),a=this.readLine().trim();if(a==i)var u=this.getLines().slice(o,l);else u=this.getLines().slice(o);t=new Kekule.IO.Mdl3kTextBuffer(u)}return e&&this.setCurrLineNo(r),t}}),Kekule.IO.Mdl3kBlockReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kBlockReader",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},doReadBlock:function(s,e){var t,n=!(s instanceof Kekule.IO.Mdl3kTextBuffer);n?(t=new Kekule.IO.Mdl3kTextBuffer).setLines(s.getUnreadLines()):t=s;var i=t.getCurrLineNo(),r=this.doRead3kBlock(t,e),a=t.getCurrLineNo();if(n){var o=a-i;s.incCurrLineNo(o)}return r},doRead3kBlock:function(s,e){}}),Kekule.IO.Mdl3kBlockWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kBlockWriter",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},writeStartTag:function(s,e){e.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockStartTag(s))},writeEndTag:function(s,e){e.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockEndTag(s))},doWriteBlock:function(s,e){var t,n=!(e instanceof Kekule.IO.Mdl3kTextBuffer);n?((t=new Kekule.IO.Mdl3kTextBuffer).setLines(e.getUnreadLines()),t.reset()):t=e;var i=this.doWrite3kBlock(s,t);return n&&e.appendLines(n.getLines()),i},doWrite3kBlock:function(s,e){}}),Kekule.IO.Mdl3kCTabReader=Class.create(Kekule.IO.Mdl3kBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kCTabReader",doRead3kBlock:function(s,e){var t=s.getBlockBuffer("CTAB");return t||(t=s).reset(),this.analysisCTab(t)},analysisCTab:function(s){var e={},t=s.readLine(),n=this.analysisCountLine(t);if(!n)return null;var i,r,a=[],o=s.getBlockBuffer("ATOM");if(!o)return Kekule.raise(Kekule.$L("ErrorMsg.MDL3000_ATOMBLOCK_NOT_FOUND")),null;i=this.analysisAtomBlock(o,a);var l,u=s.getBlockBuffer("BOND");u&&(r=this.analysisBondBlock(u,a));var c=s.getBlockBuffer("SGROUP");return c&&(l=this.analysisSGroupBlock(c,a)),e.countInfo=n,e.atomInfos=i,e.atomIndexMap=a,r&&(e.bondInfos=r),l&&(e.sgInfos=l),e},analysisCountLine:function(s){var e={},t=Kekule.IO.Mdl3kValueUtils.splitValues(s);if(t.shift().value=="COUNTS"){var n=t.shift().value;return e.atomCount=parseInt(n,10),n=t.shift().value,e.bondCount=parseInt(n,10),n=t.shift().value,e.sgroupCount=parseInt(n,10),n=t.shift().value,e.isChiral=parseInt(n,10)!=0,e}Kekule.raise(Kekule.$L("ErrorMsg.MALFORMED_MDL3000_COUNTLINE"))},analysisAtomBlock:function(s,e){for(var t=Kekule.CoordMode.COORD2D,n=[];!s.eof();){var i=s.readLine(),r=this.analysisAtomLine(i),a=n.push(r)-1;e[r.index]=a,r.z&&(t=Kekule.CoordMode.COORD3D)}return n.coordMode=t,n.isCoord3D=t==Kekule.CoordMode.COORD3D,n},analysisAtomLine:function(s,e){var t={},n=Kekule.IO.Mdl3kValueUtils.splitValues(s);t.index=parseInt(n.shift().value,10);var i=n.shift().value.trim();if(Kekule.IO.Mdl3kUtils.isAtomList(i)){var r=Kekule.IO.Mdl3kUtils.analysisAtomList(i);r&&(t.atomListInfo=r,t.symbol="L")}else t.symbol=i;t.x=parseFloat(n.shift().value),t.y=parseFloat(n.shift().value),t.z=parseFloat(n.shift().value),n.shift();for(var a=0,o=n.length;a<o;++a){var l=n[a],u=l.key,c=l.value;switch(u){case"CHG":(d=parseInt(c,10))&&(t.charge=d);break;case"RAD":(d=parseInt(c,10))&&(t.radical=d);break;case"CFG":(d=parseInt(c,10))&&(t.parity=d);break;case"MASS":t.massNumber=parseFloat(c);break;case"VAL":break;case"HCOUNT":(d=parseInt(c,10))&&(t.hydrongenCount=d==-1?0:d-1);break;case"RGROUPS":var d;(d=parseInt(c,10))&&(t.rgroupCount=d)}}return t},analysisBondBlock:function(s,e){for(var t=[];!s.eof();){var n=s.readLine(),i=this.analysisBondLine(n,e);t[i.index]=i}return t},analysisBondLine:function(s,e){var t={},n=Kekule.IO.Mdl3kValueUtils.splitValues(s);t.index=parseInt(n.shift().value,10);var i=n.shift().value;t.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(i,10)),t.atomIndex1=e[parseInt(n.shift().value,10)],t.atomIndex2=e[parseInt(n.shift().value,10)];for(var r=0,a=n.length;r<a;++r){var o=n[r].key,l=n[r].value;switch(o){case"CFG":var u=parseInt(l,10);t.stereo=Kekule.IO.Mdl3kUtils.bondCfgToKekule(u);break;case"ENDPTS":if(Kekule.ArrayUtils.isArray(l)){t.endAtomIndexes=[];for(var c=0,d=l.length;c<d;++c)t.endAtomIndexes.push(e[parseInt(l[c],10)])}else t.endAtomIndexes=[e[parseInt(l,10)]]}}return t},analysisSGroupBlock:function(s,e){var t=[],n=null,i=s.getCurrLineNo(),r=s.readLine();for(Kekule.IO.Mdl3kValueUtils.splitValues(r).shift().value=="DEFAULT"?n=this.fetchSGroupOptionalValues(r,e):s.setCurrLineNo(i);!s.eof();){r=s.readLine();var a=this.analysisSGroupLine(r,e,n);t[a.index]=a}return t},analysisSGroupLine:function(s,e,t){var n={},i=Kekule.IO.Mdl3kValueUtils.splitValues(s);n.index=parseInt(i.shift().value,10),n.sgType=i.shift().value.trim(),n.extIndex=parseInt(i.shift().value,10);var r=this.fetchSGroupOptionalValues(i,e);return t&&(r=Object.extend(t,r)),n=Object.extend(n,r)},fetchSGroupOptionalValues:function(s,e){for(var t={},n=0,i=s.length;n<i;++n){var r=s[n].key,a=s[n].value;switch(r){case"ATOMS":t.atomIndexes=[];for(var o=0,l=a.length;o<l;o++)t.atomIndexes.push(e[a[o]]);break;case"XBONDS":t.crossBondIndexes=[].concat(a);break;case"SUBTYPE":t.subType=a;break;case"LABEL":t.label=a;break;case"CSTATE":t.bondVectors||(t.bondVectors=[]);var u=parseInt(a.shift(),10),c=parseFloat(a.shift())||0,d=parseFloat(a.shift())||0,h=parseFloat(a.shift())||0;t.bondVectors[u]={bondIndex:u,x:c,y:d,z:h};break;case"CLASS":t.sgClass=a}}return t}}),Kekule.IO.Mdl3kCTabWriter=Class.create(Kekule.IO.Mdl3kBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kCTabWriter",initialize:function(s){this.tryApplySuper("initialize"),this.setCoordMode(s||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWrite3kBlock:function(s,e){return Kekule.IO.MdlUtils.assertIlegalForCtabOutput(s),this.outputCtab(s,e)},outputCtab:function(s,e){var t=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(s);this.writeStartTag("CTAB",e),this.getCoordMode()!=Kekule.CoordMode.UNKNOWN&&(t.coordMode=this.getCoordMode()),e.writeLine(this.generateCountLine(t)),this.outputAtomBlock(s,t,e),this.outputBondBlock(s,t,e),this.outputSgroupBlock(s,t,e),this.writeEndTag("CTAB",e)},generateCompatibilityCountLine:function(s){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(s,Kekule.IO.MdlVersion.V3000)},generateCountLine:function(s){var e=["COUNTS"];return e.push(s.atoms.length),e.push(s.bonds.length),e.push(s.subGroups.length),e.push(0),e.push(0),Kekule.IO.Mdl3kValueUtils.mergeValues(e)},outputAtomBlock:function(s,e,t){this.writeStartTag("ATOM",t);for(var n=0,i=e.atoms.length;n<i;++n){var r=e.atoms[n],a=this.generateAtomLine(n,e.coordMode,r);t.writeLine(a)}this.writeEndTag("ATOM",t)},generateAtomLine:function(s,e,t){var n=Kekule.IO.Mdl3kUtils.coordToStr,i=[s+1,Kekule.IO.MdlStructureUtils.getAtomTypeStr(t)];if(e==Kekule.CoordMode.COORD2D){var r=t.getAbsCoord2D();i=i.concat([n(r.x),n(r.y),n(0)])}else r=t.getAbsCoord3D(),i=i.concat([n(r.x),n(r.y),n(r.z)]);return i.push(0),t.getCharge&&t.getCharge()&&i.push({key:"CHG",value:t.getCharge()}),t.getRadical&&t.getRadical()&&i.push({key:"RAD",value:t.getRadical()}),t.getParity&&t.getParity()&&i.push({key:"CFG",value:t.getParity()}),t.getMassNumber&&t.getMassNumber()&&i.push({key:"MASS",value:t.getMassNumber()}),t.getExplicitHydrogenCount&&!Kekule.ObjUtils.isUnset(t.getExplicitHydrogenCount())&&i.push({key:"HCOUNT",value:t.getExplicitHydrogenCount()+1}),Kekule.IO.Mdl3kValueUtils.mergeValues(i)},outputBondBlock:function(s,e,t){if(!(e.bonds.length<=0)){this.writeStartTag("BOND",t);for(var n=0,i=e.bonds.length;n<i;++n){var r=e.bonds[n],a=this.generateBondLine(n,r,e.atoms);t.writeLine(a)}this.writeEndTag("BOND",t)}},generateBondLine:function(s,e,t){var n=[s+1,Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(e.getBondOrder?e.getBondOrder():Kekule.BondOrder.UNSET)],i=e.getStereo&&e.getStereo()?Kekule.IO.Mdl3kUtils.bondStereoToMdlCfg(e.getStereo(),!0):{},r=[],a=[],o=Kekule.IO.MdlStructureUtils.splitConnectedNodes(e),l=t.indexOf(o.primaryNodes[0])+1,u=t.indexOf(o.primaryNodes[1])+1;if(r=i.inverted?[u,l]:[l,u],o.remainNodes&&o.remainNodes.length)for(var c=0,d=o.remainNodes.length;c<d;++c)a.push(t.indexOf(o.remainNodes[c])+1);return n=n.concat(r),i&&i.cfg&&n.push({key:"CFG",value:i.cfg}),a.length>0&&(n.push({key:"ENDPTS",value:a}),n.push({key:"ATTACH",value:"ALL"})),Kekule.IO.Mdl3kValueUtils.mergeValues(n)},outputSgroupBlock:function(s,e,t){if(!(e.subGroups.length<=0)){this.writeStartTag("SGROUP",t);for(var n=0,i=e.subGroups.length;n<i;++n){var r=this.generateSgroupLine(n,e.subGroups[n],e);t.writeLine(r)}this.writeEndTag("SGROUP",t)}},generateSgroupLine:function(s,e,t){for(var n=t.atoms,i=t.bonds,r=[s+1,"SUP",s+1],a=[],o=0,l=(g=e.getLeafNodes()).length;o<l;++o)(s=n.indexOf(g[o]))>=0&&a.push(s+1);a=a.sort(),r.push({key:"ATOMS",value:a});var u=e.getAbbr&&e.getAbbr()||e.getFormulaText&&e.getFormulaText()||e.getName&&e.getName();u&&r.push({key:"LABEL",value:u});var c=e.getCrossConnectors(),d=[],h=[],p=Kekule.IO.Mdl3kUtils.coordToStr;for(o=0,l=c.length;o<l;++o)if((s=i.indexOf(c[o]))>=0){d.push(s+1);var g,f=[s+1],m={};(g=Kekule.IO.MdlStructureUtils.splitConnectedNodes(c[o]).primaryNodes).length==2&&(t.coordMode==Kekule.CoordMode.COORD2D?(m=Kekule.CoordUtils.substract(g[0].getAbsCoord2D(),g[1].getAbsCoord2D()),f=f.concat([p(m.x),p(m.y),0])):(m=Kekule.CoordUtils.substract(g[0].getAbsCoord3D(),g[1].getAbsCoord3D()),f=f.concat([p(m.x),p(m.y),p(m.z)]))),h.push(f)}for(d=d.sort(),r.push({key:"XBONDS",value:d}),o=0,l=h.length;o<l;++o)r.push({key:"CSTATE",value:h[o]});return Kekule.IO.Mdl3kValueUtils.mergeValues(r)}}),Kekule.globalOptions.add("IO.mdl",{mdlVersion:Kekule.IO.MdlVersion.V2000,coordMode:Kekule.CoordMode.UNKNOWN}),Kekule.IO.MdlStructureFragmentReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentReader",initialize:function(s){this.tryApplySuper("initialize"),this.setCoordMode(s||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createFragment:function(s){},createCtabReader:function(s){return s==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kCTabReader:new Kekule.IO.Mdl2kCTabReader},getCtabVersion:function(s){var e=s.getCurrLineNo(),t=s.readLine();s.setCurrLineNo(e);var n=t.substr(33,6).trim();return n=="V3000"?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000},createStructureFromJson:function(s,e){var t=this.createFragment();return t&&Kekule.IO.MdlStructureUtils.fillFragment(t,s,this.getCoordMode()),t},doReadBlock:function(s,e){var t=this.getCtabVersion(s);if(!t)return null;var n=this.createCtabReader(t).doReadBlock(s,e);return n.atomInfos.coordMode&&(this._forceCoordMode=n.atomInfos.coordMode),this.createStructureFromJson(n,e)}}),Kekule.IO.MdlStructureFragmentWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentWriter",initialize:function(s,e){this.tryApplySuper("initialize"),this.setMdlVersion(s||Kekule.IO.MdlVersion.V2000),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createCtabWriter:function(s){return s==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode()):new Kekule.IO.Mdl2kCTabWriter(this.getCoordMode())},doWriteBlock:function(s,e){var t=this.createCtabWriter(this.getMdlVersion()).writeBlock(s);e.writeText(t)}}),Kekule.IO.Mdl3kMoleculeCTabReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabReader",createFragment:function(s){return new Kekule.Molecule},doReadBlock:function(s,e){var t=this.createCtabReader(Kekule.IO.MdlVersion.V3000).doReadBlock(s,e);return this.createStructureFromJson(t,e)}}),Kekule.IO.Mdl3kMoleculeCTabWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabWriter",initialize:function(s){this.tryApplySuper("initialize",[Kekule.IO.MdlVersion.V3000,s])},doWriteBlock:function(s,e){var t=new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode()).writeBlock(s);e.writeText(t)}}),Kekule.IO.MdlMoleculeReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.MdlMoleculeReader",createFragment:function(s){return new Kekule.Molecule},readHeaderInfo:function(s,e){var t={},n=s.readLine();n&&(t.name=n);var i=s.readLine(),r=this.readInfoLine(i);r&&(t=Object.extend(t,r));var a=s.readLine();return a&&(t.comment=a),t},readInfoLine:function(s){var e={};if(s.trim()){var t=s.substr(0,2).trim();t&&(e.userAbbr=t),(t=s.substr(2,8).trim())&&(e.programName=t),(t=s.substr(10,10)).trim()&&(e.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(t,!1)),t=s.substr(20,2),e.coordMode=t=="3D"?Kekule.CoordMode.COORD3D:t=="2D"?Kekule.CoordMode.COORD2D:Kekule.CoordMode.UNKNOWN}return e},doReadBlock:function(s,e){var t=this.readHeaderInfo(s,e);t&&t.coordMode!==void 0&&this.setCoordMode(t.coordMode);var n=this.tryApplySuper("doReadBlock",[s,e]);return n&&t&&(t.name&&n.setName(t.name),t.userAbbr&&n.setInfoValue("author",t.userAbbr),t.programName&&n.setInfoValue("generator",t.programName),t.date&&n.setInfoValue("date",t.date),t.comment&&n.setInfoValue("comment",t.comment)),s.eof()||s.getCurrLine().trim().toUpperCase()==="M  END"&&s.readLine(),n}}),Kekule.IO.MdlMoleculeWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.MdlMoleculeWriter",writeHeaderInfo:function(s,e){e.writeLine(s.getName()||Kekule.$L("Texts.UNNAMED")||"");var t=this.generateInfoLine(s);e.writeLine(t);var n=s.getInfoValue("comment");e.writeLine(n||"")},generateInfoLine:function(s){var e="",t=s.getInfoValue("author");e+=t?t.toString().substr(0,2).rpad(2):"  ";var n=s.getInfoValue("generator");e+=n?n.toString().substr(0,8).rpad(8):Kekule.LIBNAME_CORE.rpad(8);var i=s.getInfoValue("date")||new Date;return e+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(i,!1),e+=this.getCoordMode()==Kekule.CoordMode.COORD3D?"3D":"2D"},getMolecule:function(s){return Kekule.ChemStructureUtils.getTotalStructFragment(s)},doWriteBlock:function(s,e){var t=this.getMolecule(s);if(t){var n=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(t);this.setCoordMode(n.coordMode),this.writeHeaderInfo(t,e),this.getMdlVersion()==Kekule.IO.MdlVersion.V3000&&e.writeLine(Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(n,this.getMdlVersion())),this.tryApplySuper("doWriteBlock",[t,e]),this.getMdlVersion()==Kekule.IO.MdlVersion.V3000&&e.writeLine("M  END")}}}),Kekule.IO.MdlStructDataReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructDataReader",DATA_HEAD_PREFIX:Kekule.IO.MDL.SD_DATA_HEAD_PREFIX,DATA_DBFIELD_PATTERN:/\bDT(\d+)\b/,DATA_KEY_NAME_PATTERN:/\<(.+)\>/,MOL_DELIMITER:Kekule.IO.MDL.MOL_DELIMITER,doReadBlock:function(s,e){var t=new Kekule.IO.MdlMoleculeReader;try{for(var n,i,r,a=[];!s.eof();){try{r=t.doReadBlock(s,null)}catch{r=null}if(!r)break;for(a.push(r),n=null,i=null;!s.eof();){var o=this.analysisDataLine(s.readLine());if(o){var l=o.lineType;if(l==="dataheader")n=o.key;else if(l==="datavalue")n&&(i=o.value,r.setInfoValue(n,i));else if(l==="moldelimiter")break}}}if(a.length>1){for(var u=new Kekule.ChemObjList,c=0,d=a.length;c<d;++c)u.append(a[c]);return u}return a[0]}finally{t.finalize()}},analysisDataLine:function(s){var e,t=s.trim();return t.startsWith(this.DATA_HEAD_PREFIX)?(e=this.getDataHeaderKey(s))?{lineType:"dataheader",key:e}:null:t.startsWith(this.MOL_DELIMITER)?{lineType:"moldelimiter"}:t?{lineType:"datavalue",value:s}:null},getDataHeaderKey:function(s){var e=this.DATA_KEY_NAME_PATTERN.exec(s);return e&&e.length>1||(e=this.DATA_DBFIELD_PATTERN.exec(s))&&e.length>1?e[1]:s},doReadDataBlock:function(s,e){s.readLine()}}),Kekule.IO.MdlStructDataWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructDataWriter",IGNORED_INFO_FIELDS:["generator","author","date","comment"],initialize:function(s,e){this.tryApplySuper("initialize"),this.setMdlVersion(s||Kekule.IO.MdlVersion.V2000),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(s,e){var t=this.getChildMols(s),n=new Kekule.IO.MdlMoleculeWriter;n.setMdlVersion(this.getMdlVersion()),n.setCoordMode(this.getCoordMode());for(var i=0,r=t.length;i<r;++i){var a=t[i];try{var o=n.writeBlock(a);e.writeText(o);var l=this.getMolData(a);this.doWriteDataBlock(l,e),e.writeLine(Kekule.IO.MDL.MOL_DELIMITER)}catch{}}},doWriteDataBlock:function(s,e){for(var t=Kekule.ObjUtils.getOwnedFieldNames(s),n=0,i=t.length;n<i;++n){var r=t[n];if(this.IGNORED_INFO_FIELDS.indexOf(r)<0){var a=Kekule.IO.MDL.SD_DATA_HEAD_PREFIX+" <"+r+">",o=s[r];a&&o&&(e.writeLine(a),e.writeLine(o),e.writeLine(""))}}},getChildMols:function(s){for(var e=Kekule.ChemStructureUtils.getChildStructureObjs(s,!0),t=[],n=0,i=e.length;n<i;++n){var r=e[n];r instanceof Kekule.StructureFragment&&t.push(r)}return t},getMolData:function(s){return s.getInfo?s.getInfo()||{}:null}}),Kekule.IO.MdlBaseReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlBaseReactionReader",readHeaderBlock:function(s,e){var t,n={},i=s.readLine().trim();return(t=i.substr(0,4))!="$RXN"?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL_RXN_DATA")),null):(t=i.substr(4).trim(),n.version=t=="V3000"?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000,(i=s.readLine().trim())&&(n.name=i),(t=(i=s.readLine()).substr(0,6).trim())&&(n.userAbbr=t),(t=i.substr(6,9).trim())&&(n.programName=t),(t=i.substr(15,10)).trim()&&(n.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(t,!0)),(i=s.readLine().trim())&&(n.comment=i),n)},readSubstanceCountLine:function(s){},readMolBlock:function(s){},doReadBlock:function(s,e){for(var t=this.readHeaderBlock(s,null),n=this.readSubstanceCountLine(s.readLine()),i=new Kekule.Reaction,r=0;r<n.reactantCount;++r)(a=this.readMolBlock(s))&&i.appendReactant(a);for(r=0;r<n.productCount;++r){var a;(a=this.readMolBlock(s))&&i.appendProduct(a)}return i&&t&&(t.name&&i.setName(t.name),t.userAbbr&&i.setInfoValue("author",t.userAbbr),t.programName&&i.setInfoValue("generator",t.programName),t.date&&i.setInfoValue("date",t.date),t.comment&&i.setInfoValue("comment",t.comment)),i}}),Kekule.IO.Mdl2kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl2kReactionReader",readHeaderBlock:function(s,e){var t=this.tryApplySuper("readHeaderBlock",[s,e]);return t.version!=Kekule.IO.MdlVersion.V2000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_RXN_DATA")),null):t},readSubstanceCountLine:function(s){var e={};return e.reactantCount=parseInt(s.substr(0,3),10)||0,e.productCount=parseInt(s.substr(3,3),10)||0,e},readMolBlock:function(s){for(var e=s.readLine();e!=="$MOL"&&!s.eof();)e=s.readLine();if(s.eof())return null;var t=[];for(e=s.getCurrLine();e!=="$MOL"&&!s.eof();)t.push(e),s.incCurrLineNo(),e=s.getCurrLine();return new Kekule.IO.MdlMoleculeReader().readBlock(t,null)}}),Kekule.IO.Mdl3kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl3kReactionReader",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},readHeaderBlock:function(s,e){var t=this.tryApplySuper("readHeaderBlock",[s,e]);return t.version!=Kekule.IO.MdlVersion.V3000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_DATA")),null):t},readSubstanceCountLine:function(s){var e={},t=Kekule.IO.Mdl3kValueUtils.splitValues(s);return t.shift().value.trim()!="COUNTS"?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_COUNTLINE")),null):(e.reactantCount=parseInt(t.shift().value,10)||0,e.productCount=parseInt(t.shift().value,10)||0,e)},readMolBlock:function(s){if(s.getBlockBuffer){var e=s.getBlockBuffer("CTAB");return new Kekule.IO.Mdl3kMoleculeCTabReader().doReadBlock(e)}return null}}),Kekule.IO.MdlReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlReactionReader",doReadBlock:function(s,e){return(Kekule.IO.MdlUtils.getRxnMarkVersion(s.getCurrLine())==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kReactionReader:new Kekule.IO.Mdl2kReactionReader).readBlock(s.getUnreadLines(),e)}}),Kekule.IO.MdlReactionWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlReactionWriter",initialize:function(s,e){this.tryApplySuper("initialize"),this.setMdlVersion(s||Kekule.IO.MdlVersion.V2000),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},writeHeaderBlock:function(s,e){var t;t="$RXN"+(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?" "+Kekule.IO.MDL.VER3000:""),e.writeLine(t),e.writeLine(s.getName()||""),t=(s.getInfoValue("author")||"").substr(0,6).rpad(6),t+=(s.getInfoValue("generator")||"").substr(0,9).rpad(9);var n=s.getInfoValue("date")||new Date;t+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(n,!0),e.writeLine(t);var i=s.getInfoValue("comment")||"";e.writeLine(i)},generateSubstanceCountLine:function(s){return this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?"M  V30 COUNTS "+Kekule.IO.Mdl3kValueUtils.mergeValues([s.getReactantCount(),s.getProductCount()]):s.getReactantCount().toString().lpad(3)+s.getProductCount().toString().lpad(3)},writeMolDelimiterLine:function(s){this.getMdlVersion()==Kekule.IO.MdlVersion.V2000&&s.writeLine("$MOL")},writeMolBlock:function(s,e){var t=(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kMoleculeCTabWriter(this.getCoordMode()):new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode())).writeBlock(s);e.writeText(t)},doWriteBlock:function(s,e){var t=this.getMdlVersion()==Kekule.IO.MdlVersion.V3000;this.writeHeaderBlock(s,e);var n=this.generateSubstanceCountLine(s);e.writeLine(n),t&&e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("REACTANT"));for(var i=0;i<s.getReactantCount();++i)this.writeMolDelimiterLine(e),this.writeMolBlock(s.getReactantAt(i),e);for(t&&e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("REACTANT")),t&&e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("PRODUCT")),i=0;i<s.getProductCount();++i)this.writeMolDelimiterLine(e),this.writeMolBlock(s.getProductAt(i),e);t&&(e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("PRODUCT")),e.writeLine("M  END"))}}),Kekule.IO.BaseMdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.BaseMdlReader",doReadData:function(s,e,t){return e!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):this.doReadMdlData(s)},doReadMdlData:function(s){return null}}),Kekule.IO.BaseMdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.BaseMdlWriter",initialize:function(s){this.tryApplySuper("initialize",[s]),s||(s={}),this.setMdlVersion(s.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(s.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function(s,e,t){var n=e||Kekule.IO.ChemDataType.TEXT;return n!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_OUTPUT_DATATYPE_NOT_TEXT")),null):this.tryApplySuper("doWriteData",[s,n,t])}}),Kekule.IO.MdlMolReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlMolReader",doReadMdlData:function(s){return new Kekule.IO.MdlMoleculeReader().readBlock(s,null)}}),Kekule.IO.MdlMolWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlMolWriter",doWriteData:function(s,e,t){return new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(s)}}),Kekule.IO.MdlSdReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlSdReader",doReadMdlData:function(s){return new Kekule.IO.MdlStructDataReader().readBlock(s,null)}}),Kekule.IO.MdlSdWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlSdWriter",doWriteData:function(s,e,t){return new Kekule.IO.MdlStructDataWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(s)}}),Kekule.IO.MdlRxnReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlRxnReader",doReadMdlData:function(s){return new Kekule.IO.MdlReactionReader().readBlock(s,null)}}),Kekule.IO.MdlRxnWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlRxnWriter",doWriteData:function(s,e,t){return new Kekule.IO.MdlReactionWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(s)}}),Kekule.IO.MdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.MdlReader",doReadData:function(s,e,t){return e!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):(s.substr(0,4)=="$RXN"?new Kekule.IO.MdlReactionReader:new Kekule.IO.MdlMoleculeReader).readBlock(s,null)}}),Kekule.IO.MdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.MdlWriter",initialize:function(s){this.tryApplySuper("initialize",[s]);var e=s||{};this.setMdlVersion(e.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(e.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function(s,e,t){var n;if(s instanceof Kekule.Reaction)n=new Kekule.IO.MdlRxnWriter(this.getMdlVersion(),this.getCoordMode());else{if(!(s instanceof Kekule.StructureFragment)){var i=s&&s.getClassName?s.getClassName():typeof s;return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_MDL").format(i)),null}n=new Kekule.IO.MdlMolWriter(this.getMdlVersion(),this.getCoordMode())}if(n)return n.writeData(s)}}),function(){Kekule.IO.DataFormat.MOL="mol",Kekule.IO.DataFormat.RXN="rxn",Kekule.IO.DataFormat.SD="sd",Kekule.IO.DataFormat.MOL3K="mol3k",Kekule.IO.DataFormat.RXN3K="rxn3k",Kekule.IO.MimeType.MDL_MOL="chemical/x-mdl-molfile",Kekule.IO.MimeType.MDL_RXN="chemical/x-mdl-rxnfile",Kekule.IO.MimeType.MDL_SD="chemical/x-mdl-sdfile",Kekule.IO.DataFormatsManager.register("mol",Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 2000 format"),Kekule.IO.DataFormatsManager.register("rxn",Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 2000 format"),Kekule.IO.DataFormatsManager.register("sd",Kekule.IO.MimeType.MDL_SD,["sd","sdf"],Kekule.IO.ChemDataType.TEXT,"MDL Structure-Data format"),Kekule.IO.DataFormatsManager.register("mol3k",Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 3000 format"),Kekule.IO.DataFormatsManager.register("rxn3k",Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 3000 format"),Kekule.IO.ChemDataReaderManager.register("MDL-mol",Kekule.IO.MdlMolReader,["mol","mol3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-rxn",Kekule.IO.MdlRxnReader,["rxn","rxn3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-general",Kekule.IO.MdlReader,["mol","mol3k","rxn","rxn3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-sd",Kekule.IO.MdlSdReader,"sd");var s=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("MDL-mol",Kekule.IO.MdlMolWriter,s,"mol"),Kekule.IO.ChemDataWriterManager.register("MDL-mol3k",Kekule.IO.MdlMolWriter,s,"mol3k",{createOptions:{mdlVersion:Kekule.IO.MdlVersion.V3000}}),Kekule.IO.ChemDataWriterManager.register("MDL-rxn",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],"rxn"),Kekule.IO.ChemDataWriterManager.register("MDL-rxn3k",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],"rxn3k"),Kekule.IO.ChemDataWriterManager.register("MDL-sd",Kekule.IO.MdlSdWriter,s,"sd")}(),function(){var s=Kekule.ArrayUtils;Kekule.IO.SMILES={ATOM_BRACKET_LEFT:"[",ATOM_BRACKET_RIGHT:"]",ATOM_WILDCARD:"*",ATOM_H:"H",ORGAN_SUBSET_ATOMS:["B","C","N","O","S","P","F","Cl","Br","I"],AROMATIC_SUBSET_ATOMS:["B","C","N","O","S","P"],BOND_SINGLE:"-",BOND_DOUBLE:"=",BOND_TRIPLE:"#",BOND_QUAD:"$",BOND_AROMATIC:":",BOND_FAKE:".",RING_BOND_TWO_DIGIT_NO_PREFIX:"%",BRANCH_BRACKET_LEFT:"(",BRANCH_BRACKET_RIGHT:")",ROTATION_DIR_CLOCKWISE:"@@",ROTATION_DIR_ANTICLOCKWISE:"@",DIRECTION_BOND_SYMBOLS:["/","\\"]};var e=Kekule.IO.SMILES;Kekule.IO.SmilesUtils={createGraphDepthSpanningTreesEx:function(n,i){for(var r=function(p){var g={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}},f=p;f.getData("__$visitedEx__")||(g.vertexes.push(f),f.setData("__$visitedEx__",!0));for(var m,C=f.getEdges(),_=0,y=C.length;_<y;++_){var T=C[_],E=f.getNeighborOnEdge(T);if(!E.getData("__$visitedEx__")){g.vertexes.push(E),g.edges.push(T),E.setData("__$visitedEx__",!0);var b=r(E);g.vertexes=g.vertexes.concat(b.vertexes),g.edges=g.edges.concat(b.edges),(b.longestPath.length>g.longestPath.length||!g.longestPath.length)&&(g.longestPath.vertexes=b.longestPath.vertexes,g.longestPath.edges=b.longestPath.edges,g.longestPath.length=b.longestPath.length,m=T)}}return m&&(g.longestPath.edges.unshift(m),g.longestPath.length=(g.longestPath.length||0)+1),g.longestPath.vertexes.unshift(f),g},a=s.clone(n.getVertexes()),o=0,l=a.length;o<l;++o)a[o].setData("__$visitedEx__",!1);for(var u=[];a.length;){var c;c=i&&a.indexOf(i)>=0?i:a[0];var d={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}},h=r(c);d.vertexes=d.vertexes.concat(h.vertexes),d.edges=d.edges.concat(h.edges),d.longestPath.length=(d.longestPath.length||0)+h.longestPath.length,d.longestPath.vertexes=d.longestPath.vertexes.concat(h.longestPath.vertexes),d.longestPath.edges=d.longestPath.edges.concat(h.longestPath.edges),a=s.exclude(a,h.vertexes),u.push(d)}return u}},Kekule.IO.SmilesMolWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.SmilesMolWriter",doWriteData:function(n,i,r,a){var o=this.getMolecule(n);return o?this.writeStructFragment(o,a):""},getMolecule:function(n){return Kekule.ChemStructureUtils.getTotalStructFragment(n)},writeStructFragment:function(n,i){if(n.hasCtab()&&!n.isEmpty()){var r=n.clone();r.standardize&&r.standardize();var a=[],o=[];if(r.getAromaticRings)for(var l=r.getAromaticRings(),u=0,c=l.length;u<c;++u){var d=l[u];s.pushUnique(a,d.nodes),s.pushUnique(o,d.connectors)}var h,p=Kekule.GraphAdaptUtils.ctabToGraph(r.getCtab(),null,{expandSubStructures:!0,ignoreBondedHydrogen:!0}),g=p.getVertexes(),f=(p.getEdges(),g[g.length-1]),m=Kekule.IO.SmilesUtils.createGraphDepthSpanningTreesEx(p,f),C=this._prepareStereoBondsInformation(r.getCtab(),i),_=[];for(u=0,c=m.length;u<c;++u){var y,T=m[u],E=T.longestPath,b=E.vertexes[0];y=this._writeMolVertex(b,null,E.edges,T.edges,_,a,o,{bondStereoDirMap:C},i),u===0?h=y:h+=e.BOND_FAKE+y}return h}return""},_prepareStereoBondsInformation:function(n,i){var r=i.ignoreStereoBond;if(Kekule.ObjUtils.isUnset(r)&&(r=i.ignoreStereo||!1),r)return null;for(var a=0,o=new Kekule.MapEx,l=0,u=n.getConnectorCount();l<u;++l){var c=n.getConnectorAt(l);if(c.getParity&&c.getParity()){++a;for(var d=Kekule.MolStereoUtils.getStereoBondKeyNeighborConnectors(c),h=this._getStereoDoubleBondInitialDirectionSymbols(c),p=[],g=0,f=0,m=d.length;f<m;++f)o.has(d[f])&&(p[f]=!0,h[f]!==o.get(d[f])&&++g);if(g<2){for(f=0,m=d.length;f<m;++f)if(!p[f]){var C=g===1?this._getInvertBondDirectionSymbol(h[f]):h[f];o.set(d[f],C)}}}}return a?o:null},_writeMolVertex:function(n,i,r,a,o,l,u,c,d){var h,p,g=n.getData("object"),f=n.getEdges(),m=[],C=[],_=[],y=[],T=d.ignoreStereoBond;Kekule.ObjUtils.isUnset(T)&&(T=d.ignoreStereo||!1);for(var E=f.length-1;E>=0;--E){var b=f[E];if(b!==i){var v=b.getData("object");if(a.indexOf(b)>=0){var I=n.getNeighborOnEdge(b),R=this._writeMolVertex(I,b,r,a,o,l,u,c,d);r.indexOf(b)>=0?(p=I,h=R):(C.push(I),m.push(R))}else{var N=o.indexOf(b);N<0&&(N=o.length,o.push(b)),y.push(n.getNeighborOnEdge(b));var L=this._outputConnectorStr(v,b.getVertexes()[0].getData("object"),b.getVertexes()[1].getData("object"),l,u,c.bondStereoDirMap);L+=(N+=1)<10?N:e.RING_BOND_TWO_DIGIT_NO_PREFIX+N,_.push(L)}}}var U,W="";if(i){U=n.getNeighborOnEdge(i).getData("object");var M=i.getData("object");W+=this._outputConnectorStr(M,i.getVertexes()[0].getData("object"),i.getVertexes()[1].getData("object"),l,u,c.bondStereoDirMap)}for(var B=[],V=(E=0,y.length);E<V;++E)B.push(y[E].getData("object"));for(E=0,V=C.length;E<V;++E)B.push(C[E].getData("object"));for(p&&B.push(p.getData("object")),W+=this._outputNodeStr(g,l.indexOf(g)>=0,U,B,d),E=0,V=_.length;E<V;++E)W+=_[E];for(!h&&m.length&&(h=m.shift()),E=0,V=m.length;E<V;++E)W+=e.BRANCH_BRACKET_LEFT+m[E]+e.BRANCH_BRACKET_RIGHT;return W+="",h&&(W+=h),W},_outputNodeStr:function(n,i,r,a,o){var l,u;n instanceof Kekule.Atom?(l=u=n.getSymbol(),i&&(l=l.toLowerCase())):l=e.ATOM_WILDCARD;var c,d=o.ignoreStereoAtom;if(Kekule.ObjUtils.isUnset(d)&&(d=o.ignoreStereo||!1),!d&&n.getParity&&n.getParity()&&a&&a.length){var h=n.getLinkedHydrogenAtomsWithSingleBond();h&&h.length===1&&a.indexOf(h[0])<0&&a.push(h[0]);var p=n.getHydrogenCount&&n.getHydrogenCount(!1)||0;if(h.length&&p)c="";else{var g=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirection(null,n,r,a,!!p,!1,{allowExplicitHydrogen:!0,allowExplicitVerticalHydrogen:!0});c=g===Kekule.RotationDir.CLOCKWISE?e.ROTATION_DIR_CLOCKWISE:g===Kekule.RotationDir.ANTICLOCKWISE?e.ROTATION_DIR_ANTICLOCKWISE:""}c&&(l+=c)}var f=this._getNodeHydrogenCount(n,o),m=!0,C=n.getRadical?Math.round(n.getRadical()||0):0;if(!c){if(!C){if(n instanceof Kekule.Atom&&!(f&&i&&u!=="C")){if(!((o.ignoreExplicitHydrogens||o.ignoreImplicitHydrogens)&&f!==this._getNodeHydrogenCount(n,{}))){var _=n.getValence&&n.getValence()||0,y=Kekule.ValenceUtils.getMaxPossibleValence(n.getAtomicNumber(),n.getCharge())||0;_&&(_>y&&f||(n.hasExplicitHydrogens()?(n.getExplicitHydrogenCount()||0)===(n.getImplicitHydrogenCount()||0)&&(m=!1):(n.getValence&&n.getValence({ignoreExplicitHydrogens:!0,ignoreBondHydrogens:!0})||0)<_||(m=!1)))}}}}m&&((p=Math.round(f))>0&&(l+=e.ATOM_H),p>1&&(l+=p));var T=Math.round(n.getCharge());if(T){var E=T>0?"+":"-";(T>1||T<-1)&&(E=Math.abs(T)+E),l+=E}var b=n.getMassNumber?n.getMassNumber():null;b&&(l=Math.abs(b)+l);var v=!1;return m||T||b||c||C||(!i&&e.ORGAN_SUBSET_ATOMS.indexOf(u)>=0||i&&e.AROMATIC_SUBSET_ATOMS.indexOf(u)>=0)&&(v=!0),v||(l=e.ATOM_BRACKET_LEFT+l+e.ATOM_BRACKET_RIGHT),l},_getNodeHydrogenCount:function(n,i){var r=n.getLinkedHydrogenAtomsWithSingleBondCount&&n.getLinkedHydrogenAtomsWithSingleBondCount(!0)||0,a=n.getExplicitHydrogenCount&&n.getExplicitHydrogenCount();return i.ignoreExplicitHydrogens||(r+=a||0),Kekule.ObjUtils.isUnset(a)&&!i.ignoreImplicitHydrogens&&(r+=n.getImplicitHydrogenCount&&n.getImplicitHydrogenCount()||0),r},_outputConnectorStr:function(n,i,r,a,o,l){if(n instanceof Kekule.Bond&&n.getBondType()===Kekule.BondType.COVALENT){if(o.indexOf(n)>=0)return"";var u=a.indexOf(i)>=0&&a.indexOf(r)>=0,c=n.getBondOrder(),d=Kekule.BondOrder,h=c===d.DOUBLE?e.BOND_DOUBLE:c===d.TRIPLE?e.BOND_TRIPLE:c===d.QUAD?e.BOND_QUAD:u?e.BOND_SINGLE:"";return l&&l.has(n)&&(h+=l.get(n)),h}return e.BOND_FAKE},_getStereoDoubleBondInitialDirectionSymbols:function(n){var i=n.getParity();return i?i===Kekule.StereoParity.EVEN?[e.DIRECTION_BOND_SYMBOLS[0],e.DIRECTION_BOND_SYMBOLS[0]]:[e.DIRECTION_BOND_SYMBOLS[0],e.DIRECTION_BOND_SYMBOLS[1]]:["",""]},_getInvertBondDirectionSymbol:function(n){return n===e.DIRECTION_BOND_SYMBOLS[1]?e.DIRECTION_BOND_SYMBOLS[0]:e.DIRECTION_BOND_SYMBOLS[1]}}),Kekule.IO.MimeType.SMILES="chemical/x-daylight-smiles",Kekule.IO.DataFormat.SMILES="smi",Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.SMILES,Kekule.IO.MimeType.SMILES,["smi","smiles"],Kekule.IO.ChemDataType.TEXT,"SMILES format");var t=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("SMILES",Kekule.IO.SmilesMolWriter,t,[Kekule.IO.DataFormat.SMILES])}(),Kekule.globalOptions.add("IO.kekuleNative",{prettyPrint:!0}),Kekule.IO.KcjReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcjReader",readData:function(s,e){var t,n=e||Kekule.IO.ChemDataType.TEXT;return n==Kekule.IO.ChemDataType.JSON&&(t=s),n!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT")),null):(t=DataType.JsonUtility.parse(s),this.tryApplySuper("readData",[t,Kekule.IO.ChemDataType.JSON]))},doReadData:function(s,e){var t=Class.ObjSerializerFactory.getSerializer("json");return t?t.load(null,s):(Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null)}}),Kekule.IO.KcjWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcjWriter",initialize:function(s){this.tryApplySuper("initialize",[s]);var e=s||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(e.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:e.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0})},writeData:function(s,e,t,n){var i=e||Kekule.IO.ChemDataType.TEXT;if(i!=Kekule.IO.ChemDataType.JSON&&i!=Kekule.IO.ChemDataType.TEXT)return Kekule.error(Kekule.$L("ErrorMsg.KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT")),null;var r=this.tryApplySuper("writeData",[s,Kekule.IO.ChemDataType.JSON]);if(i==Kekule.IO.ChemDataType.JSON)return r;if(i==Kekule.IO.ChemDataType.TEXT){var a=n&&Kekule.ObjUtils.notUnset(n.prettyPrint)?n.prettyPrint:this.getPrettyPrint();return DataType.JsonUtility.serializeToStr(r,{prettyPrint:a})}},doWriteData:function(s,e,t,n){var i=Class.ObjSerializerFactory.getSerializer("json");if(!i)return Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null;var r={};return i.save(s,r),r}}),Kekule.IO.KcxReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcxReader",readData:function(s,e){var t,n=e||Kekule.IO.ChemDataType.TEXT;return n==Kekule.IO.ChemDataType.DOM&&(t=s),n!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT")),null):(t=DataType.XmlUtility.parse(s).documentElement,this.tryApplySuper("readData",[t,Kekule.IO.ChemDataType.DOM]))},doReadData:function(s,e){var t=Class.ObjSerializerFactory.getSerializer("xml");return t?t.load(null,s):(Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null)}}),Kekule.IO.KcxWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcxWriter",initialize:function(s){this.tryApplySuper("initialize",[s]);var e=s||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(e.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:e.prettyPrint),this.setRootTag(e.rootTag||"kcx")},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0}),this.defineProp("rootTag",{dataType:DataType.STRING})},writeData:function(s,e){var t=e||Kekule.IO.ChemDataType.TEXT;if(t!=Kekule.IO.ChemDataType.DOM&&t!=Kekule.IO.ChemDataType.TEXT)return Kekule.error(Kekule.$L("ErrorMsg.KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT")),null;var n=this.tryApplySuper("writeData",[s,Kekule.IO.ChemDataType.DOM]);if(t==Kekule.IO.ChemDataType.DOM)return n;if(t==Kekule.IO.ChemDataType.TEXT){var i={prettyPrint:this.getPrettyPrint()};return DataType.XmlUtility.serializeNode(n,i)}},doWriteData:function(s,e){var t=Class.ObjSerializerFactory.getSerializer("xml");if(!t)return Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null;var n=DataType.XmlUtility.newDocument(this.getRootTag());return t.save(s,n.documentElement),n.documentElement}}),function(){Kekule.IO.MimeType.KEKULE_JSON="chemical/x-kekule-json",Kekule.IO.MimeType.KEKULE_XML="chemical/x-kekule-xml",Kekule.IO.DataFormat.KEKULE_JSON="Kekule-JSON",Kekule.IO.DataFormat.KEKULE_XML="Kekule-XML",Kekule.IO.DataFormatsManager.register("JSON",Kekule.IO.MimeType.JSON,"json",Kekule.IO.ChemDataType.TEXT,"JSON format"),Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_JSON,Kekule.IO.MimeType.KEKULE_JSON,"kcj",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical JSON format"),Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_XML,Kekule.IO.MimeType.KEKULE_XML,"kcx",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical XML format");var s=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.JSON),e=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_JSON),t=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_XML);Kekule.IO.ChemDataReaderManager.register("json",Kekule.IO.KcjReader,s),Kekule.IO.ChemDataReaderManager.register("kcj",Kekule.IO.KcjReader,e),Kekule.IO.ChemDataReaderManager.register("kcx",Kekule.IO.KcxReader,t),Kekule.IO.ChemDataWriterManager.register("kcj",Kekule.IO.KcjWriter,[Kekule.ChemObject],e,{createOptions:{prettyPrint:!1}}),Kekule.IO.ChemDataWriterManager.register("kcx",Kekule.IO.KcxWriter,[Kekule.ChemObject],t,{createOptions:{prettyPrint:!0}})}();(function(){var s=Kekule,e=Kekule.ChemStructureNodeLabels,t=Kekule.CoordMode;ClassEx.extend(Kekule.ChemObject,{getDefCoordPos:function(i){return Kekule.Render.CoordPos.CENTER},getCoordPos:function(i){var r=i===Kekule.CoordMode.COORD3D?this.getPropStoreFieldValue("coordPos3D"):this.getPropStoreFieldValue("coordPos2D");return Kekule.ObjUtils.isUnset(r)&&(r=this.getDefCoordPos(i)),r},getOverrideRenderOptions:function(i){if(i&&i.length){for(var r={},a=0,o=i.length;a<o;++a)r=Object.extend(r,i[a]);return r}return null},_appendOverrideRenderOptionItem:function(i,r){var a=this.getPropStoreFieldValue(r);a||(a=[],this.setPropStoreFieldValue(r,a));var o=a.indexOf(i);return o>=0&&a.splice(o,1),a.push(i),this.notifyPropSet(r,a),this},_deleteOverrideRenderOptionItem:function(i,r){var a=this.getPropStoreFieldValue(r);if(a){var o=a.indexOf(i);return o>=0&&(a.splice(o,1),this.notifyPropSet(r,a)),this}},addOverrideRenderOptionItem:function(i){return this._appendOverrideRenderOptionItem(i,"overrideRenderOptionItems")},addOverrideRender3DOptionItem:function(i){return this._appendOverrideRenderOptionItem(i,"overrideRender3DOptionItems")},removeOverrideRenderOptionItem:function(i){return this._deleteOverrideRenderOptionItem(i,"overrideRenderOptionItems")},removeOverrideRender3DOptionItem:function(i){return this._deleteOverrideRenderOptionItem(i,"overrideRender3DOptionItems")},getOverriddenRenderOptions:function(){var i=this.getRenderOptions()||{},r=this.getOverrideRenderOptions(this.getOverrideRenderOptionItems());return r&&(i=Object.extend(i,r)),i},getOverriddenRender3DOptions:function(){var i=Object.create(this.getRender3DOptions()||null),r=this.getOverrideRenderOptions(this.getOverrideRender3DOptionItems());return r&&(i=Object.extend(i,r)),i},setRenderOption:function(i,r){var a;(a=this.getRenderOptions())||this.setRenderOptions({}),(a=this.getRenderOptions())[i]!==r&&(a[i]=r,this.notifyPropSet("renderOptions",a))},setRender3DOption:function(i,r){var a;(a=this.getRender3DOptions())||this.setRender3DOptions({}),(a=this.getRender3DOptions())[i]!==r&&(a[i]=r,this.notifyPropSet("render3DOptions",a))},getRenderOption:function(i){var r=this.getOverriddenRenderOptions();return r?r[i]:void 0},getRender3DOption:function(i){var r=this.getOverriddenRender3DOptions();return r?r[i]:void 0},getCascadedRenderOption:function(i){var r=this.getOverriddenRenderOptions(),a=r?r[i]:void 0;if(Kekule.ObjUtils.isUnset(a)){var o=this.getParent?this.getParent():null;a=o&&o.getCascadedRenderOption?o.getCascadedRenderOption(i):void 0}return a},getCascadedRender3DOption:function(i){var r=this.getOverriddenRender3DOptions(),a=r?r[i]:void 0;if(Kekule.ObjUtils.isUnset(a)){var o=this.getParent?this.getParent():null;a=o&&o.getCascadedRender3DOption?o.getCascadedRender3DOption(i):void 0}return a},getBaseCoord:function(i,r){var a=this.getCoordPos(i),o=this.getCoordOfMode?this.getCoordOfMode(i,r):null;if(o&&a!==Kekule.Render.CoordPos.CENTER&&a===Kekule.Render.CoordPos.CORNER_TL){var l=this.getExposedContainerBox(i,r),u={x:(l.x2-l.x1)/2,y:(l.y2-l.y1)/2};i===t.COORD3D&&(u.z=(l.z2-l.z1)/2),i===t.COORD3D?o=Kekule.CoordUtils.add(o,u):(o.x+=u.x,o.y-=u.y)}return o},getBaseCoord2D:function(i){return this.getBaseCoord(Kekule.CoordMode.COORD2D,i)},getBaseCoord3D:function(i){return this.getBaseCoord(Kekule.CoordMode.COORD3D,i)},getAbsBaseCoord:function(i,r){var a=this.getCoordPos(i),o=this.getAbsCoordOfMode?this.getAbsCoordOfMode(i,r):null;if(o&&a!==Kekule.Render.CoordPos.CENTER&&a===Kekule.Render.CoordPos.CORNER_TL){var l=this.getExposedContainerBox(i,r),u={x:(l.x2-l.x1)/2,y:(l.y2-l.y1)/2};i===t.COORD3D&&(u.z=(l.z2-l.z1)/2),i===t.COORD3D?o=Kekule.CoordUtils.add(o,u):(o.x+=u.x,o.y-=u.y)}return o},getAbsBaseCoord2D:function(i){return this.getAbsBaseCoord(Kekule.CoordMode.COORD2D,i)},getAbsBaseCoord3D:function(i){return this.getAbsBaseCoord(Kekule.CoordMode.COORD3D,i)},setAbsBaseCoord:function(i,r,a){var o=this.getCoordPos(r),l=Kekule.CoordUtils.clone(i);if(i&&o!==Kekule.Render.CoordPos.CENTER&&o===Kekule.Render.CoordPos.CORNER_TL){var u=this.getExposedContainerBox(r,a),c={x:(u.x2-u.x1)/2,y:(u.y2-u.y1)/2};r===t.COORD3D&&(c.z=(u.z2-u.z1)/2),r===t.COORD3D?l=Kekule.CoordUtils.substract(l,c):(l.x-=c.x,l.y+=c.y)}return this.setAbsCoordOfMode?this.setAbsCoordOfMode(l,r):this.setCoordOfMode&&this.setCoordOfMode(l,r),this},setAbsBaseCoord2D:function(i,r){return this.setAbsCoordOfMode(i,Kekule.CoordMode.COORD2D,r)},setAbsBaseCoord3D:function(i,r){return this.setAbsCoordOfMode(i,Kekule.CoordMode.COORD3D,r)},getExposedAncestor:function(){var i=this.getParent();return i?i.isExpanded()?this:i.getExposedAncestor():this},isExposed:function(){var i=this.getParent();return!i||i.isExpanded()},isExpanded:function(){return!0},setExpanded:function(i){},getLinkedExposedObjs:function(){for(var i=[],r=0,a=this.getLinkedConnectorCount();r<a;++r){var o=this.getLinkedConnectorAt(r);if(o.isExposed())for(var l=o.getConnectedExposedObjs(),u=0,c=l.length;u<c;++u)l[u]!==this&&Kekule.ArrayUtils.pushUnique(i,l[u])}return i},getExposedContainerBox:function(i,r){return this.getContainerBox(i,r)},getAllAutoScaleRefLengths:function(i,r){return[]},getAllContainingConnectors:function(){return this.getAllChildConnectors?this.getAllChildConnectors():[]},getConnectorLengthMedian:function(i,r){var a=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(a,i,r)}}),ClassEx.defineProps(Kekule.ChemObject,[{name:"coordPos2D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(Kekule.CoordMode.COORD2D)}},{name:"coordPos3D",dataType:DataType.INT,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getCoordPos(Kekule.CoordMode.COORD3D)}},{name:"renderOptions",dataType:DataType.OBJECT},{name:"render3DOptions",dataType:DataType.OBJECT},{name:"overrideRenderOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1},{name:"overrideRender3DOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1},{name:"hidden",dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE},{name:"visible",dataType:DataType.BOOL,serializable:!1,getter:function(){return!this.getHidden()},setter:function(i){i?this.setHidden(void 0):this.setHidden(!0)}}]),ClassEx.extend(Kekule.ChemObjList,{getAllContainingConnectors:function(){for(var i=[],r=0,a=this.getItemCount();r<a;++r){var o=this.getItemAt(r);o.getAllContainingConnectors&&(i=i.concat(o.getAllContainingConnectors()))}return i},getAllAutoScaleRefLengths:function(i,r){for(var a=[],o=0,l=this.getItemCount();o<l;++o){var u=this.getItemAt(o);u.getAllAutoScaleRefLengths&&(a=a.concat(u.getAllAutoScaleRefLengths(i,r)))}return a},getExposedContainerBox:function(i,r){for(var a,o=this.toArray(),l=0,u=o.length;l<u;++l){var c=o[l];if(c.isExposed()){var d=c.getExposedContainerBox?c.getExposedContainerBox(i,r):c.getContainerBox?c.getContainerBox(i,r):null;d&&(a=a?Kekule.BoxUtils.getContainerBox(a,d):Kekule.BoxUtils.clone(d))}}return a}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ChemObjList),ClassEx.extend(Kekule.ChemSpaceElement,{getAllContainingConnectors:function(){return this.getChildren().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(i,r){return this.getChildren().getAllAutoScaleRefLengths(i,r)}}),ClassEx.extend(Kekule.ChemSpace,{getAllContainingConnectors:function(){return this.getRoot().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(i,r){return this.getDefAutoScaleRefLength()?[this.getDefAutoScaleRefLength()]:this.getRoot().getAllAutoScaleRefLengths(i,r)}}),ClassEx.defineProps(Kekule.ChemObject,[{name:"defAutoScaleRefLength",dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(Kekule.BaseStructureConnector,{getBaseCoord:function(i,r){for(var a=null,o=0,l=i===Kekule.CoordMode.COORD2D?{x:0,y:0}:{x:0,y:0,z:0},u=0,c=this.getConnectedObjCount();u<c;++u){var d=this.getConnectedObjAt(u),h=d.getBaseCoord?d.getBaseCoord(i,r):null;h&&(l=Kekule.CoordUtils.add(l,h),++o)}return o&&(a=Kekule.CoordUtils.divide(l,o)),a},getAbsBaseCoord:function(i,r){for(var a=null,o=0,l=i===Kekule.CoordMode.COORD2D?{x:0,y:0}:{x:0,y:0,z:0},u=0,c=this.getConnectedObjCount();u<c;++u){var d=this.getConnectedObjAt(u),h=d.getAbsBaseCoord?d.getAbsBaseCoord(i,r):null;h&&(l=Kekule.CoordUtils.add(l,h),++o)}return o&&(a=Kekule.CoordUtils.divide(l,o)),a},getAbsCoordOfMode:function(i,r){return this.getAbsBaseCoord(i,r)},getConnectedExposedObjs:function(){for(var i=this.getConnectedObjs(),r=[],a=0,o=i.length;a<o;++a){var l=i[a].getExposedAncestor();r.indexOf(l)<0&&r.push(l)}return r},getLength:function(i,r){var a=this.getConnectedObjs();if(a.length!==2)return null;var o=a[0].getAbsBaseCoord?a[0].getAbsBaseCoord(i,r):null,l=a[1].getAbsBaseCoord?a[1].getAbsBaseCoord(i,r):null;return Kekule.CoordUtils.getDistance(o,l)},getLength2D:function(i){return this.getLength(Kekule.CoordMode.COORD2D,i)},getLength3D:function(i){return this.getLength(Kekule.CoordMode.COORD3D,i)}}),ClassEx.defineProps(Kekule.BaseStructureConnector,[{name:"absCoord2D",dataType:DataType.HASH,serializable:!1,getter:function(i){return this.getAbsBaseCoord(Kekule.CoordMode.COORD2D,i)}},{name:"absCoord3D",dataType:DataType.HASH,serializable:!1,getter:function(i){return this.getAbsBaseCoord(Kekule.CoordMode.COORD3D,i)}}]),ClassEx.extend(Kekule.ChemStructureConnector,{getAllAutoScaleRefLengths:function(i,r){return[this.getLength(i,r)]}}),ClassEx.extend(Kekule.BaseStructureNode,{getBaseCoord:function(i,r){return this.getCoordOfMode(i,r)},getAbsBaseCoord:function(i,r){return this.getAbsCoordOfMode(i,r)},getExposedContainerBox:function(i,r){return this.getContainerBox(i,r)},getExposedContainerBox2D:function(i){var r=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,i);return r.width=r.x2-r.x1,r.height=r.y2-r.y1,r},getExposedContainerBox3D:function(i){var r=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,i);return r.deltaX=r.x2-r.x1,r.deltaY=r.y2-r.y1,r.deltaZ=r.z2-r.z1,r}}),ClassEx.extend(Kekule.ChemStructureNode,{getDisplayRichText:function(i,r,a,o,l,u){var c=Kekule.Render;Kekule.ObjUtils.isUnset(r)&&(r=!0);var d,h=c.RichTextUtils.create(),p=this.getRenderOption("customLabel");return(d=p?c.RichTextUtils.strToRichText(p):this.getCoreDisplayRichTextItem(i,r,a,o))&&(r&&(d=this.appendElectronStateDisplayText(d,o,l,u)),d&&(c.RichTextUtils.append(h,d),h.anchorItem=d)),h},getCoreDisplayRichTextItem:function(i,r,a,o){return null},appendElectronStateDisplayText:function(i,r,a,o){var l=Kekule.Render,u=this.getCharge(),c=this.getRadical(),d=l.ChemDisplayTextUtils.createElectronStateDisplayTextSection(u,c,r,a,o);if(d){var h=l.RichTextUtils.createGroup();return l.RichTextUtils.append(h,i),l.RichTextUtils.append(h,d),h.charDirection=Kekule.Render.TextDirection.LTR,h.anchorItem=i,h}return i}}),ClassEx.extend(Kekule.AbstractAtom,{getDisplayRichText:function(i,r,a,o,l,u){var c=Kekule.Render;Kekule.ObjUtils.isUnset(i)&&(i=c.HydrogenDisplayLevel.DEFAULT);var d=this.tryApplySuper("getDisplayRichText",[i,r,a,o,l,u]),h=0;switch(i){case c.HydrogenDisplayLevel.NONE:h=0;break;case c.HydrogenDisplayLevel.ALL:h=this.getHydrogenCount();break;case c.HydrogenDisplayLevel.EXPLICIT:h=this.getExplicitHydrogenCount();break;case c.HydrogenDisplayLevel.UNMATCHED_EXPLICIT:this.getImplicitHydrogenCount&&this.getImplicitHydrogenCount()!==this.getExplicitHydrogenCount()&&(h=this.getExplicitHydrogenCount())}return h&&(d=this.appendHydrogenDisplayText(d,h)),d},appendHydrogenDisplayText:function(i,r){var a=Kekule.Render;if(r)if(r>1){var o=a.RichTextUtils.createGroup();o.charDirection=Kekule.Render.TextDirection.LTR;var l=a.RichTextUtils.appendText2(o,"H");a.RichTextUtils.appendText(o,r.toString(),{textType:a.RichText.SUB,refItem:l}),a.RichTextUtils.append(i,o)}else a.RichTextUtils.appendText(i,"H");return i}}),ClassEx.extend(Kekule.Atom,{getCoreDisplayRichTextItem:function(i,r,a,o){var l,u=Kekule.Render,c=u.RichTextUtils.createGroup(),d=this.getIsotopeAlias();return this.getSymbol(),d||this.getSymbol()!==s.Element.UNSET_ELEMENT?d&&Kekule.ChemStructureNodeLabels.ENABLE_ISOTOPE_ALIAS?(l=u.RichTextUtils.createSection(this.getIsotopeAlias(),{charDirection:Kekule.Render.TextDirection.LTR}),(c=u.RichTextUtils.append(c,l)).anchorItem=l):(l=u.RichTextUtils.createSection(this.getSymbol(),{charDirection:Kekule.Render.TextDirection.LTR}),(c=u.RichTextUtils.append(c,l)).anchorItem=l,this.getMassNumber()!==Kekule.Isotope.UNSET_MASSNUMBER&&((c=u.RichTextUtils.insertText(c,0,this.getMassNumber().toString(),{textType:u.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR,refItem:c.anchorItem})).charDirection=Kekule.Render.TextDirection.LTR)):c=u.RichTextUtils.appendText(c,a&&a.getUnsetElement()||e.UNSET_ELEMENT),c}}),ClassEx.extend(Kekule.Pseudoatom,{getCoreDisplayRichTextItem:function(i,r,a,o){var l,u=Kekule.Render,c=a;return(l=this.getLabel())||(l=c&&c.getUnsetElement()||e.UNSET_ELEMENT),u.RichTextUtils.createSection(l,{charDirection:Kekule.Render.TextDirection.LTR})}});var n=function(i,r,a){var o,l=Kekule.Render,u=Kekule.IsotopesDataUtil.getIsotopeIdDetail(r);u.massNumber&&(o=l.RichTextUtils.appendText2(i,u.massNumber.toString(),{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR}));var c=l.RichTextUtils.appendText2(i,u.symbol,{charDirection:Kekule.Render.TextDirection.LTR},a);return o&&(o.refItem=c),i.charDirection=Kekule.Render.TextDirection.LTR,i};ClassEx.extend(Kekule.VariableAtom,{getCoreDisplayRichTextItem:function(i,r,a,o){var l,u=Kekule.Render,c=a;if(this.isListEmpty())return(l=u.RichTextUtils.strToRichText(c&&c.getVariableAtom()||e.VARIABLE_ATOM)).charDirection=Kekule.Render.TextDirection.LTR,l;var d=this.getAllowedIsotopeIds()||this.getDisallowedIsotopeIds(),h=this.isDisallowedList();if((l=u.RichTextUtils.createGroup()).charDirection=Kekule.Render.TextDirection.LTR,h&&(l=u.RichTextUtils.appendText(l,c.getIsoListDisallowPrefix())),l=u.RichTextUtils.appendText(l,c.getIsoListLeadingBracket()),d&&d.length)for(var p=0,g=d.length;p<g;++p){var f=d[p];f&&(p!=0&&(l=u.RichTextUtils.appendText(l,c.getIsoListDelimiter())),l=n(l,f,p==0))}return l=u.RichTextUtils.appendText(l,c.getIsoListTailingBracket())}}),ClassEx.extend(Kekule.StructureConnectionTable,{exposedNodesHasCoord2D:function(i){for(var r=this.getExposedNodes(),a=0,o=r.length;a<o;++a)if(r[a].hasCoord2D(i))return!0;return!1},exposedNodesHasCoord3D:function(i){for(var r=this.getExposedNodes(),a=0,o=r.length;a<o;++a)if(r[a].hasCoord3D(i))return!0;return!1},getExposedNodes:function(){for(var i=[],r=this.getNodes(),a=0,o=r.length;a<o;++a){var l=r[a];if(l.getExposedNodes&&l.isExpanded()){var u=l.getExposedNodes();i=i.concat(u)}else l.isExposed()&&i.push(l)}return i},getExposedConnectors:function(){for(var i=this.getConnectors(),r=this.getNodes(),a=0,o=r.length;a<o;++a){var l=r[a];if(l.getConnectors&&l.isExpanded()){var u=l.getExposedConnectors();i=i.concat(u)}}return i},getExposedContainerBox:function(i,r){var a=this.getExposedNodes();return a.length?this.getNodesContainBox(a,i,r):null},getExposedContainerBox2D:function(i){var r=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,i);return r.width=r.x2-r.x1,r.height=r.y2-r.y1,r},getExposedContainerBox3D:function(i){var r=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,i);return r.deltaX=r.x2-r.x1,r.deltaY=r.y2-r.y1,r.deltaZ=r.z2-r.z1,r},getConnectorLengthMedian:function(i,r){var a=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(a,i,r)},getAllAutoScaleRefLengths:function(i,r){for(var a=this.getAllContainingConnectors(),o=[],l=0,u=a.length;l<u;++l){var c=a[l];if(c&&c.getAllAutoScaleRefLengths){var d=c.getAllAutoScaleRefLengths(i,r);d&&(o=o.concat(d))}}return o}}),ClassEx.extend(Kekule.ContentBlock,{getDefCoordPos:function(i){return i!==t.COORD3D?Kekule.Render.CoordPos.CORNER_TL:this.tryApplySuper("getDefCoordPos",[i])}}),ClassEx.extend(Kekule.ChemMarker.ChemPropertyMarker,{getDefCoordPos:function(i){return i!==t.COORD3D?Kekule.Render.CoordPos.CENTER:this.tryApplySuper("getDefCoordPos",[i])}}),ClassEx.extend(Kekule.StructureFragment,{isExpanded:function(){var i=this.getOverriddenRenderOptions();return!!i&&!!i.expanded},setExpanded:function(i){this.setRenderOption("expanded",i)},getExposedNodes:function(){return this.hasCtab()?this.getCtab().getExposedNodes():[]},getExposedConnectors:function(){return this.hasCtab()?this.getCtab().getExposedConnectors():[]},exposedNodesHasCoord2D:function(i){return!!this.hasCtab()&&this.getCtab().exposedNodesHasCoord2D(i)},exposedNodesHasCoord3D:function(i){return!!this.hasCtab()&&this.getCtab().exposedNodesHasCoord3D(i)},getExposedContainerBox:function(i,r){if(this.hasCtab()){var a=this.getCtab().getExposedContainerBox(i,r);return a||(a=this.getContainerBox(i,r)),a}return this.getContainerBox(i,r)},getConnectorLengthMedian:function(i,r){return this.hasCtab()?this.getCtab().getConnectorLengthMedian(i,r):null},getAutoScaleRefLength:function(i,r){return this.getConnectorLengthMedian(i,r)},getAllAutoScaleRefLengths:function(i,r){return this.hasCtab()?this.getCtab().getAllAutoScaleRefLengths(i,r):null}}),ClassEx.extend(Kekule.SubGroup,{getCoreDisplayRichTextItem:function(i,r,a,o){var l,u=Kekule.Render,c=null,d=this.getAbbr();if(d||(c=this.getFormulaText()?Kekule.FormulaUtils.textToFormula(this.getFormulaText()):this.getFormula(!1)||this.calcFormula())&&!c.isEmpty()||(d=a&&a.getRgroup()||e.SUBGROUP),d)if(d.length<=3)(l=u.RichTextUtils.createSection(d)).charDirection=Kekule.Render.TextDirection.LTR;else{var h=this._indexOfFirstUppercaseLetter(d);h<0&&(h=0),(l=u.RichTextUtils.createGroup()).charDirection=Kekule.Render.TextDirection.LTR,h>0&&((p=u.RichTextUtils.createSection(d.substring(0,h))).charDirection=Kekule.Render.TextDirection.INHERIT,l=u.RichTextUtils.append(l,p));var p=u.RichTextUtils.createSection(d.charAt(h));(l=u.RichTextUtils.append(l,p)).anchorItem=p,h<d.length-1&&((p=u.RichTextUtils.createSection(d.substring(h+1))).charDirection=Kekule.Render.TextDirection.INHERIT,l=u.RichTextUtils.append(l,p))}else c&&(l=c.getDisplayRichText(r,a,o),(p=u.RichTextUtils.getFirstNormalTextSection(l))||(p=l.items[0]),l.anchorItem=p);return l},_indexOfFirstUppercaseLetter:function(i){for(var r=0,a=i.length;r<a;++r){var o=i.charAt(r);if(o>="A"&&o<="Z")return r}return-1},_autoSetSelfCoord:function(i,r){if(!this._isAutoSettingSelfCoord&&!(this.getCoordOfMode(i,r)||(c=this.getAnchorNodeCount())<=0)){this.beginUpdate();try{this._isAutoSettingSelfCoord=!0;for(var a={},o=0;o<c;++o)(d=this.getAnchorNodeAt(o))._autoSetSelfCoord&&d._autoSetSelfCoord(i,r),(h=d.getAbsCoordOfMode(i,r))&&(a=Kekule.CoordUtils.add(a,h));var l=Kekule.CoordUtils.divide(a,c);this.setAbsCoordOfMode(l,i);var u=this.getCoordOfMode(i)||{},c=this.getNodeCount();for(o=0;o<c;++o){var d,h;(h=(d=this.getNodeAt(o)).getCoordOfMode(i,r))&&(h=Kekule.CoordUtils.substract(h,u),d.setCoordOfMode(h,i))}}finally{this._isAutoSettingSelfCoord=!1,this.endUpdate()}}},doGetAbsCoord2D:function(i){return this._autoSetSelfCoord(Kekule.CoordMode.COORD2D,i),this.tryApplySuper("doGetAbsCoord2D",[i])},doGetAbsCoord3D:function(i){return this._autoSetSelfCoord(Kekule.CoordMode.COORD3D,i),this.tryApplySuper("doGetAbsCoord3D",[i])},doSetAbsCoord2D:function(i){return this._autoSetSelfCoord(Kekule.CoordMode.COORD2D),this.tryApplySuper("doSetAbsCoord2D",[i])},doSetAbsCoord3D:function(i){return this._autoSetSelfCoord(Kekule.CoordMode.COORD3D),this.tryApplySuper("doSetAbsCoord3D",[i])}}),ClassEx.extend(Kekule.MolecularFormula,{getDisplayRichText:function(i,r,a,o,l){var u=Kekule.Render;return Kekule.ObjUtils.isUnset(i)&&(i=!0),u.ChemDisplayTextUtils.formulaToRichText(this,i,null,a,r,o,l)},getDisplayText:function(i,r,a){var o=this.getDisplayRichText();return Kekule.Render.RichTextUtils.toText(o)}}),ClassEx.extend(Kekule.Molecule,{afterInitialization:function(){this.setExpanded(!0)}}),ClassEx.extend(Kekule.CompositeMolecule,{getExposedContainerBox:function(i,r){var a=null,o=this.getPropStoreFieldValue("subMolecules");if(o)for(var l=0,u=o.length;l<u;++l){var c=o[l].getExposedContainerBox(i,r);c&&(a=a?Kekule.BoxUtils.getContainerBox(a,c):Kekule.BoxUtils.clone(c))}return a},getAllAutoScaleRefLengths:function(i,r){var a=[],o=this.getPropStoreFieldValue("subMolecules");if(o)for(var l=0,u=o.getItemCount();l<u;++l){var c=o.getObjAt(l).getAllAutoScaleRefLengths(i,r);c&&(a=a.concat(c))}return a}})})(),Kekule.Render={},Kekule.Render.CoordSystem={CHEM:0,CONTEXT:1,SCREEN:2},Kekule.Render.RendererType={R2D:2,R3D:3},Kekule.Render.CoordPos={CENTER:0,CORNER_TL:21,DEFAULT:0},Kekule.Render.DEF_ATOM_ATOMIC_NUM=6,Kekule.Render.MoleculeDisplayType={SKELETAL:1,CONDENSED:2,DEFAULT:1},Kekule.Render.Molecule2DDisplayType=Kekule.Render.MoleculeDisplayType,Kekule.Render.NodeLabelDisplayMode={HIDDEN:-1,SHOWN:1,SMART:0,DEFAULT:0},Kekule.Render.HydrogenDisplayLevel={NONE:0,EXPLICIT:1,UNMATCHED_EXPLICIT:2,ALL:10,LABELED:30,DEFAULT:30},Kekule.Render.TextDirection={DEFAULT:0,LTR:1,RTL:3,TTB:2,BTT:4,INHERIT:10},Kekule.Render.TextAlign={DEFAULT:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4,CENTER:5,LEADING:10,TRAILING:11,getAbsAlign:function(s,e){var t=s,n=Kekule.Render.TextAlign,i=Kekule.Render.TextDirection;if(s===n.LEADING||s===n.TRAILING){var r=s==n.LEADING;switch(e){case i.RTL:t=r?n.RIGHT:n.LEFT;break;case i.TTB:t=r?n.TOP:n.BOTTOM;break;case i.BTT:t=r?n.BOTTOM:n.TOP;break;case i.LTR:default:t=r?n.LEFT:n.RIGHT}}return t}},Kekule.Render.BoxXAlignment={LEFT:0,RIGHT:1,CENTER:2},Kekule.Render.BoxYAlignment={TOP:0,BOTTOM:1,CENTER:2},Kekule.Render.TextBoxAlignmentMode={BOX:0,ANCHOR:1},Kekule.Render.BondRenderType={DEFAULT:null,SINGLE:0,DOUBLE:1,TRIPLE:2,QUAD:3,DASHED:4,DASHED_DOUBLE:5,DASHED_TRIPLE:6,SOLID_DASH:7,ARROWED:8,ARROWED_INV:9,HASHED:10,BOLD:11,BOLD_DOUBLE:12,BOLD_TRIPLE:13,BOLD_QUAD:14,BOLD_DASH:16,WEDGED_SOLID:20,WEDGED_SOLID_INV:21,WEDGED_HOLLOW:22,WEDGED_HOLLOW_INV:23,WEDGED_HASHED:24,WEDGED_HASHED_INV:25,WEDGED_SOLID_BOTH:26,WEDGED_HOLLOW_BOTH:27,WAVY:30,SCISSORS_DOUBLE:40},Kekule.Render.ChargeMarkRenderType={NUM_WITH_SYMBOL:1,DEFAULT:1,CIRCLE_AROUND:3},Kekule.Render.Render3DGraphicQuality={EXTREME_LOW:1,LOW:2,MEDIUM:3,HIGH:4,EXTREME_HIGH:5},Kekule.Render.Molecule3DDisplayType={WIRE:31,STICKS:32,BALL_STICK:33,SPACE_FILL:34,DEFAULT:33},Kekule.Render.Bond3DRenderMode={NONE:0,WIRE:1,MULTI_WIRE:2,CYLINDER:3,MULTI_CYLINDER:4,isWireMode:function(s){var e=Kekule.Render.Bond3DRenderMode;return s===e.WIRE||s===e.MULTI_WIRE},isCylinderMode:function(s){var e=Kekule.Render.Bond3DRenderMode;return s===e.CYLINDER||s===e.MULTI_CYLINDER}},Kekule.Render.Bond3DSpliceMode={UNSPLIT:1,MID_SPLIT:2,WEIGHTING_SPLIT:3},Kekule.Render.Bond3DRenderType={SINGLE:1,DOUBLE:2,TRIPLE:3,DASH:-1,SOLID_DASH:-2},Kekule.Render.Node3DRenderMode={NONE:0,BALL:1,SPACE:2},Kekule.Render.MetaShapeType={POINT:0,CIRCLE:1,LINE:2,RECT:3,ARC:5,POLYLINE:11,POLYGON:10,SPHERE:101,CYLINDER:102,COMPOSITE:-1},Kekule.Render.BoundShapeType=Kekule.Render.MetaShapeType,Kekule.Render.ObjectUpdateType={MODIFY:0,ADD:1,REMOVE:2,CLEAR:3},Kekule.Render.AbstractRenderer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.AbstractRenderer",RENDER_CACHE_FIELD:"__$renderCache$__",initialize:function(s,e,t){this.tryApplySuper("initialize"),this.setPropValue("chemObj",s,!0),t&&this.setParent(t),this.setDrawBridge(e),this.setBubbleEvent(!0),this._suspendUpdateStatus=0,this._suspendUpdateInfos=[]},finalize:function(){var s=this.getPropStoreFieldValue("boundInfoRecorder");s&&s.finalize(),this.setPropValue("chemObj",null,!0),this.setDrawBridge(null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("parent",{dateType:DataType.OBJECT,serializable:!1}),this.defineProp("parentRenderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:!1,getter:function(){var s=this.getParent();return s instanceof Kekule.Render.AbstractRenderer?s:null},setter:function(s){this.setParent(s)}}),this.defineProp("redirectContext",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL,serializable:!1,getter:function(){var s=this.getPropStoreFieldValue("canModifyTargetObj");if(Kekule.ObjUtils.isUnset(s)){var e=this.getParent();e&&e.getCanModifyTargetObj&&(s=e.getCanModifyTargetObj())}return s}}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,setter:null,getter:function(s){if(this.isRootRenderer()){var e=this.getPropStoreFieldValue("boundInfoRecorder");return e||s||(e=this._createBoundInfoRecorder()),e}var t=this.getRootRenderer();return t&&t.getBoundInfoRecorder(s)}}),this.defineEvent("clear"),this.defineEvent("updateBasicDrawObject")},_createBoundInfoRecorder:function(){var s=this.getPropStoreFieldValue("boundInfoRecorder");s&&s.finalize();var e=new Kekule.Render.BoundInfoRecorder(this);return this.setPropStoreFieldValue("boundInfoRecorder",e),e},isRootRenderer:function(){return!this.getParentRenderer()},getHigherLevelObj:function(){return this.getParent()},getRootRenderer:function(){if(this.isRootRenderer())return this;var s=this.getParentRenderer();return s?s.getRootRenderer():this},getRendererType:function(){return Kekule.Render.RendererType.R2D},getCoordMode:function(){return this.getRendererType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},_getRenderSortIndex:function(){return 0},getRenderCache:function(s){var e=this.getExtraProp(s,this.RENDER_CACHE_FIELD);return e||(e={},this.setExtraProp(s,this.RENDER_CACHE_FIELD,e)),e},beginDraw:function(s,e,t){var n=this.getDrawBridge();n.prepareContext&&n.prepareContext(s)},endDraw:function(s,e,t){var n=this.getDrawBridge();n.renderContext&&n.renderContext(s)},updateDrawInfoInCache:function(s,e,t,n,i){var r=this.getRenderCache(e);e&&(r.context=e),t&&(r.baseCoord=t),s&&(r.chemObj=s),n&&(r.options=n),i&&(r.realDrawOptions=i)},_isCurrChemObjNeedToBeDrawn:function(s,e){for(var t=this.getChemObj(),n=0,i=s.length;n<i;++n){var r=s[n];if(r===t||r.isChildOf(t))return!0}return!1},getAutoBaseCoord:function(s){return this.doGetAutoBaseCoord(s)},doGetAutoBaseCoord:function(s){return null},getCachedDrawOptions:function(s){return this.getRenderCache(s).options},getCachedDrawnElem:function(s){return this.getRenderCache(s).drawnElem},isChemObjNeedToBeDrawn:function(){var s=this.getChemObj();return s&&(!s.getVisible||s.getVisible())},draw:function(s,e,t){if(!this.isChemObjNeedToBeDrawn())return null;try{this.__isDrawing=!0,this.getBoundInfoRecorder();var n={},i=this.getParentRenderer();if(i)var r=i.getRenderCache().options;r?(n=Object.create(r),n=Object.extend(n,t)):n=Object.create(t||null);var a=this.getChemObj(),o=n.partialDrawObjs;if(o&&!this._isCurrChemObjNeedToBeDrawn(o,s))return null;var l=this.getRendererType()===Kekule.Render.RendererType.R3D?"getRender3DOptions":"getRenderOptions",u=a[l]?a[l]():null,c=a[l=this.getRendererType()===Kekule.Render.RendererType.R3D?"getOverriddenRender3DOptions":"getOverriddenRenderOptions"]?a[l]():null;n=Kekule.Render.RenderOptionUtils.mergeRenderOptions(u||{},n),this.getRenderCache().options=n,n=Kekule.Render.RenderOptionUtils.mergeRenderOptions(c||{},n),this.updateDrawInfoInCache(this.getChemObj(),s,e,t,n);var d=this.isRootRenderer();this.doPrepareDraw(s,e,n),this.invokeEvent("prepareDrawing",{context:s,obj:this.getChemObj()}),d&&this.beginDraw(s,e,n);var h=this.doDraw(s,e,n);this.getRenderCache(s).drawnElem=h,d&&this.endDraw(s,e,n),this.invokeEvent("draw",{context:s,obj:this.getChemObj(),renderOptions:n})}finally{this.__isDrawing=!1}return h},doPrepareDraw:function(s,e,t){},doDraw:function(s,e,t){return this.doDrawSelf(s,e,t)},doDrawSelf:function(s,e,t){return null},redraw:function(s){if(!this.isChemObjNeedToBeDrawn())return null;var e=this.isRootRenderer();if(e){var t=this.getRenderCache(s)||{};this.beginDraw(s,t.baseCoord,t.options)}var n=this.doRedraw(s);return this.getRenderCache(s).drawnElem=n,e&&this.endDraw(s,t.baseCoord,t.options),n},doRedraw:function(s){var e=this.getRenderCache(s);return this.draw(s,e.baseCoord,e.options)},canModifyGraphic:function(s){var e=this.getDrawBridge();return!!e.canModifyGraphic&&e.canModifyGraphic(s)},beginUpdateRenderer:function(){++this._suspendUpdateStatus},endUpdateRenderer:function(){--this._suspendUpdateStatus,this._suspendUpdateStatus<=0&&(this._suspendUpdateStatus=0),this.isUpdatingRenderer()||this.doEndUpdateRenderer()},doEndUpdateRenderer:function(){this.updateEx(this._suspendUpdateInfos),this._suspendUpdateInfos=[]},isUpdatingRenderer:function(){return this._suspendUpdateStatus>0},updateEx:function(s){var e=!0;if(this.isUpdatingRenderer())return this._suspendUpdateInfos||(this._suspendUpdateInfos=[]),this._mergeRendererUpdateInfo(this._suspendUpdateInfos,s),!0;if(!this.canModifyGraphic(o)){if(this.isRootRenderer()){var t=[];for(i=0,r=s.length;i<r;++i)o=(a=s[i]).context,Kekule.ArrayUtils.pushUnique(t,o);for(i=0,r=t.length;i<r;++i){this.getDrawBridge().clearContext(o);var n=this.getRenderCache(o);this.draw(o,n.baseCoord,n.options)}return!0}return this.getParentRenderer().updateEx(s)}for(var i=0,r=s.length;i<r;++i){for(var a,o=(a=s[i]).context,l=0,u=a.items.length;l<u;++l){var c=a.items[l];if(!(e=e&&this.doUpdate(o,c.updatedObjDetails,c.updateType)))break}if(!e)break}return e},_mergeRendererUpdateInfo:function(s,e){for(var t=0,n=e.length;t<n;++t){var i=e[t],r=this._indexOfContextInRendererUpdateInfos(i.context,s);if(r<0)s.push(i);else{var a=s[r];a.items=a.items.concat(i.items)}}return s},_indexOfContextInRendererUpdateInfos:function(s,e){for(var t=0,n=e.length;t<n;++t)if(e[t].context===s)return t;return-1},update:function(s,e,t){for(var n=[],i=0,r=e.length;i<r;++i){var a=e[i].obj;this.isChemObjRenderedBySelf(s,a)&&n.push(e[i])}return!n.length||this.updateEx([{context:s,items:[{updateType:t,updatedObjDetails:n}]}])},doUpdate:function(s,e,t){return this.doUpdateSelf(s,e,t)},doUpdateSelf:function(s,e,t){if(this.canModifyGraphic(s)){for(var n=!1,i=this.getChemObj(),r=0,a=e.length;r<a;++r)if(e[r].obj===i){n=!0;break}if(n){if(t===Kekule.Render.ObjectUpdateType.CLEAR)return this.doClear(s);this.doClear(s);var o=this.getRenderCache(s);return this.draw(s,o.baseCoord,o.options)}}return!1},_extractObjsOfUpdateObjDetails:function(s){return Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(s)},_createUpdateObjDetailsFromObjs:function(s){return Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(s)},addNew:function(s,e){var t=this._createUpdateObjDetailsFromObjs(e);return this.update(s,t,Kekule.Render.ObjectUpdateType.ADD)},modify:function(s,e){return this.update(s,e,Kekule.Render.ObjectUpdateType.MODIFY)},remove:function(s,e){var t=this._createUpdateObjDetailsFromObjs(e);return this.update(s,t,Kekule.Render.ObjectUpdateType.REMOVE)},clear:function(s){this.doClear(s),this.invokeEvent("clear",{context:s,obj:this.getChemObj()})},doClear:function(s){return!!this.canModifyGraphic()&&this.doClearSelf(s)},doClearSelf:function(s){if(!this.canModifyGraphic())return!1;var e=this.getRenderCache(s).drawnElem;if(e)try{this.getDrawBridge().removeDrawnElem(s,e)}catch{}this.getRenderCache(s).drawnElem=null},estimateObjBox:function(s,e,t){var n=this.doEstimateObjBox(s,e,t);return n&&(n=this._fillBoxDefaultValue(n,this.getRendererType())),n},doEstimateObjBox:function(s,e,t){return this.doEstimateSelfObjBox(s,e,t)},doEstimateSelfObjBox:function(s,e,t){return null},estimateRenderBox:function(s,e,t,n){var i=this.doEstimateRenderBox(s,e,t,n);return i&&(i=this._fillBoxDefaultValue(i,this.getRendererType())),i},doEstimateRenderBox:function(s,e,t,n){return null},_fillBoxDefaultValue:function(s,e){s||(s={});var t=e===Kekule.Render.RendererType.R3D,n={x1:s.x1||0,x2:s.x2||0,y1:s.y1||0,y2:s.y2||0};return t&&(n.z1=s.z1||0,n.z2=s.z2||0),n},transformCoordToObj:function(s,e,t){return this.doTransformCoordToObj(s,e,t)},doTransformCoordToObj:function(s,e,t){return t},transformCoordToContext:function(s,e,t){return this.doTransformCoordToContext(s,e,t)},doTransformCoordToContext:function(s,e,t){return t},transformContextCoordToScreen:function(s,e){return this.doTransformContextCoordToScreen(s,e)},doTransformContextCoordToScreen:function(s,e){var t=this.getDrawBridge();return t&&t.transformContextCoordToScreen?t.transformContextCoordToScreen(s,e):e},basicDrawObjectUpdated:function(s,e,t,n,i){this.invokeEvent("updateBasicDrawObject",{context:s,obj:e,parentObj:t,boundInfo:n,updateType:i})},isChemObjRenderedBySelf:function(s,e){return e===this.getRenderCache(s).chemObj},isChemObjRenderedDirectlyBySelf:function(s,e){return!(!e||!this.getRenderCache(s).chemObj)&&e===this.getRenderCache(s).chemObj},getObjRenderBound:function(s,e,t){var n=this.getBoundInfoRecorder(),i=e;return t&&e.getCoordStickTarget&&(i=e.getCoordStickTarget()||i),n&&n.getBound(s,i)},getStickingTargetRenderBound:function(s,e){var t;if(e.getCoordStickTarget&&(t=e.getCoordStickTarget()),t){var n=this.getBoundInfoRecorder();return n&&n.getBound(s,t,!0)}return null},createBoundInfo:function(s,e,t){return Kekule.Render.MetaShapeUtils.createShapeInfo(s,e,t)},createPointBoundInfo:function(s){return this.createBoundInfo(Kekule.Render.BoundShapeType.POINT,[s])},createCircleBoundInfo:function(s,e){return this.createBoundInfo(Kekule.Render.BoundShapeType.CIRCLE,[s],{radius:e})},createArcBoundInfo:function(s,e,t,n,i,r){return this.createBoundInfo(Kekule.Render.BoundShapeType.ARC,[s],{radius:e,startAngle:t,endAngle:n,anticlockwise:i,width:r})},createLineBoundInfo:function(s,e,t){return this.createBoundInfo(Kekule.Render.BoundShapeType.LINE,[s,e],{width:t})},createRectBoundInfo:function(s,e){return this.createBoundInfo(Kekule.Render.BoundShapeType.RECT,[s,e])},createSphereBoundInfo:function(s,e){return this.createBoundInfo(Kekule.Render.BoundShapeType.SPHERE,[s],{radius:e})},createCylinderBoundInfo:function(s,e,t){return this.createBoundInfo(Kekule.Render.BoundShapeType.CYLINDER,[s,e],{radius:t})}}),Kekule.ClassDefineUtils.addExtraObjMapSupport(Kekule.Render.AbstractRenderer),Kekule.Render.DummyRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.DummyRenderer",draw:function(s,e,t){},redraw:function(s){}}),Kekule.Render.CompositeRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.CompositeRenderer",initProperties:function(){this.defineProp("targetChildObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("childRendererMap",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var s=this.getPropStoreFieldValue("childRendererMap");return s||(s=new Kekule.MapEx(!0),this.setPropStoreFieldValue("childRendererMap",s)),s}})},finalize:function(){this.reset(),this.tryApplySuper("finalize")},_getRenderSortIndex:function(){for(var s=this.tryApplySuper("_getRenderSortIndex"),e=this.prepareChildRenderers(),t=0,n=e.length;t<n;++t){var i=e[t]._getRenderSortIndex();i>s&&(s=i)}return s},doEstimateObjBox:function(s,e,t){for(var n=this.tryApplySuper("doEstimateObjBox",[s,e,t]),i=this.prepareChildRenderers(),r=Kekule.BoxUtils,a=0,o=i.length;a<o;++a){var l=i[a];if(l){var u=l.estimateObjBox(s,e,t);u&&(n=n?r.getContainerBox(n,u):r.clone(u))}}return n},isChemObjRenderedBySelf:function(s,e){var t=this.tryApplySuper("isChemObjRenderedBySelf",[s,e]);if(!t){for(var n=this.getChildRenderers(),i=0,r=n.length;i<r;++i)if(n[i].isChemObjRenderedBySelf(s,e))return!0}if(!t){this.refreshChildObjs();var a=this.getTargetChildObjs();t=a&&a.indexOf(e)>=0}return t},isChemObjRenderedDirectlyBySelf:function(s,e){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[s,e])},doSetRedirectContext:function(s){this.tryApplySuper("doSetRedirectContext",[s]);var e=this.getChildRenderers();if(e&&e.length)for(var t=0,n=e.length;t<n;++t)e[t].setRedirectContext(s)},getChildObjs:function(){var s=this.getChemObj();return s&&s.getAttachedMarkers?[].concat(s.getAttachedMarkers()||[]):[]},prepareChildObjs:function(){var s=this.getTargetChildObjs();return s||(this.setTargetChildObjs(this.getChildObjs()),this.getTargetChildObjs())},refreshChildObjs:function(){this.setTargetChildObjs(null),this.prepareChildObjs()},getChildRenderers:function(){return this.getChildRendererMap().getValues()},getRendererForChild:function(s,e){var t=this.getRendererType()===Kekule.Render.RendererType.R3D?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass,n=this.getChildRendererMap();if(!(r=n.get(s))&&e){var i=t(s)||Kekule.Render.DummyRenderer,r=i?new i(s,this.getDrawBridge(),this):null;n.set(s,r),r.setRedirectContext(this.getRedirectContext())}return r},prepareChildRenderers:function(){for(var s=this.getChildRendererMap(),e=this.prepareChildObjs()||[],t=s.getKeys(),n=0,i=t.length;n<i;++n){var r=t[n];e.indexOf(r)<0&&s.remove(r)}for(n=0,i=e.length;n<i;++n){var a=e[n];this.getRendererForChild(a,!0)}return s.getValues()},releaseChildRenderers:function(){var s=this.getChildRendererMap(),e=s.getValues();if(e){for(var t=0,n=e.length;t<n;++t)e[t].finalize();s.clear()}},hasChildRenderers:function(){var s=this.getChildRendererMap().getValues();return s&&s.length},getDirectRendererForChildObj:function(s,e){if(this.isChemObjRenderedDirectlyBySelf(s,e))return this;for(var t=this.getChildRenderers(),n=0,i=t.length;n<i;++n){var r=t[n];if(r.isChemObjRenderedBySelf(s,e))return r.isChemObjRenderedDirectlyBySelf(s,e)?r:r.getDirectRendererForChildObj?r.getDirectRendererForChildObj(s,e):null}return null},prepare:function(){this.prepareChildObjs(),this.prepareChildRenderers()},reset:function(){this.setTargetChildObjs(null),this.releaseChildRenderers()},_needWholelyDraw:function(s,e){var t=this.getChemObj();return!s||s.indexOf(t)>=0},doPrepareDraw:function(s,e,t){this.refreshChildObjs(),this.prepareChildRenderers();for(var n=this.getChildRenderers(),i=0,r=n.length;i<r;++i)n[i].doPrepareDraw(s,e,t)},doDraw:function(s,e,t){var n=Object.create(t);if(t.partialDrawObjs&&this._needWholelyDraw(t.partialDrawObjs,s)&&(n.partialDrawObjs=null),this.getTargetChildObjs().length){var i=this.doDrawSelf(s,e,n),r=this.doDrawChildren(s,e,n);return i&&this.addToDrawGroup(i,r),r}return this.tryApplySuper("doDraw",[s,e,n])},doDrawChildren:function(s,e,t){var n=this.createDrawGroup(s),i=this.getChildRenderers();this._sortChildRenderers(i);var r=Object.create(t);this.getRenderCache(s).childDrawOptions=r;for(var a=0,o=i.length;a<o;++a){var l=i[a].draw(s,null,r);n&&l&&this.addToDrawGroup(l,n)}return n},_sortChildRenderers:function(s){s.sort(function(e,t){return e._getRenderSortIndex()-t._getRenderSortIndex()})},doClear:function(s){return this.tryApplySuper("doClear",[s]),this.hasChildRenderers()&&this.doClearChildren(s),!0},doClearChildren:function(s){for(var e=this.getChildRendererMap().getValues(),t=0,n=e.length;t<n;++t)e[t]&&e[t].clear(s)},doUpdate:function(s,e,t){return this.refreshChildObjs(),this.tryApplySuper("doUpdate",[s,e,t]),this.getTargetChildObjs().length&&this.doUpdateChildren(s,e,t),!0},doUpdateChildren:function(s,e,t){for(var n=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(e),i=this.getTargetChildObjs()||[],r=this.getChildRendererMap(),a=Kekule.ArrayUtils.toArray(n),o=new Kekule.MapEx(!1),l=[],u=!1,c=0,d=a.length;c<d;++c){var h=a[c];this.isChemObjRenderedDirectlyBySelf(s,h)&&(u=!0)}if(u)return this.doClear(s),this.redraw(s),!0;for(c=0,d=a.length;c<d;++c)if(h=a[c],_=r.get(h))t===Kekule.Render.ObjectUpdateType.REMOVE?(_.clear(),r.remove(h)):(Kekule.ArrayUtils.pushUnique(l,_),y=[h],o.set(_,y));else{var p=this._getRenderersForChildObj(s,h);if(!p.length&&i.indexOf(h)>=0){var g=(v=this.getRendererForChild(h,!0)).draw(s,null,this.getRenderCache(s).childDrawOptions);if(g){var f=this.getCachedDrawnElem(s);f&&this.addToDrawGroup(g,f)}}for(var m=0,C=p.length;m<C;++m){var _=p[m],y=o.get(_);y||(l.push(_),y=[],o.set(_,y)),y.push(h)}}var T=!0;for(c=0,d=l.length;c<d;++c){_=l[c];var E=o.get(_),b=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(E),v=_.update(s,b,t);T=T&&v}return T},_getRenderersForChildObj:function(s,e){for(var t=[],n=this.getChildRenderers(),i=0,r=n.length;i<r;++i){var a=n[i];a.isChemObjRenderedBySelf(s,e)&&t.push(a)}return t}}),Kekule.Render.Renderer2DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS),Kekule.Render.get2DRendererClass=function(s){var e=s instanceof ObjectEx?s.getClass():s;return Kekule.Render.Renderer2DFactory.getClass(e)},Kekule.Render.Renderer3DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS),Kekule.Render.get3DRendererClass=function(s){var e=s instanceof ObjectEx?s.getClass():s;return Kekule.Render.Renderer3DFactory.getClass(e)},Kekule.Render.DrawBridgeManager=Class.create({CLASS_NAME:"Kekule.Render.DrawBridgeManager",initialize:function(){this._items=[],this._preferredItem=null},_indexOfBridgeClass:function(s){for(var e=0,t=this._items.length;e<t;++e)if(this._items[e].bridgeClass===s)return e;return-1},_sortItems:function(){this._items.sort(function(s,e){return(s.priorityLevel||0)-(e.priorityLevel||0)})},_reselectPreferred:function(){this._sortItems();for(var s=this._items.length-1;s>=0;--s){var e=this._items[s];if(e.isSupported)return this._preferredItem=e,e}return this._preferredItem=null,null},_recheckAvailabilityOfItem:function(s){var e=s.bridgeClass,t=e.getAvailabilityInformation&&e.getAvailabilityInformation();!t&&e.isSupported&&(t={available:e.isSupported(),message:null}),t?(s.isSupported=t.available,s.message=t.message):(s.isSupported=!1,s.message=null)},recheckAvailabilities:function(){for(var s=this._items,e=s.length-1;e>=0;--e){var t=s[e];this._recheckAvailabilityOfItem(t)}},register:function(s,e){e||(e=0);var t,n=this._indexOfBridgeClass(s);return n>=0&&this._items.splice(n,1),t={bridgeClass:s,priorityLevel:e},this._recheckAvailabilityOfItem(t),this._items.push(t),this._sortItems(),(!this._preferredItem||this._preferredItem.priorityLevel<e)&&t.isSupported&&(this._preferredItem=t),t},unregister:function(s){var e=null,t=this._indexOfBridgeClass(s);return t>=0&&(e=this._items[t],this._items.splice(t,1),e===this._preferredItem&&this._reselectPreferred()),e},getPreferredBridgeClass:function(){return this._preferredItem?this._preferredItem.bridgeClass:null},getPreferredBridgeInstance:function(){var s=this.getPreferredBridgeClass();return s?new s:null},getUnavailableMessages:function(){for(var s=[],e=this._items,t=e.length-1;t>=0;--t){var n=e[t];!n.isSupported&&n.message&&s.push(n.message)}return s},getUnavailableMessage:function(){var s=this._preferredItem||this._items[this._items.length-1];return!s.isSupported&&s.message?s.message:""}}),Kekule.Render.DrawBridge2DMananger=new Kekule.Render.DrawBridgeManager,Kekule.Render.DrawBridge3DMananger=new Kekule.Render.DrawBridgeManager,Kekule.Render.registerExternalModule=function(s,e){Kekule.externalResourceManager.register(s,e)},Kekule.Render.getExternalModule=function(s){return Kekule.externalResourceManager.getResource(s)},function(){var s=Kekule.Render;s.atomColorSets={jmol:["#000099","#FFFFFF","#D9FFFF","#CC80FF","#C2FF00","#FFB5B5","#909090","#3050F8","#FF0D0D","#90E050","#B3E3F5","#AB5CF2","#8AFF00","#BFA6A6","#F0C8A0","#FF8000","#FFFF30","#1FF01F","#80D1E3","#8F40D4","#3DFF00","#E6E6E6","#BFC2C7","#A6A6AB","#8A99C7","#9C7AC7","#E06633","#F090A0","#50D050","#C88033","#7D80B0","#C28F8F","#668F8F","#BD80E3","#FFA100","#A62929","#5CB8D1","#702EB0","#00FF00","#94FFFF","#94E0E0","#73C2C9","#54B5B5","#3B9E9E","#248F8F","#0A7D8C","#006985","#C0C0C0","#FFD98F","#A67573","#668080","#9E63B5","#D47A00","#940094","#429EB0","#57178F","#00C900","#70D4FF","#FFFFC7","#D9FFC7","#C7FFC7","#A3FFC7","#8FFFC7","#61FFC7","#45FFC7","#30FFC7","#1FFFC7","#00FF9C","#00E675","#00D452","#00BF38","#00AB24","#4DC2FF","#4DA6FF","#2194D6","#267DAB","#266696","#175487","#D0D0E0","#FFD123","#B8B8D0","#A6544D","#575961","#9E4FB5","#AB5C00","#754F45","#428296","#420066","#007D00","#70ABFA","#00BAFF","#00A1FF","#008FFF","#0080FF","#006BFF","#545CF2","#785CE3","#8A4FE3","#A136D4","#B31FD4","#B31FBA","#B30DA6","#BD0D87","#C70066","#CC0059","#D1004F","#D90045","#E00038","#E6002E","#EB0026","#000000","#000000"],cpk2D:["#000000","#000000","#FFC0CB","#B22222",null,"#00FF00","#000000","#8F8FFF","#F00000","#DAA520",null,"#0000FF","#228B22","#808090","#DAA520","#FFA500","#FFC832","#00FF00",null,"#0000FF","#808090","#808090","#808090","#808090","#808090","#808090","#FFA500","#A52A2A","#A52A2A","#A52A2A","#A52A2A"]};var e=s.atomColorSets.cpk2D,t=s.atomColorSets.jmol;e[35]="#A52A2A",e[47]="#808090",e[53]="#A020F0",e[56]="#FFA500",e[79]="#DAA520",e.SubGroup=t.SubGroup="#0000CC",s.atom3DColors=Kekule.Render.atomColorSets.jmol,s.atom2DColors=Kekule.Render.atomColorSets.cpk2D,s.atomColors=[],s.atomColors[s.RendererType.R2D]=s.atom2DColors,s.atomColors[s.RendererType.R3D]=s.atom3DColors}(),Kekule.Render.RichText={SECTION:"section",GROUP:"group",LINES:"lines",SUP:"superscript",SUB:"subscript",NORMAL:"normal"},Kekule.Render.RichTextUtils={STYLE_PROPS:["fontSize","fontFamily","fontWeight","fontStyle","color","opacity"],create:function(){return Kekule.Render.RichTextUtils.createGroup()},createGroup:function(s,e){var t={role:s||"group",items:[]};if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},createSection:function(s,e){var t={text:s};if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},strToRichText:function(s,e){s||(s="");var t=Kekule.Render.RichTextUtils,n=s.split(`
`);if(n.length<=1)return Kekule.Render.RichTextUtils.appendText(t.create(),s,e);for(var i=t.createGroup(Kekule.Render.RichText.LINES),r=0,a=n.length;r<a;++r){var o=n[r]||" ";t.appendText(i,o,e)}return i},insertText:function(s,e,t,n,i){var r=Kekule.Render.RichTextUtils.createSection(t,n);return s.items.splice(e,0,r),i&&(s.anchorItem=r),s},appendText:function(s,e,t,n){var i=Kekule.Render.RichTextUtils.createSection(e,t);return s.items.push(i),n&&(s.anchorItem=i),s},appendText2:function(s,e,t,n){var i=Kekule.Render.RichTextUtils.createSection(e,t);return s.items.push(i),n&&(s.anchorItem=i),i},insert:function(s,e,t){return s.items.splice(e,0,t),s},append:function(s,e){return s.items.push(e),s},appendItems:function(s,e){return s.items=s.items.concat(Kekule.ArrayUtils.toArray(e)),s},getItemType:function(s){return s.items?s.role:Kekule.Render.RichText.SECTION},getItemRole:function(s){var e=Kekule.Render.RichText;return Kekule.Render.RichTextUtils.getItemType(s)===e.GROUP?e.GROUP:e.SECTION},getItemTextType:function(s){return s.textType||Kekule.Render.RichText.NORMAL},isSuperscript:function(s){return Kekule.Render.RichTextUtils.getItemTextType(s)==Kekule.Render.RichText.SUP},isSubscript:function(s){return Kekule.Render.RichTextUtils.getItemTextType(s)==Kekule.Render.RichText.SUB},isGroup:function(s){return Kekule.Render.RichTextUtils.getItemType(s)===Kekule.Render.RichText.GROUP},isSection:function(s){return Kekule.Render.RichTextUtils.getItemType(s)===Kekule.Render.RichText.SECTION},getFirstNormalTextSection:function(s){for(var e=0,t=s.items.length;e<t;++e){var n=s.items[e];if(Kekule.Render.RichTextUtils.getItemTextType(n)===Kekule.Render.RichText.NORMAL)return n}return null},getActualRefItem:function(s,e){var t=s.refItem;if(!t&&e.items.length>1){var n=e.items.indexOf(s);t=n>0?e.items[n-1]:n==0?e.items[1]:null}return t},getFinalAnchorItem:function(s){return s.anchorItem?Kekule.Render.RichTextUtils.getFinalAnchorItem(s.anchorItem):s},tidy:function(s){for(var e=Kekule.Render.RichTextUtils.createGroup(s.role),t=-1,n=0,i=s.items.length;n<i;++n){var r=s.items[n];if(r.items){var a=Kekule.Render.RichTextUtils.tidy(r);if(a.items.length==1){var o=Object.extend({},a);delete o.items,delete o.role,r=o=Object.extend(o,a.items[0])}else if(a.items.length>0){++t,e.items.push(a);continue}}var l=!1;if(t>=0){var u=e.items[t];u.items||Kekule.ObjUtils.equal(r,u,["text"])&&(u.text+=r.text,l=!0)}l||(++t,e.items.push(Object.extend({},r)))}return e},clone:function(s){var e={};if(Object.extend(e,s),s.items){e.items=[];for(var t=0,n=s.items.length;t<n;++t){var i={};i=Kekule.Render.RichTextUtils.clone(s.items[t]),e.items.push(i)}}if(e.items){if(s.anchorItem){var r=s.items.indexOf(s.anchorItem);e.anchorItem=r>=0?e.items[r]:null}for(t=0,n=e.items.length;t<n;++t){var a=s.items[t];i=e.items[t],a.refItem&&(r=s.items.indexOf(a.refItem),i.refItem=r>=0?e.items[r]:null)}}return e},toText:function(s){var e="";if(!s.items)return s.text||"";for(var t=0,n=s.items.length;t<n;++t){var i=s.items[t];i.items?e+=Kekule.Render.RichTextUtils.toText(i):i.text&&(e+=i.text)}return e},_toDebugHtml:function(s){if(!s.items)return s.text;for(var e="",t=0,n=s.items.length;t<n;++t){var i=s.items[t];if(i.items)e+=Kekule.Render.RichTextUtils._toDebugHtml(i);else if(i.text)switch(i.textType){case Kekule.Render.RichText.SUB:e+="<sub>"+i.text+"</sub>";break;case Kekule.Render.RichText.SUP:e+="<sup>"+i.text+"</sup>";break;default:e+=i.text}}return e},toSimpleHtmlCode:function(s){return Kekule.Render.RichTextUtils._toDebugHtml(s)},fromSimpleHtmlCode:function(s){for(var e,t=Kekule.Render.RichText,n=new RegExp("</?([a-z]+)/?>","ig"),i=[],r=0,a=t.NORMAL;(e=n.exec(s))!==null;){var o=e.index,l=e[0],u=e[1].toLowerCase();r<o&&i.push({textType:a,text:s.substring(r,o)});var c=l.indexOf("/")===1;if(l.lastIndexOf("/")!==l.length-2){var d=u==="sup"?t.SUP:u==="sub"?t.SUB:null;d&&(c?a===d&&(a=t.NORMAL):a=d)}r=o+l.length}s.length>r&&i.push({textType:a,text:s.substring(r)});for(var h=Kekule.Render.RichTextUtils,p=h.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR}),g=0,f=i.length;g<f;++g){var m=i[g].textType,C=i[g].text;if(C){var _=h.createSection(C,{textType:m});h.append(p,_)}}return p},toHtml:function(s,e,t){var n,i,r=Kekule.Render.RichText;i=e.charDirection?e.charDirection===Kekule.Render.TextDirection.RTL||e.charDirection===Kekule.Render.TextDirection.BTT:t;var a=e.role;if(a===r.SECTION||e.text){var o=e.textType,l=o===r.SUB?"sub":o===r.SUP?"sup":"span";n=s.createElement(l);var u=e.text;i&&(u=u.reverse()),Kekule.DomUtils.setElementText(n,e.text||"")}else{var c,d,h=null;a===r.LINES?(n=s.createElement("div"),h="p",c="margin:0.2em 0;padding:0"):n=s.createElement("span");for(var p=0,g=e.items.length;p<g;++p){var f=e.items[p],m=Kekule.Render.RichTextUtils.toHtml(s,f,i);if(h){var C=s.createElement(h);c&&(C.style.cssText=c),C.appendChild(m),m=C}i&&d?n.insertBefore(m,d):n.appendChild(m),d=m}}var _=n.style,y=Kekule.Render.RichTextUtils.STYLE_PROPS;for(p=0,g=y.length;p<g;++p){var T=y[p];e[T]&&(_[T]=e[T])}return n},fromHtml:function(s){var e=Kekule.Render.RichText,t=Kekule.Render.RichTextUtils,n=Kekule.DomUtils,i=Kekule.StyleUtils;return function r(a,o){if(a.nodeType===Node.TEXT_NODE)return(I=(I=a.nodeValue).replace(/[\r\n]/g,"")).trim()?t.createSection(I):null;if(a.nodeType===Node.ELEMENT_NODE){var l=t.STYLE_PROPS;l.push("direction");for(var u={},c=0,d=l.length;c<d;++c){var h,p=l[c];(h=o?i.getComputedStyle(a,p):a.style[p])&&(u[p]=h)}if(u.direction?(u.charDirection=u.direction==="ltr"?Kekule.Render.TextDirection.LTR:u.direction==="rtl"?Kekule.Render.TextDirection.RTL:u.direction==="inherit"?Kekule.Render.TextDirection.INHERIT:null,delete u.direction):u.charDirection=Kekule.Render.TextDirection.DEFAULT,n.getFirstChildElem(a)){var g=e.GROUP,f=n.getChildNodesOfTypes(a,[Node.ELEMENT_NODE,Node.TEXT_NODE]),m=[],C=!1;for(c=0,d=f.length;c<d;++c){var _=f[c],y=r(_,!1);_.nodeType===Node.ELEMENT_NODE&&(_.tagName.toLowerCase()==="br"&&(m.push("br"),C=!0),i.isBlockElem(_)&&(C=!0,y._isLine=!0)),y&&m.push(y)}if(C){var T=[],E=[];for(c=0,d=m.length;c<d;++c)if((y=m[c])._isLine||y=="br"){if(E.length){if(E.length>1){var b=t.createGroup();t.appendItems(b,E),T.push(b)}else T.push(E[0]);E=[]}y._isLine&&(delete y._isLine,T.push(y))}else E.push(y);E.length&&(E.length>1?(b=t.createGroup(),t.appendItems(b,E),T.push(b)):T.push(E[0])),m=T}C&&(g=e.LINES);var v=t.createGroup(g,u);for(c=0,d=m.length;c<d;++c)t.append(v,m[c]);return v}var I=n.getElementText(a),R=a.tagName.toLowerCase();return u.textType=R==="sub"?e.SUB:R==="sup"?e.SUP:e.NORMAL,I?t.createSection(I,u):null}}(s,!0)}},Kekule.Render.ChemDisplayTextUtils={RADICAL_LABELS:["","••","•","••"],RADICAL_TRIPLET_ALTER_LABEL:"^^",getRadicalDisplayText:function(s,e){return e&&s===Kekule.RadicalOrder.TRIPLET?Kekule.Render.ChemDisplayTextUtils.RADICAL_TRIPLET_ALTER_LABEL:Kekule.Render.ChemDisplayTextUtils.RADICAL_LABELS[s]},getChargeDisplayText:function(s,e,t){var n="";if(s&&(!e||Math.abs(s)>Math.pow(10,-e)/2)){var i=s>0?"+":"-",r=Math.abs(s);r!=1?n+=e?Kekule.NumUtils.toDecimals(r,e):r.toString():t===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND&&(i=s>0?"⊕":"⊖"),n+=i}return n},createElectronStateDisplayTextSection:function(s,e,t,n,i){var r=null,a="";return s&&(a=Kekule.Render.ChemDisplayTextUtils.getChargeDisplayText(s,t,n)),e&&(a+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(e,i)||""),a&&(r=Kekule.Render.RichTextUtils.createSection(a,{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR})),r},formulaToRichText:function(s,e,t,n,i,r,a){return Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(s,!1,e,t,n,i,r,a)},_convFormulaToRichTextGroup:function(s,e,t,n,i,r,a,o){var l=Kekule.Render.RichTextUtils.createGroup(),u=s.getSections();if(e){var c=s.getMaxNestedLevel()%Kekule.FormulaUtils.FORMULA_BRACKET_TYPE_COUNT,d=Kekule.FormulaUtils.FORMULA_BRACKETS[c][0],h=Kekule.FormulaUtils.FORMULA_BRACKETS[c][1];l=Kekule.Render.RichTextUtils.appendText(l,d)}for(var p=0,g=u.length;p<g;++p){var f=u[p].obj,m=s.getSectionCharge(u[p]),C=null;f instanceof Kekule.MolecularFormula?C=Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(f,!0,!1,!1,i,r,a):f.getDisplayRichText&&(C=f.getDisplayRichText(Kekule.Render.HydrogenDisplayLevel.NONE,!1,null,r,i,a)),C&&(u[p].count!=1&&((C=Kekule.Render.RichTextUtils.appendText(C,u[p].count.toString(),{textType:Kekule.Render.RichText.SUB})).charDirection=Kekule.Render.TextDirection.LTR),t&&m&&(_=Kekule.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(m,null,i,a,o))&&Kekule.Render.RichTextUtils.append(C,_),l=Kekule.Render.RichTextUtils.append(l,C))}if(e&&(l=Kekule.Render.RichTextUtils.appendText(l,h)),t||n){m=s.getCharge();var _,y=s.getRadical();(_=Kekule.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(m,y,i,a))&&Kekule.Render.RichTextUtils.append(l,_)}return l}},Kekule.Render.TextDrawUtils={isHorizontalLine:function(s){return s==Kekule.Render.TextDirection.LTR||s==Kekule.Render.TextDirection.RTL||s==null},isVerticalLine:function(s){return s==Kekule.Render.TextDirection.TTB||s==Kekule.Render.TextDirection.BTT},getOppositeDirection:function(s){var e=Kekule.Render.TextDirection;switch(s){case e.LTR:return e.RTL;case e.RTL:return e.LTR;case e.TTB:return e.BTT;case e.BTT:return e.TTB}},isOppositeDirection:function(s,e){return Kekule.Render.TextDrawUtils.getOppositeDirection(s)===e},getActualDirection:function(s,e){var t=Kekule.Render.TextDirection;return s===t.LINE_BREAK?e===t.TTB||e===t.BTT?t.LTR:e===t.LTR||e===t.RTL?t.TTB:s:s},getActualAlign:function(s,e){var t=Kekule.Render.TextAlgin,n=Kekule.Render.TextDirection;switch(s){case t.LEFT:case t.RIGHT:case t.TOP:case t.BOTTOM:case t.CENTER:return s;case t.LEADING:switch(e){case n.TTB:return t.TOP;case n.BTT:return t.BOTTOM;case n.RTL:return t.RIGHT;case n.LTR:default:return t.LEFT}case t.TRAILING:switch(e){case n.BTT:return t.TOP;case n.TTB:return t.BOTTOM;case n.RTL:return t.LEFT;case n.LTR:default:return t.RIGHT}}}},Kekule.Render.DrawPathUtils={makePath:function(){for(var s,e=[],t=null,n=[],i=0,r=arguments.length;i<r;++i){var a=arguments[i];DataType.isArrayValue(a)?n=n.concat(a):typeof a=="number"?n.push(a):(t&&(s={method:t,params:n},e.push(s),t=null,n=[]),t=a.toString()),i===r-1&&t&&(s={method:t,params:n},e.push(s))}return e}},Kekule.Render.ConnectorDrawUtils={getPossibleConnectorRenderTypes:function(s){if(s instanceof Kekule.Bond)return Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(s);var e=Kekule.Render.BondRenderType;return[e.SINGLE,e.DASHED,e.WAVY]},getDefConnectorRenderType:function(s){return Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(s)[0]},getPossibleBondRenderTypes:function(s){var e=Kekule.Render.BondRenderType,t=Kekule.BondType;switch(s.getBondType()){case t.HYDROGEN:return[e.DASHED,e.ARROWED,e.WAVY];case t.COORDINATE:return[e.ARROWED,e.SINGLE,e.DASHED,e.WAVY];case t.IONIC:case t.METALLIC:case t.UNKNOWN:return[e.SINGLE,e.DASHED,e.WAVY];case t.COVALENT:break;default:return[e.SINGLE,e.DASHED,e.ARROWED,e.WAVY]}if(s.getConnectedObjCount()>2)return[e.DASHED,e.SINGLE];var n=Kekule.BondOrder;switch(s.getBondOrder()){case n.DOUBLE:var i=[e.DOUBLE,e.DASHED_DOUBLE,e.BOLD_DOUBLE,e.WAVY];return s.getStereo&&[Kekule.BondStereo.E_OR_Z,Kekule.BondStereo.CIS_OR_TRANS].indexOf(s.getStereo())>=0&&i.unshift(e.SCISSORS_DOUBLE),i;case n.TRIPLE:return[e.TRIPLE,e.BOLD_TRIPLE,e.WAVY];case n.QUAD:return[e.QUAD,e.BOLD_QUAD,e.WAVY];case n.EXPLICIT_AROMATIC:return[e.SOLID_DASH,e.WAVY];case n.SINGLE:var r=Kekule.BondStereo,a=[e.SINGLE,e.BOLD,e.WAVY];switch(s.getStereo()){case r.UP:a.unshift(e.WEDGED_SOLID,e.WEDGED_HOLLOW);break;case r.UP_INVERTED:a.unshift(e.WEDGED_SOLID_INV,e.WEDGED_HOLLOW_INV);break;case r.DOWN:a.unshift(e.WEDGED_HASHED,e.DASHED);break;case r.DOWN_INVERTED:a.unshift(e.WEDGED_HASHED_INV,e.DASHED);break;case r.UP_OR_DOWN:case r.UP_OR_DOWN_INVERTED:a=[e.WAVY,e.SINGLE];break;case r.CLOSER:a=[e.WEDGED_SOLID_BOTH,e.WEDGED_HOLLOW_BOTH]}return a;default:return[e.SINGLE,e.DASHED,e.ARROWED,e.WAVY]}},getDefBondRenderType:function(s){return Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(s)[0]},getConnectorRender3DType:function(s,e){var t=Kekule.Render.Bond3DRenderType,n=Kekule.Render.Bond3DRenderMode;return(!e||e!==n.WIRE&&e!==n.CYLINDER)&&s instanceof Kekule.Bond?Kekule.Render.ConnectorDrawUtils.getBondRender3DTypes(s):t.SINGLE},getBondRender3DTypes:function(s){var e=Kekule.Render.Bond3DRenderType,t=Kekule.BondType;switch(s.getBondType()){case t.HYDROGEN:return e.DASH;case t.COVALENT:break;default:return e.SINGLE}var n=Kekule.BondOrder;switch(s.getBondOrder()){case n.DOUBLE:return e.DOUBLE;case n.TRIPLE:return e.TRIPLE;case n.EXPLICIT_AROMATIC:return e.SOLID_DASH;default:return e.SINGLE}}},Kekule.Render.ObjUtils={getContainerBox:function(s,e,t){var n;e||(e=Kekule.CoordMode.COORD2D);var i=s;if(i.getExposedContainerBox)n=i.getExposedContainerBox(e,t);else if(i.getContainerBox)n=i.getContainerBox(e,t);else{var r=i.getAbsCoordOfMode?i.getAbsCoordOfMode(e):null;n=r?Kekule.BoxUtils.createBox(r,r):null}return n}},Kekule.Render.MetaShapeUtils={createShapeInfo:function(s,e,t){var n={shapeType:s,coords:e};return t&&(n=Object.extend(n,t)),n},isCompositeShape:function(s){return DataType.isArrayValue(s)},inflateShape:function(s,e){if(!s)return null;var t,n=Kekule.Render.MetaShapeType,i=Kekule.Render.MetaShapeUtils;if(i.isCompositeShape(s)){for(var r=[],a=0,o=s.length;a<o;++a){var l=s[a],u=i.inflateShape(l,e);r.push(u)}return r}switch(s.shapeType){case n.POINT:t=i._inflatePointShape(s,e);break;case n.CIRCLE:t=i._inflateCircleShape(s,e);break;case n.LINE:t=i._inflateLineShape(s,e);break;case n.RECT:t=i._inflateRectShape(s,e);break;case n.POLYGON:t=i._inflatePolygonShape(s,e);break;case n.ARC:t=i._inflateArcShape(s,e)}return t},_inflatePointShape:function(s,e){return Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[s.coords[0]],{radius:e})},_inflateCircleShape:function(s,e){return Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[s.coords[0]],{radius:s.radius+e})},_inflateLineShape:function(s,e){return Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.LINE,[s.coords[0],s.coords[1]],{width:(s.width||0)+2*e})},_inflateArcShape:function(s,e){var t=Object.extend({},s);return t.width=(s.width||0)+2*e,t},_inflateRectShape:function(s,e){var t=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.RECT,[]),n=Kekule.Render.MetaShapeUtils._inflateCoords(s.coords,e);return t.coords=n,t},_inflatePolygonShape:function(s,e){var t=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.POLYGON,[]),n=Kekule.Render.MetaShapeUtils._inflateCoords(s.coords,e);return t.coords=n,t},_inflateCoords:function(s,e){for(var t=Kekule.CoordUtils,n=[],i=t.getCenter(s),r=0,a=s.length;r<a;++r){var o=s[r],l=t.substract(o,i),u=t.getDistance(l),c=t.multiply(l,e/u),d=t.add(o,c);n.push(d)}return n},getDistance:function(s,e,t){if(Kekule.Render.MetaShapeUtils.isCompositeShape(e)){for(var n=null,i=0,r=e.length;i<r;++i){var a=e[i],o=Kekule.Render.MetaShapeUtils.getDistance(s,a,t);(n===null||n>o)&&(n=o)}return n}var l=Kekule.Render.MetaShapeType,u=Kekule.Render.MetaShapeUtils,c=t?u.inflateShape(e,t):e;switch(e.shapeType){case l.POINT:return t?u._getDistanceToCircle(s,c):u._getDistanceToPoint(s,c);case l.CIRCLE:return u._getDistanceToCircle(s,c);case l.LINE:return u._getDistanceToLine(s,c);case l.RECT:return u._getDistanceToRect(s,c);case l.POLYGON:return u._getDistanceToPolygon(s,c);case l.ARC:return u._getDistanceToArc(s,c);default:return!1}},_getDistanceToPoint:function(s,e){return Kekule.CoordUtils.getDistance(s,e.coords[0])},_getDistanceToCircle:function(s,e){return Kekule.CoordUtils.getDistance(s,e.coords[0])-e.radius},_getDistanceToArc:function(s,e){var t=Kekule.CoordUtils,n=t.substract(s,e.coords[0]),i=Math.atan2(n.y,n.x);if(Kekule.Render.MetaShapeUtils.isAngleInArcRange(i,e.startAngle,e.endAngle,e.anticlockwise)){var r=t.getDistance(s,e.coords[0]);return r=Math.abs(r-e.radius),e.width&&e.width>1&&(r-=e.width/2),Math.max(0,r)}var a,o=e.coords[0];a=e.width&&e.width>1?[e.radius-e.width/2,e.radius+e.width/2]:[e.radius];for(var l=[],u=e.startAngle,c=e.endAngle,d=0,h=a.length;d<h;++d){var p=a[d],g=t.add(o,{x:p*Math.cos(u),y:p*Math.sin(u)}),f=t.add(o,{x:p*Math.cos(c),y:p*Math.sin(c)});l.push(g),l.push(f)}var m=null;for(d=0,h=l.length;d<h;++d)r=t.getDistance(l[d],s),(m===null||m>r)&&(m=r);return m},_getDistanceToLine:function(s,e){var t=Kekule.Render.MetaShapeUtils,n=e.coords,i=Kekule.Render.MetaShapeUtils._calcVerticalLineCrossPoint(s,n[0],n[1]),r=Kekule.NumUtils;if(r.isFloatEqual(n[0].x,n[1].x)&&r.isFloatEqual(n[0].y,n[1].y)){var a={coords:[e.coords[0]],radius:e.width};return t._getDistanceToCircle(s,a)}var o=Kekule.CoordUtils.substract(n[1],n[0]);if(Math.abs(o.y)>Math.abs(o.x)?Math.sign(i.y-n[0].y)*Math.sign(i.y-n[1].y)<=0:Math.sign(i.x-n[0].x)*Math.sign(i.x-n[1].x)<=0)return Kekule.CoordUtils.getDistance(s,i)-(e.width||0)/2;var l={coords:[e.coords[0]],radius:e.width||0},u={coords:[e.coords[1]],radius:e.width||0},c=t._getDistanceToCircle(s,l),d=t._getDistanceToCircle(s,u);return Math.min(c,d)},_getDistanceToRect:function(s,e){var t=e.coords,n=Kekule.Render.MetaShapeUtils,i=Object.extend({},e);return i.shapeType=Kekule.Render.MetaShapeType.POLYGON,i.coords=[{x:t[0].x,y:t[0].y},{x:t[1].x,y:t[0].y},{x:t[1].x,y:t[1].y},{x:t[0].x,y:t[1].y}],n._getDistanceToPolygon(s,i)},_getDistanceToPolygon:function(s,e){Kekule.CoordUtils;for(var t=Kekule.Render.MetaShapeUtils,n=Kekule.Render.MetaShapeType,i=t._isInsidePolygon(s,e),r=e.coords,a=null,o=0,l=r.length;o<l;++o){var u=r[o],c=r[(o+1)%l],d=t.createShapeInfo(n.LINE,[u,c],{width:0}),h=t._getDistanceToLine(s,d);(a===null||a>h)&&(a=h)}return i&&(a=-a),a},_getDistanceOfTwoLines:function(s,e){Kekule.Render.MetaShapeUtils;var t=Kekule.GeometryUtils;if(t.getCrossPointOfLines(s[0],s[1],e[0],e[1]))return 0;var n=t.getDistanceFromPointToLine(s[0],e[0],e[1]),i=t.getDistanceFromPointToLine(s[1],e[0],e[1]),r=t.getDistanceFromPointToLine(e[0],s[0],s[1]),a=t.getDistanceFromPointToLine(e[1],s[0],s[1]);return Math.min(n,i,r,a)},isCoordInside:function(s,e,t){if(!s)return!1;if(Kekule.Render.MetaShapeUtils.isCompositeShape(e)){for(var n=0,i=e.length;n<i;++n){var r=e[n];if(Kekule.Render.MetaShapeUtils.isCoordInside(s,r,t))return!0}return!1}var a=Kekule.Render.MetaShapeType,o=Kekule.Render.MetaShapeUtils,l=t?o.inflateShape(e,t):e;if(!l)return!1;switch(e.shapeType){case a.POINT:return t?o._isInsideCircle(s,l):o._isInsidePoint(s,l);case a.CIRCLE:return o._isInsideCircle(s,l);case a.LINE:return o._isInsideLine(s,l);case a.RECT:return o._isInsideRect(s,l);case a.POLYGON:return o._isInsidePolygon(s,l);case a.ARC:return o._isInsideArc(s,l);default:return!1}},_isInsidePoint:function(s,e){return Kekule.CoordUtils.isEqual(s,e.coords[0])},_isInsideCircle:function(s,e){return Kekule.CoordUtils.getDistance(s,e.coords[0])<=e.radius},_isInsideLine:function(s,e){var t=e.coords,n=Kekule.Render.MetaShapeUtils._calcVerticalLineCrossPoint(s,t[0],t[1]),i=Kekule.NumUtils;if(i.isFloatEqual(t[0].x,t[1].x)&&i.isFloatEqual(t[0].y,t[1].y)){var r={coords:[e.coords[0]],radius:e.width};return Kekule.Render.MetaShapeUtils._isInsideCircle(s,r)}var a=Kekule.CoordUtils.substract(t[1],t[0]);return(Math.abs(a.y)>Math.abs(a.x)?Math.sign(n.y-t[0].y)*Math.sign(n.y-t[1].y)<=0:Math.sign(n.x-t[0].x)*Math.sign(n.x-t[1].x)<=0)&&Kekule.CoordUtils.getDistance(s,n)<=e.width/2},_isInsideArc:function(s,e){var t=Kekule.CoordUtils,n=Kekule.GeometryUtils,i=t.getDistance(s,e.coords[0]),r=Math.abs(i-e.radius)<e.width/2;if(r){var a=t.substract(s,e.coords[0]),o=n.standardizeAngle(Math.atan2(a.y,a.x),0);r=Kekule.Render.MetaShapeUtils.isAngleInArcRange(o,e.startAngle,e.endAngle,e.anticlockwise)}return r},_isInsideRect:function(s,e){var t=e.coords;return Kekule.CoordUtils.insideRect(s,t[0],t[1])},_isInsidePolygon:function(s,e){for(var t=s.x,n=s.y,i=e.coords,r={x:i[0].x,y:i[0].y},a={x:i[0].x,y:i[0].y},o=1,l=i.length;o<l;++o){var u=i[o];u.x<r.x?r.x=u.x:u.x>a.x&&(a.x=u.x),u.y<r.y?r.y=u.y:u.y>a.y&&(a.y=u.y)}if(!Kekule.CoordUtils.insideRect(s,r,a))return!1;for(var c=!1,d=(o=0,(l=i.length)-1);o<l;++o){var h=i[o],p=i[d];(h.y<n&&p.y>=n||p.y<n&&h.y>=n)&&(h.x<=t||p.x<=t)&&h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x)<t&&(c=!c),d=o}return c},_calcVerticalLineCrossPoint:function(s,e,t){var n={};if(Math.abs(e.x-t.x)<1e-10)n.x=e.x,n.y=s.y;else{var i=(t.y-e.y)/(t.x-e.x);n.x=(i*i*e.x+i*(s.y-e.y)+s.x)/(i*i+1),n.y=i*(n.x-e.x)+e.y}return n},getContainerBox:function(s,e){var t=Kekule.Render.MetaShapeType,n=Kekule.Render.MetaShapeUtils,i=Kekule.BoxUtils;if(!s)return null;var r,a=s.coords;if(e=e||0,n.isCompositeShape(s)){r=null;for(var o=0,l=s.length;o<l;++o){var u=s[o],c=n.getContainerBox(u);r=r?i.getContainerBox(r,c):c}}else switch(s.shapeType){case t.POINT:case t.CIRCLE:var d=s.shapeType===t.POINT?0:s.radius||0,h=a[0];r=i.createBox({x:h.x-d,y:h.y-d},{x:h.x+d,y:h.y+d});break;case t.LINE:r=i.createBox(a[0],a[1]),r=Kekule.BoxUtils.inflateBox(r,(s.width||0)/2);break;case t.ARC:r=Kekule.Render.MetaShapeUtils._getArcContainerBox(s);break;case t.RECT:r=i.createBox(a[0],a[1]);break;case t.POLYGON:for(r=i.createBox(a[0],a[0]),o=1,l=a.length;o<l;++o)h=a[o],r={x1:Math.min(r.x1,h.x),y1:Math.min(r.y1,h.y),x2:Math.max(r.x2,h.x),y2:Math.max(r.y2,h.y)}}return e&&(r=Kekule.BoxUtils.inflateBox(r,e)),r},_getArcContainerBox:function(s){var e,t=Kekule.Render.MetaShapeUtils,n=Kekule.CoordUtils;e=s.width&&s.width>1?[s.radius+s.width/2,s.radius-s.width/2]:[s.radius];for(var i=s.coords[0],r=Math.PI/2,a=function(m,C){return n.add(i,{x:C*Math.cos(m),y:C*Math.sin(m)})},o=[],l=0,u=e.length;l<u;++l){var c=e[l],d=a(s.startAngle,c),h=a(s.endAngle,c);o=o.concat([d,h]);for(var p=[0,r,2*r,3*r],g=0,f=p.length;g<f;++g)t.isAngleInArcRange(p[g],s.startAngle,s.endAngle,s.anticlockwise)&&o.push(a(p[g],c))}return n.getContainerBox(o)},isAngleInArcRange:function(s,e,t,n){var i=Kekule.GeometryUtils.standardizeAngle,r=i(e),a=i(t),o=i(s),l=Math.sign(o-r)*Math.sign(o-a)*Math.sign(a-r);return n?l>=0:l<=0},isIntersectingLine:function(s,e,t){var n=Kekule.Render.MetaShapeType,i=Kekule.Render.MetaShapeUtils;if(i.isCompositeShape(s)){for(var r=0,a=s.length;r<a;++r){var o=s[r];if(i.isIntersectingLine(o,e,t))return!0}return!1}var l=i.createShapeInfo(n.LINE,e),u=t/2,c=s.coords;switch(s.shapeType){case n.POINT:return(h=i._getDistanceToLine(c[0],l))<=u;case n.CIRCLE:return(h=i._getDistanceToLine(c[0],l))<=u+(l.radius||0);case n.LINE:return(h=i._getDistanceOfTwoLines(c,e))<=u+(l.width||0);case n.RECT:case n.POLYGON:var d=i._getCoordsForShapeInComparingWithPolygon(s),h=null,p=d.length-1;for(r=0,a=d.length;r<a;++r){var g=[d[r],d[p]],f=i._getDistanceOfTwoLines(g,e);(h===null||f<h)&&(h=f),p=r}return h<=u}return!1},isInsideBox:function(s,e){var t=Kekule.Render.MetaShapeUtils.getContainerBox(s);return Kekule.BoxUtils.isInside(t,e)},isIntersectingBox:function(s,e){if(!Kekule.Render.MetaShapeUtils.isCompositeShape(s)){var t=s.coords;for(i=0,r=t.length;i<r;++i){var n=t[i];if(Kekule.CoordUtils.isInsideBox(n,e))return!0}return!1}for(var i=0,r=s.length;i<r;++i){var a=s[i];if(Kekule.Render.MetaShapeUtils.isIntersectingBox(a,e))return!0}},isPointInsidePolygon:function(s,e){for(var t=!1,n=e.length,i=n-1,r=0;r<n;++r)e[r].y>s.y!=e[i].y>s.y&&s.x<(e[i].x-e[r].x)*(s.y-e[r].y)/(e[i].y-e[r].y)+e[r].x&&(t=!t),i=r;return t},isInsidePolygon:function(s,e){var t=Kekule.Render.MetaShapeUtils,n=t._getCoordsForShapeInComparingWithPolygon(s);if(!n)return!1;for(var i=0,r=n.length;i<r;++i){var a=n[i];if(!t.isPointInsidePolygon(a,e))return!1}return!0},isIntersectingPolygon:function(s,e){var t=Kekule.Render.MetaShapeUtils,n=t._getCoordsForShapeInComparingWithPolygon(s);if(!n)return!1;for(var i=0,r=n.length;i<r;++i){var a=n[i];if(t.isPointInsidePolygon(a,e))return!0}return!1},isIntersectingPolyline:function(s,e,t){for(var n=Kekule.Render.MetaShapeUtils,i=0,r=e.length-1;i<r;++i){var a=[e[i],e[i+1]];if(n.isIntersectingLine(s,a,t))return!0}return!1},_getCoordsForShapeInComparingWithPolygon:function(s){var e,t=Kekule.Render.MetaShapeType,n=Kekule.Render.MetaShapeUtils;if(n.isCompositeShape(s)){e=[];for(var i=0,r=s.length;i<r;++i){var a=s[i],o=n._getCoordsForShapeInComparingWithPolygon(a);e=e.concat(o)}return e}var l=s.coords;switch(s.shapeType){case t.POINT:e=[l[0]];break;case t.CIRCLE:var u=s.radius||0;if(u){var c=u,d=c/Math.sqrt(2);e=[{x:c,y:0},{x:d,y:d},{x:0,y:c},{x:-d,y:d},{x:-c,y:0},{x:-d,y:-d},{x:0,y:-c},{x:d,y:-d}]}else e=[l[0]];break;case t.LINE:e=[l[0],l[1]];break;case t.RECT:var h=l[0],p=l[1];e=[h,{x:p.x,y:h.y},p,{x:h.x,y:p.y}];break;case t.POLYGON:e=l}return e},getEdgeVectors:function(s){var e,t=Kekule.Render.MetaShapeType,n=Kekule.Render.MetaShapeUtils,i=Kekule.CoordUtils;if(n.isCompositeShape(s)){e=[];for(var r=0,a=s.length;r<a;++r){var o=s[r],l=n.getEdgeVectors(o);e=e.concat(l)}return e}var u=s.coords;switch(s.shapeType){case t.POINT:e=[[u[0],u[0]]];break;case t.CIRCLE:e=null;break;case t.LINE:var c=s.width;if(c){var d=u[0],h=u[1],p=i.substract(h,d),g=i.getDistance(d,h),f=c/2,m=f*(p.y/g),C=f*(p.x/g),_=[{x:d.x-m,y:d.y+C},{x:d.x+m,y:d.y-C},{x:h.x+m,y:h.y-C},{x:h.x-m,y:h.y+C}];e=[[_[0],_[1]],[_[1],_[2]],[_[2],_[3]],[_[3],_[0]]]}else e=[[u[0],u[1]]];break;case t.RECT:var y=u[0],T=(d={x:(h=u[1]).x,y:y.y},{x:y.x,y:h.y});e=[[y,d],[d,h],[h,T],[T,y]];break;case t.POLYGON:for(e=[],r=0,a=u.length-1;r<a;++r){var E=++r;E>=a&&(E=0),e.push([u[r],u[E]])}}return e},getEdgeBasicElements:function(s){var e=Kekule.Render.MetaShapeType,t=Kekule.Render.MetaShapeUtils,n={vectors:[],circles:[]};if(t.isCompositeShape(s)){for(var i=0,r=s.length;i<r;++i){var a=s[i],o=t.getEdgeBasicElements(a);n.vectors=n.concat(o.vectors),n.circles=n.concat(o.circles)}return n}var l=s.coords;switch(s.shapeType){case e.POINT:n.circles.push({center:l[0],radius:0});break;case e.CIRCLE:n.circles.push({center:l[0],radius:s.radius});break;default:n.vectors=n.vectors.concat(Kekule.Render.MetaShapeUtils.getEdgeVectors(s))}return n},getCrossPointsOfVectorToShapeEdges:function(s,e,t,n){for(var i=Kekule.Render.MetaShapeUtils.getEdgeBasicElements(e),r=i.vectors,a=i.circles,o=[],l=0,u=r.length;l<u;++l){var c=r[l],d=Kekule.GeometryUtils.getCrossPointOfVectors(s,c);if(d&&(o.push(d),t))return o}for(l=0,u=a.length;l<u;++l){var h=a[l],p=Kekule.GeometryUtils.getCrossPointsOfVectorToCircle(s,h.center,h.radius,n);if(p&&p.length&&(o=o.concat(p),t))return o}return o}},Kekule.Render.RenderOptionUtils={getOptionDefinitions:function(){return[{name:"expanded",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"unitLength",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"moleculeDisplayType",dataType:DataType.INT,enumSource:Kekule.Render.MoleculeDisplayType,targetClass:Kekule.StructureFragment},{name:"renderType",dataType:DataType.INT,enumSource:Kekule.Render.BondRenderType,targetClass:Kekule.ChemStructureConnector},{name:"nodeDisplayMode",dataType:DataType.INT,enumSource:Kekule.Render.NodeLabelDisplayMode,targetClass:Kekule.ChemStructureNode},{name:"hydrogenDisplayLevel",dataType:DataType.INT,enumSource:Kekule.Render.HydrogenDisplayLevel,targetClass:Kekule.ChemStructureNode},{name:"showCharge",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkType",dataType:DataType.INT,enumSource:Kekule.Render.ChargeMarkRenderType,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chemMarkerMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"distinguishSingletAndTripletRadical",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"fontSize",dataType:DataType.NUMBER},{name:"fontFamily",dataType:DataType.STRING},{name:"supFontSizeRatio",dataType:DataType.FLOAT},{name:"subFontSizeRatio",dataType:DataType.FLOAT},{name:"superscriptOverhang",dataType:DataType.FLOAT},{name:"subscriptOversink",dataType:DataType.FLOAT},{name:"textBoxXAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxXAlignment},{name:"textBoxYAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxYAlignment},{name:"horizontalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"verticalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"charDirection",dataType:DataType.INT,enumSource:Kekule.Render.TextDirection},{name:"customLabel",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"boldBondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"hashSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingAbs",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondMaxAbsSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowLength",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeHashMinWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondLengthScaleRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"opacity",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"fillColor",dataType:DataType.STRING},{name:"strokeColor",dataType:DataType.STRING},{name:"strokeWidth",dataType:DataType.NUMBER},{name:"atomRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject}]},mergeObjLocalRenderOptions:function(s,e){var t=s&&s.getOverriddenRenderOptions?s.getOverriddenRenderOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(t||{},e)},mergeObjLocalRender3DOptions:function(s,e){var t=s&&s.getOverriddenRender3DOptions?s.getOverriddenRender3DOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(t||{},e)},mergeRenderOptions:function(s,e){var t=Object.create(e);return t=Object.extend(t,s,!0,!0)},getColor:function(s){return s?s.color:null},getMoleculeDisplayType:function(s){return s?s.moleculeDisplayType:null},getNodeDisplayMode:function(s){return s?s.nodeDisplayMode:null},getHydrogenDisplayLevel:function(s){return s?s.hydrogenDisplayLevel:null},getShowCharge:function(s){return s?s.showCharge:null},getChargeDrawOptions:function(s){return s?Object.copyValues({},s,["showCharge","chargeMarkType","chargeMarkFontSize","chargeMarkMargin","chargeMarkCircleWidth","color","opacity"]):null},getNodeLabelDrawOptions:function(s){return s?Object.copyValues({},s,["fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","textBoxXAlignment","textBoxYAlignment","color","opacity"]):null},getConnectorRenderType:function(s){return s?s.renderType:null},getConnectorDrawParams:function(s){return s?Object.copyValues({},s,["bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","color","opacity"]):null},getConfigPropNames:function(s){for(var e=[],t=s.getAllPropList(),n=0,i=t.getLength();n<i;++n){var r=t.getPropInfoAt(n);s.isConfigProp(r)&&e.push(r.name)}return e},convertConfigsToPlainHash:function(s){var e=Kekule.Render.RenderOptionUtils;return s instanceof Kekule.Render.Render3DConfigs?e.convert3DConfigsToPlainHash(s):e.convert2DConfigsToPlainHash(s)},convert2DConfigsToPlainHash:function(s){var e=Kekule.ObjUtils,t={};t._configs=s;for(var n=Kekule.Render.RenderOptionUtils.getConfigPropNames(s),i=["generalConfigs","moleculeDisplayConfigs","displayLabelConfigs","lengthConfigs"],r=0,a=n.length;r<a;++r){var o=n[r];if(!(i.indexOf(o)>=0)){var l=s.getPropValue(o);if(l.toHash){var u=l.toHash();t=Object.extend(t,u)}}}var c=s.getGeneralConfigs().toHash();return e.replacePropName(c,"drawOpacity","opacity"),t=Object.extend(t,c),c=s.getMoleculeDisplayConfigs().toHash(),e.replacePropName(c,"defMoleculeDisplayType","moleculeDisplayType"),e.replacePropName(c,"defNodeDisplayMode","nodeDisplayMode"),e.replacePropName(c,"defHydrogenDisplayLevel","hydrogenDisplayLevel"),e.replacePropName(c,"defChargeMarkType","chargeMarkType"),(t=Object.extend(t,c)).displayLabelConfigs=s.getDisplayLabelConfigs(),c=s.getLengthConfigs().toHash(),(t=Object.extend(t,c)).unitLength=t.unitLength||1,t},convert3DConfigsToPlainHash:function(s){var e=Kekule.ObjUtils,t={};t._configs=s;for(var n=Kekule.Render.RenderOptionUtils.getConfigPropNames(s),i=["generalConfigs","moleculeDisplayConfigs","environmentConfigs"],r=0,a=n.length;r<a;++r){var o=n[r];if(!(i.indexOf(o)>=0)){var l=s.getPropValue(o);if(l.toHash){var u=l.toHash();t=Object.extend(t,u)}}}var c=s.getGeneralConfigs().toHash();return e.replacePropName(c,"drawOpacity","opacity"),t=Object.extend(t,c),c=s.getEnvironmentConfigs().toHash(),t=Object.extend(t,c),c=s.getMoleculeDisplayConfigs().toHash(),e.replacePropName(c,"defMoleculeDisplayType","moleculeDisplayType"),e.replacePropName(c,"defBondSpliceMode","bondSpliceMode"),e.replacePropName(c,"defDisplayMultipleBond","displayMultipleBond"),e.replacePropName(c,"defBondColor","bondColor"),e.replacePropName(c,"defAtomColor","atomColor"),t=Object.extend(t,c)},getCascadeRenderOptionValueOfObjs:function(s,e,t){for(var n,i=!1,r=Kekule.ArrayUtils.toArray(s),a=t?"getCascadedRender3DOption":"getCascadedRenderOption",o=0,l=r.length;o<l;++o){var u=r[o];if(u[a]){var c=u[a](e);if(i){if(n!=c)return null}else n=c,i=!0}}return n},setRenderOptionValueOfObjs:function(s,e,t){for(var n=Kekule.ArrayUtils.toArray(s),i=0,r=n.length;i<r;++i){var a=n[i];if(a.setRenderOption)for(var o=Kekule.ObjUtils.getOwnedFieldNames(e),l=0,u=o.length;l<u;++l)a.setRenderOption(o[l],e[o[l]])}}},Kekule.Render.Render3DOptionUtils={getOptionDefinitions:function(){return[{name:"displayMultipleBond",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"useVdWRadius",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"nodeRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"nodeRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"connectorLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"hideHydrogens",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"bondSpliceMode",dataType:DataType.INT,enumSource:Kekule.Render.Bond3DSpliceMode,targetClass:Kekule.ChemStructureObject}]},getConnectorRenderType:function(s){return s?s.renderType:null},convertConfigsToPlainHash:function(s){}},Kekule.Render.RenderColorUtils={getActiveAtomColorSet:function(s){return Kekule.Render.atomColors[s]},setActiveAtomColorSet:function(s,e){var t=Kekule.Render.AtomColorSets[s];return t&&(Kekule.Render.atomColorSet[e]=t),t},getColor:function(s,e){var t=Kekule.Render.RenderColorUtils.getActiveAtomColorSet(e),n=t[s];return n||(n=t[0]),n}},Kekule.Render.UpdateObjUtils={_extractObjsOfUpdateObjDetails:function(s){for(var e=[],t=0,n=s.length;t<n;++t){var i=s[t];i.obj&&Kekule.ArrayUtils.pushUnique(e,i.obj)}return e},_createUpdateObjDetailsFromObjs:function(s){for(var e=[],t=0,n=s.length;t<n;++t)e.push({obj:s[t]});return e}},function(){var s=Kekule.OBJDEF_TEXTS,e=Class.PropertyScope;Kekule.Render.PredefinedConfigsMap=Class.create(Kekule.ConfigPresetMap,{CLASS_NAME:"Kekule.Render.PredefinedConfigsMap"}),Kekule.Render.GeneralConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.GeneralConfigs",initProperties:function(){this.addBoolConfigProp("allowCoordBorrow",!0,{scope:e.PUBLIC}),this.addFloatConfigProp("drawOpacity",1,{title:s.TITLE_DRAWOPACITY,description:s.DES_DRAWOPACITY})}}),Kekule.Render.Render2DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs"),this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.MoleculeDisplayConfigs"),this.addConfigProp("displayLabelConfigs","Kekule.Render.DisplayLabelConfigs"),this.addConfigProp("textFontConfigs","Kekule.Render.TextFontConfigs"),this.addConfigProp("lengthConfigs","Kekule.Render.LengthConfigs"),this.addConfigProp("colorConfigs","Kekule.Render.ColorConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs),this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.MoleculeDisplayConfigs),this.setPropStoreFieldValue("displayLabelConfigs",new Kekule.Render.DisplayLabelConfigs),this.setPropStoreFieldValue("textFontConfigs",new Kekule.Render.TextFontConfigs),this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.LengthConfigs),this.setPropStoreFieldValue("colorConfigs",new Kekule.Render.ColorConfigs),this.setPropStoreFieldValue("environmentConfigs",new Kekule.Render.Render2DEnvironmentConfigs)},initInteractStyleMap:function(){}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.Render2DConfigs),Kekule.Render.getRender2DConfigs=function(){return Kekule.Render.Render2DConfigs.getInstance()},Kekule.Render.Render2DEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DEnvironmentConfigs",initProperties:function(){}}),Kekule.Render.MoleculeDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.MoleculeDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.MoleculeDisplayType.SKELETAL,{enumSource:Kekule.Render.MoleculeDisplayType}),this.addIntConfigProp("defNodeDisplayMode",Kekule.Render.NodeLabelDisplayMode.SMART,{enumSource:Kekule.Render.NodeLabelDisplayMode}),this.addIntConfigProp("defHydrogenDisplayLevel",Kekule.Render.HydrogenDisplayLevel.DEFAULT,{enumSource:Kekule.Render.HydrogenDisplayLevel}),this.addIntConfigProp("defChargeMarkType",Kekule.Render.ChargeMarkRenderType.DEFAULT,{enumSource:Kekule.Render.ChargeMarkRenderType}),this.addBoolConfigProp("distinguishSingletAndTripletRadical",!1),this.addIntConfigProp("partialChargeDecimalsLength",2),this.addBoolConfigProp("autoCreateChargeAndRadicalMarker",!0,{scope:Class.PropertyScope.PUBLIC}),this.addStrConfigProp("bondLineCap","round"),this.addStrConfigProp("bondLineJoin","miter"),this.addStrConfigProp("glyphLineCap","round"),this.addStrConfigProp("glyphLineJoin","miter")}}),Kekule.Render.DisplayLabelConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.DisplayLabelConfigs",DEF_UNSET_ELEMENT:"?",DEF_DUMMY_ATOM:"Du",DEF_HETERO_ATOM:"Q",DEF_ANY_ATOM:"A",DEF_VARIABLE_ATOM:"L",DEF_RGROUP:"R",DEF_ISO_LIST_LEADING_BRACKET:"[",DEF_ISO_LIST_TAILING_BRACKET:"]",DEF_ISO_LIST_DELIMITER:",",DEF_ISO_LIST_DISALLOW_PREFIX:"NOT",initProperties:function(){var t=Kekule.ChemStructureNodeLabels;this.addBoolConfigProp("enableIsotopeAlias",t.ENABLE_ISOTOPE_ALIAS,{getter:function(){return t.ENABLE_ISOTOPE_ALIAS},setter:function(n){t.ENABLE_ISOTOPE_ALIAS=n}}),this.addStrConfigProp("unsetElement",t.UNSET_ELEMENT,{getter:function(){return t.UNSET_ELEMENT},setter:function(n){n&&(t.UNSET_ELEMENT=n)}}),this.addStrConfigProp("dummyAtom",t.DUMMY_ATOM,{getter:function(){return t.DUMMY_ATOM},setter:function(n){n&&(t.DUMMY_ATOM=n)}}),this.addStrConfigProp("heteroAtom",t.HETERO_ATOM,{getter:function(){return t.HETERO_ATOM},setter:function(n){n&&(t.HETERO_ATOM=n)}}),this.addStrConfigProp("anyAtom",t.ANY_ATOM,{getter:function(){return t.ANY_ATOM},setter:function(n){n&&(t.ANY_ATOM=n)}}),this.addStrConfigProp("variableAtom",t.VARIABLE_ATOM,{getter:function(){return t.VARIABLE_ATOM},setter:function(n){n&&(t.VARIABLE_ATOM=n)}}),this.addStrConfigProp("rgroup",t.SUBGROUP,{getter:function(){return t.SUBGROUP},setter:function(n){n&&(t.SUBGROUP=n)}}),this.addStrConfigProp("isoListLeadingBracket",t.ISO_LIST_LEADING_BRACKET,{getter:function(){return t.ISO_LIST_LEADING_BRACKET},setter:function(n){n&&(t.ISO_LIST_LEADING_BRACKET=n)}}),this.addStrConfigProp("isoListTailingBracket",t.ISO_LIST_TAILING_BRACKET,{getter:function(){return t.ISO_LIST_TAILING_BRACKET},setter:function(n){n&&(t.ISO_LIST_TAILING_BRACKET=n)}}),this.addStrConfigProp("isoListDelimiter",t.ISO_LIST_DELIMITER,{getter:function(){return t.ISO_LIST_DELIMITER},setter:function(n){n&&(t.ISO_LIST_DELIMITER=n)}}),this.addStrConfigProp("isoListDisallowPrefix",t.ISO_LIST_DISALLOW_PREFIX,{getter:function(){return t.ISO_LIST_DISALLOW_PREFIX},setter:function(n){n&&(t.ISO_LIST_DISALLOW_PREFIX=n)}})}}),Kekule.Render.TextFontConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.TextFontConfigs",DEF_LABEL_FONT_FAMILY:"",initProperties:function(){this.addStrConfigProp("labelFontFamily","Arial, Helvetica, sans-serif"),this.addStrConfigProp("atomFontFamily","Arial, Helvetica, sans-serif"),this.addFloatConfigProp("supFontSizeRatio",.66),this.addFloatConfigProp("subFontSizeRatio",.66),this.addFloatConfigProp("superscriptOverhang",.2),this.addFloatConfigProp("subscriptOversink",.2),this.addIntConfigProp("textCharDirection",Kekule.Render.TextDirection.LTR,{enumSource:Kekule.Render.TextDirection}),this.addIntConfigProp("textHorizontalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign}),this.addIntConfigProp("textVerticalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign}),this.addIntConfigProp("textBoxXAlignment",Kekule.Render.BoxXAlignment.LEFT,{enumSource:Kekule.Render.BoxXAlignment,scope:e.PUBLIC}),this.addIntConfigProp("textBoxYAlignment",Kekule.Render.BoxYAlignment.TOP,{enumSource:Kekule.Render.BoxYAlignment,scope:e.PUBLIC}),this.addIntConfigProp("textBoxAlignmentMode",Kekule.Render.TextBoxAlignmentMode.ANCHOR,{enumSource:Kekule.Render.TextBoxAlignmentMode,scope:e.PUBLIC})}}),Kekule.Render.LengthConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.LengthConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:e.PUBLIC}),this.addFloatConfigProp("labelFontSize",14),this.addFloatConfigProp("atomFontSize",14),this.addFloatConfigProp("atomLabelBoxExpandRatio",1.2,{scope:e.PUBLIC}),this.addFloatConfigProp("chargeMarkFontSize",10),this.addFloatConfigProp("chargeMarkMargin",5),this.addFloatConfigProp("chemMarkerFontSize",10),this.addFloatConfigProp("chemMarkerMargin",5),this.addFloatConfigProp("allenCenterAtomRadius",3),this.addFloatConfigProp("defBondLength",25),this.addFloatConfigProp("bondLineWidth",1),this.addFloatConfigProp("boldBondLineWidthRatio",2,{scope:e.PUBLIC}),this.addFloatConfigProp("hashSpacing",3),this.addFloatConfigProp("multipleBondSpacingRatio",.18),this.addFloatConfigProp("multipleBondSpacingAbs",null,{scope:e.PUBLIC}),this.addFloatConfigProp("multipleBondMaxAbsSpacing",5),this.addFloatConfigProp("bondArrowLength",6),this.addFloatConfigProp("bondArrowWidth",6),this.addFloatConfigProp("bondWedgeWidth",6),this.addFloatConfigProp("bondWedgeHashMinWidth",2),this.addFloatConfigProp("bondWavyRadius",5),this.addFloatConfigProp("glyphStrokeWidth",1),this.addFloatConfigProp("glyphStickOffsetRelLength",.1),this.addFloatConfigProp("rxnMolMargin",10,{scope:e.PUBLIC}),this.addFloatConfigProp("defScaleRefLength",Kekule.globalOptions.structure.defaultBondLength2D||.8),this.addFloatConfigProp("autofitContextPadding",45)},getActualLength:function(t){var n=this.getPropValue(t);return n!=null?n*this.getUnitLength():null}}),Kekule.Render.ColorConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.ColorConfigs",initProperties:function(){this.addBoolConfigProp("useAtomSpecifiedColor",!1),this.addStrConfigProp("labelColor","#000000"),this.addStrConfigProp("atomColor","#000000"),this.addStrConfigProp("bondColor","#000000"),this.addStrConfigProp("glyphStrokeColor","#999999"),this.addStrConfigProp("glyphFillColor","#999999")}}),Kekule.Render.Render3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs"),this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.Molecule3DDisplayConfigs"),this.addConfigProp("lengthConfigs","Kekule.Render.Length3DConfigs"),this.addConfigProp("environmentConfigs","Kekule.Render.Render3DEnvironmentConfigs"),this.addConfigProp("modelConfigs","Kekule.Render.Model3DConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs),this.setPropStoreFieldValue("environmentConfigs",new Kekule.Render.Render3DEnvironmentConfigs),this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.Molecule3DDisplayConfigs),this.setPropStoreFieldValue("modelConfigs",new Kekule.Render.Model3DConfigs),this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.Length3DConfigs)}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.Render3DConfigs),Kekule.Render.getRender3DConfigs=function(){return Kekule.Render.Render3DConfigs.getInstance()},Kekule.Render.Render3DEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DEnvironmentConfigs",initProperties:function(){this.addIntConfigProp("graphicQuality",Kekule.Render.Render3DGraphicQuality.MEDIUM,{enumSource:Kekule.Render.Render3DGraphicQuality}),this.addBoolConfigProp("antialias",!0)}}),Kekule.Render.Molecule3DDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Molecule3DDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.Molecule3DDisplayType.BALL_STICK,{enumSource:Kekule.Render.Molecule3DDisplayType}),this.addIntConfigProp("defBondSpliceMode",Kekule.Render.Bond3DSpliceMode.WEIGHTING_SPLIT,{enumSource:Kekule.Render.Bond3DSpliceMode}),this.addBoolConfigProp("defDisplayMultipleBond",!0),this.addStrConfigProp("defBondColor","#FFFFFF"),this.addStrConfigProp("defAtomColor","#000099"),this.addBoolConfigProp("useAtomSpecifiedColor",!0)}}),Kekule.Render.Model3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Model3DConfigs",initProperties:function(){this.addBoolConfigProp("showNodeLabel",!0,{scope:e.PUBLIC}),this.addBoolConfigProp("hideHydrogens",!1),this.addBoolConfigProp("useVdWRadius",!0),this.addFloatConfigProp("nodeRadiusRatio",.25,{scope:e.PUBLIC}),this.addFloatConfigProp("connectorRadiusRatio",.25,{scope:e.PUBLIC}),this.addFloatConfigProp("multiConnectorRadiusRatio",.5),this.addFloatConfigProp("multiConnectorMarginRatio",1)}}),Kekule.Render.Length3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Length3DConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:e.PUBLIC}),this.addFloatConfigProp("fixedNodeRadius",1.7),this.addFloatConfigProp("connectorRadius",.6),this.addFloatConfigProp("connectorLineWidth",2),this.addFloatConfigProp("defBondLength",100,{scope:e.PUBLIC})},getActualLength:function(t){var n=this.getPropValue(t);return n!=null?n*this.getUnitLength():null}})}(),function(){var s=Kekule.Render.RichText,e=Kekule.Render.RichTextUtils,t=Kekule.Render.TextDirection,n=Kekule.Render.TextDrawUtils,i=Kekule.Render.TextAlign;Kekule.Render.AbstractTextDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.AbstractTextDrawBridge",drawText:function(r,a,o,l){return null},canMeasureText:function(r){return!1},measureText:function(r,a,o){return{}},canMeasureDrawnText:function(r){return!1},measureDrawnText:function(r,a,o){return{}},canModifyText:function(r){return!1},modifyDrawnTextCoord:function(r,a,o){},createGroup:function(r){},addToGroup:function(r,a){},removeFromGroup:function(r,a){}}),Kekule.Render.BaseRichTextDrawer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BaseRichTextDrawer",ITEM_PARENT_FIELD:"__$parent__",initialize:function(r,a,o){this.tryApplySuper("initialize"),this.options=a||{},r&&this.setDrawBridge(r),o&&this.setDrawConfigs(o)},initProperties:function(){this.defineProp("drawBridge",{dataType:"Kekule.Render.AbstractTextDrawBridge",serializable:!1}),this.defineProp("drawConfigs",{dataType:"Kekule.Render.Render2DConfigs",serializable:!1})},fillOptions:function(r){if(r){var a=r.getTextFontConfigs(),o=this.options;o.supFontSizeRatio=a.getSupFontSizeRatio(),o.subFontSizeRatio=a.getSubFontSizeRatio(),o.superscriptOverhang=a.getSuperscriptOverhang(),o.subscriptOversink=a.getSubscriptOversink(),o.textCharDirection=a.getTextCharDirection(),o.textLineDirection=a.getTextLineDirection(),o.textHorizontalAlign=a.getTextHorizontalAlign(),o.textVerticalAlign=a.getTextVerticalAlign(),o.textBoxXAlignment=a.getTextBoxXAlignment(),o.textBoxYAlignment=a.getTextBoxYAlignment(),o.textBoxAlignmentMode=a.getTextBoxAlignmentMode()}},cloneRichText:function(r){return Kekule.Render.RichTextUtils.clone(r)},_FONT_OPTION_FIELDS:["fontSize","fontFamily","fontWeight","fontStyle","color","overhang","oversink","opacity","zoom","transforms"],_DRAW_OPTIONS_FIELDS:["textType","charDirection","defaultCharDirection","fontSize","fontFamily","fontWeight","fontStyle","color","horizontalAlign","verticalAlign","zoom","transforms"],_fillLocalDrawOptions:function(r,a){for(var o=a||{},l=0,u=this._DRAW_OPTIONS_FIELDS.length;l<u;++l){var c=this._DRAW_OPTIONS_FIELDS[l],d=r[c];Kekule.ObjUtils.notUnset(d)&&(o[c]=d)}return Kekule.ObjUtils.isUnset(r.charDirection)?o.charDirection=t.DEFAULT:r.charDirection===t.INHERIT&&(o.charDirection=a.charDirection),o},RECT_INFO_FIELD:"__rectInfo__",ACTUAL_FONT_FIELD:"__drawFont__",RENDER_TEXT_FIELD:"__renderText__",RENDER_ELEM_FIELD:"__renderElem__",LOCAL_DRAW_OPTIONS_FIELD:"__drawOptions__",_setItemRectInfo:function(r,a,o){r[this.RECT_INFO_FIELD]={boundRect:Object.extend({},a),alignRect:Object.extend({},o)}},_getItemRectInfo:function(r){return r[this.RECT_INFO_FIELD]},_setActualFontInfo:function(r,a){r[this.ACTUAL_FONT_FIELD]=a},_getActualFontInfo:function(r){return r[this.ACTUAL_FONT_FIELD]},_setRenderText:function(r,a){r[this.RENDER_TEXT_FIELD]=a},_getRenderText:function(r){return r[this.RENDER_TEXT_FIELD]||r.text},_setRenderElem:function(r,a){r[this.RENDER_ELEM_FIELD]=a},_getRenderElem:function(r){return r[this.RENDER_ELEM_FIELD]},_itemHasNoAlignRect:function(r){return Kekule.ObjUtils.notUnset(r._noAlignRect)?!!r._noAlignRect:e.isSubscript(r)||e.isSuperscript(r)},drawEx:function(r,a,o,l,u){var c=this.doPrepareDrawOptions(r,o,l),d=this.cloneRichText(o),h=this.getDrawBridge(),p={delayDrawing:h.canMeasureText(),adjustDrawing:h.canModifyText()};this.doPrepare(r,a,d,c,p,[]);var g=this.doRenderRichText(r,d,c,p),f=this._getItemRectInfo(d);return{drawnObj:g,boundRect:f.boundRect,alignRect:f.alignRect}},draw:function(r,a,o,l,u){return this.drawEx(r,a,o,l,u).drawnObj},measure:function(r,a,o,l,u){var c=this.doPrepareDrawOptions(r,o,l);a||(a={x:0,y:0});var d=this.cloneRichText(o),h=this.getDrawBridge(),p={delayDrawing:h.canMeasureText(),adjustDrawing:h.canModifyText()},g=[];this.doPrepare(r,a,d,c,p,g);var f=this._getItemRectInfo(d);if(g.length&&h.removeDrawnElem)for(var m=0,C=g.length;m<C;++m){var _=g[m];h.removeDrawnElem(r,_)}return f.boundRect},doPrepareDrawOptions:function(r,a,o){var l;return o?(l=Object.create(this.options||{}),l=Object.extend(l,o)):l=this.options,l.defaultCharDirection||(l.defaultCharDirection=l.charDirection),l},doPrepare:function(r,a,o,l,u,c){var d=this.doPrepareItem(r,o,l,u,c),h=null;l.textBoxAlignmentMode===Kekule.Render.TextBoxAlignmentMode.ANCHOR&&(h=this.doGetRootAnchorItemAbsAlignRect(o));var p,g=this._getItemRectInfo(o);if(h){var f=this.doAlignRectToCoord(a,h,l.textBoxXAlignment,l.textBoxYAlignment);p={x:f.left-h.left,y:f.top-h.top}}else{var m=this.doAlignRectToCoord(a,g.alignRect,l.textBoxXAlignment,l.textBoxYAlignment);p={x:m.left-g.alignRect.left,y:m.top-g.alignRect.top}}var C=Kekule.RectUtils.shiftRect(g.alignRect,p.x,p.y),_=Kekule.RectUtils.shiftRect(g.boundRect,p.x,p.y);return this._setItemRectInfo(o,_,C),d},doAlignRectToCoord:function(r,a,o,l){var u=Kekule.Render.BoxXAlignment,c=Kekule.Render.BoxYAlignment,d=o===u.RIGHT?-1:o===u.CENTER?-.5:0,h=l===c.TOP?0:l===c.CENTER?-.5:-1,p=Object.extend({},a);return p.left=r.x+p.width*d,p.top=r.y+p.height*h,p},doGetRootAnchorItemAbsAlignRect:function(r){var a=r;if(a.anchorItem){for(var o=this._getItemRectInfo(a).alignRect,l={x:o.left,y:o.top};a.anchorItem;)a=a.anchorItem,o=this._getItemRectInfo(a).alignRect,l.x+=o.left,l.y+=o.top;return Kekule.RectUtils.createRect(l.x,l.y,o.width,o.height)}return null},doCalcActualDrawFontInfo:function(r,a){function o(h,p){if(typeof h=="string"){var g=Kekule.StyleUtils.analysisUnitsValue(h);return g.value=Math.round(Math.max(g.value*p,1)),""+g.value+g.units}return h*p}for(var l={sizeScale:1},u=0,c=this._FONT_OPTION_FIELDS.length;u<c;++u){var d=this._FONT_OPTION_FIELDS[u];Kekule.ObjUtils.notUnset(a[d])&&(l[d]=a[d])}return Kekule.ObjUtils.notUnset(l.zoom)&&(l.fontSize=o(l.fontSize,l.zoom||1),l.zoom=null),e.isSuperscript(r)?(l.sizeScale=a.supFontSizeRatio,l.fontSize=o(l.fontSize,a.supFontSizeRatio),l.isSup=!0,Kekule.ObjUtils.isUnset(l.overhang)&&(l.overhang=a.superscriptOverhang||0)):e.isSubscript(r)&&(l.sizeScale=a.subFontSizeRatio,l.fontSize=o(l.fontSize,a.subFontSizeRatio),l.isSub=!0,Kekule.ObjUtils.isUnset(l.oversink)&&(l.oversink=a.subscriptOversink||0)),l},doPrepareItem:function(r,a,o,l,u){var c,d=e.getItemType(a),h=Object.create(o);switch(((h=this._fillLocalDrawOptions(a,h)).charDirection===t.DEFAULT||Kekule.ObjUtils.isUnset(h.charDirection))&&(h.charDirection=h.defaultCharDirection),d){case s.SECTION:c=this.doPrepareSection(r,a,h,l,u);break;case s.LINES:c=this.doPrepareLines(r,a,h,l,u);break;default:c=this.doPrepareGroup(r,a,h,l,u)}return c},doPrepareSection:function(r,a,o,l,u){var c=this.getDrawBridge(),d=this.doCalcActualDrawFontInfo(a,o);this._setActualFontInfo(a,d);var h,p=a.text;if(n.isVerticalLine(o.charDirection)&&p.length>1){var g=a;g.role="group",delete g.text,g.charDirection=o.charDirection;var f=Object.create(o);f=Object.extend(f,d),g.items=[];for(var m=0,C=p.length;m<C;++m)e.appendText(g,p.charAt(m));return this.doPrepareItem(r,g,f,l,u)}if(o.charDirection===t.RTL&&(p=p.reverse()),this._setRenderText(a,p),l.delayDrawing)h=c.measureText(r,p,d);else{var _=this.getDrawBridge().drawText(r,{x:-1e4,y:-1e4},p,d);this._setRenderElem(a,_),h=c.measureDrawnText(r,_,d),u.push(_)}var y={left:0,top:0,width:h.width||0,height:h.height||0};this._setItemRectInfo(a,y,y)},doPrepareLines:function(r,a,o,l,u){for(var c=o.charDirection||t.DEFAULT,d=a.items,h=c===t.TTB?t.RTL:c===t.BTT?t.LTR:t.TTB,p=0,g=d.length;p<g;++p){var f=d[p];f.charDirection||(f.charDirection=c)}return a.charDirection=h,o.charDirection=h,o._originCharDirection=c,this.doPrepareGroup(r,a,o,l,u)},doPrepareGroup:function(r,a,o,l,u){for(var c=0,d=(Y=a.items).length;c<d;++c){var h=Y[c];this.doPrepareItem(r,h,o,l,u)}var p,g=o.charDirection||t.DEFAULT,f=o._originCharDirection||g,m=n.isHorizontalLine(g),C=m?"x":"y",_=m?"y":"x",y=i.getAbsAlign(o.horizontalAlign,f),T=i.getAbsAlign(o.verticalAlign,f);p=m?T==i.TOP?0:T==i.CENTER?-.5:-1:y==i.RIGHT?-1:y==i.CENTER?-.5:0;var E={x:0,y:0},b=g===t.RTL||g===t.BTT?-1:1,v=m?"left":"top",I=m?"top":"left",R=[];for(c=0,d=Y.length;c<d;++c){h=Y[c];var N=(q=this._getItemRectInfo(h)).boundRect,L=q.alignRect;if(b>0){var U=E[C]-N[v];N[v]=E[C],L[v]+=U}var W={x:N.width,y:N.height};if(E[C]+=W[C]*b,b<0&&(U=E[C]-N[v],N[v]=E[C],L[v]+=U),W={x:L.width,y:L.height},($=this._getActualFontInfo(h))&&($.isSup||$.isSub)&&e.getActualRefItem(h,a))R.push(h);else{var M=$?$.oversink||-($.overhang||0):0;m||(M=-M);var B=W[_]*(p+M),V=L[I]-B;L[I]=B,N[I]-=V}}for(c=0,d=R.length;c<d;++c){h=R[c];var J=e.getActualRefItem(h,a),$=this._getActualFontInfo(h),q=this._getItemRectInfo(h),Q=this._getItemRectInfo(J).alignRect;if(N=q.boundRect,L=q.alignRect,$.isSup){var ie=$.overhang;m?(L.top=Q.top,L.height=Q.height,N.top=Q.top-Q.height*ie):(L.left=Q.left,L.width=Q.width,N.left=Q.lefy+Q.width-N.left+Q.width*ie)}else M=$.oversink,m?(L.top=Q.top,L.height=Q.height,N.top=Q.top+Q.height-N.height+Q.height*M):(L.left=Q.left,L.width=Q.width,N.left=Q.left-Q.width*M)}var Y,ne=null,de=null;for(c=0,d=(Y=a.items).length;c<d;++c)h=Y[c],q=this._getItemRectInfo(h),this._itemHasNoAlignRect(h)&&(ne||c!=d-1)||(ne=ne?Kekule.RectUtils.getContainerRect(ne,q.alignRect):Object.extend({},q.alignRect)),de=de?Kekule.RectUtils.getContainerRect(de,q.boundRect):Object.extend({},q.boundRect);if(Y.length<=0&&(ne=Kekule.RectUtils.createRect(0,0,0,0),de=Kekule.RectUtils.createRect(0,0,0,0)),(V={x:-ne.left,y:-ne.top}).x!==0||V.y!==0){for(c=0,d=Y.length;c<d;++c)(q=this._getItemRectInfo(Y[c])).alignRect=Kekule.RectUtils.shiftRect(q.alignRect,V.x,V.y),q.boundRect=Kekule.RectUtils.shiftRect(q.boundRect,V.x,V.y);ne.left=0,ne.top=0,de.left+=V.x,de.top+=V.y}this._setItemRectInfo(a,de,ne)},doRenderRichText:function(r,a,o,l){var u=this.getDrawBridge().createGroup(r);return this.doRenderItem(r,{x:0,y:0},a,l,u),u},doRenderItem:function(r,a,o,l,u){var c;switch(e.getItemType(o)){case s.SECTION:c=this.doRenderSection(r,a,o,l,u);break;default:c=this.doRenderGroup(r,a,o,l,u)}return c},doRenderGroup:function(r,a,o,l,u){var c=o.items;if(c.length<=0)return null;for(var d=this._getItemRectInfo(o),h={x:a.x+d.alignRect.left,y:a.y+d.alignRect.top},p=0,g=c.length;p<g;++p)this.doRenderItem(r,h,c[p],l,u)},doRenderSection:function(r,a,o,l,u){var c=this._getItemRectInfo(o).boundRect,d={x:c.left,y:c.top};d=Kekule.CoordUtils.add(d,a);var h,p=this._getRenderText(o),g=this._getActualFontInfo(o),f=this.getDrawBridge();l.delayDrawing?h=f.drawText(r,d,p,g):l.adjustDrawing&&(h=this._getRenderElem(o),f.modifyDrawnTextCoord(r,h,d)),f.addToGroup(h,u)}})}(),Kekule.Render.BoundInfoRecorder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BoundInfoRecorder",initialize:function(s){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("boundInfos",new Kekule.TwoTupleMapEx(!0)),this._renderer=s,s&&s.setBoundInfoRecorder&&s.setBoundInfoRecorder(this),this.installEventListener(s)},finalize:function(){this._renderer&&this.uninstallEventListener(this._renderer);var s=this.getPropStoreFieldValue("boundInfos");s&&s.clear(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("boundInfos",{dataType:"Kekule.TwoTupleMapEx",serializable:!1,setter:null}),this.defineProp("targetContext",{dataType:DataType.OBJECT,serializable:!1})},needRecordOnContext:function(s){var e=this.getTargetContext();return!e||e===s},installEventListener:function(s){s.addEventListener("updateBasicDrawObject",this._reactRendererUpdateBasicDrawObject,this),s.addEventListener("clear",this._reactRendererClear,this)},uninstallEventListener:function(s){s.removeEventListener("updateBasicDrawObject",this._reactRendererUpdateBasicDrawObject,this),s.removeEventListener("clear",this._reactRendererClear,this)},_reactRendererUpdateBasicDrawObject:function(s){var e=Kekule.Render.ObjectUpdateType;if(this.needRecordOnContext(s.context)){var t=s.updateType;t===e.ADD?this.add(s.context,s.obj,s.parentObj,s.boundInfo,s.target):t===e.MODIFY?this.modify(s.context,s.obj,s.parentObj,s.boundInfo,s.target):t===e.REMOVE?this.remove(s.context,s.obj):t===e.CLEAR&&this.clear(s.context),this.invokeEvent("updateBasicDrawObject",s)}},_reactRendererClear:function(s){this.needRecordOnContext(s.context)&&this.clearOnRenderer(s.context,s.target),this.getAllRecordedInfoOfContext(s.context)},getInfo:function(s,e){return this.getBoundInfos().get(s,e)},getBelongedInfos:function(s,e){if(a=this.getInfo(s,e))return[a];for(var t=[],n=this.getAllRecordedInfoOfContext(s),i=0,r=n.length;i<r;++i){var a,o=(a=n[i]).obj;(o===e||o.isChildOf&&o.isChildOf(e))&&t.push(a)}return t},getBound:function(s,e){var t=(u=this.getInfo(s,e))?u.boundInfo:null;if(!t){for(var n=Kekule.BoxUtils,i=Kekule.Render.MetaShapeUtils,r=this.getBelongedInfos(s,e),a=null,o=0,l=r.length;o<l;++o){var u=r[o],c=i.getContainerBox(u.boundInfo,0);a=a?n.getContainerBox(a,c):c}a&&(t=i.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2}]))}return t},clearOnRenderer:function(s,e){var t=(i=this.getBoundInfos()).getSecondLevelMap(s);if(t)for(var n=t.getKeys(),i=t.getValues(),r=n.length-1;r>=0;--r){var a=n[r];i[r].renderer===e&&t.remove(a)}},clear:function(s){var e=this.getBoundInfos().getSecondLevelMap(s);return e&&e.clear(),this},clearAll:function(){return this.getBoundInfos().clear(),this},add:function(s,e,t,n,i){return this.getBoundInfos().set(s,e,{obj:e,parentObj:t,boundInfo:n,renderer:i}),this},modify:function(s,e,t,n,i){var r=this.getBoundInfos().get(s,e);r||(r={},this.getBoundInfos.set(s,e,r));var a=Kekule.ObjUtils.notUnset;return a(t)&&(r.parentObj=t),a(n)&&(r.boundInfo=n),a(i)&&(r.renderer=i),this},remove:function(s,e,t){return this.getBoundInfos().remove(s,e),this},getAllRecordedInfoOfContext:function(s){var e=this.getBoundInfos().getSecondLevelMap(s);return e?e.getValues():[]},getAllBoundInfosOfContext:function(s){for(var e=this.getAllRecordedInfoOfContext(s),t=[],n=0,i=e.length;n<i;++n){var r=e[n].boundInfo;r&&t.push(r)}return t},getContainerBox:function(s){for(var e=Kekule.BoxUtils,t=Kekule.Render.MetaShapeUtils,n=null,i=this.getAllBoundInfosOfContext(s),r=0,a=i.length;r<a;++r){var o=t.getContainerBox(i[r],0);n=e.getContainerBox(n,o)}return n},getIntersectionInfos:function(s,e,t,n,i){for(var r=[],a=this.getAllRecordedInfoOfContext(s),o=0,l=a.length;o<l;++o){var u=a[o].boundInfo;i&&!i(a[o])||u&&Kekule.Render.MetaShapeUtils.isCoordInside(e,u,n)&&r.push(a[o])}return r}}),function(){var s=Kekule.Render.BondRenderType,e=Kekule.Render.TextDirection,t=Kekule.BoxUtils,n=Kekule.BondOrder,i=Kekule.CoordUtils,r=Kekule.oneOf;Kekule.Render.Abstract2DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract2DDrawBridge",CONTEXT_PARAMS_FIELD:"__$context_params__",createContext:function(a,o,l,u){return null},releaseContext:function(a){},getContextParam:function(a,o){return(a[this.CONTEXT_PARAMS_FIELD]||{})[o]},setContextParam:function(a,o,l){a[this.CONTEXT_PARAMS_FIELD]||(a[this.CONTEXT_PARAMS_FIELD]={}),a[this.CONTEXT_PARAMS_FIELD][o]=l},_getOverSamplingRatio:function(a){return this.getContextParam(a,"overSamplingRatio")||null},getContextDimension:function(a){var o=this._getContextRawDimension(a),l=this._getOverSamplingRatio(a);return l&&(o.width/=l,o.height/=l),o},_getContextRawDimension:function(a){return{}},setContextDimension:function(a,o,l){var u={width:o,height:l},c=this._getOverSamplingRatio(a);c&&(u.width*=c,u.height*=c),this._setContextRawDimension(a,u.width,u.height)},_setContextRawDimension:function(a,o,l){return null},getContextElem:function(a){},setContextViewBox:function(a,o,l,u,c,d){},prepareContext:function(a){},clearContext:function(a){return null},setClearColor:function(a,o){},setFilter:function(a,o){},clearFilter:function(a){},transformContextCoordToScreen:function(a,o){var l=o,u=this._getOverSamplingRatio(a);return u&&(l=Kekule.CoordUtils.divide(l,u)),l},transformScreenCoordToContext:function(a,o){var l=o,u=this._getOverSamplingRatio(a);return u&&(l=Kekule.CoordUtils.multiply(l,u)),l},transformContextLengthToScreen:function(a,o){var l=o,u=this._getOverSamplingRatio(a);return u&&(l/=u),l},transformScreenLengthToContext:function(a,o){var l=o,u=this._getOverSamplingRatio(a);return u&&(l*=u),l},canModifyGraphic:function(a){return!1},drawPath:function(a,o,l){},drawLine:function(a,o,l,u){},drawTriangle:function(a,o,l,u,c){},drawRect:function(a,o,l,u){},drawRoundRect:function(a,o,l,u,c){},drawCircle:function(a,o,l,u){},drawArc:function(a,o,l,u,c,d,h){},drawImage:function(a,o,l,u,c,d){},drawImageElem:function(a,o,l,u,c){},createGroup:function(a){return null},addToGroup:function(a,o){},removeFromGroup:function(a,o){},removeDrawnElem:function(a,o){},exportToDataUri:function(a,o,l){}}),Kekule.Render.Base2DRenderer=Class.create(Kekule.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base2DRenderer",initialize:function(a,o,l){this.tryApplySuper("initialize",[a,o,l]),this.__$redirectContextDebug__=!1,this._richTextDrawer=null},initProperties:function(){this.defineProp("richTextDrawerClass",{dataType:DataType.CLASS,serializable:!1})},getActualTargetContext:function(a){return this.getRedirectContext()||a},getRendererType:function(){return Kekule.Render.RendererType.R2D},canMeasureText:function(a){return this.getDrawBridge().canMeasureText(a)},getAutoScaleRefDrawLength:function(a){return a.defBondLength},getAutoScaleRefObjLength:function(a,o){var l=a||this.getChemObj();if(!l.getAllAutoScaleRefLengths)return null;var u=l.getAllAutoScaleRefLengths(Kekule.CoordMode.COORD2D,o);return u&&u.length?Kekule.ArrayUtils.getMedian(u):void 0},getRichTextDrawer:function(){if(!this._richTextDrawer){var a=this.getRichTextDrawerClass()||Kekule.Render.BaseRichTextDrawer;this._richTextDrawer=new a(this.getDrawBridge())}return this._richTextDrawer},drawPath:function(a,o,l){return this.getDrawBridge().drawPath(this.getActualTargetContext(a),o,l)},drawLine:function(a,o,l,u){if(this.__$redirectContextDebug__){var c=Object.create(u);return this.getRedirectContext()&&(c.color=c.strokeColor="#ff0000"),this.getDrawBridge().drawLine(this.getActualTargetContext(a),o,l,c)}return this.getDrawBridge().drawLine(this.getActualTargetContext(a),o,l,u)},drawArrowLine:function(a,o,l,u,c){var d=this.getActualTargetContext(a);if(u){var h=this.createDrawGroup(d),p=this.drawLine(d,o,l,c);this.addToDrawGroup(p,h);var g=l.x-o.x,f=l.y-o.y,m=Math.atan(f/g),C=Math.sign(g)||1,_=(u.width||6)/2,y=u.length||3,T=Math.atan(_/y),E=Math.sqrt(Math.sqr(_)+Math.sqr(y))*C,b=Math.cos(m-T)*E,v=Math.sin(m-T)*E,I=Math.cos(m+T)*E,R=Math.sin(m+T)*E;return p=this.drawLine(d,l,{x:l.x-b,y:l.y-v},c),this.addToDrawGroup(p,h),p=this.drawLine(d,l,{x:l.x-I,y:l.y-R},c),this.addToDrawGroup(p,h),h}return this.drawLine(d,o,l,c)},drawTriangle:function(a,o,l,u,c){return this.getDrawBridge().drawTriangle(this.getActualTargetContext(a),o,l,u,c)},drawRect:function(a,o,l,u){var c={x:Math.min(o.x,l.x),y:Math.min(o.y,l.y)},d={x:Math.max(o.x,l.x),y:Math.max(o.y,l.y)};return this.getDrawBridge().drawRect(this.getActualTargetContext(a),c,d,u)},drawRoundRect:function(a,o,l,u,c){var d={x:Math.min(o.x,l.x),y:Math.min(o.y,l.y)},h={x:Math.max(o.x,l.x),y:Math.max(o.y,l.y)};return this.getDrawBridge().drawRoundRect(this.getActualTargetContext(a),d,h,u,c)},drawCircle:function(a,o,l,u){return this.getDrawBridge().drawCircle(this.getActualTargetContext(a),o,l,u)},drawArc:function(a,o,l,u,c,d,h){return this.getDrawBridge().drawArc(this.getActualTargetContext(a),o,l,u,c,d,h)},drawText:function(a,o,l,u){var c=this.getRichTextDrawer(),d=Kekule.Render.RichTextUtils.strToRichText(l,u);if(this.__$redirectContextDebug__){var h=Object.create(u||{});return this.getRedirectContext()&&(h.color=h.strokeColor="#ff0000"),c.drawEx(this.getActualTargetContext(a),o,d,h)}return c.drawEx(this.getActualTargetContext(a),o,d,u)},drawRichText:function(a,o,l,u){var c=this.getRichTextDrawer();if(this.__$redirectContextDebug__){var d=Object.create(u||{});return this.getRedirectContext()&&(d.color=d.strokeColor="#ff0000"),c.drawEx(this.getActualTargetContext(a),o,l,d)}return c.drawEx(this.getActualTargetContext(a),o,l,u)},measureRichText:function(a,o,l,u){return this.getRichTextDrawer().measure(a,o,l,u)},drawImage:function(a,o,l,u,c,d){var h=this;return this.getDrawBridge().drawImage(this.getActualTargetContext(a),o,l,u,c,d,function(){return h.getActualTargetContext(a)})},drawImageElem:function(a,o,l,u,c){if(o.complete)return this.getDrawBridge().drawImageElem(this.getActualTargetContext(a),o,l,u,c);var d=Kekule.X.Event;if(d){var h=this,p=function(){d.removeListener(o,"load",g)},g=function(){p(),h.update(h.getActualTargetContext(a),[{obj:h.getChemObj()}],Kekule.Render.ObjectUpdateType.MODIFY)};d.addListener(o,"load",g),d.addListener(o,"error",p)}},createDrawGroup:function(a){return this.getDrawBridge().createGroup(this.getActualTargetContext(a))},addToDrawGroup:function(a,o){return this.getDrawBridge().addToGroup(a,o)},removeFromDrawGroup:function(a,o){return this.getDrawBridge().removeFromGroup(a,o)},removeDrawnElem:function(a,o){return this.getDrawBridge().removeDrawnElem(this.getActualTargetContext(a),o)},transformScreenCoordToContext:function(a,o){return this.doTransformScreenCoordToContext(this.getActualTargetContext(a),o)},doTransformScreenCoordToContext:function(a,o){var l=this.getDrawBridge();return l&&l.transformScreenCoordToContext?l.transformScreenCoordToContext(this.getActualTargetContext(a),o):o}}),Kekule.Render.ChemObj2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj2DRenderer",_getRenderSortIndex:function(){var a=this.getChemObj();return a&&a.coordStickTarget&&a.getCoordStickTarget()?1:this.tryApplySuper("_getRenderSortIndex")},doEstimateSelfObjBox:function(a,o,l){return Kekule.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),l)},doEstimateRenderBox:function(a,o,l,u){var c=this.estimateObjBox(a,l,u);if(c){var d=this.prepareTransformParams(a,o,l,c);return t.transform2D(c,d)}return null},doGetAutoBaseCoord:function(a){var o=a.transformParams;if(o){var l=this.getChemObj(),u=l.getAbsBaseCoord?l.getAbsBaseCoord(Kekule.CoordMode.COORD2D):l.getAbsBaseCoord2D?l.getAbsBaseCoord2D():null;if(u)return Kekule.CoordUtils.transform2D(u,o)}return null},doDraw:function(a,o,l){var u=this.getAutoScaleRefObjLength(this.getChemObj(),l.allowCoordBorrow);return l.medianObjRefLength=u||l.defScaleRefLength,this.prepareTransformParams(a,o,l),this.prepareGeneralOptions(a,l),this.tryApplySuper("doDraw",[a,o,l])},prepareGeneralOptions:function(a,o){},prepareTransformParams:function(a,o,l,u){var c;if(l.transformParams)c=l.transformParams;else{l.unitLength||(l.unitLength=1);var d=this.getDrawBridge()._getOverSamplingRatio(a);d&&d!==1&&(l.unitLength*=d);var h=this.generateTransformParams(a,o,l,u);l.transformParams=h,c=h,l.transformParams.zoom&&(l.zoom=l.transformParams.zoom)}var p=Kekule.CoordUtils.calcTransform2DMatrix(c),g=Kekule.CoordUtils.calcInverseTransform2DMatrix(c);l.transformParams.transformMatrix=p,l.transformParams.invTransformMatrix=g,this.getRenderCache(a).transformParams=c,this.getRenderCache(a).transformMatrix=p,this.getRenderCache(a).invTransformMatrix=g;var f=this.calcContextRefLengthes(a,l,p);return l.contextRefLengthes={x:f.contextRefLengthX,y:f.contextRefLengthY,xy:f.contextRefLengthXY},c},calcContextRefLengthes:function(a,o,l){var u=o.defScaleRefLength,c=i.transform2DByMatrix({x:0,y:0},l),d=i.transform2DByMatrix({x:u,y:0},l),h=i.transform2DByMatrix({x:0,y:u},l),p=i.transform2DByMatrix({x:u,y:u},l);return{contextRefLengthX:i.getDistance(d,c),contextRefLengthY:i.getDistance(h,c),contextRefLengthXY:i.getDistance(p,c)/Math.sqrt(2)}},calcPreferedTransformOptions:function(a,o,l,u){var c={};c.allowCoordBorrow=r(l.allowCoordBorrow,!1),c.unitLength=l.unitLength||1,u||(u=this.estimateObjBox(a,l,c.allowCoordBorrow)),u||(u={x1:0,x2:1,y1:0,y2:1});var d={x:(u.x1+u.x2)/2,y:(u.y1+u.y2)/2},h=Kekule.ObjUtils;if(h.isUnset(l.translateX)&&h.isUnset(l.translateY)?o&&(c.translateX=o.x-d.x,c.translateY=o.y-d.y):(c.translateX=l.translateX||0,c.translateY=l.translateY||0),c.zoom=l.zoom||1,l.scale||l.scaleX||l.scaleY)c.scaleX=r(l.scaleX,l.scale,1),c.scaleY=r(l.scaleY,l.scale,1);else{var p,g=(r(l.refDrawLength,this.getAutoScaleRefDrawLength(l))||1)*c.unitLength,f=l.medianObjRefLength;if(Kekule.ObjUtils.isUnset(f)&&(f=l.defScaleRefLength),p=g/f||1,l.autofit||l.autoShrink){var m=this.getDrawBridge().getContextDimension(a);m.x=m.width,m.y=m.height,(m=this.getDrawBridge().transformScreenCoordToContext(a,m)).width=m.x,m.height=m.y;var C=l.autofitContextPadding;C*=2*c.unitLength,u.width=u.x2-u.x1,u.height=u.y2-u.y1;var _=Math.max(m.width-C,0)/(u.width||1),y=Math.max(m.height-C,0)/(u.height||1),T=Math.min(_,y),E=T/p;h.isUnset(l.retainAspect)||l.retainAspect?(c.scaleX=c.scaleY=p,(l.autofit||l.autoShrink&&T<p)&&(c.zoom*=E)):l.autofit?(c.scaleX=(_<y?1:_/y)*p,c.scaleY=(y<_?1:y/_)*p,c.zoom*=E):l.autoShrink&&(c.zoom*=E,E<1?c.scaleX=c.scaleY=p:_<y?(c.scaleX=p,c.scaleY=p*y/_):(c.scaleY=p,c.scaleX=p*_/y))}else c.scaleX=c.scaleY=p}return h.notUnset(l.rotateAngle)&&(c.rotateAngle=l.rotateAngle),h.isUnset(l.center)?c.center=d:c.center=l.center,c.drawBaseCoord=o||Kekule.CoordUtils.transform2D(d,c),c},generateTransformParams:function(a,o,l,u){var c=this.calcPreferedTransformOptions(a,o,l,u),d=Object.extend({},c);return(c=this.getFinalTransformParams(a,c)).initialTransformOptions=d,c},getFinalTransformParams:function(a,o){var l=Object.create(o);return l.zoom&&(l.scaleX*=l.zoom,l.scaleY*=l.zoom),l.scaleY=-l.scaleY,l.unitLength,l},getRenderFinalTransformParams:function(a){return this.getRenderCache(a).transformParams},getRenderInitialTransformOptions:function(a){var o=this.getRenderFinalTransformParams(a);return o?o.initialTransformOptions:null},doTransformCoordToObj:function(a,o,l){var u=this.getRenderCache(a).invTransformMatrix;return Kekule.CoordUtils.transform2DByMatrix(l,u)},doTransformCoordToContext:function(a,o,l){var u=this.getRenderCache(a).transformMatrix;return Kekule.CoordUtils.transform2DByMatrix(l,u)}}),Kekule.Render.RichTextBased2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.RichTextBased2DRenderer",DRAWN_OBJ_FIELD:"__$drawnObj__",initialize:function(a,o,l){this.tryApplySuper("initialize",[a,o,l]),this.__$alwaysRecalcSize__=!1,this.__$isRecalculatingSize=!1},getDrawnObj:function(a){return this.getExtraProp(a,this.DRAWN_OBJ_FIELD)},setDrawnObj:function(a,o){this.setExtraProp(a,this.DRAWN_OBJ_FIELD,o)},getRichText:function(a,o){return null},extractRichTextDrawOptions:function(a){var o=Object.create(a||{});return o.horizontalAlign=r(o.horizontalAlign,o.textHorizontalAlign),o.verticalAlign=r(o.verticalAlign,o.textVerticalAlign),o.charDirection=r(o.charDirection,o.textCharDirection),o},getDrawTextCoord:function(a,o){return o},doDrawSelf:function(a,o,l){this.tryApplySuper("doDrawSelf",[a,o,l]);var u=this.getChemObj(),c=(l.transformParams,this.getRichText(this.getChemObj(),l));if(!c)return null;o||(o=this.getAutoBaseCoord(l));var d=this.getDrawTextCoord(a,o),h=this.extractRichTextDrawOptions(l);h.fontSize&&(h.fontSize*=h.unitLength||1);var p=this.drawRichText(a,d,c,h),g=p.boundRect,f=this.createRectBoundInfo({x:g.left,y:g.top},{x:g.left+g.width,y:g.top+g.height});return this.basicDrawObjectUpdated(a,u,u,f,Kekule.Render.ObjectUpdateType.ADD),this.getRenderCache(a).drawnObj=p.drawnObj,this.setDrawnObj(a,p.drawnObj),(this.getCanModifyTargetObj()&&u.getNeedRecalcSize&&u.getNeedRecalcSize()||this.__$alwaysRecalcSize__)&&this._autosetObjSize(a,u,f),p.drawnObj},_autosetObjSize:function(a,o,l){if(!this.__$isRecalculatingSize&&o.hasProperty("size2D")&&o.setNeedRecalcSize){this.__$isRecalculatingSize=!0;try{var u=l.coords,c=this.transformCoordToObj(a,o,u[0]),d=this.transformCoordToObj(a,o,u[1]),h=Kekule.CoordUtils.substract(d,c);o.setPropStoreFieldValue("size2D",{x:Math.abs(h.x),y:Math.abs(h.y)}),o.setNeedRecalcSize(!1)}finally{this.__$isRecalculatingSize=!1}}}}),Kekule.Render.TextBlock2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBlock2DRenderer",getRichText:function(a,o){return Kekule.Render.RichTextUtils.strToRichText(a.getText())},doEstimateSelfObjBox:function(a,o,l){return this.getChemObj().getBox2D(l)},getDrawTextCoord:function(a,o){var l=this.getChemObj(),u=l.getExposedContainerBox(),c={x:u.x1,y:u.y2},d={x:u.x2,y:u.y1},h=this.transformCoordToContext(a,l,c),p=this.transformCoordToContext(a,l,d),g=Kekule.CoordUtils.substract(p,h);return{x:o.x-g.x/2,y:o.y-g.y/2}},extractRichTextDrawOptions:function(a){var o=this.tryApplySuper("extractRichTextDrawOptions",[a]);return o.fontSize=r(o.fontSize,o.labelFontSize),o.fontFamily=r(o.fontFamily,o.labelFontFamily),o.color=r(o.color,o.labelColor),o.textBoxXAlignment=Kekule.Render.BoxXAlignment.LEFT,o.textBoxYAlignment=Kekule.Render.BoxYAlignment.TOP,o}}),Kekule.Render.Formula2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.Formula2DRenderer",basicDrawObjectUpdated:function(a,o,l,u,c){return o===this.getChemObj()?this.tryApplySuper("basicDrawObjectUpdated",[a,o.getParent(),o.getParent(),u,c]):this.tryApplySuper("basicDrawObjectUpdated",[a,o,l,u,c])},getRichText:function(a,o){return a.getDisplayRichText(!0,o.displayLabelConfigs,o.partialChargeDecimalsLength,o.chargeMarkType)},doEstimateSelfObjBox:function(a,o,l){var u=this.getChemObj()?this.getChemObj().getParent():null;if(u){var c=u?u.getAbsBaseCoord2D(l):{x:0,y:0};return t.createBox(c,c)}return null},extractRichTextDrawOptions:function(a){var o=this.tryApplySuper("extractRichTextDrawOptions",[a]);return o.fontSize=r(o.fontSize,o.atomFontSize),o.fontFamily=r(o.fontFamily,o.atomFontFamily),o.color=r(o.color,o.labelColor,o.atomColor),o.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER,o.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER,o}}),Kekule.Render.TextBasedChemMarker2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBasedChemMarker2DRenderer",initialize:function(a,o,l){this.tryApplySuper("initialize",[a,o,l])},doDrawSelf:function(a,o,l){return this.tryApplySuper("doDrawSelf",[a,o,l])},getRichText:function(a,o){var l,u=this.getChemObj();if(u instanceof Kekule.ChemMarker.Charge){var c=u.getValue();if(l=Kekule.Render.ChemDisplayTextUtils.getChargeDisplayText(c,o.partialChargeDecimalsLength,o.chargeMarkType))return Kekule.Render.RichTextUtils.createSection(l,{charDirection:Kekule.Render.TextDirection.LTR})}else if(u instanceof Kekule.ChemMarker.Radical){var d=u.getValue();if(l=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(d,o.distinguishSingletAndTripletRadical))return Kekule.Render.RichTextUtils.createSection(l,{charDirection:Kekule.Render.TextDirection.LTR})}return null},doEstimateSelfObjBox:function(a,o,l){return this.tryApplySuper("doEstimateSelfObjBox",[a,o,l])},extractRichTextDrawOptions:function(a){var o=this.tryApplySuper("extractRichTextDrawOptions",[a]),l=this.getChemObj();return o.fontSize=r(l.getRenderOption("fontSize"),o.chemMarkerFontSize,o.fontSize,o.atomFontSize),o.fontFamily=r(o.fontFamily,o.atomFontFamily),o.color=r(o.color,o.atomColor,o.labelColor),o.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER,o.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER,o}}),Kekule.Render.ImageBlock2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.ImageBlock2DRenderer",initialize:function(a,o,l){this.tryApplySuper("initialize",[a,o,l])},doDrawSelf:function(a,o,l){this.tryApplySuper("doDrawSelf",[a,o,l]);var u=this.getChemObj();if(l.transformParams,!u||!u.getSrc||!u.getSrc())return null;o||(o=this.getAutoBaseCoord(l));var c,d=u.getExposedContainerBox(),h={x:d.x1,y:d.y2},p={x:d.x2,y:d.y1},g=this.transformCoordToContext(a,u,h),f=this.transformCoordToContext(a,u,p),m=Kekule.CoordUtils.substract(f,g),C={x:o.x-m.x/2,y:o.y-m.y/2},_=u.getCacheImg();return c=_?this.drawImageElem(a,_,C,m,l):this.drawImage(a,u.getSrc(),C,m,l),this.basicDrawObjectUpdated(a,u,u,this.createRectBoundInfo(C,Kekule.CoordUtils.add(C,m)),Kekule.Render.ObjectUpdateType.ADD),c}}),Kekule.Render.UnbondedElectronSetRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.UnbondedElectronSetRenderer",_extractActualDrawOptions:function(a){var o=Object.create(a),l=this.getChemObj();return o.fontSize=r(l.getRenderOption("fontSize"),o.chargeMarkFontSize,o.fontSize,o.atomFontSize),o.color=r(o.color,o.atomColor,o.labelColor),o.strokeColor=o.color,o.fillColor=o.color,o.electronGap=o.fontSize/3*(o.unitLength||1)*(o.zoom||1),o.electronRadius=o.fontSize/12*(o.unitLength||1)*(o.zoom||1),o},_drawSingleElectron:function(a,o,l,u){return this.drawCircle(a,o,l,u)},_drawElectrons:function(a,o,l,u,c){var d=i.substract(l,u),h=i.getDistance(d);if(h===0)var p=0,g=1;else p=d.x/h,g=d.y/h;for(var f,m,C=c.electronGap,_=c.electronRadius,y={x:C*g,y:-C*p},T=(o-1)/2,E=i.substract(l,i.multiply(y,T)),b=[],v=o>1?this.createDrawGroup(a):null,I=0;I<o;++I)b.push(E),f=this._drawSingleElectron(a,E,_,c),v&&this.addToDrawGroup(f,v),E=i.add(E,y);if(b.length<=1)m=this.createCircleBoundInfo(b[0],_);else{var R=i.multiply(y,2*_/C),N=i.substract(b[0],R),L=i.add(b[o-1],R);m=this.createLineBoundInfo(N,L,_)}return{electronCoords:b,drawnElem:v||f,electronRadius:_,boundInfo:m}},_doGetParentCoord:function(a,o,l){var u=l.transformParams;if(u){var c=o,d=c.getAbsBaseCoord?c.getAbsBaseCoord(Kekule.CoordMode.COORD2D):c.getAbsBaseCoord2D?c.getAbsBaseCoord2D():null;if(d)return i.transform2D(d,u)}return null},doDrawSelf:function(a,o,l){this.tryApplySuper("doDrawSelf",[a,o,l]);var u=this._extractActualDrawOptions(l),c=this.getChemObj(),d=c.getParent();if(l.transformParams,!c||!d||!c.getElectronCount||(c.getElectronCount()||0)<=0)return null;o||(o=this.getAutoBaseCoord(l));var h=this._doGetParentCoord(a,d,l);if(!o||!h)return null;var p=this._drawElectrons(a,c.getElectronCount(),o,h,u);return p.electronCoords,p.electronRadius,this.basicDrawObjectUpdated(a,c,d,p.boundInfo,Kekule.Render.ObjectUpdateType.ADD),p.drawnElem}}),Kekule.Render.Ctab2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.Ctab2DRenderer",DRAW_ELEM_FIELD:"__$drawElem__",TRANSFORM_COORD_FIELD:"__$transCoord2D__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",RENDERED_OBJS_FIELD:"__$renderedObjs__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",_getRenderSortIndex:function(){for(var a=this.getChemObj().getExposedNodes(),o=0,l=a.length;o<l;++o){var u=a[o];if(u&&u.coordStickTarget&&u.getCoordStickTarget())return 1}return this.tryApplySuper("_getRenderSortIndex")},doEstimateSelfObjBox:function(a,o,l){return this.getChemObj().getExposedContainerBox2D(l)},getObjDrawElem:function(a,o){return this.getExtraProp2(a,o,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(a,o,l){this.setExtraProp2(a,o,this.DRAW_ELEM_FIELD,l)},getRenderedObjs:function(a){return this.getExtraProp(a,this.RENDERED_OBJS_FIELD)},addRenderedObj:function(a,o){var l=this.getRenderedObjs(a);l?Kekule.ArrayUtils.pushUnique(l,o):(l=[o],this.setExtraProp(a,this.RENDERED_OBJS_FIELD,l))},removeRenderedObj:function(a,o){var l=this.getRenderedObjs(a);l&&Kekule.ArrayUtils.remove(l,o)},clearRenderedObj:function(a){this.setExtraProp(a,this.RENDERED_OBJS_FIELD,null)},prepareGeneralOptions:function(a,o){return this.tryApplySuper("prepareGeneralOptions",[a,o])},doPrepare:function(a,o,l,u){this.tryApplySuper("doPrepare",[a,o,l,u]),this.doPrepareLayout(a,o,l,u)},doPrepareLayout:function(a,o,l,u){},handleNodeSpecifiedRenderOptions:function(a,o){var l=(a.getOverriddenRenderOptions?a.getOverriddenRenderOptions():null)||{},u=Object.create(o);return u=Object.extend(u,l)},handleConnectorSpecifiedRenderOptions:function(a,o){var l=(a.getOverriddenRenderOptions?a.getOverriddenRenderOptions():null)||{},u=Object.create(o||null);return u=Object.extend(u,l)},isChemObjRenderedBySelf:function(a,o){var l=this.getRenderedObjs(a);return this.tryApplySuper("isChemObjRenderedBySelf",[a,o])||l&&l.indexOf(o)>=0||this.getChemObj().hasChildObj(o)&&(!o.isExposed||o.isExposed())},isChemObjRenderedDirectlyBySelf:function(a,o){var l=this.getRenderedObjs(a);return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[a,o])||l&&l.indexOf(o)>=0},doDrawSelf:function(a,o,l){this.tryApplySuper("doDrawSelf",[a,o,l]);var u=this.getChemObj();this._ctab=u;var c=l.transformParams;return this.getRenderCache(a).transformOptions=c,this.transformCtabCoords2DToContext(a,u,c),this.doPrepare(a,u,o,l),this.getRenderCache(a).appliedOptions=l,this.doDrawCore(a,u,l,c)},doRedraw:function(a){var o=this.getRenderCache(a);return this.doDrawCore(a,this.getChemObj(),o.appliedOptions,o.transformOptions)},doDrawCore:function(a,o,l,u){this.clearRenderedObj(a);var c=this.createDrawGroup(a);return this.doDrawConnectors(a,c,o,l,u),this.doDrawNodes(a,c,o,l,u),this.setObjDrawElem(a,o,c),c},doUpdateSelf:function(a,o,l){if(this.canModifyGraphic(a)){var u=!1,c=Kekule.Render.ObjectUpdateType;switch(l){case c.ADD:u=this.doAddNew(a,o);break;case c.MODIFY:u=this.doModify(a,o);break;case c.REMOVE:u=this.doRemove(a,Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(o));break;default:return this.tryApplySuper("doUpdateSelf",[a,o,l])}return u}return this.tryApplySuper("doUpdateSelf",[a,o,l])},doAddNew:function(a,o){return!!this.canModifyGraphic()&&this.doModify(a,o)},doModify:function(a,o){if(this.canModifyGraphic()){var l=this._extractObjsOfUpdateObjDetails(o);this.remove(a,l);var u=this.getChemObj(),c=this.getObjDrawElem(a,u),d=this.getRenderCache(a),h=d.appliedOptions;l.indexOf(u)>=0&&this.draw(a,d.baseCoord,h);for(var p=0,g=l.length;p<g;++p){var f=l[p];if(!f.isExposed||f.isExposed())if(u.hasConnector(f)){var m=this.handleConnectorSpecifiedRenderOptions(f,h);this.doDrawConnector(a,c,f,this.getChemObj(),m,d.transformParams||{})}else u.hasNode(f)&&(m=this.handleNodeSpecifiedRenderOptions(f,h),this.doDrawNode(a,c,f,this.getChemObj(),m,d.transformParams))}return!0}return!1},doRemove:function(a,o){if(this.canModifyGraphic()){for(var l=Kekule.ArrayUtils.toArray(o),u=0,c=l.length;u<c;++u){var d=l[u],h=this.getObjDrawElem(a,d);if(h){var p=this.getObjDrawElem(a,this.getChemObj());this.removeFromDrawGroup(h,p),this.removeDrawnElem(a,h)}this.removeRenderedObj(a,d),this.removeExtraProp2(a,d),this.basicDrawObjectUpdated(a,d,this.getChemObj(),null,Kekule.Render.ObjectUpdateType.REMOVE)}return!0}return!1},getCoordTransformOptions:function(a){return this.getRenderCache(a).transformOptions},transformCtabCoords2DToContext:function(a,o,l){var u=l.allowCoordBorrow,c=Object.extend({},l);c.centerX=0,c.centerY=0;var d=l.transformMatrix;this.setExtraProp2(a,o,this.TRANSFORM_MATRIX_FIELD,d);var h=d;this.setExtraProp2(a,o,this.CHILD_TRANSFORM_MATRIX_FIELD,d);var p=l.invTransformMatrix;this.setExtraProp2(a,o,this.INV_TRANSFORM_MATRIX_FIELD,p);for(var g=0,f=o.getNodeCount();g<f;++g){var m=o.getNodeAt(g);this.transformObjCoord2DToContext(a,m,d,h,u)}},transformObjCoord2DToContext:function(a,o,l,u,c){var d;if(o&&o.getAbsBaseCoord2D){var h=o.getAbsBaseCoord2D(c);if(h){var p=Kekule.CoordUtils.transform2DByMatrix(h,l);this.setTransformedCoord2D(a,o,p),d=p}if(o.getNodes)for(var g=0,f=o.getNodeCount();g<f;++g)this.transformObjCoord2DToContext(a,o.getNodeAt(g),u,u,c)}return d},getTransformedCoord2D:function(a,o,l){Kekule.ObjUtils.isUnset(l)&&(l=this.getRenderCache(a).options.transformParams.allowCoordBorrow);var u=o instanceof Kekule.BaseStructureNode,c=o.getParent(),d=u&&c&&c instanceof Kekule.BaseStructureConnector,h=u&&!d&&this.getExtraProp2(a,o,this.TRANSFORM_COORD_FIELD);if(!h){var p=this.getChemObj(),g=this.getExtraProp2(a,p,this.TRANSFORM_MATRIX_FIELD),f=this.getExtraProp2(a,p,this.CHILD_TRANSFORM_MATRIX_FIELD);h=p&&(p.hasNode(o,!1)||p.hasConnector(o,!1))?this.transformObjCoord2DToContext(a,o,g,f,l):this.transformObjCoord2DToContext(a,o,f,f,l)}return h},setTransformedCoord2D:function(a,o,l){this.setExtraProp2(a,o,this.TRANSFORM_COORD_FIELD,l)},doTransformCoordToObj:function(a,o,l){var u=this.getExtraProp2(a,o,this.INV_TRANSFORM_MATRIX_FIELD);return u?Kekule.CoordUtils.transform2DByMatrix(l,u):this.tryApplySuper("doTransformCoordToObj",[a,o,l])},doTransformCoordToContext:function(a,o,l){var u=this.getExtraProp2(a,o,this.TRANSFORM_MATRIX_FIELD);return u?Kekule.CoordUtils.transform2DByMatrix(l,u):this.tryApplySuper("doTransformCoordToContext",[a,o,l])},doDrawNodes:function(a,o,l,u,c){for(var d=l.getExposedNodes(),h=0,p=d.length;h<p;++h){var g=d[h],f=this.handleNodeSpecifiedRenderOptions(g,u);this.doDrawNode(a,o,g,l,f,c)}},doDrawNode:function(a,o,l,u,c,d){},doDrawConnectors:function(a,o,l,u,c){for(var d=l.getExposedConnectors(),h=0,p=d.length;h<p;++h){var g=d[h],f=this.handleConnectorSpecifiedRenderOptions(g,u);this.doDrawConnector(a,o,g,l,f,c)}},doDrawConnector:function(a,o,l,u,c,d){var h,p,g,f,m=l.getConnectedExposedObjs(),C=m.length;if(C<2)return null;for(var _,y=C>2?this.createDrawGroup(a):null,T=C>2?[]:null,E=c,b=0;b<C;++b)if(p=m[b],this.getTransformedCoord2D(a,p,d.allowCoordBorrow)){for(var v=b+1;v<C;++v)if(g=m[v],this.getTransformedCoord2D(a,g,d.allowCoordBorrow)&&(_=this.doDrawConnectorShape(a,l,[p,g],E,d))){(f=_.element)&&y&&this.addToDrawGroup(f,y);var I=_.boundInfo;T&&I&&T.push(I)}}return(h=y||f)&&o&&this.addToDrawGroup(h,o),h?this.setObjDrawElem(a,l,h):this.setObjDrawElem(a,l,null),this.addRenderedObj(a,l),(I||T)&&this.basicDrawObjectUpdated(a,l,u,T||I,Kekule.Render.ObjectUpdateType.ADD),h},doDrawConnectorShape:function(a,o,l,u,c){}}),Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.Ctab2DRenderer),Kekule.Render.ChemCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab2DRenderer",OBJ_NEED_LABEL_FIELD:"__$needDrawLabel__",OBJ_NEED_DOT_FIELD:"__$needDrawDot__",getObjNeedDrawLabel:function(a,o){var l=this.getExtraProp2(a,o,this.OBJ_NEED_LABEL_FIELD);if(Kekule.ObjUtils.isUnset(l)){var u=this.getRenderCache(a).appliedOptions;l=!(o instanceof Kekule.ChemStructureConnector)&&this._needNodeDrawLabel(o,u),this.setObjNeedDrawLabel(a,o,l)}return l},setObjNeedDrawLabel:function(a,o,l){this.setExtraProp2(a,o,this.OBJ_NEED_LABEL_FIELD,l)},getObjNeedDrawDot:function(a,o){var l=this.getRenderCache(a).appliedOptions;return!(o instanceof Kekule.ChemStructureConnector)&&this._needNodeDrawDot(a,o,l)},doPrepare:function(a,o,l,u){u.fontSize||(u.fontSize=u.atomFontSize),u.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER,u.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER,this.tryApplySuper("doPrepare",[a,o,l,u])},doPrepareLayout:function(a,o,l,u){this.tryApplySuper("doPrepareLayout",[a,o,l,u]);for(var c=o.getExposedNodes(),d=0,h=c.length;d<h;++d){var p=c[d],g=this._needNodeDrawLabel(p,u);this.setObjNeedDrawLabel(a,p,g)}},handleNodeSpecifiedRenderOptions:function(a,o){var l=this.tryApplySuper("handleNodeSpecifiedRenderOptions",[a,o]);return!l.color&&l.atomColor&&(l.color=l.atomColor),!l.fontFamily&&l.atomFontFamily&&(l.fontFamily=l.atomFontFamily),!l.fontSize&&l.atomFontSize&&(l.fontSize=l.atomFontSize),l},handleConnectorSpecifiedRenderOptions:function(a,o){var l=this.tryApplySuper("handleConnectorSpecifiedRenderOptions",[a,o]);return!l.color&&l.bondColor&&(l.color=l.bondColor),l},doDrawNode:function(a,o,l,u,c,d){var h,p,g=this.getTransformedCoord2D(a,l,d.allowCoordBorrow),f=c,m=l.getAtomicNumber?l.getAtomicNumber():0,C=l.getOverriddenRenderOptions()||{},_=C.color||C.atomColor;if(_)f.color=_;else if(f.useAtomSpecifiedColor){var y;if(m<=0){var T=l.getClassLocalName();y=Kekule.Render.RenderColorUtils.getColor(T,this.getRendererType())}else y=Kekule.Render.RenderColorUtils.getColor(m,this.getRendererType());f.color=y}l.getCharge()||l.getRadical();var E=l.getCharge()&&!l.fetchChargeMarker(!1),b=l.getRadical()&&!l.fetchRadicalMarker(!1),v=!1;if(this.getObjNeedDrawLabel(a,l)){v=!0;var I=this._getNodeHydrogenDisplayLevel(l,f);I===Kekule.Render.HydrogenDisplayLevel.LABELED&&(I=Kekule.Render.HydrogenDisplayLevel.ALL);var R=!(!E&&!b),N=l.getDisplayRichText(I,R,f.displayLabelConfigs,f.partialChargeDecimalsLength,f.chargeMarkType,f.distinguishSingletAndTripletRadical),L=f.charDirection?f.charDirection:this._decideNodeLabelCharDirection(a,l);f.fontSize*=f.unitLength;var U=Object.create(f);U.charDirection=L;var W=(J=this.drawRichText(a,g,N,U)).drawnObj,M=J.boundRect;p=this.createRectBoundInfo({x:M.left,y:M.top},{x:M.left+M.width,y:M.top+M.height}),h=W}else{var B,V,J;if(this.getObjNeedDrawDot(a,l)&&Kekule.ObjUtils.isUnset(f.atomRadius)&&(f.atomRadius=f.allenCenterAtomRadius),f.atomRadius){var $=f.atomRadius*f.unitLength;f.strokeColor=f.color,f.fillColor=f.color,B=this.drawCircle(a,g,$,f),p=this.createCircleBoundInfo(g,$)}else p=this.createPointBoundInfo(g);(E||b)&&(J=this.doDrawElectronStateMark(a,o,l,f.chargeMarkType,f.partialChargeDecimalsLength,f.distinguishSingletAndTripletRadical,f.fontFamily,f.chargeMarkFontSize*f.unitLength,f.chargeMarkMargin*f.unitLength,f.chargeMarkCircleWidth*f.unitLength,f.color,f.opacity,f.zoom||1))&&(V=J.drawnObj),B&&V?(h=this.createDrawGroup(a),this.addToDrawGroup(h,B),this.addToDrawGroup(h,V)):h=B||V}if(l.getUnplacedMarkers(this.getCoordMode()).length>=0){var q,Q=f.chemMarkerMargin;if(v){Q+=this._getNodeFontSize(a,l)*(d.zoom||1)*f.unitLength*1/2-Q/2;var ie=Kekule.Render.TextDirection,Y=(ie.LTR,ie.RTL,ie.TTB,ie.BTT,L===ie.LTR?{x:1,y:0}:L===ie.RTL?{x:-1,y:0}:L===ie.TTB?{x:0,y:1}:L===ie.BTT?{x:0,y:-1}:{x:0,y:0}),ne={x:Y.x*d.scaleX,y:Y.y*d.scaleY};q=ne.x>0?0:ne.x<0?Math.PI:ne.y>0?Math.PI/2:ne.y<0?3*Math.PI/2:null}var de=Q/f.defBondLength*f.medianObjRefLength;this.doAdjustChemPropMarkerPos(l,de,d.allowCoordBorrow,Kekule.ObjUtils.notUnset(q)?[q]:[])}return h?(this.setObjDrawElem(a,l,h),o&&this.addToDrawGroup(h,o)):this.setObjDrawElem(a,l,null),this.addRenderedObj(a,l),this.basicDrawObjectUpdated(a,l,u,p,Kekule.Render.ObjectUpdateType.ADD),h},_getNodeFontSize:function(a,o,l){l||(l=this.getRenderCache(a).appliedOptions||this.getRenderCache(a).options);var u=Kekule.Render.RenderOptionUtils.getNodeLabelDrawOptions(o.getOverriddenRenderOptions())||{};return r(u.fontSize,l.fontSize,l.atomFontSize)},_getNodeHydrogenDisplayLevel:function(a,o){var l=a.getOverriddenRenderOptions(),u=Kekule.Render.RenderOptionUtils.getHydrogenDisplayLevel(l);return Kekule.ObjUtils.notUnset(u)?u:o.hydrogenDisplayLevel},_needNodeDrawDot:function(a,o,l){if(o.getOverriddenRenderOptions(),o instanceof Kekule.Atom){if(o.getAtomicNumber()!==Kekule.Render.DEF_ATOM_ATOMIC_NUM||this.getObjNeedDrawLabel(a,o))return!1;if(o.getLinkedBonds().length===2){var u=o.getLinkedMultipleBonds();if(u.length===2&&u[0].getBondOrder()===u[1].getBondOrder()){var c=u[0].getBondOrder();return c>=n.DOUBLE&&c<n.EXPLICIT_AROMATIC}}return!1}return!1},_needNodeDrawLabel:function(a,o){var l=Kekule.Render.RenderOptionUtils,u=Kekule.Render.NodeLabelDisplayMode,c=a.getOverriddenRenderOptions(),d=l.getNodeDisplayMode(c)||o.nodeDisplayMode;if(!(a instanceof Kekule.ChemStructureNode)||d===u.HIDDEN)return!1;if(d===u.SHOWN||o.moleculeDisplayType===Kekule.Render.MoleculeDisplayType.CONDENSED||a.getLinkedConnectors().length<=0)return!0;if(a instanceof Kekule.Atom&&a.getAtomicNumber()===Kekule.Render.DEF_ATOM_ATOMIC_NUM&&!a.getMassNumber()){if(a.getRenderOption("customLabel"))return!0;var h=this._getNodeHydrogenDisplayLevel(a,o),p=Kekule.Render.HydrogenDisplayLevel;if(h===p.ALL)return!0;if(h===p.UNMATCHED_EXPLICIT){var g=a.getExplicitHydrogenCount();return Kekule.ObjUtils.notUnset(g)&&a.getImplicitHydrogenCount()!==g}return Kekule.ObjUtils.notUnset(a.getExplicitHydrogenCount())}return!0},_isNodeHasConnectorToDirection:function(a,o,l){Kekule.ObjUtils.isUnset(l)&&(l=.2);for(var u=0,c=a.length;u<c;++u){var d=a[u];if(o===e.LTR&&d.x>l||o===e.RTL&&d.x<-l||o===e.TTB&&d.y>l||o===e.BTT&&d.y<-l)return!0}return!1},_calcConnectorVectorWeight:function(a){for(var o=0,l=0,u=function(h,p){return p==0?100:Math.min(100,Math.pow(h/p,2))},c=0,d=a.length;c<d;++c)o+=a[c].x*u(a[c].x,a[c].y)*1,l+=a[c].y*u(a[c].y,a[c].x)*1;return{x:o,y:l}},_calcConnectorVectorOfNode:function(a,o){for(var l={x:0,y:0},u=this._getStandardizedLinkedObjRelCoords(a,o,null),c=0,d=u.length;c<d;++c)l.x+=u[c].x,l.y+=u[c].y;return l.x===l.y===0&&(l={x:1,y:0}),l},_calcVectorAxisDirection:function(a){return Math.abs(a.x)>=Math.abs(a.y)?a.x>0?e.LTR:e.RTL:a.y>0?e.TTB:e.BTT},_decideNodeLabelCharDirection:function(a,o){for(var l=this._getStandardizedLinkedObjRelCoords(a,o,null),u=Kekule.Render.TextDirection,c=[u.LTR,u.RTL,u.TTB,u.BTT],d=0,h=c.length;d<h;++d)if(!this._isNodeHasConnectorToDirection(l,c[d]))return c[d];var p=this._calcConnectorVectorWeight(l);return Math.abs(p.x)>Math.abs(p.y)?p.x<=0?u.LTR:u.RTL:p.y<=0?u.TTB:u.BTT},_calcConnectorAnglesOfNode:function(a,o){for(var l=[],u=this._getStandardizedLinkedObjRelCoords(a,o,null),c=0,d=u.length;c<d;++c){var h=u[c],p=Math.atan2(h.y,h.x);p<0&&(p=2*Math.PI+p),l.push(p)}return l.sort(),l},_getMostEmptyDirectionAngleOfNode:function(a,o){var l,u=this._calcConnectorAnglesOfNode(a,o),c=u.length;if(c===0)l=0;else if(c===1)l=-u[0];else{for(var d=0,h=0,p=0;p<c;++p){var g=u[p],f=u[(p+1)%c]-g;f<0&&(f+=2*Math.PI),f>d&&(d=f,h=p)}l=u[h]+d/2}return l},doAutoAdjustAttachedMarkerPos:function(a,o,l,u,c){o&&!o.getCoordOfMode(this.getCoordMode())&&a.autoSetMarker2DPos(o,l,u,c)},doAdjustChemPropMarkerPos:function(a,o,l,u){a.beginUpdate();try{var c=a.getMarkerOfType(Kekule.ChemMarker.Charge);this.doAutoAdjustAttachedMarkerPos(a,c,o,l,u);var d=a.getMarkerOfType(Kekule.ChemMarker.Radical);this.doAutoAdjustAttachedMarkerPos(a,d,o,l,u);for(var h=a.getUnplacedMarkers(this.getCoordMode()),p=0,g=h.length;p<g;++p)this.doAutoAdjustAttachedMarkerPos(a,h[p],o,l,u)}finally{a.endUpdate()}},doDrawElectronStateMark:function(a,o,l,u,c,d,h,p,g,f,m,C,_){var y=l.getCharge(),T=l.getRadical(),E="";if(!c||Math.abs(y)>Math.pow(10,-c)/2){Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND;var b=u===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND;y===1?E=b?"⊕":"+":y===-1?E=b?"⊖":"−":E=(c?Kekule.NumUtils.toDecimals(Math.abs(y),c):Math.abs(y).toString())+(y>0?"+":"−")}if(T&&(E+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(T,d)),!E)return null;var v=this.getTransformedCoord2D(a,l),I=this._getMostEmptyDirectionAngleOfNode(a,l),R=g/1,N={x:Math.cos(I)*R,y:Math.sin(I)*R};N=Kekule.CoordUtils.add(v,N);var L,U,W=Kekule.Render.BoxXAlignment,M=Kekule.Render.BoxYAlignment;return L=W.CENTER,U=M.CENTER,this.drawText(a,N,E,{fontFamily:h,fontSize:p,color:m,opacity:C,textBoxXAlignment:L,textBoxYAlignment:U,zoom:_||1})},doDrawConnectorShape:function(a,o,l,u,c){var d,h=Kekule.CoordUtils,p=l[0],g=l[1],f=this.getTransformedCoord2D(a,p,c.allowCoordBorrow),m=this.getTransformedCoord2D(a,g,c.allowCoordBorrow),C={x:f.x,y:f.y},_={x:m.x,y:m.y},y=(l=[p,g],[C,_]),T=h.getDistance(C,_),E=0,b=u.unitLength||1,v=Math.sqrt(Math.sqr(_.x-C.x)+Math.sqr(_.y-C.y)),I=[],R=u.bondLengthScaleRatio;if(Kekule.ObjUtils.notUnset(R)){var N=h.substract(_,C);d=R>0?0:1;var L=1-Math.abs(R||1),U=d===1?-1:1;I[d]=h.multiply(N,U*L)}if(this.getObjNeedDrawLabel(a,p)||this.getObjNeedDrawLabel(a,g)){var W,M,B,V=u.atomLabelBoxExpandRatio,J=_.x-C.x,$=_.y-C.y,q=J>=0?1:-1,Q=$>=0?1:-1,ie=J===0;if(!ie)var Y=Math.abs($/J);B=Math.abs(J)>=Math.abs($);for(var ne=0,de=l.length;ne<de;++ne){var Ae=l[ne],Ce=y[ne],pe=null;if(this.getObjNeedDrawLabel(a,Ae)&&(W=M=this._getNodeFontSize(a,Ae)*(c.zoom||1)*b*V/2,pe=B?{x:W*q,y:W*Y*Q}:ie?{x:0,y:M*Q}:{x:M/Y*q,y:M*Q})){var fe=I[ne];fe&&Math.abs(R)<=1?(Math.abs(pe.x)>Math.abs(fe.x)||Math.abs(pe.y)>Math.abs(fe.y))&&(I[ne]=pe):I[ne]=pe}q*=-1,Q*=-1}}for(ne=0,de=y.length;ne<de;++ne)if(Ce=y[ne],pe=I[ne]){E+=h.getDistance(pe,{x:0,y:0});var Te=h.add(Ce,pe);Ce.x=Te.x,Ce.y=Te.y}if(E>=T)return null;var xe=(u.bondLineWidth||u.strokeWidth||1)*(u.unitLength||1);u.strokeWidth=xe;var Re,we=u.renderType,Me=Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(o);return(Kekule.ObjUtils.isUnset(we)||Me.indexOf(we)<0)&&(we=Me[0]),this.isLineBasedConnector(we)?Re=this.doDrawLineBasedConnector(a,we,p,g,C,_,v,u):this.isTriangleBasedConnector(we)?Re=this.doDrawTriangleBasedConnector(a,we,p,g,C,_,v,u):this.isTriangleHashBasedConnector(we)?Re=this.doDrawTriangleHashBasedConnector(a,we,p,g,C,_,v,u):this.isRectangleBasedConnector(we)?Re=this.doDrawRectangleBasedConnector(a,we,p,g,C,_,v,u):this.isWavyBasedConnector(we)&&(Re=this.doDrawWavyBasedConnector(a,we,p,g,C,_,v,u)),Re},_lineBasedConnectorTypes:[s.SINGLE,s.DOUBLE,s.TRIPLE,s.QUAD,s.SCISSORS_DOUBLE,s.BOLD,s.BOLD_DOUBLE,s.BOLD_TRIPLE,s.DASHED,s.DASHED_DOUBLE,s.DASHED_TRIPLE,s.SOLID_DASH,s.BOLD_DASH,s.ARROWED],_triangleBasedConnectorTypes:[s.WEDGED_SOLID,s.WEDGED_SOLID_INV,s.WEDGED_HOLLOW,s.WEDGED_HOLLOW_INV],_triangleHashBasedConnectorTypes:[s.WEDGED_HASHED,s.WEDGED_HASHED_INV,s.HASHED],_rectangleBasedConnectorTypes:[s.WEDGED_SOLID_BOTH,s.WEDGED_HOLLOW_BOTH],isLineBasedConnector:function(a){return this._lineBasedConnectorTypes.indexOf(a)>=0},isTriangleBasedConnector:function(a){return this._triangleBasedConnectorTypes.indexOf(a)>=0},isTriangleHashBasedConnector:function(a){return this._triangleHashBasedConnectorTypes.indexOf(a)>=0},isRectangleBasedConnector:function(a){return this._rectangleBasedConnectorTypes.indexOf(a)>=0},isWavyBasedConnector:function(a){return s.WAVY},doDrawLineBasedConnector:function(a,o,l,u,c,d,h,p){var g=[],f={isBold:!1,isDash:!1},m={isBold:!0,isDash:!1},C={isBold:!1,isDash:!0};switch(o){case s.DOUBLE:case s.SCISSORS_DOUBLE:for(var _=0;_<2;++_,g.push(f));break;case s.TRIPLE:for(_=0;_<3;++_,g.push(f));break;case s.QUAD:for(_=0;_<4;++_,g.push(f));break;case s.BOLD:g.push(m);break;case s.BOLD_DOUBLE:g.push(m),g.push(f);break;case s.BOLD_TRIPLE:for(g.push(m),_=0;_<2;++_,g.push(f));break;case s.BOLD_QUAD:for(g.push(m),_=0;_<3;++_,g.push(f));break;case s.DASHED:g.push(C);break;case s.DASHED_DOUBLE:for(_=0;_<2;++_,g.push(C));break;case s.DASHED_TRIPLE:for(_=0;_<3;++_,g.push(C));break;case s.SOLID_DASH:g.push(f),g.push(C);break;case s.BOLD_DASH:g.push(m),g.push(C);break;case s.ARROWED:f.isArrow=!0,g.push(f);break;case s.SINGLE:default:g.push(f)}var y=o===s.SCISSORS_DOUBLE;return this.doDrawSymmetryLineConnector(a,l,u,c,d,h,g,y,p)},doDrawSymmetryLineConnector:function(a,o,l,u,c,d,h,p,g){var f=h.length,m=null,C=null;if(f===1){var _=g.strokeWidth;h[0].isBold&&(_*=g.boldBondLineWidthRatio);var y=null;h[0].isArrow&&(y={width:g.bondArrowWidth*g.unitLength,length:g.bondArrowLength*g.unitLength});var T=Object.create(g);T.strokeWidth=_,T.strokeColor=Kekule.Render.RenderOptionUtils.getColor(g),T.strokeDash=h[0].isDash,T.lineCap=g.bondLineCap,T.lineJoin=g.bondLineJoin,C=this.drawArrowLine(a,u,c,y,T);var E=this.createLineBoundInfo(u,c,_)}else if(f>1){m=this.createDrawGroup(a);var b=g.multipleBondSpacingAbs?g.multipleBondSpacingAbs:g.multipleBondSpacingRatio*d;g.multipleBondMaxAbsSpacing&&(b=Math.min(b,g.multipleBondMaxAbsSpacing)),b*=g.unitLength;var v=c.x-u.x,I=c.y-u.y,R=Math.sqrt(Math.sqr(v)+Math.sqr(I)),N=I/R,L=v/R,U=[],W=1;1&f||(W=p?0:Kekule.ObjUtils.isUnset(h.bondAlign)?this._decideEvenBondAlign(a,o,l):h.bondAlign);for(var M=0;M<f;++M)if(Kekule.ObjUtils.notUnset(h[M].offsetAdjust))U.push(h[M].offsetAdjust);else if(M===0&&W!==0)U.push(0);else{var B=1&M?1:-1;if(W!==0)var V=W*B*(M+1>>1);else V=(1*(M>>1)+.5)*B;U.push(V)}var J=b,$=0,q={x:0,y:0},Q={x:0,y:0},ie=[];for(M=0;M<f;++M){var Y=Object.create(g),ne=J*N,de=J*L,Ae={x:u.x-ne*U[M],y:u.y+de*U[M]},Ce={x:c.x-ne*U[M],y:c.y+de*U[M]};q=Kekule.CoordUtils.add(q,Ae),Q=Kekule.CoordUtils.add(Q,Ce),y=null,h[M].isArrow&&(y={width:g.bondArrowWidth*g.unitLength,length:g.bondArrowLength*g.unitLength}),_=g.strokeWidth,h[M].isBold&&(_*=g.boldBondLineWidthRatio),Y.strokeColor=g.color,Y.strokeDash=h[M].isDash,Y.lineCap=g.bondLineCap,Y.lineJoin=g.bondLineJoin,ie.push({coord1:Ae,coord2:Ce,arrowParams:y,drawOptions:Y}),M!==0&&M!==f-1||($+=_/2),J=h[M].isBold?b+Math.floor(_/2):b}if(p)for(M=0;M<f;++M){var pe=ie[M],fe=ie[f-M-1];C=this.drawArrowLine(a,pe.coord1,fe.coord2,pe.arrowParams,pe.drawOptions),this.addToDrawGroup(C,m)}else for(M=0;M<f;++M){var Te=ie[M];C=this.drawArrowLine(a,Te.coord1,Te.coord2,Te.arrowParams,Te.drawOptions),this.addToDrawGroup(C,m)}q=Kekule.CoordUtils.divide(q,f),Q=Kekule.CoordUtils.divide(Q,f);var xe=b*Math.abs(U[U.length-1]-U[0])+$;E=this.createLineBoundInfo(q,Q,xe)}return{element:m||C,boundInfo:E}},_getStandardizedLinkedObjRelCoords:function(a,o,l){for(var u=[],c=this.getTransformedCoord2D(a,o),d=o.getLinkedExposedObjs(),h=0,p=d.length;h<p;++h){var g=d[h];if(g!==l){var f=this.getTransformedCoord2D(a,g),m=Kekule.CoordUtils.substract(f,c);m=Kekule.CoordUtils.standardize(m),u.push(m)}}return u},_decideEvenBondAlign:function(a,o,l){var u=Kekule.CoordUtils.substract(this.getTransformedCoord2D(a,l),this.getTransformedCoord2D(a,o));u=Kekule.CoordUtils.standardize(u);for(var c=this._getStandardizedLinkedObjRelCoords(a,o,l),d=this._getStandardizedLinkedObjRelCoords(a,l,o),h=0,p={x:0,y:0},g=0,f=c.length;g<f;++g)h+=this._calcSinglePointAlign(c[g],u),p.x+=c[g].x,p.y+=c[g].y;for(g=0,f=d.length;g<f;++g)h+=this._calcSinglePointAlign(d[g],u),p.x+=d[g].x,p.y+=d[g].y;return h!==0?Math.sign(h):this._calcSinglePointAlign(p,u)},_calcSinglePointAlign:function(a,o){var l;if(Math.abs(o.x)<1e-4)return l=Math.abs(a.x)<1e-4?0:-Math.sign(a.x)*Math.sign(o.y);var u=o.y*a.x/o.x,c=a.y-u;return l=c>1e-4?1:c<-1e-4?-1:0,l*=Math.sign(o.x)},doDrawTriangleBasedConnector:function(a,o,l,u,c,d,h,p){var g=o===s.WEDGED_SOLID||o===s.WEDGED_SOLID_INV,f=o===s.WEDGED_SOLID_INV||o===s.WEDGED_HOLLOW_INV?[d,c]:[c,d],m=p.bondWedgeWidth*p.unitLength,C=this._calcTriangleBaselineCoords(f[0],f[1],m),_=Object.create(p);_.strokeColor=p.color,_.fillColor=g?p.color:null;var y={element:this.drawTriangle(a,f[0],C[0],C[1],_)};return y.boundInfo=this.createLineBoundInfo(f[0],f[1],m),y},doDrawTriangleHashBasedConnector:function(a,o,l,u,c,d,h,p){var g=o===s.WEDGED_HASHED_INV,f=o!==s.HASHED,m=g?[d,c]:[c,d],C=p.hashSpacing*p.unitLength,_=p.bondWedgeWidth*p.unitLength,y=f?p.bondWedgeHashMinWidth*p.unitLength:_,T=_-y,E=Kekule.CoordUtils.substract(m[1],m[0]),b=Math.sqrt(Math.sqr(E.x)+Math.sqr(E.y)),v=Math.floor(b/C),I=this.createDrawGroup(a),R=Object.create(p);R.strokeColor=p.color;for(var N=0;N<v;++N){var L=C*N/b,U={x:E.x*L,y:E.y*L};U=Kekule.CoordUtils.add(U,m[0]);var W=this._calcTriangleBaselineCoords(m[0],U,T*L+y),M=this.drawLine(a,W[0],W[1],R);this.addToDrawGroup(M,I)}var B={element:I};return B.boundInfo=this.createLineBoundInfo(m[0],m[1],_),B},_calcTriangleBaselineCoords:function(a,o,l){var u=Kekule.CoordUtils.substract(o,a),c=Math.sqrt(Math.sqr(u.x)+Math.sqr(u.y)),d=u.y/c,h=u.x/c,p=l/2,g=[];return g.push({x:o.x+p*d,y:o.y-p*h}),g.push({x:o.x-p*d,y:o.y+p*h}),g},doDrawRectangleBasedConnector:function(a,o,l,u,c,d,h,p){var g=o===s.WEDGED_SOLID_BOTH,f=p.bondWedgeWidth*p.unitLength,m=this._calcRectangleCornerCoords(c,d,f),C=Object.create(p);C.strokeColor=p.color,C.fillColor=g?p.color:null;var _=Kekule.Render.DrawPathUtils.makePath("M",[m[0].x,m[0].y],"L",[m[1].x,m[1].y],"L",[m[2].x,m[2].y],"L",[m[3].x,m[3].y],"Z"),y={element:this.drawPath(a,_,C)};return y.boundInfo=this.createLineBoundInfo(c,d,f),y},_calcRectangleCornerCoords:function(a,o,l){var u=Kekule.CoordUtils.substract(o,a),c=Math.sqrt(Math.sqr(u.x)+Math.sqr(u.y)),d=l/2,h=[],p=d*(u.y/c),g=d*(u.x/c);return h.push({x:a.x+p,y:a.y-g}),h.push({x:a.x-p,y:a.y+g}),h.push({x:o.x-p,y:o.y+g}),h.push({x:o.x+p,y:o.y-g}),h},doDrawWavyBasedConnector:function(a,o,l,u,c,d,h,p){for(var g,f=Kekule.CoordUtils,m=p.bondWavyRadius*p.unitLength,C=f.getDistance(c,d),_=Math.round(C/m),y=f.divide(f.substract(d,c),_),T=C/_,E=[],b=c,v=Math.atan2(y.y,y.x)+Math.PI,I={x:T/1.5*Math.sin(v),y:-T/1.5*Math.cos(v)},R=1,N=0;N<_;++N){R=-R,g=b,b=f.add(g,y);var L=f.multiply(I,R),U=f.add(g,L),W=f.add(b,L);N===0&&(E.push("M"),E.push([g.x,g.y])),E.push("C"),E.push([U.x,U.y,W.x,W.y,b.x,b.y])}var M=Kekule.Render.DrawPathUtils.makePath.apply(Kekule.Render.DrawPathUtils,E),B=Object.create(p);B.strokeColor=p.color,B.fillColor=null;var V={element:this.drawPath(a,M,B)};return V.boundInfo=this.createLineBoundInfo(c,d,T),V}}),Kekule.Render.StructFragment2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment2DRenderer",initialize:function(a,o,l){this.tryApplySuper("initialize",[a,o,l]),this._concreteRenderer=null,this._concreteChemObj=null,this.initConcreteRenderer()},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null)},_getRenderSortIndex:function(){return this._concreteRenderer?this._concreteRenderer._getRenderSortIndex():this.tryApplySuper("_getRenderSortIndex")},initConcreteRenderer:function(){var a=this.getChemObj(),o=this.getDrawBridge();return this._isRendererMismatch(this._concreteRenderer,a)&&this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null,this._concreteChemObj=null),!this._concreteRenderer&&a&&(a.hasCtab()?(this._concreteChemObj=a.getCtab(),this._concreteRenderer=new Kekule.Render.ChemCtab2DRenderer(a.getCtab(),o,this)):a.hasFormula()&&(this._concreteChemObj=a.getFormula(),this._concreteRenderer=new Kekule.Render.Formula2DRenderer(a.getFormula(),o,this))),this._concreteRenderer},_isRendererMismatch:function(a,o){return a&&!o||a instanceof Kekule.Render.ChemCtab2DRenderer&&!o.hasCtab()||a instanceof Kekule.Render.Formula2DRenderer&&!o.hasFormula()},getConcreteRenderer:function(){return this.initConcreteRenderer(),this._concreteRenderer},_getConcreteRendererDrawOptions:function(a){return a},isChemObjRenderedBySelf:function(a,o){var l=this.getConcreteRenderer();return this.tryApplySuper("isChemObjRenderedBySelf",[a,o])||o===this.getChemObj()||l&&l.isChemObjRenderedBySelf(a,o)},isChemObjRenderedDirectlyBySelf:function(a,o){return this.getConcreteRenderer(),this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[a,o])||o===this.getChemObj()||o===this._concreteChemObj},doSetRedirectContext:function(a){this.tryApplySuper("doSetRedirectContext",[a]);var o=this.getConcreteRenderer();o&&o.setRedirectContext(a)},getChildObjs:function(){var a=this.getChemObj();if(a){for(var o=[],l=(a.getExposedNodes()||[]).concat(a.getExposedConnectors()||[]),u=0,c=l.length;u<c;++u){var d=l[u];d.getAttachedMarkers&&(o=o.concat(d.getAttachedMarkers()||[]))}return o.concat(this.tryApplySuper("getChildObjs"))}return this.tryApplySuper("getChildObjs")},_needWholelyDraw:function(a,o){var l=this.tryApplySuper("_needWholelyDraw",[a,o]);if(!l){for(var u=this.getChemObj(),c=!1,d=0,h=a.length;d<h;++d)if(a[d].isChildOf(u)){c=!0;break}l=c}return l},_createChargeAndRadicalMarkerOnStructFragment:function(a){a.beginUpdate();try{a.getCharge&&a.getCharge()&&a.fetchChargeMarker(!0),a.getNodes();for(var o=0,l=a.getNodeCount();o<l;++o){var u=a.getNodeAt(o);u.beginUpdate();try{u.getCharge()&&u.fetchChargeMarker(!0),u.getRadical()&&u.fetchRadicalMarker(!0),u.getNodeAt&&this._createChargeAndRadicalMarkerOnStructFragment(u)}finally{u.endUpdate()}}}finally{a.endUpdate()}},doDraw:function(a,o,l){var u=!!l.autoCreateChargeAndRadicalMarker;if(this.getCanModifyTargetObj()&&u){var c=this.getChemObj();this._createChargeAndRadicalMarkerOnStructFragment(c)}this.tryApplySuper("doDraw",[a,o,l])},doDrawSelf:function(a,o,l){this.tryApplySuper("doDrawSelf",[a,o,l]);var u=this.getChemObj(),c=o,d=this.getConcreteRenderer();if(!c&&d instanceof Kekule.Render.Formula2DRenderer&&u.getAbsBaseCoord2D){var h=u.getAbsBaseCoord2D(l.allowCoordBorrow);c=Kekule.CoordUtils.transform2D(h,l.transformParams)}return u.hasFormula()||u.hasCtab()?d?d.draw(a,c,this._getConcreteRendererDrawOptions(l)):void 0:null},doRedraw:function(a){return this.tryApplySuper("doRedraw",[a])},doUpdateSelf:function(a,o,l){if(this._extractObjsOfUpdateObjDetails(o).indexOf(this.getChemObj())>=0){var u=this.getRenderCache(a);return this.doClear(a),this.draw(a,u.baseCoord,u.options)}var c=this.getConcreteRenderer();if(c)return c.doUpdate(a,o,l)},doClearSelf:function(a){var o=this.getConcreteRenderer();if(o)return o.clear(a)},estimateRenderBox:function(a,o,l,u){var c=this.getConcreteRenderer();return c?c.estimateRenderBox(a,o,this._getConcreteRendererDrawOptions(l),u):null},transformCoordToObj:function(a,o,l){return this.tryApplySuper("transformCoordToObj",[a,o,l])},transformCoordToContext:function(a,o,l){return this.tryApplySuper("transformCoordToContext",[a,o,l])}}),Kekule.Render.Mol2DRenderer=Kekule.Render.StructFragment2DRenderer,Kekule.Render.CompositeObj2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj2DRenderer"}),Kekule.Render.CompositeMolecule2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){for(var a=[],o=this.getChemObj().getSubMolecules(),l=0,u=o.getItemCount();l<u;++l){var c=o.getObjAt(l);a.push(c)}return a.concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemObjGroupList2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){var a=this.getChemObj();if(a instanceof Kekule.ChemObjList)for(var o=[],l=0,u=a.getItemCount();l<u;++l)o.push(a.getItemAt(l));else a instanceof Kekule.ChemStructureObjectGroup&&(o=a.getAllObjs());return(o||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.Reaction2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.Reaction2DRenderer",getChildObjs:function(){for(var a=[],o=this.getChemObj(),l=(a=[],0),u=o.getReactantCount();l<u;++l){var c=o.getReactantAt(l);a.push(c)}for(l=0,u=o.getProductCount();l<u;++l)c=o.getProductAt(l),a.push(c);return(a||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemSpaceElement2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement2DRenderer",getChildObjs:function(){var a=this.tryApplySuper("getChildObjs")||[];return a=(this.getChemObj().getChildren().toArray()||[]).concat(a)}}),Kekule.Render.ChemSpace2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace2DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()].concat(this.tryApplySuper("getChildObjs")||[])},doEstimateSelfObjBox:function(a,o,l){var u=this.getChemObj().getSize2D()||{};return u.x&&u.y&&o.useExplicitSpaceSize?{x1:0,y1:0,x2:u.x,y2:u.y}:this.tryApplySuper("doEstimateSelfObjBox",[a,o,l])}}),Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.Charge,Kekule.Render.TextBasedChemMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.Radical,Kekule.Render.TextBasedChemMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemMarker.UnbondedElectronSet,Kekule.Render.UnbondedElectronSetRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.TextBlock,Kekule.Render.TextBlock2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ImageBlock,Kekule.Render.ImageBlock2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.Reaction,Kekule.Render.Reaction2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace2DRenderer)}(),function(){Kekule.Render.DrawPathUtils;var s=Kekule.CoordUtils,e=(Kekule.oneOf,Kekule.Glyph.NodeType),t=Kekule.Glyph.PathType;Kekule.Render.BaseGlyph2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.BaseGlyph2DRenderer",doDraw:function(n,i,r){var a=Object.create(r);return a.strokeColor=r.strokeColor||r.glyphStrokeColor,a.fillColor=r.fillColor||r.glyphFillColor,a.strokeWidth=r.strokeWidth||r.glyphStrokeWidth,a.lineCap=r.glyphLineCap,a.lineJoin=r.glyphLineJoin,this.tryApplySuper("doDraw",[n,i,a])}}),Kekule.Render.PathGlyphCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyphCtab2DRenderer",initialize:function(n,i,r){this.tryApplySuper("initialize",[n,i,r]),this._nodeCoordOverrideMap=new Kekule.MapEx(!0)},doFinalize:function(){this._nodeCoordOverrideMap.finalize(),this.tryApplySuper("doFinalize")},extractGlyphDrawOptions:function(n){var i=n.unitLength||1;return{strokeColor:n.strokeColor||n.color||n.glyphStrokeColor,fillColor:n.fillColor||n.color||n.glyphFillColor,strokeWidth:(n.strokeWidth||n.glyphStrokeWidth)*i,lineCap:n.lineCap||n.glyphLineCap,lineJoin:n.lineJoin||n.glyphLineJoin}},doDraw:function(n,i,r){var a=this.tryApplySuper("doDraw",[n,i,r]);return this._nodeCoordOverrideMap.clear(),a},doDrawNode:function(n,i,r,a,o,l){var u,c=r.getNodeType();if(!c||c===e.LOCATION||c===e.CONTROLLER){var d=this._nodeCoordOverrideMap.get(r)||this.getTransformedCoord2D(n,r,l.allowCoordBorrow);u=this.createPointBoundInfo(d)}u&&this.basicDrawObjectUpdated(n,r,a,u,Kekule.Render.ObjectUpdateType.ADD)},doDrawConnector:function(n,i,r,a,o,l){var u=this.tryApplySuper("doDrawConnector",[n,i,r,a,o,l]),c=r.getControlPoints&&r.getControlPoints();if(c)for(var d=0,h=c.length;d<h;++d){var p=this.getTransformedCoord2D(n,c[d],l.allowCoordBorrow),g=this.createPointBoundInfo(p);this.basicDrawObjectUpdated(n,c[d],r,g,Kekule.Render.ObjectUpdateType.ADD)}return u},doDrawConnectorShape:function(n,i,r,a,o){var l,u=Kekule.Glyph.ArrowSide,c=r[0],d=r[1],h=s.clone(this.getTransformedCoord2D(n,c,o.allowCoordBorrow)),p=s.clone(this.getTransformedCoord2D(n,d,o.allowCoordBorrow)),g=this.extractGlyphDrawOptions(a),f=i.getPathType(),m=i.getPathParams()||{},C=this.getChemObj(),_=(m.lineGap||0)*a.defScaleRefLength,y=_&&m.lineCount||1,T=[];if(m.startArrowType&&m.startArrowWidth&&(l={arrowLength:(E=this._transformArrowLength(n,m.startArrowLength,m.startArrowWidth)).arrowLength,arrowWidth:E.arrowWidth,arrowType:m.startArrowType,arrowSide:m.startArrowSide,drawOnCenter:!m.startArrowSide||m.startArrowSide===u.BOTH}),m.endArrowType&&m.endArrowWidth)var E,b={arrowLength:(E=this._transformArrowLength(n,m.endArrowLength,m.endArrowWidth)).arrowLength,arrowWidth:E.arrowWidth,arrowType:m.endArrowType,arrowSide:m.endArrowSide,drawOnCenter:!m.endArrowSide||m.endArrowSide===u.BOTH};for(var v=[],I=Kekule.Render.MetaShapeUtils.inflateShape,R=0,N=r.length;R<N;++R){var L=r[R].getPathNodeParams();if(L.useStickingOffset){var U=this.getStickingTargetRenderBound(n,r[R]);if(U){var W=L.stickingOffsetRelLength;Kekule.ObjUtils.isUnset(W)&&(W=a.glyphStickOffsetRelLength),W&&(U=I(U,this._doGetStickOffsetContextLength(n,W,a))),v[R]=U}}}var M=[],B=[],V={y:0,x:_},J=s.substract(this.transformCoordToContext(n,C,{x:0,y:0}),this.transformCoordToContext(n,C,V)),$=s.getDistance(J,{x:0,y:0});if(f===t.LINE)M=(ie=this._doDrawLineConnectorShape(n,C,i,r,h,p,y,$,l,b,v,g,a)).drawnElems,T=ie.arrowElems,B=ie.boundInfos;else if(f===t.ARC){var q=i.getControlPoints&&i.getControlPoints(),Q=q&&q[0];if(Q){var ie,Y=s.clone(this.getTransformedCoord2D(n,Q,o.allowCoordBorrow));M=(ie=this._doDrawArcConnectorShape(n,C,i,r,h,p,Y,y,$,l,b,v,g,a)).drawnElems,T=ie.arrowElems,B=ie.boundInfos}}if(B.length||(B=null),y<=1&&!T.length)return{element:M&&M[0],boundInfo:B&&B[0]};var ne=this.createDrawGroup(n);for(R=0;R<y;++R)M[R]&&this.addToDrawGroup(M[R],ne);for(R=0,N=T.length;R<N;++R)T[R]&&this.addToDrawGroup(T[R],ne);return{element:ne,boundInfo:B}},_doGetStickOffsetContextLength:function(n,i,r){var a={x:i*r.medianObjRefLength,y:0},o=this.getRootRenderer(),l=o.transformCoordToContext(n,this.getChemObj(),{x:0,y:0}),u=o.transformCoordToContext(n,this.getChemObj(),a);return s.getDistance(l,u)},_doDrawLineConnectorShape:function(n,i,r,a,o,l,u,c,d,h,p,g,f){for(var m=[o,l],C=[o,l],_=(s.divide(s.add(o,l),2),0);_<2;++_){var y=p[_];if(y){var T=Kekule.Render.MetaShapeUtils.getCrossPointsOfVectorToShapeEdges(C,y,!0);T&&T.length&&(m[_]=T[0],this._nodeCoordOverrideMap.set(a[_],m[_]))}}var E=Kekule.Glyph.ArrowSide,b=[],v=[],I=[],R=s.substract(m[1],m[0]),N=R.x,L=R.y,U=s.getDistance(m[0],m[1]),W=U,M=(u-1)/2,B=c,V={y:B*(N/U),x:-B*(L/U)},J=(s.multiply(V,(u-1)/2),s.multiply(V,(u-1)/2)),$=s.substract(m[0],J),q=s.substract(m[1],J);for(_=0;_<u;++_){if(ne=null,de=null,_!==0&&($=s.add($,V),q=s.add(q,V)),d||h){var Q=_-M,ie=B*Math.abs(Q);if(d){if(d.drawOnCenter&&(!d.arrowSide||d.arrowSide===E.SINGLE&&Q<0||d.arrowSide===E.REVERSED&&Q>0))var Y=d.arrowType===Kekule.Glyph.ArrowType.OPEN?d.arrowLength*ie/(d.arrowWidth/2):d.arrowLength,ne=s.add($,s.multiply(R,Y/W));d.drawOnCenter&&_===0&&Kekule.ArrayUtils.pushUnique(I,this.doDrawArrowShape(n,r,m[1],m[0],d,g,!0)),!d.drawOnCenter&&(d.arrowSide===E.SINGLE&&_===0||d.arrowSide===E.REVERSED&&_===u-1)&&Kekule.ArrayUtils.pushUnique(I,this.doDrawArrowShape(n,r,q,$,d,g,!0))}if(h){if(h.drawOnCenter&&(!h.arrowSide||h.arrowSide===E.SINGLE&&Q<0||h.arrowSide===E.REVERSED&&Q>0)){Y=h.arrowType===Kekule.Glyph.ArrowType.OPEN?h.arrowLength*ie/(h.arrowWidth/2):h.arrowLength;var de=s.substract(q,s.multiply(R,Y/W))}h.drawOnCenter&&_===0&&Kekule.ArrayUtils.pushUnique(I,this.doDrawArrowShape(n,r,m[0],m[1],h,g)),!h.drawOnCenter&&(h.arrowSide===E.SINGLE&&_===0||h.arrowSide===E.REVERSED&&_===u-1)&&Kekule.ArrayUtils.pushUnique(I,this.doDrawArrowShape(n,r,$,q,h,g))}}var Ae=this.doDrawLineShape(n,r,ne||$,de||q,g,f);b.push(Ae.element),v.push(Ae.boundInfo)}return{drawnElems:b,boundInfos:v,arrowElems:I}},_doDrawArcConnectorShape:function(n,i,r,a,o,l,u,c,d,h,p,g,f,m){for(var C=[],_=[],y=[],T=[o,l],E=s.divide(s.add(u,T[0]),2),b=s.divide(s.add(T[1],u),2),v=-(T[0].x-u.x)/(T[0].y-u.y),I=-(T[1].x-u.x)/(T[1].y-u.y),R={x:(b.y-E.y-I*b.x+v*E.x)/(v-I),y:E.y+v*(b.y-E.y-I*b.x+I*E.x)/(v-I)},N=s.getDistance(R,T[0]),L=s.substract(T[0],R),U=s.substract(T[1],R),W=s.substract(u,R),M=Kekule.GeometryUtils.standardizeAngle(Math.atan2(L.y,L.x)),B=Kekule.GeometryUtils.standardizeAngle(Math.atan2(U.y,U.x)),V=Kekule.GeometryUtils.standardizeAngle(Math.atan2(W.y,W.x)),J=[],$=0;$<2;++$){var q=g[$];if(q){var Q=this._getCrossCoordsAndAnglesOfArcToShapeEdges(R,N,M,B,V,q);if(Q&&Q.length>=1){var ie=Q[0].coord,Y=Q[0].angle;J[$]=Y,T[$]=ie,this._nodeCoordOverrideMap.set(a[$],ie)}}}J[0]&&(M=J[0]),J[1]&&(B=J[1]);var ne,de,Ae=B-M,Ce=V-M,pe=V-B,fe=Math.sign(Ce)*Math.sign(pe)*Math.sign(Ae)>0,Te=10/N;if(h){var xe=M-(fe?Te:-Te);ne={x:Math.cos(xe),y:Math.sin(xe)}}p&&(xe=B+(fe?Te:-Te),de={x:Math.cos(xe),y:Math.sin(xe)});var Re=N-d*((c-1)/2);for($=0;$<c;++$){var we=Re+$*d;if((h||p)&&c<=1){if(h&&$===0){var Me=s.add(R,s.multiply(ne,we));Kekule.ArrayUtils.pushUnique(y,this.doDrawArrowShape(n,r,Me,T[0],h,f,!0))}p&&$===0&&(Me=s.add(R,s.multiply(de,we)),Kekule.ArrayUtils.pushUnique(y,this.doDrawArrowShape(n,r,Me,T[1],p,f,!0)))}var Le=this.doDrawArcShape(n,R,we,M,B,fe,f);Le.element&&C.push(Le.element),Le.boundInfo&&_.push(Le.boundInfo)}return{drawnElems:C,boundInfos:_,arrowElems:y}},_getCrossCoordsAndAnglesOfArcToShapeEdges:function(n,i,r,a,o,l){for(var u=Kekule.Render.MetaShapeUtils.getEdgeBasicElements(l),c=u.vectors,d=[],h=0,p=c.length;h<p;++h){var g=c[h];(m=Kekule.GeometryUtils.getCrossPointsOfVectorToCircle(g,n,i,1e-4))&&m.length&&(d=d.concat(m))}var f=u.circles;for(h=0,p=f.length;h<p;++h){var m;g=f[h],(m=Kekule.GeometryUtils.getCrossPointsOfCircles(g.center,g.radius,n,i,1e-4))&&m.length&&(d=d.concat(m))}var C=[],_=Math.sign((o-r)*(o-a));for(h=0,p=d.length;h<p;++h){var y=s.substract(d[h],n),T=Kekule.GeometryUtils.standardizeAngle(Math.atan2(y.y,y.x));Math.sign((T-r)*(T-a))===_&&C.push({angle:T,coord:d[h]})}return C},_getNearestCoordToPoint:function(n,i){for(var r=null,a=null,o=0,l=i.length;o<l;++o){var u=s.getDistance(i[o],n);(!r||u<a)&&(r=i[o],a=u)}return r},_transformArrowLength:function(n,i,r){var a={x:i||0,y:r||0},o=Kekule.CoordUtils.substract(this.transformCoordToContext(n,this.getChemObj(),a),this.transformCoordToContext(n,this.getChemObj(),{x:0,y:0}));return{arrowLength:Math.abs(o.x),arrowWidth:Math.abs(o.y)}},doDrawArrowShape:function(n,i,r,a,o,l,u){var c,d,h=Kekule.Glyph.ArrowSide,p=Kekule.Glyph.ArrowType,g=s.substract(a,r),f=s.getDistance(a,r),m=g.y/f,C=g.x/f,_=o.arrowLength,y=o.arrowWidth/2,T=s.substract(a,s.multiply(g,_/f)),E={x:y*m,y:-y*C},b=Kekule.Render.DrawPathUtils,v=[];!o.arrowSide||!u&&o.arrowSide===h.SINGLE||u&&o.arrowSide===h.REVERSED?(c=s.add(T,E),v.push("M"),v.push([c.x,c.y]),v.push("L"),v.push([a.x,a.y])):(v.push("M"),v.push([a.x,a.y])),(!o.arrowSide||!u&&o.arrowSide===h.REVERSED||u&&o.arrowSide===h.SINGLE)&&(d=s.substract(T,E),v.push("L"),v.push([d.x,d.y]));var I=!1;if(o.arrowType===p.TRIANGLE){var R=c&&d?null:T;R&&(v.push("L"),v.push([R.x,R.y])),v.push("Z"),I=!0}var N=b.makePath.apply(this,v),L=Object.create(l);return I||(L.fillColor="transparent"),this.drawPath(n,N,L)},doDrawLineShape:function(n,i,r,a,o,l){return{element:this.drawLine(n,r,a,o),boundInfo:this.createLineBoundInfo(r,a,o.strokeWidth)}},doDrawArcShape:function(n,i,r,a,o,l,u){var c=Object.create(u);return c.fillColor=null,{element:this.drawArc(n,i,r,a,o,l,c),boundInfo:this.createArcBoundInfo(i,r,a,o,l,c.strokeWidth)}}}),Kekule.Render.PathGlyph2DRenderer=Class.create(Kekule.Render.BaseGlyph2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyph2DRenderer",initialize:function(n,i,r){this.tryApplySuper("initialize",[n,i,r]),this._concreteChemObj=n.getCtab(),this._concreteRenderer=new Kekule.Render.PathGlyphCtab2DRenderer(n.getCtab(),i,this)},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&(this._concreteRenderer.finalize(),this._concreteRenderer=null)},_getRenderSortIndex:function(){return this._concreteRenderer?this._concreteRenderer._getRenderSortIndex():this.tryApplySuper("_getRenderSortIndex")},getRenderCache:function(n){return this._concreteRenderer.getRenderCache(n)},_getConcreteRendererDrawOptions:function(n){return n},isChemObjRenderedBySelf:function(n,i){return this.tryApplySuper("isChemObjRenderedBySelf",[n,i])||i===this.getChemObj()||this._concreteRenderer.isChemObjRenderedBySelf(n,i)},isChemObjRenderedDirectlyBySelf:function(n,i){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[n,i])||i===this.getChemObj()},doSetRedirectContext:function(n){this.tryApplySuper("doSetRedirectContext",[n]),this._concreteRenderer.setRedirectContext(n)},doDraw:function(n,i,r){this.tryApplySuper("doDraw",[n,i,r]),this.getChemObj();var a=Object.create(r);return a.partialDrawObjs&&(a.partialDrawObjs=null),this._concreteRenderer.draw(n,i,this._getConcreteRendererDrawOptions(a))},doRedraw:function(n){return this._concreteRenderer.redraw(n)},doUpdate:function(n,i,r){if(this._extractObjsOfUpdateObjDetails(i).indexOf(this.getChemObj())>=0){var a=this.getRenderCache(n);return this.doClear(n),this.draw(n,a.baseCoord,a.options)}return this._concreteRenderer.doUpdate(n,i,r)},doClear:function(n){return this._concreteRenderer.clear(n)},estimateRenderBox:function(n,i,r){return this._concreteRenderer.estimateRenderBox(n,this._getConcreteRendererDrawOptions(i),r)},transformCoordToObj:function(n,i,r){var a=this.getChemObj()===i?this._concreteChemObj:i;return this._concreteRenderer.transformCoordToObj(n,a,r)},transformCoordToContext:function(n,i,r){var a=this.getChemObj()===i?this._concreteChemObj:i;return this._concreteRenderer.transformCoordToContext(n,a,r)}}),Kekule.Render.Renderer2DFactory.register(Kekule.Glyph.PathGlyph,Kekule.Render.PathGlyph2DRenderer)}(),Kekule.Render.CanvasRendererBridge=Class.create(Kekule.Render.Abstract2DDrawBridge,{CLASS_NAME:"Kekule.Render.CanvasRendererBridge",DEF_DOUBLE_BUFFERED:!1,SHADOW_CANVAS_FIELD:"__$shadow_canvas__",SHADOW_CONTEXT_FIELD:"__$shadow_context__",getShadowContext:function(s){return s[this.SHADOW_CONTEXT_FIELD]},getShadowCanvas:function(s){return s[this.SHADOW_CANVAS_FIELD]},getOperatingContext:function(s){return this.getShadowContext(s)||s},createContext:function(s,e,t,n){var i=n&&n.id,r=n&&n.doubleBuffered;r===void 0&&(r=this.DEF_DOUBLE_BUFFERED),s.ownerDocument;var a=document.createElement("canvas");i&&(a.id=i);var o={alpha:!0};n&&(o=Object.extend(o,n)),s.appendChild(a);var l=a.getContext("2d",o);if(r){var u=document.createElement("canvas");u.style.position="absolute",u.style.display="none",s.appendChild(u),l[this.SHADOW_CANVAS_FIELD]=u,l[this.SHADOW_CONTEXT_FIELD]=u.getContext("2d",o)}return n&&n.overSamplingRatio&&this.setContextParam(l,"overSamplingRatio",n.overSamplingRatio),this.setContextDimension(l,e,t),l},releaseContext:function(s){var e=s.canvas,t=this.getShadowCanvas(s),n=e.parentNode;n&&(n.removeChild(e),t&&n.removeChild(t))},_getContextRawDimension:function(s){return{width:s.canvas.width,height:s.canvas.height}},_setContextRawDimension:function(s,e,t){var n=this.getShadowCanvas(s);e&&(s.canvas.width=e,s.canvas.style.width=e+"px",n&&(n.width=e,n.style.width=e+"px")),t&&(s.canvas.height=t,s.canvas.style.height=t+"px",n&&(n.height=t,n.style.height=t+"px")),this.clearContext(s)},getContextElem:function(s){return s?s.canvas:null},setContextViewBox:function(s,e,t,n,i,r){},prepareContext:function(s){},clearContext:function(s){var e=s.canvas;e.setAttribute("width",e.width);var t=this.getShadowCanvas(s);t&&(t.width=e.width);var n=s.__$clearColor__;if(n){s.save();try{var i=this.getContextDimension(s);this.drawRect(s,{x:0,y:0},{x:i.width,y:i.height},{fillColor:n,strokeColor:n})}finally{s.restore()}}},setClearColor:function(s,e){s&&(s.__$clearColor__=e)},setFilter:function(s,e){var t=this.getContextElem(s);t&&(t.style.filter=e)},clearFilter:function(s){this.setFilter(s,"none")},renderContext:function(s){var e=this.getShadowCanvas(s);if(e){var t=this.getContextDimension(s);s.drawImage(e,0,0,t.width,t.height)}},canModifyGraphic:function(s){return!1},_drawDashLine:function(s,e,t,n){n==null&&(n=5),s.moveTo(e.x,e.y);for(var i=t.x-e.x,r=t.y-e.y,a=Math.floor(Math.sqrt(i*i+r*r)/n),o=i/a,l=r/a,u=0,c=e.x,d=e.y;u++<a;)c+=o,d+=l,s[u%2==0?"moveTo":"lineTo"](c,d);s[u%2==0?"moveTo":"lineTo"](t.x2,t.y)},drawLine:function(s,e,t,n){var i=this.getOperatingContext(s);i.beginPath(),this.setDrawStyle(i,n),n.strokeDash&&!this.isLineDashSupported(i)?this._drawDashLine(i,e,t,n.strokeDash):(i.moveTo(e.x,e.y),i.lineTo(t.x,t.y)),this.doneDraw(i,n)},drawTriangle:function(s,e,t,n,i){var r=this.getOperatingContext(s);r.beginPath(),this.setDrawStyle(r,i),r.moveTo(e.x,e.y),r.lineTo(t.x,t.y),r.lineTo(n.x,n.y),r.closePath(),this.doneDraw(r,i)},drawRect:function(s,e,t,n){var i=this.getOperatingContext(s);i.beginPath(),this.setDrawStyle(i,n),i.rect(e.x,e.y,t.x-e.x,t.y-e.y),this.doneDraw(i,n)},drawRoundRect:function(s,e,t,n,i){return this.drawRect(s,e,t,i)},drawCircle:function(s,e,t,n){var i=this.getOperatingContext(s);i.beginPath(),this.setDrawStyle(i,n),i.arc(e.x,e.y,t,0,2*Math.PI,!1),this.doneDraw(i,n)},drawArc:function(s,e,t,n,i,r,a){var o=this.getOperatingContext(s);o.beginPath(),this.setDrawStyle(o,a),o.arc(e.x,e.y,t,n,i,r),this.doneDraw(o,a)},_PATH_CMDS:["M","Z","L","C","Q"],_PATH_METHODS:["moveTo","closePath","lineTo","bezierCurveTo","quadraticCurveTo"],drawPath:function(s,e,t){var n=this.getOperatingContext(s);if(!(e.length<=0)){var i;n.beginPath(),this.setDrawStyle(n,t);for(var r=0,a=e.length;r<a;++r){i=[];var o=e[r],l=o.method.toUpperCase(),u=this._PATH_CMDS.indexOf(l);if(u>=0){var c=this._PATH_METHODS[u];i=o.params,n[c].apply(n,i)}}this.doneDraw(n,t)}},drawImage:function(s,e,t,n,i,r,a){var o=this.getOperatingContext(s),l=this.getContextElem(o).ownerDocument.createElement("img");l.src=e;var u=this;l.onload=function(){try{u.setDrawStyle(o,i);var c=s;a&&(c=a()),(c=u.getOperatingContext(c)).drawImage(l,t.x,t.y,n.x,n.y),r&&r(!0),u.doneDraw(o,i),l.onload=null}catch(d){throw r&&r(!1),d}},l.src=e},drawImageElem:function(s,e,t,n,i){var r=this.getOperatingContext(s);this.setDrawStyle(r,i),r.drawImage(e,t.x,t.y,n.x,n.y),this.doneDraw(r,i)},isLineDashSupported:function(s){return Kekule.ObjUtils.isUnset(this.isLineDashSupported._cachedValue)&&(this.isLineDashSupported._cachedValue=s.setLineDash&&typeof s.lineDashOffset=="number"),this.isLineDashSupported._cachedValue},setTransformSeq:function(s,e){for(var t=Kekule.CoordUtils,n=Kekule.MatrixUtils,i=n.createIdentity(3),r=0,a=e.length;r<a;++r){var o=e[r],l=Object.extend({rotateAngle:o.rotate},o),u=t.calcTransform2DMatrix(l);i=n.multiply(i,u)}s.setTransform(i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2])},setDrawStyle:function(s,e){if(Kekule.ObjUtils.notUnset(e.strokeWidth)?s.lineWidth=e.strokeWidth:s.lineWidth=1,e.strokeColor&&(s.strokeStyle=e.strokeColor),s.lineCap=e.lineCap||"butt",s.lineJoin=e.lineJoin||"miter",this.isLineDashSupported(s))if(e.strokeDash){var t=e.strokeDash===!0?[5]:Kekule.ArrayUtils.isArray(e.strokeDash)?e.strokeDash:[e.strokeDash];s.setLineDash(t)}else s.setLineDash([]);e.fillColor?s.fillStyle=e.fillColor:s.fillStyle="transparent",Kekule.ObjUtils.notUnset(e.opacity)?s.globalAlpha=e.opacity:s.globalAlpha=1,e.transforms&&e.transforms.length||e.transform?this.setTransformSeq(s,e.transforms||[e.transform]):s.setTransform(1,0,0,1,0,0)},doneDraw:function(s,e){s.stroke(),e.fillColor&&s.fill()},getCanvasFontStyle:function(s){var e="";return s.fontStyle&&(e+=s.fontStyle+" "),s.fontWeight&&(e+=s.fontWeight+" "),s.fontSize&&(typeof s.fontSize=="string"?e+=s.fontSize+" ":e+=s.fontSize+"px "),s.fontFamily&&(e+=s.fontFamily+" "),e},drawText:function(s,e,t,n){var i=this.getOperatingContext(s),r=i.font,a=i.fillStyle,o=this.getCanvasFontStyle(n);this.setDrawStyle(i,n),i.font=o,n.color&&(i.fillStyle=n.color),i.textBaseline="top",i.fillText(t,e.x,e.y),i.fontStyle=r,i.fillStyle=a},canMeasureText:function(s){return!0},measureText:function(s,e,t){var n=this.getCanvasFontStyle(t);s.font=n;var i=s.measureText(e),r=t.fontSize;return typeof r=="string"&&(r=Kekule.StyleUtils.analysisUnitsValue(r).value),{width:i.width,height:r}},canMeasureDrawnText:function(s){return!1},canModifyText:function(s){return!1},createGroup:function(s){},addToGroup:function(s,e){},removeFromGroup:function(s,e){},exportToDataUri:function(s,e,t){var n=this.getContextElem(s);return n?n.toDataURL(e,t):null}}),Kekule.Render.CanvasRendererBridge.isSupported=function(){var s=!1,e=Kekule.$jsRoot.document;return e&&e.createElement&&(s=!!e.createElement("canvas").getContext),s},Kekule.Render.CanvasRendererBridge.getAvailabilityInformation=function(){var s=!1,e=Kekule.$jsRoot.document;return e&&e.createElement&&(s=!!e.createElement("canvas").getContext),{available:s,message:s?null:Kekule.$L("ErrorMsg.CANVAS2D_NOT_UNAVAILABLE")}},Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.CanvasRendererBridge,20),function(){var s;Kekule.Render.RaphaelRendererBridge=Class.create(Kekule.Render.Abstract2DDrawBridge,{CLASS_NAME:"Kekule.Render.RaphaelRendererBridge",createContext:function(t,n,i,r){return s(t,n,i)},releaseContext:function(t){t.remove()},getContextDimension:function(t){return{width:t.width,height:t.height}},setContextDimension:function(t,n,i){t.setSize(n,i),this.clearContext(t)},clearContext:function(t){t.clear();var n=t.__$clearColor__;if(n){var i=this.getContextDimension(t);this.drawRect(t,{x:0,y:0},{x:i.width,y:i.height},{fillColor:n,strokeColor:n})}},setClearColor:function(t,n){t&&(t.__$clearColor__=n)},setFilter:function(t,n){var i=this.getContextElem(t);i&&(i.style.filter=n)},clearFilter:function(t){this.setFilter(t,"none")},getContextElem:function(t){return t?t.canvas:null},transformContextCoordToScreen:function(t,n){return n},transformScreenCoordToContext:function(t,n){return n},canModifyGraphic:function(t){return!0},drawPath:function(t,n,i){for(var r="",a=0,o=n.length;a<o;++a){var l=n[a];if(r+=l.method,l.params&&l.params.length)for(var u=0,c=l.params.length;u<c;++u)r+=u===0?"":",",DataType.isArrayValue(l.params[u])?r+=l.params[u].join(","):r+=l.params[u]}var d=t.path(r);return this.setBasicElemAttribs(d,i),d},drawLine:function(t,n,i,r){var a=t.line(n.x,n.y,i.x,i.y);return this.setBasicElemAttribs(a,r),a},drawTriangle:function(t,n,i,r,a){var o=t.triangle(n.x,n.y,i.x,i.y,r.x,r.y);return this.setBasicElemAttribs(o,a),o},drawRect:function(t,n,i,r){var a=t.rect(n.x,n.y,i.x-n.x,i.y-n.y);return this.setBasicElemAttribs(a,r),a},drawRoundRect:function(t,n,i,r,a){var o=t.rect(n.x,n.y,i.x-n.x,i.y-n.y,r);return this.setBasicElemAttribs(o,a),o},drawCircle:function(t,n,i,r){var a=t.circle(n.x,n.y,i);return this.setBasicElemAttribs(a,r),a},drawArc:function(t,n,i,r,a,o,l){var u=Kekule.GeometryUtils.polarToCartesian,c=Kekule.GeometryUtils.standardizeAngle,d=(Kekule.CoordUtils,u(n.x,n.y,i,a)),h=u(n.x,n.y,i,r),p=c(r,0),g=c(a,0)-p,f=c(g)<=Math.PI&&!o||c(g)>Math.PI&&o?"0":"1",m=o?"1":"0",C=["M",d.x,d.y,"A",i,i,0,f,m,h.x,h.y].join(" "),_=t.path(C);return this.setBasicElemAttribs(_,l),_},drawImage:function(t,n,i,r,a,o){try{var l=t.image(n,i.x,i.y,r.x,r.y);this.setBasicElemAttribs(l,a),o&&o(!0)}catch(u){throw o&&o(!1),u}return l},drawImageElem:function(t,n,i,r,a){return this.drawImage(t,n.src,i,r,a)},setBasicElemAttribs:function(t,n){Kekule.ObjUtils.notUnset(n.strokeWidth)&&t.attr("stroke-width",n.strokeWidth),n.strokeColor&&t.attr("stroke",n.strokeColor),n.strokeDash&&t.attr("stroke-dasharray","- "),n.fillColor&&t.attr("fill",n.fillColor),n.opacity&&t.attr({"stroke-opacity":n.opacity,"fill-opacity":n.opacity}),n.lineCap&&t.attr("stroke-linecap",n.lineCap),n.lineJoin&&t.attr("stroke-linejoin",n.lineJoin),(n.transforms&&n.transforms.length||n.transform)&&this.setTransformSeq(t,n.transforms||[n.transform])},setTransformSeq:function(t,n){for(var i=0,r=n.length;i<r;++i){var a=Object.extend({rotateAngle:n[i].rotate},n[i]);this.setTransform(t,a)}},setTransform:function(t,n){var i=n.center||{x:0,y:0};n.rotateAngle&&t.rotate(n.rotateAngle/Math.PI*180,i.x,i.y);var r=Kekule.oneOf(n.scaleX,n.scale,1),a=Kekule.oneOf(n.scaleY,n.scale,1);r===1&&a===1||t.scale(r,a,i.x,i.y),(n.translateX||n.translateY)&&t.translate(n.translateX||0,n.translateY||0)},getRaphaelFontStyle:function(t){var n={};return t.fontStyle&&(n["font-style"]=t.fontStyle),t.fontWeight&&(n["font-weight"]=t.fontWeight),t.fontSize&&(n["font-size"]=t.fontSize+"px"),t.fontFamily&&(n["font-family"]=t.fontFamily),n},drawText:function(t,n,i,r){i.endsWith(" ")&&(i=i.substring(0,i.length-1)+" "),i.startsWith(" ")&&(i=" "+i.substr(1));var a=this.getRaphaelFontStyle(r),o=t.text(-1e4,-1e4,i);return o.attr(a),r.color&&o.attr({stroke:r.color,fill:r.color}),this.modifyDrawnTextCoord(t,o,n),this.setBasicElemAttribs(o,r),o},canMeasureText:function(t){return!1},canMeasureDrawnText:function(t){return!0},canModifyText:function(t){return!0},measureDrawnText:function(t,n,i){var r=Kekule.oneOf,a=n.getBBox(),o={};return o.width=r(a.width,a.x2-a.x1),o.height=r(a.height,a.y2-a.y1),o},modifyDrawnTextCoord:function(t,n,i){var r=this.measureDrawnText(t,n,null);n.attr({x:i.x+r.width/2,y:i.y+r.height/2})},createGroup:function(t){return t.set()},addToGroup:function(t,n){return n.push(t)},removeFromGroup:function(t,n){return t!==n&&n.exclude(t)},removeDrawnElem:function(t,n){n.remove()},exportToDataUri:function(t,n,i){if(t.toSVG){var r=t.toSVG();return"data:image/svg+xml;base64,"+btoa(r)}if(t.canvas&&t.canvas.tagName.toLowerCase()==="svg")return r=DataType.XmlUtility.serializeNode(t.canvas),"data:image/svg+xml;base64,"+btoa(r)}}),Kekule.Render.RaphaelRendererBridge.isSupported=function(){var t=!1;return Kekule.$jsRoot.Raphael&&(t=!(!s.svg&&!s.vml)),t},Kekule.Render.RaphaelRendererBridge.getAvailabilityInformation=function(){var t=!!Kekule.$jsRoot.Raphael,n=!(!t||!Kekule.$jsRoot.Raphael.svg&&!Kekule.$jsRoot.Raphael.vml);return{available:!!n,message:t?n?null:Kekule.$L("ErrorMsg.RAPHAEL_SVG_VML_UNAVAILABLE"):Kekule.$L("ErrorMsg.RAPHAEL_LIB_NOT_UNAVAILABLE")}},Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.RaphaelRendererBridge,10);var e=function(){var t;e.registered||Kekule.$jsRoot.Raphael&&Kekule.$jsRoot.Raphael.el&&(t=Kekule.$jsRoot.Raphael,Kekule.Render.registerExternalModule("Raphael.js",t),e.registered=!0)};Kekule.externalResourceManager.on("Raphael.jsRegistered",function(){(s=Kekule.externalResourceManager.getResource("Raphael.js"))&&(s.fn.line=function(t,n,i,r){return this.path("M"+t+" "+n+" L"+i+" "+r)},s.fn.arrowLine=function(t,n,i,r,a){if(!a)return this.line(t,n,i,r);var o=this.set(),l=i-t,u=r-n,c=Math.atan(u/l),d=(a.width||6)/2,h=a.length||3,p=Math.atan(d/h),g=Math.sqrt(Math.sqr(d)+Math.sqr(h));return o.push(this.path("M"+i+" "+r+" L"+(i-g*Math.cos(c-p))+" "+(r-g*Math.sin(c-p))+" M"+i+" "+r+" L"+(i-g*Math.cos(c+p))+" "+(r-g*Math.sin(c+p))),this.path("M"+t+" "+n+" L"+i+" "+r)),o},s.fn.triangle=function(t,n,i,r,a,o){return this.path("M"+t+" "+n+" L"+i+" "+r+" L"+a+" "+o+" L"+t+" "+n)},s.fn.polygon=function(t){for(var n="M"+t[0].x+" "+t[0].y,i=1,r=t.length;i<r;++i)n+=" L"+t[i].x+" "+t[i].y;return n+="L"+t[0].x+" "+t[0].y,this.path(n)},s.el.translateCoord=function(t){if(this.forEach)this.forEach(function(i){i.translateCoord(t)});else{var n=this.attr(["x","y"]);n.x!==void 0&&n.y!==void 0&&this.attr({x:n.x+t.x,y:n.y+t.y})}return this},s.st.translateCoord=function(t){return this.forEach&&this.forEach(function(n){n.translateCoord(t)}),this},s.st.remove=function(t){this.forEach(function(n){n.remove()},this),this.clear()}),Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.RaphaelRendererBridge,10)}),Kekule.externalResourceManager.on("Raphael.jsUnregistered",function(){}),e(),Kekule.X.domReady(e)}(),function(){var s=Kekule.ObjUtils,e=Kekule.BoxUtils,t=Kekule.Render.Molecule3DDisplayType,n=Kekule.Render.Bond3DRenderMode,i=Kekule.Render.Bond3DRenderType,r=Kekule.Render.Bond3DSpliceMode,a=Kekule.Render.Node3DRenderMode,o=Kekule.oneOf;Kekule.globalOptions.add("render.render3D",{autofitOnPrimaryDirection:!1}),Kekule.Render.Abstract3DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract3DDrawBridge",CONTEXT_PARAMS_FIELD:"__$context_params__",getGraphicQualityLevel:function(){return null},setGraphicQualityLevel:function(l){},transformContextCoordToScreen:function(l,u){return{x:u.x,y:u.y}},canModifyGraphic:function(l){return!1},createContext:function(l,u,c){return null},getContextDimension:function(l){return{}},setContextDimension:function(l,u,c){return null},clearContext:function(l){return null},getContextParam:function(l,u){return(l[this.CONTEXT_PARAMS_FIELD]||{})[u]},setContextParam:function(l,u,c){l[this.CONTEXT_PARAMS_FIELD]||(l[this.CONTEXT_PARAMS_FIELD]={}),l[this.CONTEXT_PARAMS_FIELD][u]=c},_getOverSamplingRatio:function(l){return this.getContextParam(l,"overSamplingRatio")||null},setClearColor:function(l,u){},drawSphere:function(l,u,c,d){},drawCylinder:function(l,u,c,d,h){},drawLine:function(l,u,c,d){},createDrawGroup:function(l){},addToDrawGroup:function(l,u){},removeFromDrawGroup:function(l,u){},getCameraProps:function(l){},setCameraProps:function(l,u){},exportToDataUri:function(l,u,c){}}),Kekule.Render.Base3DRenderer=Class.create(Kekule.Render.CompositeRenderer,{CLASS_NAME:"Kekule.Render.Base3DRenderer",initialize:function(l,u,c){this.tryApplySuper("initialize",[l,u,c])},getRendererType:function(){return Kekule.Render.RendererType.R3D},getActualTargetContext:function(l){return this.getRedirectContext()||l},getCameraProps:function(l){return this.getDrawBridge().getCameraProps(l)},setCameraProps:function(l,u){return this.getDrawBridge().setCameraProps(l,u)},getInitialLightPositions:function(l){return this.getDrawBridge().getInitialLightPositions&&this.getDrawBridge().getInitialLightPositions(l)},getLightCount:function(l){return this.getDrawBridge().getLightCount&&this.getDrawBridge().getLightCount(l)},getLightProps:function(l,u){return this.getDrawBridge().getLightProps&&this.getDrawBridge().getLightProps(l,u)},setLightProps:function(l,u,c){return this.getDrawBridge().setLightProps(l,u,c)},drawSphere:function(l,u,c,d){return this.getDrawBridge().drawSphere(this.getActualTargetContext(l),u,c,d)},drawCylinder:function(l,u,c,d,h){var p=this.getDrawBridge();return p?p.drawCylinder(this.getActualTargetContext(l),u,c,d,h):null},drawCylinderEx:function(l,u,c,d,h){var p=null,g=this.drawCylinder(l,u,c,d,h);if(g&&h.withEndCaps){p=this.createDrawGroup(l);var f=this.drawSphere(l,u,d);this.addToDrawGroup(f,p),f=this.drawSphere(l,c,d),this.addToDrawGroup(f,p)}return p||g},drawParallelCylinders:function(l,u,c){var d=this.getDrawBridge();if(d.drawParallelCylinders)return d.drawParallelCylinders(this.getActualTargetContext(l),u,c);for(var h=this.createDrawGroup(l),p=0,g=u.length;p<g;++p){var f=u[p],m=this.drawCylinderEx(l,f.coord1,f.coord2,f.radius,{color:f.color,withEndCaps:c});m&&this.addToDrawGroup(m,h)}return h},drawLine:function(l,u,c,d){var h=this.getDrawBridge();return h?h.drawLine(this.getActualTargetContext(l),u,c,d):null},drawParallelLines:function(l,u,c){var d=this.getDrawBridge();if(d.drawParallelLines)return d.drawParallelLines(this.getActualTargetContext(l),u,c);if(d.drawLine){for(var h,p=u.length,g=[],f=0;f<p;++f){var m=u[f],C=this.drawLine(l,m.coord1,m.coord2,{lineWidth:m.lineWidth,color:m.color,opacity:m.opacity});C&&g.push(C)}if(g.length<=1)h=g[0];else{h=this.createDrawGroup(l),f=0;for(var _=g.length;f<_;++f)this.addToDrawGroup(g[f],h)}return h}},createDrawGroup:function(l){return this.getDrawBridge().createGroup(this.getActualTargetContext(l))},addToDrawGroup:function(l,u){return this.getDrawBridge().addToGroup(l,u)},removeFromDrawGroup:function(l,u){return this.getDrawBridge().removeFromGroup(l,u)},removeDrawnElem:function(l,u){}}),Kekule.Render.ChemObj3DRenderer=Class.create(Kekule.Render.Base3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj3DRenderer",initialize:function(l,u,c){this.tryApplySuper("initialize",[l,u,c]),this._enableTransformByCamera=!0},doEstimateSelfObjBox:function(l,u,c){return Kekule.Render.ObjUtils.getContainerBox(this.getChemObj(),this.getCoordMode(),c)},doEstimateRenderBox:function(l,u,c,d){var h=this.estimateObjBox(l,c,d);if(h){var p=this.prepareTransformParams(l,u,c,h);return e.transform3D(h,p)}return null},beginDraw:function(l,u,c){if(this.tryApplySuper("beginDraw",[l,u,c]),this.isRootRenderer()){var d=this.getDrawBridge();if(d&&d.setGraphicQualityLevel){var h=c.graphicQuality;d.setGraphicQualityLevel(h)}}},endDraw:function(l,u,c){this.isRootRenderer()&&this.adjustCamera(l,c.transformParams),this.tryApplySuper("endDraw",[l,u,c])},doDraw:function(l,u,c){return this.prepareTransformParams(l,u,c),this.tryApplySuper("doDraw",[l,u,c])},changeGeometryOptions:function(l,u,c){var d=Object.create(c);this.prepareTransformParams(l,u,d).pureCameraTransform?this.endDraw(l,u,d):(this.getDrawBridge().clearContext(l),this.draw(l,u,c))},prepareTransformParams:function(l,u,c,d){var h;if(c.transformParams)h=c.transformParams;else{var p=this.generateTransformParams(l,u,c,d);c.transformParams=p,h=p}var g=Kekule.CoordUtils.calcTransform3DMatrix(h),f=Kekule.CoordUtils.calcInverseTransform3DMatrix(h);return c.transformParams.transformMatrix=g,c.transformParams.invTransformMatrix=f,this.getRenderCache(l).transformParams=h,this.getRenderCache(l).transformMatrix=g,this.getRenderCache(l).invTransformMatrix=f,this.getRenderCache(l).transformParams=h,h},canDoPureCameraTransform:function(l,u){return this._enableTransformByCamera&&u.scaleX===u.scaleY&&u.scaleY===u.scaleZ&&!u.rotateAngle&&!u.rotateX&&!u.rotateY&&!u.rotateZ},generateTransformParams:function(l,u,c,d){var h={};h.allowCoordBorrow=o(c.allowCoordBorrow,!1),h.unitLength=c.unitLength||1,d||(d=this.estimateObjBox(l,c,h.allowCoordBorrow)),d||(d={x1:0,x2:1,y1:0,y2:1,z1:0,z2:1});var p={x:(d.x1+d.x2)/2,y:(d.y1+d.y2)/2,z:(d.z1+d.z2)/2},g=Kekule.ObjUtils;g.isUnset(c.translateX)&&g.isUnset(c.translateY)&&g.isUnset(c.translateZ)?u&&(h.translateX=u.x-p.x,h.translateY=u.y-p.y,h.translateZ=u.z||0-p.z||0):(h.translateX=c.translateX||0,h.translateY=c.translateY||0,h.translateZ=c.translateZ||0),h.zoom=c.zoom||1,h.scaleX=o(c.scaleX,c.scale,1),h.scaleY=o(c.scaleY,c.scale,1),h.scaleZ=o(c.scaleZ,c.scale,1),c.scaleX||c.scaleY||c.scaleZ||c.scale,s.notUnset(c.rotateMatrix)?h.rotateMatrix=c.rotateMatrix:s.notUnset(c.rotateAngle)&&s.notUnset(c.rotateAxisVector)?h.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:c.rotateAngle,rotateAxisVector:c.rotateAxisVector}):(h.rotateX||h.rotateY||h.rotateZ)&&(h.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:c.rotateX||0,rotateY:c.rotateY||0,rotateZ:c.rotateZ||0})),g.isUnset(c.center)&&(h.center=p),h.drawBaseCoord=u||Kekule.CoordUtils.transform3D(p,h);var f=Object.extend({},h);(h=this.getFinalTransformParams(l,h)).initialTransformOptions=f;var m=this.canDoPureCameraTransform(l,h);if(h.pureCameraTransform=m,this.isRootRenderer()&&(c.autofit||!c.cameraPos)){var C,_=this.getAutofitObjBoxInflation(l,this.getChemObj(),c),y=Kekule.BoxUtils.inflateBox(d,_.x,_.y,_.z),T=Math.max(Math.abs(y.x2-y.x1),Math.abs(y.y2-y.y1)),E=this.getCameraProps(l);C=Kekule.globalOptions.render.render3D.autofitOnPrimaryDirection?E.fov:E.fovMin||E.fov;var b=T/2/Math.tan(C/2),v=Math.sqrt(Math.sqr(b)-Math.sqr(T/2));if(m){v/=h.scaleX,h.cameraWidth=T/h.scaleX,h.cameraHeight=h.cameraWidth;var I,R,N,L,U=Kekule.MatrixUtils.create(4,1,[0,0,1,1]),W=Kekule.MatrixUtils.create(4,1,[0,1,1,1]);if(h.rotateMatrix){var M=Kekule.MatrixUtils.transpose(h.rotateMatrix);I=Kekule.MatrixUtils.multiply(M,U),N=Kekule.MatrixUtils.multiply(M,W),R={x:I[0],y:I[1],z:I[2]},L={x:N[0],y:N[1],z:N[2]}}else R={x:0,y:0,z:1},L={x:0,y:1,z:1};R=Kekule.CoordUtils.multiply(R,v),h.cameraPos={x:R.x,y:R.y,z:R.z},h.cameraPos=Kekule.CoordUtils.add(h.cameraPos,h.drawBaseCoord),h.cameraUp=L,h.scaleX=h.scaleY=h.scaleZ=1;var B=this.getInitialLightPositions(l);if(M){var V=this.getLightCount(l);if(B&&B.length&&V)for(var J=Math.min(B.length,V),$=[],q=0;q<J;++q){var Q=B[q];if(Q){var ie=Kekule.MatrixUtils.create(4,1,[Q.x,Q.y,Q.z,1]),Y=Kekule.MatrixUtils.multiply(M,ie),ne={x:Y[0],y:Y[1],z:Y[2]};$.push(ne)}}}h.lightPositions=$||B,h.rotateMatrix=null}else h.cameraPos={x:h.drawBaseCoord.x,y:h.drawBaseCoord.y,z:v+h.drawBaseCoord.z},h.cameraUp={x:0,y:1,z:1};h.cameraLookAtVector=h.drawBaseCoord||{x:0,y:0,z:0};var de={x:-h.translateX,y:-h.translateY,z:-h.translateZ};h.translateX=h.translateY=h.translateZ=0,h.cameraPos=Kekule.CoordUtils.add(h.cameraPos,de),h.cameraLookAtVector=Kekule.CoordUtils.add(h.cameraLookAtVector,de)}return h},getFinalTransformParams:function(l,u){var c=Object.create(u);return c.zoom&&(c.scaleX*=c.zoom,c.scaleY*=c.zoom,c.scaleZ*=c.zoom),c.unitLength!==1&&(c.translateX*=c.unitLength,c.translateY*=c.unitLength,c.translateZ*=c.unitLength,c.drawBaseCoord&&(c.drawBaseCoord=Kekule.CoordUtils.multiply(c.drawBaseCoord,c.unitLength))),c},getRenderFinalTransformParams:function(l){return this.getRenderCache(l).transformParams},getRenderInitialTransformOptions:function(l){var u=this.getRenderFinalTransformParams(l);return u?u.initialTransformOptions:null},getAutofitObjBoxInflation:function(l,u,c){var d=c.fixedNodeRadius||0;return{x:d,y:d,z:d}},adjustCamera:function(l,u){var c=u.cameraWidth,d=u.cameraHeight,h={position:u.cameraPos,upVector:u.cameraUp,lookAtVector:u.cameraLookAtVector};if(c&&d){var p=c/2,g=d/2;h.left=-p,h.right=p,h.top=g,h.bottom=-g}this.setCameraProps(l,h),this.adjustLights(l,u)},adjustLights:function(l,u){for(var c=u.lightPositions||[],d=0,h=c.length;d<h;++d){var p=c[d];p&&this.setLightProps(l,d,{position:p})}}}),Kekule.Render.ChemCtab3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab3DRenderer",TRANSFORM_COORD_FIELD:"__$transCoord3D__",DRAW_ELEM_FIELD:"__$drawElem__",DRAW_COLOR_FIELD:"__$drawColor__",BASE_RADIUS_FIELD:"__$baseRadius__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",HIDDEN_NODES_FIELD:"__$hiddenNodes__",HIDDEN_CONNECTORS_FIELD:"__$hiddenConnectors__",getObjDrawElem:function(l,u){return this.getExtraProp2(l,u,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(l,u,c){this.setExtraProp2(l,u,this.DRAW_ELEM_FIELD,c)},getObjDrawColor:function(l,u){return this.getExtraProp2(l,u,this.DRAW_COLOR_FIELD)},setObjDrawColor:function(l,u,c){this.setExtraProp2(l,u,this.DRAW_COLOR_FIELD,c)},getNodeBaseRadius:function(l,u){return this.getExtraProp2(l,u,this.BASE_RADIUS_FIELD)},setNodeBaseRadius:function(l,u,c){this.setExtraProp2(l,u,this.BASE_RADIUS_FIELD,c)},getHiddenNodes:function(l){return this.getExtraProp(l,this.HIDDEN_NODES_FIELD)||[]},setHiddenNodes:function(l,u){return this.setExtraProp(l,this.HIDDEN_NODES_FIELD,u)},getHiddenConnectors:function(l){return this.getExtraProp(l,this.HIDDEN_CONNECTORS_FIELD)||[]},setHiddenConnectors:function(l,u){return this.setExtraProp(l,this.HIDDEN_CONNECTORS_FIELD,u)},doEstimateSelfObjBox:function(l,u,c){return this.getChemObj().getExposedContainerBox3D(c)},doPrepare:function(l,u,c,d){var h,p,g=d,f=this.getRenderCache(l);switch(g.moleculeDisplayType){case t.WIRE:h=a.NONE,p=g.displayMultipleBond?n.MULTI_WIRE:n.WIRE;break;case t.STICKS:h=a.NONE,p=g.displayMultipleBond?n.MULTI_CYLINDER:n.CYLINDER;break;case t.SPACE_FILL:h=a.SPACE,p=n.NONE;break;case t.BALL_STICK:default:h=a.BALL,p=g.displayMultipleBond?n.MULTI_CYLINDER:n.CYLINDER}f.nodeRenderMode=h,f.connectorRenderMode=p,f.options=g;var m=u.getExposedNodes(),C=u.getExposedConnectors();return this.prepareHiddenObjects(l,m,C,g),this.prepareNodesDrawColor(l,m,g),this.prepareNodeBaseRadii(l,m,g),g},prepareHiddenObjects:function(l,u,c,d){var h=[];this.setHiddenNodes(l,h);for(var p=0,g=u.length;p<g;++p){var f=u[p];d.hideHydrogens&&f instanceof Kekule.Atom&&f.getAtomicNumber()===1&&h.push(f)}var m=[];for(this.setHiddenConnectors(l,m),p=0,g=c.length;p<g;++p){var C=c[p],_=C.getConnectedExposedObjs();Kekule.ArrayUtils.exclude(_,h)<2&&m.push(C)}},prepareNodesDrawColor:function(l,u,c){for(var d=c.useAtomSpecifiedColor,h=0,p=u.length;h<p;++h){var g=u[h],f=g.getOverriddenRender3DOptions()||{},m=f.color||f.atomColor;if(!(m&&!f.useAtomSpecifiedColor))if(d||f.useAtomSpecifiedColor){var C=g.getAtomicNumber?g.getAtomicNumber():0;m=C>=0?Kekule.Render.RenderColorUtils.getColor(C,this.getRendererType()):Kekule.Render.RenderColorUtils.getColor(g.getClassLocalName(),this.getRendererType())}else m=o(f.color||c.atomColor);this.setObjDrawColor(l,g,m)}},prepareNodeBaseRadii:function(l,u,c){for(var d=0,h=u.length;d<h;++d){var p,g=u[d];p=this.calcNodeBaseRadius(g,c),this.setNodeBaseRadius(l,g,p)}},calcNodeBaseRadius:function(l,u){var c,d=l.getOverriddenRender3DOptions()||{},h=l.getAtomicNumber?l.getAtomicNumber():null;return d.nodeRadius||u.nodeRadius?c=d.nodeRadius||u.nodeRadius:o(d.useVdWRadius,u.useVdWRadius)&&h?c=Kekule.ChemicalElementsDataUtil.getElementProp(h,"radiiVdw")||d.fixedNodeRadius||u.fixedNodeRadius:c=o(d.fixedNodeRadius,u.fixedNodeRadius),c},doDrawSelf:function(l,u,c){this.tryApplySuper("doDrawSelf",[l,u,c]);var d=this.getChemObj(),h=c.transformParams;this.getRenderCache(l).transformOptions=h,this.transformCtabCoords3DToContext(l,d,h);var p=this.doPrepare(l,d,u,c);return this.doDrawCore(l,d,p,h)},doRedraw:function(l){var u=this.getRenderCache(l);return this.doDrawCore(l,this.getChemObj(),u.options,u.transformOptions)},doDrawCore:function(l,u,c,d){var h=this.createDrawGroup(l);return this.doDrawConnectors(l,h,u,c,d),this.doDrawNodes(l,h,u,c,d),this.setObjDrawElem(l,u,h),h},transformCtabCoords3DToContext:function(l,u,c){var d=c.allowCoordBorrow;c.scaleX=c.scaleX||c.scale,c.scaleY=c.scaleY||c.scale,c.scaleZ=c.scaleZ||c.scale;var h=Object.extend({},c);h.centerX=0,h.centerY=0;var p=c.transformMatrix;this.setExtraProp2(l,u,this.TRANSFORM_MATRIX_FIELD,p);var g=p;this.setExtraProp2(l,u,this.CHILD_TRANSFORM_MATRIX_FIELD,p);var f=c.invTransformMatrix;this.setExtraProp2(l,u,this.INV_TRANSFORM_MATRIX_FIELD,f);for(var m=0,C=u.getNodeCount();m<C;++m){var _=u.getNodeAt(m);this.transformObjCoord3DToContext(l,_,p,g,d)}},transformObjCoord3DToContext:function(l,u,c,d,h){var p,g;if(u&&u.getAbsBaseCoord3D){if(g=u.getAbsBaseCoord3D(h)){var f=Kekule.CoordUtils.transform3DByMatrix(g,c);this.setTransformedCoord3D(l,u,f),p=f}if(u.getNodes)for(var m=0,C=u.getNodeCount();m<C;++m)this.transformObjCoord3DToContext(l,u.getNodeAt(m),d,d,h)}return p},getTransformedCoord3D:function(l,u,c){Kekule.ObjUtils.isUnset(c)&&(c=this.getRenderCache(l).options.transformParams.allowCoordBorrow);var d=u instanceof Kekule.BaseStructureNode&&this.getExtraProp2(l,u,this.TRANSFORM_COORD_FIELD);if(!d){var h=this.getChemObj(),p=this.getExtraProp2(l,h,this.TRANSFORM_MATRIX_FIELD),g=this.getExtraProp2(l,h,this.CHILD_TRANSFORM_MATRIX_FIELD);d=h&&(h.hasNode(u,!1)||h.hasConnector(u,!1))?this.transformObjCoord3DToContext(u,p,g,c):this.transformObjCoord3DToContext(u,g,g,c)}return d},setTransformedCoord3D:function(l,u,c){this.setExtraProp2(l,u,this.TRANSFORM_COORD_FIELD,c)},doTransformCoordToObj:function(l,u,c){var d=this.getExtraProp2(l,u,this.INV_TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(c,d)},doTransformCoordToContext:function(l,u,c){var d=this.getExtraProp2(l,u,this.TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(c,d)},doDrawNodes:function(l,u,c,d,h){for(var p=c.getExposedNodes(),g=this.getHiddenNodes(l),f=0,m=p.length;f<m;++f){var C=p[f];g.indexOf(C)>=0||this.doDrawNode(l,u,C,c,d,h)}},doDrawNode:function(l,u,c,d,h,p){var g,f,m,C=this.getRenderCache(l).nodeRenderMode;if(C===a.NONE)return null;f=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(c,h),m=this.getNodeBaseRadius(l,c),Kekule.ObjUtils.isUnset(m)&&(m=this.calcNodeBaseRadius(c,h)),C===a.SPACE?m*=p.scaleX:m*=f.nodeRadiusRatio*p.scaleX;var _=this.getObjDrawColor(l,c),y=this.getTransformedCoord3D(l,c,p.allowCoordBorrow);g=this.drawSphere(l,y,m,{color:_,opacity:f.opacity});var T=this.createSphereBoundInfo(y,m);this.basicDrawObjectUpdated(l,c,d,T,Kekule.Render.ObjectUpdateType.ADD),g&&(this.setObjDrawElem(l,c,g),u&&this.addToDrawGroup(g,u))},doDrawConnectors:function(l,u,c,d,h){if(this.getRenderCache(l).connectorRenderMode===n.NONE)return null;for(var p=c.getExposedConnectors(),g=this.getHiddenConnectors(l),f=0,m=p.length;f<m;++f){var C=p[f];g.indexOf(C)>=0||this.doDrawConnector(l,u,C,c,d,h)}},doDrawConnector:function(l,u,c,d,h,p){var g=Object.create(h);g=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(c,h);for(var f,m,C,_,y,T=this.getHiddenNodes(l),E=c.getConnectedExposedObjs(),b=(E=Kekule.ArrayUtils.exclude(E,T)).length,v=b>2?this.createDrawGroup(l):null,I=0;I<b;++I)if(f=E[I],C=this.getTransformedCoord3D(l,f,p.allowCoordBorrow))for(var R=I+1;R<b;++R)m=E[R],(_=this.getTransformedCoord3D(l,m,p.allowCoordBorrow))&&(y=this.doDrawConnectorShape(l,c,[f,m],d,C,_,g,p))&&v&&this.addToDrawGroup(y,v);return v?this.addToDrawGroup(v,u):this.addToDrawGroup(y,u),v||y},doDrawConnectorShape:function(l,u,c,d,h,p,g,f){var m=Kekule.CoordUtils,C=u.getOverriddenRender3DOptions()||{},_=(g.unitLength,c[0]),y=c[1],T=o(C.bondSpliceMode,g.bondSpliceMode),E=T===r.MID_SPLIT?.5:null;if(T===r.WEIGHTING_SPLIT){var b=this.getNodeBaseRadius(l,_),v=this.getNodeBaseRadius(l,y);E=b&&v?b/(b+v):.5}var I=null,R=!1,N=[];if(E){var L=o(g.color||g.bondColor),U=o(C.color||C.bondColor);if(R=!1,U)N.push(U);else{var W=o(this.getObjDrawColor(l,_),L),M=o(this.getObjDrawColor(l,y),L);W!==M?(N.push(W),N.push(M),R=!0):N.push(o(W,g.color,g.bondColor,g.defBondColor))}}else N.push(o(C.color,C.bondColor,g.color,g.bondColor,g.defBondColor));if(E&&R){var B=p.x-h.x,V=p.y-h.y,J=p.z-h.z;(I={}).x=h.x+B*E,I.y=h.y+V*E,I.z=h.z+J*E}var $=R?[[h,I],[I,p]]:[[h,p]],q=this.getRenderCache(l).connectorRenderMode,Q=this._getBondRenderType(u,q),ie=!1,Y=o(C.connectorRadius,g.connectorRadius)*o(C.connectorRadiusRatio,g.connectorRadiusRatio)*g.unitLength;Y*=f.scaleX;var ne=o(C.connectorLineWidth,g.connectorLineWidth)*g.unitLength;Q!==i.SINGLE&&Q!==i.DASH?(Y*=o(C.multiConnectorRadiusRatio,g.multiConnectorRadiusRatio),ie=q===n.MULTI_CYLINDER):ie=!1;var de,Ae=[],Ce=1;switch(Q){case i.SINGLE:Ce=1;break;case i.DOUBLE:Ce=2;break;case i.TRIPLE:Ce=3;break;case i.DASH:case i.SOLID_DASH:}var pe=null;if((de=Ce)>1){var fe=o(C.multiConnectorMarginRatio,g.multiConnectorMarginRatio)*Y;ie&&(fe+=2*Y);var Te=m.getDistance(h,p),xe=m.substract(p,h),Re={x:-fe*(xe.y/Te),y:fe*(xe.x/Te),z:0};pe=(de%2?0:.5)-Math.floor(de/2);var we=m.multiply(Re,pe)}for(var Me=0,Le=$.length;Me<Le;++Me)if(de===1)(Fe={}).coord1=$[Me][0],Fe.coord2=$[Me][1],R&&(Fe.jointCoordIndex=Me===0?2:1),Fe.color=N[Me],Fe.radius=Y,Fe.lineWidth=ne,Fe.opacity=g.opacity,Ae.push(Fe);else for(var Ue=m.add($[Me][0],we),at=m.add($[Me][1],we),Bt=0;Bt<de;++Bt){var Fe;(Fe={}).coord1=Ue,Fe.coord2=at,Ue=m.add(Ue,Re),at=m.add(at,Re),R&&(Fe.jointCoordIndex=Me===0?2:1),Fe.color=N[Me],Fe.radius=Y,Fe.lineWidth=ne,Fe.opacity=g.opacity,Ae.push(Fe)}var Nt,Xe=q;return Nt=Xe===n.WIRE||Xe===n.MULTI_WIRE?this.createLineBoundInfo(h,p,{width:ne}):this.createCylinderBoundInfo(h,p,{radius:Y}),this.basicDrawObjectUpdated(l,u,d,Nt,Kekule.Render.ObjectUpdateType.ADD),this.doDrawConnectorSet(l,Ae,Xe,Q,g)},doDrawConnectorSet:function(l,u,c,d,h){if(c===n.WIRE||c===n.MULTI_WIRE)return this.drawParallelLines(l,u);var p=this.getRenderCache(l).nodeRenderMode===a.NONE;return this.drawParallelCylinders(l,u,p)},_getBondRenderType:function(l,u){var c=l.getOverriddenRender3DOptions()||{},d=Kekule.Render.Render3DOptionUtils.getConnectorRenderType(c);return d||Kekule.Render.ConnectorDrawUtils.getConnectorRender3DType(l,u)}}),Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.ChemCtab3DRenderer),Kekule.Render.StructFragment3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment3DRenderer",initialize:function(l,u,c){this.tryApplySuper("initialize",[l,u,c]),this._concreteRenderer=null,l.hasCtab()?this._concreteRenderer=new Kekule.Render.ChemCtab3DRenderer(l.getCtab(),u,this):(this._concreteRenderer=null,Kekule.raise(Kekule.$L("ErrorMsg.FORMULA_RENDERER_3D_NOT_AVAILABLE"))),this._concreteRenderer.setParentRenderer(this)},finalize:function(){this.tryApplySuper("finalize"),this._concreteRenderer&&this._concreteRenderer.finalize()},getRenderCache:function(l){return this._concreteRenderer.getRenderCache(l)},_getConcreteRendererDrawOptions:function(l){var u=Object.create(l||{}),c=this.getChemObj(),d=this.getRendererType()===Kekule.Render.RendererType.R3D?c.getOverriddenRender3DOptions():c.getOverriddenRenderOptions();return u=Object.extend(u,d||{})},isChemObjRenderedBySelf:function(l,u){return this.tryApplySuper("isChemObjRenderedBySelf",[l,u])||u===this.getChemObj()||this._concreteRenderer.isChemObjRenderedBySelf(l,u)},isChemObjRenderedDirectlyBySelf:function(l,u){return this.tryApplySuper("isChemObjRenderedDirectlyBySelf",[l,u])||u===this.getChemObj()},doSetRedirectContext:function(l){this.tryApplySuper("doSetRedirectContext",[l]),this._concreteRenderer.setRedirectContext(l)},doDrawSelf:function(l,u,c){return this.tryApplySuper("doDrawSelf",[l,u,c]),this._concreteRenderer.draw(l,u,this._getConcreteRendererDrawOptions(c))},doRedraw:function(l){return this._concreteRenderer.redraw(l)},doUpdateSelf:function(l,u,c){if(this._extractObjsOfUpdateObjDetails(u).indexOf(this.getChemObj())>=0){var d=this.getRenderCache(l);return this.doClear(l),this.draw(l,d.baseCoord,d.options)}return this._concreteRenderer.doUpdate(l,u,c)},doClearSelf:function(l){var u=this._concreteRenderer;if(u)return u.clear(l)},estimateRenderBox:function(l,u,c){return this._concreteRenderer.estimateRenderBox(l,this._getConcreteRendererDrawOptions(u),c)},getChildObjs:function(){var l=this.getChemObj();if(l&&l.getAttachedMarkers){for(var u=[],c=(l.getExposedNodes()||[]).concat(l.getExposedConnectors()||[]),d=0,h=c.length;d<h;++d){var p=c[d];u=u.concat(p.getAttachedMarkers()||[])}return u.concat(this.tryApplySuper("getChildObjs"))}return this.tryApplySuper("getChildObjs")},_needWholelyDraw:function(l,u){var c=this.tryApplySuper("_needWholelyDraw",[l,u]);if(!c){for(var d=this.getChemObj(),h=!1,p=0,g=l.length;p<g;++p)if(l[p].isChildOf(d)){h=!0;break}c=h}return c},transformCoordToObj:function(l,u,c){var d=this.getChemObj()===u?this._concreteChemObj:u;return this._concreteRenderer.transformCoordToObj(l,d,c)},transformCoordToContext:function(l,u,c){var d=this.getChemObj()===u?this._concreteChemObj:u;return this._concreteRenderer.transformCoordToContext(l,d,c)}}),Kekule.Render.Mol3DRenderer=Kekule.Render.StructFragment3DRenderer,Kekule.Render.CompositeObj3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj3DRenderer"}),Kekule.Render.CompositeMolecule3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule3DRenderer",getChildObjs:function(){for(var l=[],u=this.getChemObj().getSubMolecules(),c=0,d=u.getItemCount();c<d;++c){var h=u.getObjAt(c);l.push(h)}return l.concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemObjGroupList3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObjGroupList3DRenderer",getChildObjs:function(){var l=this.getChemObj();if(l instanceof Kekule.ChemObjList)for(var u=[],c=0,d=l.getItemCount();c<d;++c)u.push(l.getItemAt(c));else l instanceof Kekule.ChemStructureObjectGroup&&(u=l.getAllObjs());return(u||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemSpaceElement3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement3DRenderer",getChildObjs:function(){return(this.getChemObj().getChildren().toArray()||[]).concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.ChemSpace3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace3DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()].concat(this.tryApplySuper("getChildObjs"))}}),Kekule.Render.Renderer3DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement3DRenderer),Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace3DRenderer)}(),function(){var s;Kekule.Render.ThreeObjectCache=Class.create({CLASS_NAME:"Kekule.Render.ThreeObjectCache",initialize:function(){this.cache=new Kekule.MapEx(!0)},finalize:function(){this.cache.finalize(),this.cache=null},createInstance:function(t,n){return null},isSameParams:function(t,n){if(t.length!==n.length)return!1;for(var i=0,r=t.length;i<r;++i)if(!this.isParamEqual(t[i],n[i]))return!1;return!0},isParamEqual:function(t,n){var i=t===n;return i||DataType.isObjectValue(t)&&DataType.isObjectValue(n)&&(i=Kekule.ObjUtils.equal(t,n)),i},add:function(){var t=Array.prototype.slice.call(arguments),n=t.shift(),i=this.cache.get(n);i||(i=[],this.cache.set(n,i));var r={params:t};return r.instance=this.createInstance(n,t),i.push(r),r.instance},get:function(){var t=Array.prototype.slice.call(arguments),n=t[0],i=this.cache.get(n);if(i){t.shift();for(var r=0,a=i.length;r<a;++r){var o=i[r].params;if(this.isSameParams(o,t))return i[r].instance}t.unshift(n)}return this.add.apply(this,t)}}),Kekule.Render.ThreeGeometryCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeGeometryCache",createInstance:function(t,n){var i=null,r=n;switch(r[0],t){case s.SphereGeometry:i=new s.SphereGeometry(r[1],r[2],r[3]);break;case s.CylinderGeometry:i=new s.CylinderGeometry(r[1],r[2],r[3],r[4],r[5],r[6])}return i}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeGeometryCache),Kekule.Render.ThreeMaterialCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeMaterialCache",createInstance:function(t,n){return new t(n[1])}}),Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeMaterialCache),Kekule.Render.ThreeContext=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ThreeContext",initialize:function(t,n,i,r){this.tryApplySuper("initialize"),this.setScene(t),this.setCamera(n),this.setLights(i),this.setRenderer(r)},initProperties:function(){this.defineProp("scene",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("camera",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("lights",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("renderer",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("width",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("height",{dataType:DataType.INT,serializable:!1,setter:null})},getDimension:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimension:function(t,n){this.setPropStoreFieldValue("width",t),this.setPropStoreFieldValue("height",n),this.getRenderer().setSize(t,n);var i=this.getCamera();i instanceof s.OrthographicCamera?(i.left=t/-2,i.right=t/2,i.top=n/2,i.bottom=n/-2):i.aspect=t/n,i.updateProjectionMatrix()}}),Kekule.Render.ThreeRendererBridge=Class.create(Kekule.Render.Abstract3DDrawBridge,{CLASS_NAME:"Kekule.Render.ThreeRendererBridge",_qualitySettings:[null,{sphereSegments:6,sphereRings:6,cylinderSegmentsRadius:6},{sphereSegments:8,sphereRings:8,cylinderSegmentsRadius:8},{sphereSegments:16,sphereRings:16,cylinderSegmentsRadius:16},{sphereSegments:32,sphereRings:32,cylinderSegmentsRadius:32},{sphereSegments:64,sphereRings:64,cylinderSegmentsRadius:64}],initialize:function(){this.geometryCache=Kekule.Render.ThreeGeometryCache.getInstance(),this.materialCache=Kekule.Render.ThreeMaterialCache.getInstance(),this._quality=null,this._modelParams={},this._webglEnabled=!0},finalize:function(){this.geometryCache=null,this.materialCache=null},getGraphicQualityLevel:function(){return this._quality},setGraphicQualityLevel:function(t){this._webglEnabled?this._quality=t:this._quality=Kekule.Render.Render3DGraphicQuality.EXTREME_LOW,this._modelParams=this.calcModelParams(this._quality)},_updateGraphicQualityLevel:function(){this._webglEnabled||this.setGraphicQualityLevel(Kekule.Render.Render3DGraphicQuality.EXTREME_LOW)},calcModelParams:function(t){var n=this._qualitySettings[t];return n||(n=this._qualitySettings[Kekule.Render.Render3DGraphicQuality.MEDIUM]),n},getInitialLightPositions:function(t){return[{x:5,y:5,z:10}]},createContext:function(t,n,i,r){var a=Kekule.BrowserFeature,o={preserveDrawingBuffer:!0,alpha:!0,antialias:!0};r&&(o=Object.extend(o,r));var l=a.webgl?new s.WebGLRenderer(o):a.canvas?new s.CanvasRenderer(o):new s.SVGRenderer(o),u=new s.PerspectiveCamera;u.fov=5,this._webglEnabled=l instanceof s.WebGLRenderer,this._updateGraphicQualityLevel();var c=new s.Scene;c.add(u),l.setSize(n,i);for(var d=this.getInitialLightPositions(),h=[],p=0,g=d.length;p<g;++p){var f=new s.DirectionalLight(13421772,1,10,!0),m=d[p];f.position.set(m.x,m.y,m.z),c.add(f),h.push(f)}f=new s.AmbientLight(2105376),c.add(f),t.appendChild(l.domElement);var C=new Kekule.Render.ThreeContext(c,u,h,l);return C.setDimension(n,i),C},releaseContext:function(t){var n=this.getContextElem(t);t.finalize(),n&&n.parentNode.removeChild(n)},getContextElem:function(t){return t?t.getRenderer().domElement:null},getContextDimension:function(t){return{width:t.getWidth(),height:t.getHeight()}},setContextDimension:function(t,n,i){t.setDimension(n,i)},transformContextCoordToScreen:function(t,n){var i=t.getDimension();return{x:n.x+i.width/2,y:n.y+i.height/2}},transformScreenCoordToContext:function(t,n){var i=t.getDimension();return{x:n.x-i.width/2,y:n.y-i.height/2,z:0}},canModifyGraphic:function(t){return!0},colorStrToHex:function(t){return Kekule.StyleUtils.colorStrToValue(t)},createGroup:function(t){var n=new s.Object3D;return n.__objGroup__=!0,t.getScene().add(n),n},addToGroup:function(t,n){return n.add(t),n},removeFromGroup:function(t,n){n.remove(t)},setClearColor:function(t,n){var i=t.getRenderer();i&&(i.setClearColor?n?t.getRenderer().setClearColor(new s.Color(n),1):t.getRenderer().setClearColor(new s.Color,0):i.setClearColorHex&&(n?t.getRenderer().setClearColorHex(this.colorStrToHex(n),1):t.getRenderer().setClearColorHex(null,0)))},clearContext:function(t){t.getScene().clearMesh(),this.renderContext(t)},renderContext:function(t){t.getRenderer().render(t.getScene(),t.getCamera())},drawSphere:function(t,n,i,r){var a=this._modelParams.sphereSegments,o=this._modelParams.sphereRings,l=this.geometryCache.get(s.SphereGeometry,t.getScene(),1,a,o),u=this.materialCache.get(s.MeshLambertMaterial,t.getScene(),{color:this.colorStrToHex(r.color),opacity:r.opacity||1}),c=new s.Mesh(l,u);return c.scale.x=i,c.scale.y=i,c.scale.z=i,c.position.x=n.x,c.position.y=n.y,c.position.z=n.z,t.getScene().add(c),c},drawLine:function(t,n,i,r){this.colorStrToHex(r.color);var a=this.materialCache.get(s.LineBasicMaterial,t.getScene(),{color:this.colorStrToHex(r.color),opacity:r.opacity||1,linewidth:r.lineWidth||1}),o=new s.Geometry;o.vertices.push(new s.Vector3(n.x,n.y,n.z)),o.vertices.push(new s.Vector3(i.x,i.y,i.z));var l=new s.Line(o,a);return t.getScene().add(l),l},drawCylinder:function(t,n,i,r,a){var o=Kekule.CoordUtils,l=this._modelParams.cylinderSegmentsRadius,u=o.getDistance(n,i),c=this.geometryCache.get(s.CylinderGeometry,t.getScene(),1,1,1,l,1,!0),d=this.materialCache.get(s.MeshLambertMaterial,t.getScene(),{color:this.colorStrToHex(a.color),opacity:a.opacity||1}),h=new s.Mesh(c,d);h.scale.y=u,h.scale.x=r,h.scale.z=r;var p=Kekule.ObjUtils.isUnset(a.quaternion)?this._calcQuaternion(n,i):a.quaternion;return p&&(h.applyQuaternion?h.applyQuaternion(p):(h.useQuaternion=!0,h.quaternion=p,h.updateMatrix())),h.position.x=(n.x+i.x)/2,h.position.y=(n.y+i.y)/2,h.position.z=(n.z+i.z)/2,t.getScene().add(h),h},drawParallelCylinders:function(t,n,i){Kekule.CoordUtils;for(var r=n[0],a=this._calcQuaternion(r.coord1,r.coord2),o=this.createGroup(t),l=0,u=n.length;l<u;++l){var c=n[l],d=this.drawCylinder(t,c.coord1,c.coord2,c.radius,{color:c.color,quaternion:a,opacity:c.opacity});this.addToGroup(d,o)}if(i){var h;for(l=0,u=n.length;l<u;++l){c=n[l];for(var p=0,g=(h=Kekule.ObjUtils.isUnset(c.jointCoordIndex)?[c.coord1,c.coord2]:c.jointCoordIndex===1?[c.coord2]:[c.coord1]).length;p<g;++p)d=this.drawSphere(t,h[p],c.radius,{color:c.color,opacity:c.opacity}),this.addToGroup(d,o)}}return o},removeDrawnElem:function(t,n){n.parent&&n.parent.remove&&n.parent.remove(n)},_calcQuaternion:function(t,n){var i=Kekule.CoordUtils,r=i.substract(n,t);if(r.x||r.z){var a={x:r.z,y:0,z:-r.x};a=i.standardize(a);var o=Math.atan2(Math.sqrt(Math.sqr(r.x)+Math.sqr(r.z)),r.y)/2,l=Math.cos(o),u=Math.sin(o);return new s.Quaternion(u*a.x,u*a.y,u*a.z,l)}return null},getLightCount:function(t){var n=t.getLights();return n&&n.length||0},getLightProps:function(t,n){return{position:t.getLights()[n].position}},setLightProps:function(t,n,i){var r=t.getLights()[n],a=i.position;a&&(r.position.x=a.x,r.position.y=a.y,r.position.z=a.z),r.updateMatrix()},getCameraProps:function(t){var n=t.getCamera(),i=n.fov*Math.PI/180,r=i*(n.aspect||1),a=Math.min(i,r);return{position:n.position,fov:i,aspect:n.aspect,fovVertical:i,fovHorizontal:r,fovMin:a,left:n.left,right:n.right,top:n.top,bottom:n.bottom,lookAtVector:n.lookAtVector,upVector:n.up}},setCameraProps:function(t,n){var i=t.getCamera(),r=Kekule.ObjUtils.notUnset,a=n.position;if(a&&(i.position.x=a.x,i.position.y=a.y,i.position.z=a.z),r(n.near)&&(i.near=n.near),r(n.far)&&(i.far=n.far),n.fov&&(i.fov=180*n.fov/Math.PI),n.aspect&&(i.aspect=n.aspect),r(n.left)&&(i.left=n.left),r(n.top)&&(i.top=n.top),r(n.bottom)&&(i.bottom=n.bottom),r(n.right)&&(i.right=n.right),r(n.upVector)){var o=n.upVector;i.up=new s.Vector3(o.x,o.y,o.z)}r(n.lookAtVector)&&(o=n.lookAtVector,i.lookAt(new s.Vector3(o.x,o.y,o.z))),i.updateMatrix()},exportToDataUri:function(t,n,i){var r=t.getRenderer();if(s.SVGRenderer&&r instanceof s.SVGRenderer){var a=t.getRenderer().domElement,o=DataType.XmlUtility.serializeNode(a);return"data:image/svg+xml;base64,"+btoa(o)}return(a=t.getRenderer().domElement)?a.toDataURL(n,i):null}}),Kekule.Render.ThreeRendererBridge.isSupported=function(){var t=Kekule.Render.getExternalModule("three.js")!==void 0;if(t){var n=Kekule.BrowserFeature;t=n.webgl||n.canvas||n.svg}return!!t},Kekule.Render.ThreeRendererBridge.getAvailabilityInformation=function(){var t=!1,n=Kekule.Render.getExternalModule("three.js")!==void 0,i=Kekule.BrowserFeature,r=i.webgl,a=i.canvas||i.svg,o=null;return n?r||a?t=!0:o=Kekule.$L("ErrorMsg.THREEJS_DRAWING_NOT_UNAVAILABLE"):o=Kekule.$L("ErrorMsg.THREEJS_LIB_NOT_UNAVAILABLE"),{available:t,message:o}},Kekule.Render.DrawBridge3DMananger.register(Kekule.Render.ThreeRendererBridge,20);var e=function(){var t;e.registered||Kekule.$jsRoot.THREE&&Kekule.$jsRoot.THREE.Object3D&&(t=Kekule.$jsRoot.THREE,Kekule.Render.registerExternalModule("three.js",t),e.registered=!0)};Kekule.externalResourceManager.on("three.jsRegistered",function(){(s=Kekule.externalResourceManager.getResource("three.js"))&&(s.Object3D.prototype.clear||(s.Object3D.prototype.clear=function(){for(var t=this.children,n=t.length-1;n>=0;n--){var i=t[n];i.clear(),this.remove(i)}}),s.Scene.prototype.clearMesh||(s.Scene.prototype.clearMesh=function(){for(var t=this.children,n=t.length-1;n>=0;n--){var i=t[n];(i instanceof s.Mesh||i instanceof s.Line||i.__objGroup__)&&(i.clear(),this.remove(i))}}),Kekule.Render.DrawBridge3DMananger.register(Kekule.Render.ThreeRendererBridge,20))}),Kekule.externalResourceManager.on("three.jsUnregistered",function(){}),e(),Kekule.X.domReady(e)}(),Kekule.Render.ChemObjPainter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ChemObjPainter",initialize:function(s,e,t,n){this.tryApplySuper("initialize");var i=s||Kekule.Render.RendererType.R2D;this.setPropStoreFieldValue("renderType",i),this.setPropStoreFieldValue("chemObj",e),this.setPropStoreFieldValue("drawBridge",t||(i===Kekule.Render.RendererType.R3D?Kekule.Render.DrawBridge3DMananger.getPreferredBridgeInstance():Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance())),n&&this.setPropStoreFieldValue("renderConfigs",n)},finalize:function(){this.getRenderer()&&this.getRenderer().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var s=this.getPropStoreFieldValue("renderConfigs");return s||(s=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()),s}}),this.defineProp("renderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null}),this.defineProp("canModifyTargetObj",{dataType:DataType.BOOL}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,setter:null,getter:function(){var s=this.getRenderer();return s&&s.getBoundInfoRecorder()}})},getDrawOptionFromConfigs:function(s){return Kekule.Render.RenderOptionUtils.convertConfigsToPlainHash(s)},prepareRenderer:function(){if(this.getRenderer())return this.getRenderer();var s=(this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass)(this.getChemObj());if(s){var e=new s(this.getChemObj(),this.getDrawBridge(),this);return this.setPropStoreFieldValue("renderer",e),e}return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ")),null},createContext:function(s,e,t){return this.getDrawBridge().createContext(s,e,t)},_convertContextBoxToScreen:function(s,e){if(!e)return{};var t=this.getDrawBridge(),n=t.transformContextCoordToScreen(s,{x:e.x1,y:e.y1}),i=t.transformContextCoordToScreen(s,{x:e.x2,y:e.y2});return Kekule.BoxUtils.createBox(n,i)},estimateObjBox:function(s,e,t){return this._generateDrawOptions(e),this.prepareRenderer(),this.getRenderer().estimateObjBox(s,e,t)},estimateRenderBox:function(s,e,t,n){var i=this._generateDrawOptions(t);return this.prepareRenderer(),this.getRenderer().estimateRenderBox(s,e,i,n)},estimateScreenBox:function(s,e,t,n){var i=this.estimateRenderBox(s,e,t,n);return i?this._convertContextBoxToScreen(s,i):null},_generateDrawOptions:function(s){var e=this.getRenderConfigs(),t=e?this.getDrawOptionFromConfigs(e):{};return t=Object.extend(t,s)},draw:function(s,e,t){if(!this.getChemObj())return null;this.prepareRenderer();var n=this._generateDrawOptions(t);return this.getRenderer().draw(s,e,n)},redraw:function(s){return this.getRenderer().redraw(s)},getActualRenderTransformParams:function(s){var e=this.getRenderer();return e?e.getRenderFinalTransformParams(s):null},getActualInitialRenderTransformOptions:function(s){var e=this.getRenderer();return e?e.getRenderInitialTransformOptions(s):null},changeGeometryOptions:function(s,e,t){var n=this.getRenderer();if(n&&n.changeGeometryOptions){var i=this._generateDrawOptions(t);return n.changeGeometryOptions(s,e,i)}return this.clearContext(s),this.draw(s,e,t)},supportGeometryOptionChange:function(){var s=this.getRenderer();return s&&s.changeGeometryOptions},beginUpdatePainter:function(){return this.getRenderer().beginUpdateRenderer()},endUpdatePainter:function(){return this.getRenderer().endUpdateRenderer()},update:function(s,e,t){return this.getRenderer().update(s,e,t)},addNew:function(s,e){return this.getRenderer().addNew(s,e)},modify:function(s,e){return this.getRenderer().modify(s,e)},remove:function(s,e){return this.getRenderer().remove(s,e)},clear:function(s){var e=this.getRenderer();return e&&e.clear(s),this},clearContext:function(s){return this.getDrawBridge().clearContext(s)}}),Kekule.Render.ChemObjPainter2D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter2D",initialize:function(s,e,t){this.tryApplySuper("initialize",[Kekule.Render.RendererType.R2D,s,e,t])}}),Kekule.Render.ChemObjPainter3D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter3D",initialize:function(s,e,t){this.tryApplySuper("initialize",[Kekule.Render.RendererType.R3D,s,e,t])}});var Pp={},Np;function Yv(){return Np||(Np=1,function(){var s=Class.PropertyScope,e=Kekule.ArrayUtils,t=Kekule.Unit;Kekule.globalOptions.add("spectrum",{spectrumInfo:{enablePrefixOmissionInGetter:!0},data:{allowedComparisonErrorRate:5e-8}}),Kekule.ComparisonMethod.SPECTRUM_DATA=30,Kekule.Spectroscopy={},Kekule.Spectroscopy.DataMode={CONTINUOUS:1,PEAK:2},Kekule.Spectroscopy.DataPeakPosition={MAX:0,MIN:1},Kekule.Spectroscopy.Utils={getSpectrumPeakPosition:function(a){return(a.getSpectrumType?a.getSpectrumType():a.getParentSpectrum()&&a.getParentSpectrum().getSpectrumType())===Kekule.Spectroscopy.SpectrumType.IR?Kekule.Spectroscopy.DataPeakPosition.MIN:Kekule.Spectroscopy.DataPeakPosition.MAX},expandDataRange:function(a,o){for(var l=e.toArray(o),u=a||{},c=0,d=l.length;c<d;++c)for(var h=l[c],p=Kekule.ObjUtils.getOwnedFieldNames(h),g=0,f=p.length;g<f;++g){var m=p[g],C=h[m];u[m]?C<u[m].min?u[m].min=C:C>u[m].max&&(u[m].max=C):u[m]={min:C,max:C}}return u},mergeDataRange:function(a,o){var l={},u=e.clone(Kekule.ObjUtils.getOwnedFieldNames(a));e.pushUnique(u,Kekule.ObjUtils.getOwnedFieldNames(o));for(var c=0,d=u.length;c<d;++c){var h=u[c];a[h]?o[h]?l[h]={min:a[h].min<o[h].min?a[h].min:o[h].min,max:a[h].max>o[h].max?a[h].max:o[h].max}:l[h]=Object.extend(a[h]):l[h]=Object.extend(o[h])}return l},calcScalePointInfo:function(a,o,l){l<=0&&(l=10);var u,c=[Math.log10(Math.abs(a)),Math.log10(Math.abs(o))],d=Math.floor(Math.max(c[0],c[1])),h=Math.sign(a)===Math.sign(o)?Math.floor(Math.min(c[0],c[1],0)):-1/0,p=d>6,g=o-a,f=g/l,m=Math.max(Math.floor(Math.log10(Math.abs(f))),h),C=Math.pow(10,m);u=u<10&&g>.5?2*Math.ceil(u/C/2)*C:Math.ceil(f/C)*C;for(var _=Math.ceil(a/u)*u,y=Math.floor(o/u)*u,T={useSciForm:p,scaleFrom:_,scaleTo:y,scaleSectionCount:Math.round((y-_)/u),scaleValues:[],scaleBase:C,scaleFromOnBase:_/C,scaleToOnBase:y/C,fixDigitsCountAfterPoint:Math.max(-m,0)},E=0,b=T.scaleSectionCount+1;E<b;++E)T.scaleValues.push(Math.round(E*u/C)*C+_);return T},generateInfoKey:function(a,o,l){var u=o||l;return u?u+n.DELIMITER+a:a},getDefaultDataExtraInfoClass:function(a){return a.getMode()===Kekule.Spectroscopy.DataMode.PEAK?Kekule.Spectroscopy.SpectrumPeakDetails:Kekule.Spectroscopy.SpectrumDataDetails},createDefaultDataExtraInfoObject:function(a){var o=Kekule.Spectroscopy.Utils.getDefaultDataExtraInfoClass(a);return o&&new o}},Kekule.Spectroscopy.MetaPropNamespace={CUSTOM:"custom",DELIMITER:".",_namespaces:[],register:function(a){e.pushUnique(n._namespaces,a)},unregister:function(a){n._namespaces=e.exclude(n._namespaces,a)},getNamespaces:function(){return e.clone(n._namespaces)},createPropertyName:function(a,o){return(a||"")+n.DELIMITER+o},getPropertyNameDetail:function(a){var o,l,u=a.lastIndexOf(n.DELIMITER);return u>=0?(o=a.substring(0,u),l=a.substr(u+1)):l=a,{namespace:o,coreName:l}},getPropertyCoreName:function(a){return n.getPropertyNameDetail(a).coreName}};var n=Kekule.Spectroscopy.MetaPropNamespace;n.register(n.CUSTOM),Kekule.Spectroscopy.DataValueConverterManager={_converters:[],register:function(a){r._converters.push(a)},unregister:function(a){var o=DMC._converters.indexOf(a);o>=0&&DMC._converters.splice(o,1)},doConvert:function(a,o,l,u,c,d){if(l===u||!Kekule.NumUtils.isNormalNumber(a))return a;var h=r._converters;if(h.length){var p=Kekule.Unit.getUnit(l),g=Kekule.Unit.getUnit(u);if(p&&g)for(var f=h.length-1;f>=0;--f){var m=h[f];if(m.canConvert(a,o,p,g,c,d))return m.convert(a,o,p,g,c,d)}}return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(p.getKey(),g.getKey())),null},getAltUnits:function(a,o,l,u){var c=[],d=r._converters;if(d.length){var h=Kekule.Unit.getUnit(o);if(h)for(var p=d.length-1;p>=0;--p){var g=d[p].getAltUnits(a,h,l,u)||[];e.pushUnique(c,g)}}return c}};var i,r=Kekule.Spectroscopy.DataValueConverterManager;r.register({convert:function(a,o,l,u,c,d){return l.convertValueTo(a,u)},canConvert:function(a,o,l,u,c,d){return l.canConvertValueTo(u)},getAltUnits:function(a,o,l,u){return o.category.getConvertableUnits()}}),r.register({convert:function(a,o,l,u,c,d){var h=d.getParameter("NMR.ObserveFrequency");if(l.category===t.Frequency){var p=(g=l.convertValueTo(a,h.getUnit()))/h.getValue();return t.Dimensionless.ONE.convertValueTo(p,u)}if(l.category===Kekule.Unit.Dimensionless){var g=l.convertValueToStandard(a)*h.getValue();return t.getUnit(h.getUnit()).convertValueTo(g,u)}},canConvert:function(a,o,l,u,c,d){if(d.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR){var h=d.getParameter("NMR.ObserveFrequency"),p=h&&h.getValue();if(h&&p&&Kekule.NumUtils.isNormalNumber(p)&&Kekule.Unit.getUnit(h.getUnit()).category===Kekule.Unit.Frequency)return l.category===Kekule.Unit.Frequency&&u.category===Kekule.Unit.Dimensionless||l.category===Kekule.Unit.Dimensionless&&u.category===Kekule.Unit.Frequency}return!1},getAltUnits:function(a,o,l,u){var c=[];if(u.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR){var d=u.getParameter("NMR.ObserveFrequency"),h=d&&d.getValue();d&&h&&Kekule.NumUtils.isNormalNumber(h)&&Kekule.Unit.getUnit(d.getUnit()).category===Kekule.Unit.Frequency&&(o.category===Kekule.Unit.Frequency?c.push(Kekule.Unit.Dimensionless.PARTS_PER_MILLION):o.category===Kekule.Unit.Dimensionless&&(c=c.concat(Kekule.Unit.Frequency.getConvertableUnits())))}return c}}),r.register({convert:function(a,o,l,u,c,d){if(l.category===t.Length){var h=1/l.convertValueToStandardEx(a).value;return u.convertValueFromStandard(h)}if(l.category===t.WaveNumber){var p=1/l.convertValueToStandardEx(a).value;return u.convertValueFromStandard(p)}},canConvert:function(a,o,l,u,c,d){return d.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.IR&&(l.category===Kekule.Unit.Length&&u.category===Kekule.Unit.WaveNumber||l.category===Kekule.Unit.WaveNumber&&u.category===Kekule.Unit.Length)},getAltUnits:function(a,o,l,u){var c;return u.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.IR&&(o.category===Kekule.Unit.Length?c=[Kekule.Unit.WaveNumber.RECIPROCAL_CENTIMETER]:o.category===Kekule.Unit.WaveNumber&&(c=[Kekule.Unit.Length.getConvertableUnits()])),c}}),Kekule.Spectroscopy.SpectrumVarDefinition=Class.create(Kekule.VarDefinition,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumVarDefinition",initProperties:function(){this.defineProp("internalUnit",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getUnit()},setter:function(a){this.setUnit(a)}}),this.defineProp("externalUnit",{dataType:DataType.STRING})},getActualExternalUnit:function(){return this.getExternalUnit()||this.getInternalUnit()},hasDifferentExternalUnit:function(){var a=this.getExternalUnit();return!(!a||a===this.getInternalUnit())}}),Kekule.Spectroscopy.SpectrumDataSection=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumDataSection",DATAITEM_SRC_FIELD_NAME:"_src",DATAITEM_EXTRA_FIELD_NAME:"_extra",initialize:function(a,o,l){this.updateDataModifiedTime(),this.setPropStoreFieldValue("name",a),this.setPropStoreFieldValue("localVarInfos",[]),this.setPropStoreFieldValue("dataItems",[]),this.setPropStoreFieldValue("parent",o),this.tryApplySuper("initialize",[]),l&&this.setLocalVariables(l),this.setDataSorted(!0),this._cache={}},doFinalize:function(){this.getParent()&&this.getParent().removeChild&&this.getParent().removeChild(this),this.clear();for(var a=this.getVariables(),o=0,l=a.length;o<l;++o)a[o].finalize();this.setPropStoreFieldValue("localVarInfos",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.MapEx",setter:null,serializable:!1}),this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("localVarInfos",{dataType:DataType.ARRAY,setter:null}),this.defineProp("localVarSymbols",{dataType:DataType.ARRAY,scope:s.PRIVATE,serializable:!1,getter:function(){var a=[],o=this.getActualLocalVarInfos();if(o&&o.length)for(var l=0,u=o.length;l<u;++l){var c=o[l];a.push(c.symbol)}return a},setter:function(a){var o=a||[];this._updateLocalVarInfosFromSymbols(o)}}),this.defineProp("mode",{dataType:DataType.INT,enumSource:Kekule.Spectroscopy.DataMode,setter:function(a){this.getMode()!==a&&(this.setPropStoreFieldValue("mode",a),this.notifyDataChange())}}),this.defineProp("defPeakRoot",{dataType:DataType.Hash}),this.defineProp("modifiedTime",{dataType:DataType.DATE,setter:null}),this.defineProp("dataItems",{dataType:DataType.ARRAY,setter:null,scope:s.PRIVATE})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMode(Kekule.Spectroscopy.DataMode.CONTINUOUS)},getAutoIdPrefix:function(){return"sec"},ownerChanged:function(a,o){for(var l=0,u=this.getDataCount();l<u;++l){var c=this.getExtraInfoAt(l);c&&c.setOwner&&c.setOwner(a)}this.tryApplySuper("ownerChanged",[a,o])},doSaveProp:function(a,o,l,u,c,d,h,p){if(o.serializable){if(o.name==="dataItems"){var g=c.createChildStorageNode(l,c.propNameToStorageName("dataItems"),!1),f=c.createChildStorageNode(g,c.propNameToStorageName("values"),!0);c.saveObj(a.getDataItems(),f,u,d,h,p);var m=a._extractAllExtraInfoOfDataItems();return m.length&&(f=c.createChildStorageNode(g,c.propNameToStorageName("extras"),!0),c.saveObj(m,f,u,d,h,p)),!0}return!1}},doLoadProp:function(a,o,l,u,c,d,h){if(o.serializable){if(o.name==="dataItems"){var p=[],g=u.getChildStorageNode(l,u.propNameToStorageName("dataItems")),f=u.getChildStorageNode(g,u.propNameToStorageName("values"));if(u.loadObj(p,f,c,d,h),a.setPropStoreFieldValue("dataItems",p),f=u.getChildStorageNode(g,u.propNameToStorageName("extras"))){var m=[];u.loadObj(m,f,c,d,h),a._writeExtraInfoOfDataItems(m)}return!0}return!1}},_setSysFieldOfDataItem:function(a,o,l){try{Object.defineProperty?Object.defineProperty(a,o,{value:l,configurable:!0,writable:!0,enumerable:!1}):a[o]=l}catch{a[o]=l}},_extractAllExtraInfoOfDataItems:function(){for(var a=[],o=0,l=this.getDataCount();o<l;++o){var u=this.getExtraInfoAt(o);u&&a.push({index:o,info:u})}return a},_writeExtraInfoOfDataItems:function(a){for(var o=0,l=a.length;o<l;++o){var u=a[o];this.setExtraInfoAt(u.index,u.info)}},isEmpty:function(){return this.getDataCount()<=0},isPeakSection:function(){return this.getMode()===Kekule.Spectroscopy.DataMode.PEAK},hasPeakAssignments:function(){if(this.isPeakSection()){for(var a=!1,o=0,l=this.getDataCount();o<l;++o){var u=this.getExtraInfoAt(o);if(u&&u&&u.hasAssignments&&u.hasAssignments()){a=!0;break}}return a}return!1},getParentSpectrum:function(){for(var a=this.getParent();a&&!(a instanceof Kekule.Spectroscopy.Spectrum)&&a.getParent;)a=a.getParent();return a},getParentVariables:function(){var a=this.getParentSpectrum();return a&&a.getVariables()||[]},getActualLocalVarInfos:function(){var a=e.clone(this.getLocalVarInfos());if(!a||!a.length)for(var o=this.getParentVariables(),l=0,u=o.length;l<u;++l)a.push({symbol:o[l].symbol});return a},_updateLocalVarInfosFromSymbols:function(a,o){for(var l=a||[],u=[],c=this.getParentSpectrum(),d=0,h=l.length;d<h;++d){var p=l[d];this._pushLocalVariable(c,p,u)}this.setPropStoreFieldValue("localVarInfos",u),this.notifyPropSet("localVarInfos",u,o)},_pushLocalVariable:function(a,o,l){l||(l=this.getLocalVarInfos()),a&&a.getVariable&&a.getVariable(o)&&l.push({symbol:o})},setLocalVariables:function(a){for(var o,l=[],u=[],c=0,d=a.length;c<d;++c)typeof(o=a[c])=="string"?u.push(o):l.push(o);l.length?(this.setPropStoreFieldValue("localVarInfos",l),this.notifyPropSet("localVarInfos",l)):u.length&&this._updateLocalVarInfosFromSymbols(u)},getLocalVarInfoIndex:function(a){var o=-1,l=this.getActualLocalVarInfos();if(typeof a=="number")o=a;else for(var u=a.getSymbol?a.getSymbol():a,c=0,d=l.length;c<d;++c)if(u===l[c].symbol){o=c;break}return o},getLocalVarInfo:function(a){var o=this.getLocalVarInfoIndex(a);return o>=0?this.getActualLocalVarInfos()[o]:null},getLocalVarInfoValue:function(a,o){var l=this.getLocalVarInfo(a);return l&&l[o]},setLocalVarInfoValue:function(a,o,l){this.getLocalVarInfo(a)[o]=l},getLocalVarDef:function(a){var o=this.getLocalVarInfoValue(a,"symbol"),l=this.getParentSpectrum();return l&&l.getVariable(o)},getLocalVarInfoOfDependency:function(a){for(var o=[],l=this.getActualLocalVarInfos(),u=0,c=l.length;u<c;++u){var d=this.getLocalVarDef(u);if(d.getDependency()===a){var h=Object.extend({},l[u]);h.varDef=d,o.push(h)}}return o},getLocalVarSymbolsOfDependency:function(a){for(var o=this.getLocalVarInfoOfDependency(a),l=[],u=0,c=o.length;u<c;++u)l.push(o[u].varDef.getSymbol());return l},getContinuousVarRange:function(a){var o=this.getParent(),l=this.getLocalVarInfo(a);return l.continuousRange||o&&o.getContinuousVarRange&&o.getContinuousVarRange(l.symbol)},setContinuousVarRange:function(a,o,l){return this.setLocalVarInfoValue(a,"continuousRange",{fromValue:o,toValue:l}),this},clearContinuousVarRange:function(a){return this.setLocalVarInfoValue(a,"continuousRange",null),this},setDefaultVarValue:function(a,o){return this.setLocalVarInfoValue(a,"defaultValue",o),this},clearDefaultVarValue:function(a){return this.setDefaultVarValue(a,null)},getDefaultVarValue:function(a){var o=this.getLocalVarInfoValue(a,"defaultValue");if(Kekule.ObjUtils.isUnset(o)){var l=this.getLocalVarInfo(a),u=this.getParent();o=u&&u.getDefaultVarValue(l.symbol)}return o},getVarDisplayRange:function(a,o){var l=o||{},u=this.getLocalVarInfoIndex(a),c=this.getLocalVarInfo(u),d=c.displayRange?Object.extend({},c.displayRange):null;if(!d){var h=this.getLocalVarDef(u).getInfoValue("displayRange");h&&(d=Object.extend({},h))}return!d&&l.autoCalc&&(d=this.calcDataRange(u,{basedOnInternalUnit:!0})[c.symbol]),l.basedOnInternalUnit||(d=this._convertDataRangeToExternalUnit(d,u)),d},setVarDisplayRange:function(a,o,l,u){var c={min:o,max:l};if((u||{}).basedOnExternalUnit){var d=this.getLocalVarInfoIndex(a);c=this._convertDataRangeToInternalUnit(c,d)}return this.setLocalVarInfoValue(a,"displayRange",c),this},clearVarDisplayRange:function(a){return this.setLocalVarInfoValue(a,"displayRange",null),this},getDisplayRangeOfVars:function(a,o){var l={};a||(a=this.getLocalVarSymbols());for(var u=0,c=a.length;u<c;++u)l[this._varToVarSymbol(a[u])]=this.getVarDisplayRange(a[u],o);return l},_varToVarSymbol:function(a){var o=this.getLocalVarDef(a);return o?o.getSymbol():null},_varToVarSymbols:function(a){var o=[],l=a?e.toArray(a):null;if(l)for(var u=0,c=l.length;u<c;++u)o.push(this._varToVarSymbol(l[u]));else o=this.getLocalVarSymbols();return o},_getDefaultPeakRoot:function(){for(var a={},o=0,l=this.getActualLocalVarInfos().length;o<l;++o){var u=this.getLocalVarDef(o);u.getDependency()!==Kekule.VarDependency.INDEPENDENT&&(a[u.getSymbol()]=0)}return a},calcDataRange:function(a,o){var l=o||{},u=this._varToVarSymbols(a),c=function(y){return!Kekule.NumUtils.isNormalNumber(y)},d={},h=this._cache.ranges;h||(h={},this._cache.ranges=h);for(var p=[],g=0,f=u.length;g<f;++g)h[_=u[g]]?d[_]=Object.extend({},h[_]):p.push(_);if(p.length){var m=this,C=this.isPeakSection();for(this.forEach(function(y,T){for(var E=0,b=p.length;E<b;++E){var v=p[E];if(!c(y[v])&&(d[v]||(d[v]={}),d[v].min=c(d[v].min)?y[v]:Math.min(d[v].min,y[v]),d[v].max=c(d[v].max)?y[v]:Math.max(d[v].max,y[v]),C&&!l.ignorePeakRoot)){var I=m.getPeakRootValueOf(y);I&&!c(I[v])&&(d[v].min=c(d[v].min)?I[v]:Math.min(d[v].min,I[v]),d[v].max=c(d[v].max)?I[v]:Math.max(d[v].max,I[v]))}}},null,{basedOnInternalUnit:!0}),g=0,f=p.length;g<f;++g)h[_=p[g]]=Object.extend({},d[_])}if(!l.basedOnInternalUnit)for(g=0,f=u.length;g<f;++g){var _=u[g];d[_]=this._convertDataRangeToExternalUnit(d[_],g)}return d},_convertDataRangeToExternalUnit:function(a,o){if(!a)return a;for(var l=["min","max"],u=0,c=l.length;u<c;++u){var d=l[u];a[d]=this._convertVarValueToExternal(a[d],o)}if(a.min>a.max){var h=a.min;a.min=a.max,a.max=h}return a},_convertDataRangeToInternalUnit:function(a,o){if(!a)return a;for(var l=["min","max"],u=0,c=l.length;u<c;++u){var d=l[u];a[d]=this._convertVarValueToInternal(a[d],o)}if(a.min>a.max){var h=a.min;a.min=a.max,a.max=h}return a},calcDataAverage:function(a,o){var l=o||{},u=this._varToVarSymbols(a),c={},d=this._cache.averages,h=function(y){return!Kekule.NumUtils.isNormalNumber(y)};d||(d={},this._cache.averages=d);for(var p=[],g=0,f=u.length;g<f;++g){var m=u[g];h(d[m])?p.push(m):c[m]=d[m]}if(p.length){var C={},_={};for(g=0,f=p.length;g<f;++g)C[p[g]]=0,_[p[g]]=0;for(this.forEach(function(y,T){for(var E=0,b=p.length;E<b;++E){var v=p[E],I=y[v];h(I)||(C[v]+=I,++_[v])}},null,{basedOnInternalUnit:!0}),g=0,f=p.length;g<f;++g)c[m=p[g]]=C[m]/_[m],d[m]=c[m]}if(!l.basedOnInternalUnit)for(g=0,f=u.length;g<f;++g)c[m=u[g]]=this._convertVarValueToExternal(c[g]);return c},getContinuousVarSymbols:function(){for(var a=[],o=this.getActualLocalVarInfos(),l=0,u=o.length;l<u;++l)this.getContinuousVarRange(l)&&a.push(o[l].symbol);return a},_itemHashToArray:function(a){if(!a)return null;for(var o=[],l=this.getLocalVarSymbols(),u=0,c=l.length;u<c;++u)o.push(a[l[u]]);var d,h=this._getDataValueSrc(a);if(h&&this._setSysFieldOfDataItem(o,this.DATAITEM_SRC_FIELD_NAME,h),h&&h[this.DATAITEM_EXTRA_FIELD_NAME])d=h[this.DATAITEM_EXTRA_FIELD_NAME];else{var p=e.exclude(Kekule.ObjUtils.getOwnedFieldNames(a,!1),[this.DATAITEM_SRC_FIELD_NAME,this.DATAITEM_EXTRA_FIELD_NAME].concat(l));for(p.length&&(d={}),u=0,c=p.length;u<c;++u)d[p[u]]=a[p[u]]}return d&&this._setSysFieldOfDataItem(h||o,this.DATAITEM_EXTRA_FIELD_NAME,d),o},_convArrayToSymboledHash:function(a,o){for(var l={},u=0,c=Math.min(o.length,a.length);u<c;++u){var d=a[u];l[o[u]]=d}return l},_itemArrayToHash:function(a,o){if(!a)return null;for(var l={},u=this.getLocalVarSymbols(),c=0,d=Math.min(u.length,a.length);c<d;++c){var h;h=o.basedOnInternalUnit?a[c]:this._convertVarValueToExternal(a[c],c),l[u[c]]=h}var p=this._getDataValueSrc(a);return p[this.DATAITEM_EXTRA_FIELD_NAME]&&this._setSysFieldOfDataItem(l,this.DATAITEM_EXTRA_FIELD_NAME,a[this.DATAITEM_EXTRA_FIELD_NAME]),this._setSysFieldOfDataItem(l,this.DATAITEM_SRC_FIELD_NAME,p||a),l},_convertVarValueToNewUnit:function(a,o,l,u){return Kekule.NumUtils.isNormalNumber(a)?Kekule.Spectroscopy.DataValueConverterManager.doConvert(a,o,l,u,this,this.getParent()):a},_convertVarValueToExternal:function(a,o){var l=a,u=this.getLocalVarDef(o);return u&&u.hasDifferentExternalUnit&&u.hasDifferentExternalUnit()&&(l=this._convertVarValueToNewUnit(a,u,u.getInternalUnit(),u.getActualExternalUnit())),l},_convertVarValueToInternal:function(a,o){var l=a,u=this.getLocalVarDef(o);return u&&u.hasDifferentExternalUnit&&u.hasDifferentExternalUnit()&&(l=this._convertVarValueToNewUnit(a,u,u.getActualExternalUnit(),u.getInternalUnit())),l},isDataSorted:function(){return this._sorted||this.getDataCount()<=1},setDataSorted:function(a){return this._sorted=!!a,this},sort:function(a){if(!this.isDataSorted()){var o=this,l=a?function(u,c){return a(o._itemArrayToHash(u),o._itemArrayToHash(c))}:function(u,c){return e.compare(u,c)};return this.getDataItems().sort(l),this.setDataSorted(!0),this}},getIndependentVarValueOrder:function(a){var o=0;if(this.isDataSorted()){var l=this,u=function(p,g,f,m){var C=g,_={},y=!1;do _.value=l.getHashValueAt(C)[p],_.index=C,C+=m,y=Kekule.NumUtils.isNormalNumber(_.value);while(!y&&(m>0&&C<=c||m<0&&C>=f));return y?_:null},c=this.getDataCount()-1,d=u(a,0,c,1),h=u(a,c,0,-1);d&&h&&d.index<h.index&&(o=Math.sign(h.value-d.value))}return o},getDataCount:function(){return this.getDataItems().length},clearCache:function(){this._cache={}},notifyDataChange:function(){var a=this.getDataItems();this.setDataSorted(!1),this.clearCache(),this.updateDataModifiedTime(),this.notifyPropSet("dataItems",a),this.invokeEvent("dataChange",{data:a})},updateDataModifiedTime:function(){this.setPropStoreFieldValue("modifiedTime",new Date)},clear:function(){this.setDataItems([]),this.notifyDataChange(),this.setDataSorted(!0)},indexOfDataItem:function(a){var o=a[this.DATAITEM_SRC_FIELD_NAME]||a;return this.getDataItems().indexOf(o)},appendData:function(a){var o;if(o=DataType.isArrayValue(a)?a:this._itemHashToArray(a))return this.getDataItems().push(o),o[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoAdded(o[this.DATAITEM_EXTRA_FIELD_NAME]),this.notifyDataChange(),o},removeData:function(a){var o=this.getDataItems().indexOf(a);return this.removeDataItemAt(o)},removeDataAt:function(a){var o=this.getDataItems().splice(a,1);return this.notifyDataChange(),o},getRawValueAt:function(a){var o=this.getDataItems()[a];if(o){var l=e.clone(o);l[this.DATAITEM_SRC_FIELD_NAME]=o;for(var u=this.getMode()===Kekule.Spectroscopy.DataMode.CONTINUOUS,c=this.getDataCount()-1,d=0,h=l.length;d<h;++d){var p=l[d];if(DataType.isUndefinedValue(p)||DataType.isNullValue(p)){var g=this.getDefaultVarValue(d);if(Kekule.ObjUtils.notUnset(g))p=g;else if(u){var f=this.getContinuousVarRange(d);f&&(p=c>1?a/c*(f.toValue-f.fromValue)+f.fromValue:f.fromValue)}}l[d]=p}return o[this.DATAITEM_EXTRA_FIELD_NAME]&&this._setSysFieldOfDataItem(l,this.DATAITEM_EXTRA_FIELD_NAME,o._extra),l}return null},getHashValueAt:function(a,o){return this._itemArrayToHash(this.getRawValueAt(a),o||{})},getValueAt:function(a,o){return this.getHashValueAt(a,o)},setRawValueAt:function(a,o){var l=this.getDataItems()[a];return l&&l[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoRemoved(l[this.DATAITEM_EXTRA_FIELD_NAME]),this.getDataItems()[a]=o,o[this.DATAITEM_EXTRA_FIELD_NAME]&&(this._setSysFieldOfDataItem(o,this.DATAITEM_EXTRA_FIELD_NAME,o[this.DATAITEM_EXTRA_FIELD_NAME]),this._extraInfoAdded(o[this.DATAITEM_EXTRA_FIELD_NAME])),this.notifyDataChange(),this},setHashValueAt:function(a,o,l){var u=this._itemHashToArray(o);return this.setRawValueAt(a,u),this},setValueAt:function(a,o,l){var u;return u=DataType.isArrayValue(o)?o:this._itemHashToArray(o),this.setRawValueAt(a,u),this},_getDataValueSrc:function(a){return a?DataType.isArrayValue(a)?a[this.DATAITEM_SRC_FIELD_NAME]||a:a[this.DATAITEM_SRC_FIELD_NAME]:null},createDefaultExtraInfoObjectFor:function(a){var o=this.isPeakSection()?Kekule.Spectroscopy.SpectrumPeakDetails:null,l=o?new o:null;return l&&Kekule.ObjUtils.notUnset(a)&&(typeof a=="number"?this.setExtraInfoAt(a,l):a&&this.setExtraInfoOf(a,l)),l},getExtraInfoOf:function(a){return(this._getDataValueSrc(a)||a)[this.DATAITEM_EXTRA_FIELD_NAME]||a[this.DATAITEM_EXTRA_FIELD_NAME]},setExtraInfoOf:function(a,o){var l=this._getDataValueSrc(a)||a;return l[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoRemoved(l[this.DATAITEM_EXTRA_FIELD_NAME]),this._setSysFieldOfDataItem(l,this.DATAITEM_EXTRA_FIELD_NAME,o),this._extraInfoAdded(o),this.notifyDataChange(),this},getExtraInfoAt:function(a){var o=this.getDataItems()[a];return o&&o[this.DATAITEM_EXTRA_FIELD_NAME]},setExtraInfoAt:function(a,o){var l=this.getDataItems()[a];return l[this.DATAITEM_EXTRA_FIELD_NAME]&&this._extraInfoRemoved(l[this.DATAITEM_EXTRA_FIELD_NAME]),this._setSysFieldOfDataItem(l,this.DATAITEM_EXTRA_FIELD_NAME,o),this._extraInfoAdded(o),this.notifyDataChange(),this},_extraInfoAdded:function(a){a&&a instanceof Kekule.ChemObject&&(a.setParent(this),a.setOwner(this.getOwner()))},_extraInfoRemoved:function(a){a&&a instanceof Kekule.ChemObject&&a.getParent()===this&&(a.setParent(null),a.setOwner(null))},getPeakRootValueOf:function(a){if(this.getMode()!==Kekule.Spectroscopy.DataMode.PEAK)return null;var o=this.getDefPeakRoot()||this._getDefaultPeakRoot();return Object.extend(Object.extend({},a),o)},getPeakRootValueAt:function(a){return this.getPeakRootValueOf(this.getValueAt(a))},getSurroundingDataItemIndexesFromIndependent:function(a,o){},getDataItemIndexFromIndependent:function(a,o){var l={};l=typeof a=="number"?this._convArrayToSymboledHash([a],this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):DataType.isArrayValue(a)?this._convArrayToSymboledHash(a,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):a;for(var u=Kekule.ObjUtils.getOwnedFieldNames(l),c=this.calcDataRange(u),d=o&&o.allowedErrorRate,h={},p=0,g=u.length;p<g;++p){if((b=l[E=u[p]])<c[E].min||b>c[E].max)return-1;h[E]=d&&(c[E].max-c[E].min)*d}var f={index:-1,distanceSqr:0};for(p=0,g=this.getDataCount();p<g;++p){for(var m,C=this.getHashValueAt(p),_=!0,y=0,T=u.length;y<T;++y){var E,b=l[E=u[y]],v=C[E],I=Math.abs(v-b);if(!(I<=h[E])){_=!1;break}m+=Math.sqr(I/c[E])}_&&(f.index<0||f.distanceSqr>m)&&(f.index=p,f.distanceSqr=m)}return f.index},getDataValueFromIndependent:function(a,o){var l=this.getDataItemIndexFromIndependent(a,o);return l>=0?this.getValueAt(l):null},calcValueFromIndependent:function(a,o){var l={};return l=typeof a=="number"?this._convArrayToSymboledHash([a],this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):DataType.isArrayValue(a)?this._convArrayToSymboledHash(a,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):a,this.doCalcValueFromIndependent(l,o)},doCalcValueFromIndependent:function(a,o){return this.getMode()===Kekule.Spectroscopy.DataMode.PEAK?this._doCalcValueFromIndependentInPeakMode(a,o):this._doCalcValueFromIndependentInContinousMode(a,o)},_doCalcValueFromIndependentInPeakMode:function(a,o){var l=this.getDataItemIndexFromIndependent(a,o);return l>=0?this.getHashValueAt(l):this.getPeakRootValueOf(a)},_doCalcValueFromIndependentInContinousMode:function(a,o){var l=this._doCalcValueFromIndependentInContinousModeEx(a,o);return l&&l.value},_doCalcValueFromIndependentInContinousModeEx:function(a,o){var l=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT),u=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT);if(l.length>1)return null;var c,d=l[0],h=a[d],p=this.calcDataRange([d])[d];if(h<p.min||h>p.max)return null;var g=-1,f=-1,m=!0,C=this.getLocalVarDef(d),_=this.getDataCount();if(m=!C.hasDifferentExternalUnit()){var y=this.getContinuousVarRange(d);m=!!y}if(m){var T=(h-y.fromValue)/(y.toValue-y.fromValue)*(_-1);g=Math.max(Math.floor(T),0),f=Math.min(Math.ceil(T),_-1)}else{var E=this.getIndependentVarValueOrder(d);if(E!==0){var b=E<0,v=this._calcNeighborDataIndexesToIndependentValue(d,h,0,_-1,b);g=v[0],f=v[1]}}if(g<0||f<0)return null;if(g===f)c=this.getHashValueAt(g);else{var I=this._calcIntermediateDependentVarValuesBetween(u,d,h,g,f);(c={})[d]=h,c=Object.extend(c,I)}return{value:c,dataIndexes:[g,f]}},_calcNeighborDataIndexesToIndependentValue:function(a,o,l,u,c){if(u-l<=2)return[l,u];var d=Math.round((l+u)/2),h=this.getHashValueAt(d)[a];return h===o?[d,d]:h<=o?c?this._calcNeighborDataIndexesToIndependentValue(a,o,l,d,c):this._calcNeighborDataIndexesToIndependentValue(a,o,d,u,c):c?this._calcNeighborDataIndexesToIndependentValue(a,o,d,u,c):this._calcNeighborDataIndexesToIndependentValue(a,o,l,d,c)},_calcIntermediateDependentVarValuesBetween:function(a,o,l,u,c){if(u===c){for(var d=this.getHashValueAt(u),h={},p=0,g=a.length;p<g;++p)h[a[p]]=d[a[p]];return h}var f=this.getHashValueAt(u),m=this.getHashValueAt(c),C=f[o],_=m[o];if(Kekule.NumUtils.isNormalNumber(C)){if(Kekule.NumUtils.isNormalNumber(_)){var y=(l-f[o])/(m[o]-f[o]);for(h={},p=0,g=a.length;p<g;++p){var T=a[p],E=f[T],b=m[T],v=!1;v=Kekule.NumUtils.isNormalNumber(E)?Kekule.NumUtils.isNormalNumber(b)?E+(b-E)*y:c<this.getDataCount()-1?this._calcIntermediateDependentVarValuesBetween([T],o,l,u,c+1):E[T]:u>0?this._calcIntermediateDependentVarValuesBetween([T],o,l,u-1,c):b[T],h[T]=v}return h}return c<this.getDataCount()-1?this._calcIntermediateDependentVarValuesBetween(a,o,l,u,c+1):this._calcIntermediateDependentVarValuesBetween(a,o,l,u,u)}return u>0?this._calcIntermediateDependentVarValuesBetween(a,o,l,u-1,c):this._calcIntermediateDependentVarValuesBetween(a,o,l,c,c)},calcValueRangeFromIndependentRangeEx:function(a,o){var l={};return l=DataType.isArrayValue(a)?this._convArrayToSymboledHash(a,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):a,this.doCalcValueRangeFromIndependentRangeEx(l,o)},doCalcValueRangeFromIndependentRangeEx:function(a,o){for(var l=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT),u=this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT),c=this.calcDataRange(l),d=(o&&o.findNearest,{}),h={},p=0,g=l.length;p<g;++p){var f=l[p];if(a[f]){var m=Object.extend({},a[f]),C=c[f];m.min<C.min&&(m.min=C.min),m.max>C.max&&(m.max=C.max),d[f]=m,h[f]=(m.min+m.max)/2}}var _=this.getMode()===Kekule.Spectroscopy.DataMode.PEAK?this._doCalcValueRangeFromIndependentRangeInPeakModeEx(d,h,l,u,o):this._doCalcValueRangeFromIndependentRangeInContinousModeEx(d,h,l,u,o);return _&&_.range&&Kekule.ObjUtils.getOwnedFieldNames(_.range)<=0&&(_.range=null),_},_doCalcValueRangeFromIndependentRangeInPeakModeEx:function(a,o,l,u,c){var d,h,p,g,f=!!o,m={dataIndexes:[],dataValues:[],range:{}};c.findInReversedOrder?(h=this.getDataCount()-1,p=0,g=-1):(h=0,p=this.getDataCount()-1,g=1);for(var C=h;c.findInReversedOrder?C>=p:C<=p;C+=g){for(var _=this.getHashValueAt(C),y=!0,T=0,E=0,b=l.length;E<b;++E){var v=l[E];if(!(y=_[v]>=a[v].min&&_[v]<=a[v].max))break;f&&(T+=Math.sqr(_[v]-o[v]))}y&&(m.dataIndexes.push(C),m.dataValues.push(_),f&&(d===void 0||T<d)&&(d=T,m.nearest={dataIndex:C,dataValue:_}))}return m.range=Kekule.Spectroscopy.Utils.expandDataRange(m.range,m.dataValues),m},_doCalcValueRangeFromIndependentRangeInContinousModeEx:function(a,o,l,u,c){if(l.length>1)return null;var d=l[0],h=a[d],p={},g={};p[d]=h.min,g[d]=h.max;var f=this._doCalcValueFromIndependentInContinousModeEx(p,c),m=this._doCalcValueFromIndependentInContinousModeEx(g,c);if(!f||!m)return null;var C=f.dataIndexes[0]>m.dataIndexes[0],_={};C?(_.fromIndex=m.dataIndexes[1],_.toIndex=f.dataIndexes[0]):(_.fromIndex=f.dataIndexes[1],_.toIndex=m.dataIndexes[0]);for(var y={range:{},dataIndexes:[],dataValues:[]},T=_.fromIndex;T<=_.toIndex;++T){var E=this.getHashValueAt(T);y.dataValues.push(E),y.dataIndexes.push(T),y.range=Kekule.Spectroscopy.Utils.expandDataRange(y.range,E)}return y.range=Kekule.Spectroscopy.Utils.expandDataRange(y.range,[f.value,m.value]),C?(y.dataValues.push(f.value),y.dataValues.unshift(m.value)):(y.dataValues.push(m.value),y.dataValues.unshift(f.value)),y.dataIndexes.push(-1),y.dataIndexes.unshift(-1),y},getIterator:function(){return this.doGetIterator()},doGetIterator:function(){var a=this.getDataItems(),o=this;return{index:0,next:function(l){if(this.index>=a.length)return{done:!0};var u={done:!1,value:o.getHashValueAt(this.index,l)};return++this.index,u}}},forEach:function(a,o,l){var u=this.getIterator();if(u)for(var c=0,d=u.next(l);!d.done;)a.apply(o,[d.value,c]),++c,d=u.next();return this},getComparisonPropNames:function(a){var o=this.tryApplySuper("getComparisonPropNames",[a]);return o&&(o=e.exclude(o,["parent","owner"]),e.pushUnique(o,"dataItems")),o},doGetComparisonPropNames:function(a){var o=this.tryApplySuper("doGetComparisonPropNames",[a]);return a.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(o=(o||[]).concat("defPeakRoot","localVarInfos","mode","dataItems")),o},doCompareProperty:function(a,o,l){return o==="dataItems"?this.doCompareDataItems(this,a,l):o==="localVarInfos"?this.doCompareLocalVarInfos(this,a,l):this.tryApplySuper("doCompareProperty",[a,o,l])},doCompareLocalVarInfos:function(a,o,l){var u=a.getActualLocalVarInfos(),c=o.getActualLocalVarInfos(),d=u.length-c.length;if(!d&&l.method!==Kekule.ComparisonMethod.CHEM_STRUCTURE)for(var h=0,p=u.length;h<p;++h){var g=u[h],f=c[h];if(d=Kekule.ObjComparer.compare(g,f,l))break}if(!d)for(h=0,p=u.length;h<p;++h){var m=a.getLocalVarDef(h),C=a.getLocalVarDef(h);if(d=this.doCompareOnValue(m,C,l))break}return d},doCompareDataItems:function(a,o,l){var u=function(C,_){var y=C.getHashValueAt(_);return C._itemHashToArray(y)},c=a.getDataCount()-o.getDataCount();if(!c)for(var d=0,h=a.getDataCount();d<h;++d){var p=u(a,d),g=u(a,d);if(!(c=this._compareDataRawValue(p,g,l))){var f=a.getExtraInfoAt(d)||null,m=o.getExtraInfoAt(d)||null;f&&f.isEmpty()&&(f=null),m&&m.isEmpty()&&(m=null),c=this.doCompareOnValue(f,m,l)}if(c)break}return c},_compareDataRawValue:function(a,o,l){var u;if(!a&&!o)return 0;if(a&&!o)return 1;if(!a&&o)return-1;if(!(u=(a.length||-1)-(o.length||-1)))for(var c=Kekule.NumUtils,d=l.allowedComparisonErrorRate||Kekule.globalOptions.spectrum.data.allowedComparisonErrorRate||5e-8,h=0,p=a.length;h<p;++h){var g=a[h],f=o[h];if(u=c.isNormalNumber(g)&&c.isNormalNumber(f)?c.isFloatEqual(g,f,Math.abs(g*d))?0:Math.sign(g-f):this.doCompareOnValue(a,o,l))break}return u}}),Kekule.Spectroscopy.SpectrumData=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumData",initialize:function(a,o,l){this.tryApplySuper("initialize",[a]),this.setPropStoreFieldValue("variables",o?e.clone(o):[]);var u=new Kekule.ChemObjList(null,Kekule.Spectroscopy.SpectrumDataSection,!0);this.setPropStoreFieldValue("sections",u),this.setParent(l),u.setOwner(this.getOwner())},doFinalize:function(){this.getSections().finalize();for(var a=this.getVariables()||[],o=0,l=a.length;o<l;++o)a[o].finalize();this.setPropStoreFieldValue("variables",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getPropStoreFieldValue("owner")||this._getDefaultOwner()},setter:function(a){if(a!==this.getPropStoreFieldValue("owner")){this.setPropStoreFieldValue("owner",a);var o=this.getOwner(),l=this.getSections();l&&l.setOwner(o)}}}),this.defineProp("parent",{dataType:"Kekule.Spectroscopy.Spectrum",serializable:!1,setter:function(a){this.setPropStoreFieldValue("parent",a);var o=this.getSections();o&&o.setParent(this.getParent()||this)}}),this.defineProp("sections",{dataType:"Kekule.ChemObjList",setter:function(a){var o=this.getSections();o!==a&&(o&&o.finalize(),a&&(a._transparent=!0,a.setParent(this.getParent()||this),a.setOwner(this.getOwner())),this.setPropStoreFieldValue("sections",a))}}),this.defineProp("autoCreateSection",{dataType:DataType.BOOL}),this.defineProp("activeSectionIndex",{dataType:DataType.INT,getter:function(){return this.getSectionCount()<=0?-1:this.getSectionCount()===1?0:this.getPropStoreFieldValue("activeSectionIndex")},setter:function(a){a>=0&&a<=this.getSectionCount()&&this.setPropStoreFieldValue("activeSectionIndex",a)}}),this.defineProp("activeSection",{dataType:"Kekule.Spectroscopy.SpectrumDataSection",serializable:!1,getter:function(){var a=this.getSectionAt(this.getActiveSectionIndex()||0);return!a&&this.getSectionCount()<=0&&this.getAutoCreateSection()&&(a=this.createSection(this.getVariables())),a},setter:function(a){this.setActiveSectionIndex(this.indexOfSection(a))}}),this.defineProp("variables",{dataType:DataType.ARRAY}),this.defineProp("varSymbols",{dataType:DataType.ARRAY,setter:null,scope:s.PRIVATE,getter:function(){for(var a=[],o=this.getVariables()||[],l=0,u=o.length;l<u;++l){var c=o[l];a.push(c.getSymbol())}return a}}),this.defineProp("mode",{dataType:DataType.INT,enumSource:Kekule.Spectroscopy.DataMode})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoCreateSection(!0),this.setMode(Kekule.Spectroscopy.DataMode.CONTINUOUS)},_getDefaultOwner:function(){var a=this.getParent();return a&&a.getOwner&&a.getOwner()},getHigherLevelObj:function(){return this.getParent()},getChildHolder:function(){return this.getSections()},loaded:function(a){var o=this.getSections();o&&(o.parentChanged(this),o.ownerChanged(this.getOwner())),this.tryApplySuper("loaded",[a])},isEmpty:function(){for(var a=0,o=this.getSectionCount();a<o;++a)if(!this.getSectionAt(a).isEmpty())return!1;return!0},createSection:function(a,o){var l=new Kekule.Spectroscopy.SpectrumDataSection(void 0,this,a);return l.setMode(o||this.getMode()),this.getSections().appendChild(l),l},clearSection:function(){for(var a=this.getChildren(),o=0,l=a.length;o<l;++o)a[o].clear(),a[o].setParent(null),a[o].finalize();this.getSections().clear()},getSectionCount:function(){return this.getSections().getChildCount()},getSectionAt:function(a){return this.getSections().getItemAt(a)},indexOfSection:function(a){return this.getSections().indexOfItem(a)},hasSection:function(a){return this.indexOfSection(a)>=0},removeSectionAt:function(a){return this.getSections().removeItemAt(a)},removeSection:function(a){return this.getSections().removeItem(a)},insertSectionAt:function(a,o){return this.getSections().insertItemAt(a,o)},insertSectionBefore:function(a,o){return this.getSections().insertItemBefore(a,o)},appendSection:function(a){return this.getSections().appendChild(a)},hasMultipleSections:function(){return this.getSections().getChildCount()>1},calcDataRangeOfSection:function(a,o){return a.calcDataRange(o)},calcDataRangeOfSections:function(a,o,l){for(var u={},c=0,d=a.length;c<d;++c){var h=a[c].calcDataRange(o,l);u=Kekule.Spectroscopy.Utils.mergeDataRange(u,h)}return u},getDisplayRangeOfSection:function(a,o,l){return a.getDisplayRangeOfVars(o,l)},getDisplayRangeOfSections:function(a,o,l){for(var u={},c=0,d=a.length;c<d;++c){var h=a[c].getDisplayRangeOfVars(o,l);u=Kekule.Spectroscopy.Utils.mergeDataRange(u,h)}return u},getVariableCount:function(){return(this.getVariables()||[]).length},getVariable:function(a){return a instanceof Kekule.VarDefinition?a:typeof a=="number"?this.getVariables()[a]:this.getVariables()[this.getVarSymbols().indexOf(a)]},indexOfVariable:function(a){return this.getVariables().indexOf(a)},insertVariableAt:function(a,o){return o>=0?this.getVariables().splice(o,0,a):this.getVariables().push(a),this},insertVariableBefore:function(a,o){var l=o?this.indexOfVarDefinition(o):-1;return this.insertVarDefinitionAt(a,l)},appendVariable:function(a){return this.insertVariableAt(a,-1)},removeVariableAt:function(a){return this.getVariables().splice(a,1),this},removeVariable:function(a){var o=this.indexOfVariable(a);return o>=0&&this.removeVariableAt(o),this},getVariablesOfDependency:function(a){for(var o=[],l=0,u=this.getVariableCount();l<u;++l){var c=this.getVariable(l);c&&c.getDependency()===a&&o.push(c)}return o},getContinuousVarRange:function(a){var o=this.getVariable(a),l=o&&o.getInfo();return l&&l.continuous?{fromValue:l.fromValue,toValue:l.toValue}:null},setContinuousVarRange:function(a,o,l){var u=this.getVariable(a),c=u&&u.getInfo(!0);return c.continuous=!0,c.fromValue=o,c.toValue=l,this},clearContinuousVarRange:function(a){var o=this.getVariable(a).getInfo();return o&&o.continuous&&(o.continuous=!1),this},setDefaultVarValue:function(a,o){var l=this.getVariable(a);return(l&&l.getInfo(!0)).defaultValue=o,this},clearDefaultVarValue:function(a){return this.setDefaultVarValue(a,null)},getDefaultVarValue:function(a){var o=this.getVariable(a),l=o&&o.getInfo();if(l)return l.defaultValue},iterateSections:function(a){for(var o=0,l=this.getSectionCount();o<l;++o)a(this.getSectionAt(o),o)},sort:function(a){this.iterateSections(function(o){o.sort(a)})},getDataCount:function(){var a=0;return this.iterateSections(function(o){a+=o.getDataCount()}),a},clearData:function(){this.iterateSections(function(a){a.clear()})},appendData:function(a){return this.getActiveSection().appendData(a)},removeData:function(a){return this.getActiveSection().removeData(a)},removeDataAt:function(a){return this.getActiveSection().removeDataAt(a)},getRawValueAt:function(a){return this.getActiveSection().getRawValueAt(a)},getHashValueAt:function(a){return this.getActiveSection().getHashValueAt(a)},getValueAt:function(a){return this.getHashValueAt(a)},setRawValueAt:function(a,o){return this.getActiveSection().setRawValueAt(a,o),this},setHashValueAt:function(a,o,l){return this.getActiveSection().setHashValueAt(a,o,l),this},setValueAt:function(a,o,l){return this.getActiveSection().setValueAt(a,o),this},getExtraInfoOf:function(a){return this.getActiveSection().getExtraInfoOf(a)},setExtraInfoOf:function(a,o){return this.getActiveSection().setExtraInfoOf(a,o),this},getExtraInfoAt:function(a){return this.getActiveSection().getExtraInfoAt(a)},setExtraInfoAt:function(a,o){return this.getActiveSection().setExtraInfoAt(a,o),this},getIterator:function(){return this.doGetIterator()},doGetIterator:function(){var a=this.getSections().getItems();return{sectionIndex:0,index:0,next:function(){var o=this,l=function(){return o.sectionIndex>=a.length||o.sectionIndex===a.length-1&&o.index>=a[a.length-1].getDataCount()};if(l())return{done:!0};if(!(this.index<a[this.sectionIndex].getDataCount())){do++this.sectionIndex,this.index=0;while(this.index>=a[this.sectionIndex].getDataCount()||o.sectionIndex>=a.length);return l()?{done:!0}:{done:!1,value:a[this.sectionIndex].getValueAt(this.index)}}var u={done:!1,value:a[this.sectionIndex].getValueAt(this.index)};return++this.index,u}}},forEach:function(a,o){var l=this.getIterator();if(l)for(var u=0,c=l.next();!c.done;)a.apply(o,[c.value,u]),++u,c=l.next();return this}}),Kekule.Spectroscopy.PeakShape={SHARP:"sharp",BROAD:"broad"},Kekule.Spectroscopy.PeakMultiplicity={UNKNOWN:0,SINGLET:1,DOUBLET:2,TRIPLET:3,QUARTET:4,QUINTET:5,SEXTUPLET:6,DOUBLE_DOUBLET:22,TRIPLE_DOUBLET:32,MULTIPLET:255},Kekule.Spectroscopy.SpectrumDataDetails=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumDataDetails",initialize:function(a){this.setPropStoreFieldValue("assignments",[]),this.tryApplySuper("initialize",[]),this.setPropValues(a)},initProperties:function(){this.defineProp("assignments",{dataType:DataType.ARRAY,objRef:!0,autoUpdate:!0,setter:function(a){var o=a?DataType.isArrayValue(a)?e.clone(a):e.toArray(a):[];this.setPropStoreFieldValue("assignments",o)}}),this.defineProp("assignment",{dataType:"Kekule.ChemObject",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return(this.getAssignments()||[])[0]},setter:function(a){this.setAssignments(a)}})},doFinalize:function(){this.setPropStoreFieldValue("assignments",null),this.tryApplySuper("doFinalize")},getAutoIdPrefix:function(){return"d"},isEmpty:function(){var a=this.getAssignments();return!a||!a.length},hasAssignments:function(){var a=this.getAssignments();return!(!a||!a.length)},doGetComparisonPropNames:function(a){var o=this.tryApplySuper("doGetComparisonPropNames",[a]);return a.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(o=o||[]).unshift("assignments"),o}}),Kekule.Spectroscopy.SpectrumPeakDetails=Class.create(Kekule.Spectroscopy.SpectrumDataDetails,{CLASS_NAME:"Kekule.Spectroscopy.SpectrumPeakDetails",initProperties:function(){this.defineProp("shape",{dataType:DataType.STRING}),this.defineProp("multiplicity",{dataType:DataType.VARIANT})},getAutoIdPrefix:function(){return"p"},isEmpty:function(){var a=this.tryApplySuper("isEmpty");return a=a&&!this.getShape()&&Kekule.ObjUtils.isUnset(this.getMultiplicity())},doGetComparisonPropNames:function(a){var o=this.tryApplySuper("doGetComparisonPropNames",[a]);return a.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&((o=o||[]).unshift("shape"),o.unshift("multiplicity")),o}}),Kekule.Spectroscopy.SpectrumType={NMR:"NMR",IR:"IR",MS:"MS",UV_VIS:"UV_VIS",IMS:"IMS",RAMAN:"Raman",CHROMATOGRAPHY:"chromatography",GENERAL:"general"},Kekule.Spectroscopy.SpectrumNMR={TargetNucleus:{C13:"C13",H:"H"}},Kekule.Spectroscopy.Spectrum=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Spectroscopy.Spectrum",initialize:function(a){this.setPropStoreFieldValue("data",new Kekule.Spectroscopy.SpectrumData(null,null,this)),this.tryApplySuper("initialize",[a]),this._initDelegatedMethods()},doFinalize:function(){this.setPropStoreFieldValue("refMolecules",null);var a=this.getData();a&&a.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("spectrumType",{dataType:DataType.STRING}),this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("data",{dataType:"Kekule.Spectroscopy.SpectrumData",setter:function(a){var o=this.getData();a!==o&&(o&&o.finalize(),a&&a.setPropValue("parent",this,!0),this.setPropStoreFieldValue("data",a))}}),this.defineProp("refMolecules",{dataType:DataType.ARRAY,objRef:!0,autoUpdate:!0,setter:function(a){var o=a?DataType.isArrayValue(a)?e.clone(a):e.toArray(a):[];this.setPropStoreFieldValue("refMolecules",o)}}),this.defineProp("refMolecule",{dataType:"Kekule.Molecule",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return(this.getRefMolecules()||[])[0]},setter:function(a){this.setrRefMolecules(a)}}),this._defineInfoProperty("title"),this._defineInfoProperty("metaData",null,{dataType:DataType.HASH}),this._defineInfoProperty("conditions",null,{dataType:DataType.HASH}),this._defineInfoProperty("parameters",null,{dataType:DataType.HASH}),this._defineInfoProperty("annotations",null,{dataType:DataType.HASH}),this._defineDataDelegatedProperty("variables"),this._defineDataDelegatedProperty("varSymbols"),this._defineDataDelegatedProperty("dataSections","sections"),this._defineDataDelegatedProperty("activeDataSectionIndex","activeSectionIndex"),this._defineDataDelegatedProperty("activeDataSection","activeSection")},_initDelegatedMethods:function(){this._defineDataDelegatedMethod("isEmpty"),this._defineDataDelegatedMethod("createDataSection","createSection"),this._defineDataDelegatedMethod("clearDataSection","clearSection"),this._defineDataDelegatedMethod("getDataSectionCount","getSectionCount"),this._defineDataDelegatedMethod("getDataSectionAt","getSectionAt"),this._defineDataDelegatedMethod("indexOfDataSection","indexOfSection"),this._defineDataDelegatedMethod("hasDataSection","hasSection"),this._defineDataDelegatedMethod("removeDataSectionAt","removeSectionAt"),this._defineDataDelegatedMethod("removeDataSection","removeSection"),this._defineDataDelegatedMethod("insertDataSectionAt","insertSectionAt"),this._defineDataDelegatedMethod("insertDataSectionBefore","insertSectionBefore"),this._defineDataDelegatedMethod("appendDataSection","appendSection"),this._defineDataDelegatedMethod("iterateDataSection","iterateSection"),this._defineDataDelegatedMethod("sortData","sort"),this._defineDataDelegatedMethod("clearData"),this._defineDataDelegatedMethod("getVariableCount"),this._defineDataDelegatedMethod("getVariable"),this._defineDataDelegatedMethod("indexOfVariable"),this._defineDataDelegatedMethod("insertVariableAt"),this._defineDataDelegatedMethod("insertVariableBefore"),this._defineDataDelegatedMethod("appendVariable"),this._defineDataDelegatedMethod("removeVariableAt"),this._defineDataDelegatedMethod("removeVariable"),this._defineDataDelegatedMethod("getVariablesOfDependency"),this._defineDataDelegatedMethod("getContinuousVarRange"),this._defineDataDelegatedMethod("setContinuousVarRange"),this._defineDataDelegatedMethod("clearContinuousVarRange"),this._defineDataDelegatedMethod("getDefaultVarValue"),this._defineDataDelegatedMethod("setDefaultVarValue"),this._defineDataDelegatedMethod("clearDefaultVarValue")},_defineInfoProperty:function(a,o,l){var u,c,d;return d=(c=o||a).upperFirst(),u=Object.extend({getter:function(){return this.getInfoValue(c)||this.getInfoValue(d)},setter:function(h){this.setInfoValue(c,h)},serializable:!1},l),this.defineProp(a,u)},_defineDataDelegatedProperty:function(a,o){o||(o=a);var l=ClassEx.getPropInfo(Kekule.Spectroscopy.SpectrumData,o),u=Object.create(l);return u.getter=null,u.setter=null,u.serializable=!1,l.getter&&(u.getter=function(){return this.getData().getPropValue(o)}),l.setter&&(u.setter=function(c){this.getData().setPropValue(o,c)}),this.defineProp(a,u)},_defineDataDelegatedMethod:function(a,o){o||(o=a),ClassEx.getPrototype(this.getClass())[a]=function(){var l=this.getData(),u=l[o].apply(l,arguments);return u===l&&(u=this),u}},getAutoIdPrefix:function(){return"s"},ownerChanged:function(a,o){var l=this.getData();l&&l.setOwner(a),this.tryApplySuper("ownerChanged",[a,o])},isEmpty:function(){if(this.getDataSectionCount()<=0)return!0;for(var a=0,o=this.getDataSectionCount();a<o;++a)if(!this.getDataSectionAt(a).isEmpty())return!1;return!0},getChildSubgroupNames:function(){return["dataSection"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(a){return a instanceof Kekule.Spectroscopy.SpectrumDataSection?"dataSection":this.tryApplySuper("getBelongChildSubGroupName",[a])},doGetChildCount:function(){return this.getDataSectionCount()},doGetChildAt:function(a){return this.getDataSectionAt(a)},doIndexOfChild:function(a){return this.indexOfDataSection(a)},_getCandidateInfoPropNames:function(a){if(a.indexOf(n.DELIMITER)>=0)return[a];var o=n.getNamespaces(),l=this.getSpectrumType();l&&(o=[l].concat(o));for(var u=[a],c=0,d=o.length;c<d;++c)u.push(o[c]+n.DELIMITER+a);return u},_getSpectrumInfoValueOfCategory:function(a,o){var l=a?this.getInfoValue(a):this.getInfo();if(l){if(!Kekule.globalOptions.spectrum.spectrumInfo.enablePrefixOmissionInGetter)return l[o];for(var u=this._getCandidateInfoPropNames(o),c=0,d=u.length;c<d;++c){var h=u[c];if(l[h]!==void 0)return l[h]}}},setSpectrumInfoValue:function(a,o,l){if(a){var u=this.getInfoValue(a);u||(u={},this.setInfoValue(a,u)),u[o]=l}else this.setInfoValue(o,l);return this},getSpectrumInfoKeysOfCategory:function(a){if(a){var o=this.getInfoValue(a);return o?Kekule.ObjUtils.getOwnedFieldNames(o,!1):[]}if(a===""){var l=this.getInfoKeys();return l=e.exclude(l,this.getSpectrumInfoCategories())}return[]},getSpectrumInfoCategories:function(){for(var a=["metaData","conditions","parameters","annotations"],o=[],l=0,u=a.length;l<u;++l){var c=a[l],d=this.getSpectrumInfoKeysOfCategory(c);d&&d.length&&o.push(c)}return o},getSpectrumInfoValue:function(a,o){for(var l,u=0,c=(l=o?e.toArray(o):["conditions","parameters","metaData","annotations",""]).length;u<c;++u){var d=l[u],h=this._getSpectrumInfoValueOfCategory(d,a);if(Kekule.ObjUtils.notUnset(h))return h}},getMeta:function(a){return this._getSpectrumInfoValueOfCategory("metaData",a)},setMeta:function(a,o){return this.setSpectrumInfoValue("metaData",a,o),this},getMetaKeys:function(){return this.getSpectrumInfoKeysOfCategory("metaData")},getCondition:function(a){return this._getSpectrumInfoValueOfCategory("conditions",a)},setCondition:function(a,o){return this.setSpectrumInfoValue("conditions",a,o),this},getConditionKeys:function(){return this.getSpectrumInfoKeysOfCategory("conditions")},getParameter:function(a){return this._getSpectrumInfoValueOfCategory("parameters",a)},setParameter:function(a,o){return this.setSpectrumInfoValue("parameters",a,o),this},getParameterKeys:function(){return this.getSpectrumInfoKeysOfCategory("parameters")},getAnnotation:function(a){return this._getSpectrumInfoValueOfCategory("annotations",a)},setAnnotation:function(a,o){return this.setSpectrumInfoValue("annotations",a,o),this},getAnnotationKeys:function(){return this.getSpectrumInfoKeysOfCategory("annotations")},getVarAvailableExternalUnitObjs:function(a){return Kekule.Spectroscopy.DataValueConverterManager.getAltUnits(a,a.getInternalUnit?a.getInternalUnit():a.getUnit(),null,this)},getVarAvailableExternalUnitSymbols:function(a){for(var o=Kekule.Spectroscopy.DataValueConverterManager.getAltUnits(a,a.getInternalUnit?a.getInternalUnit():a.getUnit(),null,this),l=[],u=0,c=o.length;u<c;++u)l.push(o[u].symbol);return l},getComparisonPropNames:function(a){var o=this.tryApplySuper("getComparisonPropNames",[a]),l=o.indexOf("data");return l>=0&&o.splice(l,1),o},doGetComparisonPropNames:function(a){var o=this.tryApplySuper("doGetComparisonPropNames",[a]);return a.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(o=(o||[]).concat(["refMolecules","metaData","conditions","parameters","dataSections"])),o},doCompareProperty:function(a,o,l){if(o==="dataSections"&&l.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var u=this.getDataSections().getItems(),c=a.getDataSections().getItems();return this.doCompareOnValue(u,c,l)}if(["metaData","conditions","parameters"].indexOf(o)>=0){for(var d=["metaData","conditions","parameters","annotations"],h=this.getSpectrumInfoKeysOfCategory(o),p=0,g=h.length;p<g;++p){var f=h[p],m=this.getSpectrumInfoValue(f,[o]),C=a.getSpectrumInfoValue(f,d);if(Kekule.ObjUtils.isUnset(C)){var _=n.getPropertyCoreName(f);C=a.getSpectrumInfoValue(_,d)}if(y=this.doCompareOnValue(m,C,l))return y}return 0}var y;return m=this.getPropValue(o),C=a.getPropValue(o),y=this.doCompareOnValue(m,C,l)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.Spectroscopy.Spectrum),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.Spectroscopy.Spectrum),(i=Kekule.Unit.register)("transmittance","transmittance","OpticalTransmittance",1),i("transmittance%","transmittance_percent","OpticalTransmittance",.01),i("reflectance","reflectance","OpticalReflectance",1),i("absorbance","absorbance","OpticalAbsorbance",1),i("Kubelka Munk","Kubelka_Munk","OpticalKubelkaMunk",1),i("counts","ms_count","Misc",null),i("relative abundance","ms_relative_abundance","SpectrumMS",null),i("m/z","ms_mass_charge_ratio","SpectrumMS",null)}(),function(){var s=Kekule.ArrayUtils;Kekule.globalOptions.add("IO.jcamp",{enableXYDataValueCheck:!0,dataValueCheckAllowedErrorRatio:.001,maxCharsPerLine:80}),Kekule.IO.Jcamp={};var e=Kekule.IO.Jcamp;Kekule.IO.Jcamp.Consts={DATA_LABEL_FLAG:"##",DATA_LABEL_TERMINATOR:"=",PRIVATE_LABEL_PREFIX:"$",SPECIFIC_LABEL_PREFIX:".",LABEL_BLOCK_BEGIN:"TITLE",LABEL_BLOCK_END:"END",LABEL_DATA_TYPE:"DATATYPE",LABEL_BLOCK_COUNT:"BLOCKS",LABEL_BLOCK_ID:"BLOCKID",LABEL_CROSS_REF:"CROSSREFERENCE",INLINE_COMMENT_FLAG:"$$",TABLE_LINE_CONTI_MARK:"=",UNKNOWN_VALUE:NaN,LABEL_DX_VERSION:"JCAMPDX",LABEL_CS_VERSION:"JCAMPCS",DATA_FORMAT_GROUP_LEADING:"(",DATA_FORMAT_GROUP_TAILING:")",DATA_FORMAT_LOOP:"..",DATA_FORMAT_INC:"++",DATA_FORMAT_SYMBOL_ASSIGNMENT:"A",DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER:",",SIMPLE_VALUE_DELIMITER:",",CROSS_REF_TYPE_TERMINATOR:":",DATA_VARLIST_FORMAT_XYDATA:1,DATA_VARLIST_FORMAT_XYPOINTS:2,DATA_VARLIST_FORMAT_XYWPOINTS:2,DATA_VARLIST_FORMAT_VAR_GROUPS:5,GROUPED_VALUE_GROUP_DELIMITER:`
`,GROUPED_VALUE_GROUP_DELIMITER_PATTERN:/[;\s+]/g,GROUPED_VALUE_ITEM_DELIMITER:",",GROUPED_VALUE_ITEM_DELIMITER_PATTERN:/,/g,GROUPED_VALUE_STR_ENCLOSER_LEADING:"<",GROUPED_VALUE_STR_ENCLOSER_TAILING:">",GROUPED_VALUE_EXPLICIT_GROUP_LEADING:"(",GROUPED_VALUE_EXPLICIT_GROUP_TAILING:")",NTUPLE_DEFINITION_ITEM_DELIMITER:",	",VALUE_STR_EXPLICIT_QUOTE:'"',VALUE_ABNORMAL_NUM:"?",MOL_FORMULA_SUP_PREFIX:"^",MOL_FORMULA_SUB_PREFIX:"/"};var t=Kekule.IO.Jcamp.Consts;Kekule.IO.Jcamp.Format={DX:"dx",CS:"cs"},Kekule.IO.Jcamp.BlockType={DATA:0,LINK:1},Kekule.IO.Jcamp.CrossRefType={SPECTRUM:1,STRUCTURE:2,UNKNOWN:0},Kekule.IO.Jcamp.AsdfForm={AFFN:1,PAC:2,SQZ:3,DIF:4,SQZ_DUP:13,DIF_DUP:14},Kekule.IO.Jcamp.DigitCharType={ASCII:1,PAC:2,SQZ:3,DIF:4,DUP:5,_DECIMAL_POINT:9,_ABNORMAL_VALUE:19};var n=Kekule.IO.Jcamp.DigitCharType;Kekule.IO.Jcamp.Labels={_maps:[],getMaps:function(){return i._maps},addMaps:function(g){s.pushUnique(i._maps,g,!0)}};var i=Kekule.IO.Jcamp.Labels;Kekule.IO.Jcamp.Utils={compareFloat:function(g,f,m){return Kekule.ObjUtils.isUnset(m)&&(m=.01*Math.max(Math.abs(g),Math.abs(f))),Kekule.NumUtils.compareFloat(g,f,m)},calcNumFactorForRange:function(g,f,m,C,_){if(Kekule.NumUtils.isFloatEqual(g,f)&&Kekule.ObjUtils.notUnset(C)&&Kekule.ObjUtils.notUnset(_)&&g>C&&f<_)return 1;var y=1,T=Math.abs(f-g)||Math.max(Math.abs(f),Math.abs(g));if(m&&(y=T*m),Kekule.ObjUtils.notUnset(C)&&Kekule.ObjUtils.notUnset(_)&&g/y>C&&f/y<_){var E=Math.max(g/C,0),b=Math.max(f/_,0),v=E?b?Math.max(E,b):E:b;v&&(y=Math.min(y,v))}return y},standardizeLdrLabelName:function(g){return g.replace(/[\/\\\-\_\s]/g,"").toUpperCase()},ldrLabelNameEqual:function(g,f){return r.standardizeLdrLabelName(g)===r.standardizeLdrLabelName(f)},analysisLdrLabelName:function(g,f){var m;if(m=g.startsWith(t.SPECIFIC_LABEL_PREFIX)?{coreName:r.standardizeLdrLabelName(g.substr(t.SPECIFIC_LABEL_PREFIX.length)),labelType:l.SPECIFIC,labelCategory:u.ANNOTATION}:g.startsWith(t.PRIVATE_LABEL_PREFIX)?{coreName:r.standardizeLdrLabelName(g.substr(t.PRIVATE_LABEL_PREFIX.length)),labelType:l.PRIVATE,labelCategory:u.ANNOTATION}:{coreName:g,labelType:l.GLOBAL,labelCategory:u.META},f===void 0||f){var C=c.getInfo(m.coreName,m.labelType);C&&(m.dataType=C.dataType,m.labelCategory=C.labelCategory)}return m},jcampLabelNameToKekule:function(g,f){var m=Kekule.Spectroscopy.MetaPropNamespace,C=r.standardizeLdrLabelName(g);if(C.startsWith(t.PRIVATE_LABEL_PREFIX)){var _=C.substr(t.PRIVATE_LABEL_PREFIX.length);return m.createPropertyName(m.CUSTOM,_)}for(var y,T=i.getMaps(),E=0,b=T.length;E<b;++E){var v=T[E];if(C===v[0]){var I=v[1],R=m.getPropertyNameDetail(I);if(!f||!R.namespace||R.namespace===m.CUSTOM||f===R.namespace)return I;y=I}}return y||(C.startsWith(t.SPECIFIC_LABEL_PREFIX)?(_=C.substr(t.SPECIFIC_LABEL_PREFIX.length),m.createPropertyName(f,_)):m.createPropertyName("jcamp",C))},kekuleLabelNameToJcamp:function(g,f,m){for(var C=Kekule.Spectroscopy.MetaPropNamespace,_=i.getMaps(),y=0,T=_.length;y<T;++y){var E=_[y];if(g===E[1])return E[0]}if(m)return null;var b=C.getPropertyNameDetail(g);return t.PRIVATE_LABEL_PREFIX+b.coreName.toUpperCase()},getCrossReferenceDetail:function(g){var f,m=g.split(t.CROSS_REF_TYPE_TERMINATOR),C=m[0].trim(),_=C.toUpperCase()==="STRUCTURE"?e.CrossRefType.STRUCTURE:e.CrossRefType.SPECTRUM,y=m[1]&&m[1].trim();return y&&y.toUpperCase().indexOf("BLOCK")>=0&&(f=y.split(t.DATA_LABEL_TERMINATOR)[1])&&(f=f.trim()),{refType:_,refTypeText:C,blockId:f}},addMoleculeSpectrumCrossRef:function(g,f){var m=g.getRefMolecules()||[];m.indexOf(f)<0&&(m.push(f),g.setRefMolecules(m))},getFirstNonemptyLine:function(g){var f,m=0;do f=(g[m]||"").trim(),++m;while(!f&&m<g.length);return f||""},getAsdfDigitInfo:function(g){var f={};return g===t.VALUE_ABNORMAL_NUM?(f.digitType=n._ABNORMAL_VALUE,f.value=null,f.sign=1):g==="."?(f.digitType=n._DECIMAL_POINT,f.value=0,f.sign=1):g>="0"&&g<="9"?(f.digitType=n.ASCII,f.value=g.charCodeAt(0)-48,f.sign=1):g==="+"?(f.digitType=n.PAC,f.value=0,f.sign=1):g==="-"?(f.digitType=n.PAC,f.value=0,f.sign=-1):g==="@"?(f.digitType=n.SQZ,f.value=0,f.sign=1):g>="A"&&g<="I"?(f.digitType=n.SQZ,f.value=g.charCodeAt(0)-65+1,f.sign=1):g>="a"&&g<="i"?(f.digitType=n.SQZ,f.value=g.charCodeAt(0)-97+1,f.sign=-1):g==="%"?(f.digitType=n.DIF,f.value=0,f.sign=1):g>="J"&&g<="R"?(f.digitType=n.DIF,f.value=g.charCodeAt(0)-74+1,f.sign=1):g>="j"&&g<="r"?(f.digitType=n.DIF,f.value=g.charCodeAt(0)-106+1,f.sign=-1):g>="S"&&g<="Z"?(f.digitType=n.DUP,f.value=g.charCodeAt(0)-83+1,f.sign=1):g==="s"?(f.digitType=n.DUP,f.value=9,f.sign=1):(f.digitType=null,f.value=null),f},_calcAsdfNumber:function(g){for(var f,m=1,C=0,_=1,y=0,T=g.length-1;T>=0;--T){var E=g[T];if(E.digitType===n._DECIMAL_POINT){if(_=m,++y>1)return null}else C+=E.value*m,m*=10,f=E.digitType}return{value:C*=g[0].sign/_,digitType:f}},_pushAsdfNumberToSeq:function(g,f,m){var C={seq:g,lastValueType:f.digitType};if(f.digitType===n._ABNORMAL_VALUE)g.push(t.UNKNOWN_VALUE);else if(f.digitType===n.ASCII||f.digitType===n.PAC||f.digitType===n.SQZ)g.push(f.value);else{if(!g.length)return!1;var _=g[g.length-1];if(f.digitType===n.DIF)g.push(_+f.value);else{if(f.digitType!==n.DUP||m.digitType===n.PAC||m.digitType===n.DUP||!m.digitType)return!1;for(var y=1;y<f.value;++y)C=r._pushAsdfNumberToSeq(g,m,null);m&&(C.lastValueType=m.digitType)}}return C},decodeAsdfLine:function(g){for(var f=[],m=[],C=null,_=function(b,v,I){if(v.length){var R,N=r._calcAsdfNumber(v);return N&&(R=r._pushAsdfNumberToSeq(b,N,I)),N&&R||Kekule.error(Kekule.$L("ErrorMsg.JCAMP_ASDF_FORMAT_ERROR_WITH_STR").format(g)),b.__$lastValueType__=R.lastValueType,N}},y=0,T=g.length;y<T;++y){var E=r.getAsdfDigitInfo(g.charAt(y));E.digitType?E.digitType===n._ABNORMAL_VALUE?(C=_(f,m,C),_(f,[E],null),m=[]):E.digitType===n._DECIMAL_POINT||E.digitType===n.ASCII?m.push(E):(C=_(f,m,C),m=[E]):(C=_(f,m,C),m=[])}return C=_(f,m,C),f},encodeAsdfLine:function(g,f){var m=Kekule.IO.Jcamp.AsdfForm;return f===m.AFFN?r._encodeNumbersToAffnLine(g):f===m.PAC?r._encodeNumbersToPacLine(g):f===m.SQZ?r._encodeNumbersToSqzLine(g,!1):f===m.SQZ_DUP?r._encodeNumbersToSqzLine(g,!0):f===m.DIF?r._encodeNumbersToDifLine(g,!1):(m.DIF_DUP,r._encodeNumbersToDifLine(g,!0))},_encodeNumbersToAffnLine:function(g){for(var f=[],m=0,C=g.length;m<C;++m){var _=g[m],y=Kekule.NumUtils.isNormalNumber(_)?_.toString():t.VALUE_ABNORMAL_NUM;f.push(y)}return f.join(" ")},_encodeNumbersToPacLine:function(g){for(var f=[],m=0,C=g.length;m<C;++m){var _,y=g[m];Kekule.NumUtils.isNormalNumber(y)?_=(y>=0?"+":"-")+Math.abs(y).toString():_=t.VALUE_ABNORMAL_NUM,f.push(_)}return f.join("")},_encodeNumbersToSqzLine:function(g,f){return r._numSeqToCompressedFormString(g,"A","a","@",f)},_encodeNumbersToDifLine:function(g,f){var m=[],C={seq:[]};m.push(C);for(var _,y=0,T=g.length;y<T;++y){var E=g[y];_=E,Kekule.NumUtils.isNormalNumber(_)?(Kekule.ObjUtils.isUnset(C.head)?C.head=_:C.seq.push(_-C.last),C.last=_):(Kekule.ObjUtils.isUnset(C.head)?C.head=_:C.seq.push(_),C={seq:[]},m.push(C))}var b=[];for(y=0,T=m.length;y<T;++y){var v=m[y];Kekule.ObjUtils.notUnset(v.head)&&(b.push(r._encodeNumbersToSqzLine([v.head])),v.seq.length&&b.push(r._numSeqToCompressedFormString(v.seq,"J","j","%",f)))}return b.join("")},_numToCompressedFormString:function(g,f,m,C){if(!Kekule.NumUtils.isNormalNumber(g))return t.VALUE_ABNORMAL_NUM;if(g===0)return C;var _=Math.abs(g).toString(),y=Kekule.NumUtils.getHeadingDigit(g);return _=(g>0?String.fromCharCode(f.charCodeAt(0)+(y-1)):String.fromCharCode(m.charCodeAt(0)+(y-1)))+_.substr(1)},_numSeqToCompressedFormString:function(g,f,m,C,_){for(var y,T=[],E=0,b=["S","T","U","V","W","X","Y","Z","s"],v=0,I=g.length;v<I;++v){var R=!1,N=g[v];if(_&&(N===y?(++E,R=!0):E&&(T.push(b[E]),E=0)),!R){var L=r._numToCompressedFormString(N,f,m,C);T.push(L)}y=N}return _&&E&&T.push(b[E]),T.join("")},decodeAsdfTableLines:function(g,f){for(var m,C=f||{},_=[],y=[],T=!1,E=!1,b=g.length,v=function(M,B,V,J,$,q){if($){var Q=M[M.length-1];if(Q&&Q.length)if(J){var ie=Q[Q.length-1],Y=B[1];typeof ie=="number"&&Kekule.ObjUtils.notUnset(ie)&&typeof Y=="number"&&Kekule.ObjUtils.notUnset(Y)&&(Kekule.NumUtils.isFloatEqual(ie,Y)?Q.pop():Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_Y_VALUE_CHECK_ERROR")))}else Q.pop()}V&&I(B,M[M.length-1],q),M.push(B)},I=function(M,B,V){if(M&&B){var J=(M[0]-B[0])/(B.length-1);if(m){var $=Math.min(Math.abs(J),Math.abs(m))*(V||1)*(Kekule.globalOptions.IO.jcamp.dataValueCheckAllowedErrorRatio||1e-4);r.compareFloat(J,m,$)!==0&&(console.log("X check error",J,m,$),Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_X_VALUE_CHECK_ERROR")))}else m=J}return!0},R=0,N=g.length;R<N;++R){var L=g[R].trim();if(L){var U=L.endsWith(t.TABLE_LINE_CONTI_MARK);U&&(L=L.substr(0,L.length-t.TABLE_LINE_CONTI_MARK.length));var W=r.decodeAsdfLine(L);y=T?y.concat(W):W,(T=U)||(v(_,y,C.doValueCheck,C.doValueCheck&&E,E,b),y=[]),E=W.__$lastValueType__===n.DIF}}return y.length&&v(_,y,C.doValueCheck,C.doValueCheck&&E,E,b),_},encodeAsdfTableLines:function(g,f,m){for(var C=m||{},_=[],y=0,T=g.length;y<T;++y){var E,b=g[y],v="";b.length&&(C.abscissaFirst?(v+=r._encodeNumbersToAffnLine([b[0]])+" ",E=b.slice(1)):E=b,v+=r.encodeAsdfLine(E,f)),_.push(v)}return _},decodeAffnGroupLine:function(g){var f=1,m=2,C=3,_=11,y=12,T=21,E=22,b=30,v=g.trim();v.startsWith(t.GROUPED_VALUE_EXPLICIT_GROUP_LEADING)&&v.endsWith(t.GROUPED_VALUE_EXPLICIT_GROUP_TAILING)&&(v=v.substr(t.GROUPED_VALUE_EXPLICIT_GROUP_LEADING.length,v.length-t.GROUPED_VALUE_EXPLICIT_GROUP_LEADING.length-t.GROUPED_VALUE_EXPLICIT_GROUP_TAILING.length));for(var I={tokenType:null,text:""},R=[],N=[],L=function(q){var Q,ie,Y;return(q||I.text)&&(ie=I.text,Y=I.tokenType,Q=ie?Y===f?parseFloat(ie):ie:void 0,N.push(Q)),I.tokenType=null,I.text="",Q},U=function(){N.length&&R.push(N),N=[]},W=function(q,Q,ie){return Q?q.match(t.GROUPED_VALUE_STR_ENCLOSER_TAILING)?y:m:q>="0"&&q<="9"||q==="."?f:q.match(/\s/)?b:q.match(t.GROUPED_VALUE_STR_ENCLOSER_LEADING)?_:q.match(t.GROUPED_VALUE_STR_ENCLOSER_TAILING)?y:q.match(t.GROUPED_VALUE_GROUP_DELIMITER_PATTERN)?ie?T:E:q.match(t.GROUPED_VALUE_ITEM_DELIMITER_PATTERN)?T:m},M=!1,B=0,V=v.length;B<V;++B){var J=v.charAt(B),$=W(J,I.tokenType===C);$===b&&I.tokenType===C&&(I.text+=J,$=I.tokenType),$<_?(M&&I.text&&(L(),U()),I.tokenType?I.tokenType=Math.max(I.tokenType,$):I.tokenType=$,I.text+=J):$<T?$===_?(M&&I.text?(L(),U()):L(),I.tokenType=C):I.tokenType=m:$===T?L(!0):$===E&&(L(!0),U()),M=$===b}return L(),U(),R},encodeAffnGroupLine:function(g,f){for(var m=[],C=0,_=g.length;C<_;++C){var y,T=g[C];y=typeof T=="number"?Kekule.NumUtils.isNormalNumber(T)?T.toString():t.VALUE_ABNORMAL_NUM:t.GROUPED_VALUE_STR_ENCLOSER_LEADING+T.toString()+t.GROUPED_VALUE_STR_ENCLOSER_TAILING,m.push(y)}return m.join(t.GROUPED_VALUE_ITEM_DELIMITER)},decodeAffnGroupTableLines:function(g,f){for(var m=[],C=0,_=g.length;C<_;++C){var y=g[C];m=m.concat(r.decodeAffnGroupLine(y))}return m},encodeAffnGroupTableLines:function(g,f){for(var m=[],C=0,_=g.length;C<_;++C){var y=g[C],T=r.encodeAffnGroupLine(y,f);f&&f.explicitlyEnclosed&&(T=t.GROUPED_VALUE_EXPLICIT_GROUP_LEADING+T+t.GROUPED_VALUE_EXPLICIT_GROUP_TAILING),m.push(T)}return m},getDataTableFormatDetails:function(g){if(g.startsWith(t.DATA_FORMAT_GROUP_LEADING)||g.endsWith(t.DATA_FORMAT_GROUP_TAILING)){var f=g.substr(t.DATA_FORMAT_GROUP_LEADING.length,g.length-t.DATA_FORMAT_GROUP_LEADING.length-t.DATA_FORMAT_GROUP_TAILING.length);if(y=(f=f.replace(/\s/g,"")).match(/^([a-zA-Z])\+\+\(([a-zA-Z])\.\.([a-zA-Z])\)$/))return y[2]!==y[3]?Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",g)):{format:t.DATA_VARLIST_FORMAT_XYDATA,varInc:y[1],varLoop:y[2],vars:[y[1],y[2]]};if(y=f.match(/^([a-zA-Z]+)\s*\.\.\s*([a-zA-Z]+)$/)){if(y[1]!==y[2])return Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",g));for(var m=[],C=0,_=y[1].length;C<_;++C)y[1].charAt(C).match(/\s/)||m.push(y[1].charAt(C));return m.length<=2?{format:t.DATA_VARLIST_FORMAT_XYPOINTS,vars:m}:{format:t.DATA_VARLIST_FORMAT_XYWPOINTS,vars:m}}var y;if(y=f.match(/^(([a-zA-Z]\,?)+)$/)){for(m=[],C=0,_=y[1].length;C<_;++C)y[1].charAt(C)!==","&&m.push(y[1].charAt(C));return{format:t.DATA_VARLIST_FORMAT_VAR_GROUPS,vars:m}}return Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_UNSUPPORTED",g))}return Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",g))},generateDataTableFormatDescriptor:function(g,f){if(g===t.DATA_VARLIST_FORMAT_XYDATA)return(t.DATA_FORMAT_GROUP_LEADING+"{0}++"+t.DATA_FORMAT_GROUP_LEADING+"{1}"+t.DATA_FORMAT_LOOP+"{1}"+t.DATA_FORMAT_GROUP_TAILING+t.DATA_FORMAT_GROUP_TAILING).format(f[0],f[1]);if(g===t.DATA_VARLIST_FORMAT_XYPOINTS||g===t.DATA_VARLIST_FORMAT_XYWPOINTS){for(var m=[],C=0,_=f.length;C<_;++C)m.push("{"+C+"}");var y=m.join(""),T=t.DATA_FORMAT_GROUP_LEADING+y+t.DATA_FORMAT_LOOP+y+t.DATA_FORMAT_GROUP_TAILING;return T.format.apply(T,f)}return g===t.DATA_VARLIST_FORMAT_VAR_GROUPS?t.DATA_FORMAT_GROUP_LEADING+f.join("")+t.DATA_FORMAT_GROUP_TAILING:""},getDataTableFormatAndPlotDetails:function(g){var f=g.indexOf(t.DATA_FORMAT_GROUP_LEADING),m=g.lastIndexOf(t.DATA_FORMAT_GROUP_TAILING);if(f>=0&&m>=0){var C=g.substring(f,m+1),_=r.getDataTableFormatDetails(C),y=g.substr(m+1).trim();return y.indexOf(t.DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER)>=0&&(y=y.substr(t.DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER.length),_.plotDescriptor=y),_}Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR",g))},generateDataTableFormatAndPlotDescriptors:function(g,f){var m,C=r.generateDataTableFormatDescriptor(g,f);return g===t.DATA_VARLIST_FORMAT_XYDATA?m="XYDATA":g===t.DATA_VARLIST_FORMAT_XYPOINTS?m="XYPOINTS":g===t.DATA_VARLIST_FORMAT_VAR_GROUPS&&(m=f.length<=2?"PEAK TABLE":"PEAK ASSIGNMENTS"),{format:C,plot:m}},generateDataTableFormatAndPlotString:function(g,f){var m=r.generateDataTableFormatAndPlotDescriptors(g,f);return m.format+t.DATA_FORMAT_PLOT_DESCRIPTOR_DELIMITER+m.plot}};var r=Kekule.IO.Jcamp.Utils;Kekule.IO.Jcamp.BlockUtils={createBlock:function(g){return{blocks:[],ldrs:[],ldrIndexes:{},_parent:g}},setBlockParent:function(g,f){return g._parent=f,g},getLabelIndex:function(g,f){return f.ldrIndexes[g]||-1},getLdrAt:function(g,f){return f.ldrs[g]},addLdrToBlock:function(g,f){g.ldrs.push(f),g.ldrIndexes[f.labelName]=g.ldrs.length-1},getNestedBlockLevelCount:function(g){var f=1,m=g.blocks;if(m&&m.length){for(var C=0,_=0,y=m.length;_<y;++_){var T=a.getNestedBlockLevelCount(m[_]);T>C&&(C=T)}f+=C}return f},getBlockLdr:function(g,f){var m=g.ldrIndexes[f];return m>=0?g.ldrs[m]:null},getBlockMeta:function(g){var f=g.meta;return f||(f={blockType:g.blocks.length?e.BlockType.LINK:e.BlockType.DATA,format:g.ldrIndexes[t.LABEL_DX_VERSION]?e.Format.DX:g.ldrIndexes[t.LABEL_CS_VERSION]?e.Format.CS:null},g.meta=f),f}};var a=Kekule.IO.Jcamp.BlockUtils;Kekule.IO.Jcamp.ValueType={AFFN:1,ASDF:2,AFFN_ASDF:3,MULTILINE_AFFN_ASDF:5,MULTILINE_AFFN_GROUP:6,SIMPLE_AFFN_GROUP:7,STRING_GROUP:8,DATA_TABLE:9,STRING:10,SHORT_DATE:21,SHORT_TIME:22,DATETIME:23,NONE:0};var o=Kekule.IO.Jcamp.ValueType;Kekule.IO.Jcamp.LabelType={GLOBAL:0,SPECIFIC:1,PRIVATE:2};var l=Kekule.IO.Jcamp.LabelType;Kekule.IO.Jcamp.LabelCategory={GLOBAL:"global",META:"meta",PARAMTER:"parameter",CONDITION:"condition",ANNOTATION:"annotation"};var u=Kekule.IO.Jcamp.LabelCategory;Kekule.IO.Jcamp.LabelTypeInfos={_DEFAULT_TYPE:o.STRING},Kekule.IO.Jcamp.LabelTypeInfos.createInfo=function(g,f,m,C,_){var y=r.standardizeLdrLabelName(g),T=_?l.SPECIFIC:l.GLOBAL;m||(m=T),C||(C=m===l.GLOBAL?u.META:u.ANNOTATION),m!==l.SPECIFIC||y.startsWith(t.SPECIFIC_LABEL_PREFIX)?m!==l.PRIVATE||y.startsWith(t.PRIVATE_LABEL_PREFIX)||(y=t.PRIVATE_LABEL_PREFIX+y):y=t.SPECIFIC_LABEL_PREFIX+y;var E={labelName:y,labelType:m,labelCategory:C,dataType:f};return _&&(E.specificType=_),Kekule.IO.Jcamp.LabelTypeInfos[y]=E,E},Kekule.IO.Jcamp.LabelTypeInfos.createInfos=function(g){for(var f=0,m=g.length;f<m;++f){var C=g[f];Kekule.IO.Jcamp.LabelTypeInfos.createInfo.apply(null,C)}},Kekule.IO.Jcamp.LabelTypeInfos.getType=function(g){var f=c[g];return f&&f.dataType||c._DEFAULT_TYPE},Kekule.IO.Jcamp.LabelTypeInfos.getCategory=function(g){var f=c[g];return f&&f.labelCategory||u.ANNOTATION},Kekule.IO.Jcamp.LabelTypeInfos.getInfo=function(g,f){var m=c[g];return m&&f&&m.labelType!==f?null:m};var c=Kekule.IO.Jcamp.LabelTypeInfos;(0,Kekule.IO.Jcamp.LabelTypeInfos.createInfos)([["TITLE",o.STRING,null,u.GLOBAL],["JCAMPDX",o.STRING,null,u.ANNOTATION],["JCAMPCX",o.STRING,null,u.ANNOTATION],["DATA TYPE",o.STRING],["BLOCKS",o.AFFN],["END",o.NONE],["XUNITS",o.STRING],["YUNITS",o.STRING],["XLABEL",o.STRING],["YLABEL",o.STRING],["FIRSTX",o.AFFN],["LASTX",o.AFFN],["FIRSTY",o.AFFN],["MAXX",o.AFFN],["MINX",o.AFFN],["MAXY",o.AFFN],["MINY",o.AFFN],["DELTAX",o.AFFN],["XFACTOR",o.AFFN],["YFACTOR",o.AFFN],["NPOINTS",o.AFFN],["RESOLUTION",o.STRING,null,u.PARAMTER],["XYDATA",o.MULTILINE_AFFN_ASDF],["XYPOINTS",o.MULTILINE_AFFN_GROUP],["PEAK TABLE",o.MULTILINE_AFFN_GROUP],["PEAK ASSIGNMENTS",o.MULTILINE_AFFN_GROUP],["CLASS",o.STRING],["ORIGIN",o.STRING],["OWNER",o.STRING],["DATE",o.SHORT_DATE,null,u.GLOBAL],["TIME",o.SHORT_TIME,null,u.GLOBAL],["LONGDATE",o.DATETIME,null,u.GLOBAL],["SOURCE REFERENCE",o.STRING],["CROSS REFERENCE",o.STRING],["SAMPLE DESCRIPTION",o.STRING],["CAS NAME",o.STRING],["NAMES",o.STRING],["MOLFORM",o.STRING],["CAS REGISTRY NO",o.STRING],["WISWESSER",o.STRING],["BEILSTEIN LAWSON NO",o.STRING],["REFRACTIVE INDEX",o.AFFN],["DENSITY",o.AFFN],["MW",o.AFFN],["MP",o.AFFN],["BP",o.AFFN],["CONCENTRATIONS",o.STRING],["SPECTROMETER/DATA SYSTEM",o.STRING],["INSTRUMENTAL PARAMETERS",o.STRING],["SAMPLING PROCEDURE",o.STRING],["STATE",o.STRING],["PATH LENGTH",o.STRING],["PRESSURE",o.STRING],["TEMPERATURE",o.STRING],["DATA PROCESSING",o.STRING],["RUNITS",o.STRING],["AUNITS",o.STRING],["FIRSTR",o.AFFN],["LASTR",o.AFFN],["FIRSTA",o.AFFN],["MAXA",o.AFFN],["MINA",o.AFFN],["DELTAR",o.AFFN],["RFACTOR",o.AFFN],["AFACTOR",o.AFFN],["ALIAS",o.AFFN],["ZPD",o.AFFN],["RADATA",o.MULTILINE_AFFN_ASDF],["APPLICATION",o.STRING],["DATACLASS",o.STRING],["DICTIONARY",o.STRING],["BLOCKID",o.STRING],["INDEX",o.STRING],["SMILES",o.STRING],["NTUPLES",o.STRING],["VAR_NAME",o.STRING_GROUP],["SYMBOL",o.STRING_GROUP],["VAR_TYPE",o.STRING_GROUP],["VAR_FORM",o.STRING_GROUP],["VAR_DIM",o.SIMPLE_AFFN_GROUP],["UNITS",o.STRING_GROUP],["FIRST",o.SIMPLE_AFFN_GROUP],["LAST",o.SIMPLE_AFFN_GROUP],["MIN",o.SIMPLE_AFFN_GROUP],["MAX",o.SIMPLE_AFFN_GROUP],["FACTOR",o.SIMPLE_AFFN_GROUP],["END NTUPLES",o.STRING],["PAGE",o.STRING],["DATA TABLE",o.DATA_TABLE]]),Kekule.IO.Jcamp.LdrValueParserCoder={_parserFuncs:{byLabelName:{},byDataType:{}},_coderFuncs:{byLabelName:{},byDataType:{}},registerParser:function(g,f,m){g?d._parserFuncs.byLabelName[r.standardizeLdrLabelName(g)]=m:f&&(d._parserFuncs.byDataType[f]=m)},getParserFunc:function(g){var f=e.Utils.standardizeLdrLabelName(g.labelName),m=d._parserFuncs.byLabelName[f];if(!m){var C=c.getType(f);m=d._parserFuncs.byDataType[C]}return m||(m=d._parserFuncs._default),m},registerCoder:function(g,f,m){g?d._coderFuncs.byLabelName[r.standardizeLdrLabelName(g)]=m:f&&(d._coderFuncs.byDataType[f]=m)},getCoderFunc:function(g){var f=e.Utils.standardizeLdrLabelName(g),m=d._coderFuncs.byLabelName[f];if(!m){var C=c.getType(f);m=d._coderFuncs.byDataType[C]}return m||(m=d._coderFuncs._default),m},parseValue:function(g,f){return d.getParserFunc(g)(g.valueLines,f)},encodeValue:function(g,f,m){var C=d.getCoderFunc(g)(f,m);return Kekule.ArrayUtils.toArray(C)},stringParser:function(g,f){return g.join(`
`)},stringCoder:function(g,f){return g.toString().split(`
`)},affnParser:function(g,f){var m=r.getFirstNonemptyLine(g),C=parseFloat(m);return Kekule.NumUtils.isNormalNumber(C)?C:NaN},affnCoder:function(g,f){return Kekule.NumUtils.isNormalNumber(g)?g.toString():t.VALUE_ABNORMAL_NUM},asdfParser:function(g,f){var m=r.getFirstNonemptyLine(g),C=r.decodeAsdfLine(m);return C&&C[0]},asdfCoder:function(g,f){Kekule.error("not implemented yet")},shortDateParser:function(g,f){var m=r.getFirstNonemptyLine(g).split("/");return{year:parseInt(m[0])||0,month:parseInt(m[1])||0,day:parseInt(m[2])||0}},shortTimeParser:function(g,f){var m=r.getFirstNonemptyLine(g).split(":");return{hour:parseInt(m[0])||0,minute:parseInt(m[1])||0,second:parseInt(m[2])||0}},longDateParser:function(g,f){var m=0,C=0,_=0,y=null,T=null,E=null,b=null,v=r.getFirstNonemptyLine(g).split(/\s+/g),I=/(\d+)\/(\d+)\/(\d+)/,R=(v[0]||"").match(I);R&&(m=parseInt(R[1])||0,C=parseInt(R[2])||0,_=parseInt(R[3])||0);var N=(v[1]||"").trim();return N&&(I=/(\d+)\:(\d+)\:(\d+)(\.(\d+))?/,(R=N.match(I))&&(y=parseInt(R[1]),T=parseInt(R[2]),E=parseInt(R[3]),b=parseInt(R[5])||null)),new Date(m,C-1,_,y,T,E,b)},longDateCoder:function(g,f){var m=g.getFullYear(),C=g.getMonth()+1,_=g.getDate(),y=g.getHours(),T=g.getMinutes(),E=g.getSeconds(),b=g.getMilliseconds(),v=[m.toString().lpad(4,"0"),C.toString().lpad(2,"0"),_.toString().lpad(2,"0")].join("/")+" "+[y.toString().lpad(2,"0"),T.toString().lpad(2,"0"),E.toString().lpad(2,"0")].join(":");return b&&(v+="."+b.toString().lpad(4,"0")),v},stringGroupParser:function(g,f){var m=g.join(" ").trim();m.endsWith(t.SIMPLE_VALUE_DELIMITER)&&(m=m.substr(0,m.length-t.SIMPLE_VALUE_DELIMITER.length));for(var C=m.split(t.SIMPLE_VALUE_DELIMITER),_=0,y=C.length;_<y;++_){C[_]=C[_].trim();var T=C[_];T.startsWith(t.VALUE_STR_EXPLICIT_QUOTE)&&T.endsWith(t.VALUE_STR_EXPLICIT_QUOTE)&&(C[_]=T.substr(t.VALUE_STR_EXPLICIT_QUOTE.length,T.length-2*t.VALUE_STR_EXPLICIT_QUOTE.length))}return C},stringGroupCoder:function(g,f){for(var m=Kekule.ArrayUtils.toArray(g),C=!1,_=0,y=m.length;_<y;++_)if(typeof m[_]=="string"){C=!0;break}var T=[],E=e.LdrValueParserCoder.stringCoder;for(_=0,y=m.length;_<y;++_){var b=E(m[_],f);C&&(b=t.VALUE_STR_EXPLICIT_QUOTE+b+t.VALUE_STR_EXPLICIT_QUOTE),T.push(b)}return T.join(t.SIMPLE_VALUE_DELIMITER)},simpleAffnGroupParser:function(g,f){for(var m=g.join(" ").split(t.SIMPLE_VALUE_DELIMITER),C=0,_=m.length;C<_;++C)m[C]=parseFloat(m[C].trim());return m},simpleAffnGroupCoder:function(g,f){return Kekule.ArrayUtils.toArray(g).join(t.SIMPLE_VALUE_DELIMITER)},xyDataTableParser:function(g,f){var m={format:g[0],formatDetail:e.Utils.getDataTableFormatAndPlotDetails(g[0])},C=Kekule.globalOptions.IO.jcamp.enableXYDataValueCheck&&f&&f.doValueCheck&&!!m.formatDetail.varInc,_=Object.extend(f||{},{doValueCheck:C});return m.values=r.decodeAsdfTableLines(g.slice(1),_),m},xyDataTableCoder:function(g,f){var m=[f.dataFormat];return m=m.concat(r.encodeAsdfTableLines(g,f.asdfForm,f))},groupedDataTableParser:function(g,f){return{format:g[0],formatDetail:e.Utils.getDataTableFormatAndPlotDetails(g[0]),values:r.decodeAffnGroupTableLines(g.slice(1),f)}},ntuplesDataTableParser:function(g,f){var m,C=e.Utils.getDataTableFormatAndPlotDetails(g[0]);return C.format===e.Consts.DATA_VARLIST_FORMAT_XYDATA?m=d.xyDataTableParser(g,f):(C.format===e.Consts.DATA_VARLIST_FORMAT_XYPOINTS||C.format===e.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS)&&(m=d.groupedDataTableParser(g,f)),m},molecularFormulaParser:function(g,f){var m,C=g[0].trim();return C&&Kekule.MolecularFormula&&(C=(C=C.replace(new RegExp(e.Consts.MOL_FORMULA_SUP_PREFIX,"g")," ")).replace(new RegExp(e.Consts.MOL_FORMULA_SUB_PREFIX,"g"),""),m=Kekule.FormulaUtils.textToFormula(C)),m||C},molecularFormulaCoder:function(g,f){if(Kekule.MolecularFormula&&g instanceof Kekule.MolecularFormula){var m=s.clone(g.getSections()),C=function(R){var N="ZZZZZ",L=0,U=R.obj;return U&&(U.getSymbol&&(N=U.getSymbol()),N==="C"?N="0":N==="H"&&(N="1"),U.getMassNumber&&(L=U.getMassNumber()||0)),[N,L]};m.sort(function(R,N){var L=C(R),U=C(N);return s.compare(L,U)});for(var _=[],y=0,T=m.length;y<T;++y){var E=m[y],b=E.obj,v=E.count,I=b.getLabel&&b.getLabel();b.getMassNumber&&b.getMassNumber()&&(I=e.Consts.MOL_FORMULA_SUP_PREFIX+I),v>1&&(I+=v),_.push(I)}return[_.join(" ")]}return[g]}};var d=Kekule.IO.Jcamp.LdrValueParserCoder;d._parserFuncs._default=d.stringParser,d.registerParser(null,o.AFFN,d.affnParser),d.registerParser(null,o.ASDF,d.asdfParser),d.registerParser(null,o.STRING,d.stringParser),d.registerParser(null,o.SHORT_DATE,d.shortDateParser),d.registerParser(null,o.SHORT_TIME,d.shortTimeParser),d.registerParser(null,o.DATETIME,d.longDateParser),d.registerParser(null,o.MULTILINE_AFFN_ASDF,d.xyDataTableParser),d.registerParser(null,o.MULTILINE_AFFN_GROUP,d.groupedDataTableParser),d.registerParser(null,o.DATA_TABLE,d.ntuplesDataTableParser),d.registerParser(null,o.STRING_GROUP,d.stringGroupParser),d.registerParser(null,o.SIMPLE_AFFN_GROUP,d.simpleAffnGroupParser),d.registerParser("MOLFORM",null,d.molecularFormulaParser),d.registerCoder(null,o.AFFN,d.affnCoder),d.registerCoder(null,o.ASDF,d.asdfCoder),d.registerCoder(null,o.STRING,d.stringCoder),d.registerCoder(null,o.DATETIME,d.longDateCoder),d.registerCoder(null,o.STRING_GROUP,d.stringGroupCoder),d.registerCoder(null,o.SIMPLE_AFFN_GROUP,d.simpleAffnGroupCoder),d.registerCoder("MOLFORM",null,d.molecularFormulaCoder),Kekule.IO.Jcamp.BlockReaderManager={_readerClasses:[],_findRegisteredItemIndex:function(g,f,m,C){for(var _=Kekule.ObjUtils.isUnset,y=h._readerClasses,T=y.length-1;T>=0;--T){var E=y[T];if((_(g)||g===E.blockType||C&&E.blockType==="*")&&(_(f)||f===E.blockFormat||C&&E.blockFormat==="*")&&(_(m)||m===E.readerClass))return T}return-1},register:function(g,f,m){h._findRegisteredItemIndex(g,f,m)<0&&h._readerClasses.push({blockType:g,blockFormat:f,readerClass:m})},unregister:function(g,f,m){var C=h._findRegisteredItemIndex(g,f,m);C>=0&&h._readerClasses.splice(C,1)},getReaderClass:function(g,f){var m=h._findRegisteredItemIndex(g,f,null,!0);return m>=0?h._readerClasses[m].readerClass:null}},Kekule.IO.Jcamp.BlockWriterManager={_writerClasses:[],_findRegisteredItemIndex:function(g,f){for(var m=Kekule.ObjUtils.isUnset,C=p._writerClasses,_=C.length-1;_>=0;--_){var y=C[_];if((m(g)||ClassEx.isOrIsDescendantOf(g,y.objClass))&&(m(f)||f===y.writerClass))return _}return-1},register:function(g,f){p._findRegisteredItemIndex(g,f)<0&&p._writerClasses.push({objClass:g,writerClass:f})},unregister:function(g,f){var m=p._findRegisteredItemIndex(g,f);m>=0&&p._writerClasses.splice(m,1)},getWriterClass:function(g){var f=DataType.isObjectExValue(g)?g.getClass():g,m=p._findRegisteredItemIndex(f,null);return m>=0?p._writerClasses[m].writerClass:null}};var h=Kekule.IO.Jcamp.BlockReaderManager,p=Kekule.IO.Jcamp.BlockWriterManager;Kekule.IO.Jcamp.BlockReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.Jcamp.BlockReader",initialize:function(g){this.setPropStoreFieldValue("ldrHandlerMap",{}),this.tryApplySuper("initialize",g),this._initLdrHandlers()},initProperties:function(){this.defineProp("ldrHandlerMap",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("blockId",{dataType:DataType.STRING,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currOptions",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("parentReader",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("rootReader",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var g=this.getParentReader();return g?g.getRootReader?g.getRootReader():g:this}})},_initLdrHandlers:function(){var g=this.getLdrHandlerMap();g._default=this._defaultLdrHandler.bind(this),g[t.LABEL_BLOCK_BEGIN]=this.doStoreTitleLdr.bind(this),g[t.LABEL_DX_VERSION]=this.doStoreLdrToChemObjInfoProp.bind(this,t.LABEL_DX_VERSION),g[t.LABEL_CS_VERSION]=this.doStoreLdrToChemObjInfoProp.bind(this,t.LABEL_CS_VERSION),g[t.LABEL_BLOCK_END]=this._ignoreLdrHandler;var f=this.doStoreDateTimeLdr.bind(this);return g.DATE=f,g.TIME=f,g.LONGDATE=f,g[t.LABEL_CROSS_REF]=this.doStoreCrossRefLdr.bind(this),g},_defaultLdrHandler:function(g,f,m,C){return this.saveLdrValueToChemObjInfoProp(g.labelName,d.parseValue(g),m,C)},_ignoreLdrHandler:function(g,f,m,C){},_getBlockMeta:function(g){return a.getBlockMeta(g)},setObjWithBlockId:function(g,f){var m=this.getRootReader();m&&m.setObjWithBlockId&&m.setObjWithBlockId(g,f)},getObjFromBlockId:function(g){var f=this.getRootReader();return f&&f.getObjFromBlockId?f.getObjFromBlockId(g):null},addCrossRef:function(g,f,m){var C=this.getRootReader();C&&C.addCrossRefItem&&C.addCrossRefItem(this,this.getBlockId(),g,f,m)},doCreateChemObjForBlock:function(g){return null},getLdrNamePrefixForInfoField:function(g,f,m){var C="jcamp.";return f===l.SPECIFIC||f===l.PRIVATE&&(C+="custom."),C},getLdrStorageParamsForInfoField:function(g,f){var m=e.Utils.analysisLdrLabelName(g),C=m.labelType,_=this.getLdrNamePrefixForInfoField(g,C,f);return{fullName:_?_+m.coreName:m.coreName,labelType:C,labelCategory:m.labelCategory}},saveLdrValueToChemObjInfoProp:function(g,f,m,C){var _,y=this.getLdrStorageParamsForInfoField(g,m),T=C,E=y.labelCategory;E===u.ANNOTATION?_=m.setAnnotation:E===u.PARAMTER?_=m.setParameter:E===u.CONDITION?_=m.setCondition:E===u.META?_=m.setMeta:E===u.GLOBAL?_=m.setInfoValue:y.labelType===l.PRIVATE&&(_=m.setAnnotation),_||(_=m.setInfoValue),_.apply(m,[T,f])},doStoreTitleLdr:function(g,f,m,C){m.setInfoValue("title",e.LdrValueParserCoder.parseValue(g))},doStoreCrossRefLdr:function(g,f,m,C){var _=e.LdrValueParserCoder.parseValue(g),y=e.Utils.getCrossReferenceDetail(_);y.blockId&&this.addCrossRef(y.blockId,y.refType,y.refTypeText)},doStoreLdrToChemObjInfoProp:function(g,f,m,C,_){var y=d.parseValue(f);this.saveLdrValueToChemObjInfoProp(g,y,C,_)},doStoreDateTimeLdr:function(g,f,m,C){var _,y=g.labelName,T=d.parseValue(g);if(y==="LONGDATE")_=T;else if(y==="DATE"){_=new Date(T.year,T.month-1,T.day);var E=a.getBlockLdr(f,"TIME");if(E){var b=d.parseValue(E);_.setHours(b.hour,b.minute,b.second)}}_&&this.saveLdrValueToChemObjInfoProp("date",_,m,"date")},getPendingLdrNames:function(){return[]},getIgnoredLdrNames:function(){return[]},processLdr:function(g,f,m){return this.doProcessLdr(g,f,m)},doProcessLdr:function(g,f,m){var C=f.labelName,_=m&&m.getSpectrumType&&m.getSpectrumType(),y=r.jcampLabelNameToKekule(C,_),T=this.getLdrHandlerMap(),E=T[C]||T._default;E&&E(f,g,m,y)},doBuildCrossRef:function(g,f,m,C){},doReadBlockId:function(g){var f=e.BlockUtils.getBlockLdr(g,t.LABEL_BLOCK_ID);f&&this.setPropStoreFieldValue("blockId",e.LdrValueParserCoder.parseValue(f))},doSetChemObjFromBlock:function(g,f){if(f){for(var m=this.getIgnoredLdrNames()||[],C=this.getPendingLdrNames()||[],_=[],y=0,T=g.ldrs.length;y<T;++y){var E=g.ldrs[y];m.indexOf(E.labelName)>=0||(C.indexOf(E.labelName)>=0?_.push(E):this.processLdr(g,E,f))}for(y=0,T=_.length;y<T;++y)E=_[y],this.processLdr(g,E,f)}return f},doReadBlock:function(g,f){this.setPropStoreFieldValue("currOptions",f||{});var m=this.doCreateChemObjForBlock(g);return m&&(this.doReadBlockId(g),this.doSetChemObjFromBlock(g,m),this.getBlockId()&&this.setObjWithBlockId(this.getBlockId(),m)),m},doReadData:function(g,f,m,C){return this.doReadBlock(g,C)}}),Kekule.IO.Jcamp.DataBlockReader=Class.create(Kekule.IO.Jcamp.BlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.DataBlockReader"}),Kekule.IO.Jcamp.LinkBlockReader=Class.create(Kekule.IO.Jcamp.BlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.LinkBlockReader",initProperties:function(){this.defineProp("childReaders",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC})},doFinalize:function(){this._finalizeChildReaders(),this.tryApplySuper("doFinalize")},_finalizeChildReaders:function(){var g=this.getChildReaders();if(g)for(var f=0,m=g.length;f<m;++f)g[f].finalize();this.setPropStoreFieldValue("childReaders",[])},_initLdrHandlers:function(){var g=this.tryApplySuper("_initLdrHandlers");g[t.LABEL_DATA_TYPE]=this._ignoreLdrHandler,g[t.LABEL_BLOCK_COUNT]=this._ignoreLdrHandler},doCreateChemObjForBlock:function(g){return this._getBlockMeta(g).blockType===e.BlockType.LINK?new Kekule.ChemObjList:this.tryApplySuper("doCreateChemObjForBlock",[g])},doReadBlock:function(g,f){var m;if(g.blocks.length<=0)return null;m=this.tryApplySuper("doReadBlock",[g,f]),this._finalizeChildReaders();for(var C=[],_=0,y=g.blocks.length;_<y;++_){var T=g.blocks[_],E=this._getBlockMeta(T),b=h.getReaderClass(E.blockType,E.format);if(b){var v=this._createChildReader(b);try{var I=v.doReadData(T,null,null,f);I&&C.push(I)}finally{}}}if(C.length<=1)return m.finalize(),C[0];for(_=0,y=C.length;_<y;++_)m.appendChild(C[_]);return m},_createChildReader:function(g){var f=new g;return f&&(f.setParentReader(this),this.getChildReaders().push(f)),f}}),h.register(e.BlockType.LINK,"*",Kekule.IO.Jcamp.LinkBlockReader),h.register(e.BlockType.DATA,"*",Kekule.IO.Jcamp.DataBlockReader),Kekule.IO.Jcamp.BlockWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.Jcamp.BlockWriter",initialize:function(g){this.setPropStoreFieldValue("ldrCreatorMap",{}),this.tryApplySuper("initialize",g),this._initLdrCreators()},initProperties:function(){this.defineProp("blockId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("blockDataType",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("ldrCreatorMap",{dataType:DataType.HASH,setter:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("parentWriter",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("rootWriter",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var g=this.getParentWriter();return g?g.getRootWriter?g.getRootWriter():g:this}})},assignBlockIdAndDataType:function(g){var f=this.getRootWriter(),m=f&&f.generateUniqueBlockId();m&&this.setBlockId(m);var C=this.doGetDataTypeForBlock(g);return C&&this.setBlockDataType(C),g&&this.setBlockInfoForObj(g,{id:m,dataType:C}),m},setBlockInfoForObj:function(g,f){var m=this.getRootWriter();m&&m.setBlockInfoForObj(g,f)},getBlockInfoFromObj:function(g){var f=this.getRootWriter();return f&&f.getBlockInfoFromObj(g)},getLdrCreator:function(g){var f=this.getLdrCreatorMap();return f[g]||f._default},_initLdrCreators:function(){this.getLdrCreatorMap()._default=this._defaultLdrCreator.bind(this)},_defaultLdrCreator:function(g,f,m,C){return this.createLdr(g,f,C)},_ignoreLdrCreator:function(g,f,m,C){},doWriteData:function(g,f,m,C){var _=Object.extend({},Kekule.globalOptions.IO.jcamp);return _=Object.extend(_,C||{}),this.doWriteBlock(g,_)},doWriteBlock:function(g,f){var m=a.createBlock();if(m){var C=this.getTitleForBlock(g);this.saveToLdrInBlock(m,g,"",C,t.LABEL_BLOCK_BEGIN),this.doSaveJcampVersionToBlock(g,m,f);var _=this.getDataTypeForBlock(g);_&&this.saveToLdrInBlock(m,g,"",_,t.LABEL_DATA_TYPE),this.getBlockId()&&this.doSaveBlockIdToBlock(g,m,f),this.doSaveChemObjInfoToBlock(g,m,f),this.doSaveChemObjToBlock(g,m,f),this.saveToLdrInBlock(m,g,"","",t.LABEL_BLOCK_END)}return m},getTitleForBlock:function(g){return null},getDataTypeForBlock:function(g){return this.getBlockDataType()||this.doGetDataTypeForBlock(g)},doGetDataTypeForBlock:function(g){return null},doSaveJcampVersionToBlock:function(g,f,m){},doSaveBlockIdToBlock:function(g,f,m){var C=this.getBlockId();C&&this.saveToLdrInBlock(f,g,"",C,t.LABEL_BLOCK_ID)},doSaveChemObjInfoToBlock:function(g,f,m){for(var C=g.getInfoKeys(),_=this.doGetIgnoredChemObjInfoKeys(g,m),y=0,T=C.length;y<T;++y){var E=C[y];if(!(_.indexOf(E)>=0)){var b=g.getInfoValue(E);Kekule.ObjUtils.notUnset(b)&&this.doSaveChemObjInfoItemToBlock(g,E,"info."+E,b,f,m)}}e.BlockUtils.getBlockLdr(f,"LONGDATE")||this.saveToLdrInBlock(f,g,"",new Date,"LONGDATE",!1)},doSaveChemObjInfoItemToBlock:function(g,f,m,C,_,y){var T=this.doGetIgnoredChemObjInfoJcampLabelNames(g,y),E=e.Utils.kekuleLabelNameToJcamp(f,null);T.indexOf(E)<0&&this.saveToLdrInBlock(_,g,m,C,E,!1)},doGetIgnoredChemObjInfoKeys:function(g,f){return["title"]},doGetIgnoredChemObjInfoJcampLabelNames:function(g,f){return[e.Consts.LABEL_BLOCK_BEGIN,e.Consts.LABEL_BLOCK_END,e.Consts.LABEL_DX_VERSION,e.Consts.LABEL_CS_VERSION]},doSaveChemObjToBlock:function(g,f,m){},createLdr:function(g,f,m){return{labelName:m,valueLines:Kekule.ObjUtils.notUnset(f)?this._convToLdrValueLines(m,f):[]}},createLdrRaw:function(g,f){return{labelName:g,valueLines:s.toArray(f)}},saveToLdrInBlock:function(g,f,m,C,_,y){var T=this.getLdrCreator(m),E=T&&T(m,C,g,_);E&&this.setLdrInBlock(g,E,y)},setLdrInBlock:function(g,f,m){if(f){var C=f.labelName,_=e.BlockUtils.getLabelIndex(C,g);_>=0&&m?e.BlockUtils.getLdrAt(_,g).valueLines=f.valueLines:e.BlockUtils.addLdrToBlock(g,f)}},_convJsValueToBasicType:function(g){return g instanceof Kekule.Scalar?g.getValue():g},_convToLdrValueLines:function(g,f){return d.encodeValue(g,this._convJsValueToBasicType(f))}}),Kekule.IO.Jcamp.LinkBlockWriter=Class.create(Kekule.IO.Jcamp.BlockWriter,{CLASS_NAME:"Kekule.IO.Jcamp.LinkBlockWriter",initProperties:function(){this.defineProp("childObjWriterClassMap",{dataType:DataType.OBJECT,setter:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("targetChildObjs",{dataType:DataType.ARRAY,setter:!1,scope:Class.PropertyScope.PRIVATE})},doWriteData:function(g,f,m,C){var _=this.doCreateChildObjWriterClassMap(g);return _.children.length>0?(this.setPropStoreFieldValue("childObjWriterClassMap",_.map),this.setPropStoreFieldValue("targetChildObjs",_.children),this.tryApplySuper("doWriteData",[g,f,m,C])):null},getTitleForBlock:function(g){return g.getInfoValue("title")||g.getId()},doSaveJcampVersionToBlock:function(g,f,m){this.saveToLdrInBlock(f,g,"",m.outputDxVersion,e.Consts.LABEL_DX_VERSION)},doGetDataTypeForBlock:function(g){return"LINK"},doSaveChemObjToBlock:function(g,f,m){var C=this.getTargetChildObjs();if(C.length){var _=new Kekule.MapEx;try{for(var y=0,T=C.length;y<T;++y)if(v=C[y]){var E=this.getChildObjWriterClassMap().get(v);E&&((I=this._createChildWriter(E)).assignBlockIdAndDataType(v),_.set(v,I))}var b=C;for(y=0,T=b.length;y<T;++y){var v=b[y],I=_.get(v);try{var R=I.writeData(v,null,null,m);R&&this.doAppendChildBlock(f,R,m)}finally{I.finalize()}}}finally{_.finalize()}}this.saveToLdrInBlock(f,g,"",f.blocks.length,e.Consts.LABEL_BLOCK_COUNT,!0)},doCreateChildObjWriterClassMap:function(g){var f=this,m={map:new Kekule.MapEx,children:null},C=[],_=[],y=function(T){if(T.getChildCount&&T.getChildAt)for(var E=0,b=T.getChildCount();E<b;++E){var v=T.getChildAt(E);if(v){var I=f.doGetChildWriterClass(v);I&&(I===f.getClass()?y(v):(m.map.set(v,I),v instanceof Kekule.Spectroscopy.Spectrum?C.push(v):_.push(v)))}}};return y(g),m.children=_.concat(C),m},doGetChildWriterClass:function(g){return e.BlockWriterManager.getWriterClass(g)||null},_createChildWriter:function(g){var f=new g;return f.setParentWriter(this),f},doAppendChildBlock:function(g,f,m){f&&g.blocks.push(f)}}),e.BlockWriterManager.register(Kekule.ChemObjList,Kekule.IO.Jcamp.LinkBlockWriter),e.BlockWriterManager.register(Kekule.ChemSpace,Kekule.IO.Jcamp.LinkBlockWriter)}(),function(){Kekule.IO.Jcamp.Labels.addMaps([["JCAMPCS","JcampCsVersion"],["JCAMPDX","JcampDxVersion"],["TITLE","Title"],["DATATYPE","DataType"],["DATACLASS","DataClass"],["XUNITS","XUnits"],["YUNITS","YUnits"],["XFACTOR","XFactor"],["YFACTOR","YFactor"],["FIRSTX","FirstX"],["LASTX","LastX"],["FIRSTY","FirstY"],["MAXX","MaxX"],["MINX","MinX"],["MAXY","MaxY"],["MINY","MinY"],["DELTAX","DeltaX"],["NPOINTS","NPoints"],["XYDATA","XYData"],["XYPOINTS","XYPoints"],["PEAKASSIGNMENTS","PeakAssignments"],["PEAKTABLE","PeakTable"],["CLASS","Class"],["ORIGIN","Origin"],["OWNER","Owner"],["DATE","Date"],["TIME","Time"],["LONGDATE","LongDate"],["SOURCEREFERENCE","SourceReference"],["CROSSREFERENCE","CrossReference"],["SAMPLEDESCRIPTION","SampleDescription"],["CASNAME","CASName"],["NAMES","Names"],["MOLFORM","MolForm"],["IUPACNAME","IUPACName"],["CASREGISTRYNO","CASRegistryNo"],["WISWESSER","Wiswesser"],["BEILSTEINLAWSONNO","BeilsteinLawsonNo"],["BP","BP"],["MP","MP"],["PRESSURE","Pressure"],["TEMPERATURE","Temperature"],["STATE","State"],["REFRACTIVEINDEX","RefractiveIndex"],["DENSITY","Density"],["MW","MW"],["CONCENTRATIONS","Concentrations"],["SOLVENTNAME","SolventName"],["SPECTROMETERDATASYSTEM","SpectrometerDataSystem"],["INSTRUMENTALPARAMETERS","InstrumentalParameters"],["INSTRUMENTPARAMETERS","InstrumentParameters"],["SAMPLINGPROCEDURE","SamplingProcedure"],["RESOLUTION","Resolution"],["PATHLENGTH","PathLength"],["DATAPROCESSING","DataProcessing"],["XLABEL","XLabel"],["YLABEL","YLabel"],["AUDITTRAIL","AuditTrail"],["COMMENTS","Comments"],["END","END"],["BLOCKS","BLOCKS"],["BLOCKID","BLOCKID"],["NTUPLES","NTUPLES"],["ENDNTUPLES","ENDNTUPLES"],["PAGE","PAGE"],["DATATABLE","DataTable"],["VARDIM","VARDIM"],["VARFORM","VARFORM"],["VARNAME","VARNAME"],["VARTYPE","VARTYPE"],["FACTOR","Factor"],["FIRST","First"],["LAST","Last"],["MAX","Max"],["MIN","Min"],["SYMBOL","Symbol"],["UNITS","Units"],[".METHOD","EMR.Method"],[".DETECTIONMODE","EMR.DetectionMode"],[".DETECTIONMETHOD","EMR.DetectionMethod"],[".MICROWAVEFREQUENCY1","EMR.MicrowaveFrequency1"],[".MICROWAVEPOWER1","EMR.MicrowavePower1"],[".MICROWAVEPHASE1","EMR.MicrowavePhase1"],[".MICROWAVEFREQUENCY2","EMR.MicrowaveFrequency2"],[".MICROWAVEPOWER2","EMR.MicrowavePower2"],[".MICROWAVEPHASE2","EMR.MicrowavePhase2"],[".MODULATIONUNIT","EMR.ModulationUnit"],[".MODULATIONAMPLITUDE","EMR.ModulationAmplitude"],[".MODULATIONFREQUENCY","EMR.ModulationFrequency"],[".RECEIVERGAIN","EMR.ReceiverGain"],[".RECEIVERHARMONIC","EMR.ReceiverHarmonic"],[".DETECTIONPHASE","EMR.DetectionPhase"],[".SCANTIME","EMR.ScanTime"],[".NUMBEROFSCANS","EMR.NumberofScans"],[".GONIOMETERANGLE","EMR.GoniometerAngle"],[".STATICFIELD","EMR.StaticField"],[".SCANNEDRFPOWER","EMR.ScannedRFPower"],[".PUMPEDRFFREQUENCY1","EMR.PumpedRFFrequency1"],[".PUMPEDRFPOWER1","EMR.PumpedRFPower1"],[".PUMPEDRFFREQUENCY2","EMR.PumpedRFFrequency2"],[".PUMPEDRFPOWER2","EMR.PumpedRFPower2"],[".GRADIENTTHETA","EMR.GradientTheta"],[".GRADIENTPHI","EMR.GradientPhi"],[".GRADIENTSTRENGTHINTHETAPHIDIRECTION","EMR.GradientStrengthinThetaPhiDirection"],[".GRADIENTSTRENGTHX","EMR.GradientStrengthX"],[".GRADIENTSTRENGTHY","EMR.GradientStrengthY"],[".GRADIENTSTRENGTHZ","EMR.GradientStrengthZ"],[".SIMULATIONSOURCE","EMR.SimulationSource"],[".SIMULATIONPARAMETERS","EMR.SimulationParameters"],[".RESONATOR","EMR.Resonator"],[".TIMECONSTANT","EMR.TimeConstant"],[".CALIBRATIONSTANDARD","EMR.CalibrationStandard"],[".XOFFSET","EMR.X_Offset"],[".AVERAGES","IMS.Averages"],[".CARRIERGAS","IMS.CarrierGas"],[".CARRIERGASFLOW","IMS.CarrierGasFlow"],[".CARRIERGASMOISTURE","IMS.CarrierGasMoisture"],[".DRIFTCHAMBER","IMS.DriftChamber"],[".DRIFTGAS","IMS.DriftGas"],[".DRIFTGASFLOW","IMS.DriftGasFlow"],[".ELECTRICFIELD","IMS.ElectricField"],[".IONIZATIONCHAMBER","IMS.IonizationChamber"],[".IONIZATIONENERGY","IMS.IonizationEnergy"],[".IONIZATIONMODE","IMS.IonizationMode"],[".IONIZATIONSOURCE","IMS.IonizationSource"],[".IONPOLARITY","IMS.IonPolarity"],[".PRESSURE","IMS.Pressure"],[".TEMPERATURE","IMS.Temperature"],[".REDUCEDMOBILITY","IMS.ReducedMobility"],[".REPETITIONRATE","IMS.RepititionRate"],[".SHUTTERGRIDPOTENTIAL","IMS.ShutterGridPotential"],[".SHUTTEROPENINGTIME","IMS.ShutterOpeningTime"],[".ACCELERATINGVOLTAGE","MS.AcceleratingVoltage"],[".BASEPEAK","MS.Basepeak"],[".BASEPEAKINTENSITY","MS.BasepeakIntensity"],[".MONOISOTOPICMASS","MS.MonoisotopicMass"],[".NOMINALMASS","MS.NominalMass"],[".RETENTIONTIME","MS.RetentionTime"],[".RIC","MS.RIC"],[".SCANNUMBER","MS.ScanNumber"],[".SCANRATE","MS.ScanRate"],[".SOURCETEMPERATURE","MS.SourceTemperature"],[".SPECTROMETERTYPE","MS.SpectrometerType"],[".TOTALIONCURRENT","MS.TotalIonCurrent"],[".DETECTOR","MS.Detector"],[".INLET","MS.Inlet"],[".INLETTEMPERATURE","MS.InletTemperature"],[".IONIZATIONENERGY","MS.IonizationEnergy"],[".IONIZATIONMODE","MS.IonizationMode"],[".ACQUISITIONMODE","NMR.AcquisitionMode"],[".ACQUISITIONRANGE","NMR.AcquisitionRange"],[".ACQUISITIONTIME","NMR.AcquisitionTime"],[".AVERAGES","NMR.Averages"],[".COUPLINGCONSTANTS","NMR.CouplingConstants"],[".DECOUPLER","NMR.Decoupler"],[".DELAY","NMR.Delay"],[".DIGITISERRES","NMR.DigitiserRes"],[".FIELD","NMR.Field"],[".FILTERWIDTH","NMR.FilterWidth"],[".MASFREQUENCY","NMR.MASFrequency"],[".MAXINTENSITY","NMR.MaxIntensity"],[".MININTENSITY","NMR.MinIntensity"],[".OBSERVE90","NMR.Observe90"],[".OBSERVEFREQUENCY","NMR.ObserveFrequency"],[".OBSERVENUCLEUS","NMR.ObserveNucleus"],[".PHASE0","NMR.Phase0"],[".PHASE1","NMR.Phase1"],[".PULSESEQUENCE","NMR.PulseSequence"],[".RELAXATIONTIMES","NMR.RelaxationTimes"],[".SHIFTREFERENCE","NMR.ShiftReference"],[".SOLVENTREFERENCE","NMR.SolventReference"],[".SPINNINGRATE","NMR.SpinningRate"],[".ZEROFILL","NMR.ZeroFill"],["AFACTOR","AFactor"],["ALIAS","Alias"],["AUNITS","AUnits"],["FIRSTA","FirstA"],["MAXA","MaxA"],["MINA","MinA"],["DELTAR","DeltaR"],["FIRSTR","FirstR"],["LASTR","LastR"],["RADATA","RAData"],["RFACTOR","RFactor"],["RUNITS","RUnits"],["ZPD","ZPD"],["ATOMLIST","AtomList"],["BONDLIST","BondList"],["CHARGE","Charge"],["MAXRASTER","MaxRaster"],["MAXXYZ","MaxXYZ"],["RADICAL","Radical"],["STEREOCENTER","Stereocenter"],["STEREOMOLECULE","Stereomolecule"],["STEREOPAIR","Stereopair"],["XYRASTER","XYRaster"],["XYZ","XYZ"],["XYZFACTOR","XYZFactor"],["XYZSOURCE","XYZSource"]])}(),function(){var s=Kekule.ArrayUtils,e=Kekule.IO.Jcamp,t=Kekule.Spectroscopy,n=Kekule.Unit,i=Kekule.Spectroscopy.SpectrumType;Kekule.IO.Jcamp.SpectrumDataStorageStyle={CLASSIC:1,NTUPLE:2,SMART:0},Kekule.globalOptions.add("IO.jcamp",{outputDxVersion:"5.00",dxDataStorageStyle:Kekule.IO.Jcamp.SpectrumDataStorageStyle.SMART,dxDataAllowedLoadingErrorRatio:.001,dxDataAllowedSavingErrorRatio:1e-4,dxDataPreferredOrdinateScaledRange:{min:-32767,max:32767},dxDataAsdfTableOutputForm:e.AsdfForm.DIF_DUP,useDxMinMaxValueAsDisplayRange:!1,disablePeakAssignmentReading:!1,disablePeakAssignmentWriting:!1,autoHiddenSpectrumRefMolecule:!0}),Kekule.IO.Jcamp.DxConsts={CANDIDATE_INDEPENDENT_VAR_SYMBOLS:["X","R","U","V","K","P"],CANDIDATE_DEPENDENT_VAR_SYMBOLS:["Y","Z","A","B","C","D"]},Kekule.IO.Jcamp.DxUtils={_spectrumTypeMap:[["INFRARED",i.IR],["NMR",i.NMR],["MASS",i.MS],["ION MOBILITY",i.IMS],["IMS",i.IMS],["RAMAN",i.RAMAN],["UV",i.UV_VIS],["VIS",i.UV_VIS],["",i.GENERAL]],_dxUnitToMetricsObjMap:{"ARBITARY UNITS":n.Arbitrary.ARBITRARY,"ARBITARY UNIT":n.Arbitrary.ARBITRARY,SECONDS:n.Time.SECOND,SECOND:n.Time.SECOND,MILLISECONDS:n.Time.MILLISECOND,MICROSECONDS:n.Time.MICROSECOND,NANOSECONDS:n.Time.NANOSECOND,PPM:n.Dimensionless.PARTS_PER_MILLION,HZ:n.Frequency.HERTZ,"1/CM":n.WaveNumber.RECIPROCAL_CENTIMETER,MICROMETERS:n.Length.MICROMETER,NANOMETERS:n.Length.NANOMETER,TRANSMITTANCE:n.OpticalTransmittance.TRANSMITTANCE_PERCENT,REFLECTANCE:n.OpticalReflectance.REFLECTANCE,ABSORBANCE:n.OpticalAbsorbance.ABSORBANCE,"KUBELKA-MUNK":n.OpticalKubelkaMunk.KUBELKA_MUNK,"CHANNEL NUMBER":null,COUNTS:n.Misc.MS_COUNT,COUNT:n.Misc.MS_COUNT,"M/Z":n.SpectrumMS.MS_MASS_CHARGE_RATIO,"RELATIVE ABUNDANCE ":n.SpectrumMS.MS_RELATIVE_ABUNDANCE,MICROAMPERES:n.ElectricCurrent.MICROAMPERE,NANOAMPERES:n.ElectricCurrent.NANOAMPERE,PICOAMPERES:n.ElectricCurrent.PICOAMPERE},jcampSpectrumTypeToKekule:function(r){for(var a,o=e.DxUtils._spectrumTypeMap,l=(r||"").toUpperCase(),u=0,c=o.length;u<c;++u)if(l.indexOf(o[u][0])>=0){a=o[u][1];break}return a||(a=l),a},kekuleSpectrumTypeToJcampCoreName:function(r){for(var a,o=e.DxUtils._spectrumTypeMap,l=0,u=o.length;l<u;++l)if(r===o[l][1]){a=o[l][0];break}return a||(a=jType),a},dxUnitToMetricsUnitSymbol:function(r){if(!r)return"";var a=e.DxUtils._dxUnitToMetricsObjMap[r],o=a&&a.symbol;return o||(o=r.toLowerCase().upperFirst()),o},mertricsUnitSymbolToDxUnit:function(r){if(!r)return"";for(var a=e.DxUtils._dxUnitToMetricsObjMap,o=Kekule.ObjUtils.getOwnedFieldNames(a),l=0,u=o.length;l<u;++l){var c=o[l],d=a[c];if(d&&d.symbol===r)return c}return r.toUpperCase()},calcNumFactorForRange:function(r,a,o,l,u){return e.Utils.calcNumFactorForRange(r,a,o,l,u)}},Kekule.IO.Jcamp.LabelTypeInfos.createInfos([["SPECTROMETER TYPE",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.MS],["INLET",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.MS],["IONIZATION MODE",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.MS],["OBSERVE FREQUENCY",e.ValueType.AFFN,null,e.LabelCategory.PARAMTER,t.SpectrumType.NMR],["OBSERVE NUCLEUS",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.NMR],["SOLVENT REFERENCE",e.ValueType.AFFN,null,e.LabelCategory.PARAMTER,t.SpectrumType.NMR],["DELAY",e.ValueType.SIMPLE_AFFN_GROUP,null,e.LabelCategory.PARAMTER,t.SpectrumType.NMR],["ACQUISITION MODE",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.NMR],["IMS PRESSURE",e.ValueType.AFFN,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["CARRIER GAS",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["DRIFT GAS",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["ELECTRIC FIELD",e.ValueType.SIMPLE_AFFN_GROUP,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["ION POLARITY",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["IONIZATION MODE",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["IMS TEMPERATURE",e.ValueType.SIMPLE_AFFN_GROUP,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["SHUTTER OPENING TIME",e.ValueType.AFFN,null,e.LabelCategory.PARAMTER,t.SpectrumType.IMS],["MASS ANALYSER",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.CHROMATOGRAPHY],["TANDEM SCANNING METHOD",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.CHROMATOGRAPHY],["INTERFACE",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.CHROMATOGRAPHY],["CHROMATOGRAPHY TYPE",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.CHROMATOGRAPHY],["CHROMATOGRAPHY SOLVENTS",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.CHROMATOGRAPHY],["ADDITIVES",e.ValueType.STRING,null,e.LabelCategory.PARAMTER,t.SpectrumType.CHROMATOGRAPHY],["DIMENSIONALITY",e.ValueType.AFFN,null,e.LabelCategory.PARAMTER,t.SpectrumType.CHROMATOGRAPHY]]),Kekule.IO.Jcamp.DxDataBlockReader=Class.create(Kekule.IO.Jcamp.DataBlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.DxDataBlockReader",initProperties:function(){this.defineProp("currDataClass",{dataType:DataType.STRING,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currVarInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currNTuplesInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currNTuplesVarInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(){var r=this.getCurrNTuplesInfos();return r&&r.varInfos}}),this.defineProp("currNTuplesVarRawInfos",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(){var r=this.getCurrNTuplesInfos();return r&&r.varRawInfos}}),this.defineProp("dataSectionsWithPeakAssignments",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},initPropValues:function(){this.tryApplySuper("initPropValues"),this._initCurrVarInfos()},_initCurrVarInfos:function(){this.setPropStoreFieldValue("currVarInfos",{}),this.setPropStoreFieldValue("currNTuplesVarInfos",{})},_initLdrHandlers:function(){var r=this.tryApplySuper("_initLdrHandlers");r[e.Consts.LABEL_BLOCK_BEGIN]=this.doStoreSpectrumTitleLdr.bind(this),r.DATATYPE=this.doStoreSpectrumDataTypeLdr.bind(this,"DATATYPE"),r.DATACLASS=this.doStoreSpectrumDataClassLdr.bind(this);for(var a=this.doStoreSpectrumDataLdr.bind(this),o=this._getDataTableLdrNames(),l=0,u=o.length;l<u;++l)r[o[l]]=a;var c=this._getDataTableVarDefLdrNames(),d=this.doStoreDataVarInfoLdr.bind(this);for(l=0,u=c.length;l<u;++l)r[c[l]]=d;var h=this._getNTuplesDefinitionLdrNames(),p=this.doStoreNTuplesAttributeLdr.bind(this);for(l=0,u=h.length;l<u;++l)r[h[l]]=p;r.DATATABLE=this.doStoreNTuplesDataLdr.bind(this);for(var g=this._getSpectrumParamLdrNames(),f=Kekule.ObjUtils.getOwnedFieldNames(g),m=(l=0,f.length);l<m;++l)for(var C=f[l],_=this.doStoreSpectrumParamLdr.bind(this,C),y=g[C],T=0,E=y.length;T<E;++T)r[y[T]]=_;return r},_getDataTableVarDefLdrNames:function(){return["XUNITS","FIRSTX","LASTX","MAXX","MINX","XFACTOR","YUNITS","MAXY","MINY","FIRSTY","LASTY","YFACTOR","NPOINTS","DELTAX","XLABEL","YLABEL","RUNITS","AUNITS","FIRSTR","LASTR","DELTAR","MAXA","MINA","RFACTOR","AFACTOR","FIRSTA","ALIAS","ZPD"]},_getNTuplesDefinitionLdrNames:function(){return["NTUPLES","VARNAME","SYMBOL","VARTYPE","VARFORM","VARDIM","UNITS","FIRST","LAST","MIN","MAX","FACTOR","PAGE","POINTS","ENDNTUPLES"]},_getDataTableLdrNames:function(){return["XYDATA","XYPOINTS","PEAKTABLE","PEAKASSIGNMENTS","ASSIGNMENTS","RADATA"]},_isDataTableLabelName:function(r){return this._getDataTableLdrNames().indexOf(r)>=0},_getSpectrumParamLdrNames:function(){return{ir:["RESOLUTION"],uv_vis:["RESOLUTION"],nmr:[".OBSERVEFREQUENCY",".OBSERVENUCLEUS",".SOLVENTREFERENCE",".DELAY",".ACQUISITIONMODE"],ms:[".SPECTROMETERTYPE",".INLET",".IONIZATIONMODE"],ims:[".IMSPRESSURE",".CARRIERGAS",".DRIFTGAS",".ELECTRICFIELD",".IONPOLARITY",".IONIZATIONMODE",".IMSTEMPERATURE",".SHUTTEROPENINGTIME"],chromatography:[".MASSANALYSER",".TANDEMSCANNINGMETHOD",".INTERFACE",".CHROMATOGRAPHYTYPE",".CHROMATOGRAPHYSOLVENTS",".ADDITIVES",".DIMENSIONALITY"]}},getLdrNamePrefixForInfoField:function(r,a,o){var l=this.tryApplySuper("getLdrNamePrefixForInfoField",[r,a,o]);if(a===e.LabelType.SPECIFIC){var u=o.getSpectrumType();u&&(l+=u+".")}return l},getPendingLdrNames:function(){return this.tryApplySuper("getPendingLdrNames").concat(["RESOLUTION"])},doStoreSpectrumTitleLdr:function(r,a,o,l){o.setTitle(e.LdrValueParserCoder.parseValue(r))},doStoreDataVarInfoLdr:function(r,a,o,l){this.getCurrVarInfos()[r.labelName]=e.LdrValueParserCoder.parseValue(r)},doStoreNTuplesAttributeLdr:function(r,a,o,l){var u=this.getCurrNTuplesInfos(),c=e.LdrValueParserCoder.parseValue(r);r.labelName==="ENDNTUPLES"?(c!==u.name&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_NTUPLES_BEGIN_END_NAME_NOT_MATCH",u.value,c)),this.setPropStoreFieldValue("currNTuplesInfos",null)):r.labelName==="NTUPLES"?this.setPropStoreFieldValue("currNTuplesInfos",{name:c,varRawInfos:{}}):r.labelName==="PAGE"?this._doStoreNTuplesPageAttributeLdr(r):u.varRawInfos[r.labelName]=c},_doStoreNTuplesPageAttributeLdr:function(r){var a=this.getCurrNTuplesInfos(),o=r.valueLines.join(""),l=o.split("=");if(l.length!==2)Kekule.error(Kekule.$L("ErrorMsg.JCAMP_NTUPLES_PAGE_DECLARATION_FORMAT_ERROR",o));else{var u=l[0].trim(),c=l[1].trim();a[r.labelName]={varSymbol:u,sValue:c}}},doStoreSpectrumDataTypeLdr:function(r,a,o,l,u){var c=e.LdrValueParserCoder.parseValue(a);if(c&&c.toUpperCase){var d=e.DxUtils.jcampSpectrumTypeToKekule(c);l.setSpectrumType(d)}},doStoreSpectrumDataClassLdr:function(r,a,o,l){var u=e.LdrValueParserCoder.parseValue(r);this.setPropStoreFieldValue("currDataClass",u)},doStoreSpectrumDataLdr:function(r,a,o,l){if(!this._isSpectrumDataLdr(r,a,o))return this.doStoreLdrToChemObjInfoProp(r.labelName,r,a,o);if(this._isDataTableLabelName(r.labelName)){var u=e.LdrValueParserCoder.parseValue(r,{doValueCheck:!0}),c=u.formatDetail,d=c.vars,h=this._retrieveSpectrumDataVarInfos(d,a,o);h[0].dependency=Kekule.VarDependency.INDEPENDENT;for(var p=1,g=h.length;p<g;++p)h[p].dependency=Kekule.VarDependency.DEPENDENT;var f=this._createSpectrumVariableDefinitions(h),m=o.getData();m.setVariables(f);var C=r.labelName.indexOf("PEAK")<0&&r.labelName.indexOf("ASSIGNMENT")<0,_=r.labelName.indexOf("ASSIGNMENT")>=0;m.setMode(C?Kekule.Spectroscopy.DataMode.CONTINUOUS:Kekule.Spectroscopy.DataMode.PEAK),this._createSpectrumDataSectionByFormat(c,u.values,h,m,_,this.getCurrOptions())}},_retrieveSpectrumDataVarInfos:function(r,a,o){var l=[];l._symbols=[],l._bySymbol={};for(var u=this.getCurrVarInfos(),c=function(f){return u[f]},d=0,h=r.length;d<h;++d){var p=r[d],g={symbol:p,units:c(p+"UNITS"),firstValue:c("FIRST"+p),lastValue:c("LAST"+p),maxValue:c("MAX"+p),minValue:c("MIN"+p),factor:c(p+"FACTOR")};g.units||d!==2||p!=="W"||(g.units=c("XUNITS")),l.push(g),l._symbols.push(p),l._bySymbol[p]=l[l.length-1]}return l},_createSpectrumVariableDefinitions:function(r){for(var a=[],o=this.getCurrOptions(),l=0,u=r.length;l<u;++l){var c=r[l],d=c.varType;if(d){if(d==="DEPENDENT")c.dependency=Kekule.VarDependency.DEPENDENT;else if(d==="INDEPENDENT")c.dependency=Kekule.VarDependency.INDEPENDENT;else if(d==="PAGE")continue}var h=new Kekule.Spectroscopy.SpectrumVarDefinition({name:(c.name||"").toLowerCase(),symbol:c.symbol,unit:e.DxUtils.dxUnitToMetricsUnitSymbol(c.units),dependency:Kekule.ObjUtils.notUnset(c.dependency)?c.dependency:Kekule.VarDependency.DEPENDENT});Kekule.ObjUtils.notUnset(c.minValue)&&Kekule.ObjUtils.notUnset(c.maxValue)&&o.useDxMinMaxValueAsDisplayRange&&c.minValue!==c.maxValue&&h.setInfoValue("displayRange",{min:c.minValue,max:c.maxValue}),a.push(h)}return a},doStoreNTuplesDataLdr:function(r,a,o){var l=this.getCurrNTuplesInfos(),u=this.getCurrNTuplesVarInfos();if(u||(u=this._retrieveNTupleVariableInfos(),l.varInfos=u),!(c=l.spectrumData)){var c,d=this._createSpectrumVariableDefinitions(u);(c=o.getData()).setVariables(d),l.spectrumData=c}var h=e.LdrValueParserCoder.parseValue(r,{doValueCheck:!0}),p=h.formatDetail,g=p.plotDescriptor||"",f=(p.vars,g.indexOf("PEAK")<0&&g.indexOf("ASSIGNMENT")<0),m=g.indexOf("ASSIGNMENT")>=0,C=f?Kekule.Spectroscopy.DataMode.CONTINUOUS:Kekule.Spectroscopy.DataMode.PEAK,_=this._createSpectrumDataSectionByFormat(p,h.values,u,c,m,this.getCurrOptions());_.setMode(C);var y=l.PAGE;_.setName(y.varSymbol+": "+y.sValue)},_retrieveNTupleVariableInfos:function(){var r=[];r._bySymbol={},r._symbols=[];var a=this.getCurrNTuplesVarRawInfos(),o=function(c,d,h){for(var p=e.Utils.standardizeLdrLabelName(c),g=s.toArray(a[p]),f=0,m=g.length;f<m;++f)h[f]||(h[f]={}),h[f][d]=g[f],c==="SYMBOL"&&(r._symbols[f]=g[f]);return h};o("VAR_NAME","name",r),o("SYMBOL","symbol",r),o("VAR_TYPE","varType",r),o("VAR_FORM","varForm",r),o("VAR_DIM","varDim",r),o("UNITS","units",r),o("FIRST","firstValue",r),o("LAST","lastValue",r),o("MIN","minValue",r),o("MAX","maxValue",r),o("FACTOR","factor",r);for(var l=0,u=r.length;l<u;++l)r[l].symbol&&(r._bySymbol[r[l].symbol]=r[l]);return r},doStoreSpectrumParamLdr:function(r,a,o,l,u){var c=r.toUpperCase();if(!l.getSpectrumType()||l.getSpectrumType()===c){var d=a.labelName,h=e.LdrValueParserCoder.parseValue(a),p=function(y){l.setParameter(u,y)};if(c===t.SpectrumType.IR||c===t.SpectrumType.UV_VIS){if(d==="RESOLUTION"){if(h.indexOf(e.Consts.SIMPLE_VALUE_DELIMITER)<0){var g;h=parseFloat(h)||h;for(var f=0,m=l.getVariableCount();f<m;++f){var C=l.getVariable(f);if(C.isIndependent()){var _=C.getUnit();if((_&&Kekule.Unit.getUnit(_)).category===Kekule.Unit.Length){g=_;break}}}g&&(h=Kekule.Scalar.create(h,g))}p(h)}}else c===t.SpectrumType.NMR?d===".OBSERVENUCLEUS"?p(h.indexOf("C")>=0&&h.indexOf("13")>=0?t.SpectrumNMR.TargetNucleus.C13:h.indexOf("H")>=0?t.SpectrumNMR.TargetNucleus.H:h):d===".OBSERVEFREQUENCY"?(Kekule.NumUtils.isNormalNumber(h)&&(h=Kekule.Scalar.create(h,Kekule.Unit.Frequency.MEGAHERTZ.symbol)),p(h)):d===".SOLVENTREFERENCE"?(Kekule.NumUtils.isNormalNumber(h)&&(h=Kekule.Scalar.create(h,Kekule.Unit.Dimensionless.PARTS_PER_MILLION.symbol)),p(h)):(d===".DELAY"&&Kekule.NumUtils.isNormalNumber(h)&&(h=Kekule.Scalar.create(h,Kekule.Unit.Time.MICROSECOND.symbol)),p(h)):(c===t.SpectrumType.MS||t.SpectrumType.IMS,p(h))}},_calcActualVarValue:function(r,a){return r*(a.factor||1)},_createSpectrumDataSectionByFormat:function(r,a,o,l,u,c){var d;return r.format===e.Consts.DATA_VARLIST_FORMAT_XYDATA?d=this._createXyDataFormatSpectrumDataSection(r,a,o,l,c):r.format===e.Consts.DATA_VARLIST_FORMAT_XYPOINTS?d=this._createXyPointsFormatSpectrumDataSection(r,a,o,l,c):r.format===e.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS&&(d=u?this._createPeakAssignmentsVarGroupFormatSpectrumDataSection(r,a,o,l,c):this._createVarGroupFormatSpectrumDataSection(r,a,o,l,c)),d},_createXyDataFormatSpectrumDataSection:function(r,a,o,l,u){var c=r.varInc,d=r.varLoop,h=l.createSection(r.vars,Kekule.Spectroscopy.DataMode.CONTINUOUS);h.beginUpdate();try{var p={firstValue:this._calcActualVarValue(a[0][0],o._bySymbol[c]),lastValue:null};if(a.length>1){var g=(a[a.length-1][0]-a[a.length-2][0])/(a[a.length-2].length-1);p.lastValue=this._calcActualVarValue(a[a.length-1][0]+g*(a[a.length-1].length-2),o._bySymbol[c])}else p.lastValue=o[c].lastValue;var f=Math.abs(p.lastValue-p.firstValue)*u.dxDataAllowedLoadingErrorRatio;e.Utils.compareFloat(p.firstValue,o._bySymbol[c].firstValue,f)===0&&e.Utils.compareFloat(p.lastValue,o._bySymbol[c].lastValue,f)===0||Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_TABLE_VALUE_FIRST_LAST_NOT_MATCH")),h.setContinuousVarRange(c,p.firstValue,p.lastValue);for(var m=0,C=a.length;m<C;++m)for(var _=a[m],y=1,T=_.length;y<T;++y)h.appendData([void 0,this._calcActualVarValue(_[y],o._bySymbol[d])]);h.setDataSorted(!0)}finally{h.endUpdate()}return h},_createXyPointsFormatSpectrumDataSection:function(r,a,o,l,u){var c=l.createSection(r.vars);c.beginUpdate();try{for(var d=0,h=a.length;d<h;++d){for(var p=a[d],g=[],f=0,m=p.length;f<m;++f){var C=this._calcActualVarValue(p[f],o[f]);g.push(C)}c.appendData(g)}c.setDataSorted(!0)}finally{c.endUpdate()}return c},_createVarGroupFormatSpectrumDataSection:function(r,a,o,l,u){var c=l.createSection(r.vars);c.beginUpdate();try{for(var d=0,h=a.length;d<h;++d){for(var p=a[d],g=[],f=0,m=p.length;f<m;++f){var C=this._calcActualVarValue(p[f],o[f]);g.push(C)}c.appendData(g)}c.setDataSorted(!0)}finally{c.endUpdate()}return c},_createPeakAssignmentsVarGroupFormatSpectrumDataSection:function(r,a,o,l,u){var c=r.vars.slice(0,2),d=[null,null];if(r.vars.length>2){for(var h=2,p=r.vars.length;h<p;++h){var g=r.vars[h].toUpperCase()[0];["A","W","M"].indexOf(g)>=0?d.push(g):(d.push(null),c.push(r.vars[h]))}var f=!1,m=l.createSection(c);m.beginUpdate();try{var C=[];for(h=0,p=a.length;h<p;++h)if(d.length){for(var _=a[h],y=[],T={},E=0,b=d.length;E<b;++E){var v=d[E];if(v!=="M")if(v==="W")y.push(_[E]);else if(v==="A")Kekule.ObjUtils.notUnset(_[E])&&!u.disablePeakAssignmentReading&&(T.peakAssignmentRaw=[_[E]]);else{var I=this._calcActualVarValue(_[E],o[E]);y.push(I)}}Kekule.ObjUtils.getOwnedFieldNames(T).length&&(y._extra=new Kekule.Spectroscopy.SpectrumPeakDetails,y._extra._peakAssignmentRaw=T.peakAssignmentRaw,f=!0),C.push(y)}else C.push(a[h]);for(f&&(C=this._mergePeakAssignmentDataRows(C,d)),h=0,p=C.length;h<p;++h)m.appendData(C[h]);m.setDataSorted(!0),f&&this.getDataSectionsWithPeakAssignments().push(m)}finally{m.endUpdate()}return m}return this._createVarGroupFormatSpectrumDataSection(r,a,o,l,u)},_mergePeakAssignmentDataRows:function(r,a){var o=Kekule.NumUtils,l=function(f,m){for(var C=!0,_=0,y=a.length;_<y;++_)if(a[_]!=="A"){var T=f[_],E=m[_];if(T!=E&&o.isNormalNumber(T)&&o.isNormalNumber(E)&&!Kekule.NumUtils.isFloatEqual(T,E)){C=!1;break}}return C},u=function(f,m){for(var C=0,_=m.length;C<_;++C)if(l(f,m[C]))return m[C];return null};if(a.indexOf("A")>=0){for(var c=[],d=0,h=r.length;d<h;++d){var p=r[d],g=u(p,c);g&&p._extra._peakAssignmentRaw?g._extra._peakAssignmentRaw?g._extra._peakAssignmentRaw=g._extra._peakAssignmentRaw.concat(p._extra._peakAssignmentRaw):g._extra._peakAssignmentRaw=p._extra._peakAssignmentRaw:c.push(p)}return c}return r},_isSpectrumDataLdr:function(r,a,o){var l=!o.getData()||o.getData().getSectionCount()<=0;if(l){var u=this.getCurrDataClass()||null;u&&(l=r.labelName.replace(/\s/g,"").indexOf(u.replace(/\s/g,""))>=0)}return l},doCreateChemObjForBlock:function(r){var a,o=this._getBlockMeta(r);return o.blockType===e.BlockType.DATA&&o.format===e.Format.DX?(a=new Kekule.Spectroscopy.Spectrum,this.setPropStoreFieldValue("dataSectionsWithPeakAssignments",[])):a=this.tryApplySuper("doCreateChemObjForBlock",[r]),a},doBuildCrossRef:function(r,a,o,l){if(this.tryApplySuper("doBuildCrossRef",[r,a,o,l]),o===e.CrossRefType.STRUCTURE&&a instanceof Kekule.StructureFragment&&r instanceof Kekule.Spectroscopy.Spectrum){e.Utils.addMoleculeSpectrumCrossRef(r,a);var u=this.getDataSectionsWithPeakAssignments();if(u.length)for(var c=0,d=u.length;c<d;++c)this._buildPeakAssignmentRefs(u[c],a);this.getCurrOptions().autoHiddenSpectrumRefMolecule&&a.setVisible&&a.setVisible(!1)}},_buildPeakAssignmentRefs:function(r,a){for(var o=0,l=r.getDataCount();o<l;++o){var u=r.getExtraInfoAt(o);if(u&&u._peakAssignmentRaw){for(var c=[],d=0,h=u._peakAssignmentRaw.length;d<h;++d){var p=u._peakAssignmentRaw[d],g=parseInt(p);if(Kekule.NumUtils.isNormalNumber(g)&&g>0){var f=a.getNodeAt(g-1);f&&s.pushUnique(c,f)}}u.setAssignments(c),delete u._peakAssignmentRaw}}}}),Kekule.IO.Jcamp.DxDataBlockWriter=Class.create(Kekule.IO.Jcamp.BlockWriter,{CLASS_NAME:"Kekule.IO.Jcamp.DxDataBlockWriter",initProperties:function(){this.defineProp("varSymbolMap",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},_initLdrCreators:function(){this.tryApplySuper("_initLdrCreators");var r=this.getLdrCreatorMap();r["metaData.date"]=this._dateLdrCreator.bind(this),r["parameters.NMR.ObserveNucleus"]=this._nmrObserveNucleusLdrCreator.bind(this),r["parameters.NMR.ObserveFrequency"]=this._scalarWithSpecifiedUnitLdrCreator.bind(this,Kekule.Unit.Frequency.MEGAHERTZ),r["parameters.NMR.SolventReference"]=this._scalarWithSpecifiedUnitLdrCreator.bind(this,Kekule.Unit.Dimensionless.PARTS_PER_MILLION),r["parameters.NMR.Delay"]=this._scalarWithSpecifiedUnitLdrCreator.bind(this,Kekule.Unit.Time.MICROSECOND)},doWriteBlock:function(r,a){return this.tryApplySuper("doWriteBlock",[r,a])},getTitleForBlock:function(r){return r.getTitle()||r.getName()||r.getId()},doSaveJcampVersionToBlock:function(r,a,o){this.saveToLdrInBlock(a,r,"",o.outputDxVersion||Kekule.globalOptions.IO.jcamp.outputDxVersion,e.Consts.LABEL_DX_VERSION)},doGetDataTypeForBlock:function(r){return this.doGetJcampSpectrumDataType(r)},doSaveChemObjToBlock:function(r,a,o){this.tryApplySuper("doSaveChemObjToBlock",[r,a,o]),this.saveToLdrInBlock(a,r,"","","DATA CLASS"),this.doSaveChemObjCrossRefToBlock(r,a,o),this.doSaveSpectrumDataToBlock(r,a,o)},doSaveChemObjCrossRefToBlock:function(r,a,o){var l=r.getRefMolecule();if(l){var u=this.getBlockInfoFromObj(l);if(u&&u.id){var c="STRUCTURE"+e.Consts.CROSS_REF_TYPE_TERMINATOR+" BLOCK_ID"+e.Consts.DATA_LABEL_TERMINATOR+u.id;this.saveToLdrInBlock(a,r,"",c,e.Consts.LABEL_CROSS_REF)}}},doSaveChemObjInfoToBlock:function(r,a,o){this.doSaveSpectrumKeyMetaToBlock(r,a,o),this.doSaveSpectrumInfoToBlock(r,a,o)},doSaveSpectrumKeyMetaToBlock:function(r,a,o){},doGetJcampSpectrumDataType:function(r){var a=r.getSpectrumType(),o=this._getSpectrumPeakDetails(r);return a===i.IR?o.isPeak?"INFRARED PEAK TABLE":"INFRARED SPECTRUM":a===i.RAMAN?"RAMAN SPECTRUM":a===i.NMR?o.isPeakAssignment?"NMR PEAK ASSIGNMENTS":o.isPeak?"NMR PEAK TABLE":"NMR SPECTRUM":a===i.MS?o.isPeak?"MASS SPECTRUM":"CONTINUOUS MASS SPECTRUM":a===i.UV_VIS?"UV/VIS SPECTRUM":a===i.IMS?o.isPeakAssignment?"IMS PEAK ASSIGNMENTS":o.isPeak?"IMR PEAK TABLE":"ION MOBILITY SPECTRUM":null},_getSpectrumPeakDetails:function(r){for(var a={isPeak:!0,isPeakAssignment:!0},o=0,l=r.getDataSectionCount();o<l;++o){var u=r.getDataSectionAt(o);if(a.isPeak=a.isPeak&&u.isPeakSection(),a.isPeakAssignment=a.isPeakAssignment&&u.hasPeakAssignments(),!a.isPeak&&!a.isPeakAssignment)break}return a},doSaveSpectrumInfoToBlock:function(r,a,o){var l=r.getSpectrumType(),u=r.getSpectrumInfoCategories();s.pushUnique(u,"");for(var c=0,d=u.length;c<d;++c)for(var h=u[c],p=r.getSpectrumInfoKeysOfCategory(h),g=0,f=p.length;g<f;++g){var m=p[g],C=h+"."+m,_=r.getSpectrumInfoValue(m,h);Kekule.ObjUtils.notUnset(_)&&this.doSaveSpectrumInfoItemToBlock(r,m,C,_,a,l,o)}},doSaveSpectrumInfoItemToBlock:function(r,a,o,l,u,c,d){var h=[e.Consts.LABEL_BLOCK_BEGIN,e.Consts.LABEL_BLOCK_END,e.Consts.LABEL_DX_VERSION,e.Consts.LABEL_CS_VERSION],p=e.Utils.kekuleLabelNameToJcamp(a,c);h.indexOf(p)<0&&this.saveToLdrInBlock(u,r,o,l,p,!1)},doInsertDataClassToBlock:function(r,a,o,l){if(o){var u=this.createLdrRaw("DATA CLASS",[o]);this.setLdrInBlock(a,u,!0)}},doSaveSpectrumDataToBlock:function(r,a,o){if(this.doGetSpectrumDataStorageStyle(r,o)===e.SpectrumDataStorageStyle.CLASSIC)this.doSaveSpectrumSectionDataToClassic(r,r.getActiveDataSection(),a,o);else{for(var l=[],u=0,c=r.getDataSectionCount();u<c;++u){var d=r.getDataSectionAt(u);d.getDataCount()&&l.push(d)}this.doSaveSpectrumSectionsDataToNTuple(r,l,a,o)}},doGetSpectrumDataStorageStyle:function(r,a){var o=Kekule.oneOf(a.dxDataStorageStyle,Kekule.globalOptions.IO.jcamp.dxDataStorageStyle);return o===e.SpectrumDataStorageStyle.SMART&&(o=r.getDataSectionCount()>1?e.SpectrumDataStorageStyle.NTUPLE:e.SpectrumDataStorageStyle.CLASSIC),o},doGetSpectrumSectionDataStorageFormat:function(r,a,o){if(a.isPeakSection()){var l=a.getActualLocalVarInfos().length;return a.hasPeakAssignments()&&!o.disablePeakAssignmentWriting?e.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS:l<=2?e.Consts.DATA_VARLIST_FORMAT_XYPOINTS:e.Consts.DATA_VARLIST_FORMAT_XYWPOINTS}var u=r.getVariablesOfDependency(Kekule.VarDependency.INDEPENDENT)[0];return u&&a.getContinuousVarRange(u)?e.Consts.DATA_VARLIST_FORMAT_XYDATA:e.Consts.DATA_VARLIST_FORMAT_XYPOINTS},doGetSpectrumVariableInfoOfSections:function(r,a,o){for(var l=[],u=!1,c=[],d=new Kekule.MapEx,h=0,p=a.length;h<p;++h){var g=a[h];u=u||g.hasPeakAssignments();var f={},m={};g.getDataCount()&&(f=g.getValueAt(0),m=g.getValueAt(g.getDataCount()-1));for(var C=0,_=g.getActualLocalVarInfos().length;C<_;++C){var y=g.getLocalVarDef(C);if(c.indexOf(y)<0)c.push(y),d.set(y,{dataCount:g.getDataCount(),firstValue:f[y.getSymbol()],lastValue:m[y.getSymbol()]});else{(I=d.get(y)).dataCount=Math.max(I.dataCount,g.getDataCount());var T=I.firstValue,E=I.lastValue;Kekule.ObjUtils.notUnset(f[y.getSymbol()])&&(Kekule.ObjUtils.isUnset(T)||f[y.getSymbol()]<T)&&(I.firstValue=f[y.getSymbol()]),Kekule.ObjUtils.notUnset(m[y.getSymbol()])&&(Kekule.ObjUtils.isUnset(E)||m[y.getSymbol()]>E)&&(I.lastValue=m[y.getSymbol()])}}}var b=r.getData().calcDataRangeOfSections(a,c,{basedOnInternalUnit:!0,ignorePeakRoot:!0}),v=[];for(h=0,p=c.length;h<p;++h){y=c[h];var I,R=d.get(y);(I={symbol:y.getSymbol(),name:y.getName()||y.getDisplayLabel(),isIndependent:y.isIndependent(),dependency:y.getDependency(),unit:y.getUnit()||Kekule.Unit.Arbitrary.ARBITRARY.symbol,dim:R.dataCount,_varDef:y}).first=R.firstValue||0,I.last=R.lastValue||0;var N=b[I.symbol];if(I.range=N,N){var L=e.DxUtils.calcNumFactorForRange(N.min,N.max,o.dxDataAllowedSavingErrorRatio,o.dxDataPreferredOrdinateScaledRange.min,o.dxDataPreferredOrdinateScaledRange.max);I.factor=L,I.min=N.min,I.max=N.max}l.push(I),v.push(I.symbol)}return u&&l.push({symbol:"A",Name:"Peak assignment",isIndependent:!1,dependency:Kekule.VarDependency.DEPENDENT,unit:Kekule.Unit.Arbitrary.ARBITRARY.symbol,dim:null,varForm:"STRING",_varDef:new Kekule.Spectroscopy.SpectrumVarDefinition,_isPeakAssignment:!0}),d.finalize(),l},_getVarDetailOfDefinition:function(r,a){for(var o=0,l=a.length;o<l;++o)if(a[o]._varDef===r)return a[o];return null},_generateNTupleVarSymbolsForJcamp:function(r){for(var a=[],o=function(d,h){var p=d;if(h.length>=26)return null;for(var g=65;h.indexOf(p)>=0;){var f=(p.charCodeAt(0)-g)%26+1+g;p=String.fromCharCode(f)}return p},l=0,u=r.length;l<u;++l){var c=(r[l].symbol||r[l].name).charAt(0).toUpperCase();if(!(c=o(c,a)))break;a.push(c)}return a},doSaveSpectrumSectionDataToClassic:function(r,a,o,l){for(var u=this.doGetSpectrumVariableInfoOfSections(r,[a],l),c=[],d=[],h=0,p=u.length;h<p;++h){var g=u[h];g.isIndependent?c.push(g):g.isIndependent||d.push(g)}var f=c[0],m=d[0];if(this.doSaveSepctrumSectionVarInfoToClassic(r,a,f,m,o,l),this.saveToLdrInBlock(o,r,"",a.getDataCount()||0,"NPOINTS"),a.getDataCount()){var C,_,y=this.doGetSpectrumSectionDataStorageFormat(r,a,l);if(y===e.Consts.DATA_VARLIST_FORMAT_XYDATA){var T=a.getContinuousVarRange(f.symbol);T&&(this.saveToLdrInBlock(o,r,"",T.fromValue,"FIRSTX"),this.saveToLdrInBlock(o,r,"",T.toValue,"LASTX")),E=this._createXyDataFormatDataLines(a,f,m,l),_=e.Utils.generateDataTableFormatDescriptor(y,["X","Y"]),C="XYDATA"}else if(y===e.Consts.DATA_VARLIST_FORMAT_XYPOINTS||y===e.Consts.DATA_VARLIST_FORMAT_XYWPOINTS){var E=this._createXyPointsFormatDataLines(a,f,m,l);_=e.Utils.generateDataTableFormatDescriptor(y,["X","Y"]),C=a.isPeakSection()?"PEAK TABLE":"XYPOINTS"}else if(y===e.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS){var b=a.hasPeakAssignments(),v=u.length<=2?["X","Y"]:u.length<=3?b?["X","Y","A"]:["X","Y","W"]:["X","Y","W","A"];E=this._createVarGroupFormatDataLines(a,c,d,b,l),_=e.Utils.generateDataTableFormatDescriptor(y,v),C=b?"PEAK ASSIGNMENTS":"PEAK TABLE"}if(E&&_&&E.unshift(_),C&&E){var I={labelName:C,valueLines:E};this.setLdrInBlock(o,I,!0),this.doInsertDataClassToBlock(r,o,C,l)}}},doSaveSepctrumSectionVarInfoToClassic:function(r,a,o,l,u,c){for(var d=[o,l],h=["X","Y"],p=this,g=function(y,T){var E=p.createLdr("",T,y);p.setLdrInBlock(u,E,!0)},f=0,m=d.length;f<m;++f){var C=d[f],_=h[f];C.unit&&g(_+"UNITS",e.DxUtils.mertricsUnitSymbolToDxUnit(C.unit)),C.name&&g(_+"LABEL",C.name),C.range&&(g("MIN"+_,C.range.min),g("MAX"+_,C.range.max)),C.factor&&g(_+"FACTOR",C.factor)}},doSaveSpectrumSectionsDataToNTuple:function(r,a,o,l){var u=this.doGetSpectrumVariableInfoOfSections(r,a,l);u.push({_varDef:null,symbol:"n",name:"Page number",dependency:"PAGE",isIndependent:!0,isPageNumber:!0,dim:a.length,factor:1,unit:Kekule.Unit.Arbitrary.ARBITRARY.symbol,min:1,max:a.length,first:1,last:a.length});for(var c,d=this._generateNTupleVarSymbolsForJcamp(u),h={},p=new Kekule.MapEx,g=0,f=d.length;g<f;++g){var m=d[g];h[m]=u[g],u[g]._varDef&&p.set(u[g]._varDef,m),u[g].isPageNumber&&(c=m)}var C=this.doGetJcampSpectrumDataType(r);for(this.saveToLdrInBlock(o,r,"",C,"NTUPLES"),this.doSaveSpectrumSectionVarInfoToNTuple(r,a,u,d,h,o,l),g=0,f=a.length;g<f;++g)this.doSaveSpectrumSectionDataToNTuplePage(r,a[g],u,p,c,g,o,l);this.saveToLdrInBlock(o,r,"",C,"END NTUPLES"),this.doInsertDataClassToBlock(r,o,"NTUPLES",l),p.finalize()},doSaveSpectrumSectionDataToNTuplePage:function(r,a,o,l,u,c,d,h){var p=u+"="+(c+1);this.saveToLdrInBlock(d,r,"",p,"PAGE"),this.saveToLdrInBlock(d,r,"",a.getDataCount(),"NPOINTS");for(var g=[],f=[],m=[],C=[],_=0,y=a.getActualLocalVarInfos().length;_<y;++_){var T=a.getLocalVarDef(_),E=l.get(T);if(T){var b=this._getVarDetailOfDefinition(T,o);T.isIndependent()?(g.push(b),m.push(E)):(f.push(b),C.push(E))}}var v=!1;for(_=o.length-1;_>=0;--_)if((b=o[_])._isPeakAssignment){v=!0,f.push(b),E=l.get(b._varDef),C.push(E);break}var I,R,N,L=this.doGetSpectrumSectionDataStorageFormat(r,a,h);if(L===e.Consts.DATA_VARLIST_FORMAT_XYDATA){R="XYDATA";var U=g[0],W=f[0];I=this._createXyDataFormatDataLines(a,U,W,h),N=e.Utils.generateDataTableFormatDescriptor(L,[m[0],C[0]])}else if(L===e.Consts.DATA_VARLIST_FORMAT_XYPOINTS||L===e.Consts.DATA_VARLIST_FORMAT_XYWPOINTS)R=a.isPeakSection()?"PEAK TABLE":"XYPOINTS",U=g[0],W=f[0],I=this._createXyPointsFormatDataLines(a,U,W,h),N=e.Utils.generateDataTableFormatDescriptor(L,[m[0],C[0]]);else if(L===e.Consts.DATA_VARLIST_FORMAT_VAR_GROUPS){R=v?"PEAK ASSIGNMENTS":"PEAK TABLE";var M=[].concat(m).concat(C);N=e.Utils.generateDataTableFormatDescriptor(L,M),I=this._createVarGroupFormatDataLines(a,g,f,v,h)}if(I){I.unshift(N+e.Consts.GROUPED_VALUE_ITEM_DELIMITER+" "+R);var B=this.createLdrRaw("DATA TABLE",I);this.setLdrInBlock(d,B)}},doSaveSpectrumSectionVarInfoToNTuple:function(r,a,o,l,u,c,d){for(var h={},p=function(I,R){var N=h[I];N||(N=[],h[I]=N),N.push(R)},g=function(I){return Kekule.ObjUtils.isUnset(I)?"":e.LdrValueParserCoder.affnCoder(I)},f=0,m=l.length;f<m;++f){var C=l[f],_=o[f],y=_.isPageNumber?"PAGE":_.isIndependent?"INDEPENDENT":"DEPENDENT";p("SYMBOL",C),p("VARNAME",_.name||""),p("VARTYPE",y),p("VARFORM",_.varForm||"ASDF"),p("VARDIM",g(_.dim||0)),p("UNITS",_.unit?e.DxUtils.mertricsUnitSymbolToDxUnit(_.unit):""),p("FIRST",g(_.first)),p("LAST",g(_.last)),p("MIN",g(_.min)),p("MAX",g(_.max)),p("FACTOR",g(_.factor))}var T=Kekule.ObjUtils.getOwnedFieldNames(h,!1);for(f=0,m=T.length;f<m;++f){var E=T[f],b=h[E].join(e.Consts.NTUPLE_DEFINITION_ITEM_DELIMITER),v=this.createLdrRaw(E,b);this.setLdrInBlock(c,v,!1)}},_createVarGroupFormatDataLines:function(r,a,o,l,u){var c=[].concat(a).concat(o),d=[],h=r.getParentSpectrum().getRefMolecule();return r.forEach(function(p,g){for(var f=[],m=[],C=!1,_=0,y=c.length;_<y;++_){var T,E=c[_];if(E._isPeakAssignment){if(l){T="";var b=-1,v=r.getExtraInfoOf(p);if(v&&v.getAssignments&&h){for(var I=v.getAssignments(),R=[],N=0,L=I.length;N<L;++N){var U=I[N];U&&h&&(b=h.indexOfNode(U)),b>=0&&R.push((b+1).toString())}R.length<=0?T=0:R.length===1?T=R[0]:(T=R,C=_)}}}else{var W=p[E.symbol];T=typeof W=="number"?Math.round(W/E.factor||1):W}m.push(T)}if(C!==!1){var M=m[C];for(f=[],_=0,y=M.length;_<y;++_){var B=s.clone(m);B[C]=M[_],f.push(B)}}else f=[m];d=d.concat(f)}),e.Utils.encodeAffnGroupTableLines(d,{explicitlyEnclosed:!0})},_createXyPointsFormatDataLines:function(r,a,o,l){var u=a.factor,c=o.factor,d=[];return r.forEach(function(h,p){var g=Math.round(h[a.symbol]/u),f=Math.round(h[o.symbol]/c);d.push([g,f])}),e.Utils.encodeAffnGroupTableLines(d)},_createXyDataFormatDataLines:function(r,a,o,l){var u,c=function(N,L){var U=Math.round(N).toFixed(0).length,W=Math.round(L).toFixed(0).length;return Math.max(U,W)},d=r.getContinuousVarRange(a.symbol),h=a.factor,p=d.fromValue,g=d.toValue,f=o.factor,m=r.calcDataRange([o.symbol],{basedOnInternalUnit:!0})[o.symbol],C=c(p,g)+1,_=c(m.min/f,m.max/f)+1,y=Math.floor((l.maxCharsPerLine-C)/_),T=l.dxDataAsdfTableOutputForm,E=T===e.AsdfForm.DIF||T===e.AsdfForm.DIF_DUP,b=r.getDataCount(),v=0,I=[],R=[];return r.forEach(function(N,L){var U,W=N[o.symbol],M=Kekule.NumUtils.isNormalNumber(W),B=L>=b;U=M?Math.round(W/f):NaN,(!u||B||M&&v>y)&&(R=[],I.push(R),v=0,E&&u&&u.push(U),R.push(Math.round(N[a.symbol]/h)),u=R),R.push(U),++v},this,{basedOnInternalUnit:!0}),e.Utils.encodeAsdfTableLines(I,T,{abscissaFirst:!0})},_getSpectrumDataLabelAndVarFormatOfSection:function(r,a,o){var l;return a.isPeak()?l=a.hasPeakAssignments()?"PEAKASSIGNMENTS":"PEAKTABLE":l=(a.getContinuousVarSymbols(),"XYDATA"),l},_dateLdrCreator:function(r,a,o,l){return this.createLdr(r,a,"LONGDATE")},_scalarWithSpecifiedUnitLdrCreator:function(r,a,o,l,u){var c;if(o instanceof Kekule.Scalar&&(c=o.getValue())&&Kekule.NumUtils.isNormalNumber(c)){var d=o.getUnit();if(d&&d!==r.symbol){var h=Kekule.Unit.getUnit(d);if(h&&h.category===r.category)c=h.convertValueTo(c,r);else{var p=Kekule.$L("ErrorMsg.JCAMP_LDR_TARGET_UNIT_NOT_MATCH_WITH_DETAIL").format(a,d,r.symbol,u);Kekule.warn(p)}}}return Kekule.NumUtils.isNormalNumber(c)?this.createLdr(a,c,u):null},_nmrObserveNucleusLdrCreator:function(r,a,o,l){var u=Kekule.Spectroscopy.SpectrumNMR.TargetNucleus,c=a===u.C13?"^13C":a===u.H?"^1H":a;return this.createLdr(r,c,l)}}),e.BlockReaderManager.register(e.BlockType.DATA,e.Format.DX,Kekule.IO.Jcamp.DxDataBlockReader),e.BlockWriterManager.register(Kekule.Spectroscopy.Spectrum,Kekule.IO.Jcamp.DxDataBlockWriter)}(),function(){var s=Kekule.ObjUtils,e=(Kekule.ArrayUtils,Kekule.IO.Jcamp);Kekule.globalOptions.add("IO.jcamp",{determinateBondStereoByZIndex:!0,enableCloserBondBetweenPositiveZIndexAtoms:!0,outputCsVersion:"3.7",csCoordAllowedSavingErrorRatio:1e-4,csCoordPreferredScaledRange:{min:-16384,max:16384},autoScaleCsRasterCoords:!0,csRasterAutoScaleRefLength:Kekule.globalOptions.structure.defaultBondLength2D||.8}),Object.extend(e.Consts,{MOL_STRUCTURE_VALUE_GROUP_DELIMITER:"	",MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN:/\s+/g,MOL_ATOM_SYMBOL_ANY:"A",MOL_ATOM_MASS_NUMBER_PREFIX:"^",LABEL_MOL_NAMES:"NAMES",LABEL_MOL_FORMULA:"MOLFORM",LABEL_MOL_ATOMLIST:"ATOMLIST",LABEL_MOL_BONDLIST:"BONDLIST",LABEL_MOL_CHARGELIST:"CHARGE",LABEL_MOL_RADICALLIST:"RADICAL",LABEL_MOL_RASTERLIST:"XYRASTER",LABEL_MOL_MAX_RASTER:"MAXRASTER",LABEL_MOL_COORDLIST:"XYZ",LABEL_MOL_COORD_FACTOR:"XYZFACTOR",LABEL_MOL_MAX_COORD:"MAXXYZ",LABEL_MOL_COORD_CENTER:e.Consts.PRIVATE_LABEL_PREFIX+"XYZCENTER",LABEL_MOL_RASTER_CENTER:e.Consts.PRIVATE_LABEL_PREFIX+"XYRASTERCENTER",LABEL_MOL_RASTER_FACTOR:e.Consts.PRIVATE_LABEL_PREFIX+"XYRASTERFACTOR"}),Kekule.IO.Jcamp.LabelTypeInfos.createInfos([[e.Consts.LABEL_MOL_FORMULA,e.ValueType.STRING,null,e.LabelCategory.GLOBAL],[e.Consts.LABEL_MOL_ATOMLIST,e.ValueType.STRING,null,e.LabelCategory.GLOBAL],[e.Consts.LABEL_MOL_BONDLIST,e.ValueType.STRING,null,e.LabelCategory.GLOBAL],[e.Consts.LABEL_MOL_COORD_FACTOR,e.ValueType.AFFN,null,e.LabelCategory.GLOBAL],[e.Consts.LABEL_MOL_COORD_CENTER,e.ValueType.STRING,e.LabelType.PRIVATE,e.LabelCategory.ANNOTATION],[e.Consts.LABEL_MOL_RASTER_FACTOR,e.ValueType.AFFN,e.LabelType.PRIVATE,e.LabelCategory.ANNOTATION],[e.Consts.LABEL_MOL_RASTER_CENTER,e.ValueType.STRING,e.LabelType.PRIVATE,e.LabelCategory.ANNOTATION],[e.Consts.LABEL_MOL_MAX_COORD,e.ValueType.AFFN,null,e.LabelCategory.GLOBAL],[e.Consts.LABEL_MOL_MAX_RASTER,e.ValueType.AFFN,null,e.LabelCategory.GLOBAL]]),Kekule.IO.Jcamp.CsUtils={getJcampIsotopeIdDetails:function(t){var n=new RegExp("\\"+e.Consts.MOL_ATOM_MASS_NUMBER_PREFIX+"?([0-9]*)([A-z]+)"),i=t.match(n);return i?{massNumber:i[1]?parseInt(i[1]):null,symbol:i[2]}:null},jcampIsotopeIdToKekule:function(t){var n=e.CsUtils.getJcampIsotopeIdDetails(t);return n?n.symbol+n.massNumber:t},kekuleIsotopeToJcampIsotopeId:function(t){var n=t.getSymbol(),i=t.getMassNumber();return i&&(n=e.Consts.MOL_ATOM_MASS_NUMBER_PREFIX+Math.round(i)+n),n},jcampBondTypeToKekule:function(t){var n=Kekule.BondType,i=Kekule.BondOrder,r=t.toUpperCase(),a={};return r==="A"?(a.bondType=n.UNKNOWN,a.bondOrder=i.UNSET):(a.bondType=n.COVALENT,a.bondOrder=r==="S"?i.SINGLE:r==="D"?i.DOUBLE:r==="T"?i.TRIPLE:r==="Q"?i.QUAD:i.UNSET),a},kekuleBondTypeAndOrderToJcampBondType:function(t,n){var i=Kekule.BondType,r=Kekule.BondOrder;return t===i.COVALENT?n===r.QUAD?"Q":n===r.TRIPLE?"T":n===r.DOUBLE?"D":n===r.SINGLE?"S":"A":"A"},jcampRadicalToKekule:function(t){return Math.round(t)},kekuleRadicalToJcamp:function(t){return Math.round(t)},calcFactorForCoordRange:function(t,n,i,r,a){for(var o,l,u=["x","y","z"],c=0,d=u.length;c<d;++c){var h=t[u[c]],p=n[u[c]];if(s.notUnset(h)&&s.notUnset(p)){var g=e.Utils.calcNumFactorForRange(h,p,i);(s.isUnset(o)||o>g)&&(o=g)}}for(c=0,d=u.length;c<d;++c){h=t[u[c]],p=n[u[c]];var f=r[u[c]],m=a[u[c]];g=e.Utils.calcNumFactorForRange(h,p,null,f,m),(s.isUnset(l)||l>g)&&(l=g)}return Math.min(o,l)}},Kekule.IO.Jcamp.CsDataBlockReader=Class.create(Kekule.IO.Jcamp.DataBlockReader,{CLASS_NAME:"Kekule.IO.Jcamp.CsDataBlockReader",initProperties:function(){this.defineProp("currAtomInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currBondInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currChargeInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRadicalInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currCoordFactor",{dataType:DataType.FLOAT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currCoordCenter",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currCoordInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRasterFactor",{dataType:DataType.FLOAT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRasterCenter",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("currRasterInfos",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doCreateChemObjForBlock:function(t){var n=this._getBlockMeta(t);return n.blockType===e.BlockType.DATA&&n.format===e.Format.CS?new Kekule.Molecule:this.tryApplySuper("doCreateChemObjForBlock",[t])},doSetChemObjFromBlock:function(t,n){var i=this.tryApplySuper("doSetChemObjFromBlock",[t,n]);return this._buildStructure(n,{atomInfos:this.getCurrAtomInfos(),bondInfos:this.getCurrBondInfos(),chargeInfos:this.getCurrChargeInfos(),radicalInfos:this.getCurrRadicalInfos(),coordFactor:this.getCurrCoordFactor(),coordCenter:this.getCurrCoordCenter(),coordInfos:this.getCurrCoordInfos(),rasterFactor:this.getCurrRasterFactor(),rasterCenter:this.getCurrRasterCenter(),rasterInfos:this.getCurrRasterInfos()},this.getCurrOptions()),i},doBuildCrossRef:function(t,n,i,r){this.tryApplySuper("doBuildCrossRef",[t,n,i,r]),i===e.CrossRefType.SPECTRUM&&t instanceof Kekule.StructureFragment&&n instanceof Kekule.Spectroscopy.Spectrum&&e.Utils.addMoleculeSpectrumCrossRef(n,t)},_initLdrHandlers:function(){var t=this.tryApplySuper("_initLdrHandlers");t[e.Consts.LABEL_MOL_NAMES]=this.doStoreMolNamesLdr.bind(this),t[e.Consts.LABEL_MOL_FORMULA]=this.doStoreMolFormulaLdr.bind(this),t[e.Consts.LABEL_MOL_ATOMLIST]=this.doStoreMolAtomListLdr.bind(this),t[e.Consts.LABEL_MOL_BONDLIST]=this.doStoreMolBondListLdr.bind(this),t[e.Consts.LABEL_MOL_CHARGELIST]=this.doStoreMolChargeOrRadicalListLdr.bind(this,"charge"),t[e.Consts.LABEL_MOL_RADICALLIST]=this.doStoreMolChargeOrRadicalListLdr.bind(this,"radical"),t[e.Consts.LABEL_MOL_COORD_FACTOR]=this.doStoreMolCoordOrRasterFactorLdr.bind(this,"coord"),t[e.Consts.LABEL_MOL_COORD_CENTER]=this.doStoreMolCoordOrRasterCenterLdr.bind(this,"coord"),t[e.Consts.LABEL_MOL_COORDLIST]=this.doStoreMolCoordOrRasterListLdr.bind(this,"coord"),t[e.Consts.LABEL_MOL_RASTER_FACTOR]=this.doStoreMolCoordOrRasterFactorLdr.bind(this,"raster"),t[e.Consts.LABEL_MOL_RASTER_CENTER]=this.doStoreMolCoordOrRasterCenterLdr.bind(this,"raster"),t[e.Consts.LABEL_MOL_RASTERLIST]=this.doStoreMolCoordOrRasterListLdr.bind(this,"raster")},getIgnoredLdrNames:function(){return["MAXRASTER","MAXXYZ","STEREOCENTER","STEREOPAIR","STEREOMOLECULE"]},doStoreMolNamesLdr:function(t,n,i,r){var a=t.valueLines[0].trim();i.setName&&i.setName(a)},doStoreMolFormulaLdr:function(t,n,i,r){var a=e.LdrValueParserCoder.parseValue(t);a&&a instanceof Kekule.MolecularFormula&&i.setFormula(a)},doStoreMolAtomListLdr:function(t,n,i,r){for(var a=[],o=t.valueLines,l=0,u=o.length;l<u;++l){var c=o[l].trim();if(c){var d=c.split(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),h=parseInt(d[0]),p=(d[1]||"").trim(),g=parseInt(d[2])||null;p&&s.notUnset(h)&&(a[h]={symbol:p,implicitHCount:g})}}this.setPropStoreFieldValue("currAtomInfos",a)},doStoreMolBondListLdr:function(t,n,i,r){for(var a=[],o=t.valueLines,l=0,u=o.length;l<u;++l){var c=o[l].trim();if(c){var d=c.split(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),h=parseInt(d[0]),p=parseInt(d[1]),g=d[2].trim();s.notUnset(h)&&s.notUnset(p)&&g&&a.push({atomIndex1:h,atomIndex2:p,bondType:g})}}this.setPropStoreFieldValue("currBondInfos",a)},doStoreMolChargeOrRadicalListLdr:function(t,n,i,r,a){for(var o=[],l=t,u=n.valueLines,c=0,d=u.length;c<d;++c){var h=u[c].trim();if(h){for(var p=h.split(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),g=parseFloat(p[0]),f=[],m=1,C=p.length;m<C;++m){var _=parseInt(p[m]);s.notUnset(_)&&_>=0&&f.push(_)}if(s.notUnset(g)&&f.length){var y={atomIndexes:f};y[l]=g,o.push(y)}}}l==="charge"?this.setPropStoreFieldValue("currChargeInfos",o):l==="radical"&&this.setPropStoreFieldValue("currRadicalInfos",o)},doStoreMolCoordOrRasterFactorLdr:function(t,n,i,r,a){var o=e.LdrValueParserCoder.parseValue(n)||1;t==="coord"?this.setPropStoreFieldValue("currCoordFactor",o):t==="raster"&&this.setPropStoreFieldValue("currRasterFactor",o)},doStoreMolCoordOrRasterCenterLdr:function(t,n,i,r,a){var o=n.valueLines[0];if(o){var l=o.split(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),u={x:parseFloat(l[0]),y:parseFloat(l[1])};l[2]&&(u.z=parseFloat(l[2])),t==="coord"?this.setPropStoreFieldValue("currCoordCenter",u):t==="raster"&&this.setPropStoreFieldValue("currRasterCenter",u)}},doStoreMolCoordOrRasterListLdr:function(t,n,i,r,a){for(var o=[],l=n.valueLines,u=0,c=l.length;u<c;++u){var d=l[u].trim();if(d){for(var h=d.split(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER_PATTERN),p=parseInt(h[0]),g=[],f=1,m=h.length;f<m;++f){var C=parseFloat(h[f]);s.notUnset(C)&&g.push(C)}if(s.notUnset(p)&&g.length){var _={atomIndex:p,x:g[0],y:g[1],z:g[2]};o.push(_)}}}t==="coord"?this.setPropStoreFieldValue("currCoordInfos",o):t==="raster"&&this.setPropStoreFieldValue("currRasterInfos",o)},_buildStructure:function(t,n,i){var r,a=n.atomInfos||this.getCurrAtomInfos()||[],o=n.bondInfos||this.getCurrBondInfos()||[],l=n.chargeInfos||this.getCurrChargeInfos()||[],u=n.radicalInfos||this.getCurrRadicalInfos()||[],c=n.coordInfos||this.getCurrCoordInfos()||[],d=n.coordFactor||this.getCurrCoordFactor()||1,h=n.coordCenter||this.getCurrCoordCenter(),p=n.rasterInfos||this.getCurrRasterInfos()||[],g=n.rasterFactor||this.getCurrRasterFactor(),f=n.rasterCenter||this.getCurrRasterCenter();t.beginUpdate();try{for(var m=[],C=0,_=a.length;C<_;++C)if(pe=a[C]){if(pe.symbol&&pe.symbol!==e.Consts.MOL_ATOM_SYMBOL_ANY){var y=e.CsUtils.getJcampIsotopeIdDetails(pe.symbol);fe=t.appendAtom(y.symbol,y.massNumber)}else fe=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY),t.appendNode(fe);m[C]=fe}var T=Kekule.CoordUtils;if(c.length){var E=h||{x:0,y:0,z:0};for(C=0,_=c.length;C<_;++C)if((pe=c[C])&&(fe=m[pe.atomIndex])){var b=T.multiply(T.add({x:pe.x,y:pe.y,z:pe.z},E),d);fe.setCoord3D(b)}}if(p.length)for(r=!g&&i.autoScaleCsRasterCoords&&i.csRasterAutoScaleRefLength,E=f||{x:0,y:0},C=0,_=p.length;C<_;++C)(pe=p[C])&&(fe=m[pe.atomIndex])&&(b=T.multiply(T.add({x:pe.x,y:pe.y},E),g||1),fe.setCoord2D(b),pe.z&&fe.setZIndex2D(pe.z));var v=[];for(C=0,_=o.length;C<_;++C)if(pe=o[C]){var I=m[pe.atomIndex1],R=m[pe.atomIndex2],N=pe.bondType,L=e.CsUtils.jcampBondTypeToKekule(N),U=t.appendBond([I,R],L.bondOrder,L.bondType);if(r){var W=T.getDistance(I.getCoord2D(),R.getCoord2D());W&&v.push(W)}if(i.determinateBondStereoByZIndex&&L.bondType===Kekule.BondType.COVALENT&&L.bondOrder===Kekule.BondOrder.SINGLE){var M=I.getZIndex2D()||0,B=R.getZIndex2D()||0,V=M<B?Kekule.BondStereo.UP:M>B?Kekule.BondStereo.DOWN:null;!V&&M>0&&i.enableCloserBondBetweenPositiveZIndexAtoms&&(V=Kekule.BondStereo.CLOSER),V&&U.setStereo(V)}}if(r&&v.length){var J=Kekule.ArrayUtils.getMedian(v),$=i.csRasterAutoScaleRefLength/J;for(C=0,_=m.length;C<_;++C)if(fe=m[C]){var q=fe.getCoord2D();q&&fe.setCoord2D(T.multiply(q,$))}}for(C=0,_=l.length;C<_;++C)if((pe=l[C])&&pe.charge){var Q=pe.atomIndexes.length;if(Q){for(var ie=[],Y=0;Y<Q;++Y){var ne=pe.atomIndexes[Y];m[ne]&&ie.push(m[ne])}for(var de=pe.charge/ie.length,Ae=(Y=0,ie.length);Y<Ae;++Y)ie[Y].setCharge(de)}}for(C=0,_=u.length;C<_;++C){var Ce=(pe=u[C])&&pe.radical;if(Ce)for(Y=0,Ae=pe.atomIndexes.length;Y<Ae;++Y)(fe=m[pe.atomIndexes[Y]])&&fe.setRadical(e.CsUtils.jcampRadicalToKekule(Ce))}for(C=0,_=a.length;C<_;++C){var pe;if(pe=a[C]){var fe=m[C],Te=pe.implicitHCount;if(s.notUnset(Te)){var xe=fe.getImplicitHydrogenCount();Te!==xe&&(fe.setExplicitHydrogenCount?fe.setExplicitHydrogenCount(Te):Kekule.error(Kekule.$L("ErrorMsg.JCAMP_IMPLICIT_HYDROGEN_COUNT_NOT_MATCH_DETAIL").format(C,pe.symbol,Te,xe)))}}}t.hasCtab()&&t.hasFormula()&&t.removeFormula()}finally{t.endUpdate()}}}),Kekule.IO.Jcamp.CsDataBlockWriter=Class.create(Kekule.IO.Jcamp.BlockWriter,{CLASS_NAME:"Kekule.IO.Jcamp.CsDataBlockWriter",initProperties:function(){this.defineProp("atomIndexMap",{dataType:DataType.OBJECT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},_initLdrCreators:function(){this.tryApplySuper("_initLdrCreators")},getTitleForBlock:function(t){return t.getInfoValue("title")||t.getName()||t.getId()},doSaveJcampVersionToBlock:function(t,n,i){this.saveToLdrInBlock(n,t,"",i.outputCsVersion||Kekule.globalOptions.IO.jcamp.outputCsVersion,e.Consts.LABEL_CS_VERSION)},doSaveChemObjToBlock:function(t,n,i){this.tryApplySuper("doSaveChemObjToBlock",[t,n,i]);var r=new Kekule.MapEx;try{this.setPropStoreFieldValue("atomIndexMap",r);var a=t.clone(!0);try{a.kekulize()&&a.kekulize();var o=a.getFlattenedShadowFragment()}finally{a.finalize()}if(this.doSaveMolFormulaToBlock(t,n,i),o.hasCtab()){var l=this.doGenerateMolAtomsLdrs(o,i),u=this.doGenerateMolBondsLdrs(o,i);l.atoms&&this.setLdrInBlock(n,l.atoms),u.bonds&&this.setLdrInBlock(n,u.bonds),l.charges&&this.setLdrInBlock(n,l.charges),l.radicals&&this.setLdrInBlock(n,l.radicals),l.rasters&&(l.maxRaster&&this.setLdrInBlock(n,l.maxRaster),l.rasterFactor&&this.setLdrInBlock(n,l.rasterFactor),l.rasterCenter&&this.setLdrInBlock(n,l.rasterCenter),this.setLdrInBlock(n,l.rasters)),l.coords&&l.coordFactor&&(l.maxCoord&&this.setLdrInBlock(n,l.maxCoord),this.setLdrInBlock(n,l.coordFactor),l.coordCenter&&this.setLdrInBlock(n,l.coordCenter),this.setLdrInBlock(n,l.coords))}}finally{r.finalize()}},doSaveMolFormulaToBlock:function(t,n,i){var r=t.calcFormula();r&&this.saveToLdrInBlock(n,t,"",r,e.Consts.LABEL_MOL_FORMULA)},doGenerateMolAtomsLdrs:function(t,n){for(var i,r,a,o,l,u,c,d,h,p,g,f,m,C=this.getAtomIndexMap(),_=1,y=[""],T=[],E=[],b=[],v=[],I=function(vt,yt){return vt.hasCoordOfMode(yt)?(vt.getAbsCoordOfMode||vt.getCoordOfMode).apply(vt,[yt]):null},R=0,N=t.getNodeCount();R<N;++R){var L=t.getNodeAt(R);if(L instanceof Kekule.ChemStructureNode){var U,W=L.getPrimaryIsotope&&L.getPrimaryIsotope();U=W?e.CsUtils.kekuleIsotopeToJcampIsotopeId(W):e.Consts.MOL_ATOM_SYMBOL_ANY;var M=L.getHydrogenCount&&L.getHydrogenCount(!1),B=[_,U];M&&B.push(M),y.push(B.join(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER));var V=I(L,Kekule.CoordMode.COORD3D);V?f=!0:V={x:0,y:0,z:0},V._index=_,b.push(V);var J=I(L,Kekule.CoordMode.COORD2D);J?m=!0:J={x:0,y:0},J._index=_;var $=L.getZIndex2D&&L.getZIndex2D();$&&(J.zIndex=$),v.push(J);var q=L.getCharge&&L.getCharge();q&&T.push({charge:Math.round(q),atomIndex:_});var Q=L.getRadical&&L.getRadical();Q&&(E[Q=e.CsUtils.kekuleRadicalToJcamp(Q)]?E[Q].push(_):E[Q]=[_]),C.set(L,_),++_}}if(y.length>1&&(i=this.createLdrRaw(e.Consts.LABEL_MOL_ATOMLIST,y)),T.length){var ie=[""];for(R=0,N=T.length;R<N;++R)(Y=T[R])&&(B=[Y.charge>0?"+"+Y.charge:Y.charge.toString(),Y.atomIndex],ie.push(B.join(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER)));r=this.createLdrRaw(e.Consts.LABEL_MOL_CHARGELIST,ie)}if(E.length){for(ie=[""],R=0,N=E.length;R<N;++R){var Y;(Y=E[R])&&(B=(B=[R]).concat(E[R]),ie.push(B.join(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER)))}ie.length>1&&(a=this.createLdrRaw(e.Consts.LABEL_MOL_RADICALLIST,ie))}var ne=Kekule.CoordUtils,de=[m?v:[],f?b:[]];for(R=0,N=de.length;R<N;++R){var Ae,Ce=de[R],pe=(ie=[""],R===0?["x","y"]:["x","y","z"]);if(Ce.length){var fe=ne.getCenter(Ce),Te=ne.getContainerBoxCorners(Ce);Te.min=ne.substract(Te.min,fe),Te.max=ne.substract(Te.max,fe);var xe={},Re={};xe.x=xe.y=xe.z=n.csCoordPreferredScaledRange.min,Re.x=Re.y=Re.z=n.csCoordPreferredScaledRange.max;for(var we=e.CsUtils.calcFactorForCoordRange(Te.min,Te.max,n.csCoordAllowedSavingErrorRatio,xe,Re),Me=0,Le=Ce.length;Me<Le;++Me){B=[Ce[Me]._index];for(var Ue=ne.divide(ne.substract(Ce[Me],fe),we),at=0,Bt=pe.length;at<Bt;++at){var Fe=pe[at],Nt=Math.round(Ue[Fe]||0);B.push(Nt),(Kekule.ObjUtils.isUnset(Ae)||Nt>Ae)&&(Ae=Nt)}Ce[Me].zIndex&&B.push(Ce[Me].zIndex),ie.push(B.join(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER))}for(Ue=ne.divide(fe,we),B=[],at=0,Bt=pe.length;at<Bt;++at)Fe=pe[at],B.push(Math.round(Ue[Fe]||0));var Xe=B.join(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER);ie.length>1&&(R===0?(c=this.createLdrRaw(e.Consts.LABEL_MOL_RASTERLIST,ie),d=this.createLdr("",we,e.Consts.LABEL_MOL_RASTER_FACTOR),h=this.createLdr("",Xe,e.Consts.LABEL_MOL_RASTER_CENTER),g=this.createLdr("",Ae,e.Consts.LABEL_MOL_MAX_RASTER)):(o=this.createLdrRaw(e.Consts.LABEL_MOL_COORDLIST,ie),l=this.createLdr("",we,e.Consts.LABEL_MOL_COORD_FACTOR),u=this.createLdr("",Xe,e.Consts.LABEL_MOL_COORD_CENTER),p=this.createLdr("",Ae,e.Consts.LABEL_MOL_MAX_COORD)))}}return{atoms:i,charges:r,radicals:a,rasters:c,rasterFactor:d,rasterCenter:h,coords:o,coordFactor:l,coordCenter:u,maxCoord:p,maxRaster:g}},doGenerateMolBondsLdrs:function(t,n){for(var i=this.getAtomIndexMap(),r=[""],a=0,o=t.getConnectorCount();a<o;++a){var l=t.getConnectorAt(a);if(l instanceof Kekule.Bond){for(var u=[],c=l.getConnectedChemNodes(),d=0,h=c.length;d<h;++d){var p=i.get(c[d]);if(s.notUnset(p)&&(u.push(p),u.length>=2))break}var g=e.CsUtils.kekuleBondTypeAndOrderToJcampBondType(l.getBondType(),l.getBondOrder());u.push(g),r.push(u.join(e.Consts.MOL_STRUCTURE_VALUE_GROUP_DELIMITER))}}var f={};return r.length>1&&(f.bonds=this.createLdrRaw(e.Consts.LABEL_MOL_BONDLIST,r)),f}}),e.BlockReaderManager.register(e.BlockType.DATA,e.Format.CS,Kekule.IO.Jcamp.CsDataBlockReader),e.BlockWriterManager.register(Kekule.StructureFragment,Kekule.IO.Jcamp.CsDataBlockWriter)}(),function(){Kekule.ArrayUtils;var s=Kekule.IO.Jcamp,e=s.Consts;Kekule.IO.JcampReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.JcampReader",initialize:function(t){this.tryApplySuper("initialize",t)},doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("blockIdObjMap",{dataType:DataType.HASH,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("crossRefs",{dataType:DataType.ARRAY,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},_removeInlineComments:function(t){var n=t.indexOf(e.INLINE_COMMENT_FLAG);return n>=0?t.substring(0,n):t},_parseLdrLines:function(t){var n=t[0].indexOf(e.DATA_LABEL_TERMINATOR),i=!1;if(n<0)r=t[0].substring(e.DATA_LABEL_FLAG.length).trim(),i=!0;else var r=t[0].substring(e.DATA_LABEL_FLAG.length,n).trim();if(r){var a=null;if(!i){a=[];var o=this._removeInlineComments(t[0].substr(n+1)).trim();a.push(o||"");for(var l=1,u=t.length;l<u;++l)(o=this._removeInlineComments(t[l].trim()))&&a.push(o)}return{labelName:s.Utils.standardizeLdrLabelName(r),valueLines:a}}return null},doCreateAnalysisTree:function(t){var n=s.BlockUtils.createBlock,i=n(),r=i,a=this,o=function(d){var h=a._parseLdrLines(d);if(h){if(s.Utils.ldrLabelNameEqual(h.labelName,e.LABEL_BLOCK_BEGIN)){var p=n(r);r.blocks.push(p),r=p}(function(g,f){var m=a._parseLdrLines(g);m&&s.BlockUtils.addLdrToBlock(f,m)})(d,r),s.Utils.ldrLabelNameEqual(h.labelName,e.LABEL_BLOCK_END)&&(r=r._parent)}},l=new Kekule.TextLinesBuffer(t);l.reset();for(var u=[];!l.eof();){var c=l.readLine().trim();c.startsWith(e.DATA_LABEL_FLAG)?(u.length&&o(u),u=[c]):u.push(c)}return u.length&&o(u),i},doCheckAnalysisTree:function(t){t.ldrs.length&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_OTHER_LABEL_BEFORE_TITLE_LINE")),t.blocks.length>1&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_MORE_THAN_ONE_ROOT_BLOCK"));var n=t.blocks[0];return n||Kekule.error(Kekule.$L("ErrorMsg.JCAMP_DATA_WITHOUT_TITLE_LINE")),s.BlockUtils.getNestedBlockLevelCount(n)>2&&Kekule.error(Kekule.$L("ErrorMsg.JCAMP_MORE_THAN_TWO_NEST_LEVEL")),!0},buildAnalysisTree:function(t){var n=this.doCreateAnalysisTree(t);return this.doCheckAnalysisTree(n)?n:null},setObjWithBlockId:function(t,n){this.getBlockIdObjMap()[t]=n},getObjFromBlockId:function(t){return this.getBlockIdObjMap()[t]},addCrossRefItem:function(t,n,i,r,a){this.getCrossRefs().push({srcReader:t,srcBlockId:n,targetBlockId:i,refType:r,refTypeText:a})},doHandleCrossRefs:function(){for(var t=this.getCrossRefs()||[],n=0,i=t.length;n<i;++n){var r=t[n],a=r.srcReader;if(a&&a.doBuildCrossRef){var o=this.getObjFromBlockId(r.srcBlockId),l=this.getObjFromBlockId(r.targetBlockId);o&&l&&a.doBuildCrossRef(o,l,r.refType,r.refTypeText)}}},doReadData:function(t,n,i,r){var a,o=this.buildAnalysisTree(t).blocks[0],l=s.BlockUtils.getBlockMeta(o),u=s.BlockReaderManager.getReaderClass(l.blockType,l.format);if(u){var c=new u;c.setParentReader(this);try{var d=Object.extend({},Kekule.globalOptions.IO.jcamp);d=Object.extend(d,r||{}),this.setPropStoreFieldValue("blockIdObjMap",{}),this.setPropStoreFieldValue("crossRefs",[]),a=c.doReadData(o,null,null,d),this.doHandleCrossRefs()}finally{c.finalize()}}return a}}),Kekule.IO.JcampWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.JcampWriter",initProperties:function(){this.defineProp("maxBlockId",{dataType:DataType.INT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("objBlockIdMap",{dataType:DataType.OBJECT,setter:!1,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doWriteData:function(t,n,i,r){var a=t,o=this.doGetChildWriter(a);if(!o&&t.getChildAt&&t.getChildCount)for(var l=0,u=t.getChildCount();l<u;++l){var c=t.getChildAt(l);if(c&&(o=this.doGetChildWriter(c))){a=c;break}}if(o&&a){this._prepareWriting();var d=Object.extend({},Kekule.globalOptions.IO.jcamp);d=Object.extend(d,r||{}),o.setParentWriter(this);var h=o.writeData(a,n,i,d),p=[];return h&&(p=this.encodeBlockToTextLines(h)),o.finalize(),p.join(`
`)}return""},_prepareWriting:function(){this.setPropStoreFieldValue("maxBlockId",0),this.getObjBlockIdMap()&&this.getObjBlockIdMap().finalize(),this.setPropStoreFieldValue("objBlockIdMap",new Kekule.MapEx)},doGetChildWriter:function(t){var n=s.BlockWriterManager.getWriterClass(t);return n?new n:null},encodeBlockToTextLines:function(t){for(var n,i=t.ldrs,r=[],a=0,o=i.length;a<o;++a){var l=i[a],u=l.labelName;if(u===e.LABEL_BLOCK_END)n=l;else{var c=l.valueLines||[],d=s.Consts.DATA_LABEL_FLAG+u+s.Consts.DATA_LABEL_TERMINATOR+c.join(`
`);r.push(d)}}var h=t.blocks||[];for(a=0,o=h.length;a<o;++a)r=r.concat(this.encodeBlockToTextLines(h[a]));return n&&(d=s.Consts.DATA_LABEL_FLAG+n.labelName+s.Consts.DATA_LABEL_TERMINATOR+(l.valueLines||[]).join(`
`),r.push(d)),r},generateUniqueBlockId:function(){var t=this.getMaxBlockId(),n=++t;return this.setPropStoreFieldValue("maxBlockId",n),n.toString()},setBlockInfoForObj:function(t,n){this.getObjBlockIdMap().set(t,n)},getBlockInfoFromObj:function(t){return this.getObjBlockIdMap().get(t)}}),Kekule.Spectroscopy.MetaPropNamespace.register("jcamp"),Kekule.IO.DataFormat.JCAMP_DX="jcamp-dx",Kekule.IO.MimeType.JCAMP_DX="chemical/x-jcamp-dx",Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.JCAMP_DX,Kekule.IO.MimeType.JCAMP_DX,["jdx","dx","jcm","jcamp"],Kekule.IO.ChemDataType.TEXT,"JCAMP-DX format"),Kekule.IO.ChemDataReaderManager.register(Kekule.IO.DataFormat.JCAMP_DX,Kekule.IO.JcampReader,[Kekule.IO.DataFormat.JCAMP_DX]),Kekule.IO.ChemDataWriterManager.register(Kekule.IO.DataFormat.JCAMP_DX,Kekule.IO.JcampWriter,[Kekule.Spectroscopy.Spectrum,Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemSpace],[Kekule.IO.DataFormat.JCAMP_DX])}(),function(){Kekule.globalOptions.add("IO.cml",{enableExtractSampleInsideSpectrum:!0,autoHideSampleInsideSpectrum:!0,autoInsertHiddenRefMoleculeToSample:!0,spectrumDataValueOutputPrecisionCount:8,autoConvertNmrDataFreqToUnit:"Hz"});var s=Kekule.ArrayUtils,e=Kekule.ObjUtils,t=Kekule.DomUtils,n=Kekule.IO.CmlUtils,i=Kekule.IO.CmlDomUtils,r=Kekule.Spectroscopy.SpectrumType,a=Kekule.Spectroscopy.PeakShape,o=Kekule.Spectroscopy.PeakMultiplicity;Kekule.IO.CmlUtils._cmlUnitConvMap.push(["moverz","m/z","m/z",!1]),Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME="__$objRef$__",Kekule.IO.CML.SPECTRUM_DATA_OBJREF_FLAG_FIELDNAME="__$hasObjRef$__",Kekule.IO.CML.Spect={},Kekule.IO.CML.Spect.Consts={SI_UNITS_NAMESPACE_DEF_PREFIX:"siUnits",SI_UNITS_NAMESPACE_URI:"http://www.xml-cml.org/units/siUnits",UNITS_NAMESPACE_DEF_PREFIX:"units",UNITS_NAMESPACE_URI:"http://www.xml-cml.org/units/units",JSPECVIEW_NAMESPACE_DEF_PREFIX:"jspecview",JSPECVIEW_NAMESPACE_URI:"http://jspecview.sf.net/convention.html",JCAMP_NAMESPACE_DEF_PREFIX:"jcamp",JCAMP_NAMESPACE_URI:"http://www.iupac.org/jcamp/dict",JCAMP_UNITS_NAMESPACE_DEF_PREFIX:"jcampUnits",JCAMP_UNITS_NAMESPACE_URI:"http://www.iupac.org/jcamp/dict/units",CML_DICT_NAMESPACE_DEF_PREFIX:"cml",CML_DICT_NAMESPACE_URI:"http://www.xml-cml.org/dict/cmlDict",XML_SCHEMA_INSTANCE_NAMESPACE_DEF_PREFIX:"xsi",XML_SCHEMA_INSTANCE_NAMESPACE_URI:"http://www.w3.org/2001/XMLSchema-instance",CMLSPECT_SCHEMA_LOCATIONS_ATTRIBNAME:"schemaLocation",CMLSPECT_SCHEMA_LOCATIONS:["http://www.xml-cml.org/dict/jcampDict dict/jcampDict.xml","http://www.xml-cml.org/schema schema.xsd","http://www.xml-cml.org/dict/cml dict/cmlDict.xml","http://www.xml-cml.org/dict/cmlDict dict/simpleCmlDict.xml","http://www.xml-cml.org/units/units dict/unitsDict.xml","http://www.xml-cml.org/units/siUnits dict/siUnitsDict.xml"],ANNOTATION_METATYPE:"annotation",INFO_METATYPE:"info"};var l=Kekule.IO.CML.Spect.Consts;Kekule.IO.CmlSpectUtils={_spectrumTypeMap:[["NMR",r.NMR],["infrared",r.IR],["ir",r.IR],["massSpectrum",r.MS],["mass",r.MS],["UV/VIS",r.UV_VIS],["uv",r.UV_VIS],["vis",r.UV_VIS]],_peakShapeMap:[["sharp",a.SHARP],["broad",a.BROAD]],_peakMultiplicityMap:[["singlet",o.SINGLET],["doublet",o.DOUBLET],["triplet",o.TRIPLET],["quartet",o.QUARTET],["quintet",o.QUINTET],["sextuplet",o.SEXTUPLET],["multiplet",o.MULTIPLET],["s",o.SINGLET],["d",o.DOUBLET],["dd",o.DOUBLE_DOUBLET],["ddd",o.TRIPLE_DOUBLET],["t",o.TRIPLET],["m",o.MULTIPLET]],_spectrumInfoKeyMap:[["jcamp:NMR_OBSERVEFREQUENCY","NMR.ObserveFrequency"],["cml:field","NMR.ObserveFrequency"],["jcamp:NMR_OBSERVENUCLEUS","NMR.ObserveNucleus"],["nmr:OBSERVENUCLEUS","NMR.ObserveNucleus"],["jcamp:resolution","Resolution"]],cmlSpectrumTypeToKekule:function(h){for(var p=Kekule.IO.CmlSpectUtils._spectrumTypeMap,g=r.GENERAL,f=h.toLowerCase(),m=0,C=p.length;m<C;++m){var _=p[m];if(f.indexOf(_[0].toLowerCase())>=0){g=_[1];break}}return g},kekuleSpectrumTypeToCml:function(h){for(var p=null,g=Kekule.IO.CmlSpectUtils._spectrumTypeMap,f=0,m=g.length;f<m;++f){var C=g[f];if(h===C[1]){p=C[0];break}}return p},cmlSpectrumInfoDataKeyToKekule:function(h,p,g){g||(g=l.JCAMP_NAMESPACE_DEF_PREFIX);for(var f=u._spectrumInfoKeyMap,m=0,C=f.length;m<C;++m)if(h===f[m][0])return f[m][1];var _=n.getCmlNsValueDetails(h);if(_.namespace&&_.namespace===g){var y=_.localName;if(p){var T=p&&p+"_",E=y.indexOf(T);E>=0&&(y=Kekule.IO.Jcamp.Consts.SPECIFIC_LABEL_PREFIX+y.substr(E+T.length))}var b=y.toUpperCase();return Kekule.IO.Jcamp.Utils.jcampLabelNameToKekule(b,p)}return n.cmlNsTokenToKekule(h)},kekuleSpectrumInfoDataKeyToCml:function(h,p,g){g||(g=l.JCAMP_NAMESPACE_DEF_PREFIX);for(var f=u._spectrumInfoKeyMap,m=0,C=f.length;m<C;++m)if(h===f[m][1])return f[m][0];var _=Kekule.Spectroscopy.MetaPropNamespace.getPropertyNameDetail(h);if(_.namespace===g)return _.namespace+":"+_.coreName;var y=Kekule.IO.Jcamp.Utils.kekuleLabelNameToJcamp(h,p,!0);return y?u._convPossibleJcampLabelNameToCml(y,p,g):_.namespace+":"+_.coreName},_convPossibleJcampLabelNameToCml:function(h,p,g){var f=Kekule.IO.Jcamp.Utils.analysisLdrLabelName(h,!1),m=f.labelType===Kekule.IO.Jcamp.LabelType.SPECIFIC,C=f.labelType===Kekule.IO.Jcamp.LabelType.PRIVATE,_=f.coreName,y=m&&p?p+"_"+_:_;return C?y:g+":"+y},cmlPeakShapeToKekule:function(h){for(var p=u._peakShapeMap,g=h.toLowerCase(),f=0,m=p.length;f<m;++f)if(g===p[f][0])return p[f][1];return h},kekulePeakShapeToCml:function(h){for(var p=u._peakShapeMap,g=0,f=p.length;g<f;++g)if(h===p[g][1])return p[g][0];return h},cmlPeakMultiplicityToKekule:function(h){for(var p=u._peakMultiplicityMap,g=h.toLowerCase(),f=0,m=p.length;f<m;++f)if(g===p[f][0])return p[f][1];return h},kekulePeakMultiplicityToCml:function(h){for(var p=u._peakMultiplicityMap,g=0,f=p.length;g<f;++g)if(h===p[g][1])return p[g][0];return h},floatToCmlString:function(h,p){return p?Kekule.NumUtils.toPrecision(h,p,!0,!0):h.toString()},getSpectrumVarDef:function(h,p,g,f,m){m||(m=Kekule.VarDependency.INDEPENDENT);for(var C=h.getVariables(),_=0,y=C.length;_<y;++_){var T=C[_];if(!(p&&p!==T.getSymbol()||g&&g!==T.getUnit()||f&&f!==T.getName()||m!==T.getDependency()))return T}return null}};var u=Kekule.IO.CmlSpectUtils;Kekule.IO.CmlSampleReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlSampleReader"}),Kekule.IO.CmlSpectrumDataSectionBaseWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataWriter",getSpectrumDataSectionVarInfos:function(h){for(var p={dependent:{},independent:{}},g=0,f=h.getActualLocalVarInfos().length;g<f;++g){var m=h.getLocalVarDef(g),C=p[m.getDependency()===Kekule.VarDependency.DEPENDENT?"dependent":"independent"];C.symbol=m.getSymbol(),C.unitSymbol=m.getUnit(),C.name=m.getName(),C.description=m.getDescription();var _=h.getContinuousVarRange(g);if(_&&(C.range={fromValue:_.fromValue,toValue:_.toValue,count:h.getDataCount()}),p.dependent.symbol&&p.independent.symbol)break}return p.varCount=(p.dependent.symbol?1:0)+(p.independent.symbol?1:0),p}}),Kekule.IO.CmlSpectrumPeakListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakListReader",initialize:function(){this.tryApplySuper("initialize"),this._peakDetailsWithAssignments=[]},doFinalize:function(){this._peakDetailsWithAssignments=null,this.tryApplySuper("doFinalize")},doReadElement:function(h,p,g,f){var m=p instanceof Kekule.Spectroscopy.Spectrum?p:null;if(m){var C=[],_=this.getDomHelper().getElementsByTagNameNS(this.getCoreNamespaceURI(),"peak",h),y=this.doGetChildElementReader("peak");if(y)try{for(var T=0,E=_.length;T<E;++T){var b=y.readElement(_[T],null,this);b&&C.push(b)}}finally{}if(C.length){var v,I=m.getData(),R=this._analysisPeakVarInfo(C,m);if(R){var N=this._addPeakVariablesToSpectrumData(R,I,m);N&&N.length&&(v=I.createSection(N,Kekule.Spectroscopy.DataMode.PEAK),this._setVarLocalInfos(R,v),this._addPeakDataToSpectrumData(C,N,v,I,m))}return v}return null}return null},doDoneReadingDocument:function(){for(var h=this._peakDetailsWithAssignments,p=0,g=h.length;p<g;++p){var f=h[p];if(f instanceof Kekule.Spectroscopy.SpectrumPeakDetails){for(var m=f.getOwner(),C=f.getInfoValue(Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME),_=[],y=0,T=C.length;y<T;++y){var E=C[y],b=this.getLoadedObjById(E)||m&&m.getObjById&&m.getObjById(E);b&&_.push(b)}_.length&&f.setAssignments(_),delete f.getInfo()[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]}}this._peakDetailsWithAssignments=[]},_analysisPeakVarInfo:function(h,p){for(var g={},f=0,m=0,C=h.length;m<C;++m){for(var _=h[m],y=_.value,T=0,E=(v=y&&Kekule.ObjUtils.getOwnedFieldNames(y,!1)||[]).length;T<E;++T)g[v[T]]||(g[v[T]]={},++f);var b=_.units;if(b){var v;for(T=0,E=(v=Kekule.ObjUtils.getOwnedFieldNames(b,!1)||[]).length;T<E;++T)if(g[v[m]]&&!g[v[m]].units){var I=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(b[v[m]]);g[v[m]].units=I,I||(g[v[m]].title=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(b[v[m]]))}}}return f<=0?null:(f===1&&p&&p.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR&&(g.y={units:Kekule.Unit.Arbitrary.ARBITRARY.symbol,displayLabel:Kekule.Unit.Arbitrary.ARBITRARY.name,defaultValue:1}),g)},_addPeakVariablesToSpectrumData:function(h,p,g){if(!h)return null;var f=Kekule.ObjUtils.getOwnedFieldNames(h,!1),m=f.indexOf("x");m<0&&(m=f.indexOf("X")),m<0&&(m=0);var C=f.splice(m,1);f.unshift(C[0]);for(var _=[],y=0,T=f.length;y<T;++y){var E={symbol:f[y],dependency:y===0?Kekule.VarDependency.INDEPENDENT:Kekule.VarDependency.DEPENDENT};h[f[y]].title&&(E.displayLabel=h[f[y]].title),h[f[y]].units&&(E.unit=h[f[y]].units);var b=Kekule.IO.CmlSpectUtils.getSpectrumVarDef(g,E.symbol,E.unit,null,E.dependency);b&&!b.getDisplayLabel()&&E.displayLabel&&b.setDisplayLabel(E.displayLabel),b||(b=new Kekule.Spectroscopy.SpectrumVarDefinition(E),p.appendVariable(b)),_.push(E.symbol)}return _},_setVarLocalInfos:function(h,p){for(var g=Kekule.ObjUtils.getOwnedFieldNames(h,!1),f=0,m=g.length;f<m;++f){var C=h[g[f]];Kekule.ObjUtils.notUnset(C.defaultValue)&&p.setDefaultVarValue(g[f],C.defaultValue)}},_addPeakDataToSpectrumData:function(h,p,g,f,m){for(var C=0,_=h.length;C<_;++C){for(var y=h[C],T=[],E=0,b=p.length;E<b;++E){var v=p[E],I=y.value[v];T.push(I)}this._setPeakDetails(y,T,g),g.appendData(T)}g.setDataSorted(!0)},_setPeakDetails:function(h,p,g){if(h.subStructure||h.multiplicity||h.shape){var f=new Kekule.Spectroscopy.SpectrumPeakDetails({multiplicity:h.multiplicity,shape:h.shape});h.subStructure&&f.setInfoValue("structure",h.subStructure);var m=this._getPeakObjRefIds(h);return m&&(f.setInfoValue(Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME,m),this._peakDetailsWithAssignments.push(f)),g.setExtraInfoOf(p,f),f}return null},_getPeakObjRefIds:function(h){for(var p=[],g=0,f=Kekule.IO.CML.ATOMS_REF_ATTRIBS.length;g<f;++g)h[m=Kekule.IO.CML.ATOMS_REF_ATTRIBS[g]]&&(p=p.concat(h[m].split(/\s/)));for(g=0,f=Kekule.IO.CML.BONDS_REF_ATTRIBS.length;g<f;++g){var m;h[m=Kekule.IO.CML.BONDS_REF_ATTRIBS[g]]&&(p=p.concat(h[m].split(/\s/)))}var C=[];for(g=0,f=p.length;g<f;++g){var _=p[g].trim();_&&C.push(_)}return C.length?C:null}}),Kekule.IO.CmlSpectrumPeakListWriter=Class.create(Kekule.IO.CmlSpectrumDataSectionBaseWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakListWriter",doCreateElem:function(h,p){return this.createChildElem("peakList",p)},doWriteObject:function(h,p,g){return this.writePeaks(h,p,g)},writePeaks:function(h,p,g){var f=this.getSpectrumDataSectionVarInfos(h);if(!(f.varCount<2)){var m=this.getChildPeakWriter();if(m){var C=f.independent.symbol,_=f.independent.unitSymbol,y=f.dependent.symbol,T=f.dependent.unitSymbol,E=this;h.forEach(function(b,v){var I,R={xValue:b[C],xUnits:_,yValue:b[y],yUnits:T},N=h.getExtraInfoOf(b);N instanceof Kekule.Spectroscopy.SpectrumPeakDetails?I=E._peakDetailsToHash(N):DataType.isObjectValue(N)&&(I=N),I&&(R=Object.extend(R,I)),m.writeObject(R,p,g)})}}},getChildPeakWriter:function(){var h=new Kekule.IO.CmlSpectrumPeakWriter;return h&&(this.copySettingsToChildHandler(h),this._appendChildHandler(h)),h},_peakDetailsToHash:function(h){var p={shape:h.getShape(),multiplicity:h.getMultiplicity(),assignments:h.getAssignments()},g=h.getInfoValue("structure");return g&&(p.structure=g),p}}),Kekule.IO.CmlSpectrumPeakReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakReader",doReadElement:function(h,p,g,f){var m={};return this.readPeakAttribs(m,h,this.getDomHelper()),this.iterateChildElements(h,m,this,function(C,_){t.getLocalName(C).toLowerCase()==="peakstructure"&&(m.subStructure||(m.subStructure=[]),m.subStructure.push(_))}),m},readPeakAttribs:function(h,p,g){for(var f=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(p,null,!0,g),m=Kekule.ObjUtils.getOwnedFieldNames(f),C=0,_=m.length;C<_;++C){var y=m[C],T=y.toLowerCase();T==="peakheight"&&(y="yValue",T="yvalue");var E=f[y];if(T.indexOf("units")>=0){var b=this._getVarSymbolInName(y,"units");h.units||(h.units={}),h.units[b]=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(E)}else T.indexOf("value")>=0?(b=this._getVarSymbolInName(y,"value"),h.value||(h.value={}),h.value[b]=Kekule.IO.CmlUtils.tryParseFloat(E)):T==="peakmultiplicity"?h.multiplicity=u.cmlPeakMultiplicityToKekule(E):T==="peakshape"?h.shape=u.cmlPeakShapeToKekule(E):h[y]=E}},_getVarSymbolInName:function(h,p){var g=h.toLowerCase().indexOf(p.toLowerCase());return g>0?h.substring(0,g):null}}),Kekule.IO.CmlSpectrumPeakWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakWriter",doCreateElem:function(h,p){return this.createChildElem("peak",p)},doWriteObject:function(h,p,g){this.writePeakAttribs(h,p,g)},writePeakAttribs:function(h,p,g){for(var f=this.getDomHelper(),m=this._peakHashToCmlHash(h),C=Kekule.ObjUtils.getOwnedFieldNames(m),_=g.spectrumDataValueOutputPrecisionCount||0,y=0,T=C.length;y<T;++y){var E=C[y],b=m[E];["xvalue","yvalue"].indexOf(E.toLowerCase())>=0&&i.setCmlElemAttribute(p,E,u.floatToCmlString(b,_),f),E.toLowerCase()==="structure"&&DataType.isObjectValue(b)?this.writePeakSubStructure(b,p,g):i.setCmlElemAttribute(p,E,b,f)}},getChildPeakStructureWriter:function(){var h=new Kekule.IO.CmlSpectrumPeakStructureWriter;return h&&(this.copySettingsToChildHandler(h),this._appendChildHandler(h)),h},writePeakSubStructure:function(h,p,g){var f=this.getChildPeakStructureWriter();f&&f.writeObj(h,p,g)},_peakHashToCmlHash:function(h){for(var p={},g=["xValue","yValue"],f=0,m=g.length;f<m;++f){var C=g[f],_=h[C];Kekule.ObjUtils.notUnset(_)&&(p[C]=_)}if(h.xUnits&&(p.xUnits=n.metricsUnitSymbolToCmlUnitStr(h.xUnits)),h.yUnits&&(p.yUnits=n.metricsUnitSymbolToCmlUnitStr(h.yUnits)),h.shape&&(p.peakShape=u.kekulePeakShapeToCml(h.shape)),h.multiplicity&&(p.peakMultiplicity=u.kekulePeakMultiplicityToCml(h.multiplicity)),h.assignments&&h.assignments.length){var y=[],T=[];for(f=0,m=h.assignments.length;f<m;++f){var E=h.assignments[f],b=E instanceof Kekule.AbstractAtom?y:E instanceof Kekule.ChemStructureConnector?T:null;if(b){var v=E.getId&&E.getId()||this.autoIdentifyForObj(E);v&&b.push(v)}}y.length&&(p.atomRefs=y.join(" ")),T.length&&(p.bondRefs=T.join(" "))}return p}}),Kekule.IO.CmlSpectrumPeakStructureReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakStructureReader",doReadElement:function(h,p,g,f){for(var m={},C=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(h,null,!0,this.getDomHelper()),_=Kekule.ObjUtils.getOwnedFieldNames(C),y=0,T=_.length;y<T;++y){var E=_[y],b=E.toLowerCase(),v=C[E];Kekule.IO.CML.ATOMS_REF_ATTRIBS.indexOf(E)>=0||Kekule.IO.CML.BONDS_REF_ATTRIBS.indexOf(E)>=0||(b==="units"?m.unit=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(v)||Kekule.IO.CmlUtils.getCmlNsValueLocalPart(v):m[E]=v)}return m}}),Kekule.IO.CmlSpectrumPeakStructureWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumPeakStructureWriter",doCreateElem:function(h,p){return this.createChildElem("peakStructure",p)},doWriteObject:function(h,p,g){for(var f=this.getDomHelper(),m=Kekule.ObjUtils.getOwnedFieldNames(h),C=0,_=m.length;C<_;++C){var y=m[C],T=h[y];y==="unit"&&(T=n.metricsUnitSymbolToCmlUnitStr(T)),i.setCmlElemAttribute(p,y,T,f)}return p}}),Kekule.IO.CmlSpectrumDataAxisReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataAxisReader",initProperties:function(){this.defineProp("axisSymbol",{dataType:DataType.STRING,serializable:!1}),this.defineProp("childArrayObj",{dataType:DataType.OBJECT,serializable:!1})},doReadElement:function(h,p,g,f){var m=t.getLocalName(h).toLowerCase(),C=m.indexOf("axis"),_=m.substring(0,C),y=t.getSameNSAttributeValue(h,"multiplierToData",this.getDomHelper());y&&(y=parseFloat(y)),this.setAxisSymbol(_),this.tryApplySuper("doReadElement",[h,p,g]),this.iterateChildElements(h,p,g);var T={symbol:this.getAxisSymbol(),array:this.getChildArrayObj()};return y&&(T.dataMultiplier=y),T},doReadChildElement:function(h,p,g){if(t.getLocalName(h).toLowerCase()!=="array")return this.tryApplySuper("doReadChildElement",[h,p,g]);var f=this.doGetChildElementReader(h);if(f){f.setExpandSteppedArray&&f.setExpandSteppedArray(!1),f.setDefaultItemDataType&&f.setDefaultItemDataType("xsd:float");var m=f.readElement(h,p,g);m&&this.setChildArrayObj(m)}}}),Kekule.IO.CmlSpectrumDataReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataReader",doReadElement:function(h,p,g,f){if(p instanceof Kekule.Spectroscopy.Spectrum){var m=new Kekule.Spectroscopy.SpectrumDataSection;p.appendDataSection(m);var C=this.iterateChildElements(h,p,g);return this._handleChildResults(C,m),m}},_handleChildResults:function(h,p){for(var g=[],f=0,m=h.length;f<m;++f){var C=h[f],_=C.element;t.getLocalName(_).toLowerCase().indexOf("axis")>=0&&(C.result.symbol.toLowerCase()==="x"?g.unshift(C.result):g.push(C.result))}g.length>=2&&this._fillSpectrumData(g,p)},_fillSpectrumData:function(h,p){for(var g=p.getParentSpectrum(),f=g.getData(),m=0,C=[],_=0,y=h.length;_<y;++_){var T=_===0,E=this._getAxisVarDefParams(h[_],T);C.push(E);var b=h[_].array.size||h[_].array.values&&h[_].array.values.length;b>m&&(m=b)}var v=this._addSpectrumDataVarDefs(C,f,g);for(p.setLocalVarSymbols(v),this._setDataSectionLocalVarInfos(C,p),_=0;_<m;++_){for(var I=[],R=0,N=h.length;R<N;++R){var L=h[R].dataMultiplier||1,U=h[R].array.values;U?I.push(U[_]*L):I.push(void 0)}p.appendData(I)}p.setDataSorted(!0)},_getAxisVarDefParams:function(h,p){for(var g=h.symbol,f={symbol:g,dependency:p?Kekule.VarDependency.INDEPENDENT:Kekule.VarDependency.DEPENDENT},m={},C=h.array,_=e.getOwnedFieldNames(C),y=!1,T=0,E=_.length;T<E;++T){var b=_[T].toLowerCase(),v=C[_[T]];b==="unit"||b==="units"?(f.unit=Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(v),f.unit||f.displayLabel||(f.displayLabel=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(v))):b==="title"?f.name=v:b==="start"||b==="end"||b==="size"||b==="stepsize"||b==="value"||b==="values"||b==="datatype"||(m[_[T]]=v,y=!0)}var I;return!C.values&&Kekule.ObjUtils.notUnset(C.start)&&Kekule.ObjUtils.notUnset(C.end)&&(I={start:C.start,end:C.end}),{symbol:g,initParams:f,continuousInfo:I,hasExtraInfo:y,extraInfo:m}},_addSpectrumDataVarDefs:function(h,p,g){for(var f=[],m=0,C=h.length;m<C;++m){var _=h[m].initParams,y=Kekule.IO.CmlSpectUtils.getSpectrumVarDef(g,_.symbol,_.unit,_.name,_.dependency);y&&!y.getDisplayLabel()&&_.displayLabel&&y.setDisplayLabel(_.displayLabel),y||(y=new Kekule.Spectroscopy.SpectrumVarDefinition(_),p.appendVariable(y)),f.push(y.getSymbol())}return f},_setDataSectionLocalVarInfos:function(h,p){for(var g=0,f=h.length;g<f;++g){var m=h[g],C=m.symbol,_=m.continuousInfo;if(_&&p.setContinuousVarRange(C,_.start,_.end),m.hasExtraInfo){var y=m.extraInfo,T=Kekule.ObjUtils.getOwnedFieldNames(y);for(g=0,f=T.length;g<f;++g)p.setLocalVarInfoValue(C,T[g],y[T[g]])}}}}),Kekule.IO.CmlSpectrumDataWriter=Class.create(Kekule.IO.CmlSpectrumDataSectionBaseWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumDataWriter",doCreateElem:function(h,p){return this.createChildElem("spectrumData",p)},doWriteObject:function(h,p,g){return this.writeSpectrumData(h,p,g)},writeSpectrumData:function(h,p,g){var f=this.getSpectrumDataSectionVarInfos(h);if(!(f.varCount<2)){for(var m=["independent","dependent"],C=[],_=0,y=m.length;_<y;++_){var T=m[_],E=T==="independent",b={_tagName:E?"xaxis":"yaxis",varSymbol:f[T].symbol,unit:f[T].unitSymbol,title:f[T].name,dataType:DataType.FLOAT,size:DataType.count||h.getDataCount()},v=f[T].range;v?(b.start=v.fromValue,b.end=v.toValue,b.isContinuous=!0):b.values=[],b=this._prepareUnitConversionInfoForArrayObj(b,E,h,g),C.push(b)}var I=g&&g.spectrumDataValueOutputPrecisionCount||0;h.forEach(function(L,U){for(var W=0,M=C.length;W<M;++W){var B=C[W]._originUnitObj&&C[W]._unitObj;if(!C[W].isContinuous){var V=L[C[W].varSymbol]||0;B&&(V=C[W]._originUnitObj.convertValueTo(V,C[W]._unitObj)),C[W].values.push(u.floatToCmlString(V,I))}}});var R=this.doGetChildObjectWriter(DataType.ARRAY,h,this);if(R)for(_=0,y=C.length;_<y;++_){b=C[_];var N=this.createChildElem(b._tagName,p);R.writeObject(b,N,g)}}},_prepareUnitConversionInfoForArrayObj:function(h,p,g,f){var m=g.getParentSpectrum();if(p&&m&&m.getSpectrumType()===Kekule.Spectroscopy.SpectrumType.NMR&&f.autoConvertNmrDataFreqToUnit){var C=h.unit&&Kekule.Unit.getUnit(h.unit),_=Kekule.Unit.getUnit(f.autoConvertNmrDataFreqToUnit);C&&_&&C.category===_.category&&C!==_&&(h.unit=f.autoConvertNmrDataFreqToUnit,h._originUnitObj=C,h._unitObj=_,h.start&&(h.start=C.convertValueTo(h.start,_)),h.end&&(h.end=C.convertValueTo(h.end,_)))}return h}}),Kekule.IO.CmlSpectrumReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlSpectrumReader",initialize:function(){this.tryApplySuper("initialize"),this._spectrumWithRefMolecules=[]},initProperties:function(){this.defineProp("convention",{dataType:DataType.STRING,serializable:!1}),this.defineProp("additionalRefMolecules",{dataType:DataType.ARRAY,serializable:!1})},doFinalize:function(){this._spectrumWithRefMolecules=null,this.setPropStoreFieldValue("additionalRefMolecules",null),this.tryApplySuper("doFinalize")},readElement:function(h,p,g,f){this.setAdditionalRefMolecules([]);var m=this.tryApplySuper("readElement",[h,p,g,f]),C=this.getAdditionalRefMolecules();if(C.length){var _=s.clone(C);_.push(m);var y=this._createChildObjsHolder(_,f.defaultRootObjListHolder);return m.setRefMolecules(C),y}return m},doReadElement:function(h,p,g,f){return this.readSpectrum(h,this.getDomHelper(),f)},doReadChildElement:function(h,p,g){var f=t.getLocalName(h).toLowerCase();return this._isInfoListElemTagName(f)?this.tryApplySuper("doReadChildElement",[h,null,g]):this.tryApplySuper("doReadChildElement",[h,p,g])},doDoneReadingDocument:function(){for(var h=this._spectrumWithRefMolecules,p=0,g=h.length;p<g;++p){for(var f=h[p],m=f.getOwner(),C=f[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]||[],_=[],y=0,T=C.length;y<T;++y){var E=C[y].trim();if(E){var b=this.getLoadedObjById(E)||m&&m.getObjById&&m.getObjById(E);b&&_.push(b)}}_.length&&f.setRefMolecules(_),delete f[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]}this._spectrumWithRefMolecules=[]},_isInfoListElemTagName:function(h){return["metadatalist","parameterlist","conditionlist","substancelist"].indexOf(h)>=0},readSpectrum:function(h,p,g){var f=new Kekule.Spectroscopy.Spectrum;this.readSpectrumAttribs(f,h,p);var m=this;return this.iterateChildElements(h,f,this,function(C,_){m._handleChildResult(C,_,f,g)}),f},readSpectrumAttribs:function(h,p,g){for(var f=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(p,null,!0,g),m=Kekule.ObjUtils.getOwnedFieldNames(f),C=[],_=0,y=m.length;_<y;++_){var T=m[_],E=f[T];switch(Kekule.IO.CML.MOL_REF_ATTRIBS.indexOf(T)>=0&&C.push((E||"").trim()),T){case"id":this.setObjId(h,E);break;case"title":h.setTitle(E);break;case"type":var b=Kekule.IO.CmlSpectUtils.cmlSpectrumTypeToKekule(E);h.setSpectrumType(b);break;case"convention":this.setConvention(E);break;default:h.setInfoValue(T,E)}}if(C.length){var v=C.join(" ").split(/\s/);h[Kekule.IO.CML.SPECTRUM_OBJREF_FIELDNAME]=v,this._spectrumWithRefMolecules.push(h)}},_handleChildResult:function(h,p,g,f){var m=t.getLocalName(h).toLowerCase();m==="spectrumdata"||m==="peaklist"||(m==="sample"&&f.enableExtractSampleInsideSpectrum?this._handleSampleData(p,g,f):this._isInfoListElemTagName(m)&&this._handleInfoData(m,p,g))},_handleSampleData:function(h,p,g){for(var f=[],m=0,C=h.length;m<C;++m){var _=h[m];_ instanceof Kekule.Molecule&&(f.push(_),g.autoHideSampleInsideSpectrum&&_.setVisible&&_.setVisible(!1))}f.length&&this.setAdditionalRefMolecules(this.getAdditionalRefMolecules().concat(f))},_handleInfoData:function(h,p,g){for(var f=function(N,L,U,W){if(W==="metadatalist"){var M=U.metadataType;M===l.ANNOTATION_METATYPE?g.setAnnotation(N,L):M===l.INFO_METATYPE?g.setInfoValue(N,L):g.setMeta(N,L)}},m=function(N,L){var U=null;return N==="metadatalist"?U=null:N==="parameterlist"?U=L.setParameter:N==="conditionlist"?U=L.setCondition:N==="substancelist"||(U=L.setAnnotation),U}(h,g),C=0,_=p.length;C<_;++C){var y,T,E=m,b=p[C];if(b.key?(y=b.key,T=b.value):b instanceof Kekule.Scalar&&(y=b.getInfoValue("dictRef")||b.getName(),T=b),y){var v=this.getPrefixForNamespaceUri(l.JCAMP_NAMESPACE_URI)||null,I=g.getSpectrumType(),R=this._convertCmlSpectrumInfoKey(y,I,v);this._processCmlSpectrumInfoItem(y,R,T,b,g,h)||(E?E.apply(g,[R,T]):f(R,T,b,h))}}},_convertCmlSpectrumInfoKey:function(h,p,g){return u.cmlSpectrumInfoDataKeyToKekule(h,p,g)},_processCmlSpectrumInfoItem:function(h,p,g,f,m,C){if(p==="NMR.ObserveFrequency"){if(g instanceof Kekule.Scalar){var _=g.getValue(),y=g.getUnit();if(y&&y===Kekule.Unit.Frequency.HERTZ.symbol)return Kekule.UnitUtils.convertValue(_,y,Kekule.Unit.Frequency.MEGAHERTZ)<1&&g.setUnit(Kekule.Unit.Frequency.MEGAHERTZ.symbol),m.setParameter(p,g),!0}}else if(p==="NMR.ObserveNucleus"&&typeof g=="string"){var T=g.indexOf("C")>=0&&g.indexOf("13")>=0?Kekule.Spectroscopy.SpectrumNMR.TargetNucleus.C13:Kekule.Spectroscopy.SpectrumNMR.TargetNucleus.H;return m.setParameter(p,T),!0}return!1}}),Kekule.IO.CmlSpectrumWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlSpectrumWriter",initProperties:function(){this.defineProp("convention",{dataType:DataType.STRING,serializable:!1})},doCreateElem:function(h,p){return this.createChildElem("spectrum",p)},doWriteObject:function(h,p,g){var f=this.getSpectNamespaces();return this.addNamespaces(p.ownerDocument,f),this._addSchemaLocation(p.ownerDocument.documentElement),this.writeSpectrum(h,p,g)},getObjInfoKeysNeedToSaveToMetaList:function(h){var p=this.tryApplySuper("getObjInfoKeysNeedToSaveToMetaList",[h]);return p&&(p=s.exclude(p,["metaData","parameters","conditions","annotations"])),p},doWriteObjInfoValueItem:function(h,p,g,f,m){return this.writeObjMetaValueToListElem(g,h,p,l.INFO_METATYPE,f)},writeSpectrum:function(h,p,g){this.writeSpectrumAttribs(h,p,g),this.writeSpectrumInfoLists(h,p,g),this.writeSpectrumDataSections(h,p,g)},writeSpectrumAttribs:function(h,p){var g=[],f=h.getTitle();f&&g.push({key:"title",value:f});var m=Kekule.IO.CmlSpectUtils.kekuleSpectrumTypeToCml(h.getSpectrumType()||"");m&&g.push({key:"type",value:m});for(var C=0,_=g.length;C<_;++C)Kekule.IO.CmlDomUtils.setCmlElemAttribute(p,g[C].key,g[C].value,this.getDomHelper());var y=h.getRefMolecules();if(y&&y.length){var T=[];for(C=0,_=y.length;C<_;++C){var E=y[C],b=E&&E.getId&&E.getId();b||(b=this.autoIdentifyForObj(E)),b&&T.push(b)}if(T.length){var v=T.length>1?Kekule.IO.CML.MOL_REF_ATTRIBS[1]:Kekule.IO.CML.MOL_REF_ATTRIBS[0];Kekule.IO.CmlDomUtils.setCmlElemAttribute(p,v,T.join(" "),this.getDomHelper())}}},writeSpectrumInfoLists:function(h,p,g){for(var f=this.getDomHelper(),m=h.getSpectrumInfoCategories(),C=this._getSpectrumInfoProcessors(),_=h.getSpectrumType(),y=this.getPrefixForNamespaceUri(l.JCAMP_NAMESPACE_URI)||null,T=0,E=m.length;T<E;++T){var b,v=m[T],I=C[v];if(I&&I.listElemGetter&&I.infoWriter&&(b=I.listElemGetter.apply(this,[p,f])))for(var R=h.getSpectrumInfoKeysOfCategory(v),N=0,L=R.length;N<L;++N){var U=R[N],W=h.getSpectrumInfoValue(U,v);U==="NMR.ObserveFrequency"&&W instanceof Kekule.Scalar&&g.autoConvertNmrDataFreqToUnit&&(W=this._convertScalarUnit(W,g.autoConvertNmrDataFreqToUnit)),Kekule.ObjUtils.notUnset(W)&&I.infoWriter.apply(this,[h,Kekule.IO.CmlSpectUtils.kekuleSpectrumInfoDataKeyToCml(U,_,y),W,b,g])}}},_convertScalarUnit:function(h,p){var g=h.getUnit(),f=h.getValue();if(f){var m=Kekule.Unit.getUnit(g),C=Kekule.Unit.getUnit(p);if(m&&C&&m.category===C.category&&m!==C){var _=h.clone();return _.setUnit(p),_.setValue(m.convertValueTo(f,C)),_}}return h},_getSpectrumInfoProcessors:function(){return{metaData:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"metaDataList"),infoWriter:this._writeSpectrumMeta},annotations:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"metaDataList"),infoWriter:this._writeSpectrumAnnotation},conditions:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"conditionList"),infoWriter:this._writeSpectrumCondition},parameters:{listElemGetter:this._spectrumInfoListElemGetter.bind(this,"parameterList"),infoWriter:this._writeSpectrumParameter}}},_spectrumInfoListElemGetter:function(h,p,g){var f=g.getElementsByTagNameNS(this.getCoreNamespaceURI(),h,p)[0];return f||(f=this.createChildElem(h,p)),f},_writeSpectrumMeta:function(h,p,g,f,m){this.writeObjMetaValueToListElem(h,p,g,null,f,null,m)},_writeSpectrumAnnotation:function(h,p,g,f,m){this.writeObjMetaValueToListElem(h,p,g,l.ANNOTATION_METATYPE,f,null,m)},_writeSpectrumCondition:function(h,p,g,f,m){if(g instanceof ObjectEx){var C=this.doGetChildObjectWriter(g,h,this);C&&C.writeObject(g,f,m)}else this.writeObjMetaValueToListElem(h,p,g,null,f,null,m)},_writeSpectrumParameter:function(h,p,g,f,m){var C=this.createChildElem("parameter",f);if(C.setAttribute("dictRef",p),DataType.isSimpleValue(g))C.setAttribute("value",DataType.StringUtils.serializeValue(g));else if(DataType.isObjectExValue(g)){var _=this.doGetChildObjectWriter(g,h,this);_&&_.writeObject(g,C,m)}},writeSpectrumDataSections:function(h,p,g){for(var f=0,m=h.getDataSectionCount();f<m;++f){var C=h.getDataSectionAt(f),_=this.createDataSectionWriter(C);_&&_.writeObject(C,p,g)}},createDataSectionWriter:function(h){var p=h.getMode()===Kekule.Spectroscopy.DataMode.PEAK?Kekule.IO.CmlSpectrumPeakListWriter:Kekule.IO.CmlSpectrumDataWriter,g=p&&new p;return g&&(this.copySettingsToChildHandler(g),this._appendChildHandler(g)),g},getSpectNamespaces:function(){var h=function(p,g){return{prefix:p,namespaceURI:g}};return[h(l.XML_SCHEMA_INSTANCE_NAMESPACE_DEF_PREFIX,l.XML_SCHEMA_INSTANCE_NAMESPACE_URI),h(l.SI_UNITS_NAMESPACE_DEF_PREFIX,l.SI_UNITS_NAMESPACE_URI),h(l.UNITS_NAMESPACE_DEF_PREFIX,l.UNITS_NAMESPACE_URI),h(l.JSPECVIEW_NAMESPACE_DEF_PREFIX,l.JSPECVIEW_NAMESPACE_URI),h(l.JCAMP_NAMESPACE_DEF_PREFIX,l.JCAMP_NAMESPACE_URI),h(l.JCAMP_UNITS_NAMESPACE_DEF_PREFIX,l.JCAMP_UNITS_NAMESPACE_URI),h(l.CML_DICT_NAMESPACE_DEF_PREFIX,l.CML_DICT_NAMESPACE_URI)]},_addSchemaLocation:function(h){this.getDomHelper().setAttributeNS(l.XML_SCHEMA_INSTANCE_NAMESPACE_URI,l.CMLSPECT_SCHEMA_LOCATIONS_ATTRIBNAME,l.CMLSPECT_SCHEMA_LOCATIONS.join("    "),h)}}),Kekule.Spectroscopy.MetaPropNamespace.register("cml");var c=Kekule.IO.CmlElementReaderFactory;c.register("spectrum",Kekule.IO.CmlSpectrumReader),c.register("peakList",Kekule.IO.CmlSpectrumPeakListReader),c.register("peak",Kekule.IO.CmlSpectrumPeakReader),c.register("peakStructure",Kekule.IO.CmlSpectrumPeakStructureReader),c.register("spectrumData",Kekule.IO.CmlSpectrumDataReader),c.register(["parameterList","substanceList"],Kekule.IO.CmlBaseListReader),c.register("sample",Kekule.IO.CmlSampleReader),c.register(["xaxis","yaxis"],Kekule.IO.CmlSpectrumDataAxisReader),Kekule.IO.CmlElementWriterFactory.register("Kekule.Spectroscopy.Spectrum",Kekule.IO.CmlSpectrumWriter);var d=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.CML);Kekule.IO.ChemDataWriterManager.register("cml",Kekule.IO.CmlWriter,[Kekule.Spectroscopy.Spectrum],[d])}(),function(){Kekule._registerAfterLoadSysProc(function(){if(Kekule.Render&&Kekule.Render.ChemObj2DRenderer){Kekule.globalOptions.add("render.spectrum",{continuousSpectrumResampleRatio:1});var s=Kekule.CoordUtils,e=Kekule.ArrayUtils;Kekule.Render.SpectrumDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.SpectrumDisplayConfigs",initProperties:function(){this.addHashConfigProp("defSize2DRatio"),this.addBoolConfigProp("reversedAxises",!1),this.addBoolConfigProp("reverseIndependentDataDirection",!1),this.addBoolConfigProp("reverseDependentDataDirection",!1),this.addBoolConfigProp("reverseIndependentAxisAlign",!1),this.addBoolConfigProp("reverseDependentAxisAlign",!1),this.addStrConfigProp("dataColor","#000000"),this.addFloatConfigProp("dataStrokeWidthRatio",.025),this.addFloatConfigProp("dataStrokeWidthMin",1),this.addFloatConfigProp("dataStrokeWidthMax",void 0),this.addFloatConfigProp("dataStrokeWidthFixed",void 0),this.addFloatConfigProp("visibleIndependentDataRangeFrom",0),this.addFloatConfigProp("visibleIndependentDataRangeTo",1),this.addFloatConfigProp("visibleDependentDataRangeFrom",-.05),this.addFloatConfigProp("visibleDependentDataRangeTo",1.05),this.addFloatConfigProp("visibleIndependentDataRangeFrom_Peak",-.05),this.addFloatConfigProp("visibleIndependentDataRangeTo_Peak",1.05),this.addFloatConfigProp("visibleDependentDataRangeFrom_Peak",-.05),this.addFloatConfigProp("visibleDependentDataRangeTo_Peak",1.05),this.addFloatConfigProp("visibleIndependentDataRangeFrom_Continuous",0),this.addFloatConfigProp("visibleIndependentDataRangeTo_Continuous",1),this.addFloatConfigProp("visibleDependentDataRangeFrom_Continuous",-.05),this.addFloatConfigProp("visibleDependentDataRangeTo_Continuous",1.05),this.addBoolConfigProp("displayIndependentAxis",!0),this.addBoolConfigProp("displayIndependentAxisScales",!0),this.addBoolConfigProp("displayIndependentAxisLabel",!0),this.addBoolConfigProp("displayIndependentAxisUnit",!0),this.addBoolConfigProp("displayDependentAxis",!0),this.addBoolConfigProp("displayDependentAxisScales",!0),this.addBoolConfigProp("displayDependentAxisLabel",!0),this.addBoolConfigProp("displayDependentAxisUnit",!0),this.addBoolConfigProp("displaySpectrum",!0),this.addStrConfigProp("axisScaleLabelFontFamily","Arial, Helvetica, sans-serif"),this.addFloatConfigProp("axisScaleLabelFontSize",7),this.addStrConfigProp("axisScaleLabelColor","#000000"),this.addStrConfigProp("axisLabelFontFamily","Arial, Helvetica, sans-serif"),this.addFloatConfigProp("axisLabelFontSize",10),this.addStrConfigProp("axisLabelColor","#000000"),this.addStrConfigProp("axisColor","#000000"),this.addFloatConfigProp("axisWidthRatio",.025),this.addFloatConfigProp("axisWidthMin",1),this.addFloatConfigProp("axisWidthMax",void 0),this.addFloatConfigProp("axisWidthFixed",void 0),this.addFloatConfigProp("axisScaleMarkSizeRatio",.1),this.addFloatConfigProp("axisScaleMarkSizeMin",3),this.addFloatConfigProp("axisScaleMarkSizeMax",void 0),this.addFloatConfigProp("axisScaleMarkSizeFixed",void 0),this.addFloatConfigProp("axisUnlabeledScaleSizeRatio",.7),this.addIntConfigProp("axisScaleMarkPreferredCount",10),this.addFloatConfigProp("axisLabelPaddingRatio",.02),this.addFloatConfigProp("axisScaleLabelPaddingRatio",.02)},initPropDefValues:function(){this.tryApplySuper("initPropDefValues"),this.setDefSize2DRatio({x:12,y:8})},doGetPropNameToHashPrefix:function(){return"spectrum_"}}),ClassEx.extendMethod(Kekule.Render.Render2DConfigs,"initProperties",function(n){n(),this.addConfigProp("spectrumDisplayConfigs","Kekule.Render.SpectrumDisplayConfigs")}),ClassEx.extendMethod(Kekule.Render.Render2DConfigs,"initPropDefValues",function(n){n(),this.setPropStoreFieldValue("spectrumDisplayConfigs",new Kekule.Render.SpectrumDisplayConfigs)}),ClassEx.extendMethod(Kekule.Spectroscopy.Spectrum,"initPropValues",function(n){n();var i=this.getSize2D();if(!i){var r=Kekule.Render.Render2DConfigs.getInstance(),a=r.getSpectrumDisplayConfigs().getDefSize2DRatio(),o=r.getLengthConfigs().getDefScaleRefLength();a&&o&&(i=s.multiply(a,o)),this.setSize2D(i)}}),ClassEx.extendMethod(Kekule.Spectroscopy.Spectrum,"doGetObjAnchorPosition",function(n,i){return Kekule.ObjAnchorPosition.CENTER}),ClassEx.extend(Kekule.Spectroscopy.Spectrum,{getDisplayedDataSections:function(){return[this.getActiveDataSection()]},getPseudoRenderSubObject:function(n,i){var r=this.__$subRenderObjs$__;r||(r={},this.__$subRenderObjs$__=r);var a=r[n];return a||i||(a={parent:this},r[n]=a),a},isChildPseudoRenderSubObject:function(n){return this.__$subRenderObjs$__&&this.__$subRenderObjs$__.indexOf(n)>=0},getDataItemOverridenRenderOptions:function(n){for(var i=0,r=this.getDataSectionCount();i<r;++i){var a=this.getDataSectionAt(i);if(a.indexOfDataItem(n)>=0)return a.getDataItemOverridenRenderOptions(n)}return null},setDataItemRenderOptions:function(n,i){for(var r=0,a=this.getDataSectionCount();r<a;++r){var o=this.getDataSectionAt(r);o.indexOfDataItem(n)>=0&&o.setDataItemRenderOptions(n,i)}},setDataItemOverrideRenderOptions:function(n,i){for(var r=0,a=this.getDataSectionCount();r<a;++r){var o=this.getDataSectionAt(r);o.indexOfDataItem(n)>=0&&o.setDataItemOverrideRenderOptions(n,i)}},addDataItemOverrideRenderOptionItem:function(n,i){for(var r=0,a=this.getDataSectionCount();r<a;++r){var o=this.getDataSectionAt(r);o.indexOfDataItem(n)>=0&&o.addDataItemOverrideRenderOptionItem(n,i)}},removeDataItemOverrideRenderOptionItem:function(n,i){for(var r=0,a=this.getDataSectionCount();r<a;++r){var o=this.getDataSectionAt(r);o.indexOfDataItem(n)>=0&&o.removeDataItemOverrideRenderOptionItem(n,i)}}}),ClassEx.extend(Kekule.Spectroscopy.SpectrumDataSection,{_getDataItemSpecifiedRenderOptions:function(n,i){var r=this.getExtraInfoOf(n);if(r||(r=this.createDefaultExtraInfoObjectFor(n)),r)return r instanceof ObjectEx&&r.hasProperty(i)?r.getPropValue(i):r[i]},_setDataItemSpecifiedRenderOptions:function(n,i,r){var a=this.getExtraInfoOf(n);a||(a=this.createDefaultExtraInfoObjectFor(n)),a&&(a instanceof ObjectEx&&a.hasProperty(i)?a.setPropValue(i,r):a[i]=r)},getDataItemRenderOptions:function(n){return this._getDataItemSpecifiedRenderOptions(n,"renderOptions")},setDataItemRenderOptions:function(n,i){return this._setDataItemSpecifiedRenderOptions(n,"renderOptions",i)},getDataItemOverrideRenderOptionItems:function(n){return this._getDataItemSpecifiedRenderOptions(n,"overrideRenderOptionItems")},setDataItemOverrideRenderOptionItems:function(n,i){return this._setDataItemSpecifiedRenderOptions(n,"overrideRenderOptionItems",i)},addDataItemOverrideRenderOptionItem:function(n,i){var r=this.getExtraInfoOf(n);if(r||(r=this.createDefaultExtraInfoObjectFor(n)),r)if(r.addOverrideRenderOptionItem)r.addOverrideRenderOptionItem(i);else{var a=this.getDataItemOverrideRenderOptionItems();if(a){var o=a.indexOf(i);o>=0&&a.splice(o,1),a.push(i)}else a=[i],this.setDataItemOverrideRenderOptionItems(n,a)}},removeDataItemOverrideRenderOptionItem:function(n,i){var r=this.getExtraInfoOf(n);if(r)if(r.removeOverrideRenderOptionItem)r.removeOverrideRenderOptionItem(i);else{var a=this.getDataItemOverrideRenderOptionItems();if(a){var o=a.indexOf(i);o>=0&&a.splice(o,1)}}},getDataItemOverridenRenderOptions:function(n){var i=this.getExtraInfoOf(n);if(i){if(i.getOverriddenRenderOptions)return i.getOverriddenRenderOptions();for(var r=i.renderOptions||{},a=Object.extend({},r),o=i.overrideRenderOptionItems||[],l=0,u=o.length;l<u;++l)a=Object.extend(a,o[l]);return a}return null}}),ClassEx.extendMethod(Kekule.Spectroscopy.SpectrumDataSection,"_extractAllExtraInfoOfDataItems",function(n){for(var i=n()||[],r=[],a=0,o=i.length;a<o;++a){var l=i[a];if(l&&!(l instanceof Kekule.ChemObject)&&DataType.isObjectValue(l)&&l.overrideRenderOptions){var u=Object.create(l);u.overrideRenderOptions=void 0,r.push(u)}else r.push(l)}return r}),Kekule._registerAfterLoadSysProc(function(){var n,i,r,a,o=function(u,c,d,h,p){for(var g=e.toArray(h),f=p||[""],m=0,C=g.length;m<C;++m)for(var _=0,y=f.length;_<y;++_){var T=f[_]?f[_]+c.upperFirst():c;u.push({name:"spectrum_"+T,dataType:d,targetClass:g[m]})}};if(Kekule.PropertyEditor&&Kekule.PropertyEditor.ChemRender2DOptionsEditor){var l=ClassEx.getPrototype(Kekule.PropertyEditor.ChemRender2DOptionsEditor);l.CHILD_FIELD_INFOS=l.CHILD_FIELD_INFOS.concat((n=[],i=Kekule.Spectroscopy.Spectrum,r=Kekule.Spectroscopy.SpectrumDataSection,a=["","independent","dependent"],o(n,"reversedAxises",DataType.BOOL,i),o(n,"reverseIndependentDataDirection",DataType.BOOL,i),o(n,"reverseDependentDataDirection",DataType.BOOL,i),o(n,"reverseIndependentAxisAlign",DataType.BOOL,i),o(n,"reverseDependentAxisAlign",DataType.BOOL,i),o(n,"dataColor",DataType.STRING,[i,r]),o(n,"dataStrokeWidthRatio",DataType.FLOAT,[i,r]),o(n,"dataStrokeWidthMin",DataType.NUMBER,[i,r]),o(n,"dataStrokeWidthMax",DataType.NUMBER,[i,r]),o(n,"dataStrokeWidthFixed",DataType.NUMBER,[i,r]),o(n,"visibleIndependentDataRangeFrom_Continuous",DataType.FLOAT,i),o(n,"visibleIndependentDataRangeTo_Continuous",DataType.FLOAT,i),o(n,"visibleDependentDataRangeFrom_Continuous",DataType.FLOAT,i),o(n,"visibleDependentDataRangeTo_Continuous",DataType.FLOAT,i),o(n,"visibleIndependentDataRangeFrom_Peak",DataType.FLOAT,i),o(n,"visibleIndependentDataRangeTo_Peak",DataType.FLOAT,i),o(n,"visibleDependentDataRangeFrom_Peak",DataType.FLOAT,i),o(n,"visibleDependentDataRangeTo_Peak",DataType.FLOAT,i),o(n,"displayIndependentAxis",DataType.BOOL,i),o(n,"displayIndependentAxisScales",DataType.BOOL,i),o(n,"displayIndependentAxisLabel",DataType.BOOL,i),o(n,"displayIndependentAxisUnit",DataType.BOOL,i),o(n,"displayDependentAxis",DataType.BOOL,i),o(n,"displayDependentAxisScales",DataType.BOOL,i),o(n,"displayDependentAxisLabel",DataType.BOOL,i),o(n,"displayDependentAxisUnit",DataType.BOOL,i),o(n,"displaySpectrum",DataType.BOOL,i),o(n,"axisScaleLabelFontFamily",DataType.STRING,i,a),o(n,"axisScaleLabelFontSize",DataType.NUMBER,i,a),o(n,"axisScaleLabelColor",DataType.STRING,i,a),o(n,"axisLabelFontFamily",DataType.STRING,i,a),o(n,"axisLabelFontSize",DataType.NUMBER,i,a),o(n,"axisLabelColor",DataType.STRING,i,a),o(n,"axisColor",DataType.STRING,i,a),o(n,"axisWidthRatio",DataType.FLOAT,i,a),o(n,"axisWidthMin",DataType.NUMBER,i,a),o(n,"axisWidthMax",DataType.NUMBER,i,a),o(n,"axisWidthFixed",DataType.NUMBER,i,a),o(n,"axisScaleMarkSizeRatio",DataType.FLOAT,i,a),o(n,"axisScaleMarkSizeMin",DataType.NUMBER,i,a),o(n,"axisScaleMarkSizeMax",DataType.NUMBER,i,a),o(n,"axisScaleMarkSizeFixed",DataType.NUMBER,i,a),o(n,"axisUnlabeledScaleSizeRatio",DataType.FLOAT,i,a),o(n,"axisScaleMarkPreferredCount",DataType.NUMBER,i,a),o(n,"axisLabelPaddingRatio",DataType.FLOAT,i,a),o(n,"axisScaleLabelPaddingRatio",DataType.NUMBER,i,a),n))}}),Kekule.Render.CoordAxisRender2DUtils={drawAxises:function(n,i,r,a,o,l){var u=function(I,R,N,L){for(var U=Kekule.Render.RichTextUtils,W=[],M=L?Math.round(Math.log10(N)):null,B=0,V=I.length;B<V;++B){var J,$=I[B],q=(M?$/N:$).toFixed(R);if(!M||Kekule.NumUtils.isFloatEqual(q,0))J=U.strToRichText(q);else{J=U.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR});var Q=U.appendText2(J,q+"×10");U.appendText(J,M.toFixed(0),{textType:Kekule.Render.RichText.SUP,refItem:Q})}W.push(J)}return W},c=!!o.abscissaDataRange,d=!!o.ordinateDataRange;if(!c&&!d)return null;var h=c&&o.abscissaScales?u(o.abscissaScales,o.abscissaScaleFixedDigitCountAfterPoint,o.abscissaScaleBase,o.abscissaScaleUseSciForm):null,p=d&&o.ordinateScales?u(o.ordinateScales,o.ordinateScaleFixedDigitCountAfterPoint,o.ordinateScaleBase,o.ordinateScaleUseSciForm):null,g=Kekule.Render.RichTextUtils,f=Object.create(o);if(c){if(f.abscissaLabel&&f.abscissaUnitLabel){var m=Kekule.Render.RichTextUtils.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR});g.append(m,f.abscissaLabel),g.appendText(m," ("),g.append(m,f.abscissaUnitLabel),g.appendText(m,")"),f.abscissaLabel=m}else f.abscissaLabel=f.abscissaLabel||f.abscissaUnitLabel;f.abscissaUnitLabel=null}d&&(f.ordinateLabel&&f.ordinateUnitLabel?(m=Kekule.Render.RichTextUtils.createGroup(null,{charDirection:Kekule.Render.TextDirection.LTR}),g.append(m,f.ordinateLabel),g.appendText(m," ("),g.append(m,f.ordinateUnitLabel),g.appendText(m,")"),f.ordinateLabel=m):f.ordinateLabel=f.ordinateLabel||f.ordinateUnitLabel,f.ordinateUnitLabel=null);var C,_=c?t._estimateAxisSizes(n,i,r,a,h,f.abscissaUnitLabel,f.abscissaLabel,l,!0,f.abscissaAxisPosition===1):null,y=d?t._estimateAxisSizes(n,i,r,a,p,f.ordinateUnitLabel,f.ordinateLabel,l,!1,f.ordinateAxisPosition===0):null,T=n.createGroup(r),E=Object.create(a),b=Object.create(a);if(y&&(o.ordinateAxisPosition===0?E.x1+=Math.min(y.total.x,E.x2-E.x1):E.x2-=Math.min(y.total.x,E.x2-E.x1)),_&&(o.abscissaAxisPosition===1?b.y1+=Math.min(_.total.y,b.y2-b.y1):b.y2-=Math.min(_.total.y,b.y2-b.y1)),c){var v=h;(C=t._drawSingleAxis(n,i,r,E,f.abscissaDataRange,f.abscissaScales,v,f.abscissaUnitLabel,f.abscissaLabel,_,l,!0,f.abscissaAxisPosition===1,f.abscissaReversedDirection))&&n.addToGroup(C,T)}return d&&(v=p,(C=t._drawSingleAxis(n,i,r,b,f.ordinateDataRange,f.ordinateScales,v,f.ordinateUnitLabel,f.ordinateLabel,y,l,!1,f.ordinateAxisPosition!==1,f.ordinateReversedDirection))&&n.addToGroup(C,T)),{drawnElem:T,clientBox:{x1:E.x1,x2:E.x2,y1:b.y1,y2:b.y2},abscissaRenderBox:E,ordinateRenderBox:b}},_drawSingleAxis:function(n,i,r,a,o,l,u,c,d,h,p,g,f,m){var C=Kekule.Render.BoxXAlignment,_=Kekule.Render.BoxYAlignment,y=f,T=g?"x":"y",E=g?"y":"x",b=(g?p.abscissa:p.ordinate)||p,v={x:a.x2-a.x1,y:a.y2-a.y1};if(v.x<=0||v.y<=0)return null;var I,R,N=n.createGroup(r),L={x:a.x1,y:a.y1},U=g?!m:m,W={},M={},B=0;d&&(W[T]=L[T]+v[T]/2-h.axisLabel[T]/2*(g?1:-1),W[E]=L[E]+(y?h.axisLabelPadding[E]+h.axisLabel[E]/2:v[E]-(h.axisLabelPadding[E]+h.axisLabel[E]/2)),I=Object.extend(Object.extend({},b.axisLabel),{textBoxXAlignment:C.LEFT,textBoxYAlignment:_.CENTER}),g||(I.transforms=[{rotate:-Math.PI/2,center:Object.extend({},W)}]),R=i.drawEx(r,W,d,I).drawnObj,n.addToGroup(R,N),B+=h.axisLabel[E]+2*h.axisLabelPadding[E]);var V=Object.create(b.axis);if(V.strokeColor||(V.strokeColor=V.color),V.fillColor||(V.fillColor=V.color),l&&u){var J=o.max-o.min,$=g?{textBoxXAlignment:C.LEFT,textBoxYAlignment:y?_.BOTTOM:_.TOP}:{textBoxXAlignment:C.LEFT,textBoxYAlignment:_.CENTER};I=Object.extend(Object.create(b.scaleLabel),$),W[E]=y?L[E]+B+h.scaleLabel[E]+h.scaleLabelPadding[E]:L[E]+v[E]-B-h.scaleLabel[E]-h.scaleLabelPadding[E];var q={};q[E]=W[E];for(var Q=v[T]/(u.length-1),ie=Q,Y=1;ie<h.scaleLabel[T]&&Q>0;)++Y,ie+=Q;for(var ne=0,de=l.length;ne<de;++ne){var Ae=(U?l[ne]-o.min:o.max-l[ne])/J*v[T]+L[T];W[T]=Ae;var Ce=!1;if(ne%Y==0){if(q[T]=W[T],g){var pe=i.measure(r,q,u[ne],I);q.x=W.x-pe.width/2}else y&&(pe=i.measure(r,q,u[ne],I),q.x=W.x-pe.width);R=i.drawEx(r,q,u[ne],I).drawnObj,n.addToGroup(R,N),Ce=!0}var fe={x:W.x,y:W.y},Te=h.scaleMark[E];fe[E]+=(Te+h.scaleLabelPadding[E])*(f?1:-1),Ce||(Te*=V.unlabeledScaleSizeRatio||1),M[T]=Ae,M[E]=fe[E]-Te*(f?1:-1),R=n.drawLine(r,fe,M,V),n.addToGroup(R,N)}B+=h.scaleLabel[E]+2*h.scaleLabelPadding[E]+h.scaleMark[E]}return W[T]=L[T],W[E]=y?L[E]+B+h.axis[E]/2:L[E]+v[E]-B-h.axis[E]/2,M[T]=W[T]+v[T],M[E]=W[E],R=n.drawLine(r,W,M,Object.extend({lineCap:"square"},V)),n.addToGroup(R,N),N},_estimateAxisSizes:function(n,i,r,a,o,l,u,c,d,h){var p=(d?c.abscissa:c.ordinate)||c,g={x:0,y:0},f={x:0,y:0};if(o&&o.length){var m=o[0],C=o[o.length-1],_=i.measure(r,{x:0,y:0},m,p.scaleLabel),y=i.measure(r,{x:0,y:0},C,p.scaleLabel);g={x:Math.max(_.width,y.width),y:Math.max(_.height,y.height)},f={x:p.scaleLabel.padding||0,y:p.scaleLabel.padding||0}}var T={x:0,y:0};if(l){var E=i.measure(r,{x:0,y:0},l,p.unitLabel);T.x=Math.max(g.x,E.width),T.y=Math.max(g.y,E.height)}var b={x:0,y:0},v={x:0,y:0};if(u){var I=i.measure(r,{x:0,y:0},u,p.axisLabel);b=d?{x:I.width,y:I.height}:{y:I.width,x:I.height},v={x:p.axisLabel&&p.axisLabel.padding||0,y:p.axisLabel&&p.axisLabel.padding||0}}var R=p.axis,N=d?{x:0,y:R.scaleMarkSize}:{x:R.scaleMarkSize,y:0},L=d?{x:0,y:R.strokeWidth}:{x:R.strokeWidth,y:0},U={};return d?(U.x=a.x2-a.x1,U.y=g.y+b.y+L.y+N.y+2*f.y+2*v.y):(U.y=a.y2-a.y1,U.x=g.x+b.x+L.x+N.x+2*f.x+2*v.x),{total:U,axis:L,scaleMark:N,scaleLabel:g,scaleLabelPadding:f,unitLabel:T,axisLabel:b,axisLabelPadding:v}}};var t=Kekule.Render.CoordAxisRender2DUtils;Kekule.Render.Spectrum2DRenderUtils={_getDataDefaultAxisDirection:function(n,i,r){var a=Kekule.Spectroscopy.SpectrumType,o=Kekule.Unit,l=!0;return n===a.NMR&&i&&(l=!1),n===a.IR&&i&&r&&o.getUnit(r).category===o.WaveNumber?!1:l},_getDataDefaultAxisAlign:function(n,i,r){return Kekule.Spectroscopy.SpectrumType,Kekule.Unit,!0},getDefaultAxisDirectionAndAlignInfo:function(n,i,r){return{reversedDirection:!Kekule.Render.Spectrum2DRenderUtils._getDataDefaultAxisDirection(n,i,r),reversedAlign:!Kekule.Render.Spectrum2DRenderUtils._getDataDefaultAxisAlign(n,i,r)}}},Kekule.Render.Spectrum2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.Spectrum2DRenderer",initialize:function(n,i,r){this.tryApplySuper("initialize",[n,i,r]),this._initSectionDataDrawerMap()},_initSectionDataDrawerMap:function(){Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap[Kekule.Spectroscopy.DataMode.CONTINUOUS]=this.doDrawContinuousSectionData,Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap[Kekule.Spectroscopy.DataMode.PEAK]=this.doDrawPeakSectionData},_initSpectrumDefSize:function(n,i){if(!n.getSize2D()){var r=s.multiply(i.spectrum_defSize2DRatio,i.defScaleRefLength*(i.unitLength||1));n.setSize2D(r)}},doDrawSelf:function(n,i,r){var a=r._spectrum_render_enable_sub_bounds;this.tryApplySuper("doDrawSelf",[n,i,r]);var o=this.getChemObj();i||(i=this.getAutoBaseCoord(r)),this._initSpectrumDefSize(o,r);var l,u=o.getExposedContainerBox(),c={x:u.x1,y:u.y2},d={x:u.x2,y:u.y1},h=this.transformCoordToContext(n,o,c),p=this.transformCoordToContext(n,o,d),g=Kekule.CoordUtils.substract(p,h),f={x:i.x-g.x/2,y:i.y-g.y/2},m=f,C=Kekule.CoordUtils.add(f,g),_=Kekule.BoxUtils.createBox(m,C),y=this._getActualRenderOptions(n,o,r),T=this.doGetTargetDataSections(o);if(T&&T.length){var E=this.doGetDataVarInfos(T);if(E){var b,v=this._getAxisDirectionAndAlignInfo(n,o,R,E.varUnitSymbols,y),I=this._getDisplayRangeOfSections(o,o.getData(),T,E,v,y),R=E.varSymbols;if(Kekule.NumUtils.isFloatEqual(I[R.independant].min,I[R.independant].max)||Kekule.NumUtils.isFloatEqual(I[R.dependant].min,I[R.dependant].max))return Kekule.error(Kekule.$L("ErrorMsg.VISIBLE_DATA_RANGE_IS_EMPTY")),null;l=this.createDrawGroup(n);var N=this._prepareAxisRenderParamsAndOptions(this.getActualTargetContext(n),o,I,R,y,v),L=Kekule.Render.CoordAxisRender2DUtils.drawAxises(this.getDrawBridge(),this.getRichTextDrawer(),this.getActualTargetContext(n),_,N.drawParams,N.renderOptions);if(this.getRenderCache(n).spectrum_reversedAxises=y.spectrum_reversedAxises,L?(this.addToDrawGroup(L.drawnElem,l),b=L.clientBox,a&&(L.abscissaRenderBox&&this.basicDrawObjectUpdated(n,o.getPseudoRenderSubObject("abscissaIndicator"),o,this.createRectBoundInfo({x:L.abscissaRenderBox.x1,y:L.abscissaRenderBox.y1},{x:L.abscissaRenderBox.x2,y:L.abscissaRenderBox.y2}),Kekule.Render.ObjectUpdateType.ADD),L.ordinateRenderBox&&this.basicDrawObjectUpdated(n,o.getPseudoRenderSubObject("ordinateIndicator"),o,this.createRectBoundInfo({x:L.ordinateRenderBox.x1,y:L.ordinateRenderBox.y1},{x:L.ordinateRenderBox.x2,y:L.ordinateRenderBox.y2}),Kekule.Render.ObjectUpdateType.ADD))):b=_,!r||r.spectrum_displaySpectrum!==!1){var U=this.doCalcSprectrumTransformMatrixes(o,T,R,I,b,y,v),W=U.dataTransformMatrix;y.spectrumDataTransformMatrix=W,this.getRenderCache(n).spectrumDataTransformMatrix=W,this.getRenderCache(n).spectrumInvDataTransformMatrix=U.dataTransformInvMatrix;var M=this.doDrawDataSections(o,T,R,n,u,b,W,I,y);M&&this.addToDrawGroup(M,l),a&&this.basicDrawObjectUpdated(n,o.getPseudoRenderSubObject("data"),o,this.createRectBoundInfo({x:b.x1,y:b.y1},{x:b.x2,y:b.y2}),Kekule.Render.ObjectUpdateType.ADD)}this.basicDrawObjectUpdated(n,o,o,this.createRectBoundInfo(m,C),Kekule.Render.ObjectUpdateType.ADD)}}return l},_getActualRenderOptions:function(n,i,r){var a=i.getData().getSections().getRenderOptions(),o=Object.create(r);return o=Object.extend(o,a)},_getAxisDirectionAndAlignInfo:function(n,i,r,a,o){var l=i.getSpectrumType(),u=Kekule.Render.Spectrum2DRenderUtils.getDefaultAxisDirectionAndAlignInfo(l,!0,a.independant),c=Kekule.Render.Spectrum2DRenderUtils.getDefaultAxisDirectionAndAlignInfo(l,!1,a.dependant);return o.spectrum_reverseIndependentDataDirection&&(u.reversedDirection=!u.reversedDirection),o.spectrum_reverseIndependentAxisAlign&&(u.reversedAlign=!u.reversedAlign),o.spectrum_reverseDependentDataDirection&&(c.reversedDirection=!c.reversedDirection),o.spectrum_reverseDependentAxisAlign&&(c.reversedAlign=!c.reversedAlign),{independent:u,dependent:c}},_prepareAxisRenderParamsAndOptions:function(n,i,r,a,o,l){var u=o,c=u.spectrum_reversedAxises,d=u.contextRefLengthes.xy,h=u.unitLength,p=Kekule.oneOf,g={},f={},m=this,C=function(M,B){var V=Object.create(M);return V=Object.extend(V,B)},_=function(M,B,V){return p(M["spectrum_"+V+B.upperFirst()],M["spectrum_"+B])},y=function(M,B,V){var J=B.upperFirst(),$=p(M["spectrum_"+V+J],M["spectrum_"+B]),q=p(M["spectrum_"+V+J+"Fixed"],M["spectrum_"+B+"Fixed"]),Q=p(M["spectrum_"+V+J+"Min"],M["spectrum_"+B+"Min"]),ie=p(M["spectrum_"+V+J+"Max"],M["spectrum_"+B+"Max"]);if(M.zoom&&(Q||ie||q))if(q)$=q/M.zoom;else{var Y=$*M.zoom;Q&&Y<Q?$=Q/M.zoom:ie&&Y>ie&&($=ie/M.zoom)}return $},T=function(M,B,V,J,$){var q=p(M["spectrum_"+V+B.upperFirst()+"Fixed"],M["spectrum_"+B+"Fixed"]);if(q)Q=q;else{var Q=p(M["spectrum_"+V+B.upperFirst()+"Ratio"],M["spectrum_"+B+"Ratio"])*J,ie=p(M["spectrum_"+V+B.upperFirst()+"Min"],M["spectrum_"+B+"Min"]);ie&&(Q=Math.max(Q,ie));var Y=p(M["spectrum_"+V+B.upperFirst()+"Max"],M["spectrum_"+B+"Max"]);Y&&(Q=Math.min(Q,Y))}return Q*$},E=function(M,B,V,J){M[V+B.upperFirst()]=J},b=function(M,B){var V=M.getVariable(B),J=V.getDisplayLabel()||V.getName();return J?DataType.isObjectValue(J)?J:Kekule.Render.RichTextUtils.strToRichText(J):null},v=function(M,B){var V,J=M.getVariable(B),$=m.doGetVarDefUnit(J);if($){var q=Kekule.Unit.getUnit($);return q?q.symbolHtml?V=Kekule.Render.RichTextUtils.fromSimpleHtmlCode(q.symbolHtml):q.getKey()&&(V=Kekule.Render.RichTextUtils.strToRichText(q.getKey())):V=DataType.isObjectValue($)?$:Kekule.Render.RichTextUtils.strToRichText($),V}return null},I=c?"abscissa":"ordinate",R=c?"ordinate":"abscissa",N={},L={};if(u.spectrum_displayIndependentAxis){if(c?g.ordinate=N:g.abscissa=N,N.axis=C(u,{strokeWidth:T(u,"axisWidth","independent",d,h),scaleMarkSize:0,color:p(_(u,"axisColor","independent"),u.color)}),(u.spectrum_displayIndependentAxisLabel||u.spectrum_displayIndependentAxisUnit)&&(N.axisLabel=C(u,{fontFamily:_(u,"axisLabelFontFamily","independent"),fontSize:y(u,"axisLabelFontSize","independent")*h,color:_(u,"axisLabelColor","independent"),padding:T(u,"axisLabelPadding","independent",d,h)})),u.spectrum_displayIndependentAxisScales&&(N.scaleLabel=C(u,{fontFamily:_(u,"axisScaleLabelFontFamily","independent"),fontSize:y(u,"axisScaleLabelFontSize","independent")*h,color:p(_(u,"axisScaleLabelColor","independent"),u.color),padding:T(u,"axisScaleLabelPadding","independent",d,h)}),N.axis.scaleMarkSize=T(u,"axisScaleMarkSize","independent",d,h),N.axis.unlabeledScaleSizeRatio=_(u,"axisUnlabeledScaleSizeRatio","independent")),E(f,"dataRange",R,r[a.independant]),E(f,"axisPosition",R,l.independent.reversedAlign?1:0),E(f,"reversedDirection",R,l.independent.reversedDirection),u.spectrum_displayIndependentAxisScales){var U=_(u,"axisScaleMarkPreferredCount","independent");E(f,"scales",R,(W=Kekule.Spectroscopy.Utils.calcScalePointInfo(r[a.independant].min,r[a.independant].max,U)).scaleValues),E(f,"scaleBase",R,W.scaleBase),E(f,"scaleUseSciForm",R,W.useSciForm),E(f,"scaleFixedDigitCountAfterPoint",R,W.fixDigitsCountAfterPoint)}u.spectrum_displayIndependentAxisLabel&&E(f,"label",R,b(i,a.independant)),u.spectrum_displayIndependentAxisUnit&&E(f,"unitLabel",R,v(i,a.independant))}if(u.spectrum_displayDependentAxis){if(c?g.abscissa=L:g.ordinate=L,L.axis=C(u,{strokeWidth:T(u,"axisWidth","dependent",d,h),scaleMarkSize:0,color:p(_(u,"axisColor","dependent"),u.color)}),(u.spectrum_displayDependentAxisLabel||u.spectrum_displayDependentAxisUnit)&&(L.axisLabel=C(u,{fontFamily:_(u,"axisLabelFontFamily","dependent"),fontSize:y(u,"axisLabelFontSize","dependent")*h,color:_(u,"axisLabelColor","dependent"),padding:T(u,"axisLabelPadding","dependent",d,h)})),u.spectrum_displayDependentAxisScales&&(L.scaleLabel=C(u,{fontFamily:_(u,"axisScaleLabelFontFamily","dependent"),fontSize:y(u,"axisScaleLabelFontSize","dependent")*h,color:p(_(u,"axisScaleLabelColor","dependent"),u.color),padding:T(u,"axisScaleLabelPadding","dependent",d,h)}),L.axis.scaleMarkSize=T(u,"axisScaleMarkSize","dependent",d,h),L.axis.unlabeledScaleSizeRatio=_(u,"axisUnlabeledScaleSizeRatio","dependent")),E(f,"dataRange",I,r[a.dependant]),E(f,"axisPosition",I,l.dependent.reversedAlign?1:0),E(f,"reversedDirection",I,l.dependent.reversedDirection),u.spectrum_displayDependentAxisScales){var W;U=_(u,"axisScaleMarkPreferredCount","dependent"),E(f,"scales",I,(W=Kekule.Spectroscopy.Utils.calcScalePointInfo(r[a.dependant].min,r[a.dependant].max,U)).scaleValues),E(f,"scaleBase",I,W.scaleBase),E(f,"scaleUseSciForm",I,W.useSciForm),E(f,"scaleFixedDigitCountAfterPoint",I,W.fixDigitsCountAfterPoint)}u.spectrum_displayDependentAxisLabel&&E(f,"label",I,b(i,a.dependant)),u.spectrum_displayDependentAxisUnit&&E(f,"unitLabel",I,v(i,a.dependant))}return{renderOptions:g,drawParams:f}},doGetTargetDataSections:function(n){return n.getDisplayedDataSections()},doGetDataVarInfos:function(n){for(var i={},r={},a=0,o=n[0].getActualLocalVarInfos().length;a<o;++a){var l=n[0].getLocalVarDef(a);if(l.getDependency()===Kekule.VarDependency.DEPENDENT?(r.dependant=l.getSymbol(),i.dependant=this.doGetVarDefUnit(l)):(r.independant=l.getSymbol(),i.independant=this.doGetVarDefUnit(l)),r.dependant&&r.independant)break}return r.dependant&&r.independant?{varSymbols:r,varUnitSymbols:i}:null},doGetVarDefUnit:function(n){return n.getActualExternalUnit&&n.getActualExternalUnit()||n.getUnit()},doCalcSprectrumTransformMatrixes:function(n,i,r,a,o,l,u){var c=r.dependant,d=r.independant,h=a;if(h[c]&&h[d]){var p,g;u.independent.reversedDirection&&(l.spectrum_reversedAxises?g=!0:p=!0),u.dependent.reversedDirection&&(l.spectrum_reversedAxises?p=!0:g=!0);var f=l.spectrum_reversedAxises?[{y:h[d].min,x:h[c].min},{y:h[d].max,x:h[c].max}]:[{x:h[d].min,y:h[c].min},{x:h[d].max,y:h[c].max}],m=Kekule.BoxUtils.createBox(f[0],f[1]),C={translateX:p?-m.x2:-m.x1,translateY:g?-m.y1:-m.y2},_=Kekule.CoordUtils.calcTransform2DMatrix(C),y={scaleX:(o.x2-o.x1)/(m.x2-m.x1),scaleY:-(o.y2-o.y1)/(m.y2-m.y1),translateX:o.x1,translateY:o.y1};p&&(y.scaleX=-y.scaleX),g&&(y.scaleY=-y.scaleY);var T=_=Kekule.MatrixUtils.multiply(s.calcTransform2DMatrix(y),_),E=s.calcInverseTransform2DMatrix(y);return E=Kekule.MatrixUtils.multiply(s.calcInverseTransform2DMatrix(C),E),l.spectrumDataTransformInvMatrix=E,{dataTransformMatrix:T,dataTransformInvMatrix:E}}},_getDisplayRangeOfSections:function(n,i,r,a,o,l){for(var u=function(b,v,I,R,N){var L=R===Kekule.Spectroscopy.DataMode.PEAK?"_Peak":R===Kekule.Spectroscopy.DataMode.CONTINUOUS?"_Continuous":"",U=I?"dependent":"independent",W=N["spectrum_visible"+U.upperFirst()+"DataRangeFrom"+L]||0,M=N["spectrum_visible"+U.upperFirst()+"DataRangeTo"+L]||1,B=b;if(W!==0||M!==1){var V=(B.max-B.min)*W+B.min,J=(B.max-B.min)*(M-1)+B.max;return{min:Math.min(V,J),max:Math.max(V,J)}}return B},c=function(b,v,I,R,N){var L=I?"dependent":"independent",U=N["spectrum_viewport"+L.upperFirst()+"DataRangeFrom"]||0,W=N["spectrum_viewport"+L.upperFirst()+"DataRangeTo"]||1,M=b;if(U!==0||W!==1){var B=R?M.max:M.min,V=R?M.min:M.max,J=(V-B)*U+B,$=(V-B)*(W-1)+V;return{min:Math.min(J,$),max:Math.max(J,$)}}return M},d=a.varSymbols.independant,h=a.varSymbols.dependant,p={},g={},f=Kekule.Spectroscopy.DataMode.CONTINUOUS,m=0,C=r.length;m<C;++m){var _=r[m],y=_.getRenderOptions()||{},T=i.getDisplayRangeOfSection(_,null,{autoCalc:!0}),E=_.getMode();E===Kekule.Spectroscopy.DataMode.PEAK&&(f=E),g[d]=u(T[d],0,!1,E,y),g[h]=u(T[h],0,!0,E,y),p=Kekule.Spectroscopy.Utils.mergeDataRange(p,g)}return p[d]=u(p[d],0,!1,f,l),p[h]=u(p[h],0,!0,f,l),p[d]=c(p[d],0,!1,o.independent.reversedDirection,l),p[h]=c(p[h],0,!0,o.dependent.reversedDirection,l),p},_clipDataValuePairInsideVisibleRange:function(n,i,r,a){var o=[s.create(n[r.independant],n[r.dependant]),s.create(i[r.independant],i[r.dependant])],l=[s.create(a[r.independant].min,a[r.dependant].min),s.create(a[r.independant].max,a[r.dependant].max)],u=Kekule.GeometryUtils.clipLineSegmentByBox(o,l);if(u){var c={},d={};return c[r.independant]=u[0].x,c[r.dependant]=u[0].y,d[r.independant]=u[1].x,d[r.dependant]=u[1].y,[c,d]}return null},doDrawDataSections:function(n,i,r,a,o,l,u,c,d){for(var h=this.createDrawGroup(a),p=0,g=i.length;p<g;++p){var f=this.doDrawSectionData(n,i[p],a,l,d,r,u,c);f&&this.addToDrawGroup(f,h)}return h},_mergeParentAndLocalSpectrumDataRenderOptions:function(n,i){var r,a=Kekule.oneOf,o=n.contextRefLengthes.xy,l=a(i.unitLength,n.unitLength,1),u=a(i.spectrum_dataStrokeWidthFixed,n.spectrum_dataStrokeWidthFixed)||0;if(u)r=u;else{r=(a(i.spectrum_dataStrokeWidthRatio,n.spectrum_dataStrokeWidthRatio)||0)*o;var c=a(i.spectrum_dataStrokeWidthMin,n.spectrum_dataStrokeWidthMin)||0;c&&(r=Math.max(r,c));var d=a(i.spectrum_dataStrokeWidthMax,n.spectrum_dataStrokeWidthMax)||0;d&&(r=Math.min(r,d))}r=(r||a(i.strokeWidth,n.strokeWidth,1))*l;var h=Object.create(n);return h=Object.extend(h,{strokeColor:a(i.spectrum_dataColor,i.color,n.spectrum_dataColor,n.color),strokeWidth:r})},_prepareSectionDataActualRenderOptions:function(n,i,r,a){var o=a,l=i.getRenderOptions()||{};return this._mergeParentAndLocalSpectrumDataRenderOptions(o,l)},_getSpectrumDataValueItemRenderOptions:function(n,i,r){return i.getDataItemOverridenRenderOptions(r)},doDrawSectionData:function(n,i,r,a,o,l,u,c){if(i.getDataCount()<=0)return null;var d=i.getMode(),h=Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap[d],p=this._prepareSectionDataActualRenderOptions(n,i,r,o);return h&&h.apply(this,[n,i,r,a,p,l,u,c])},doDrawPeakSectionData:function(n,i,r,a,o,l,u,c){var d,h=this,p=function(E,b){var v=h._clipDataValuePairInsideVisibleRange(E,b,l,c);return v?[h._calcSectionDataValueContextCoord(v[0],l,u,o.spectrum_reversedAxises),h._calcSectionDataValueContextCoord(v[1],l,u,o.spectrum_reversedAxises)]:null},g=[],f=[],m=[];if(i.forEach(function(E,b){var v=i.getPeakRootValueOf(E);if(v&&E){(function(U,W,M){var B=W[W.length-1];W.length>1&&Kekule.NumUtils.isFloatEqual(B[M.dependant],U[M.dependant])?B[M.independant]=U[M.independant]:W.push(U)})(v,f,l);var I=p(v,E);if(I){var R=h._getSpectrumDataValueItemRenderOptions(n,i,E);if(R){R=h._mergeParentAndLocalSpectrumDataRenderOptions(o,R);var N=h.drawLine(r,I[0],I[1],R);m.push(N)}else{var L=function(U){var W=[];if(U&&U.length>1){var M=U[0];W.push("M"),W.push([M.x,M.y]);for(var B=1,V=U.length;B<V;++B)W.push("L"),W.push([U[B].x,U[B].y])}return W}(I);L&&L.length&&(g=g.concat(L))}}}}),f.length>1){f.length===2&&(f[0][l.independant]=c[l.independant].min,f[1][l.independant]=c[l.independant].max);for(var C=1,_=f.length;C<_;++C){var y=p(f[C-1],f[C]);y&&(g.push("M"),g.push([y[0].x,y[0].y]),g.push("L"),g.push([y[1].x,y[1].y]))}}if(g&&g.length){var T=Kekule.Render.DrawPathUtils.makePath.apply(this,g);m.unshift(this.drawPath(r,T,o))}if(m.length<1)d=null;else if(m.length===1)d=m[0];else for(d=this.createDrawGroup(r),C=0,_=m.length;C<_;++C)this.addToDrawGroup(m[C],d);return d},doDrawContinuousSectionData:function(n,i,r,a,o,l,u,c){var d,h=Object.create(o);h.lineCap="round";var p=this,g=function(Fe,Nt,Xe,vt){for(var yt=[],Ht=0,Dr=Fe.length;Ht<Dr;++Ht){var Mt=p._calcSectionDataValueContextCoord(Fe[Ht],Nt,Xe,vt);yt.push(Mt)}return yt},f={independent:i.getLocalVarDef(l.independant),dependent:i.getLocalVarDef(l.dependant)},m={independent:f.independent.getActualExternalUnit(),dependent:f.dependent.getActualExternalUnit()},C=Kekule.globalOptions.render.spectrum.continuousSpectrumResampleRatio||1,_=Math.abs(a.x2-a.x1)*C,y=(c[l.independant].max-c[l.independant].min)/_,T=this._getContinuousSpectrumSectionSamplingCache(r,i),E=!!T,b=E&&T.modifiedTime===i.getModifiedTime()&&Kekule.NumUtils.isFloatEqual(y,T.sampleMergeWidth)&&m.independent===T.indepUnit&&m.dependent===T.depUnit;E||(T={},this._setContinuousSpectrumSectionSamplingCache(r,i,T)),b||(T.modifiedTime=i.getModifiedTime(),T.sampleMergeWidth=y,T.indepUnit=m.independent,T.depUnit=m.dependent,T.items=[]);for(var v=function(Fe){return Math.floor((Fe[l.independant]-c[l.independant].min)/y)},I=function(Fe,Nt,Xe){Xe.push(Nt),Xe.fromIndex==null&&(Xe.fromIndex=Fe),Xe.toIndex=Fe;var vt=Nt[l.independant];Xe.indepValueSum=(Xe.indepValueSum||0)+vt},R=null,N=[],L=i.getDataCount(),U=L,W=0,M=0,B=[];W<L;){var V=null,J=null;if(b&&(V=this._getSectionCachedSamplingData(T.items,W,M))&&V.item&&(V.item.typicalValues&&(M=V.cacheIndex+1,W=V.dataValueToIndex),V.item.averageIndepValue<c[l.independant].min||V.item.averageIndepValue>c[l.independant].max||(J=V.item.typicalValues)),!V){var $=i.getHashValueAt(W),q=$[l.independant];if(!(q<c[l.independant].min||q>c[l.independant].max)){var Q=v($);R===null&&(R=Q),W==U-1||Q!==R?(W===U-1&&I(W,$,N),N.length&&((J=this._getMergeSectionDataTypicalValues(N,l))&&this._addSectionSamplingDataCacheItem(T.items,N,J,l),N=[],R=Q,W<U-1&&I(W,$,N))):I(W,$,N)}}J&&B.push(J),++W}var ie,Y,ne,de=[s.create(a.x1,a.y1),s.create(a.x2,a.y2)],Ae=[];for(W=0,U=B.length;W<U;++W){J=B[W];var Ce=(ne=J,p._clipDataValuePairInsideVisibleRange(ne[0],ne[1],l,c)),pe=null,fe=null,Te=null;if(Ce){var xe=g(Ce,l,u,o.spectrum_reversedAxises);if(pe=xe,ie)fe=[ie[ie.length-1],xe[0]];else if(Y){var Re=Y[Y.length-1],we=this._calcSectionDataValueContextCoord(Re,l,u,o.spectrum_reversedAxises);Te=Kekule.GeometryUtils.clipLineSegmentByBox([we,xe[0]],de)}ie=pe}else{if(ie){var Me=J[0];if(Me){var Le=this._calcSectionDataValueContextCoord(Me,l,u,o.spectrum_reversedAxises);Te=Kekule.GeometryUtils.clipLineSegmentByBox([ie[ie.length-1],Le],de)}}ie=null}if(Y=J,pe&&pe.length>1){Ae.push("M"),Ae.push([pe[0].x,pe[0].y]);for(var Ue=1,at=pe.length;Ue<at;++Ue)Ae.push("L"),Ae.push(pe[Ue].x,pe[Ue].y)}fe&&(Ae.push("M"),Ae.push([fe[0].x,fe[0].y]),Ae.push("L"),Ae.push([fe[1].x,fe[1].y])),Te&&(Ae.push("M"),Ae.push([Te[0].x,Te[0].y]),Ae.push("L"),Ae.push([Te[1].x,Te[1].y]))}if(Ae.length){var Bt=Kekule.Render.DrawPathUtils.makePath.apply(this,Ae);d=this.drawPath(r,Bt,h)}return d},_getMergeSectionDataTypicalValues:function(n,i){for(var r,a,o,l,u,c,d,h,p,g=Kekule.NumUtils.isNormalNumber,f=0;f<n.length;++f){var m=n[f][i.independant];g(m)&&(g(o)||(o=m),u=m),g(m=n[f][i.dependant])&&((!g(r)||r>m)&&(r=m,(c={})[i.independant]=u,c[i.dependant]=m,h=f),(!g(a)||a<m)&&(a=m,(d={})[i.independant]=u,d[i.dependant]=m,p=f))}if(l=u,g(o)&&g(l)&&g(r)&&g(a)){var C={},_={};return h<p?(C[i.independant]=o,C[i.dependant]=r,_[i.independant]=l,_[i.dependant]=a):(C[i.independant]=o,C[i.dependant]=a,_[i.independant]=l,_[i.dependant]=r),[C,_]}return null},_calcSectionDataValueContextCoord:function(n,i,r,a){var o=a?{y:n[i.independant],x:n[i.dependant]}:{x:n[i.independant],y:n[i.dependant]};return Kekule.NumUtils.isNormalNumber(o.x)&&Kekule.NumUtils.isNormalNumber(o.y)?Kekule.CoordUtils.transform2DByMatrix(o,r):null},_getContinuousSpectrumSectionSamplingCache:function(n,i,r){var a=this.getRenderCache(n).continuousSpectrumSectionSamplingCacheMap;if(!a)return null;var o=a.get(i);return!o&&r&&(o={},a.set(i,o)),o},_setContinuousSpectrumSectionSamplingCache:function(n,i,r){var a=this.getRenderCache(n).continuousSpectrumSectionSamplingCacheMap;return a||(a=new Kekule.MapEx,this.getRenderCache(n).continuousSpectrumSectionSamplingCacheMap=a),a.set(i,r),r},_addSectionSamplingDataCacheItem:function(n,i,r,a){if(r||(r=this._getMergeSectionDataTypicalValues(i,a)),r){var o={fromIndex:i.fromIndex,toIndex:i.toIndex,averageIndepValue:i.indepValueSum/(i.toIndex-i.fromIndex+1),typicalValues:r},l=n[0];if(!l||l.fromIndex>i.toIndex)n.unshift(o);else if(n[n.length-1].toIndex<i.fromIndex)n.push(o);else{for(var u=-1,c=1,d=n.length-1;c<d;++c)if(n[c].toIndex<i.fromIndex){u=c;break}u>=0&&n.splice(u,0,o)}}},_getSectionCachedSamplingData:function(n,i,r){for(var a=r||0,o=n.length,l=n[a];l&&a<o;){if(l.fromIndex<=i&&l.toIndex>=i)return{item:l,cacheIndex:a,dataValueFromIndex:l.fromIndex,dataValueToIndex:l.toIndex};if(!(l.toIndex<i))return null;l=n[++a]}return null}}),Kekule.Render.Spectrum2DRenderer.sectionDataDrawerMap={},Kekule.Render.Renderer2DFactory.register(Kekule.Spectroscopy.Spectrum,Kekule.Render.Spectrum2DRenderer)}})}()),Pp}Yv();var _u={exports:{}},Mp;function Xv(){return Mp||(Mp=1,function(s){typeof window<"u"&&typeof document<"u"&&function(e,t,n,i){function r(x,H,G){return setTimeout(c(x,G),H)}function a(x,H,G){return!!Array.isArray(x)&&(o(x,G[H],G),!0)}function o(x,H,G){var ce;if(x)if(x.forEach)x.forEach(H,G);else if(x.length!==i)for(ce=0;ce<x.length;)H.call(G,x[ce],ce,x),ce++;else for(ce in x)x.hasOwnProperty(ce)&&H.call(G,x[ce],ce,x)}function l(x,H,G){var ce="DEPRECATED METHOD: "+H+`
`+G+` AT 
`;return function(){var ye=new Error("get-stack-trace"),Ke=ye&&ye.stack?ye.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ge=e.console&&(e.console.warn||e.console.log);return Ge&&Ge.call(e.console,ce,Ke),x.apply(this,arguments)}}function u(x,H,G){var ce,ye=H.prototype;(ce=x.prototype=Object.create(ye)).constructor=x,ce._super=ye,G&&Fe(ce,G)}function c(x,H){return function(){return x.apply(H,arguments)}}function d(x,H){return typeof x==vt?x.apply(H&&H[0]||i,H):x}function h(x,H){return x===i?H:x}function p(x,H,G){o(C(H),function(ce){x.addEventListener(ce,G,!1)})}function g(x,H,G){o(C(H),function(ce){x.removeEventListener(ce,G,!1)})}function f(x,H){for(;x;){if(x==H)return!0;x=x.parentNode}return!1}function m(x,H){return x.indexOf(H)>-1}function C(x){return x.trim().split(/\s+/g)}function _(x,H,G){if(x.indexOf&&!G)return x.indexOf(H);for(var ce=0;ce<x.length;){if(G&&x[ce][G]==H||!G&&x[ce]===H)return ce;ce++}return-1}function y(x){return Array.prototype.slice.call(x,0)}function T(x,H,G){for(var ce=[],ye=[],Ke=0;Ke<x.length;){var Ge=x[Ke][H];_(ye,Ge)<0&&ce.push(x[Ke]),ye[Ke]=Ge,Ke++}return ce=ce.sort(function(gt,We){return gt[H]>We[H]}),ce}function E(x,H){for(var G,ce,ye=H[0].toUpperCase()+H.slice(1),Ke=0;Ke<Nt.length;){if((ce=(G=Nt[Ke])?G+ye:H)in x)return ce;Ke++}return i}function b(x){var H=x.ownerDocument||x;return H.defaultView||H.parentWindow||e}function v(x,H){var G=this;this.manager=x,this.callback=H,this.element=x.element,this.target=x.options.inputTarget,this.domHandler=function(ce){d(x.options.enable,[x])&&G.handler(ce)},this.init()}function I(x,H,G){var ce=G.pointers.length,ye=G.changedPointers.length,Ke=H&me&&ce-ye==0,Ge=H&(be|He)&&ce-ye==0;G.isFirst=!!Ke,G.isFinal=!!Ge,Ke&&(x.session={}),G.eventType=H,function(gt,We){var St=gt.session,Gt=We.pointers,ci=Gt.length;St.firstInput||(St.firstInput=N(We)),ci>1&&!St.firstMultiple?St.firstMultiple=N(We):ci===1&&(St.firstMultiple=!1);var jr=St.firstInput,Wr=St.firstMultiple,ir=Wr?Wr.center:jr.center,Ei=We.center=L(Gt);We.timeStamp=Dr(),We.deltaTime=We.timeStamp-jr.timeStamp,We.angle=B(ir,Ei),We.distance=M(ir,Ei),function(Pr,nr){var Qi=nr.center,Hr=Pr.offsetDelta||{},Co=Pr.prevDelta||{},Ma=Pr.prevInput||{};nr.eventType!==me&&Ma.eventType!==be||(Co=Pr.prevDelta={x:Ma.deltaX||0,y:Ma.deltaY||0},Hr=Pr.offsetDelta={x:Qi.x,y:Qi.y}),nr.deltaX=Co.x+(Qi.x-Hr.x),nr.deltaY=Co.y+(Qi.y-Hr.y)}(St,We),We.offsetDirection=W(We.deltaX,We.deltaY);var Tr=U(We.deltaTime,We.deltaX,We.deltaY);We.overallVelocityX=Tr.x,We.overallVelocityY=Tr.y,We.overallVelocity=Ht(Tr.x)>Ht(Tr.y)?Tr.x:Tr.y,We.scale=Wr?function(Pr,nr){return M(nr[0],nr[1],xi)/M(Pr[0],Pr[1],xi)}(Wr.pointers,Gt):1,We.rotation=Wr?function(Pr,nr){return B(nr[1],nr[0],xi)+B(Pr[1],Pr[0],xi)}(Wr.pointers,Gt):0,We.maxPointers=St.prevInput?We.pointers.length>St.prevInput.maxPointers?We.pointers.length:St.prevInput.maxPointers:We.pointers.length,R(St,We);var di=gt.element;f(We.srcEvent.target,di)&&(di=We.srcEvent.target),We.target=di}(x,G),x.emit("hammer.input",G),x.recognize(G),x.session.prevInput=G}function R(x,H){var G,ce,ye,Ke,Ge=x.lastInterval||H,gt=H.timeStamp-Ge.timeStamp;if(H.eventType!=He&&(gt>se||Ge.velocity===i)){var We=H.deltaX-Ge.deltaX,St=H.deltaY-Ge.deltaY,Gt=U(gt,We,St);ce=Gt.x,ye=Gt.y,G=Ht(Gt.x)>Ht(Gt.y)?Gt.x:Gt.y,Ke=W(We,St),x.lastInterval=H}else G=Ge.velocity,ce=Ge.velocityX,ye=Ge.velocityY,Ke=Ge.direction;H.velocity=G,H.velocityX=ce,H.velocityY=ye,H.direction=Ke}function N(x){for(var H=[],G=0;G<x.pointers.length;)H[G]={clientX:yt(x.pointers[G].clientX),clientY:yt(x.pointers[G].clientY)},G++;return{timeStamp:Dr(),pointers:H,center:L(H),deltaX:x.deltaX,deltaY:x.deltaY}}function L(x){var H=x.length;if(H===1)return{x:yt(x[0].clientX),y:yt(x[0].clientY)};for(var G=0,ce=0,ye=0;H>ye;)G+=x[ye].clientX,ce+=x[ye].clientY,ye++;return{x:yt(G/H),y:yt(ce/H)}}function U(x,H,G){return{x:H/x||0,y:G/x||0}}function W(x,H){return x===H?nt:Ht(x)>=Ht(H)?0>x?Zr:$i:0>H?Yi:In}function M(x,H,G){G||(G=ba);var ce=H[G[0]]-x[G[0]],ye=H[G[1]]-x[G[1]];return Math.sqrt(ce*ce+ye*ye)}function B(x,H,G){G||(G=ba);var ce=H[G[0]]-x[G[0]],ye=H[G[1]]-x[G[1]];return 180*Math.atan2(ye,ce)/Math.PI}function V(){this.evEl=si,this.evWin=xl,this.pressed=!1,v.apply(this,arguments)}function J(){this.evEl=va,this.evWin=gr,v.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function $(){this.evTarget=Qt,this.evWin=Ia,this.started=!1,v.apply(this,arguments)}function q(){this.evTarget=Kl,this.targetIds={},v.apply(this,arguments)}function Q(){v.apply(this,arguments);var x=c(this.handler,this);this.touch=new q(this.manager,x),this.mouse=new V(this.manager,x),this.primaryTouch=null,this.lastTouches=[]}function ie(x){var H=x.changedPointers[0];if(H.identifier===this.primaryTouch){var G={x:H.clientX,y:H.clientY};this.lastTouches.push(G);var ce=this.lastTouches;setTimeout(function(){var ye=ce.indexOf(G);ye>-1&&ce.splice(ye,1)},fo)}}function Y(x,H){this.manager=x,this.set(H)}function ne(x){this.options=Fe({},this.defaults,x||{}),this.id=D++,this.manager=null,this.options.enable=h(this.options.enable,!0),this.state=Rn,this.simultaneous={},this.requireFail=[]}function de(x){return x&Zi?"cancel":x&Vr?"end":x&qi?"move":x&Rr?"start":""}function Ae(x){return x==In?"down":x==Yi?"up":x==Zr?"left":x==$i?"right":""}function Ce(x,H){var G=H.manager;return G?G.get(x):x}function pe(){ne.apply(this,arguments)}function fe(){pe.apply(this,arguments),this.pX=null,this.pY=null}function Te(){pe.apply(this,arguments)}function xe(){ne.apply(this,arguments),this._timer=null,this._input=null}function Re(){pe.apply(this,arguments)}function we(){pe.apply(this,arguments)}function Me(){ne.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Le(x,H){return(H=H||{}).recognizers=h(H.recognizers,Le.defaults.preset),new Ue(x,H)}function Ue(x,H){this.options=Fe({},Le.defaults,H||{}),this.options.inputTarget=this.options.inputTarget||x,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=x,this.input=function(G){var ce=G.options.inputClass;return new(ce||(k?J:w?q:O?Q:V))(G,I)}(this),this.touchAction=new Y(this,this.options.touchAction),at(this,!0),o(this.options.recognizers,function(G){var ce=this.add(new G[0](G[1]));G[2]&&ce.recognizeWith(G[2]),G[3]&&ce.requireFailure(G[3])},this)}function at(x,H){var G,ce=x.element;ce.style&&(o(x.options.cssProps,function(ye,Ke){G=E(ce.style,Ke),H?(x.oldCssProps[G]=ce.style[G],ce.style[G]=ye):ce.style[G]=x.oldCssProps[G]||""}),H||(x.oldCssProps={}))}function Bt(x,H){var G=t.createEvent("Event");G.initEvent(x,!0,!0),G.gesture=H,H.target.dispatchEvent(G)}var Fe,Nt=["","webkit","Moz","MS","ms","o"],Xe=t.createElement("div"),vt="function",yt=Math.round,Ht=Math.abs,Dr=Date.now;Fe=typeof Object.assign!="function"?function(x){if(x===i||x===null)throw new TypeError("Cannot convert undefined or null to object");for(var H=Object(x),G=1;G<arguments.length;G++){var ce=arguments[G];if(ce!==i&&ce!==null)for(var ye in ce)ce.hasOwnProperty(ye)&&(H[ye]=ce[ye])}return H}:Object.assign;var Mt=l(function(x,H,G){for(var ce=Object.keys(H),ye=0;ye<ce.length;)(!G||G&&x[ce[ye]]===i)&&(x[ce[ye]]=H[ce[ye]]),ye++;return x},"extend","Use `assign`."),ae=l(function(x,H){return Mt(x,H,!0)},"merge","Use `assign`."),D=1,O="ontouchstart"in e,k=E(e,"PointerEvent")!==i,w=O&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z="touch",Z="mouse",se=25,me=1,Pe=2,be=4,He=8,nt=1,Zr=2,$i=4,Yi=8,In=16,Et=Zr|$i,pr=Yi|In,ai=Et|pr,ba=["x","y"],xi=["clientX","clientY"];v.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(b(this.element),this.evWin,this.domHandler)}};var Ml={mousedown:me,mousemove:Pe,mouseup:be},si="mousedown",xl="mousemove mouseup";u(V,v,{handler:function(x){var H=Ml[x.type];H&me&&x.button===0&&(this.pressed=!0),H&Pe&&x.which!==1&&(H=be),this.pressed&&(H&be&&(this.pressed=!1),this.callback(this.manager,H,{pointers:[x],changedPointers:[x],pointerType:Z,srcEvent:x}))}});var li={pointerdown:me,pointermove:Pe,pointerup:be,pointercancel:He,pointerout:He},Ll={2:z,3:"pen",4:Z,5:"kinect"},va="pointerdown",gr="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(va="MSPointerDown",gr="MSPointerMove MSPointerUp MSPointerCancel"),u(J,v,{handler:function(x){var H=this.store,G=!1,ce=x.type.toLowerCase().replace("ms",""),ye=li[ce],Ke=Ll[x.pointerType]||x.pointerType,Ge=Ke==z,gt=_(H,x.pointerId,"pointerId");ye&me&&(x.button===0||Ge)?0>gt&&(H.push(x),gt=H.length-1):ye&(be|He)&&(G=!0),0>gt||(H[gt]=x,this.callback(this.manager,ye,{pointers:H,changedPointers:[x],pointerType:Ke,srcEvent:x}),G&&H.splice(gt,1))}});var ka={touchstart:me,touchmove:Pe,touchend:be,touchcancel:He},Qt="touchstart",Ia="touchstart touchmove touchend touchcancel";u($,v,{handler:function(x){var H=ka[x.type];if(H===me&&(this.started=!0),this.started){var G=(function(ce,ye){var Ke=y(ce.touches),Ge=y(ce.changedTouches);return ye&(be|He)&&(Ke=T(Ke.concat(Ge),"identifier")),[Ke,Ge]}).call(this,x,H);H&(be|He)&&G[0].length-G[1].length==0&&(this.started=!1),this.callback(this.manager,H,{pointers:G[0],changedPointers:G[1],pointerType:z,srcEvent:x})}}});var Fr={touchstart:me,touchmove:Pe,touchend:be,touchcancel:He},Kl="touchstart touchmove touchend touchcancel";u(q,v,{handler:function(x){var H=Fr[x.type],G=(function(ce,ye){var Ke=y(ce.touches),Ge=this.targetIds;if(ye&(me|Pe)&&Ke.length===1)return Ge[Ke[0].identifier]=!0,[Ke,Ke];var gt,We,St=y(ce.changedTouches),Gt=[],ci=this.target;if(We=Ke.filter(function(jr){return f(jr.target,ci)}),ye===me)for(gt=0;gt<We.length;)Ge[We[gt].identifier]=!0,gt++;for(gt=0;gt<St.length;)Ge[St[gt].identifier]&&Gt.push(St[gt]),ye&(be|He)&&delete Ge[St[gt].identifier],gt++;return Gt.length?[T(We.concat(Gt),"identifier"),Gt]:void 0}).call(this,x,H);G&&this.callback(this.manager,H,{pointers:G[0],changedPointers:G[1],pointerType:z,srcEvent:x})}});var fo=2500,Da=25;u(Q,v,{handler:function(x,H,G){var ce=G.pointerType==z,ye=G.pointerType==Z;if(!(ye&&G.sourceCapabilities&&G.sourceCapabilities.firesTouchEvents)){if(ce)(function(Ke,Ge){Ke&me?(this.primaryTouch=Ge.changedPointers[0].identifier,ie.call(this,Ge)):Ke&(be|He)&&ie.call(this,Ge)}).call(this,H,G);else if(ye&&(function(Ke){for(var Ge=Ke.srcEvent.clientX,gt=Ke.srcEvent.clientY,We=0;We<this.lastTouches.length;We++){var St=this.lastTouches[We],Gt=Math.abs(Ge-St.x),ci=Math.abs(gt-St.y);if(Da>=Gt&&Da>=ci)return!0}return!1}).call(this,G))return;this.callback(x,H,G)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ra=E(Xe.style,"touchAction"),Xi=Ra!==i,Pa="compute",Na="auto",mo="manipulation",Ti="none",ui="pan-x",Ji="pan-y",Dn=function(){if(!Xi)return!1;var x={},H=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(G){x[G]=!H||e.CSS.supports("touch-action",G)}),x}();Y.prototype={set:function(x){x==Pa&&(x=this.compute()),Xi&&this.manager.element.style&&Dn[x]&&(this.manager.element.style[Ra]=x),this.actions=x.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var x=[];return o(this.manager.recognizers,function(H){d(H.options.enable,[H])&&(x=x.concat(H.getTouchAction()))}),function(H){if(m(H,Ti))return Ti;var G=m(H,ui),ce=m(H,Ji);return G&&ce?Ti:G||ce?G?ui:Ji:m(H,mo)?mo:Na}(x.join(" "))},preventDefaults:function(x){var H=x.srcEvent,G=x.offsetDirection;if(!this.manager.session.prevented){var ce=this.actions,ye=m(ce,Ti)&&!Dn[Ti],Ke=m(ce,Ji)&&!Dn[Ji],Ge=m(ce,ui)&&!Dn[ui];if(ye){var gt=x.pointers.length===1,We=x.distance<2,St=x.deltaTime<250;if(gt&&We&&St)return}return Ge&&Ke?void 0:ye||Ke&&G&Et||Ge&&G&pr?this.preventSrc(H):void 0}H.preventDefault()},preventSrc:function(x){this.manager.session.prevented=!0,x.preventDefault()}};var Rn=1,Rr=2,qi=4,Vr=8,Qr=Vr,Zi=16;ne.prototype={defaults:{},set:function(x){return Fe(this.options,x),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(x){if(a(x,"recognizeWith",this))return this;var H=this.simultaneous;return H[(x=Ce(x,this)).id]||(H[x.id]=x,x.recognizeWith(this)),this},dropRecognizeWith:function(x){return a(x,"dropRecognizeWith",this)?this:(x=Ce(x,this),delete this.simultaneous[x.id],this)},requireFailure:function(x){if(a(x,"requireFailure",this))return this;var H=this.requireFail;return _(H,x=Ce(x,this))===-1&&(H.push(x),x.requireFailure(this)),this},dropRequireFailure:function(x){if(a(x,"dropRequireFailure",this))return this;x=Ce(x,this);var H=_(this.requireFail,x);return H>-1&&this.requireFail.splice(H,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(x){return!!this.simultaneous[x.id]},emit:function(x){function H(ye){G.manager.emit(ye,x)}var G=this,ce=this.state;Vr>ce&&H(G.options.event+de(ce)),H(G.options.event),x.additionalEvent&&H(x.additionalEvent),ce>=Vr&&H(G.options.event+de(ce))},tryEmit:function(x){return this.canEmit()?this.emit(x):void(this.state=32)},canEmit:function(){for(var x=0;x<this.requireFail.length;){if(!(this.requireFail[x].state&(32|Rn)))return!1;x++}return!0},recognize:function(x){var H=Fe({},x);return d(this.options.enable,[this,H])?(this.state&(Qr|Zi|32)&&(this.state=Rn),this.state=this.process(H),void(this.state&(Rr|qi|Vr|Zi)&&this.tryEmit(H))):(this.reset(),void(this.state=32))},process:function(x){},getTouchAction:function(){},reset:function(){}},u(pe,ne,{defaults:{pointers:1},attrTest:function(x){var H=this.options.pointers;return H===0||x.pointers.length===H},process:function(x){var H=this.state,G=x.eventType,ce=H&(Rr|qi),ye=this.attrTest(x);return ce&&(G&He||!ye)?H|Zi:ce||ye?G&be?H|Vr:H&Rr?H|qi:Rr:32}}),u(fe,pe,{defaults:{event:"pan",threshold:10,pointers:1,direction:ai},getTouchAction:function(){var x=this.options.direction,H=[];return x&Et&&H.push(Ji),x&pr&&H.push(ui),H},directionTest:function(x){var H=this.options,G=!0,ce=x.distance,ye=x.direction,Ke=x.deltaX,Ge=x.deltaY;return ye&H.direction||(H.direction&Et?(ye=Ke===0?nt:0>Ke?Zr:$i,G=Ke!=this.pX,ce=Math.abs(x.deltaX)):(ye=Ge===0?nt:0>Ge?Yi:In,G=Ge!=this.pY,ce=Math.abs(x.deltaY))),x.direction=ye,G&&ce>H.threshold&&ye&H.direction},attrTest:function(x){return pe.prototype.attrTest.call(this,x)&&(this.state&Rr||!(this.state&Rr)&&this.directionTest(x))},emit:function(x){this.pX=x.deltaX,this.pY=x.deltaY;var H=Ae(x.direction);H&&(x.additionalEvent=this.options.event+H),this._super.emit.call(this,x)}}),u(Te,pe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(x){return this._super.attrTest.call(this,x)&&(Math.abs(x.scale-1)>this.options.threshold||this.state&Rr)},emit:function(x){if(x.scale!==1){var H=x.scale<1?"in":"out";x.additionalEvent=this.options.event+H}this._super.emit.call(this,x)}}),u(xe,ne,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Na]},process:function(x){var H=this.options,G=x.pointers.length===H.pointers,ce=x.distance<H.threshold,ye=x.deltaTime>H.time;if(this._input=x,!ce||!G||x.eventType&(be|He)&&!ye)this.reset();else if(x.eventType&me)this.reset(),this._timer=r(function(){this.state=Qr,this.tryEmit()},H.time,this);else if(x.eventType&be)return Qr;return 32},reset:function(){clearTimeout(this._timer)},emit:function(x){this.state===Qr&&(x&&x.eventType&be?this.manager.emit(this.options.event+"up",x):(this._input.timeStamp=Dr(),this.manager.emit(this.options.event,this._input)))}}),u(Re,pe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(x){return this._super.attrTest.call(this,x)&&(Math.abs(x.rotation)>this.options.threshold||this.state&Rr)}}),u(we,pe,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Et|pr,pointers:1},getTouchAction:function(){return fe.prototype.getTouchAction.call(this)},attrTest:function(x){var H,G=this.options.direction;return G&(Et|pr)?H=x.overallVelocity:G&Et?H=x.overallVelocityX:G&pr&&(H=x.overallVelocityY),this._super.attrTest.call(this,x)&&G&x.offsetDirection&&x.distance>this.options.threshold&&x.maxPointers==this.options.pointers&&Ht(H)>this.options.velocity&&x.eventType&be},emit:function(x){var H=Ae(x.offsetDirection);H&&this.manager.emit(this.options.event+H,x),this.manager.emit(this.options.event,x)}}),u(Me,ne,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[mo]},process:function(x){var H=this.options,G=x.pointers.length===H.pointers,ce=x.distance<H.threshold,ye=x.deltaTime<H.time;if(this.reset(),x.eventType&me&&this.count===0)return this.failTimeout();if(ce&&ye&&G){if(x.eventType!=be)return this.failTimeout();var Ke=!this.pTime||x.timeStamp-this.pTime<H.interval,Ge=!this.pCenter||M(this.pCenter,x.center)<H.posThreshold;if(this.pTime=x.timeStamp,this.pCenter=x.center,Ge&&Ke?this.count+=1:this.count=1,this._input=x,this.count%H.taps===0)return this.hasRequireFailures()?(this._timer=r(function(){this.state=Qr,this.tryEmit()},H.interval,this),Rr):Qr}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Qr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Le.VERSION="2.0.8",Le.defaults={domEvents:!1,touchAction:Pa,enable:!0,inputTarget:null,inputClass:null,preset:[[Re,{enable:!1}],[Te,{enable:!1},["rotate"]],[we,{direction:Et}],[fe,{direction:Et},["swipe"]],[Me],[Me,{event:"doubletap",taps:2},["tap"]],[xe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ue.prototype={set:function(x){return Fe(this.options,x),x.touchAction&&this.touchAction.update(),x.inputTarget&&(this.input.destroy(),this.input.target=x.inputTarget,this.input.init()),this},stop:function(x){this.session.stopped=x?2:1},recognize:function(x){var H=this.session;if(!H.stopped){this.touchAction.preventDefaults(x);var G,ce=this.recognizers,ye=H.curRecognizer;(!ye||ye&&ye.state&Qr)&&(ye=H.curRecognizer=null);for(var Ke=0;Ke<ce.length;)G=ce[Ke],H.stopped===2||ye&&G!=ye&&!G.canRecognizeWith(ye)?G.reset():G.recognize(x),!ye&&G.state&(Rr|qi|Vr)&&(ye=H.curRecognizer=G),Ke++}},get:function(x){if(x instanceof ne)return x;for(var H=this.recognizers,G=0;G<H.length;G++)if(H[G].options.event==x)return H[G];return null},add:function(x){if(a(x,"add",this))return this;var H=this.get(x.options.event);return H&&this.remove(H),this.recognizers.push(x),x.manager=this,this.touchAction.update(),x},remove:function(x){if(a(x,"remove",this))return this;if(x=this.get(x)){var H=this.recognizers,G=_(H,x);G!==-1&&(H.splice(G,1),this.touchAction.update())}return this},on:function(x,H){if(x!==i&&H!==i){var G=this.handlers;return o(C(x),function(ce){G[ce]=G[ce]||[],G[ce].push(H)}),this}},off:function(x,H){if(x!==i){var G=this.handlers;return o(C(x),function(ce){H?G[ce]&&G[ce].splice(_(G[ce],H),1):delete G[ce]}),this}},emit:function(x,H){this.options.domEvents&&Bt(x,H);var G=this.handlers[x]&&this.handlers[x].slice();if(G&&G.length){H.type=x,H.preventDefault=function(){H.srcEvent.preventDefault()};for(var ce=0;ce<G.length;)G[ce](H),ce++}},destroy:function(){this.element&&at(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},Fe(Le,{INPUT_START:me,INPUT_MOVE:Pe,INPUT_END:be,INPUT_CANCEL:He,STATE_POSSIBLE:Rn,STATE_BEGAN:Rr,STATE_CHANGED:qi,STATE_ENDED:Vr,STATE_RECOGNIZED:Qr,STATE_CANCELLED:Zi,STATE_FAILED:32,DIRECTION_NONE:nt,DIRECTION_LEFT:Zr,DIRECTION_RIGHT:$i,DIRECTION_UP:Yi,DIRECTION_DOWN:In,DIRECTION_HORIZONTAL:Et,DIRECTION_VERTICAL:pr,DIRECTION_ALL:ai,Manager:Ue,Input:v,TouchAction:Y,TouchInput:q,MouseInput:V,PointerEventInput:J,TouchMouseInput:Q,SingleTouchInput:$,Recognizer:ne,AttrRecognizer:pe,Tap:Me,Pan:fe,Swipe:we,Pinch:Te,Rotate:Re,Press:xe,on:p,off:g,each:o,merge:ae,extend:Mt,assign:Fe,inherit:u,bindFn:c,prefixed:E}),(e!==void 0?e:typeof self<"u"?self:{}).Hammer=Le,s.exports?s.exports=Le:e.Hammer=Le}(window,document),Kekule.Operation=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Operation",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){},isReversible:function(){return!0},execute:function(){return this.doExecute()},doExecute:function(){},reverse:function(){return this.isReversible()||Kekule.raise(Kekule.$L("ErrorMsg.COMMAND_NOT_REVERSIBLE")),this.doReverse()},doReverse:function(){}}),Kekule.Operation.State={UNEXECUTED:0,EXECUTED:1},Kekule.MacroOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.MacroOperation",initialize:function(e){this.tryApplySuper("initialize"),this.setChildren(e||[])},initProperties:function(){this.defineProp("children",{dataType:DataType.ARRAY})},isReversible:function(){for(var e=this.getChildren(),t=0,n=e.length;t<n;++t)if(!e[t].isReversible())return!1;return!0},doExecute:function(){for(var e=this.getChildren(),t=0,n=e.length;t<n;++t)e[t].execute()},doReverse:function(){for(var e=this.getChildren(),t=e.length-1;t>=0;--t)e[t].reverse()},add:function(e){return this.getChildren().push(e)},remove:function(e){var t=this.getChildren(),n=t.indexOf(e);return n>=0?t.splice(n,1):null},getChildAt:function(e){return this.getChildren()[e]},getChildCount:function(){return this.getChildren().length}}),Kekule.OperationHistory=Class.create(ObjectEx,{CLASS_NAME:"Kekule.OperationHistory",initialize:function(e){this.tryApplySuper("initialize"),this.setCapacity(e||null)},initProperties:function(){this.defineProp("capacity",{dataType:DataType.INT}),this.defineProp("operations",{dataType:DataType.ARRAY,getter:function(){var e=this.getPropStoreFieldValue("operations");return e||(e=[],this.setPropStoreFieldValue("operations",e)),e}}),this.defineProp("currIndex",{dataType:DataType.INT,serializable:!1}),this.defineEvent("push"),this.defineEvent("pop"),this.defineEvent("undo"),this.defineEvent("redo")},checkCapacity:function(){var e=this.getCapacity();if(e&&!(e<=0))for(var t=this.getPropStoreFieldValue("operations");t&&t.length>e;)t.shift(),this.getCurrIndex()>0&&this.setCurrIndex(this.getCurrIndex()-1)},getOperationCount:function(){return this.getOperations().length},getOperationAt:function(e){return this.getOperations()[e]},getCurrOperation:function(){var e=this.getCurrIndex();return e>=0?this.getOperations()[e]:null},clear:function(){this.setOperations([]),this.setCurrIndex(-1),this.invokeEvent("clear",{currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},push:function(e){var t=this.getOperations(),n=this.getCurrIndex();n<t.length&&t.splice(n+1,t.length-n-1),t.push(e),this.setCurrIndex(t.length-1),this.checkCapacity(),this.invokeEvent("push",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")},pop:function(){var e,t=this.getCurrIndex();return this.canPop()?(e=this.getOperations()[t],this.setCurrIndex(--t),this.invokeEvent("pop",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange")):e=null,e},canPop:function(){return this.getCurrIndex()>=0&&!!this.getOperations().length},unpop:function(){var e,t=this.getCurrIndex();return this.getOperations(),this.canUnpop()?(this.setCurrIndex(++t),e=this.getOperations()[t]):e=null,e},canUnpop:function(){return this.getCurrIndex()<this.getOperations().length-1},replaceOperation:function(e,t){var n=this.getOperations(),i=n.lastIndexOf(e);return i>=0?(console.log("replace operation",i===n.length-1),n.splice(i,1,t)):null},undo:function(){var e=this.pop();return e&&e.isReversible()&&e.reverse(),this.invokeEvent("undo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},undoAll:function(){for(;this.canUndo;)this.undo()},canUndo:function(){return this.canPop()},redo:function(){var e=this.unpop();return e&&e.execute(),this.invokeEvent("redo",{operation:e,currOperIndex:this.getCurrIndex()}),this.invokeEvent("operChange"),e},canRedo:function(){return this.canUnpop()}}),function(){Kekule.Action=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Action",HTML_CLASSNAME:null,initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("linkedWidgets",[]),this.setPropStoreFieldValue("enabled",!0),this.setPropStoreFieldValue("visible",!0),this.setPropStoreFieldValue("displayed",!0),this.setPropStoreFieldValue("htmlClassName",this.getInitialHtmlClassName()),this.setBubbleEvent(!0),this.reactWidgetExecuteBind=this.reactWidgetExecute.bind(this)},finalize:function(){var t=this.getOwner();t&&t.actionRemoved&&t.actionRemoved(this),this.unlinkAllWidgets(),this.setPropStoreFieldValue("linkedWidgets",[]),this._lastHtmlEvent=null,this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL,setter:function(t){t!==this.getEnabled()&&(this.setPropStoreFieldValue("enabled",t),this.updateAllWidgetsProp("enabled",t))}}),this.defineProp("visible",{dataType:DataType.BOOL,setter:function(t){t!==this.getVisible()&&(this.setPropStoreFieldValue("visible",t),this.updateAllWidgetsProp("visible",t))}}),this.defineProp("displayed",{dataType:DataType.BOOL,setter:function(t){t!==this.getDisplayed()&&(this.setPropStoreFieldValue("displayed",t),this.updateAllWidgetsProp("displayed",t))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(t){t!==this.getChecked()&&(this.setPropStoreFieldValue("checked",t),this.updateAllWidgetsProp("checked",t),this.checkedChanged())}}),this.defineProp("checkGroup",{dataType:DataType.STRING}),this.defineProp("hint",{dataType:DataType.STRING,setter:function(t){t&&t!==this.getHint()&&(this.setPropStoreFieldValue("hint",t),this.updateAllWidgetsProp("hint",t))}}),this.defineProp("text",{dataType:DataType.STRING,setter:function(t){t&&t!==this.getText()&&(this.setPropStoreFieldValue("text",t),this.updateAllWidgetsProp("text",t))}}),this.defineProp("shortcutKeys",{dataType:DataType.ARRAY}),this.defineProp("shortcutKey",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getShortCutKeys()[0]},setter:function(t){this.setShortcutKeys(Kekule.ArrayUtils.toArray(t))}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,setter:function(t){var n=this.getHtmlClassName();this.setPropStoreFieldValue("htmlClassName",t),this.updateAllWidgetClassName(t,n)}}),this.defineProp("owner",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("linkedWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("invoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},getHigherLevelObj:function(){return this.getOwner()},invokeEvent:function(t,n){n||(n={}),n.invoker||(n.invoker=this.getInvoker()),this.tryApplySuper("invokeEvent",[t,n])},getInitialHtmlClassName:function(){return this.HTML_CLASSNAME||null},getActionList:function(){var t=this.getOwner();return t instanceof Kekule.ActionList?t:null},checkedChanged:function(){var t=this.getActionList();t&&t.actionCheckedChanged(this)},linkWidget:function(t){var n=this.getLinkedWidgets();if(n.indexOf(t)<0){var i=this.getText();i&&this.updateWidgetProp(t,"text",i);var r=this.getHint();return r&&this.updateWidgetProp(t,"hint",r),this.updateWidgetProp(t,"enabled",this.getEnabled()),this.updateWidgetProp(t,"displayed",this.getDisplayed()),this.updateWidgetProp(t,"visible",this.getVisible()),this.updateWidgetProp(t,"checked",this.getChecked()),this.updateWidgetProp(t,"shortcutKeys",this.getShortcutKeys()),this.updateWidgetClassName(t,this.getHtmlClassName(),null),t.addEventListener("execute",this.reactWidgetExecuteBind),n.push(t),this}},unlinkWidget:function(t){var n=this.getLinkedWidgets(),i=n.indexOf(t);i>=0&&(this.updateWidgetClassName(t,null,this.getHtmlClassName()),t.removeEventListener("execute",this.reactWidgetExecuteBind),n.splice(i,1))},unlinkAllWidgets:function(){for(var t=this.getLinkedWidgets(),n=t.length-1;n>=0;--n)this.unlinkWidget(t[n])},reactWidgetExecute:function(t){return this.execute(t.target,t.htmlEvent)},execute:function(t,n){if(!n||n!==this._lastHtmlEvent||n.__$periodicalExecuting$__){var i=this.getChecked();this.getCheckGroup()&&i||(this.doExecute(t,n),this.getCheckGroup()&&this.setChecked(!0)),this.setPropStoreFieldValue("invoker",t),this._lastHtmlEvent=n,this.invokeEvent("execute",{htmlEvent:n,invoker:t})}return this},doExecute:function(t,n){},update:function(){return this.doUpdate(),this},doUpdate:function(){},updateAllWidgetsProp:function(t,n){for(var i=this.getLinkedWidgets(),r=0,a=i.length;r<a;++r){var o=i[r];this.updateWidgetProp(o,t,n)}},updateWidgetProp:function(t,n,i){t.hasProperty(n)&&t.setPropValue(n,i)},updateWidgetClassName:function(t,n,i){i&&t.removeClassName(i,!0),n&&t.addClassName(n,!0)},updateAllWidgetClassName:function(t,n){for(var i=this.getLinkedWidgets(),r=0,a=i.length;r<a;++r){var o=i[r];this.updateWidgetClassName(o,t,n)}}}),Kekule.ActionList=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ActionList",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("actions",[]),this.setPropStoreFieldValue("ownActions",!0),this.setPropStoreFieldValue("autoUpdate",!0),this.reactActionExecutedBind=this.reactActionExecuted.bind(this),this.addEventListener("execute",this.reactActionExecutedBind)},finalize:function(){this.removeEventListener("execute",this.reactActionExecutedBind),this.clear(),this.setPropStoreFieldValue("actions",null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("actions",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("ownActions",{dataType:DataType.BOOL}),this.defineProp("autoUpdate",{dataType:DataType.BOOL,setter:function(t){this.setPropStoreFieldValue("autoUpdate",t),t&&this.updateAll()}})},hasActionChecked:function(t){return!!this.getCheckedAction(t)},getCheckedAction:function(t){for(var n=this.getActions(),i=0,r=n.length;i<r;++i){var a=n[i];if(a.getCheckGroup()===t&&a.getChecked())return a}return null},actionAdded:function(t){if(this.getOwnActions()){var n=t.getOwner();n&&n.actionRemoved&&n.actionRemoved(t),t.setPropStoreFieldValue("owner",this)}Kekule.ArrayUtils.pushUnique(this.getActions(),t),t.update()},actionRemoved:function(t){Kekule.ArrayUtils.remove(this.getActions(),t),t.setPropStoreFieldValue("owner",null)},actionCheckedChanged:function(t){if(t&&t.getChecked()){var n=t.getCheckGroup();if(n)for(var i=this.getActions(),r=0,a=i.length;r<a;++r){var o=i[r];o!==t&&o.getCheckGroup()===n&&o.getChecked()&&o.setChecked(!1)}}},reactActionExecuted:function(t){t.target instanceof Kekule.Action&&(this.invokeEvent("execute",{action:t.target}),this.getAutoUpdate()&&this.updateAll())},getActionCount:function(){return this.getActions().length},getActionLength:function(){return this.getActions().length},getActionAt:function(t){return this.getActions()[t]},indexOfAction:function(t){return this.getActions().indexOf(t)},setActionIndex:function(t,n){var i=this.getActions();if(i){var r=i.indexOf(t);r>=0&&r!==n&&(i.splice(r,1),i.splice(n,0,t))}return this},hasAction:function(t){return this.indexOfAction(t)>=0},add:function(t){return this.actionAdded(t),this},remove:function(t){return this.actionRemoved(t),this.getOwnActions()&&t.finalize(),this},removeAt:function(t){var n=this.getActions(),i=n[t];return i&&(Kekule.ArrayUtils.removeAt(n,t),this.actionRemoved(i)),this},clear:function(){for(var t=this.getActions(),n=t.length-1;n>=0;--n)this.actionRemoved(t[n]);return this.setPropStoreFieldValue("actions",[]),this},updateAll:function(){for(var t=this.getActions(),n=0,i=t.length;n<i;++n)t[n].update();return this}}),Kekule.ActionFileOpen=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ActionFileOpen",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.showFilePickerDialog)},doExecute:function(t){var n=t.getElement().ownerDocument,i=this,r=this.getInvoker();this.openFilePicker(n,function(a,o,l){a&&i.fileOpened(l,r)})},openFilePicker:function(t,n){return Kekule.NativeServices.showFilePickerDialog(t,n,{mode:"open",filters:this.getFilters()})},fileOpened:function(t,n){this.doFileOpened(t,n),this.invokeEvent("open",{files:t,file:t[0]})},doFileOpened:function(t,n){}}),Kekule.ActionLoadFileData=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ActionLoadFileData",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY}),this.defineProp("binaryDetector",{dataType:DataType.FUNCTION,serializable:!1})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canLoadFileData())},doExecute:function(t){var n=t.getElement().ownerDocument,i=this,r=this.getInvoker();this.loadFileData(n,function(a,o,l){i.dataLoaded(o,l,!!a,r)})},loadFileData:function(t,n){return Kekule.NativeServices.loadFileData(t,n,{filters:this.getFilters(),binaryDetector:this.getBinaryDetector()})},reactFileLoad:function(t,n,i){this.dataLoaded(n,i,!!t)},dataLoaded:function(t,n,i,r){this.doDataLoaded(t,n,i,r),this.invokeEvent("load",{fileName:n,data:t,success:i})},doDataLoaded:function(t,n,i,r){}}),Kekule.ActionFileSave=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileSave",initialize:function(t,n){this.tryApplySuper("initialize"),t&&this.setData(t),n&&this.setFileName(n)},initProperties:function(){this.defineProp("data",{dataType:DataType.STRING,serializable:!1}),this.defineProp("fileName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canSaveFileData())},doExecute:function(t){var n;t?n=t.getElement().ownerDocument:n=document,Kekule.NativeServices.saveFileData(n,this.getData(),null,{initialFileName:this.getFileName(),filters:this.getFilters()})}}),Kekule.ActionManager={_namedActionMap:null,_getNamedActionMap:function(t){var n=e._namedActionMap;return!n&&t&&(n=new Kekule.MapEx,e._namedActionMap=n),n},getRegisteredActionsOfClass:function(t,n){var i=e._getNamedActionMap(n);if(i){var r=i.get(t);return!r&&n&&(r={},i.set(t,r)),r}return null},registerNamedActionClass:function(t,n,i){e.getRegisteredActionsOfClass(i,!0)[t]=n},unregisterNamedActionClass:function(t,n){var i=e.getRegisteredActionsOfClass(n,!1);i&&i[t]&&delete i[t]},getActionClassOfName:function(t,n,i){var r=ClassEx.isClass(n)?n:n.getClass&&n.getClass();if(!r)return null;var a=e.getRegisteredActionsOfClass(r,!1),o=a&&a[t];if(!o&&i){var l=ClassEx.getSuperClass(r);o=l?e.getActionClassOfName(t,l,i):null}return o}};var e=Kekule.ActionManager}(),function(){Kekule.Widget={DEF_EVENT_HANDLER_PREFIX:"react_",getEventHandleFuncName:function(e){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+e},getTouchGestureHandleFuncName:function(e){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+e}}}(),function(){Kekule.DataBingItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DataBingItem",initialize:function(e,t,n,i){this.tryApplySuper("initialize"),this.setSource(e),this.setSourceName(t),this.setTarget(n),this.setTargetName(i)},initProperties:function(){this.defineProp("source",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("sourceName",{dataType:DataType.STRING,serializable:!1}),this.defineProp("target",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("targetName",{dataType:DataType.STRING,serializable:!1})},updateData:function(e){var t=this.getSource(),n=this.getTarget(),i=this.getSourceName(),r=this.getTargetName();if(t&&n&&i&&r)if(e){var a=n.getDataByBindingName(r);t.setDataByBindingName(i,a)}else a=t.getDataByBindingName(i),n.setDataByBindingName(r,a)}}),ClassEx.extend(ObjectEx,{getDataByBindingName:function(e){return this.hasProperty(e)?this.getPropValue(e):DataType.isFunctionValue(this[e])?this[e]():void 0},setDataByBindingName:function(e,t){var n=t,i=this.getPropInfo(e);if(i){var r=i.dataType,a=DataType.getType(t);r!==a&&a===DataType.STRING&&(n=DataType.StringUtils.deserializeValue(t))}return this.setPropValue(e,n),this},createDataBinding:function(e,t,n){var i=new Kekule.DataBingItem(e,t,this,n);return this.getDataBindings(!0).push(i),i},removeDataBinding:function(e){Kekule.ArrayUtils.remove(this.getDataBindings(),e)},updateBindingData:function(e){var t=this.getDataBindings();if(t&&t.length)for(var n=0,i=t.length;n<i;++n)t[n].updateData(e)}}),ClassEx.defineProp(ObjectEx,"dataBindings",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=this.getPropStoreFieldValue("dataBindings");return!t&&e&&(t=[],this.setPropStoreFieldValue("dataBindings",t)),t}})}(),function(){Kekule.globalOptions.add("widget.events",{forceSimulatePointerEvent:!1}),Kekule.Widget.UiEvents=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","keydown","keyup","keypress","touchstart","touchend","touchcancel","touchmove","pointerdown","pointermove","pointerout","pointerover","pointerup","drag","dragend","dragenter","dragexit","dragleave","dragover","dragstart","drop"],Kekule.Widget.UiLocalEvents=["blur","focus","mouseenter","mouseleave","mousewheel","pointerenter","pointerleave"],Kekule.Widget.TouchGestures=["hold","tap","doubletap","swipe","swipeup","swipedown","swipeleft","swiperight","transform","transformstart","transformend","rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout","pan","panstart","panmove","panend","pancancel","panleft","panright","panup","pandown"];var e=Kekule.ArrayUtils;Kekule.Widget.HtmlEventMatcher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventMatcher",initialize:function(t){this.tryApplySuper("initialize",[]),this.setEventParams(t||{})},initProperties:function(){this.defineProp("eventParams",{dataType:DataType.HASH}),this._defineEventParamProp("eventType",DataType.STRING,"type")},doFinalize:function(){this.tryApplySuper("doFinalize")},_defineEventParamProp:function(t,n,i){var r=t||i;return this.defineProp(t,{dataType:n,serializable:!1,getter:function(){return this.getEventParams()[r]},setter:function(a){this.getEventParams()[r]=a}})},match:function(t){return(t.getType&&t.getType()||t.type)===this.getEventType()},execOnMatch:function(t,n){var i=this.match(t);return i&&n&&(i=this.doExecTarget(t,n)),i},doExecTarget:function(t,n){var i;return i=DataType.isFunctionValue(n)?n.apply(null,[t,this]):!(!n.execute||!DataType.isFunctionValue(n.execute))&&(DataType.isObjectExValue(n)?n instanceof Kekule.Widget.BaseWidget?n.execute(t):n instanceof Kekule.Action?n.execute(this,t):n.execute(t,this):n.execute(t,this)),Kekule.ObjUtils.isUnset(i)&&(i=!0),i}}),Kekule.Widget.HtmlEventResponser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventResponser",initialize:function(t,n,i){this.setPropStoreFieldValue("eventMatcher",t),this.setPropStoreFieldValue("execTarget",n),this.tryApplySuper("initialize",[]),this.setExclusive(i||!1)},initProperties:function(){this._defineMatcherRelatedProp("eventParams",{dataType:DataType.HASH}),this._defineMatcherRelatedProp("eventType",DataType.STRING,"type"),this.defineProp("execTarget",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("exclusive",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("eventMatcher",{dataType:"Kekule.Widget.HtmlEventMatcher",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},doFinalize:function(){this.setExecTarget(null);var t=this.getEventMatcher();t&&t.finalize(),this.tryApplySuper("doFinalize")},_defineMatcherRelatedProp:function(t,n,i){var r=t||i;return this.defineProp(t,{dataType:n,getter:function(){return this.getEventMatcher().getPropValue(r)},setter:function(a){this.getEventMatcher().setPropValue(r,a)}})},reactTo:function(t){var n=!1,i=this.getEventMatcher();if(i&&(n=i.match(t))){var r=this.getExecTarget();r&&(n=i.doExecTarget(t,r)),n=n&&this.getExclusive(),this.invokeEvent("execute",{htmlEvent:t,execTarget:r})}return n}}),Kekule.Widget.HtmlEventDispatcher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.HtmlEventDispatcher",initialize:function(){this.setPropStoreFieldValue("responsers",{}),this.tryApplySuper("initialize",[])},initProperties:function(){this.defineProp("responsers",{dataType:DataType.HASH,scope:Class.PropertyScope.PRIVATE,serializable:!1,setter:null})},doFinalize:function(){for(var t=this.getResponsers(),n=Object.getOwnPropertyNames(t),i=0,r=n.length;i<r;++i){var a=t[n[i]];if(a&&a.length)for(var o=a.length-1;o>=0;--o)a[o].finalize()}this.tryApplySuper("doFinalize")},getResponsersForType:function(t,n){var i=this.getResponsers()[t];return i||(i=[],this.getResponsers()[t]=i),i},registerResponser:function(t){var n=t.getEventType();if(n){var i=this.getResponsersForType(n,!0);e.pushUnique(i,t)}},unregisterResponser:function(t,n){var i=t.getEventType();if(i){var r=this.getResponsersForType(i);if(r&&r.length){var a=r.indexOf(t);a>=0&&(r.splice(a,1),n&&t.finalize())}}},addResponser:function(t,n,i){var r=new Kekule.Widget.HtmlEventResponser(t,n,i);return this.registerResponser(r),r},dispatch:function(t){var n=t.getType&&t.getType()||t.type;if(n){var i=this.getResponsersForType(n);if(i&&i.length)for(var r=i.length-1;r>=0&&!(i[r].reactTo(t)||t.cancelBubble);--r);}}})}(),function(){var e=Kekule.ArrayUtils,t=Kekule.HtmlElementUtils;Kekule.Widget.HtmlTagNames={CHILD_SLOT_HOLDER:"slot",CHILD_HOLDER:"span"},Kekule.Widget.HtmlNames={CHILD_HOLDER:"children"},Kekule.Widget.HtmlClassNames={BASE:"K-Widget",DYN_CREATED:"K-Dynamic-Created",CHILD_HOLDER:"K-Child-Holder",TOP_LAYER:"K-Top-Layer",ISOLATED_LAYER:"K-Isolated-Layer",NORMAL_BACKGROUND:"K-Normal-Background",NONSELECTABLE:"K-NonSelectable",SELECTABLE:"K-Selectable",STYLE_INHERITED:"K-Style-Inherited",STYLE_UNDEPENDENT:"K-Style-Undependent",STATE_NORMAL:"K-State-Normal",STATE_DISABLED:"K-State-Disabled",STATE_HOVER:"K-State-Hover",STATE_ACTIVE:"K-State-Active",STATE_FOCUSED:"K-State-Focused",STATE_SELECTED:"K-State-Selected",STATE_CURRENT_SELECTED:"K-State-Current-Selected",STATE_CHECKED:"K-State-Checked",STATE_READONLY:"K-State-ReadOnly",SHOW_POPUP:"K-Show-Popup",SHOW_DIALOG:"K-Show-Dialog",SHOW_ACTIVE_MODAL:"K-Show-ActiveModal",SECTION:"K-Section",PART_CONTENT:"K-Content",PART_TEXT_CONTENT:"K-Text-Content",PART_ASSOC_TEXT_CONTENT:"K-Assoc-Text-Content",PART_IMG_CONTENT:"K-Img-Content",PART_GLYPH_CONTENT:"K-Glyph-Content",PART_PRI_GLYPH_CONTENT:"K-Pri-Glyph-Content",PART_ASSOC_GLYPH_CONTENT:"K-Assoc-Glyph-Content",PART_DECORATION_CONTENT:"K-Decoration-Content",PART_ERROR_REPORT:"K-Error-Report",FIRST_CHILD:"K-First-Child",LAST_CHILD:"K-Last-Child",TEXT_NO_WRAP:"K-No-Wrap",LAYOUT_H:"K-Layout-H",LAYOUT_V:"K-Layout-V",LAYOUT_G:"K-Layout-G",CORNER_ALL:"K-Corner-All",CORNER_LEFT:"K-Corner-Left",CORNER_RIGHT:"K-Corner-Right",CORNER_TOP:"K-Corner-Top",CORNER_BOTTOM:"K-Corner-Bottom",CORNER_TL:"K-Corner-TL",CORNER_TR:"K-Corner-TR",CORNER_BL:"K-Corner-BL",CORNER_BR:"K-Corner-BR",CORNER_LEADING:"K-Corner-Leading",CORNER_TAILING:"K-Corner-Tailing",FULLFILL:"K-Fulfill",NOWRAP:"K-No-Wrap",HIDE_TEXT:"K-Text-Hide",HIDE_GLYPH:"K-Glyph-Hide",SHOW_TEXT:"K-Text-Show",SHOW_GLYPH:"K-Glyph-Show",MODAL_BACKGROUND:"K-Modal-Background",DUMB_WIDGET:"K-Dumb-Widget",PLACEHOLDER:"K-PlaceHolder"};var n=Kekule.Widget.HtmlClassNames;Kekule.Widget.StyleMode={UNDEPENDENT:0,INHERITED:1},Kekule.Widget.Layout={HORIZONTAL:1,VERTICAL:2,GRID:4},Kekule.Widget.Position={AUTO:0,TOP:1,LEFT:2,BOTTOM:4,RIGHT:8,TOP_LEFT:3,TOP_RIGHT:9,BOTTOM_LEFT:6,BOTTOM_RIGHT:12},Kekule.Widget.Direction={AUTO:0,LTR:1,TTB:2,RTL:4,BTT:8,isInHorizontal:function(r){var a=Kekule.Widget.Direction;return!!(r&a.LTR||r&a.RTL)},isInVertical:function(r){var a=Kekule.Widget.Direction;return!!(r&a.TTB||r&a.BTT)}},Kekule.Widget.State={NORMAL:0,FOCUSED:1,HOVER:2,ACTIVE:3,DISABLED:-1};var i=Kekule.Widget.State;Kekule.Widget.ShowHideType={DROPDOWN:1,POPUP:2,DIALOG:3,DEFAULT:0},Kekule.Widget.DragDrop={ELEM_INDEX_DATA_TYPE:"application/x-kekule-dragdrop-elem-index"},Kekule.Widget._PointerHoldParams={DURATION_THRESHOLD:1e3,MOVEMENT_THRESHOLD:10},Kekule.Widget.BaseWidget=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget",BINDABLE_TAG_NAMES:null,DEF_PERIODICAL_EXEC_DELAY:500,DEF_PERIODICAL_EXEC_INTERVAL:100,STYLE_RES_FIELD:"__$style_resources__",initialize:function(r,a){this._stateClassName=null,this._isDismissed=!1,this._pendingHtmlClassNames="",this._enableShowHideEvents=!0,this._reactElemAttribMutationBind=this._reactElemAttribMutation.bind(this),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.setPropStoreFieldValue("inheritEnabled",!0),this.setPropStoreFieldValue("inheritStatic",!0),this.setPropStoreFieldValue("selfEnabled",!0),this.setPropStoreFieldValue("selfStatic",!1),this.setPropStoreFieldValue("periodicalExecDelay",this.DEF_PERIODICAL_EXEC_DELAY),this.setPropStoreFieldValue("periodicalExecInterval",this.DEF_PERIODICAL_EXEC_INTERVAL),this.setPropStoreFieldValue("useNormalBackground",!0),this.setPropStoreFieldValue("inheritedStyles",[]),this.setPropStoreFieldValue("droppableDataKinds",["string"]),this.setPropStoreFieldValue("htmlEventDispatcher",new Kekule.Widget.HtmlEventDispatcher),this._touchActionNoneTouchStartHandlerBind=this._touchActionNoneTouchStartHandler.bind(this),this.tryApplySuper("initialize"),this.setPropStoreFieldValue("isDumb",!!a),a||(this.reactUiEventBind=this.reactUiEvent.bind(this)),r&&(r instanceof Kekule.Widget.BaseWidget?(this.setDocument(r.getDocument()),this.createElement(),this.setParent(r)):r.documentElement?(this.setDocument(r),this.createElement()):(this.setDocument(r.ownerDocument),this.setElement(r))),this._stateClassName=null,this._layoutClassName=null,this.getLayout()||this.setLayout(Kekule.Widget.Layout.HORIZONTAL),this._periodicalExecBind=this._periodicalExec.bind(this),this.setBubbleEvent(!0),this.setInheritBubbleUiEvents(!0),this.stateChanged();var o=this.getGlobalManager();o&&o.notifyWidgetCreated(this)},initProperties:function(){this.defineProp("isDumb",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(r){if(this.getIsDumb()!=r){this.setPropStoreFieldValue("isDumb",r);var a=this.getElement();a&&(r?this.uninstallUiEventHandlers(a):this.installUiEventHandlers(a))}}}),this.defineProp("bubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("inheritBubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("touchAction",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(r){var a=this.getCoreElement();a&&(a.style.touchAction=r,r==="none"?Kekule.X.Event.addListener(a,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}):Kekule.X.Event.removeListener(a,"touchstart",this._touchActionNoneTouchStartHandlerBind,{passive:!1}))}}),this.defineProp("parent",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(r){var a=this.getParent();a&&a._removeChild(this),r&&r._addChild(this),this.setPropStoreFieldValue("parent",r)}}),this.defineProp("childWidgets",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var r=this.getPropStoreFieldValue("childWidgets");return r||(r=[],this.setPropStoreFieldValue("childWidgets",r)),r}}),this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(r){var a=this.getElement();r!==a&&(this.setPropStoreFieldValue("element",r),this.elementChanged(r,a))}}),this.defineProp("observeElementAttribChanges",{dataType:DataType.BOOL,setter:function(r){!!r!=!!this.getObserveElementAttribChanges()&&(this.setPropStoreFieldValue("observeElementAttribChanges",r),this.observeElementAttribChangesChanged(!!r))}}),this.defineElemAttribMappingProp("id","id"),this.defineProp("draggable",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return Kekule.StrUtils.strToBool(this.getElement().getAttribute("draggable")||"")},setter:function(r){this.getElement().setAttribute("draggable",r?"true":"false")}}),this.defineProp("droppable",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("droppableDataKinds",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("fileDroppable",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){if(!this.getDroppable())return!1;var r=this.getDroppableDataKinds();return!r||r&&r.indexOf&&r.indexOf("file")>=0},setter:function(r){r&&!this.getDroppable()&&this.setDroppable(!0);var a=this.getPropStoreFieldValue("droppableDataKinds");if(a){var o=a.indexOf("file");!r&&o>=0?a.splice(o,1):r&&o<0&&a.push("file")}else r||this.setDroppableDataKinds(["string"])}}),this.defineElemStyleMappingProp("width","width"),this.defineElemStyleMappingProp("height","height"),this.defineProp("offsetParent",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().offsetParent},setter:null}),this.defineProp("offsetLeft",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetLeft},setter:null}),this.defineProp("offsetTop",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetTop},setter:null}),this.defineProp("offsetWidth",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetWidth},setter:null}),this.defineProp("offsetHeight",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getElement().offsetHeight},setter:null}),this.defineProp("tabIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().tabIndex},setter:function(r){this.getElement().tabIndex=r}}),this.defineProp("innerHTML",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().innerHTML},setter:function(r){this.getElement().innerHTML=r}}),this.defineProp("style",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style},setter:null}),this.defineProp("cssText",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style.cssText},setter:function(r){this.getElement().style.cssText=r}}),this.defineProp("htmlClassName",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().className},setter:function(r){this.getElement().className=r}}),this.defineProp("customHtmlClassName",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(r){var a=this.getElement(),o=this.getCustomHtmlClassName();a&&o!==r&&(o&&t.removeClass(a,o),r&&t.addClass(a,r),this.setPropStoreFieldValue("customHtmlClassName",r))}}),this.defineProp("visible",{dataType:DataType.BOOL,serializable:!1,getter:function(){return Kekule.StyleUtils.isVisible(this.getElement())},setter:function(r,a){Kekule.StyleUtils.setVisibility(this.getElement(),r),a||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("displayed",{dataType:DataType.BOOL,serializable:!1,getter:function(){return Kekule.StyleUtils.isDisplayed(this.getElement())},setter:function(r,a){Kekule.StyleUtils.setDisplay(this.getElement(),r),a||this.widgetShowStateChanged(this.isShown())}}),this.defineProp("showHideType",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCaller",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showHideCallerPageRect",{dataType:DataType.HASH,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("standaloneOnShowHide",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("finalizeAfterHiding",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("layout",{dataType:DataType.INT,setter:function(r){this.getPropStoreFieldValue("layout")!==r&&(this.setPropStoreFieldValue("layout",r),this.layoutChanged())}}),this.defineProp("useCornerDecoration",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("useCornerDecoration",r),r?this.addClassName(n.CORNER_ALL):this.removeClassName(n.CORNER_ALL)}}),this.defineProp("useNormalBackground",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("useNormalBackground",r),r?this.addClassName(n.NORMAL_BACKGROUND):this.removeClassName(n.NORMAL_BACKGROUND)}}),this.defineProp("styleMode",{dataType:DataType.INT,enumSource:Kekule.Widget.StyleMode,setter:function(r){r!==this.getStyleMode()&&(this.getElement()&&(r===Kekule.Widget.StyleMode.INHERITED?(this.removeClassName(n.STYLE_UNDEPENDENT),this.addClassName(n.STYLE_INHERITED)):(this.addClassName(n.STYLE_UNDEPENDENT),this.removeClassName(n.STYLE_INHERITED))),this.setPropStoreFieldValue("styleMode",r))}}),this.defineProp("inheritedStyles",{dataType:DataType.ARRAY,setter:function(r){this._applyToAllInheritedStyles(this.getInheritedStyles(),!1),this.setPropStoreFieldValue("inheritedStyles",r||[]),this._applyToAllInheritedStyles(this.getInheritedStyles(),!0)}}),this.defineProp("showText",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("showText",r),r?(this.removeClassName(n.HIDE_TEXT),this.addClassName(n.SHOW_TEXT)):(this.addClassName(n.HIDE_TEXT),this.removeClassName(n.SHOW_TEXT))}}),this.defineProp("showGlyph",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("showGlyph",r),r?(this.removeClassName(n.HIDE_GLYPH),this.addClassName(n.SHOW_GLYPH)):(this.addClassName(n.HIDE_GLYPH),this.removeClassName(n.SHOW_GLYPH))}}),this.defineProp("allowTextWrap",{dataType:DataType.BOOL,serialzable:!1,setter:function(r){r?this.removeClassName(n.TEXT_NO_WRAP):this.addClassName(n.TEXT_NO_WRAP)}}),this.defineProp("selfEnabled",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritEnabled",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("inheritEnabled",r),this.stateChanged()}}),this.defineProp("enabled",{dataType:DataType.BOOL,serializable:!1,getter:function(){var r=this.getPropStoreFieldValue("selfEnabled");if(this.getInheritEnabled()){var a=this.getParent();a&&(r=r&&a.getEnabled())}return r},setter:function(r){var a=this.getElement();r?a.removeAttribute("disabled"):a.setAttribute("disabled","true"),(a=this.getCoreElement())!=this.getElement()&&(r?a.removeAttribute("disabled"):a.setAttribute("disabled","true")),this.setPropStoreFieldValue("selfEnabled",r),this.stateChanged()}}),this.defineProp("selfStatic",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("inheritStatic",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("inheritStatic",r),this.stateChanged()}}),this.defineProp("static",{dataType:DataType.BOOL,serializable:!1,getter:function(){var r=this.getPropStoreFieldValue("selfStatic");if(this.getInheritStatic()){var a=this.getParent();a&&(r=r||a.getStatic())}return r},setter:function(r){this.setPropStoreFieldValue("selfStatic",r),this.stateChanged()}}),this.defineProp("inheritState",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("inheritState",r),this.stateChanged()}}),this.defineProp("state",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var r;if(this.getInheritState()){var a=this.getParent();a&&(r=a.getState())}else r=this.getEnabled()?this.getIsActive()?i.ACTIVE:this.getIsHover()?i.HOVER:this.getIsFocused()?i.FOCUSED:i.NORMAL:i.DISABLED;return r}}),this.defineProp("shortcuts",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("shortcutKeys",{dataType:DataType.ARRAY,getter:function(){for(var r=[],a=this.getShortcuts()||[],o=0,l=a.length;o<l;++o)r.push(a[o].key);return r},setter:function(r){this._updateShortcuts(r&&e.toArray(r))}}),this.defineProp("shortcutKey",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getShortcutKeys()[0]},setter:function(r){this.setShortcutKeys(r)}}),this.defineProp("cursor",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getStyleProperty("cursor")},setter:function(r){DataType.isArrayValue(r)?Kekule.StyleUtils.setCursor(this.getElement(),r):this.setStyleProperty("cursor",r)}}),this.defineProp("isHover",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(r){this.setPropStoreFieldValue("isHover",r),r||this.isCaptureMouse()||this.setPropStoreFieldValue("isActive",!1);var a=this.getGlobalManager();a&&a.notifyWidgetHoverChanged(this,r),this.stateChanged()}}),this.defineProp("isActive",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(r){this.setPropStoreFieldValue("isActive",r),r&&this.focus();var a=this.getGlobalManager();a&&a.notifyWidgetActiveChanged(this,r),this.stateChanged()}}),this.defineProp("isFocused",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var r=this.getDocument(),a=this.getCoreElement();if(r&&a&&r.activeElement)return r.activeElement===a},setter:function(r){this.setPropStoreFieldValue("isFocused",r);var a=this.getGlobalManager();a&&a.notifyWidgetFocusChanged(this,r);var o=this.getCoreElement();if(o){var l=this.getDocument();r&&l.activeElement&&l.activeElement!==o&&l.activeElement.blur&&l.activeElement.blur(),o.focus&&r&&Kekule.HtmlElementUtils.isFormCtrlElement(o)&&o.focus(),o.blur&&!r&&o.blur()}this.stateChanged()}}),this.defineProp("minDimension",{dataType:DataType.HASH}),this.defineProp("enableDimensionTransform",{dataType:DataType.BOOL}),this.defineProp("autoResizeConstraints",{dataType:DataType.HASH,setter:function(r){this.setPropStoreFieldValue("autoResizeConstraints",r);var a=this.getGlobalManager()||Kekule.Widget.globalManager;r?(this.autoResizeToClient(),a.registerAutoResizeWidget(this)):a.unregisterAutoResizeWidget(this)}}),this.defineProp("observeElemResize",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("observeElemResize")&&Kekule.BrowserFeature.resizeObserver},setter:function(r){this.getPropStoreFieldValue("observeElemResize")!=!!r&&(this.setPropStoreFieldValue("observeElemResize",!!r),r?this._installElemResizeObserver():this._uninstallElemResizeObserver())}}),this.defineProp("autoAdjustSizeOnPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isDialog",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("isPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}),this.defineProp("popupCaller",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE}),this.defineProp("modalInfo",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC}),this.defineProp("enablePeriodicalExec",{dataType:DataType.BOOL}),this.defineProp("periodicalExecDelay",{dataType:DataType.INT}),this.defineProp("periodicalExecInterval",{dataType:DataType.INT}),this.defineElemAttribMappingProp("hint","title"),this.defineProp("action",{dataType:"Kekule.Action",serializable:!1,setter:function(r){var a=this.getAction();a!==r&&(a&&a.unlinkWidget&&(a.unlinkWidget(this),this.unlinkAction(a)),this.setPropStoreFieldValue("action",r),r&&r.linkWidget&&(r.linkWidget(this),this.linkAction(r)))}}),this.defineProp("defaultChildActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(r){var a=this.getPropStoreFieldValue("defaultChildActions");return!a&&r&&(a=new Kekule.ActionList,this.setPropStoreFieldValue("defaultChildActions",a)),a}}),this.defineProp("defaultChildActionMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(r){var a=this.getPropStoreFieldValue("defaultChildActionMap");return!a&&r&&(a=new Kekule.MapEx,this.setPropStoreFieldValue("defaultChildActionMap",a)),a}}),this.defineProp("iaControllerMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var r=this.getPropStoreFieldValue("iaControllerMap");return r||(r=new Kekule.HashEx,this.setPropStoreFieldValue("iaControllerMap",r)),r}}),this.defineProp("defIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("defIaController",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getDefIaControllerId())}}),this.defineProp("activeIaControllerId",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(r){if(r!==this.getActiveIaControllerId()){this.setPropStoreFieldValue("activeIaControllerId",r);var a=this.getActiveIaController();a&&a.activated&&a.activated(this)}}}),this.defineProp("activeIaController",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getActiveIaControllerId())}}),this.defineProp("htmlEventDispatcher",{dataType:"Kekule.Widget.HtmlEventDispatcher",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null}),this.defineProp("observingGestureEvents",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null})},doFinalize:function(){this._elemResizeObserver&&(this._elemResizeObserver.disconnect&&this._elemResizeObserver.disconnect(),this._elemResizeObserver=null),this._clearShortcuts(),this.getHtmlEventDispatcher().finalize();var r=this.getDefaultChildActionMap();r&&(r.finalize(),this.setPropStoreFieldValue("defaultChildActionMap",null));var a=this.getDefaultChildActions();a&&(a.finalize(),this.setPropStoreFieldValue("defaultChildActions",null)),this.setAction(null),this.setParent(null),this.releaseChildWidgets();var o=this.getElement();this.setElement(null),this.destroyElement(o),this.getGlobalManager()&&this.getGlobalManager().notifyWidgetFinalized(this),this.tryApplySuper("doFinalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableObjectChangeEvent(!0)},doObjectChange:function(r){this.tryApplySuper("doObjectChange",[r]),r.indexOf("readOnly")>=0&&this.hasProperty("readOnly")&&(this.getPropValue("readOnly")?this.addClassName(n.STATE_READONLY):this.removeClassName(n.STATE_READONLY))},invokeEvent:function(r,a){a||(a={}),a.widget||(a.widget=this),this.tryApplySuper("invokeEvent",[r,a]);var o=this.getGlobalManager();o&&o.notifyWidgetEventFired(this,r,a)},getGlobalManager:function(){return Kekule.Widget.Utils.getGlobalManager(this.getDocument())},getCoreElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getCoreElement()},getTextSelectable:function(){return!1},canUsePlaceHolderOnElem:function(r){return!1},doPropChanged:function(r,a){r!=="width"&&r!=="height"||this.resized()},getActualBubbleUiEvents:function(){var r=this.getParent();return!!this.getBubbleUiEvents()||(this.getInheritBubbleUiEvents()&&r&&r.getActualBubbleUiEvents?r.getActualBubbleUiEvents():void 0)},releaseChildWidgets:function(){for(var r=this.getChildWidgets(),a=r.length-1;a>=0;--a)r[a].finalize()},defineElemAttribMappingProp:function(r,a,o){var l=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getElement()&&this.getElement().getAttribute(a)},setter:function(u){this.getElement()&&this.getElement().setAttribute(a,u)}},o||{});return this.defineProp(r,l)},defineElemStyleMappingProp:function(r,a,o){var l=Object.extend({dataType:DataType.STRING,serializable:!1,getter:function(){return this.getStyleProperty(a)},setter:function(u){this.setStyleProperty(a,u)}},o||{});return this.defineProp(r,l)},getHigherLevelObj:function(){return this.getParent()},linkAction:function(r){},unlinkAction:function(r){},getChildActionClass:function(r,a){return Kekule.ActionManager.getActionClassOfName(r,this,a)},getChildAction:function(r,a){var o=null,l=this.getChildActionClass(r,a);if(l){var u=this.getDefaultChildActionMap(!0);(o=u.get(l))||(o=new l,this.getDefaultChildActions(!0).add(o),u.set(l,o))}return o},_updateShortcuts:function(r){var a=this.getShortcuts()||[],o=a.length,l=r&&r.length||0;if(l<o)for(var u=l;u<o;++u)a[u].finalzie();else{var c=this.getDocument();for(u=o;u<l;++u){var d=new Kekule.Widget.Shortcut(this);a.push(d),d.registerToGlobal(c)}}for(u=0;u<l;++u)a[u].setKey(r[u]);this.setPropStoreFieldValue("shortcuts",a)},_clearShortcuts:function(){var r=this.getShortcuts()||[],a=r.length;if(a){for(var o=0;o<a;++o)r[o].finalize();this.setShortcuts(null)}},linkStyleResource:function(r,a){var o=r instanceof Kekule.Widget.StyleResource?r:Kekule.Widget.StyleResourceManager.getResource(r);return o&&o.linkTo(a||this),this},unlinkStyleResource:function(r,a){var o=r instanceof Kekule.Widget.StyleResource?r:Kekule.Widget.StyleResourceManager.getResource(r);return o&&o.unlinkFrom(a||this),this},getStyleProperty:function(r,a){var o=a||this.getElement(),l=o[this.STYLE_RES_FIELD];return l&&l[r]?l[r]:o.style[r]},setStyleProperty:function(r,a,o){var l,u=o||this.getElement();if(u)if(a instanceof Kekule.Widget.StyleResource?l=a:DataType.getType(a)===DataType.STRING&&a.startsWith(Kekule.Widget.StyleResourceNames.PREFIX)&&(l=Kekule.Widget.StyleResourceManager.getResource(a)),l){(d=u[this.STYLE_RES_FIELD])||(d={},u[this.STYLE_RES_FIELD]=d);var c=d[r];c&&this.unlinkStyleResource(c,u),l&&this.linkStyleResource(l,u),d[r]=l}else{var d;u.style[r]=a,(d=u[this.STYLE_RES_FIELD])&&d[r]&&this.unlinkStyleResource(d[r],u)}return this},removeStyleProperty:function(r,a){var o=a||this.getElement();return Kekule.StyleUtils.removeStyleProperty(o.style,r),this},setStyleProperties:function(r,a){for(var o=Object.getOwnPropertyNames(r||{}),l=0,u=o.length;l<u;++l){var c=o[l],d=r[c];this.setStyleProperty(c,d,a)}return this},removeStyleProperties:function(r,a){for(var o=0,l=e.toArray(r).length;o<l;++o)this.removeStyleProperty(name,a);return this},getComputedStyle:function(r){return Kekule.StyleUtils.getComputedStyle(this.getCoreElement(),r)},getComputedCustomStyle:function(r){var a;return a=r.indexOf("-")<0?r.dasherize():r,this.getComputedStyle("--"+a)},isStyleInherited:function(r){return(this.getInheritedStyles()||[]).indexOf(r)>=0},_setInheritedStyleValues:function(r,a,o){for(var l=e.toArray(r),u=this.getInheritedStyles()||{},c=0,d=l.length;c<d;++c){var h=l[c],p=u.indexOf(h);a?(!o&&p<0&&(u.push(h),this.notifyInheritedStyleChanged(h,!0)),this.setStyleProperty(h,"inherit")):(this.removeStyleProperty(h),!o&&p>=0&&(u.splice(p,1),this.notifyInheritedStyleChanged(h,!1)))}return this},notifyInheritedStyleChanged:function(r,a){},addInheritedStyle:function(r){return this._setInheritedStyleValues(r,!0)},removeInheritedStyle:function(r){return this._setInheritedStyleValues(r,!1)},clearInheritedStyles:function(){this.setPropStoreFieldValue("inheritedStyles",[])},_applyToAllInheritedStyles:function(r,a){Kekule.ObjUtils.isUnset(a)&&(a=!0);for(var o=0,l=r.length;o<l;++o){var u=r[o];this._setInheritedStyleValues(u,a,!0)}},_addChild:function(r){if(r){var a=this.getChildWidgets();a.indexOf(r)<0&&(a.push(r),this.childWidgetAdded(r),this.childrenModified())}},_insertChild:function(r,a){if(r){var o=this.getChildWidgets(),l=a?o.indexOf(a):o.length;o.indexOf(r)>=0?l>=0&&this._moveChild(r,l):(l<0&&(l=o.length),o.splice(l,0,r),this.childWidgetAdded(r),this.childrenModified())}},_removeChild:function(r){if(r){var a=this.getChildWidgets(),o=a.indexOf(r);if(o>=0){a.splice(o,1);var l=this.getChildrenHolderElement(),u=r.getElement();u&&Kekule.DomUtils.isDescendantOf(u,l)&&u.parentNode.removeChild(u),this.childWidgetRemoved(r),this.childrenModified()}}},_moveChild:function(r,a){r&&Kekule.ArrayUtils.changeItemIndex(this.getChildWidgets(),r,a)&&(this.childWidgetMoved(r,a),this.childrenModified())},childrenModified:function(){},childWidgetAdded:function(r){},childWidgetRemoved:function(r){},childWidgetMoved:function(r,a){},indexOfChild:function(r){return this.getChildWidgets().indexOf(r)},hasChild:function(r,a){var o=this.getChildWidgets(),l=o.indexOf(r)>=0;if(!l)for(var u=0,c=o.length;u<c;++u){var d=o[u];if(d.hasChild&&(l=d.hasChild(r,a)))break}return l},getChildAtIndex:function(r){return this.getChildWidgets()[r]},getPrevSibling:function(){var r=this.getParent();if(r){var a=r.indexOfChild(this);return this.getChildAtIndex(--a)}return null},getNextSibling:function(){var r=this.getParent();if(r){var a=r.indexOfChild(this);return this.getChildAtIndex(++a)}return null},_haltPrevShowHideProcess:function(){Kekule.Widget.showHideManager&&this.__$showHideTransInfo&&this.__$showHideTransInfo.halt()},_setEnableShowHideEvents:function(r){this._enableShowHideEvents=r},show:function(r,a,o,l){if(this.getElement()&&!this.__$isShowing)return this._haltPrevShowHideProcess(),this.doShow(r,a,o,l),this},doShow:function(r,a,o,l){this.__$isShowing=!0;var u=this,c=function(){u.__$showHideTransInfo=null,u.widgetShowStateDone(!0),u.__$isShowing=!1,a&&a()};this.setShowHideType(o),Kekule.ObjUtils.notUnset(o)&&(this.setIsPopup(o===Kekule.Widget.ShowHideType.DROPDOWN||o===Kekule.Widget.ShowHideType.POPUP),o===Kekule.Widget.ShowHideType.DIALOG?(this.setIsDialog(!0),o=Kekule.Widget.ShowHideType.POPUP):this.setIsDialog(!1)),this.widgetShowStateBeforeChanging(!0);var d=this.getGlobalManager();o!==Kekule.Widget.ShowHideType.DROPDOWN&&o!==Kekule.Widget.ShowHideType.POPUP||d.preparePopupWidget(this,r,o),!Kekule.Widget.showHideManager||l&&l.instantly?(this.setDisplayed(!0,!0),this.setVisible(!0,!0),c()):this.__$showHideTransInfo||(this.__$showHideTransInfo=Kekule.Widget.showHideManager.show(this,r,c,o,l)),this.setShowHideCaller(r),r&&this.setShowHideCallerPageRect(t.getElemBoundingClientRect(r.getElement&&r.getElement()||r)),(function(){u.widgetShowStateChanged(!0)}).defer()},flash:function(r,a,o,l){var u=this;return this.show(a,function(){o&&o(),setTimeout(u.hide.bind(u),r)},l),this},hide:function(r,a,o,l){if(this.getElement()&&!this.__$isHiding)return this.__$isHiding=!0,r||(r=this.getShowHideCaller()),o||(o=this.getShowHideType()),this._haltPrevShowHideProcess(),this.doHide(r,a,o,l),this},doHide:function(r,a,o,l){var u=Object.extend({callerPageRect:this.getShowHideCallerPageRect()},l),c=u.useVisible,d=this,h=this.getFinalizeAfterHiding(),p=function(){d.__$showHideTransInfo=null,d.widgetShowStateDone(!1);var g=d.getGlobalManager();o!==Kekule.Widget.ShowHideType.DROPDOWN&&o!==Kekule.Widget.ShowHideType.POPUP||g.unpreparePopupWidget(d),d.__$isHiding=!1,a&&a(),h&&d.finalize()};this.widgetShowStateBeforeChanging(!1),Kekule.Widget.showHideManager&&!u.instantly?(this.__$showHideTransInfo&&this.__$showHideTransInfo.halt(),this.__$showHideTransInfo||(this.__$showHideTransInfo=Kekule.Widget.showHideManager.hide(this,r,p,o,!1,u))):(c?this.setVisible(!1,!0):this.setDisplayed(!1,!0),p()),(function(){d.widgetShowStateChanged(!1)}).defer()},dismiss:function(r,a,o,l){return this._isDismissed=!0,this.hide(r,a,o,l)},isShown:function(r){return(this.isInDomTree()||r)&&this.getElement()&&this.getVisible()&&this.getDisplayed()},widgetShowStateBeforeChanging:function(r){r&&this.autoResizeToClient()},widgetShowStateChanged:function(r,a){if(Kekule.ObjUtils.isUnset(r)&&(r=this.isShown()),!Kekule.ObjUtils.notUnset(this._lastShown)||this._lastShown!==r){this._lastShown=r,r&&(this._isDismissed=!1);var o=this.getGlobalManager();this.getIsPopup()&&(r?o.registerPopupWidget(this):o.unregisterPopupWidget(this)),this.getIsDialog()&&(r?o.registerDialogWidget(this):o.unregisterDialogWidget(this)),this.doWidgetShowStateChanged(r),this._enableShowHideEvents&&this.invokeEvent("showStateChange",{widget:this,isShown:r,isDismissed:this._isDismissed,byDomChange:a})}},doWidgetShowStateChanged:function(r){},widgetShowStateDone:function(r){},isInDomTree:function(){var r=this.getElement();return Kekule.DomUtils.isInDomTree(r,null,{acrossShadowRoot:!0})},focus:function(){return this.setIsFocused(!0),this},blur:function(){return this.setIsFocused(!1),this},getBoundingClientRect:function(r){if(this.getDisplayed())return Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),r);var a=Kekule.StyleUtils.getDisplayed(this.getElement()),o=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var l=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),r)}finally{this.setDisplayed(a),this.setVisible(o)}return l},getPageRect:function(r){if(this.getDisplayed())return Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),r);var a=Kekule.StyleUtils.getDisplayed(this.getElement()),o=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden"),this.setDisplayed("");var l=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),r)}finally{this.setDisplayed(a),this.setVisible(o)}return l},getDimension:function(){return this.getPageRect()},setDimension:function(r,a,o){var l=Kekule.ObjUtils.notUnset,u=this.getMinDimension(),c=u&&u.width,d=u&&u.height,h=!1;if(this.getEnableDimensionTransform()){var p,g=l(r)&&c?r/c:null,f=l(a)&&d?a/d:null;if(p=g&&f?Math.min(g,f):g||f)return p>=1?(this._setTransformScale(1),h=!0,this.doSetDimension(r,a,o)):(!f||g<=f?(m=c,C=a&&a/p):(C=d,m=r&&r/p),this._setTransformScale(p),h=!0,this.doSetDimension(m,C,o));h=!1}if(!h){var m=l(r)?c?Math.max(r,c):r:null,C=l(a)?d?Math.max(a,d):a:null;return this._setTransformScale(1),this.doSetDimension(m,C,o)}},doSetDimension:function(r,a,o){var l=!1,u=Kekule.ObjUtils.notUnset;return u(r)&&(this.getStyle().width=typeof r=="number"?r+"px":r,l=!0),u(a)&&(this.getStyle().height=typeof a=="number"?a+"px":a,l=!0),l&&!o&&(this.getObserveElemResize()||this.resized()),this.objectChange(["width","height"]),this},_setTransformScale:function(r){var a=this.getElement();r!==1?(a.style.transformOrigin="0 0",a.style.transform="scale("+r+")"):Kekule.StyleUtils.removeStyleProperty(a.style,"transform")},updateDimensionTransform:function(){var r=this.getDimension();this.setDimension(r.width,r.height,!0)},autoResizeToClient:function(){var r=this.getAutoResizeConstraints();if(r){var a=Kekule.DocumentUtils.getClientDimension(this.getDocument()),o=r.width?a.width*r.width:null,l=r.height?a.height*r.height:null;this.setDimension(o,l)}},resized:function(){if(!this._isResizing){this._isResizing=!0;try{this.doResize(),this.invokeEvent("resize",{widget:this})}finally{this._isResizing=!1}}},doResize:function(){},_installElemResizeObserver:function(){if(Kekule.BrowserFeature.resizeObserver){if(!this._elemResizeObserver){var r=this;this._elemResizeObserver=new ResizeObserver(function(a){for(var o=0,l=a.length;o<l;++o){var u=a[o];u.target&&u.contentBoxSize&&u.target===r.getElement()&&r.resized()}})}this._elemResizeObserver.observe(this.getElement())}},_uninstallElemResizeObserver:function(){Kekule.BrowserFeature.resizeObserver&&this._elemResizeObserver&&this._elemResizeObserver.unobserve(this.getElement())},layoutChanged:function(){var r=this.getLayout();this._layoutClassName&&this.removeClassName(this._layoutClassName),this._layoutClassName=this.getLayoutClassName(r),this._layoutClassName&&this.addClassName(this._layoutClassName)},getLayoutClassName:function(r){var a=Kekule.Widget.Layout;return r===a.VERTICAL?n.LAYOUT_V:r===a.HORIZONTAL?n.LAYOUT_H:r===a.GRID?n.LAYOUT_G:null},stateChanged:function(){this._stateClassName&&this.removeClassName(this._stateClassName),this._stateClassName=this.getStateClassName(this.getState()),this._stateClassName&&this.addClassName(this._stateClassName);for(var r=this.getChildWidgets(),a=0,o=r.length;a<o;++a)r[a].stateChanged()},getStateClassName:function(r){var a=Kekule.Widget.State;return r===a.ACTIVE?n.STATE_ACTIVE:r===a.HOVER?n.STATE_HOVER:r===a.FOCUSED?n.STATE_FOCUSED:r===a.DISABLED?n.STATE_DISABLED:n.STATE_NORMAL},createElement:function(){var r=this.getDocument(),a=this.doCreateRootElement(r);return this.setElement(a),a},doCreateRootElement:function(r){},doCreateSubElements:function(r,a){return[]},destroyElement:function(r){(r=r||this.getElement())&&r.parentNode&&r.parentNode.removeChild(r)},appendToElem:function(r){return r&&r.appendChild(this.getElement()),this},insertToElem:function(r,a){return r.insertBefore(this.getElement(),a),this},removeFromDom:function(){var r=this.getElement(),a=r.parentNode;a&&a.removeChild(r)},appendToWidget:function(r){return this.setParent(r),this.appendToElem(r.getChildrenHolderElement()),this},insertToWidget:function(r,a){return this.setParent(r),a?this.insertToElem(r.getChildrenHolderElement(),a.getElement()):this.appendToElem(r.getChildrenHolderElement()),this},insertedToDom:function(){return this.widgetDomStateChanged(!0),this.widgetShowStateChanged(this.isShown(),!0),this.doInsertedToDom()},doInsertedToDom:function(){},removedFromDom:function(){return this.widgetDomStateChanged(!1),this.widgetShowStateChanged(!1,!0),this.doRemovedFromDom()},doRemovedFromDom:function(){},widgetDomStateChanged:function(r){this.doWidgetDomStateChanged(r),this.invokeEvent("domStateChange",{widget:this,isInDom:r})},doWidgetDomStateChanged:function(r){},domElemAdded:function(r){return this.doDomElemAdded(r)},doDomElemAdded:function(r){},domElemRemoved:function(r){return this.doDomElemRemoved(r)},doDomElemRemoved:function(r){},getWidgetClassName:function(){var r=Kekule.Widget.HtmlClassNames.BASE;return r+=" "+(this.getStyleMode()===Kekule.Widget.StyleMode.INHERITED?n.STYLE_INHERITED:n.STYLE_UNDEPENDENT),this.getElement()&&!Kekule.HtmlElementUtils.isFormCtrlElement(this.getCoreElement())&&this.getUseNormalBackground()&&(r+=" "+Kekule.Widget.HtmlClassNames.NORMAL_BACKGROUND),r+=" "+this.doGetWidgetClassName()},doGetWidgetClassName:function(){return""},hasClassName:function(r){return t.hasClass(this.getElement(),r)},addClassName:function(r,a){if(this.getElement())if(a){var o=this.getCustomHtmlClassName();o=Kekule.StrUtils.addTokens(o,r),this.setCustomHtmlClassName(o)}else t.addClass(this.getElement(),r);else this._pendingHtmlClassNames=Kekule.StrUtils.addTokens(this._pendingHtmlClassNames,r);return this},removeClassName:function(r,a){if(this.getElement())if(a){var o=this.getCustomHtmlClassName();o=Kekule.StrUtils.removeTokens(o,r),this.setCustomHtmlClassName(o)}else t.removeClass(this.getElement(),r);else this._pendingHtmlClassNames=Kekule.StrUtils.removeTokens(this._pendingHtmlClassNames,r);return this},toggleClassName:function(r,a){if(this.getElement())if(a){var o=this.getCustomHtmlClassName();o=Kekule.StrUtils.toggleTokens(o,r),this.setCustomHtmlClassName(o)}else t.toggleClass(this.getElement(),r);return this},isElementBindable:function(r){var a=this.getBindableElemTagNames();if(a){var o=r.tagName;return a.indexOf(o.toLowerCase())>=0}return!0},getBindableElemTagNames:function(){return this.getPrototype().hasOwnProperty("BINDABLE_TAG_NAMES")?this.BINDABLE_TAG_NAMES:null},bindElement:function(r){if(r){if(!this.isElementBindable(r))return void Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CAN_NOT_BIND_TO_ELEM").format(this.getClassName(),r.tagName));this.beginUpdate();try{var a=r.className;a&&this.setCustomHtmlClassName(this.getCustomHtmlClassName()||" "+a);var o=this.getDefaultTabIndex();Kekule.ObjUtils.notUnset(o)&&!r.getAttribute("tabindex")&&(r.tabIndex=o);var l=Kekule.DomUtils,u=Kekule.HtmlElementUtils;(function(b){for(var v=l.getDirectChildElems(b),I=v.length-1;I>=0;--I){var R=v[I];u.hasClass(R,n.DYN_CREATED)&&b.removeChild(R)}})(r);var c=this.getDocument().createDocumentFragment(),d=this.doCreateSubElements(this.getDocument(),c);if(d&&d.length)for(var h=0,p=d.length;h<p;++h){var g=d[h];u.addClass(g,n.DYN_CREATED)}(d&&d.length||c.children&&c.children.length||c.childNodes&&c.childNodes.length)&&r.appendChild(c),this.doBindElement(r),this._applyToAllInheritedStyles(this.getInheritedStyles(),!0),Kekule.DomUtils.hasAttribute(r,"disabled")&&this.setEnabled(!1);var f=this.getWidgetClassName();t.addClass(r,f),(f=this.getCustomHtmlClassName())&&t.addClass(r,f),this.getTextSelectable()||t.addClass(r,n.NONSELECTABLE),this._pendingHtmlClassNames&&(t.addClass(r,this._pendingHtmlClassNames),this._pendingHtmlClassNames="");var m=r.getAttribute("width"),C=r.getAttribute("height");(Kekule.ObjUtils.notUnset(m)||Kekule.ObjUtils.notUnset(C))&&(m=parseFloat((m||"").toString())||0,C=parseFloat((C||"").toString())||0,this.setDimension(m,C));var _=Kekule.DomUtils.getDataset(r);if(_)for(var y in _){var T=_[y];try{Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,y,T)}catch(b){Kekule.warn(b)}}var E=this.getTouchAction();Kekule.ObjUtils.notUnset(E)&&this.setTouchAction(E),this.getIsDumb()||this.installUiEventHandlers(r),r.__$kekule_widget__=this,this.elementBound(r)}finally{this.endUpdate(),this.invokeEvent("bind",{widget:this,element:r})}}},doBindElement:function(r){},elementBound:function(r){},unbindElement:function(r){if(r){this.getIsDumb()||this.uninstallUiEventHandlers(r);var a=this.getWidgetClassName();t.removeClass(r,a),this.doUnbindElement(r),r.__$kekule_widget__=void 0;try{delete r.__$kekule_widget__}catch{}this.elementUnbound(r),this.invokeEvent("unbind",{widget:this,element:r})}},doUnbindElement:function(r){},elementUnbound:function(r){},elementChanged:function(r,a){a&&this.unbindElement(a),r&&this.bindElement(r)},getDefaultTabIndex:function(){return this.doGetDefaultTabIndex()},doGetDefaultTabIndex:function(){return 0},observeElementAttribChangesChanged:function(r){var a=this.getElement();r?this._installAttribMutationObserver(a):this._uninstallAttribMutationObserver(a)},_installAttribMutationObserver:function(r){if(Kekule.X.MutationObserver){if(!this._attribMutationObserver){var a=new Kekule.X.MutationObserver(this._reactElemAttribMutationBind);this._attribMutationObserver=a}this._attribMutationObserver.observe(r,{attributes:!0})}},_uninstallAttribMutationObserver:function(r){this._attribMutationObserver&&this._attribMutationObserver.disconnect()},_reactElemAttribMutation:function(r){for(var a=this.getElement(),o=this.getCoreElement(),l=0,u=r.length;l<u;++l){var c=r[l];if(c.type==="attributes"&&(c.target===a||c.target===o)){var d=c.attributeName;if(d){if(d.toLowerCase()==="style")this.notifyStyleAttribChanged(c.target);else if(Kekule.DomUtils.isDataAttribName(d)){var h=Kekule.DomUtils.getDataAttribCoreName(d);if(h){var p=a.getAttribute(d);Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,h,p)}}}}}},notifyStyleAttribChanged:function(r){},createDecorationContent:function(r,a){var o=r.ownerDocument.createElement("span");return t.addClass(o,[n.PART_CONTENT,n.PART_DECORATION_CONTENT,n.DYN_CREATED]),a?r.insertBefore(o,a):r.appendChild(o),o},createTextContent:function(r,a,o){var l=a.ownerDocument.createElement("span");return t.addClass(l,[n.PART_CONTENT,n.PART_TEXT_CONTENT,n.DYN_CREATED]),l.innerHTML=r,o?a.insertBefore(l,o):a.appendChild(l),l},createGlyphContent:function(r,a,o){var l=r.ownerDocument.createElement("span");return t.addClass(l,[n.PART_CONTENT,n.PART_GLYPH_CONTENT,n.DYN_CREATED]),o&&t.addClass(l,o),a?r.insertBefore(l,a):r.appendChild(l),l},_touchActionNoneTouchStartHandler:function(r){try{r.preventDefault()}catch{}},installUiEventHandlers:function(r){for(var a=Kekule.Widget.UiLocalEvents,o=0,l=a.length;o<l;++o)Kekule.X.Event.addListener(r,a[o],this.reactUiEventBind)},uninstallUiEventHandlers:function(r){for(var a=Kekule.Widget.UiLocalEvents,o=0,l=a.length;o<l;++o)Kekule.X.Event.removeListener(r,a[o],this.reactUiEventBind)},registerHtmlEventResponser:function(r){return this.getHtmlEventDispatcher().registerResponser(r),this},unregisterHtmlEventResponser:function(r){return this.getHtmlEventDispatcher().unregisterResponser(r),this},addHtmlEventResponser:function(r,a,o){return this.getHtmlEventDispatcher().addResponser(r,a,o)},reactUiEvent:function(r){if(!this.getStatic())if(this.getEnabled()){var a,o=!1,l=r.getType(),u=r.getTarget(),c=Kekule.Widget.Utils.getBelongedResponsiveWidget(u)===this,d=Kekule.X.Event.KeyCode;if(l==="mousemove"||l==="pointermove"){this.reactPointerMoving(r);var h=this.getEventMouseRelCoord(r),p=this.testMouseCursor(h,r);Kekule.ObjUtils.notUnset(p)&&this.getElement()&&(this.setCursor(p),o=!0)}else if(l==="touchmove"){if(this.reactPointerMoving(r),this.getIsActive()&&!this.isCaptureMouse()){var g=r.touches[0];if(g){var f=this.getDocument().elementFromPoint(g.clientX,g.clientY);Kekule.DomUtils.isOrIsDescendantOf(f,this.getElement())||(this.setIsHover(!1),this.setIsActive(!1))}else this.setIsHover(!1),this.setIsActive(!1)}o=!0}else if(l==="focus")c&&r.getTarget()===this.getCoreElement()&&(this.setIsFocused(!0),o=!0);else if(l==="blur"){if(c&&r.getTarget()==this.getCoreElement()){var m=this.getDocument().activeElement,C=this.getElement();m&&(Kekule.DomUtils.isDescendantOf(m,C)||m===C)||this.setIsFocused(!1),o=!0}}else if(l==="pointerover")r.pointerType==="touch"||r.ghostMouseEvent||this.setIsHover(!0),o=!0;else if(l==="mouseout"||l==="touchleave"){if(!r.ghostMouseEvent){var _=r.getRelatedTarget();_&&Kekule.DomUtils.isOrIsDescendantOf(_,this.getCoreElement())||(this.setIsHover(!1),this.isCaptureMouse()||(this.reactDeactiviting(r),o=!0))}}else l==="pointerdown"&&r.getButton()===Kekule.X.Event.MouseButton.LEFT?(c&&!r.ghostMouseEvent&&this.reactActiviting(r),o=!0):l==="pointerup"&&r.getButton()===Kekule.X.Event.MouseButton.LEFT||l==="touchcancel"?(c&&!r.ghostMouseEvent&&this.reactDeactiviting(r),o=!0):l==="keydown"?(a=r.getKeyCode())!==d.ENTER&&a!==d.SPACE||(c&&!this.getIsActive()&&this.reactActiviting(r),o=!0):l==="keyup"&&((a=r.getKeyCode())!==d.ENTER&&a!==d.SPACE||(c&&this.getIsActive()&&this.reactDeactiviting(r),o=!0));this.doBeforeDispatchUiEvent(r);var y=Kekule.Widget.getEventHandleFuncName(r.getType());this[y]&&(o=this[y](r)),r.cancelBubble||(o=this.dispatchEventToIaControllers(r)||o),r.cancelBubble||this.getHtmlEventDispatcher().dispatch(r),this.doReactUiEvent(r),this.invokeEvent(l,{htmlEvent:r})}else r.stopPropagation();if(this.getActualBubbleUiEvents()&&!r.cancelBubble){var T=this.getParent();T&&T.reactUiEvent&&T.reactUiEvent(r)}},doReactUiEvent:function(r){},doBeforeDispatchUiEvent:function(r){},_supportGestureEvent:function(){return Kekule.$jsRoot.Hammer!==void 0&&Kekule.$jsRoot.document&&Kekule.$jsRoot.document.addEventListener},startObservingGestureEvents:function(r){if(this._supportGestureEvent()){r||(r=Kekule.Widget.TouchGestures);var a=e.exclude(r,this.getObservingGestureEvents()||[]);a.length&&this.installHammerTouchHandlers(a)}},stopObservingGestureEvents:function(r){if(this._supportGestureEvent()&&this.getObservingGestureEvents()){r||(r=Kekule.Widget.TouchGestures);var a=e.intersect(r,this.getObservingGestureEvents());a.length&&this.uninstallHammerTouchHandlers(a)}},installHammerTouchHandlers:function(r){if(this._supportGestureEvent()){r||(r=Kekule.Widget.TouchGestures);var a=this.getCoreElement(),o=new Hammer(a);return r.indexOf("pinch")>=0&&o.get("pinch").set({enable:!0}),r.indexOf("rotate")>=0&&o.get("rotate").set({enable:!0}),o.on(r.join(" "),this.reactTouchGestureBind),this._hammertime=o,this.setPropStoreFieldValue("observingGestureEvents",r),o}},uninstallHammerTouchHandlers:function(r){this._hammertime&&(r||(r=this.getObservingGestureEvents()),this._hammertime.off(r.join(" "),this.reactTouchGestureBind))},reactTouchGesture:function(r){var a=Kekule.Widget.getTouchGestureHandleFuncName(r.getType&&r.getType()||r.type);this[a]?this[a](r):this.dispatchEventToIaControllers(r,"hammer")},reactActiviting:function(r){this.getIsActive()||(this.setIsActive(!0),this.doReactActiviting(r),this.invokeEvent("activate",{widget:this}))},doReactActiviting:function(r){},reactDeactiviting:function(r){this.getIsActive()&&(this.doReactDeactiviting(r),this.invokeEvent("deactivate",{widget:this}),this.setIsActive(!1))},doReactDeactiviting:function(r){},reactPointerMoving:function(r){this.doReactPointerMoving(r)},doReactPointerMoving:function(r){},dispatchEventToIaControllers:function(r,a){var o=!1,l=this.getActiveIaController();return l&&(o=a==="hammer"?l.handleGestureEvent(r):l.handleUiEvent(r)),o||(l=this.getDefIaController())&&(o=a==="hammer"?l.handleGestureEvent(r):l.handleUiEvent(r)),o},getEventMouseRelCoord:function(r,a){a||(a=this.getCoreElement());var o={x:r.getClientX(),y:r.getClientY()},l=Kekule.HtmlElementUtils.getElemPageRect(a,!0),u={x:l.left-a.scrollLeft,y:l.top-a.scrollTop};return Kekule.CoordUtils.substract(o,u)},testMouseCursor:function(r,a){var o=this.doTestMouseCursor(r,a);if(!o){var l=this.getActiveIaController();if(l){var u=l.testMouseCursor(r,a);Kekule.ObjUtils.notUnset(u)&&(o=u)}!o&&(l=this.getDefIaController())&&(u=l.testMouseCursor(r,a),Kekule.ObjUtils.notUnset(u)&&(o=u))}return o},doTestMouseCursor:function(r,a){return null},setMouseCapture:function(r){var a=this.getGlobalManager();r?a.setMouseCaptureWidget(this):this.isCaptureMouse()&&a.setMouseCaptureWidget(null)},isCaptureMouse:function(){return this.getGlobalManager().getMouseCaptureWidget()===this},_getEventMouseCoord:function(r,a){var o=a||this.getElement(),l=r.getTarget(),u=r.getOffsetCoord(!0);if(l===o)return u;var c=Kekule.HtmlElementUtils.getElemPagePos(o),d=Kekule.HtmlElementUtils.getElemPagePos(l),h={x:d.x-c.x,y:d.y-c.y};return u=Kekule.CoordUtils.substract(u,h)},_filterDraggedDataItemByKinds:function(r,a){if(r.items){for(var o=[],l=0,u=r.items.length;l<u;++l){var c=r.items[l];a.indexOf(c.kind)>=0&&o.push(c)}return o}return null},dragStart:function(r){if(this.getDraggable()){var a=this.doDragStart(r);return this.invokeEvent("dragStart",{widget:this,dataTransfer:r.dataTransfer,startingElem:r.targetElem}),a}return!1},doDragStart:function(r,a){return!0},dragEnd:function(r){var a=this.doDragEnd(r);return this.invokeEvent("dragEnd",{widget:this,dataTransfer:r.dataTransfer,startingElem:r.targetElem}),a},doDragEnd:function(r){},acceptDragSrc:function(r){if(this.getDroppable()){var a=!0,o={widget:this,htmlEvent:r.htmlEvent,dataTransfer:r.dataTransfer,srcElem:r.srcElem,srcWidget:r.srcWidget,srcFiles:r.dataTransfer&&r.dataTransfer.files};if(this.invokeEvent("dragAcceptQuery",o),Kekule.ObjUtils.notUnset(o.result))return a=o.result;var l=this.getDroppableDataKinds();return l&&(r.dataTransfer.items?a=!!this._filterDraggedDataItemByKinds(r.dataTransfer,l).length:l.indexOf("file")>=0&&r.dataTransfer.files&&r.dataTransfer.files.length&&(a=!0)),a&&this.doAcceptDragSrc(r)}return!1},doAcceptDragSrc:function(r){return!0},dragOver:function(r){if(this.getDroppable()&&this.acceptDragSrc(r)){var a=this.doDragOver(r);return this.invokeEvent("dragOver",{widget:this,htmlEvent:r.htmlEvent,dataTransfer:r.dataTransfer,srcElem:r.srcElem,srcWidget:r.srcWidget,srcFiles:r.dataTransfer&&r.dataTransfer.files}),a}return!1},doDragOver:function(r){return!0},dragLeave:function(r){var a=this.doDragLeave(r);return this.invokeEvent("dragLeave",{widget:this,htmlEvent:r.htmlEvent,dataTransfer:r.dataTransfer,srcElem:r.srcElem,srcWidget:r.srcWidget,srcFiles:r.dataTransfer&&r.dataTransfer.files}),a},doDragLeave:function(r){},dragDrop:function(r){if(this.getDroppable()&&this.acceptDragSrc(r)){var a=this.doDragDrop(r),o=this.getDroppableDataKinds();if(!o||o.indexOf("file")>=0){var l=r.dataTransfer.files;l&&l.length&&(a=a||this.doFileDragDrop(l))}var u={widget:this,htmlEvent:r.htmlEvent,dataTransfer:r.dataTransfer,srcElem:r.srcElem,srcWidget:r.srcWidget,srcFiles:r.dataTransfer&&r.dataTransfer.files};return this.invokeEvent("dragDrop",u),a||u._preventDefault}return!1},doDragDrop:function(r){return!1},doFileDragDrop:function(r){return!0},addIaController:function(r,a,o){this.getIaControllerMap().set(r,a),o&&this.setDefIaControllerId(r),a&&a.setWidget(this)},removeIaController:function(r){var a=this.getIaControllerMap().get(r);a&&(this.getIaControllerMap().remove(r),r===this.getDefIaControllerId()&&this.setDefIaControllerId(null),r===this.getActiveIaControllerId()&&this.setActiveIaControllerId(null),a.setWidget(null))},getIaController:function(r){return this.getIaControllerMap().get(r)},execute:function(r){this.doExecute(r),this.invokeEvent("execute",{widget:this,htmlEvent:r})},doExecute:function(r){},isPeriodicalExecuting:function(){return this._periodicalExecBind},startPeriodicalExec:function(r){var a=this.getPeriodicalExecDelay()||0;this._periodicalExecuting=!0,this._periodicalExecHtmlEvent=r,this._periodicalExecHtmlEvent.__$periodicalExecuting$__=!0,setTimeout(this._periodicalExecBind,a)},stopPeriodicalExec:function(){this._periodicalExecuting=!1,this._periodicalExecHtmlEvent=null},_periodicalExec:function(r){this.isPeriodicalExecuting()&&(this._waitPeriodicalProcess||(this._waitPeriodicalProcess=!0,this.execute(this._periodicalExecHtmlEvent),this._waitPeriodicalProcess=!1),setTimeout(this._periodicalExecBind,this.getPeriodicalExecInterval()||20))}}),Kekule.Widget.InteractionController=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.InteractionController",initialize:function(r){this.tryApplySuper("initialize"),r&&this.setWidget(r)},doFinalize:function(){this.setWidget(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},activated:function(r){},handleUiEvent:function(r){var a=r.getType(),o=Kekule.Widget.getEventHandleFuncName(a);return!!this[o]&&this[o](r)},handleGestureEvent:function(r){var a=r.type,o=Kekule.Widget.getEventHandleFuncName(a);return!!this[o]&&this[o](r)},_defEventHandler:function(r){return!1},testMouseCursor:function(r,a){return this.doTestMouseCursor(r,a)},doTestMouseCursor:function(r,a){return null},_getEventMouseCoord:function(r,a){return this.getWidget()._getEventMouseCoord(r,a)}}),Kekule.Widget.DumbWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DumbWidget",initialize:function(r){this.tryApplySuper("initialize",[r,!0])},doGetDefaultTabIndex:function(){return null},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.DUMB_WIDGET},doCreateRootElement:function(r){return r.createElement("span")}}),Kekule.Widget.PlaceHolder=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.PlaceHolder",initialize:function(r,a){this.setPropStoreFieldValue("targetWidgetClass",a),this.tryApplySuper("initialize",[r,!0])},initProperties:function(){this.defineProp("targetWidgetClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){var r=this.getPropStoreFieldValue("targetWidgetClass");if(!r){var a=this.getPropStoreFieldValue("targetWidgetClassName");a&&(r=ClassEx.findClass(a))}return r}}),this.defineProp("targetWidgetClassName",{dataType:DataType.STRING,getter:function(){var r=this.getTargetWidgetClass();return r?ClassEx.getClassName(r):this.getPropStoreFieldValue("targetWidgetClassName")},setter:function(r){this.setPropStoreFieldValue("targetWidgetClassName",r),this.setTargetWidgetClass(ClassEx.findClass(r))}}),this.defineProp("target",{dataType:DataType.STRING,getter:function(){return this.getTargetWidgetClassName()},setter:function(r){this.setTargetWidgetClassName(r)}}),this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:"false",setter:null,getter:function(){var r=this.getPropStoreFieldValue("targetWidget");return r||(r=this.createTargetWidget()),r}})},doGetWidgetClassName:function(){var r=this.tryApplySuper("doGetWidgetClassName")+" "+n.PLACEHOLDER,a=this.getTargetWidgetClass();if(a){var o=ClassEx.getPrototype(a).getWidgetClassName();r=Kekule.StrUtils.addTokens(r,o)}return r},doCreateRootElement:function(r){return r.createElement("img")},doReactUiEvent:function(r){this.createTargetWidget()},createTargetWidget:function(){var r=this.getTargetWidgetClass();if(r){try{var a=this.getElement(),o=this.getParent();o&&o instanceof Kekule.Widget.PlaceHolder&&(o=o.createTargetWidget());var l=e.clone(this.getChildWidgets());this.unbindElement(this.getElement()),this.setPropStoreFieldValue("element",null);var u=new r(a);if(u){if(o){var c=this.getNextSibling();this.setParent(null),u.setPropStoreFieldValue("parent",o),o._insertChild(u,c)}if(l)for(var d=0,h=l.length;d<h;++d)l[d].setParent(u)}}finally{this.finalize()}return u}Kekule.error(Kekule.$L("ErrorMsg.WIDGET_UNAVAILABLE_FOR_PLACEHOLDER"))}}),Kekule.Widget.Utils={getWidgetOnElem:function(r,a){var o=r.__$kekule_widget__;return!a&&o instanceof Kekule.Widget.PlaceHolder&&(o=o.getTargetWidget()),o},getWidgetsInsideElem:function(r,a){var o,l=Kekule.Widget.Utils.getWidgetOnElem(r);if(l){if(o=[l],!a)return o}else o=[];for(var u=Kekule.DomUtils.getDirectChildElems(r),c=0,d=u.length;c<d;++c){var h=u[c],p=Kekule.Widget.Utils.getWidgetsInsideElem(h,a);o=o.concat(p)}return o},getWidgetById:function(r,a){a||(a=Kekule.$jsRoot.document);var o=a.getElementById(r);return o?Kekule.Widget.Utils.getWidgetOnElem(o):void 0},getBelongedWidget:function(r){for(var a=null;r&&!a;)a=Kekule.Widget.Utils.getWidgetOnElem(r),r=r.parentNode;return a},getBelongedResponsiveWidget:function(r){for(var a=null;r&&!a;)(a=Kekule.Widget.Utils.getWidgetOnElem(r))&&a.getStatic()&&(a=null),r=r.parentNode;return a},createFromHash:function(r,a){var o=a.widgetClass||a.widget;if(typeof o=="string"&&(o=ClassEx.findClass(o)),!o)return Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CLASS_NOT_FOUND")),null;for(var l=new o(r),u=Kekule.ObjUtils.getOwnedFieldNames(a,!0),c=0,d=(u=Kekule.ArrayUtils.exclude(u,["widget","widgetClass","htmlClass","children"])).length;c<d;++c){var h=u[c],p=a[h];if(h.startsWith("#")&&DataType.isFunctionValue(p)){var g=h.substr(1);l.addEventListener(g,p)}else l.hasProperty(h)&&l.setPropValue(h,p)}if(a.htmlClass&&l.addClassName(a.htmlClass,!0),a.children){var f=a.children;if(DataType.isArrayValue(f))for(c=0,d=f.length;c<d;++c){var m=f[c],C=Kekule.Widget.Utils.createFromHash(l,m);C&&C.appendToWidget(l)}}return l},setWidgetPropFromElemAttrib:function(r,a,o){var l=a.camelize(),u=r.getPropertyDataType(l);if(u||(a.startsWith("data-")&&(l=a.substr(5).camelize(),u=r.getPropertyDataType(l)),u))if(u===DataType.STRING)r.setPropValue(l,o);else if(Kekule.PredefinedResReferer.isResValue(o))Kekule.PredefinedResReferer.loadResource(o,function(p,g){r.loadPredefinedResDataToProp&&r.loadPredefinedResDataToProp(l,p,g)},null,r.getDocument());else if(o&&o.startsWith("#")&&ClassEx.isOrIsDescendantOf(ClassEx.findClass(u),Kekule.Widget.BaseWidget)){var c=o.substr(1).trim();Kekule.Widget.Utils._setWidgetRefPropFromId(r,l,c)}else{var d=JSON.parse(o);if(Kekule.ObjUtils.notUnset(d)){var h=Class.ObjSerializerFactory.getSerializer("json").load(null,d);r.setPropValue(l,h)}}},_setWidgetRefPropFromId:function(r,a,o){if(o){var l=Kekule.Widget.getWidgetById(o,r.getDocument());l&&r.setPropValue(a,l)}},getGlobalManager:function(r){var a=r||Kekule.$document,o=a&&Kekule.DocumentUtils.getDefaultView(a),l=o&&o.Kekule;return l||(l=Kekule),l.Widget.globalManager},getThemeUrl:function(r){var a=null;r||(r="default");var o=Kekule.getScriptPath();return o&&(a=o+((Kekule.isUsingMinJs()?"themes/":"widgets/themes/")+r)+"/kekule.css"),a}},Kekule.Widget.getWidgetOnElem=Kekule.Widget.Utils.getWidgetOnElem,Kekule.Widget.getWidgetById=Kekule.Widget.Utils.getWidgetById,Kekule.$W=Kekule.Widget.Utils.getWidgetById,Kekule.Widget.getBelongedWidget=Kekule.Widget.Utils.getBelongedWidget,Kekule.Widget.createFromHash=Kekule.Widget.Utils.createFromHash,Kekule.Widget.BaseEventsReceiver=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseEventsReceiver",initialize:function(r,a){this._document=r||Kekule.$jsRoot.document,this._eventRootObj=a||this._document&&this._document.documentElement,this.reactUiEventBind=this.reactUiEvent.bind(this),this.reactDomNodeInsertEventBind=this.reactDomNodeInsertEvent.bind(this),this.reactDomNodeRemoveEventBind=this.reactDomNodeRemoveEvent.bind(this),this.tryApplySuper("initialize");var o=this;(function(){Kekule.X.domReady(o.domReadyInit.bind(o),this._document)}).defer()},finalize:function(){var r=this.getEventRootObj();r&&(this.uninstallGlobalDomMutationHandlers(r),this.uninstallGlobalEventHandlers(r)),this.tryApplySuper("finalize")},getEventRootObj:function(){return this._eventRootObj},domReadyInit:function(){var r=this.getEventRootObj();r&&(this.installGlobalEventHandlers(r),this.installGlobalDomMutationHandlers(r))},installGlobalEventHandlers:function(r){if(!this._globalEventInstalled){for(var a=Kekule.Widget.UiEvents,o=0,l=a.length;o<l;++o)a[o]==="touchstart"||a[o]==="touchmove"||a[o]==="touchend"?Kekule.X.Event.addListener(r,a[o],this.reactUiEventBind,{passive:!0}):Kekule.X.Event.addListener(r,a[o],this.reactUiEventBind);this._globalEventInstalled=!0}},uninstallGlobalEventHandlers:function(r){for(var a=Kekule.Widget.UiEvents,o=0,l=a.length;o<l;++o)Kekule.X.Event.removeListener(r,a[o],this.reactUiEventBind)},installGlobalDomMutationHandlers:function(r){var a=this;if(Kekule.X.MutationObserver&&Kekule.DomUtils.isElement(r)){var o=new Kekule.X.MutationObserver(function(l){a.reactDomMutation(l)});o.observe(r,{childList:!0,subtree:!0}),this._domMutationObserver=o}else Kekule.X.Event.addListener(r,"DOMNodeInserted",this.reactDomNodeInsertEventBind),Kekule.X.Event.addListener(r,"DOMNodeRemoved",this.reactDomNodeRemoveEventBind)},uninstallGlobalDomMutationHandlers:function(r){this._domMutationObserver&&this._domMutationObserver.disconnect(),this._reactDomNodeInserted&&Kekule.X.Event.removeListener(r,"DOMNodeInserted",this.reactDomNodeInsertEventBind),this._reactDomNodeRemoved&&Kekule.X.Event.removeListener(r,"DOMNodeRemoved",this.reactDomNodeRemoveEventBind)},reactUiEvent:function(r){},reactDomNodeInsertEvent:function(r){},reactDomNodeRemoveEvent:function(r){},reactDomMutation:function(r){}}),Kekule.Widget.GlobalManager=Class.create(Kekule.Widget.BaseEventsReceiver,{CLASS_NAME:"Kekule.Widget.GlobalManager",INFO_FIELD:"__$info__",ISOLATED_LAYER_FIELD:"__$isolated_layer__",TOPMOST_LAYER_FIELD:"__$topmost_layer__",THEME_LOADED_FIELD:"__$theme_loaded__",initialize:function(r){this._document=r||Kekule.$jsRoot.document,this._touchEventSeq=[],this._hammertime=null,this._globalSysElems=[],this.setPropStoreFieldValue("popupWidgets",[]),this.setPropStoreFieldValue("dialogWidgets",[]),this.setPropStoreFieldValue("modalWidgets",[]),this.setPropStoreFieldValue("autoResizeWidgets",[]),this.setPropStoreFieldValue("widgets",[]),this.setPropStoreFieldValue("draggingElems",[]),this.setPropStoreFieldValue("preserveWidgetList",!0),this.setPropStoreFieldValue("enableMouseEventToPointerPolyfill",!0),this.setPropStoreFieldValue("enableHammerGesture",!1),this.setPropStoreFieldValue("htmlEventDispatcher",new Kekule.Widget.HtmlEventDispatcher),this.reactTouchGestureBind=this.reactTouchGesture.bind(this),this.reactWindowResizeBind=this.reactWindowResize.bind(this),this.tryApplySuper("initialize",[this._document,this._document&&this._document.documentElement])},finalize:function(){this.getHtmlEventDispatcher().finalize(),this.uninstallWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document)),this._hammertime=null,this.setPropStoreFieldValue("popupWidgets",null),this.setPropStoreFieldValue("widgets",null),this.setPropStoreFieldValue("draggingElems",null),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("mouseCaptureWidget",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("popupWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("dialogWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("modalWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("autoResizeWidgets",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("draggingElems",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("preserveWidgetList",{dataType:DataType.BOOL,serializable:!1,setter:function(r){this.setPropStoreFieldValue("preserveWidgetList",r),r||this.setPropStoreFieldValue("widgets",[])}}),this.defineProp("widgets",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("currHoverWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("currActiveWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var r=this.getPropStoreFieldValue("currFocusedWidget");return r&&r.isShown&&r.isShown()?r:null}}),this.defineProp("currFocusedWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var r=this.getPropStoreFieldValue("currFocusedWidget");return r&&r.isShown&&r.isShown()?r:null}}),this.defineProp("modalBackgroundElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("enableHammerGesture",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMouseEventToPointerPolyfill",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("htmlEventDispatcher",{dataType:"Kekule.Widget.HtmlEventDispatcher",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null})},domReadyInit:function(){this.tryApplySuper("domReadyInit"),this.getEnableHammerGesture()&&(this._hammertime=this.installGlobalHammerTouchHandlers(this._document.body)),this.installWindowEventHandlers(Kekule.DocumentUtils.getDefaultView(this._document))},getDefaultContextRootElem:function(){return this.getDocContextRootElem()},getDocContextRootElem:function(){return this._document.body},_detectIfThemeLoaded:function(r){var a=r[this.THEME_LOADED_FIELD];if(!a){var o=r.ownerDocument.createElement("span");o.className="K-StyleSheet-Detector",o.style.visibility="hidden",r.appendChild(o),Kekule.StyleUtils.getComputedStyle(o,"z-index")==-88888?(a=!0,r[this.THEME_LOADED_FIELD]=a):a=!1,r.removeChild(o)}return a},loadTheme:function(r,a){if(r||(r=this.getDefaultContextRootElem()),!this._detectIfThemeLoaded(r)){var o=Kekule.Widget.Utils.getThemeUrl(a);Kekule.UrlUtils.extractProtocal(o)||(o=Kekule.UrlUtils.normalizePath("file:///"+o));var l=r.ownerDocument.createElement("style");l.innerHTML='@import "'+o+'"',r.appendChild(l),r[this.THEME_LOADED_FIELD]=!0}},notifyWidgetCreated:function(r){this.getPreserveWidgetList()&&this.getWidgets().push(r),this.invokeEvent("widgetCreate",{widget:r})},notifyWidgetFinalized:function(r){this.getWidgets()&&Kekule.ArrayUtils.remove(this.getWidgets(),r),this.getPopupWidgets()&&Kekule.ArrayUtils.remove(this.getPopupWidgets(),r),this.getDialogWidgets()&&Kekule.ArrayUtils.remove(this.getDialogWidgets(),r),this.getAutoResizeWidgets()&&Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),r),r===this.getCurrActiveWidget()&&this.setCurrActiveWidget(null),r===this.getCurrFocusedWidget()&&this.setCurrFocusedWidget(null),this.invokeEvent("widgetFinalize",{widget:r})},notifyWidgetHoverChanged:function(r,a){var o=this.getCurrHoverWidget();a?r!==o&&(o&&o.setIsHover(!1),this.setCurrHoverWidget(r)):o===r&&this.setCurrHoverWidget(null)},notifyWidgetActiveChanged:function(r,a){var o=this.getCurrActiveWidget();a?r!==o&&(o&&o.setIsActive(!1),this.setCurrActiveWidget(r)):o===r&&this.setCurrActiveWidget(null)},notifyWidgetFocusChanged:function(r,a){var o=this.getCurrFocusedWidget();a?r!==o&&(o&&o.setIsFocused(!1),this.setCurrFocusedWidget(r)):o===r&&this.setCurrFocusedWidget(null)},hasPopupWidgets:function(){return!!this.getPopupWidgets().length},hasDialogWidgets:function(){return!!this.getDialogWidgets().length},getBelongedResponsiveWidget:function(r){return Kekule.Widget.Utils.getBelongedResponsiveWidget(r)},notifyWidgetEventFired:function(r,a,o){var l=Object.extend({},o);l.widget=r,this.invokeEvent(a,l)},installWindowEventHandlers:function(r){Kekule.X.Event.addListener(r,"resize",this.reactWindowResizeBind)},uninstallWindowEventHandlers:function(r){Kekule.X.Event.removeListener(r,"resize",this.reactWindowResizeBind)},installGlobalHammerTouchHandlers:function(r){if(Kekule.$jsRoot.Hammer!==void 0){var a=new Hammer(r);return a.get("pinch").set({enable:!0}),a.get("rotate").set({enable:!0}),a.on(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind),this._hammertime=a,a}},uninstallGlobalHammerTouchHandlers:function(r){this._hammertime&&this._hammertime.off(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind)},registerHtmlEventResponser:function(r){return this.getHtmlEventDispatcher().registerResponser(r),this},unregisterHtmlEventResponser:function(r){return this.getHtmlEventDispatcher().unregisterResponser(r),this},_handleDomAddedElem:function(r){for(var a=Kekule.Widget.Utils.getWidgetsInsideElem(r,!0),o=0,l=a.length;o<l;++o)(u=a[o]).insertedToDom();var u;(u=Kekule.Widget.Utils.getBelongedWidget(r))&&(u.getElement()===r?u.insertedToDom():u.domElemAdded(r))},_handleDomRemovedElem:function(r){for(var a=Kekule.Widget.Utils.getWidgetsInsideElem(r,!0),o=0,l=a.length;o<l;++o)(u=a[o]).removedFromDom();var u;(u=Kekule.Widget.Utils.getBelongedWidget(r))&&u.domElemRemoved(r)},isMouseEvent:function(r){return r.startsWith("mouse")||r==="click"},isTouchEvent:function(r){return r.startsWith("touch")},isPointerEvent:function(r){return r.startsWith("pointer")},isKeyEvent:function(r){return r.startsWith("key")},mapTouchToPointerEvent:function(r){var a,o=r.getType(),l=r;if(l.pointerType="touch",o==="touchstart"?a="pointerdown":o==="touchmove"?a="pointermove":o==="touchleave"?a="pointerout":o==="touchend"&&(a="pointerup"),a){l.setType(a),l.button=Kekule.X.Event.MouseButton.LEFT;var u=r.touches[0],c=["clientX","clientY","pageX","pageY","screenX","screenY"];if(u){for(var d={},h=0,p=c.length;h<p;++h)l[f=c[h]]=u[f],d[f]=u[f];this._document;var g=this._retrieveTouchEventActualTarget(l);l.setTarget(g),this._touchPointerMapData={positionCache:d,targetCache:l.getTarget()}}else{if(this._touchPointerMapData)for(h=0,p=c.length;h<p;++h){var f;l[f=c[h]]=this._touchPointerMapData.positionCache[f]}l.setTarget(this._touchPointerMapData.targetCache)}return l}return null},_retrieveTouchEventActualTarget:function(r){var a=r.getTarget();return this._retrieveElementFromClientCoord(a,r.getClientX(),r.getClientY())},_retrieveElementFromClientCoord:function(r,a,o){var l=r;if(r.shadowRoot&&r.getRootNode){var u=r.shadowRoot;if(u.elementFromPoint){var c=u.elementFromPoint(a,o);c&&c!==r&&(l=this._retrieveElementFromClientCoord(c,a,o))}}return l},reactDomNodeInsertEvent:function(r){this.tryApplySuper("reactDomNodeInsertEvent",[r]);var a=r.getTarget();a.nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(a)||this._handleDomAddedElem(a))},reactDomNodeRemoveEvent:function(r){this.tryApplySuper("reactDomNodeRemoveEvent",[r]);var a=r.getTarget();a.nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(a)||this._handleDomRemovedElem(a))},reactDomMutation:function(r){this.tryApplySuper("reactDomMutation",[r]);for(var a=0,o=r.length;a<o;++a){var l=r[a];if(l.type==="childList"){for(var u=0,c=(d=l.addedNodes).length;u<c;++u)(h=d[u]).nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(h)||this._handleDomAddedElem(h));var d;for(u=0,c=(d=l.removedNodes).length;u<c;++u){var h;(h=d[u]).nodeType===Node.ELEMENT_NODE&&(this._isGlobalSysElement(h)||this._handleDomRemovedElem(h))}}}},reactUiEvent:function(r){this.tryApplySuper("reactUiEvent",[r]);var a,o=r.getType();if(this.getMouseCaptureWidget()&&(this.isMouseEvent(o)||this.isTouchEvent(o)||this.isPointerEvent(o)))a=this.getMouseCaptureWidget();else{var l=r.getTarget();!(a=this.getBelongedResponsiveWidget(l))&&this.isKeyEvent(o)&&l===l.ownerDocument.body&&(a=this.getCurrFocusedWidget()||null)}if(o==="touchstart"?(this._touchEventSeq=["touchstart"],this._touchDoneTimeStamp=null):o==="touchcancel"?this._touchEventSeq=[]:o==="touchend"?this._touchEventSeq[0]==="touchstart"&&(this._touchEventSeq.push("touchend"),this._touchDoneTimeStamp=Date.now()):["mousedown","mouseup","mouseover","mouseout","click"].indexOf(o)>=0&&(this._touchEventSeq[0]==="touchstart"&&this._touchEventSeq[1]==="touchend"?(r.ghostMouseEvent=!0,o==="click"&&(this._touchEventSeq=[],this._touchDoneTimeStamp=Date.now())):this._touchDoneTimeStamp&&Date.now()-this._touchDoneTimeStamp<1e3&&(r.ghostMouseEvent=!0)),this.getHtmlEventDispatcher().dispatch(r),this.doReactUiEvent(r,a),!r.ghostMouseEvent&&(Kekule.globalOptions.widget.events.forceSimulatePointerEvent||!Kekule.BrowserFeature.pointerEvent)&&this.getEnableMouseEventToPointerPolyfill()){var u=["mousedown","mousemove","mouseout","mouseover","mouseup"].indexOf(o);if(u>=0)r.setType(["pointerdown","pointermove","pointerout","pointerover","pointerup"][u]),r.pointerType="mouse",this.doReactUiEvent(r,a);else if(["touchstart","touchmove","touchleave","touchend","touchcancel"].indexOf(o)>=0){var c=this.mapTouchToPointerEvent(r);c&&this.reactUiEvent(c)}}},doReactUiEvent:function(r,a){var o=Kekule.Widget.getEventHandleFuncName(r.getType());this[o]&&this[o](r),a&&(this._htmlEventOnWidgetInvoked(a,r),a.reactUiEvent(r))},reactTouchGesture:function(r){var a=Kekule.Widget.getTouchGestureHandleFuncName(r.getType&&r.getType()||r.type);this[a]&&this[a](r);var o=Kekule.Widget.getBelongedWidget(r.target);o&&o.reactTouchGesture(r)},reactWindowResize:function(r){for(var a=this.getAutoResizeWidgets(),o=0,l=a.length;o<l;++o)a[o].isShown()&&a[o].autoResizeToClient()},_htmlEventOnWidgetInvoked:function(r,a){this.invokeEvent("htmlEventOnWidget",{widget:r,htmlEvent:a}),this.invokeEvent(a.getType(),{widget:r,htmlEvent:a})},_startPointerHolderTimer:function(r){var a=this;return this._pointerHolderTimer={pointerType:r.pointerType,button:r.getButton(),coord:{x:r.getClientX(),y:r.getClientY()},target:r.getTarget(),_timeoutId:setTimeout(function(){var o=r;o.setType("pointerhold"),a._pointerHolderTimer=null,a.reactUiEvent(o)},Kekule.Widget._PointerHoldParams.DURATION_THRESHOLD),cancel:function(){clearTimeout(a._pointerHolderTimer._timeoutId),a._pointerHolderTimer=null}},this._pointerHolderTimer},react_pointerdown:function(r){if(this.hasPopupWidgets()&&!r.ghostMouseEvent&&r.getButton()===Kekule.X.Event.MouseButton.LEFT){var a=r.getTarget();this.hidePopupWidgets(a)}this._pointerHolderTimer?r.pointerType===this._pointerHolderTimer.pointerType&&r.getButton()===this._pointerHolderTimer.button||this._pointerHolderTimer.cancel():this._startPointerHolderTimer(r)},react_pointerup:function(r){this._pointerHolderTimer&&this._pointerHolderTimer.cancel()},react_pointermove:function(r){if(this._pointerHolderTimer)if(r.getTarget()!==this._pointerHolderTimer.target)this._pointerHolderTimer.cancel();else{var a=this._pointerHolderTimer.coord,o={x:r.getClientX(),y:r.getClientY()};Kekule.CoordUtils.getDistance(a,o)>Kekule.Widget._PointerHoldParams.MOVEMENT_THRESHOLD&&this._pointerHolderTimer.cancel()}},react_keydown:function(r){r.getKeyCode()===Kekule.X.Event.KeyCode.ESC&&(this.hasPopupWidgets()?this.hidePopupWidgets(null,!0):this.hasDialogWidgets()&&this.hideTopmostDialogWidget(null,!0))},react_touchstart:function(r){if(this.hasPopupWidgets()){var a=r.getTarget();this.hidePopupWidgets(a)}},react_dragstart:function(r){this._clearDraggingElems();var a=r.getTarget();if(a&&r.dataTransfer){var o=this._appendDraggingElem(a);if(r.dataTransfer.setData)try{r.dataTransfer.setData(Kekule.Widget.DragDrop.ELEM_INDEX_DATA_TYPE,""+o)}catch{}var l=Kekule.Widget.getBelongedWidget(a);l&&l.dragStart({htmlEvent:r,dataTransfer:r.dataTransfer,startingElem:a})}},react_dragend:function(r){var a=r.getTarget();if(a){var o=Kekule.Widget.getBelongedWidget(a);o&&o.dragEnd({htmlEvent:r,dataTransfer:r.dataTransfer,startingElem:a})}this._dragDone(r)},react_dragover:function(r){var a=r.getTarget(),o=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(a));if(o&&o.getDroppable()&&r.dataTransfer){var l=this._getElemAndWidgetInDraggingTransfer(r.dataTransfer),u={htmlEvent:r,dataTransfer:r.dataTransfer,srcElem:l.elem,srcWidget:l.widget};o.acceptDragSrc(u)&&(r.preventDefault(),o.dragOver(u))}},react_dragleave:function(r){var a=r.getTarget(),o=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(a));if(o&&o.getDroppable()&&r.dataTransfer){var l=this._getElemAndWidgetInDraggingTransfer(r.dataTransfer),u={htmlEvent:r,dataTransfer:r.dataTransfer,srcElem:l.elem,srcWidget:l.widget};o.acceptDragSrc(u)&&o.dragLeave(u)}},react_drop:function(r){var a=r.getTarget(),o=this._getNearestDragDropDestWidget(Kekule.Widget.getBelongedWidget(a));if(o&&o.getDroppable()){var l=this._getElemAndWidgetInDraggingTransfer(r.dataTransfer),u={htmlEvent:r,dataTransfer:r.dataTransfer,srcElem:l.elem,srcWidget:l.widget};o.acceptDragSrc(u)&&o.dragDrop(u)&&r.preventDefault()}this._dragDone(r)},_dragDone:function(r){this._clearDraggingElems();var a=r.dataTransfer;a&&(a.items?a.items.clear():a.clearData())},_getNearestDragDropDestWidget:function(r){if(!r)return null;if(r.getDroppable())return r;var a=r.getParent();return a&&this._getNearestDragDropDestWidget(a)},_getElemAndWidgetInDraggingTransfer:function(r){var a,o;if(r.getData){try{var l=r.getData(Kekule.Widget.DragDrop.ELEM_INDEX_DATA_TYPE);if(Kekule.ObjUtils.notUnset(l)){var u=parseInt(l)||0;a=this.getDraggingElems()[u]}}catch{var c=this.getDraggingElems();c&&c.length===1&&(a=c[0])}a&&(o=Kekule.Widget.getBelongedWidget(a))}return{elem:a,widget:o}},_clearDraggingElems:function(){this.setPropStoreFieldValue("draggingElems",[])},_appendDraggingElem:function(r){var a=this.getDraggingElems();return a.push(r),a.length-1},unpreparePopupWidget:function(r){r.setPopupCaller(null),this.restoreElem(r.getElement())},preparePopupWidget:function(r,a,o){r.setPopupCaller(a);var l,u,c=r.getElement(),d=c.ownerDocument,h=a?this.getContextRootElementOfCaller(a):c.ownerDocument.body,p=this.getTopmostLayer(d,!0,h),g=c.parentNode===p,f=Kekule.Widget.ShowHideType,m=r.getAutoAdjustSizeOnPopup();if(o===f.DROPDOWN?(u=Kekule.StyleUtils.isSelfOrAncestorPositionFixed(a.getElement()),l=this._calcDropDownWidgetPosInfo(r,a,u)):l=this._calcPopupWidgetPosInfo(r,a,g),m&&l){var C=a||r,_=(d=C.getDocument?C.getDocument():C.ownerDocument,Kekule.DocumentUtils.getClientVisibleBox(d)),y=_.right-_.left,T=_.bottom-_.top,E=l.rect;E.left+E.width>y+_.left&&(l.width=_.right-E.left+"px",l.widthChanged=!0),E.top+E.height>T+_.top&&(l.height=_.bottom-E.top+"px",l.heightChanged=!0)}if(g?this.moveElemToTopmostLayer(c,!0,h):this.moveElemToTopmostLayer(c,null,h),l){var b=["left","top","right","bottom"];l.widthChanged&&b.push("width"),l.heightChanged&&b.push("height");var v={},I=c.style;o===f.DROPDOWN&&u?I.position="fixed":Kekule.StyleUtils.isAbsOrFixPositioned(c)||(I.position="absolute");for(var R=0,N=b.length;R<N;++R){var L=b[R],U=l[L];U&&(v[L]=I[L]||"",I[L]=U)}this._getElemStoredInfo(c).styles=v}},_calcPopupWidgetPosInfo:function(r,a,o){var l,u=Kekule.HtmlElementUtils,c=r.getElement();r.isShown()||(c.style.visible="hidden",c.style.display="");var d,h=!1;if(!Kekule.DomUtils.isInDomTree(c,null,{acrossShadowRoot:!0})){var p=a?this.getContextRootElementOfCaller(a):c.ownerDocument.body;(d=this.getIsolatedLayer(r.getDocument(),!0,p)).appendChild(c),h=!0}var g=u.getElemBoundingClientRect(c,!0);return l={rect:g},o||Kekule.StyleUtils.getComputedStyle(c,"position")!=="fixed"&&(l.top=g.top+"px",l.left=g.left+"px"),h&&d.removeChild(c),l},_calcDropDownWidgetPosInfo:function(r,a,o){var l=Kekule.HtmlElementUtils,u=Kekule.Widget.Position,c=a.getDropPosition?a.getDropPosition():null,d=a.getParent(),h=d&&d.getLayout()||Kekule.Widget.Layout.HORIZONTAL,p=a.getElement(),g=this.getContextRootElementOfCaller(a),f=l.getElemBoundingClientRect(p,!0),m=Kekule.DocumentUtils.getClientVisibleBox(a.getDocument()),C=r.getElement();C.style.visible="hidden",C.style.display="";var _=this.getIsolatedLayer(C.ownerDocument,!0,g);_.appendChild(C),C.style.position="relative";var y=l.getElemOffsetDimension(C),T=l.getElemScrollDimension(C),E=l.getElemPageRect(C,!0);if(C.style.position="absolute",_.removeChild(C),!c||c===u.AUTO)if(c=0,h===Kekule.Widget.Layout.VERTICAL){var b=f.x-m.left,v=m.right-f.x-f.width;v>=y.width?c|=u.RIGHT:c|=b>v?u.LEFT:u.RIGHT}else{var I=f.y-m.top,R=m.bottom-f.y-f.height;R>=y.height?c|=u.BOTTOM:c|=I>R?u.TOP:u.BOTTOM}Kekule.StyleUtils,f=l.getElemBoundingClientRect(p,!o);var N,L,U=T.width,W=T.height;if(c&u.LEFT)N=f.left-E.width;else if(c&u.RIGHT)N=f.right;else{var M=f.right-m.left;N=m.right-f.left>=E.width?f.left:M>=E.width?f.right-E.width:Math.max(m.left,m.right-E.width)}if(c&u.TOP)L=f.top-E.height;else if(c&u.BOTTOM)L=f.bottom;else{var B=f.bottom-m.top;L=m.bottom-f.top>=E.height?f.bottom:B>=E.height?f.bottom-E.height:Math.max(m.top,m.bottom-E.height)}var V={};return V.rect={left:N,top:L,width:U,height:W},N+="px",L+="px",U+="px",W+="px",V.left=N,V.top=L,V.width=U,V.height=W,V},_fillPersistentPopupWidgetsInHidden:function(r,a,o,l){var u,c,d;l.push(r);try{r&&r instanceof Kekule.Widget.BaseWidget?(u=r.getElement(),c=r.getParent(),d=r.getPopupCaller()):u=r instanceof HTMLElement?r:null}catch{u=null}if(u){for(var h=0,p=a.length;h<p;++h){var g=a[h];if(g===r)o.push(g);else{var f=g.getElement();Kekule.DomUtils.isDescendantOf(u,f)&&o.push(g)}}c&&l.indexOf(c)<=0&&this._fillPersistentPopupWidgetsInHidden(c,a,o,l),d&&l.indexOf(d)<=0&&this._fillPersistentPopupWidgetsInHidden(d,a,o,l)}},hidePopupWidgets:function(r,a){var o=this.getPopupWidgets(),l=Kekule.Widget.getBelongedWidget(r),u=[];l&&this._fillPersistentPopupWidgetsInHidden(l,o,u,[]);for(var c=o.length-1;c>=0;--c){var d=o[c],h=d.getElement();if(h){if(u.indexOf(d)>=0)continue;r&&(h===r||Kekule.DomUtils.isDescendantOf(r,h))||(a?d.dismiss():d.hide())}else Kekule.ArrayUtils.remove(this.getPopupWidgets(),d)}},hideTopmostDialogWidget:function(r,a){var o=this.getDialogWidgets()||[],l=o[o.length-1];l&&(l.getElement()?a?l.dismiss():l.hide():Kekule.ArrayUtils.remove(this.geDialogWidgets(),l))},registerPopupWidget:function(r){r.addClassName(n.SHOW_POPUP),Kekule.ArrayUtils.pushUnique(this.getPopupWidgets(),r)},unregisterPopupWidget:function(r){r.removeClassName(n.SHOW_POPUP),Kekule.ArrayUtils.remove(this.getPopupWidgets(),r)},registerDialogWidget:function(r){r.addClassName(n.SHOW_DIALOG),Kekule.ArrayUtils.pushUnique(this.getDialogWidgets(),r)},unregisterDialogWidget:function(r){r.removeClassName(n.SHOW_DIALOG),Kekule.ArrayUtils.remove(this.getDialogWidgets(),r)},registerModalWidget:function(r){var a=this.getCurrModalWidget();a&&a.removeClassName(n.SHOW_ACTIVE_MODAL),Kekule.ArrayUtils.pushUnique(this.getModalWidgets(),r),r.addClassName(n.SHOW_ACTIVE_MODAL)},unregisterModalWidget:function(r){r.removeClassName(n.SHOW_ACTIVE_MODAL),Kekule.ArrayUtils.remove(this.getModalWidgets(),r);var a=this.getCurrModalWidget();a&&a.addClassName(n.SHOW_ACTIVE_MODAL)},getCurrModalWidget:function(){var r=this.getModalWidgets();return r&&r.length?r[0]:null},prepareModalWidget:function(r,a){var o=r.getDocument(),l=this.getModalBackgroundElem();l||((l=o.createElement("div")).className=n.MODAL_BACKGROUND,this.setPropStoreFieldValue("modalBackgroundElem",l),this._globalSysElems.push(l));var u=r.getElement();r.setModalInfo({oldParent:u.parentNode,oldSibling:u.nextSibling}),u.parentNode&&u.parentNode.removeChild(u),l.parentNode&&l.parentNode.removeChild(l);var c=a?this.getContextRootElementOfCaller(a):u.ownerDocument.body,d=this.getTopmostLayer(o,!1,c);d&&d.parentNode===c?(c.insertBefore(l,d),c.insertBefore(u,d)):(c.appendChild(l),c.appendChild(u)),this.registerModalWidget(r)},unprepareModalWidget:function(r){r.getDocument(),this.unregisterModalWidget(r);var a=r.getElement().parentNode;a&&a.removeChild(r.getElement());var o=r.getModalInfo();o&&(o.oldParent&&o.oldParent.insertBefore(r.getElement(),o.oldSibling),r.setModalInfo(null));var l=this.getCurrModalWidget(),u=this.getModalBackgroundElem();u&&(l?(u.parentNode&&u.parentNode.removeChild(u),l.getElement().parentNode.insertBefore(u,l.getElement())):u.parentNode&&u.parentNode.removeChild(u))},registerAutoResizeWidget:function(r){Kekule.ArrayUtils.pushUnique(this.getAutoResizeWidgets(),r)},unregisterAutoResizeWidget:function(r){Kekule.ArrayUtils.remove(this.getAutoResizeWidgets(),r)},getWidgetContextRootElement:function(r){return r&&r.getDocument?r.getDocument().body:this._document.body},getContextRootElementOfCaller:function(r){return r instanceof Kekule.Widget.BaseWidget?this.getWidgetContextRootElement(r):r.ownerDocument?r.ownerDocument.body:this._document.body},getTopmostLayer:function(r,a,o){r=o.ownerDocument;var l=o[this.TOPMOST_LAYER_FIELD];return l||a&&(l=this._createTopmostLayer(r,o),o.appendChild(l),o[this.TOPMOST_LAYER_FIELD]=l,this._globalSysElems.push(l)),l},_createTopmostLayer:function(r,a){var o=r.createElement("div");return o.className=n.TOP_LAYER,o},getIsolatedLayer:function(r,a,o){var l=o[this.ISOLATED_LAYER_FIELD];if(!l&&a){l=this._createIsolatedLayer(r,o),this._globalSysElems.push(l);var u=o.firstChild;u?o.insertBefore(l,u):o.appendChild(l),o[this.ISOLATED_LAYER_FIELD]=l}return l},_createIsolatedLayer:function(r,a){var o=r.createElement("div");return o.className=n.ISOLATED_LAYER,o},_isGlobalSysElement:function(r){return this._globalSysElems.indexOf(r)>=0},_getElemStoredInfo:function(r){var a=null;return r&&((a=r[this.INFO_FIELD])||(a={},r[this.INFO_FIELD]=a)),a},_clearElemStoredInfo:function(r){r[this.INFO_FIELD]&&(r[this.INFO_FIELD]=void 0)},moveElemToTopmostLayer:function(r,a,o){if(!a){var l=this._getElemStoredInfo(r);l.parentElem=r.parentNode,l.nextSibling=r.nextSibling}this.getTopmostLayer(r.ownerDocument,!0,o).appendChild(r)},restoreElem:function(r){if(r){var a=this._getElemStoredInfo(r);if(a){for(var o=a.styles,l=Kekule.ObjUtils.getOwnedFieldNames(o),u=r.style,c=0,d=l.length;c<d;++c){var h=l[c],p=o[h];p?u[h]=p:Kekule.StyleUtils.removeStyleProperty(u,h)}a.parentElem&&(a.nextSibling?a.parentElem.insertBefore(r,a.nextSibling):a.parentElem.appendChild(r)),r[this.INFO_FIELD]=null}}}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.GlobalManager),Kekule.Widget.globalManager=Kekule.Widget.GlobalManager.getInstance()}(),function(){var e,t=function(){var i=["monospace","sans-serif","serif"],r=document.getElementsByTagName("body")[0],a=document.createElement("span");a.style.fontSize="72px",a.innerHTML="mmmmmmmmmmlli";var o={},l={};for(var u in i)a.style.fontFamily=i[u],r.appendChild(a),o[i[u]]=a.offsetWidth,l[i[u]]=a.offsetHeight,r.removeChild(a);this.detect=function(c){var d=!1;for(var h in i){a.style.fontFamily=c+","+i[h],r.appendChild(a);var p=a.offsetWidth!=o[i[h]]||a.offsetHeight!=l[i[h]];r.removeChild(a),d=d||p}return d}};Kekule.Widget.FontDetector={detect:function(i){var r=e;return r||(r=new t,e=r),r.detect(i)}};var n=["Arial, Helvetica, sans-serif","Georgia, Times New Roman, Times, serif","Courier New, Courier, monospace","Tahoma, Geneva, sans-serif","Trebuchet MS, Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Palatino Linotype, Book Antiqua, Palatino, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Serif, New York, serif","Lucida Console, Monaco, monospace","Comic Sans MS, cursive"];Kekule.Widget.FontEnumerator={getAvailableFontFamilies:function(i){i||(i=n);for(var r=[],a=0,o=i.length;a<o;++a){var l=i[a];Kekule.Widget.FontDetector.detect(l)&&r.push(l)}return r}}}(),function(){var e=Kekule.ObjUtils;Kekule.globalOptions.add("widget.shortcut",{enabled:!0}),Kekule.Widget.KeyboardUtils={DEF_COMBINATION_KEY_DELIMITER:"+",_initShiftKeyMap:function(){for(var t=[["`","~"],["1","!"],["2","@"],["3","#"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")"],["-","_"],["=","+"],["[","{"],["]","}"],[";",":"],["'",'"'],["\\","|"],[",","<"],[".",">"],["/","?"]],n={},i=0,r=t.length;i<r;++i)n[t[i][0]]=t[i][1],n[t[i][1]]=t[i][0];return n},isPrintableKey:function(t){return!!t&&t.length<=1},getShiftedKey:function(t){if(t&&t.length<=1){var n=t.charAt(0);return n>="a"&&n<="z"?n.toUpperCase():n>="A"&&n<="Z"?n.toLowerCase():Kekule.Widget.KeyboardUtils._shiftKeyMap[n]||n}return t},shortcutLabelToKeyParams:function(t,n,i){for(var r,a,o=n?[n]:["+","-","_"],l=-1,u=0,c=o.length;u<c;++u){var d=o[u],h=t.split(d);h.length>l&&(r=d,l=h.length,a=h)}var p={};if(l<=0)p.key=r;else for(u=0,c=a.length;u<c;++u){var g=a[u];g||u!==c-1||(g=r);var f=g.toLowerCase();f==="shift"?p.shiftKey=!0:f==="alt"?p.altKey=!0:f==="ctrl"||f==="control"?p.ctrlKey=!0:f==="meta"?p.metaKey=!0:p.key=f==="esc"?"Escape":f==="del"?"Delete":f==="ins"?"Insert":f==="pgup"?"PageUp":f==="pgdown"||f==="pgdn"?"PageDown":f==="space"?" ":g,p.key||u!==c-1||(p.key=f==="ctrl"?"Control":g)}return!i&&p.key&&(p.key=p.key.charAt(0).toUpperCase()+p.key.substr(1)),p},keyParamsToShortcutLabel:function(t,n,i){n||(n=Kekule.Widget.KeyboardUtils.DEF_COMBINATION_KEY_DELIMITER);var r=[];t.ctrlKey&&r.push("Ctrl"),t.altKey&&r.push("Alt"),t.metaKey&&r.push("Meta"),t.shiftKey&&r.push("Shift");var a=t.key;if(a){a==="Escape"?a="Esc":a==="Insert"?a="Ins":a==="Delete"?a="Del":a==="Control"?a="Ctrl":a===" "&&(a="Space"),i||(a=a.charAt(0).toUpperCase()+a.substr(1));var o=r.indexOf(a);o>=0&&r.splice(o,1),r.push(a)}return r.join(n)},_standardizeEventKeyValue:function(t){return t==="Esc"?"Escape":t==="Del"?"Delete":t==="Spacebar"?" ":t==="Left"?"ArrowLeft":t==="Right"?"ArrowRight":t==="Up"?"ArrowUp":t==="Down"?"ArrowDown":t==="OS"?"Meta":t==="Scroll"?"ScrollLock":t==="Apps"?"ContextMenu":t==="Crsel"?"CrSel":t==="Exsel"?"ExSel":t},getKeyParamsFromEvent:function(t,n){var i={altKey:t.getAltKey(),ctrlKey:t.getCtrlKey(),shiftKey:t.getShiftKey(),metaKey:t.getMetaKey()};return n||(i=Object.extend(i,{key:Kekule.Widget.KeyboardUtils._standardizeEventKeyValue(t.getKey()),code:t.getCode(),repeat:t.getRepeat()})),i},createModifierKeyParamsFromArray:function(t){for(var n={},i=0,r=t.length;i<r;++i){var a=t[i].toLowerCase();a.indexOf("shift")>=0?n.shiftKey=!0:a.indexOf("ctrl")>=0?n.ctrlKey=!0:a.indexOf("meta")>=0?n.metaKey=!0:a.indexOf("alt")>=0&&(n.altKey=!0)}return n},matchKeyParams:function(t,n,i){var r,a,o,l=function(u,c){return c===null||!c==!u};return l(t.altKey,n.altKey)&&l(t.ctrlKey,n.ctrlKey)&&l(t.shiftKey,n.shiftKey)&&l(t.metaKey,n.metaKey)&&(!n.key||(r=t.key,a=n.key,o=Kekule.Widget.KeyboardUtils._standardizeEventKeyValue,i?o(a)===o(r):o(a)===o(r)||o(r)===Kekule.Widget.KeyboardUtils.getShiftedKey(a)))&&(!n.code||n.code===t.code)&&l(t.repeat,n.repeat)}},Kekule.Widget.KeyboardUtils._shiftKeyMap=Kekule.Widget.KeyboardUtils._initShiftKeyMap(),Kekule.Widget.HtmlKeyEventMatcher=Class.create(Kekule.Widget.HtmlEventMatcher,{CLASS_NAME:"Kekule.Widget.HtmlKeyEventMatcher",initialize:function(t){var n=Object.extend({strictMatch:!0},t);this.tryApplySuper("initialize",[n])},initProperties:function(){for(var t=Kekule.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS,n=0,i=t.length;n<i;++n){var r=t[n]==="key"||t[n]==="code"?DataType.STRING:DataType.BOOL;this._defineEventParamProp(t[n],r)}},match:function(t){var n=this.tryApplySuper("match",[t]);return n&&(n=this._matchKeyEvent(t,this.getEventParams())),n},_isKeyIgnored:function(t){return t===null},_matchKeyEvent:function(t,n){var i=this._isKeyIgnored;return(i(n.altKey)||!!t.getAltKey()==!!n.altKey)&&(i(n.ctrlKey)||!!t.getCtrlKey()==!!n.ctrlKey)&&(i(n.shiftKey)||!!t.getShiftKey()==!!n.shiftKey)&&(i(n.metaKey)||!!t.getMetaKey()==!!n.metaKey)&&(!n.key||this._matchKey(t,n.key))&&(!n.code||t.getCode()===n.code)&&(e.isUnset(n.repeat)||!!t.getRepeat()==!!n.repeat)},_matchKey:function(t,n){var i=Kekule.Widget.KeyboardUtils._standardizeEventKeyValue,r=t.getKey();return this.getStrictMatch()?i(r)===i(n):i(r)===i(n)||r===Kekule.Widget.KeyboardUtils.getShiftedKey(n)}}),Kekule.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS=["key","code","shiftKey","ctrlKey","altKey","metaKey","repeat","strictMatch"],Kekule.Widget.Shortcut=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Shortcut",initialize:function(t,n){var i=new Kekule.Widget.HtmlEventResponser(new Kekule.Widget.HtmlKeyEventMatcher({eventType:this._getKeyEventType(),strictMatch:!1}),this);this.setPropStoreFieldValue("eventResponser",i),Kekule.ObjUtils.notUnset(n)?i.setExclusive(n):i.setExclusive(!0),t&&this.setPropStoreFieldValue("execTarget",t),this.tryApplySuper("initialize",[]),this._registeredDocs=[]},initProperties:function(){this.defineProp("strictMatch",{dataType:DataType.BOOL,getter:function(){return this.getEventResponser().getEventMatcher().getStrictMatch()},setter:function(t){this.getEventResponser().getEventMatcher().setStrictMatch(t)}}),this.defineProp("exclusive",{dataType:DataType.BOOL,getter:function(){return this.getEventResponser().getEventMatcher().getExclusive()},setter:function(t){this.getEventResponser().getEventMatcher().setExclusive(t)}}),this.defineProp("key",{dataType:DataType.STRING,getter:function(){var t=this.getEventResponser().getEventParams();return Kekule.Widget.KeyboardUtils.keyParamsToShortcutLabel(t,null,this.getStrictMatch())},setter:function(t){if(t!==this.getKey())for(var n=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(t,null,this.getStrictMatch()),i=this.getEventResponser().getEventParams(),r=Kekule.Widget.HtmlKeyEventMatcher.KEY_PARAM_PROPS,a=Kekule.ObjUtils.notUnset,o=0,l=r.length;o<l;++o){var u=r[o];a(n[u])&&(i[u]=n[u])}}}),this.defineProp("execTarget",{dataType:DataType.VARIANT,serializable:!1,setter:null}),this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",setter:null,serializable:!1,getter:function(){var t=this.getExecTarget();return t&&t instanceof Kekule.Widget.BaseWidget?t:null}}),this._defineEventResponserRelatedProp("eventParams",DataType.HASH),this.defineProp("eventResponser",{dataType:"Kekule.Widget.HtmlEventResponser",serializable:!1,setter:null})},doFinalize:function(){this.unregisterFromAll();var t=this.getEventResponser();this.setPropStoreFieldValue("eventResponser",null),t.finalize(),this.tryApplySuper("doFinalize")},_defineEventResponserRelatedProp:function(t,n,i){var r=t||i;return this.defineProp(t,{dataType:n,serializable:!1,getter:function(){return this.getEventResponser().getPropValue(r)},setter:function(a){this.getEventResponser().setPropValue(r,a)}})},_getKeyEventType:function(){return"keydown"},execute:function(t){if(Kekule.globalOptions.widget.shortcut.enabled){var n=this.getExecTarget();return n&&this.doExecTarget(t,n),this.invokeEvent({htmlEvent:t,execTarget:n}),!0}return!1},doExecTarget:function(t,n){var i=!0;return DataType.isFunctionValue(n)?n.apply(null,[t,this]):n.execute&&DataType.isFunctionValue(n.execute)?DataType.isObjectExValue(n)?n instanceof Kekule.Widget.BaseWidget?n.execute(t):n instanceof Kekule.Action?n.execute(this,t):n.execute(t,this):n.execute(t,this):i=!1,i},registerToGlobal:function(t){var n=t||Kekule.$document;n&&this._registeredDocs.indexOf(n)<0&&(Kekule.Widget.Utils.getGlobalManager(n).registerHtmlEventResponser(this.getEventResponser()),Kekule.ArrayUtils.pushUnique(this._registeredDocs,n))},unregisterFromGlobal:function(t){var n=t||Kekule.$document;n&&this._registeredDocs.indexOf(n)>=0&&(Kekule.Widget.Utils.getGlobalManager(n).unregisterHtmlEventResponser(this.getEventResponser()),Kekule.ArrayUtils.remove(this._registeredDocs,n))},unregisterFromAll:function(){for(var t=this._registeredDocs,n=0,i=t.length;n<i;++n)this.unregisterFromGlobal(t[n])}})}(),function(){Kekule.Widget.Clipboard=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Clipboard",STORAGE_KEY:"__$kekule_widget_clipboard__",initialize:function(){if(this.tryApplySuper("initialize"),this._data=new Kekule.MapEx(!0),Kekule.BrowserFeature.localStorage){this._crossPageStorage=window.localStorage,this.setEnableCrossPageClipboard(!0);var e=this;Kekule.X.Event.addListener(window,"storage",function(t){if(e.getEnableCrossPageClipboard()){var n=t.key,i=e._extractSessionDataType(n);i&&e.invokeEvent("setData",{dataType:i,data:e.deserializeData(t.newValue)})}})}},finalize:function(){this._data.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("enableCrossPageClipboard",{dataType:DataType.BOOL})},_useSessionClipboard:function(){return this.getEnableCrossPageClipboard()&&Kekule.BrowserFeature.localStorage},_extractSessionDataType:function(e){return e.startsWith(this.STORAGE_KEY)?e.substr(this.STORAGE_KEY.length):null},serializeData:function(e){var t;if(DataType.isSimpleValue(e))t=JSON.stringify(e);else{var n={};Class.ObjSerializerFactory.getSerializer("json").save(e,n),t=JSON.stringify(n)}return t},deserializeData:function(e){var t=JSON.parse(e);return DataType.isSimpleValue(t)?t:Class.ObjSerializerFactory.getSerializer("json").load(null,t)},setData:function(e,t){if(this._useSessionClipboard()){var n,i=this.serializeData(t);try{this._crossPageStorage.setItem(this.STORAGE_KEY+e,i),n=!0}catch(r){Kekule.warn(r)}n||this._data.set(e,t)}else this._data.set(e,t);return this.invokeEvent("setData",{dataType:e,data:t}),this},getData:function(e){if(this._useSessionClipboard()){var t,n;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),n=!0}catch(i){Kekule.warn(i)}if(n)return t?this.deserializeData(t):null}return this._data.get(e)},hasData:function(e){if(this._useSessionClipboard()){var t,n;try{t=this._crossPageStorage.getItem(this.STORAGE_KEY+e),n=!0}catch(i){Kekule.warn(i)}if(n)return Kekule.ObjUtils.notUnset(t)}return Kekule.ObjUtils.notUnset(this._data.get(e))},clearData:function(){if(this._useSessionClipboard())for(var e=this.getTypes(),t=0,n=e.length;t<n;++t)this._crossPageStorage.removeItem(this.STORAGE_KEY+e[t]);else this._data.clear();return this.invokeEvent("setData",{dataType:null,data:null}),this},getTypes:function(){if(this._useSessionClipboard()){for(var e=[],t=0,n=this._crossPageStorage.length;t<n;++t){var i=this._crossPageStorage.key(t),r=this._extractSessionDataType(i);r&&e.push(r)}return e}return this._data.getKeys()},setObjects:function(e,t){for(var n=[],i=Class.ObjSerializerFactory.getSerializer("json"),r=0,a=t.length;r<a;++r){var o=t[r],l={};i.save(o,l),n.push(l)}var u=JSON.stringify(n);return this.setData(e,u)},getObjects:function(e){var t=this.getData(e);if(DataType.isSimpleValue(t)){var n=JSON.parse(t);DataType.isArrayValue(n)||(n=[n]);for(var i=[],r=Class.ObjSerializerFactory.getSerializer("json"),a=0,o=n.length;a<o;++a){var l=n[a],u=r.load(null,l);i.push(u)}return i}return t}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.Clipboard),Kekule.Widget.clipboard=Kekule.Widget.Clipboard.getInstance()}(),function(){Kekule.Widget.EvokeMode={ALWAYS:0,EVOKEE_CLICK:1,EVOKEE_MOUSE_ENTER:2,EVOKEE_MOUSE_LEAVE:3,EVOKEE_MOUSE_DOWN:4,EVOKEE_MOUSE_UP:5,EVOKEE_MOUSE_MOVE:6,EVOKEE_TOUCH:7,EVOKER_CLICK:11,EVOKER_MOUSE_ENTER:12,EVOKER_MOUSE_LEAVE:13,EVOKER_MOUSE_DOWN:14,EVOKER_MOUSE_UP:15,EVOKER_MOUSE_MOVE:16,EVOKER_TOUCH:17,EVOKEE_TIMEOUT:21,EVOKER_TIMEOUT:22};var e=Kekule.Widget.EvokeMode;Kekule.Widget.DynamicEvokeHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DynamicEvokeHelper",evokeEvents:["click","mouseenter","mouseleave","mousedown","mouseup","touchstart"],DEF_TIMEOUT:5e3,initialize:function(t,n,i,r,a){this.tryApplySuper("initialize"),this._timeoutRevokeHandle=null,this.reactEvokeEventsBind=this.reactEvokeEvents.bind(this),this.checkTimeoutRevokeBind=this.checkTimeoutRevoke.bind(this),this.setTimeout(a||this.DEF_TIMEOUT),this.setPropStoreFieldValue("evokeModes",i||[]),this.setPropStoreFieldValue("revokeModes",r||[]),this.linkWidgets(t,n)},finalize:function(){this.unlinkWidgets(this.getEvokee(),this.getEvoker()),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("evokee",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evoker",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("evokeModes",{dataType:DataType.ARRAY}),this.defineProp("revokeModes",{dataType:DataType.ARRAY}),this.defineProp("timeout",{dataType:DataType.INT}),this.defineProp("showHideType",{dataType:DataType.INT})},evoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().show(this.getEvokee(),null,this.getShowHideType()),this.postponeTimeoutCheck())},revoke:function(){this.getEvoker()&&(clearTimeout(this._timeoutRevokeHandle),this.getEvoker().getDocument().body.focus(),this.getEvoker().hide(this.getEvokee(),null,this.getShowHideType()))},doObjectChange:function(t){this.tryApplySuper("doObjectChange",[t]),Kekule.ArrayUtils.intersect(t,["evokeModes","revokeModes"]).length>0&&this.evokeModesChanged()},linkWidgets:function(t,n){this.setPropStoreFieldValue("evokee",t),this.setPropStoreFieldValue("evoker",n),this.installEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind),this.installEventHandlers(n,this.evokeEvents,this.reactEvokeEventsBind),this.updateOnAlwaysMode()},unlinkWidgets:function(t,n){this.uninstallEventHandlers(t,this.evokeEvents,this.reactEvokeEventsBind),this.uninstallEventHandlers(n,this.evokeEvents,this.reactEvokeEventsBind)},installEventHandlers:function(t,n,i){for(var r=0,a=n.length;r<a;++r)t.addEventListener(n[r],i)},uninstallEventHandlers:function(t,n,i){for(var r=0,a=n.length;r<a;++r)t.removeEventListener(n[r],i)},evokeModesChanged:function(){this.updateOnAlwaysMode()},updateOnAlwaysMode:function(){this.getEvokeModes().indexOf(e.ALWAYS)>=0?this.evoke():this.getRevokeModes().indexOf(e.ALWAYS)>=0&&this.revoke()},checkTimeoutRevoke:function(t){if(this.getEvoker()){var n=Kekule.DomUtils,i=this.getEvoker().getDocument().activeElement,r=this.getRevokeModes(),a=[];r.indexOf(e.EVOKEE_TIMEOUT)>=0&&a.push(this.getEvokee().getElement()),r.indexOf(e.EVOKER_TIMEOUT)>=0&&a.push(this.getEvoker().getElement());for(var o=!1,l=0,u=a.length;l<u;++l){var c=a[l];if(i===c||n.isDescendantOf(i,c)){o=!0;break}}o?this.postponeTimeoutCheck():this.revoke()}},postponeTimeoutCheck:function(){if(this.hasTimeoutMode(this.getRevokeModes())){if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;this._timeoutRevokeHandle=setTimeout(this.checkTimeoutRevokeBind,this.getTimeout())}},hasTimeoutMode:function(t){return Kekule.ArrayUtils.intersect([e.EVOKEE_TIMEOUT,e.EVOKER_TIMEOUT],t).length>0},getEventTypeOfMode:function(t){switch(t){case e.EVOKEE_CLICK:case e.EVOKER_CLICK:return"click";case e.EVOKEE_MOUSE_ENTER:case e.EVOKER_MOUSE_ENTER:return"mouseenter";case e.EVOKEE_MOUSE_LEAVE:case e.EVOKER_MOUSE_LEAVE:return"mouseleave";case e.EVOKEE_MOUSE_DOWN:case e.EVOKER_MOUSE_DOWN:return"mousedown";case e.EVOKEE_MOUSE_UP:case e.EVOKER_MOUSE_UP:return"mouseup";case e.EVOKEE_MOUSE_MOVE:case e.EVOKER_MOUSE_MOVE:return"mousemove";case e.EVOKEE_TOUCH:case e.EVOKER_TOUCH:return"touchstart"}},isEvokeTargetOnEvokee:function(t){return t>=e.EVOKEE_CLICK&&t<=e.EVOKEE_TOUCH},reactEvokeEvents:function(t){var n=t.htmlEvent.getType(),i=t.target;if(i===this.getEvokee()||i===this.getEvoker()){var r=t.target===this.getEvokee();if(this.getEvoker().isShown()){if(this.getEvokeModes().indexOf(e.ALWAYS)>=0)return;var l;for(a=0,o=(l=this.getRevokeModes()).length;a<o;++a)if(r===this.isEvokeTargetOnEvokee(l[a])&&n===this.getEventTypeOfMode(l[a]))return void this.revoke()}else{if(this.getRevokeModes().indexOf(e.ALWAYS)>=0)return;for(var a=0,o=(l=this.getEvokeModes()).length;a<o;++a)if(r===this.isEvokeTargetOnEvokee(l[a])&&n===this.getEventTypeOfMode(l[a]))return void this.evoke()}}}})}(),function(){var e=Kekule.HtmlElementUtils;Kekule.Widget.StyleResource=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.StyleResource",initialize:function(r,a){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("name",r),a&&this.setCssClassName(a)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,setter:null}),this.defineProp("cssClassName",{dataType:DataType.STRING})},linkTo:function(r){return e.addClass(this._getElement(r),this.getCssClassName()),this},unlinkFrom:function(r){e.removeClass(this._getElement(r),this.getCssClassName())},_getElement:function(r){return r instanceof Kekule.Widget.BaseWidget?r.getElement():r}}),Kekule.Widget.StyleResourceManager={_resources:{},register:function(r){var a=r.getName();return a&&(t._resources[a]=r),t},unregister:function(r){var a;return typeof r=="string"?a=r:r.getName&&(a=r.getName()),a&&delete t._resources[a],t},getResource:function(r){return t._resources[r]}},Kekule.Widget.StyleResourceNames={PREFIX:"$$",CURSOR_ROTATE:"$$cursor_rotate",CURSOR_ROTATE_NE:"$$cursor_rotate_ne",CURSOR_ROTATE_NW:"$$cursor_rotate_nw",CURSOR_ROTATE_SE:"$$cursor_rotate_se",CURSOR_ROTATE_SW:"$$cursor_rotate_sw",ICON_COLOR_PICK:"$$icon_color_pick",ICON_COLOR_NOTSET:"$$icon_color_default",ICON_COLOR_MIXED:"$$icon_color_mixed",BUTTON_YES_OK:"$$btn_yes_ok",BUTTON_NO_CANCEL:"$$btn_no_cancel",BUTTON_RESET:"$$btn_reset",BUTTON_LOAD_FILE:"$$btn_load_file",ICON_REMOVE:"$$icon_remove"};var t=Kekule.Widget.StyleResourceManager,n=Kekule.Widget.StyleResource,i=Kekule.Widget.StyleResourceNames;t.register(new n(i.CURSOR_ROTATE,"K-Res-Cursor-Rotate")),t.register(new n(i.CURSOR_ROTATE_NE,"K-Res-Cursor-Rotate-NE")),t.register(new n(i.CURSOR_ROTATE_NW,"K-Res-Cursor-Rotate-NW")),t.register(new n(i.CURSOR_ROTATE_SE,"K-Res-Cursor-Rotate-SE")),t.register(new n(i.CURSOR_ROTATE_SW,"K-Res-Cursor-Rotate-SW")),t.register(new n(i.ICON_COLOR_PICK,"K-Res-Icon-Color-Pick")),t.register(new n(i.ICON_COLOR_NOTSET,"K-Res-Icon-Color-NotSet")),t.register(new n(i.ICON_COLOR_MIXED,"K-Res-Icon-Color-Mixed")),t.register(new n(i.BUTTON_YES_OK,"K-Res-Button-YesOk")),t.register(new n(i.BUTTON_NO_CANCEL,"K-Res-Button-NoCancel")),t.register(new n(i.BUTTON_RESET,"K-Res-Button-Reset")),t.register(new n(i.BUTTON_LOAD_FILE,"K-Res-Button-LoadFile")),t.register(new n(i.ICON_REMOVE,"K-Res-Icon-Remove"))}(),function(){var e=Kekule.DomUtils;Kekule.ArrayUtils,Kekule.Widget.AutoLauncher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.AutoLauncher",WIDGET_ATTRIB:"data-widget",WIDGET_ATTRIB_ALT:"data-kekule-widget",PLACEHOLDER_ATTRIB:"data-placeholder",FIELD_PARENT_WIDGET_ELEM:"__$kekule_parent_widget_elem$__",initialize:function(){this.tryApplySuper("initialize"),this._executingFlag=0,this._pendingWidgetRefMap=new Kekule.MapEx(!0),this._pendingElems=[],this._handlingPendings=!1,this._execOnPendingBind=this._execOnPending.bind(this);var i=this;Kekule.Widget.Utils._setWidgetRefPropFromId=function(r,a,o){if(o){var l=Kekule.Widget.getWidgetById(o,r.getDocument());if(l)r.setPropValue(a,l);else{var u=r.getDocument().getElementById(o);u&&i.isExecuting()&&i.addPendingWidgetRefItem(u,r,a)}}}},finalize:function(){this._pendingElems=null,this._pendingWidgetRefMap=null,this.tryApplySuper("finalize")},getPendingElems:function(){return this._pendingElems},addPendingElem:function(i,r,a,o,l){this._pendingElems.push({doc:i,elem:r,parent:a,widgetClass:o,execOnChildren:l})},handlePendingElems:function(i){this._handlingPendings||(this._handlingPendings=!0,i&&this._pendingElems.push({callback:i}),this.beginExec(),setTimeout(this._execOnPendingBind,0))},_execOnPending:function(){var i=this._pendingElems.shift();if(i)try{i.elem?this.createWidgetOnElem(i.doc,i.elem,i.parent):i.callback&&setTimeout(i.callback,0)}finally{setTimeout(this._execOnPendingBind,0)}else this._handlingPendings=!1,this.endExec()},getPendingWidgetRefMap:function(){return this._pendingWidgetRefMap},addPendingWidgetRefItem:function(i,r,a){this._pendingWidgetRefMap.set(i,{widget:r,propName:a})},removePendingWidgetRefItem:function(i){this._pendingWidgetRefMap.remove(i)},handlePendingWidgetRef:function(){for(var i=this._pendingWidgetRefMap.getKeys(),r=0,a=i.length;r<a;++r){var o=i[r],l=Kekule.Widget.getWidgetOnElem(o);if(l){var u=this._pendingWidgetRefMap.get(o);u.widget.setPropValue(u.propName,l)}this.removePendingWidgetRefItem(o)}},beginExec:function(){++this._executingFlag},endExec:function(){this._executingFlag>0&&--this._executingFlag,this._executingFlag<=0&&this.handlePendingWidgetRef()},isExecuting:function(){return this._executingFlag>0},execute:function(i,r,a){var o=Kekule.ObjUtils.notUnset(r)?r:Kekule.Widget.AutoLauncher.deferring;o||this.beginExec();try{typeof i.querySelector=="function"?this.executeOnElemBySelector(i.ownerDocument,i,null,o):this.executeOnElem(i.ownerDocument,i,null,o),o&&this.handlePendingElems(a)}finally{o||(this.endExec(),a&&a())}},executeOnElem:function(i,r,a,o){if(this.isElemLaunchable(r)){var l=null,u=this.getElemWidgetClass(r),c=a;if(o)u&&(this.addPendingElem(i,r,a,u,!1),c=r);else{var d=a;!d||d instanceof Kekule.Widget.BaseWidget||(d=Kekule.Widget.getWidgetOnElem(a)),c=(l=this.createWidgetOnElem(i,r,d,u))||r}if(o&&!u||!o&&!l||Kekule.Widget.AutoLauncher.enableCascadeLaunch)for(var h=e.getDirectChildElems(r),p=0,g=h.length;p<g;++p){var f=h[p];this.executeOnElem(i,f,c,o)}}},executeOnElemBySelector:function(i,r,a,o){var l="["+this.WIDGET_ATTRIB+"],["+this.WIDGET_ATTRIB_ALT+"]",u=r.querySelectorAll(l);if(this.getElemWidgetClass(r)&&(u=Array.prototype.slice.call(u)).unshift(r),u&&u.length){for(var c=0,d=u.length;c<d;++c){var h=u[c],p=this._findParentCandidateElem(h,u,0,c-1);p&&(h[this.FIELD_PARENT_WIDGET_ELEM]=p)}for(c=0,d=u.length;c<d;++c)if(h=u[c],this.isElemLaunchable(h)){var g=h[this.FIELD_PARENT_WIDGET_ELEM]||null;!Kekule.Widget.AutoLauncher.enableCascadeLaunch&&g||(o?this.addPendingElem(i,h,g,null,!1):this.createWidgetOnElem(i,h,g))}}},_findParentCandidateElem:function(i,r,a,o){for(var l=null,u=i.parentNode;u&&!l;){for(var c=o;c>=a;--c)if(u===r[c])return l=r[c];l||(u=u.parentNode)}return l},createWidgetOnElem:function(i,r,a,o){var l=null,u=Kekule.Widget.getWidgetOnElem(r);if(u)return u;if(o||(o=this.getElemWidgetClass(r)),o){var c=Kekule.Widget.AutoLauncher,d=!1;if(c.placeHolderStrategy!==c.PlaceHolderStrategies.DISABLED){var h=r.getAttribute(this.PLACEHOLDER_ATTRIB)||"";d=(d=c.placeHolderStrategy===c.PlaceHolderStrategies.EXPLICIT&&Kekule.StrUtils.strToBool(h)||c.placeHolderStrategy===c.PlaceHolderStrategies.IMPLICIT)&&ClassEx.getPrototype(o).canUsePlaceHolderOnElem(r)}if(l=d?new Kekule.Widget.PlaceHolder(r,o):new o(r)){var p=a;!p||p instanceof Kekule.Widget.BaseWidget||(p=Kekule.Widget.getWidgetOnElem(a)),p&&l.setParent(p)}}return l},isElemLaunchable:function(i){return!(i.isContentEditable&&!Kekule.HtmlElementUtils.isFormCtrlElement(i)&&!Kekule.Widget.AutoLauncher.enableOnEditable)},getElemWidgetClass:function(i){var r=null,a=i.getAttribute(this.WIDGET_ATTRIB);return a||(a=i.getAttribute(this.WIDGET_ATTRIB_ALT)),a&&(r=this.getWidgetClass(a)),r},getWidgetClass:function(i){return ClassEx.findClass(i)}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.AutoLauncher),Kekule.Widget.autoLauncher=Kekule.Widget.AutoLauncher.getInstance(),Kekule.Widget.AutoLauncher.PlaceHolderStrategies={DISABLED:"disabled",IMPLICIT:"implicit",EXPLICIT:"explicit"},Kekule.Widget.AutoLauncher.enabled=Kekule.oneOf(Kekule.environment.getEnvVar("kekule.widget.autoLauncher.enabled"),!0),Kekule.Widget.AutoLauncher.enableCascadeLaunch=!0,Kekule.Widget.AutoLauncher.enableDynamicDomCheck=!0,Kekule.Widget.AutoLauncher.enableOnEditable=!1,Kekule.Widget.AutoLauncher.placeHolderStrategy=Kekule.Widget.AutoLauncher.PlaceHolderStrategies.EXPLICIT,Kekule.Widget.AutoLauncher.deferring=!1,Kekule.Widget.WidgetsReady={isReady:!1,funcs:[],ready:function(i){t.isReady?i():t.funcs.push(i)},fireReady:function(){if(!t.isReady){t.isReady=!0;for(var i=t.funcs;i.length;)i.shift()()}}};var t=Kekule.Widget.WidgetsReady;Kekule.Widget.ready=t.ready;var n=function(){if(!n.done)if(Kekule._isLoaded()){var i=Kekule.Widget.AutoLauncher.deferring?function(){Kekule.X.DomReady.resume()}:null,r=function(){try{t.fireReady()}finally{i&&i()}};Kekule.Widget.AutoLauncher.enabled?(Kekule.Widget.AutoLauncher.deferring&&Kekule.X.DomReady.suspend(),Kekule.Widget.autoLauncher.execute(document.body,null,r)):r(),Kekule.X.MutationObserver?new Kekule.X.MutationObserver(function(a){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled)for(var o=0,l=a.length;o<l;++o){var u=a[o];if(u.type==="childList")for(var c=u.addedNodes,d=0,h=c.length;d<h;++d){var p=c[d];p.nodeType===Node.ELEMENT_NODE&&Kekule.Widget.autoLauncher.execute(p)}}}).observe(document.body,{childList:!0,subtree:!0}):Kekule.X.Event.addListener(document,"DOMNodeInserted",function(a){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck&&Kekule.Widget.AutoLauncher.enabled){var o=a.getTarget();o.nodeType===(Node.ELEMENT_NODE||1)&&Kekule.Widget.autoLauncher.execute(o)}}),n.done=!0}else Kekule._ready(n)};Kekule.X.domReady(n)}(),function(){var e=Kekule.Widget.Direction,t=Kekule.StyleUtils,n=Kekule.ArrayUtils;Kekule.Widget.BaseTransition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseTransition",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("element",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("caller",{dataType:DataType.OBJECT,serializable:!1})},canExecute:function(i,r){return!0},prepare:function(i,r,a){},finish:function(i,r,a){},execute:function(i,r,a,o){this.setElement(i),r&&this.setCaller(r);var l=Object.extend({from:0,to:1},o),u=this,c=function(){c.__$applied__||(c.__$applied__=!0,u.finish(i,r,l),a&&a(),u.invokeEvent("finish"))};c.__$applied__=!1,this.prepare(i,r,l),this.invokeEvent("execute"),u=this;var d={element:i,caller:r,callback:a,doneCallback:c,options:o,executor:this,halt:function(){u.halt(d)}};return this.doExecute(i,r,c,l),d},doExecute:function(i,r,a,o){},halt:function(i){i.executor!==this?i.executor.halt(i):(this.doHalt(i),i.doneCallback&&i.doneCallback(),this.invokeEvent("halt"))},doHalt:function(i){},setElementProp:function(i,r,a){},storeCssInlineValues:function(i,r){for(var a=i.style,o={},l=0,u=r.length;l<u;++l){var c=r[l];o[c]=a[c]}return o},restoreCssInlineValues:function(i,r,a){for(var o=i.style,l=0,u=r.length;l<u;++l){var c=r[l];if(a[c])o[c]=a[c];else try{o.removeProperty(c)}catch{o[c]=""}}},storeCssComputedValues:function(i,r){for(var a={},o=0,l=r.length;o<l;++o){var u=r[o],c=t.getComputedStyle(i,u);a[u]=c}return a}}),Kekule.Widget.Css3TransitionRunner=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Css3TransitionRunner",initProperties:function(){this.defineProp("parent",{dataType:"Kekule.Widget.BaseTransition"})},getCaller:function(){var i=this.getParent();return i&&i.getCaller()},getElement:function(){var i=this.getParent();return i&&i.getElement()},getAffectedCssPropNames:function(i){return[]},getTransCssPropNames:function(i){return[]},prepare:function(i,r,a){},setElementProp:function(i,r,a){}}),Kekule.Widget.Css3OpacityTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3OpacityTransRunner",getAffectedCssPropNames:function(i){return["opacity"]},getTransCssPropNames:function(i){return["opacity"]},prepare:function(i,r,a){},setElementProp:function(i,r,a){var o=this.getParent();if(o){var l=parseFloat(o.getComputedCssValues().opacity)||1;i.style.opacity=l*r}}}),Kekule.Widget.Css3SlideTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3SlideTransRunner",initialize:function(i){this.tryApplySuper("initialize"),Kekule.ObjUtils.notUnset(i)&&this.setDirection(i)},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},prepare:function(i,r,a){t.setDisplay(i,!0),this._direction=this.getActualDirection(i,a),this.tryApplySuper("prepare",[i,r,a]),i.style.overflow="hidden",this._clearDimesionConstraints(i)},_clearDimesionConstraints:function(i){var r=i.style;r.minWidth="0",r.minHeight="0",r.maxWidth="none",r.maxHeight="none"},getComputedCssValues:function(){return this.getParent().getComputedCssValues()},setElementProp:function(i,r,a){var o,l=this._direction;if(e.isInHorizontal(l)){o=this.getComputedCssValues().width;var u=t.analysisUnitsValue(o);if(i.style.width=u.value*r+u.units,o=this.getComputedCssValues().left){var c=t.analysisUnitsValue(o);c.units===u.units&&(i.style.left=u.value*(1-r)+c.value+c.units)}}if(e.isInVertical(l)){o=this.getComputedCssValues().height;var d=t.analysisUnitsValue(o);if(i.style.height=d.value*r+d.units,o=this.getComputedCssValues().top){var h=t.analysisUnitsValue(o);h.units===d.units&&(i.style.top=d.value*(1-r)+h.value+h.units)}}},getAffectedCssPropNames:function(i){var r=[].concat(this.getTransCssPropNames(i));return r=r.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(i){var r=this.getActualDirection(this.getElement(),i),a=[];return e.isInHorizontal(r)&&(a.push("width"),r&e.RTL&&a.push("left")),e.isInVertical(r)&&(a.push("height"),r&e.BTT&&a.push("top")),a},getRefRect:function(i){return Kekule.Widget.TransitionUtils.getCallerRefRect(this.getCaller(),i)},getActualDirection:function(i,r){i||(i=this.getElement());var a=this.getDirection();return a&&a!==e.AUTO||(a=Kekule.Widget.TransitionUtils.getPreferredSlideDirection(i,this.getCaller(),r)),a}}),Kekule.Widget.Css3ClipPathSlideTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3ClipPathSlideTransRunner",initialize:function(i){this.tryApplySuper("initialize"),Kekule.ObjUtils.notUnset(i)&&this.setDirection(i)},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},prepare:function(i,r,a){this._direction=this.getActualDirection(i,a),this.tryApplySuper("prepare",[i,r,a])},setElementProp:function(i,r,a){var o=this._direction,l=100*(1-r)+"%",u=["0%","0%","0%","0%"];u[o===e.TTB?2:o===e.BTT?0:o===e.RTL?3:1]=l;var c="inset("+u.join(" ")+")";i.style.clipPath=c},getAffectedCssPropNames:function(i){return(this.tryApplySuper("getAffectedCssPropNames",[i])||[]).concat(["clip-path"])},getTransCssPropNames:function(i){return(this.tryApplySuper("getTransCssPropNames",[i])||[]).concat(["clip-path"])},getActualDirection:function(i,r){i||(i=this.getElement());var a=this.getDirection();return a&&a!==e.AUTO||(a=Kekule.Widget.TransitionUtils.getPreferredSlideDirection(i,this.getCaller(),r)),a}}),Kekule.Widget.Css3GrowTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3GrowTransRunner",initialize:function(i){this.tryApplySuper("initialize"),i&&(i.ownerDocument?this.setBaseElement(i):this.setCaller(i))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(i){var r=Kekule.HtmlElementUtils,a=null;return this.getBaseRect()?a=this.getBaseRect():this.getCaller()&&(a=r.getElemBoundingClientRect(this.getCaller(),!0),Kekule.RectUtils.isZero(a)&&(a=(i||{}).callerPageRect||null)),a||(a={x:0,y:0,width:0,height:0}),a},prepare:function(i,r,a){t.setDisplay(i,!0),this.tryApplySuper("prepare",[i,r,a]),i.style.overflow="hidden",Kekule.HtmlElementUtils.makePositioned(i);var o=this.getRefRect(a),l=Kekule.HtmlElementUtils.getElemBoundingClientRect(i,!0),u={x:l.x-o.x,y:l.y-o.y,width:l.width-o.width,height:l.height-o.height};this._delta=u,this._clearDimesionConstraints(i)},_clearDimesionConstraints:function(i){var r=i.style;r.minWidth="0",r.minHeight="0",r.maxWidth="none",r.maxHeight="none"},setElementProp:function(i,r,a){var o,l=this.getParent().getComputedCssValues(),u=this._delta,c=1-r,d=i.style;(o=t.analysisUnitsValue(l.left)).units==="px"&&(d.left=o.value-c*u.x+"px"),(o=t.analysisUnitsValue(l.top)).units==="px"&&(d.top=o.value-c*u.y+"px"),(o=t.analysisUnitsValue(l.width)).units==="px"&&(d.width=o.value-c*u.width+"px"),(o=t.analysisUnitsValue(l.height)).units==="px"&&(d.height=o.value-c*u.height+"px")},getAffectedCssPropNames:function(i){var r=[].concat(this.getTransCssPropNames(i));return r=r.concat(["overflow","min-width","min-height","max-width","max-height"])},getTransCssPropNames:function(i){return["left","top","width","height","position"]}}),Kekule.BrowserFeature&&Kekule.BrowserFeature.cssTranform&&(Kekule.Widget.Css3TransformTransRunner=Class.create(Kekule.Widget.Css3TransitionRunner,{CLASS_NAME:"Kekule.Widget.Css3TransformTransRunner",getAffectedCssPropNames:function(i){return["transform","transformOrigin"]},getTransCssPropNames:function(i){return["transform","transformOrigin"]},prepare:function(i,r,a){this.tryApplySuper("prepare",[i,r,a]);var o=Kekule.StyleUtils.getTransformMatrixValues(i);o&&(o.scaleX=o.a,o.scaleY=o.d),this._computedTransMatrixInfo=o},setElemTransform:function(i,r,a,o,l){var u=[o,0,0,l,r,a];Kekule.StyleUtils.setTransformMatrixArrayValues(i,u)}}),Kekule.Widget.Css3TransformGrowTransRunner=Class.create(Kekule.Widget.Css3TransformTransRunner,{CLASS_NAME:"Kekule.Widget.Css3TransformGrowTransRunner",initialize:function(i){this.tryApplySuper("initialize"),i&&(i.ownerDocument?this.setBaseElement(i):this.setCaller(i))},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(i){var r=Kekule.HtmlElementUtils,a=null;return this.getBaseRect()?a=this.getBaseRect():this.getCaller()&&(a=r.getElemBoundingClientRect(this.getCaller(),!0),Kekule.RectUtils.isZero(a)&&(a=(i||{}).callerPageRect||null)),a||(a={x:0,y:0,width:0,height:0}),a},prepare:function(i,r,a){t.setDisplay(i,!0),this.tryApplySuper("prepare",[i,r,a]),i.style.overflow="hidden",Kekule.HtmlElementUtils.makePositioned(i);var o=this.getRefRect(a),l=Kekule.HtmlElementUtils.getElemBoundingClientRect(i,!0),u={x:l.x-o.x,y:l.y-o.y};this._translateDelta=u,this._initialScale={x:o.width/l.width,y:o.height/l.height},this._computedTransMatrixInfo?(this._endScale={x:this._computedTransMatrixInfo.scaleX,y:this._computedTransMatrixInfo.scaleY},this._endTranslate={x:this._computedTransMatrixInfo.tx,y:this._computedTransMatrixInfo.ty}):(this._endScale={x:1,y:1},this._endTranslate={x:0,y:0})},setElementProp:function(i,r,a){this.getParent().getComputedCssValues();var o=this._translateDelta,l=this._initialScale,u=this._endScale,c={x:this._endTranslate.x-(1-r)*o.x,y:this._endTranslate.y-(1-r)*o.y},d={x:r*u.x+(1-r)*l.x,y:r*u.y+(1-r)*l.y};i.style.transformOrigin="0 0 0",this.setElemTransform(i,c.x,c.y,d.x,d.y)}})),Kekule.Widget.Css3Transition=Class.create(Kekule.Widget.BaseTransition,{CLASS_NAME:"Kekule.Widget.Css3Transition",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("timingFunc",{dataType:DataType.STRING}),this.defineProp("childRunners",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("cssProperty",{dataType:DataType.STRING})},getRunners:function(){var i=this.getChildRunners();return i?n.toArray(i):[]},iterateRunners:function(i){for(var r=this.getRunners(),a=0,o=r.length;a<o;++a)i(r[a],a,r)},getAffectedCssPropNames:function(i){var r=[];return this.iterateRunners(function(a){var o=a.getAffectedCssPropNames()||[];r=r.concat(o)}),r},getTransCssPropNames:function(i){var r=[];return this.iterateRunners(function(a){var o=a.getTransCssPropNames()||[];r=r.concat(o)}),r},setElementProp:function(i,r,a){this.iterateRunners(function(o){o.setElementProp(i,r,a)})},canExecute:function(i,r){return!!Kekule.BrowserFeature.cssTransition},isSupported:function(){return!!Kekule.BrowserFeature.cssTransition},isAppear:function(i){return!!i.isAppear},isDisappear:function(i){return!!i.isDisappear},getTransitionPropValue:function(i,r){for(var a=[r,"Webkit"+r.capitalizeFirst(),"Moz"+r.capitalizeFirst()],o=null,l=0,u=a.length;l<u&&!(o=Kekule.StyleUtils.getComputedStyle(i,a[l]));++l);return o},setTransitionPropValue:function(i,r,a){for(var o=["Moz"+r.capitalizeFirst(),"Webkit"+r.capitalizeFirst(),r],l=0,u=o.length;l<u;++l)i[o[l]]=a},getOriginCssInlineValues:function(){return this._originCssInlineValues},getComputedCssValues:function(){return this._computedCssValues},prepare:function(i,r,a){this.tryApplySuper("prepare",[i,r,a]),this.setCssProperty(this.getTransCssPropNames(a).join(","));var o=this.getAffectedCssPropNames(a);this._affectedCssPropNames=o,this._originCssInlineValues=this.storeCssInlineValues(i,o),this._computedCssValues=this.storeCssComputedValues(i,o);var l=this;this.iterateRunners(function(u){u.setParent(l),u.prepare(i,r,a)})},finish:function(i,r,a){(a.to===1||this.isAppear(a)||this.isDisappear(a))&&this.restoreCssInlineValues(i,this._affectedCssPropNames,this._originCssInlineValues),this.tryApplySuper("finish",[i,r,a])},doExecute:function(i,r,a,o){var l=Kekule.StyleUtils,u=i.style;if(this.isAppear(o),this.isDisappear(o),this.isSupported()){this.setElementProp(i,o.from,o),l.isDisplayed(i)||l.setDisplay(i,!0),l.isVisible(i)||l.setVisibility(i,!0);var c,d=this.getCssProperty();this.setTransitionPropValue(u,"transitionProperty",d),(d=this.getTimingFunc()||o.timingFunc)&&this.setTransitionPropValue(u,"transitionTimingFunction",d),d=o.duration.toString()+"ms",this.setTransitionPropValue(u,"transitionDuration",d);var h=this,p=function(g){Kekule.X.Event.removeListener(i,"transitionend",p),h.setTransitionPropValue(u,"transition",""),c&&clearTimeout(c),a&&a()};this._currEventHandler=p,Kekule.X.Event.addListener(i,"transitionend",p),c=setTimeout(p,o.duration+100),setTimeout(function(){h.setElementProp(i,o.to,o)},0)}else{try{this.setElementProp(i,o.to,o)}catch{}a&&setTimeout(a,0)}},doHalt:function(i){var r=i.element;r&&this.setTransitionPropValue(r.style,"transitionProperty","none")}}),Kekule.Widget.Css3Transition.createConcreteClass=function(i,r){return Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:i,CHILD_RUNNER_CLASSES:n.toArray(r),initialize:function(){this.tryApplySuper("initialize");for(var a=[],o=0,l=this.CHILD_RUNNER_CLASSES.length;o<l;++o)a.push(new this.CHILD_RUNNER_CLASSES[o]);this.setChildRunners(a)}})},Kekule.Widget.Css3OpacityTrans=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3OpacityTrans",[Kekule.Widget.Css3OpacityTransRunner]),Kekule.Widget.Css3ClipPathSlideTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3ClipPathSlideTransition",[Kekule.Widget.Css3ClipPathSlideTransRunner]),Kekule.Widget.Css3SlideTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3SlideTransition",[Kekule.Widget.Css3SlideTransRunner]),Kekule.Widget.Css3GrowTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3GrowTransition",[Kekule.Widget.Css3GrowTransRunner]),Kekule.Widget.Css3ClipPathSlideOpacityTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3ClipPathSlideOpacityTransition",[Kekule.Widget.Css3ClipPathSlideTransRunner,Kekule.Widget.Css3OpacityTransRunner]),Kekule.Widget.Css3GrowOpacityTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3GrowOpacityTransition",[Kekule.Widget.Css3GrowTransRunner,Kekule.Widget.Css3OpacityTransRunner]),Kekule.Widget.Css3TransformGrowTransRunner&&(Kekule.Widget.Css3TransformGrowTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3TransformGrowTransition",[Kekule.Widget.Css3TransformGrowTransRunner]),Kekule.Widget.Css3TransformGrowOpacityTransition=Kekule.Widget.Css3Transition.createConcreteClass("Kekule.Widget.Css3TransformGrowOpacityTransition",[Kekule.Widget.Css3TransformGrowTransRunner,Kekule.Widget.Css3OpacityTransRunner])),Kekule.Widget.TransitionUtils={getCallerRefRect:function(i,r){var a,o=Kekule.HtmlElementUtils;return i?(a=o.getElemPageRect(i),Kekule.RectUtils.isZero(a)&&(a=(r||{}).callerPageRect||null)):a=null,a},getPreferredSlideDirection:function(i,r,a){var o=Kekule.Widget.Direction,l=Kekule.HtmlElementUtils,u=null,c=Kekule.Widget.TransitionUtils.getCallerRefRect(r,a);if(c){var d={x:c.x+c.width/2,y:c.y+c.height/2},h=l.getElemPagePos(i),p=l.getElemClientDimension(i),g={x:h.x+(p.width||0)/2,y:h.y+(p.height||0)/2},f=Kekule.CoordUtils.substract(g,d);c.width<1?u=f.x>=0?o.LTR:o.RTL:f.x<1?u=f.y>=0?o.TTB:o.BTT:u=Math.abs(c.height/c.width)>Math.abs(f.y/f.x)?f.x>=0?o.LTR:o.RTL:f.y>=0?o.TTB:o.BTT}else u=o.TTB;return u}}}(),function(){Kekule.StyleUtils,Kekule.Widget.ShowHideManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideManager",initialize:function(){this.tryApplySuper("initialize"),this.setEnableTransition(!0),this.setShowDuration(250),this.setHideDuration(250)},initProperties:function(){this.defineProp("enableTransition",{dataType:DataType.BOOL}),this.defineProp("transitionSelector",{dataType:"Kekule.Widget.ShowHideTransitionSelector",serializable:!1}),this.defineProp("showDuration",{dataType:DataType.INT}),this.defineProp("hideDuration",{dataType:DataType.INT})},_getCallerElement:function(n){return n?n.getElement?n.getElement():Kekule.DomUtils.isElement(n)?n:null:null},isUsingTransition:function(){return this.getEnableTransition()&&this.getTransitionSelector()},selectTransition:function(n,i,r){var a=this.getTransitionSelector();if(!a)return null;var o=a.selectTransition(n,i,r);return o&&i&&o.setCaller(this._getCallerElement(i)),o},show:function(n,i,r,a,o){var l=Object.extend(o||{},{from:0,to:1,isAppear:!0,duration:this.getShowDuration()}),u=n.getStandaloneOnShowHide()?null:i,c=this.selectTransition(n,u,a);if(c&&this.isUsingTransition()&&c.canExecute(n.getElement(),l)){var d=this._getCallerElement(u);return c.execute(n.getElement(),d,function(h){n.setVisible(!0,!0),n.setDisplayed(!0,!0),r&&r()},l)}return n.setVisible(!0,!0),n.setDisplayed(!0,!0),r&&r(),null},hide:function(n,i,r,a,o,l){var u=Object.extend(l,{from:1,to:0,isDisappear:!0,duration:this.getHideDuration()}),c=(o=!!l.useVisible,n.getStandaloneOnShowHide()?null:i),d=this.selectTransition(n,c,a);return d&&this.isUsingTransition()&&d.canExecute(n.getElement(),u)?d.execute(n.getElement(),this._getCallerElement(c),function(){n&&(o?n.setVisible(!1,!0):n.setDisplayed(!1,!0)),r&&r()},u):(o?n.setVisible(!1,!0):n.setDisplayed(!1,!0),r&&r(),null)}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.ShowHideManager),Kekule.Widget.showHideManager=Kekule.Widget.ShowHideManager.getInstance(),Kekule.Widget.ShowHideTransitionSelector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideTransitionSelector",initialize:function(){this.tryApplySuper("initialize"),this.setTransitionClassMap({})},initProperties:function(){this.defineProp("transitionClassMap",{dataType:DataType.OBJECT,serializable:!1})},_getTransClassOfType:function(n){var i=this.getTransitionClassMap();return i[n]||i[Kekule.Widget.ShowHideType.DEFAULT]},addTransitionClass:function(n,i){this.getTransitionClassMap()[n]=i},selectTransition:function(n,i,r){var a;return Kekule.Widget.ShowHideType,(a=i?this._getTransClassOfType(r):this._getTransClassOfType(Kekule.Widget.ShowHideType.DEFAULT))?new a:null}});var e=new Kekule.Widget.ShowHideTransitionSelector,t=Kekule.Widget.ShowHideType;e.addTransitionClass(t.DEFAULT,Kekule.Widget.Css3OpacityTrans),e.addTransitionClass(t.DROPDOWN,Kekule.Widget.Css3ClipPathSlideOpacityTransition),e.addTransitionClass(t.POPUP,Kekule.Widget.Css3TransformGrowOpacityTransition||Kekule.Widget.Css3GrowOpacityTransition),e.addTransitionClass(t.DIALOG,Kekule.Widget.Css3TransformGrowOpacityTransition||Kekule.Widget.Css3GrowOpacityTransition),Kekule.Widget.showHideManager.setTransitionSelector(e)}(),function(){Kekule.HtmlElementUtils;var e=Kekule.X.Event,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{RESIZEGRIPPER:"K-Resize-Gripper"});var n=Class.PropertyScope;Kekule.Widget.ResizeGripper=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ResizeGripper",BINDABLE_TAG_NAMES:["div","span"],initialize:function(i){if(this.reactMousemoveBind=this.reactMousemove.bind(this),this.reactMouseupBind=this.reactMouseup.bind(this),this.reactTouchmoveBind=this.reactTouchmove.bind(this),this.reactTouchendBind=this.reactTouchend.bind(this),this.tryApplySuper("initialize",[i]),!this.getTarget())if(this.getParent())this.setTarget(this.getParent());else{var r=this.getElement().parentNode;r&&this.setTarget(r)}},initProperties:function(){this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1,setter:function(i){this.getTarget()!==i&&(this.setPropStoreFieldValue("target",i),this.targetChanged(i))}}),this.defineProp("retainAspectRatio",{dataType:DataType.BOOL}),this.defineProp("isUnderResizing",{dataType:DataType.BOOL,serializable:!1,setter:null,scope:n.PRIVATE}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1,scope:n.PRIVATE}),this.defineProp("baseDimension",{dataType:DataType.HASH,serializable:!1,scope:n.PRIVATE}),this.defineProp("baseAspectRatio",{dataType:DataType.FLOAT,serializable:!1,scope:n.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.RESIZEGRIPPER},doGetDefaultTabIndex:function(){return null},doCreateRootElement:function(i){return i.createElement("span")},targetChanged:function(i){var r;(r=this.targetIsWidget(i)?i.getResizerElement?i.getResizerElement():i.getChildrenHolderElement():i)&&this.appendToElem(r)},targetIsWidget:function(i){return i instanceof Kekule.Widget.BaseWidget},getTargetDimension:function(i){var r=i||this.getTarget();return this.targetIsWidget(r)?r.getDimension():Kekule.HtmlElementUtils.getElemPageRect(r,!0)},setTargetDimension:function(i,r,a){var o=i||this.getTarget();if(this.targetIsWidget(o))o.setDimension(r,a);else{var l=o.style;l.width=r+"px",l.height=a+"px"}},prepareResizing:function(i,r){if(!this.getIsUnderResizing()){var a=this._getMoveEventReceiverElem(this.getElement());this._installEventHandlers(a),this._setMouseCapture(this.getElement(),!0,r),this.setBaseCoord(i);var o=this.getTargetDimension();this.setBaseDimension(o),this.setBaseAspectRatio(o.width/o.height),this.setPropStoreFieldValue("isUnderResizing",!0)}},doneResizing:function(i){this._setMouseCapture(this.getElement(),!1,i);var r=this._getMoveEventReceiverElem(this.getElement());this._uninstallEventHandlers(r),this.setBaseCoord(null),this.setBaseDimension(null),this.setPropStoreFieldValue("isUnderResizing",!1)},resizeTo:function(i){var r=Kekule.CoordUtils.substract(i,this.getBaseCoord()),a=this.getBaseDimension(),o=a.width+r.x,l=a.height+r.y;if(this.getRetainAspectRatio()){var u=this.getBaseAspectRatio();o/l>u?o=u*l:o/l<u&&(l=o/u)}this.setTargetDimension(this.getTarget(),o,l)},reactMousemove:function(i){if(this.getIsUnderResizing()){var r={x:i.getScreenX(),y:i.getScreenY()};this.resizeTo(r),i.stopPropagation(),i.preventDefault()}},reactMouseup:function(i){i.getButton()===Kekule.X.Event.MouseButton.LEFT&&this.getIsUnderResizing()&&(this.doneResizing(i),i.preventDefault())},reactTouchmove:function(i){if(this.getIsUnderResizing()){var r={x:i.getScreenX(),y:i.getScreenY()};this.resizeTo(r),i.stopPropagation(),i.preventDefault()}},reactTouchend:function(i){this.getIsUnderResizing()&&(this.doneResizing(i),i.preventDefault())},_elemSupportCapture:function(i){return!!i.setCapture},_setMouseCapture:function(i,r,a){i&&(r?(i.setCapture&&i.setCapture(!0),i.setPointerCapture&&Kekule.ObjUtils.notUnset(a.pointerId)&&i.setPointerCapture(a.pointerId)):(i.releaseCapture&&i.releaseCapture(),i.releasePointerCapture&&Kekule.ObjUtils.notUnset(a.pointerId)&&i.releasePointerCapture(a.pointerId)))},_getMoveEventReceiverElem:function(i){return this._elemSupportCapture(i)?i:i.ownerDocument.documentElement},_installEventHandlers:function(i){e.addListener(i,"mousemove",this.reactMousemoveBind),e.addListener(i,"touchmove",this.reactTouchmoveBind),e.addListener(i,"mouseup",this.reactMouseupBind),e.addListener(i,"touchend",this.reactTouchendBind)},_uninstallEventHandlers:function(i){e.removeListener(i,"mousemove",this.reactMousemoveBind),e.removeListener(i,"touchmove",this.reactTouchmoveBind),e.removeListener(i,"mouseup",this.reactMouseupBind),e.removeListener(i,"touchend",this.reactTouchendBind)},doReactActiviting:function(i){this.tryApplySuper("doReactActiviting",[i]);var r={x:i.getScreenX(),y:i.getScreenY()};this.prepareResizing(r,i)}}),ClassEx.extend(Kekule.Widget.BaseWidget,{resizableChanged:function(){var i;this.getResizable()?((i=new Kekule.Widget.ResizeGripper(this)).setRetainAspectRatio(this.getResizeWithAspectRatio()),this.setPropStoreFieldValue("resizeGripper",i)):((i=this.getResizeGripper())&&i.finalize(),this.setPropStoreFieldValue("resizeGripper",null))}}),ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"resizable",dataType:DataType.BOOL,setter:function(i){i!==this.getResizable()&&(this.setPropStoreFieldValue("resizable",i),this.resizableChanged())}},{name:"resizeWithAspectRatio",dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("resizeWithAspectRatio",i),this.getResizeGripper()&&this.getResizeGripper().setRetainAspectRatio(i)}},{name:"isResizing",dataType:DataType.BOOL,serializable:!1,scope:n.PRIVATE,setter:null,getter:function(){var i=this.getResizeGripper();return!!i&&i.getIsUnderResizing()}},{name:"resizeGripper",dataType:"Kekule.Widget.ResizeGripper",serializable:!1,setter:null,scope:n.PRIVATE}])}(),function(){var e=Kekule.HtmlElementUtils,t=Kekule.StyleUtils,n=Kekule.X.Event,i=Class.PropertyScope;Kekule.Widget.MoveHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.MoveHelper",initialize:function(r,a){this.tryApplySuper("initialize"),this.reactMouseDownBind=this.reactMouseDown.bind(this),this.reactMouseUpBind=this.reactMouseUp.bind(this),this.reactMouseMoveBind=this.reactMouseMove.bind(this),this.reactTouchDownBind=this.reactTouchDown.bind(this),this.reactTouchEndBind=this.reactTouchEnd.bind(this),this.reactTouchMoveBind=this.reactTouchMove.bind(this),this.__$K_initialMoverInfo__={},this.setCssPropX("left").setCssPropY("top").setMovingCursor("move").setMovingCursorDelay(500),this.setTarget(r),this.setGripper(a),this.setEnabled(!0)},doFinalize:function(){this.setGripper(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("target",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("gripper",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("gripper")||this.getTarget()},setter:function(r){var a=this.getPropStoreFieldValue("gripper");r!==a&&(this.setPropStoreFieldValue("gripper",r),this.gripperChanged(r,a))}}),this.defineProp("isMoving",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("cssPropX",{dataType:DataType.STRING}),this.defineProp("cssPropY",{dataType:DataType.STRING}),this.defineProp("movingCursor",{dataType:DataType.STRING}),this.defineProp("movingCursorDelay",{dataType:DataType.INT}),this.defineProp("movable",{dataType:DataType.BOOL,setter:null,getter:function(){return this.getEnabled()&&this.getGripper()}})},_objIsWidget:function(r){return r instanceof Kekule.Widget.BaseWidget},_getElement:function(r){return this._objIsWidget(r)?r.getElement():r},getTargetElement:function(){var r=this.getTarget();return this._objIsWidget(r)?r.getElement():r},getGripperElement:function(){var r=this.getGripper();return this._objIsWidget(r)?r.getElement():r},gripperChanged:function(r,a){a&&this.installEventHandlers(this._getElement(a)),r&&this.installEventHandlers(this._getElement(r))},installEventHandlers:function(r){r&&(n.addListener(r,"mousedown",this.reactMouseDownBind),n.addListener(r,"touchstart",this.reactTouchDownBind))},uninstallEventHandlers:function(r){r&&(n.removeListener(r,"mousedown",this.reactMouseDownBind),n.removeListener(r,"touchstart",this.reactTouchDownBind))},_elemSupportCapture:function(r){return!!r.setCapture},_getMoveEventReceiverElem:function(r){return this._elemSupportCapture(r)?r:r.ownerDocument.documentElement},setMouseCapture:function(r){var a=this.getGripperElement();a&&(r?a.setCapture&&a.setCapture(!0):a.releaseCapture&&a.releaseCapture())},beginMoving:function(r){if(!this.getIsMoving()){var a=this.getTargetElement();e.makePositioned(a),this.saveInitialInformation(r);var o=this._getMoveEventReceiverElem(this.getGripperElement());n.addListener(o,"mousemove",this.reactMouseMoveBind),n.addListener(o,"touchmove",this.reactTouchMoveBind),n.addListener(o,"mouseup",this.reactMouseUpBind),n.addListener(o,"touchend",this.reactTouchEndBind),this.setMouseCapture(!0),this._setCursorHandle=this.delaySetMoveCursor(),this.setIsMoving(!0)}},endMoving:function(){this.setIsMoving(!1),this.setMouseCapture(!1);var r=this.getGripperElement(),a=this._getMoveEventReceiverElem(r);if(n.removeListener(a,"mousemove",this.reactMouseMoveBind),n.removeListener(a,"touchmove",this.reactTouchMoveBind),n.removeListener(a,"mouseup",this.reactMouseUpBind),n.removeListener(a,"touchend",this.reactTouchEndBind),this.clearCursorSetter(),r){var o=this.__$K_initialMoverInfo__.cursor;r.style.cursor=o||"",this.__$K_initialMoverInfo__.cursor=null}},moveTo:function(r){this.clearCursorSetter(),this.doSetMoveCursor();var a=this.getTargetElement();if(a){var o=this.__$K_initialMoverInfo__,l=Kekule.CoordUtils.substract(r,o.pointerCoord);(this.getCssPropX()||"").toLowerCase()==="right"?a.style.right=o.elemCoord.x-l.x+"px":a.style.left=o.elemCoord.x+l.x+"px",(this.getCssPropY()||"").toLowerCase()==="bottom"?a.style.bottom=o.elemCoord.y-l.y+"px":a.style.top=o.elemCoord.y+l.y+"px"}},delaySetMoveCursor:function(){return setTimeout(this.doSetMoveCursor.bind(this),this.getMovingCursorDelay()||0)},doSetMoveCursor:function(){var r=this.getGripperElement();r&&this.getMovingCursor()&&(r.style.cursor=this.getMovingCursor())},clearCursorSetter:function(){this._setCursorHandle&&clearTimeout(this._setCursorHandle)},saveInitialInformation:function(r){var a=this.getTargetElement();if(a){var o;this.__$K_initialMoverInfo__.pointerCoord=r;var l=(t.getComputedStyle(a,"position")||"").toLowerCase(),u=(this.getCssPropX()||"left").toLowerCase(),c=(this.getCssPropY()||"top").toLowerCase();l==="relative"?(o={x:t.analysisUnitsValue(t.getComputedStyle(a,"left")).value||0,y:t.analysisUnitsValue(t.getComputedStyle(a,"top")).value||0},u="left",c="top"):o={x:a.offsetLeft,y:a.offsetTop};var d=e.getElemOffsetDimension(a);u==="right"&&(o.x+=d.width),c==="bottom"&&(o.y+=d.height),this.__$K_initialMoverInfo__.elemCoord=o,this.getGripperElement()&&(this.__$K_initialMoverInfo__.cursor=this.getGripperElement().style.cursor)}},reactMouseDown:function(r){this.getTargetElement()&&this.getEnabled()&&r.getButton()===n.MouseButton.LEFT&&(this.beginMoving({x:r.getScreenX(),y:r.getScreenY()},r.getTarget()),r.preventDefault())},reactMouseUp:function(r){r.getButton()===n.MouseButton.LEFT&&this.getIsMoving()&&(this.endMoving(),r.preventDefault())},reactMouseMove:function(r){if(this.getIsMoving()){var a={x:r.getScreenX(),y:r.getScreenY()};this.moveTo(a),r.preventDefault()}},reactTouchDown:function(r){this.getEnabled()&&(this.beginMoving({x:r.getScreenX(),y:r.getScreenY()},r.getTarget()),r.preventDefault())},reactTouchEnd:function(r){this.getIsMoving()&&(this.endMoving(),r.preventDefault())},reactTouchMove:function(r){if(this.getIsMoving()){var a={x:r.getScreenX(),y:r.getScreenY()};this.moveTo(a),r.preventDefault()}}}),ClassEx.extend(Kekule.Widget.BaseWidget,{_getMoveHelper:function(r){var a=this.getMoveHelper();return!a&&r&&(a=new Kekule.Widget.MoveHelper(this)),a},movingGripperChanged:function(){var r,a=this.getMovingGripper();a?(r=this._getMoveHelper(!0)).setGripper(a):(r=this._getMoveHelper(!1))&&r.setGripper(null)}}),ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"movable",dataType:DataType.BOOL,getter:function(){return this._getMoveHelper()&&this._getMoveHelper().getMovable()},setter:function(r){if(r!==this.getMovable())if(r)this.setMovingGripper(this.getDefaultMovingGripper&&this.getDefaultMovingGripper()||this);else{var a=this._getMoveHelper();a&&a.setEnabled(!1)}}},{name:"movingGripper",dataType:DataType.OBJECT,setter:function(r){r!==this.getMovingGripper()&&(this.setPropStoreFieldValue("movingGripper",r),this.movingGripperChanged())}},{name:"isMoving",dataType:DataType.BOOL,serializable:!1,scope:i.PRIVATE,setter:null,getter:function(){var r=this.getMoveHelper();return!!r&&r.getIsMoving()}},{name:"moveHelper",dataType:"Kekule.Widget.MoveHelper",serializable:!1,setter:null,scope:i.PRIVATE}])}(),function(){var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.Glyph=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Glyph",initialize:function(n,i){this._imgElem=null,this.tryApplySuper("initialize",[n]),i&&this.setNormalInfo(i)},initProperties:function(){this.defineImgInfoProp("normalInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("hoverInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("focusedInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("activeInfo",{dataType:DataType.HASH}),this.defineImgInfoProp("disabledInfo",{dataType:DataType.HASH})},defineImgInfoProp:function(n,i){var r=Object.extend({setter:function(a){a?this.setPropStoreFieldValue(n,Object.extend({},a)):this.setPropStoreFieldValue(n,null),this.imgInfoChanged()}},i);return this.defineProp(n,r)},doGetWidgetClassName:function(){return"K-Glyph"},doCreateRootElement:function(n){return n.createElement("span")},doBindElement:function(n){this.tryApplySuper("doBindElement"),this.createImgContainer(n)},createImgContainer:function(n,i){var r=n.ownerDocument;this._imgElem=r.createElement("span"),this._imgElem.className=t.FULLFILL,n.innerHTML="",n.appendChild(this._imgElem)},imgInfoChanged:function(){this.updateImg()},stateChanged:function(){this.tryApplySuper("stateChanged"),this.updateImg()},updateImg:function(){var n=Kekule.Widget.State,i=this.getState(),r=i===n.DISABLED?this.getDisabledInfo():i===n.ACTIVE?this.getActiveInfo()||this.getHoverInfo()||this.getFocusedInfo():i===n.HOVER?this.getHoverInfo():i===n.FOCUSED?this.getFocusedInfo():this.getNormalInfo();r=r||this.getNormalInfo(),this.showImgOfInfo(r)},showImgOfInfo:function(n){var i=this._imgElem;i&&(n?(n.className?(i.className=t.FULLFILL,e.addClass(i,n.className)):i.className=t.FULLFILL,i.style.backgroundImage=n.src?"url("+n.src+")":"",i.style.backgroundPosition=n.position||"",i.style.backgroundRepeat=n.repeat||"no-repeat"):i.style.backgroundImage="")}})}(),function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{CONTAINER:"K-Container",PANEL:"K-Panel",PANEL_CAPTION:"K-Panel-Caption",TOOLBAR:"K-Toolbar"});var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames),n=Kekule.StyleUtils;Kekule.Widget.Container=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Container",initialize:function(i){this._defContainerElem=null,this.tryApplySuper("initialize",[i]),this.reactShowStateChangeBind=this.reactShowStateChange.bind(this),this.addEventListener("showStateChange",this.reactShowStateChangeBind)},finalize:function(){this.removeEventListener("showStateChange",this.reactShowStateChangeBind),this.clearWidgets(),this.tryApplySuper("finalize")},initProperties:function(){this.defineChildDimensionRelatedProp("childWidth"),this.defineChildDimensionRelatedProp("childHeight"),this.defineChildDimensionRelatedProp("childMargin"),this.defineProp("firstChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("lastChild",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("allowChildWrap",{dataType:DataType.BOOL,serializable:!1,setter:function(i){this.setPropStoreFieldValue("allowChildWrap",i),i?this.removeClassName(t.NOWRAP):this.addClassName(t.NOWRAP)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAllowChildWrap(!0)},defineChildDimensionRelatedProp:function(i,r){var a=Object.extend({dataType:DataType.STRING,setter:function(o){this.setPropStoreFieldValue(i,o),this.updateChildSizes()}},r||{});return this.defineProp(i,a)},doGetWidgetClassName:function(){return t.CONTAINER},doCreateRootElement:function(i){return i.createElement("span")},doCreateContainerElement:function(i,r,a){var o=Kekule.BrowserFeature.htmlSlot?Kekule.Widget.HtmlTagNames.CHILD_HOLDER:a||"span",l=i.createElement(o);return l.className=t.CHILD_HOLDER,l},getContainerElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getContainerElement()},appendWidget:function(i){return i.setParent(this),this},insertWidgetBefore:function(i,r){return i.insertToWidget(this,r),this},removeWidget:function(i,r){i.setParent(null),r||i.finalize()},clearWidgets:function(i){for(var r=this.getChildWidgets(),a=r.length-1;a>=0;--a){var o=r[a];this.removeWidget(o,i)}},_insertChildWidget:function(i,r){var a=r?r.getElement():null,o=this.getChildrenHolderElement();o&&(a?o.insertBefore(i.getElement(),a):o.appendChild(i.getElement()))},reactShowStateChange:function(i){this.childrenModified()},childrenModified:function(){this.tryApplySuper("childrenModified");for(var i=this.getChildWidgets(),r=i.length,a=i[l=0];a&&!a.isShown(!0)&&l<r;)a=i[++l];var o=l<r?a:null,l=r-1;for(a=i[r-1];a&&!a.isShown(!0)&&l>=0;)a=i[--l];var u=l>=0?a:null,c=this.getFirstChild(),d=this.getLastChild();o!==c&&(c&&c.removeClassName(t.FIRST_CHILD),o&&o.addClassName(t.FIRST_CHILD),this.setPropStoreFieldValue("firstChild",o)),u!==d&&(d&&d.removeClassName(t.LAST_CHILD),u&&u.addClassName(t.LAST_CHILD),this.setPropStoreFieldValue("lastChild",u))},childWidgetAdded:function(i){this.tryApplySuper("childWidgetAdded",[i]);var r=this.getChildWidth();r&&i.setWidth(r);var a=this.getChildHeight();a&&i.setHeight(a);var o=this.getChildMargin();o&&(i.getStyle().margin=o),this._insertChildWidget(i,null)},childWidgetRemoved:function(i){this.tryApplySuper("childWidgetRemoved",[i])},childWidgetMoved:function(i,r){this.tryApplySuper("childWidgetMoved",[i,r]);var a=i.getElement(),o=this.getChildWidgets()[r+1],l=o?o.getElement():null;l?this.getContainerElement().insertBefore(a,l):this.getContainerElement().appendChild(a)},updateChildSizes:function(){for(var i=this.getChildWidgets(),r=this.getChildWidth()||"",a=this.getChildHeight()||"",o=this.getChildMargin()||"",l=(this.getLayout(),0),u=i.length;l<u;++l){var c=i[l];c.setWidth(r),c.setHeight(a),c.getStyle().margin=o}}}),Kekule.Widget.Panel=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Panel",initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return this.getCaptionElem(!1)&&e.getElementText(this.getCaptionElem())},setter:function(i){e.setElementText(this.getCaptionElem(!0),i),n.setDisplay(this.getCaptionElem(),!!i)}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(i){var r=this.getPropStoreFieldValue("captionElem");if(!r&&i){(r=this.getDocument().createElement("div")).className=t.PANEL_CAPTION;var a=this.getElement();a.insertBefore(r,e.getFirstChildElem(a)),this.setPropStoreFieldValue("captionElem",r)}return r}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.PANEL}}),Kekule.Widget.WidgetGroup=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGroup",initialize:function(i){this.tryApplySuper("initialize",[i])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doObjectChange:function(i){this.tryApplySuper("doObjectChange",[i]),i.indexOf("useCornerDecoration")>=0&&this._updateChildStyles()},childWidgetAdded:function(i){i.setUseCornerDecoration&&i.setUseCornerDecoration(!1),this.tryApplySuper("childWidgetAdded",[i])},layoutChanged:function(){this.tryApplySuper("layoutChanged"),this._updateChildStyles()},childrenModified:function(){this.tryApplySuper("childrenModified"),this._updateChildStyles()},_updateChildStyles:function(){Kekule.Widget.Layout,this.getLayout();for(var i=this.getFirstChild(),r=this.getLastChild(),a=this.getUseCornerDecoration(),o=this.getChildWidgets(),l=[t.CORNER_LEADING,t.CORNER_TAILING],u=0,c=o.length;u<c;++u){var d=o[u];d.removeClassName(l),d===i&&a&&d.addClassName(t.CORNER_LEADING),d===r&&a&&d.addClassName(t.CORNER_TAILING)}}}),Kekule.Widget.Toolbar=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.Toolbar",finalize:function(){var i=this.getChildWidgetInternalNameMap();i&&i.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("childDefs",{dataType:DataType.ARRAY,setter:function(i){this.setPropStoreFieldValue("childDefs",i),this.recreateChildrenByDefs()}}),this.defineProp("childWidgetInternalNameMap",{dataType:DataType.OBJECT,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.TOOLBAR},doSetShowText:function(i){this.tryApplySuper("doSetShowText",[i]),this._updateAllChildTextGlyphStyles()},doSetShowGlyph:function(i){this.tryApplySuper("doSetShowGlyph",[i]),this._updateAllChildTextGlyphStyles()},childWidgetAdded:function(i){this.tryApplySuper("childWidgetAdded",[i]),this._updateChildTextGlyphStyles(i)},_updateChildTextGlyphStyles:function(i){i.setShowText&&i.setShowText(this.getShowText()),i.setShowGlyph&&i.setShowGlyph(this.getShowGlyph())},_updateAllChildTextGlyphStyles:function(){for(var i=this.getChildWidgets(),r=i.length-1;r>=0;--r)this._updateChildTextGlyphStyles(i[r])},recreateChildrenByDefs:function(){var i=this.getChildDefs()||[];this.clearWidgets();var r=new Kekule.MapEx(!0);this.setChildWidgetInternalNameMap(r);for(var a=this.getDefaultChildWidgetClassName(),o=0,l=i.length;o<l;++o){var u=i[o];u.widget||u.widgetClass||!a||(u=Object.extend({widget:a},u));var c=Kekule.Widget.createFromHash(this,u);c&&(c.appendToWidget(this),u.internalName&&r.set(u.internalName,c))}},getDefaultChildWidgetClassName:function(){return null},getChildWidgetByInternalName:function(i){var r=this.getChildWidgetInternalNameMap();return r?r.get(i):null}})}(),function(){var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames);Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MENU:"K-Menu",POPUPMENU:"K-PopupMenu",MENUBAR:"K-MenuBar",MENUITEM:"K-MenuItem",MENUITEM_NORMAL:"K-MenuItem-Normal",MENUITEM_SEPARATOR:"K-MenuItem-Separator",SUBMENU_MARKER:"K-SubMenu-Marker",CHECKMENU_MARKER:"K-CheckMenu-Marker"}),Kekule.Widget.MenuItem=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.MenuItem",BINDABLE_TAG_NAMES:["li"],SUB_MENU_TAGS:["ol","ul"],initialize:function(n,i){this.tryApplySuper("initialize",[n]),i&&this.setText(i),this._subMenuMarker=null,this._checkMarker=null},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(n){n===Kekule.Widget.MenuItem.SEPARATOR_TEXT?this.setIsSeparator(!0):(n&&this.setIsSeparator(!1),this.changeContentText(n))}}),this.defineProp("checked",{dataType:DataType.BOOL,setter:function(n){this.getPropStoreFieldValue("checked")!==n&&(this.setPropStoreFieldValue("checked",n),this.checkChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL}),this.defineProp("isSeparator",{dataType:DataType.BOOL,setter:function(n){this.setPropStoreFieldValue("isSeparator",n),this.isSeparatorChanged(n)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!1),this.setIsSeparator(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENUITEM},doCreateRootElement:function(n){return n.createElement("li")},changeContentText:function(n){this.getElement().innerHTML=n||""},isSeparatorChanged:function(n){n?(this.setText("&nbsp;"),this.removeClassName(t.MENUITEM_NORMAL),this.addClassName(t.MENUITEM_SEPARATOR),this.setStatic(!0)):(this.removeClassName(t.MENUITEM_SEPARATOR),this.addClassName(t.MENUITEM_NORMAL),this.setStatic(!1))},doBindElement:function(n){this.tryApplySuper("doBindElement",[n]);for(var i=e.getDirectChildElems(n),r=0,a=i.length;r<a;++r){var o=i[r];o.nodeType===Node.ELEMENT_NODE&&this.bindSubMenu(o),o=o.nextSibling}},doDomElemAdded:function(n){Kekule.Widget.getWidgetOnElem(n)||this.bindSubMenu(n)},checkChanged:function(){this.getChecked()?(this._createCheckMarker(),this.addClassName(t.STATE_CHECKED),this.invokeEvent("check")):this.removeClassName(t.STATE_CHECKED)},_createCheckMarker:function(){var n;return(n=this._checkMarker)||((n=this.getDocument().createElement("span")).className=t.CHECKMENU_MARKER,this.getElement().appendChild(n),this._checkMarker=n),n},_removeCheckMarker:function(){this._checkMarker&&(this._checkMarker.parentNode.removeChild(this._checkMarker),this._checkMarker=null)},childWidgetAdded:function(n){if(this.tryApplySuper("childWidgetAdded",[n]),n instanceof Kekule.Widget.Menu)n.setIsSubMenu(!0);else if(n instanceof Kekule.Widget.MenuItem){var i=this.getSubMenu(!0);(function(){n.setParent(i),n.appendToWidget(i)}).defer(10)}},childrenModified:function(){this.tryApplySuper("childrenModified"),this.subMenuChanged()},bindSubMenu:function(n){var i=n.tagName.toLowerCase();if(i==="ul"||i==="ol"){var r=new Kekule.Widget.PopupMenu(n);return this.addSubMenu(r),r}},subMenuChanged:function(){var n=this.getSubMenu();n?this._createSubMenuMarker(n):this._removeSubMenuMarker()},getSubMenu:function(n){for(var i=this.getChildWidgets(),r=0,a=i.length;r<a;++r){var o=i[r];if(o instanceof Kekule.Widget.Menu)return o}return n?this.createSubMenu():null},addSubMenu:function(n){return n.appendToWidget(this),this},removeSubMenu:function(n){return n.setParent(null),n},createSubMenu:function(){var n=new Kekule.Widget.PopupMenu(this);return this.addSubMenu(n),n},_createSubMenuMarker:function(n){var i;return(i=this._subMenuMarker)||((i=this.getDocument().createElement("span")).className=t.SUBMENU_MARKER,this.getElement().appendChild(i),this._subMenuMarker=i),i},_removeSubMenuMarker:function(){this._subMenuMarker&&(this._subMenuMarker.parentNode.removeChild(this._subMenuMarker),this._subMenuMarker=null)},isLeafItem:function(){var n=this.getElement();return!(n.getElementsByTagName("ul").length||n.getElementsByTagName("ol").length)},isPeriodicalExecuting:function(){return this.tryApplySuper("isPeriodicalExecuting")&&this.getIsActive()},doReactActiviting:function(n){this.tryApplySuper("doReactActiviting",[n]),this.isLeafItem()&&this.getEnablePeriodicalExec()&&this.startPeriodicalExec(n)},doReactDeactiviting:function(n){this.isLeafItem()&&(this.stopPeriodicalExec(),this.getIsActive()&&(this.execute(n),this.getAutoCheck()&&this.setChecked(!this.getChecked()),this.notifyDeactivated()))},notifyDeactivated:function(){var n=this.getParent();n&&n.childDeactivated&&n.childDeactivated(this)},childDeactivated:function(n){var i=this.getParent();i&&i.childDeactivated&&i.childDeactivated(this)}}),Kekule.Widget.MenuItem.SEPARATOR_TEXT="-",Kekule.Widget.MenuItem.createFromHash=function(n,i){var r=i;return DataType.isSimpleValue(r)&&(r=r===Kekule.Widget.MenuItem.SEPARATOR_TEXT?{isSeparator:!0}:{text:r}),r.widget||r.widgetClass||(r.widget=Kekule.Widget.MenuItem),Kekule.Widget.createFromHash(n,r)},Kekule.Widget.Menu=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Menu",BINDABLE_TAG_NAMES:["ol","ul"],MENU_ITEM_TAG:"li",initialize:function(n){this.tryApplySuper("initialize",[n])},initProperties:function(){this.defineProp("isSubMenu",{dataType:DataType.BOOL,serializable:!1,setter:function(n){this.setPropStoreFieldValue("isSubMenu",n),n&&this.setLayout(Kekule.Widget.Layout.VERTICAL)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENU},doCreateRootElement:function(n){return n.createElement("ul")},doBindElement:function(n){this.tryApplySuper("doBindElement",[n]);for(var i=Kekule.DomUtils.getDirectChildElems(n),r=0,a=i.length;r<a;++r){var o=i[r];o.nodeType===Node.ELEMENT_NODE&&this.bindMenuItem(o),o=o.nextSibling}},doDomElemAdded:function(n){this.bindMenuItem(n)},bindMenuItem:function(n){if(n.tagName.toLowerCase()==="li"){var i=new Kekule.Widget.MenuItem(n);return i.setParent(this),i}},getSubMenuTagName:function(){return this.getElement().tagName},getMenuItems:function(n){n||(n=this.getElement());for(var i=e.getDirectChildElems(n,this.MENU_ITEM_TAG),r=[],a=0,o=i.length;a<o;++a){var l=Kekule.Widget.getWidgetOnElem(i[a]);l&&l instanceof Kekule.Widget.MenuItem&&r.push(l)}return r},insertMenuItem:function(n,i){return n.insertToWidget(this,i),this},appendMenuItem:function(n){return n.appendToWidget(this),this},removeMenuItem:function(n,i){n.setParent(null),i||n.finalize()},clearMenuItems:function(n){return this.clearWidgets(n),this},isTopLevel:function(){var n=this.getParent();return!n||!(n instanceof Kekule.Widget.MenuItem||n instanceof Kekule.Widget.Menu)},childDeactivated:function(n){var i=this.getParent();i&&i.childDeactivated&&i.childDeactivated(this)},createChildrenByDefs:function(n){for(var i=0,r=n.length;i<r;++i){var a=n[i];Kekule.Widget.MenuItem.createFromHash(this,a)}return this}}),Kekule.Widget.PopupMenu=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.PopupMenu",initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.POPUPMENU},childDeactivated:function(n){}}),Kekule.Widget.MenuBar=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.MenuBar",doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MENUBAR}})}(),function(){var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{BUTTON:"K-Button",BUTTON_KINDED:"K-Button-Kinded",BUTTON_GROUP:"K-Button-Group",COMPACT_BUTTON:"K-Compact-Button",BTN_COMPACT_MARK:"K-Compact-Mark"}),Kekule.Widget.Button=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Button",BINDABLE_TAG_NAMES:["input","button","a","label"],CSS_DROPDOWN_CLASS_NAME:"K-DropDownMark",DEF_GLYPH_WIDTH:"16px",DEF_GLYPH_HEIGHT:"16px",initialize:function(n,i){this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,this.tryApplySuper("initialize",[n]),i&&this.setText(i)},initProperties:function(){this.defineElemAttribMappingProp("actionType","type"),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var n=this._elemTextPart||this.getElement();return n?n.innerHTML:null},setter:function(n){this.changeContentText(n)}}),this.defineProp("leadingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(n){var i=this.getPropStoreFieldValue("leadingGlyph");return!i&&n&&(i=this._createDefaultGlyphWidget(this._elemLeadingGlyphPart),this.setPropStoreFieldValue("leadingGlyph",i)),i}}),this.defineProp("tailingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(n){var i=this.getPropStoreFieldValue("tailingGlyph");return!i&&n&&(i=this._createDefaultGlyphWidget(this._elemTailingGlyphPart),this.setPropStoreFieldValue("tailingGlyph",i)),i}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(n){this.setPropStoreFieldValue("showLeadingGlyph",n),this._elemLeadingGlyphPart.style.display=n&&this.getShowGlyph()?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(n){this.setPropStoreFieldValue("showTailingGlyph",n),this._elemTailingGlyphPart.style.display=n&&this.getShowGlyph()?"":"none"}}),this.defineProp("buttonKind",{dataType:DataType.STRING,setter:function(n){var i=this.getButtonKind();n!==i&&(this.cancelButtonKind(i),this.applyButtonKind(n),this.setPropStoreFieldValue("buttonKind",n))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setPropStoreFieldValue("showLeadingGlyph",!0),this.setPropStoreFieldValue("showTailingGlyph",!0),this.setPropStoreFieldValue("useCornerDecoration",!0),this.setAllowTextWrap(!1)},_createDefaultGlyphWidget:function(n){var i=new Kekule.Widget.Glyph(this);return i.setWidth(this.DEF_GLYPH_WIDTH).setHeight(this.DEF_GLYPH_HEIGHT),i.setStatic(!0).setInheritState(!0).setInheritStatic(!0).setInheritEnabled(!0),i.appendToElem(n),i},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.BUTTON},doCreateRootElement:function(n){var i=n.createElement("button");return i.setAttribute("type","button"),i},doBindElement:function(n){this.tryApplySuper("doBindElement",[n]);var i=n.innerHTML||"";n.innerHTML="",this._elemTextPart=this.createTextContent(i,n),this._elemLeadingGlyphPart=this.createGlyphContent(n,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(n,null,t.PART_ASSOC_GLYPH_CONTENT),this.getUseCornerDecoration()&&e.addClass(n,t.CORNER_ALL)},changeContentText:function(n){this._elemTextPart.innerHTML=n||""},isPeriodicalExecuting:function(){return this.tryApplySuper("isPeriodicalExecuting")&&this.getIsActive()},doReactActiviting:function(n){this.tryApplySuper("doReactActiviting",[n]),this.getEnablePeriodicalExec()&&this.startPeriodicalExec(n)},doReactDeactiviting:function(n){this.stopPeriodicalExec(),this.getIsActive()&&this.execute(n)},cancelButtonKind:function(n){n&&(this.removeClassName(n),this.removeClassName(t.BUTTON_KINDED))},applyButtonKind:function(n){n&&(this.addClassName(t.BUTTON_KINDED),this.addClassName(n))}}),Kekule.Widget.Button.Kinds={DROPDOWN:"K-Kind-DropDown",POPUP:"K-Kind-Popup",SEARCH:"K-Kind-Search",EDIT:"K-Kind-Edit",ENTER:"K-Kind-Enter"},Kekule.Widget.CheckButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.CheckButton",initialize:function(n,i){this.tryApplySuper("initialize",[n,i])},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,setter:function(n){this.getPropStoreFieldValue("checked")!==n&&(this.setPropStoreFieldValue("checked",n),this.checkChanged(),this.stateChanged())}}),this.defineProp("autoCheck",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoCheck(!0)},checkChanged:function(){this.getChecked()?this.invokeEvent("check"):this.invokeEvent("uncheck"),this.invokeEvent("checkChange",{checked:this.getChecked()})},getStateClassName:function(n){var i=this.getChecked()?Kekule.Widget.State.ACTIVE:n;return this.tryApplySuper("getStateClassName",[i])},doReactDeactiviting:function(n){var i=this.getChecked();this.tryApplySuper("doReactDeactiviting",[n]),this.getAutoCheck()&&this._doToggleCheckOnSelf(i)},_doToggleCheckOnSelf:function(n){this.getEnabled()&&this.setChecked(!n)}}),Kekule.Widget.RadioButton=Class.create(Kekule.Widget.CheckButton,{CLASS_NAME:"Kekule.Widget.RadioButton",initialize:function(n,i){this.tryApplySuper("initialize",[n,i])},initProperties:function(){this.defineProp("group",{dataType:DataType.STRING})},checkChanged:function(){this.tryApplySuper("checkChanged"),this.getChecked()&&this.uncheckSiblings()},uncheckSiblings:function(){var n=this.getParent(),i=this.getGroup();if(n)for(var r=n.getChildWidgets(),a=0,o=r.length;a<o;++a){var l=r[a];l!==this&&l.getGroup&&l.setChecked&&l.getGroup()===i&&l.setChecked(!1)}},doReactDeactiviting:function(n){this.tryApplySuper("doReactDeactiviting",[n])},_doToggleCheckOnSelf:function(n){n||this.tryApplySuper("_doToggleCheckOnSelf",[n])},_doCheckOnSelf:function(){this.getEnabled()&&this.setChecked(!0)}}),Kekule.Widget.DropDownButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.DropDownButton",doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("dropDownWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,getter:function(){var n=this.getPropStoreFieldValue("dropDownWidget");if(!n){var i=this.getDropDownWidgetGetter();i&&(n=i(this),this.setPropStoreFieldValue("dropDownWidget",n))}return n},setter:function(n){this.setPropStoreFieldValue("dropDownWidget",n),n&&n.setDisplayed(!1)}}),this.defineProp("dropDownWidgetGetter",{dataType:DataType.FUNCTION,serializable:!1}),this.defineProp("dropPosition",{dataType:DataType.INT})},doCreateRootElement:function(n){return this.tryApplySuper("doCreateRootElement",[n])},calcActualDropPosition:function(){var n=Kekule.Widget.Position,i=this.getDropPosition();if(!i){var r=this.getParent(),a=r?r.getLayout():Kekule.Widget.Layout.HORIZONTAL,o=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),!0),l=Kekule.HtmlElementUtils.getViewportDimension(this.getElement()),u=this.getDropDownWidget().getElement();u.style.visible="hidden",u.style.display="",this.getElement().appendChild(u);var c=Kekule.HtmlElementUtils.getElemOffsetDimension(u);if(this.getElement().removeChild(u),a)if(a===Kekule.Widget.Layout.VERTICAL){var d=o.x,h=l.width-d-o.width;i=h>=c.width?n.RIGHT:d>h?n.LEFT:n.RIGHT}else{var p=o.y,g=l.height-p-o.height;i=g>=c.height?n.BOTTOM:p>g?n.TOP:n.BOTTOM}}return i},showDropDownWidget:function(){var n=this.getDropDownWidget();n.getElement().style.position="absolute",this.getElement(),n.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN),this.invokeEvent("dropDown",{dropDown:n})},hideDropDownWidget:function(){this.getDropDownWidget().hide(this)},isDropDownWidgetShown:function(){var n=this.getDropDownWidget();return n&&n.isShown()},doExecute:function(n){this.getDropDownWidget()&&(this.isDropDownWidgetShown()?this.hideDropDownWidget():this.showDropDownWidget()),this.tryApplySuper("doExecute",[n])}}),Kekule.Widget.ButtonGroup=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Widget.ButtonGroup",initialize:function(n){this.tryApplySuper("initialize",[n])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("showText",!0),this.setPropStoreFieldValue("showGlyph",!0),this.setAllowChildWrap(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.BUTTON_GROUP},doCreateRootElement:function(n){return n.createElement("span")},getDefaultChildWidgetClassName:function(){return"Kekule.Widget.Button"}}),Kekule.Widget.CompactButtonSet=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.CompactButtonSet",initialize:function(n,i){this.reactSetButtonExecuteBind=this.reactSetButtonExecute.bind(this),this.setPropStoreFieldValue("showCompactMark",!0),this.setPropStoreFieldValue("cloneSelectedOutlook",!0),this.tryApplySuper("initialize",[n,i]),this.getButtonSet()||this.initButtonGroup()},initProperties:function(){this.defineProp("buttonSet",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:function(n){var i=this.getButtonSet();i!==n&&(i&&i.finalize(),this.initButtonGroup(n))}}),this.defineProp("buttonSetLayout",{dataType:DataType.INT}),this.defineProp("selected",{dataType:"Kekule.Widget.Button",serializable:!1,setter:function(n){if(n)this.getButtonSet().hasChild(n)&&(this.getCloneSelectedOutlook()&&this.cloneSetButton(n),n.setChecked&&n.setChecked(!0));else{var i=this.getSelected();i&&i.setChecked(!1)}this.setPropStoreFieldValue("selected",n)}}),this.defineProp("cloneSelectedOutlook",{dataType:DataType.BOOL}),this.defineProp("showCompactMark",{dataType:DataType.BOOL,setter:function(n){this.getShowCompactMark()!==n&&(this.setPropStoreFieldValue("showCompactMark",n),n?this.createCompactMark():this.removeCompactMark())}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPACT_BUTTON},doSetShowText:function(n){return this.getButtonSet()&&this.getButtonSet().setShowText(n),this.tryApplySuper("doSetShowText",[n])},doSetShowGlyph:function(n){return this.getButtonSet()&&this.getButtonSet().setShowGlyph(n),this.tryApplySuper("doSetShowGlyph",[n])},createCompactMark:function(){var n=this.getElement();this._compactMark&&n.removeChild(this._compactMark);var i=this.getDocument().createElement("span");return i.className=t.BTN_COMPACT_MARK,n.appendChild(i),this._compactMark=i,i},removeCompactMark:function(){var n=this.getElement();this._compactMark&&n.removeChild(this._compactMark)},initButtonGroup:function(n){if(n)var i=this._getCheckedButtonInGroup(n);else n=new Kekule.Widget.ButtonGroup(this);n.setDisplayed(!1),n.setShowText(this.getShowText()),n.setShowGlyph(this.getShowGlyph()),this.setPropStoreFieldValue("buttonSet",n),this.setDropDownWidget(n),n.addEventListener("execute",this.reactSetButtonExecuteBind),n.addEventListener("check",this.reactSetButtonExecuteBind),i&&this.cloneSetButton(i)},_getCheckedButtonInGroup:function(n){for(var i=n.getChildWidgets(),r=0,a=i.length;r<a;++r){var o=i[r];if(o.getChecked&&o.getChecked())return o}return null},cloneSetButton:function(n){if(this.getCloneSelectedOutlook()){for(var i=this.getElement(),r=this.getButtonSet().getElement(),a=Kekule.DomUtils,o=a.getDirectChildElems(i),l=a.getDirectChildElems(n.getElement()),u=!1,c=0,d=o.length;c<d;++c)(h=o[c])!==r?i.removeChild(h):u=!0;for(c=0,d=l.length;c<d;++c){var h=l[c].cloneNode(!0);u?i.insertBefore(h,r):i.appendChild(h)}this._clonedCustomHtmlClassName&&this.removeClassName(this._clonedCustomHtmlClassName),this._clonedCustomHtmlClassName=n.getCustomHtmlClassName(),this._clonedCustomHtmlClassName&&this.addClassName(this._clonedCustomHtmlClassName),this._compactMark=null,this.createCompactMark()}},calcActualButtonSetLayout:function(){var n=Kekule.Widget.Layout,i=this.getButtonSetLayout();if(!i){var r=this.getParent();i=(r?r.getLayout():n.HORIZONTAL)===n.VERTICAL?n.HORIZONTAL:n.VERTICAL}return i},showDropDownWidget:function(){var n=this.calcActualButtonSetLayout();this.getButtonSet().setLayout(n),this.tryApplySuper("showDropDownWidget")},reactSetButtonExecute:function(n){if(n.target instanceof Kekule.Widget.Button&&n.target!==this.getSelected()&&(!this._currExecButton||this._currExecButton!==n.target))try{this._currExecButton=n.target,n.target.setIsFocused(!1),n.target.setIsHover(!1),n.target.setIsActive(!1),this.setSelected(n.target),this.getButtonSet().isShown()&&this.getButtonSet().hide(),this.invokeEvent("select",{selected:n.target})}finally{this._currExecButton=null}},append:function(n,i){return this.getButtonSet().appendWidget(n),i&&this.setSelected(n),this},insertBefore:function(n,i,r){return this.getButtonSet().insertWidgetBefore(n),r&&this.setSelected(n),this},remove:function(n,i){return this.getButtonSet().removeWidget(n,i),this}})}(),function(){var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,n=Kekule.Widget.HtmlClassNames,i=Kekule.ObjUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OVERLAP:"K-Overlap",FORMCONTROL:"K-FormControl",CHECKBOX:"K-CheckBox",TEXTBOX:"K-TextBox",COMBOTEXTBOX:"K-ComboTextBox",COMBOTEXTBOX_ASSOC_WIDGET:"K-ComboTextBox-Assoc-Widget",BUTTONTEXTBOX:"K-ButtonTextBox",TEXTAREA:"K-TextArea",SELECTBOX:"K-SelectBox",COMBOBOX:"K-ComboBox",COMBOBOX_TEXTWRAPPER:"K-ComboBox-TextWrapper",NUMINPUT:"K-NumInput"}),Kekule.Widget.FormWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.FormWidget",initialize:function(r,a){this.reactValueChangeBind=this.reactValueChange.bind(this),this.reactInputBind=this.reactInput.bind(this),this.setPropStoreFieldValue("isDirty",!1),this.tryApplySuper("initialize",[r,a])},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,getter:function(){return this.getCoreElement().name},setter:function(r){this.getCoreElement().name=r}}),this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){return this.getCoreElement().value},setter:function(r){this.getCoreElement().value=r}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getCoreElement().readOnly},setter:function(r){this.getCoreElement().readOnly=r}})},getTextSelectable:function(){return!0},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.FORMCONTROL},doBindElement:function(r){this.tryApplySuper("doBindElement",[r]);var a=this.getCoreElement();if(a){var o=Kekule.Browser.IE&&Kekule.Browser.IEVersion===8;Kekule.X.Event.addListener(a,"change",this.reactValueChangeBind),Kekule.X.Event.addListener(a,"input",this.reactInputBind),o?(this._bindKeyupEvent=!0,Kekule.X.Event.addListener(a,"keyup",this.reactInputBind)):this._bindKeyupEvent=!1}},doUnbindElement:function(r){var a=this.getCoreElement();a&&(Kekule.X.Event.removeListener(a,"change",this.reactValueChangeBind),Kekule.X.Event.removeListener(a,"input",this.reactInputBind),this._bindKeyupEvent&&Kekule.X.Event.removeListener(a,"keyup",this.reactInputBind)),this.tryApplySuper("doUnbindElement",[r])},notifyValueChanged:function(){this.setIsDirty(!0),this.invokeEvent("valueChange",{widget:this,value:this.getValue()})},selectAll:function(){var r=this.getCoreElement();return r&&r.select&&r.select(),this},reactValueChange:function(){this.notifyValueChanged()},reactInput:function(r){this.setIsDirty(!0),this.invokeEvent("valueInput",{widget:this,value:this.getValue()})}}),Kekule.Widget.CheckBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.CheckBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(r,a){this.tryApplySuper("initialize",[r]),Kekule.ObjUtils.notUnset(a)&&this.setChecked(!!a)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,getter:function(){var r=this.getCoreElement();return!!r&&r.checked},setter:function(r){var a=this.getCoreElement();a&&(a.checked=!!r)}}),this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.DomUtils.getElementText(this.getLabelElem())},setter:function(r){Kekule.DomUtils.setElementText(this.getLabelElem(),r)}})},getCoreElement:function(){return this.getInputElem()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.CHECKBOX},getInputElem:function(){var r=this.getElement();if(r){var a=r.getElementsByTagName("input");if(a&&a.length)return a[0]}return null},getLabelElem:function(){var r=this.getElement();if(r){if(r.tagName.toLowerCase()==="label")return r;var a=r.getElementsByTagName("label");if(a&&a.length)return a[0]}return null},doCreateRootElement:function(r){return r.createElement("span")},doCreateSubElements:function(r,a){var o=r.createElement("label");a.appendChild(o);var l=r.createElement("input");return l.setAttribute("type","checkbox"),o.appendChild(l),[o,l]}}),Kekule.Widget.TextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextBox",BINDABLE_TAG_NAMES:["input"],initialize:function(r,a){this.tryApplySuper("initialize",[r]),a&&this.setText(a)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getElement().value},setter:function(r){this.getElement().value=r||""}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(r){this.getElement().placeholder=r}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.TEXTBOX},doCreateRootElement:function(r){return r.createElement("input")},doBindElement:function(r){this.tryApplySuper("doBindElement",[r]),r.setAttribute("type","text")}}),Kekule.Widget.ComboTextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboTextBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(r,a){this.tryApplySuper("initialize",[r]),a&&this.setText(a)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var r=this.getTextBox();return r?r.getText():null},setter:function(r){var a=this.getTextBox();a&&a.setText(r)}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getTextBox().getPlaceholder()},setter:function(r){this.getTextBox().setPlaceholder(r)}}),this.defineProp("overlapOnTextBox",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("overlapOnTextBox",r),r?this.addClassName(n.OVERLAP):this.removeClassName(n.OVERLAP),this.adjustWidgetsSize()}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null}),this.defineProp("headingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(r){var a=this.getHeadingWidget();if(r!==a&&(this.setPropStoreFieldValue("headingWidget",r),a&&(a.setParent(null),a.removeClassName(n.COMBOTEXTBOX_ASSOC_WIDGET)),r)){var o=this.getTextBox()?this.getTextBox().getElement():this.getTailingWidget()?this.getTailingWidget().getElement():null;r.setParent(this),r.addClassName(n.COMBOTEXTBOX_ASSOC_WIDGET),r.insertToElem(this.getElement(),o)}}}),this.defineProp("tailingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:function(r){var a=this.getTailingWidget();r!==a&&(this.setPropStoreFieldValue("tailingWidget",r),a&&(a.setParent(null),a.removeClassName(n.COMBOTEXTBOX_ASSOC_WIDGET)),r&&(r.setParent(this),r.addClassName(n.COMBOTEXTBOX_ASSOC_WIDGET),r.appendToElem(this.getElement())))}})},finalize:function(){this._finalizeSubWidgets(),this.tryApplySuper("finalize")},_finalizeSubWidgets:function(){var r,a=this.getTextBox();a&&a.finalize(),(r=this.getHeadingWidget())&&r.finalize(),(r=this.getTailingWidget())&&r.finalize()},getCoreElement:function(){var r=this.getTextBox();return r?r.getElement():this.tryApplySuper("getCoreElement")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.COMBOTEXTBOX},doCreateRootElement:function(r){return r.createElement("span")},doCreateSubElements:function(r,a){var o=this.tryApplySuper("doCreateSubElements",[r,a]);this._finalizeSubWidgets();var l=new Kekule.Widget.TextBox(this);return l.addClassName(n.TEXTBOX),l.appendToElem(this.getElement()),this.setPropStoreFieldValue("textBox",l),o.push(l.getElement()),o},elementBound:function(r){this.setObserveElemResize(!0)},relayEvent:function(r,a){var o=a.widget;return o!==this.getTextBox()&&o!==this.getHeadingWidget()&&o!==this.getTailingWidget()||(a.widget=this),this.tryApplySuper("relayEvent",[r,a])},doSetEnabled:function(r){var a=this.getTextBox();a&&a.setEnabled(r);var o=this.getHeadingWidget();o&&o.setEnabled(r),(o=this.getTailingWidget())&&o.setEnabled(r)},doResize:function(){this.adjustWidgetsSize()},widgetShowStateChanged:function(r,a){this.tryApplySuper("widgetShowStateChanged",[r,a]),r&&this.adjustWidgetsSize()},doInsertedToDom:function(){this.isShown()&&this.adjustWidgetsSize()},assocWidgetChanged:function(){this.adjustWidgetsSize()},adjustWidgetsSize:function(){var r=Kekule.StyleUtils,a=this.getOverlapOnTextBox(),o=a?"absolute":"relative",l=this.getTextBox().getElement();if(l){var u,c,d,h=Kekule.HtmlElementUtils.getElemPageRect(l);if((c=(u=this.getHeadingWidget())?u.getElement():null)&&u.isShown())if((d=c.style).position=o,a){var p=Kekule.HtmlElementUtils.getElemPageRect(c);d.left=0,d.top=(h.height-p.height)/2+"px",l.style.paddingLeft=p.width+"px"}else r.removeStyleProperty(d,"left"),r.removeStyleProperty(d,"top"),r.removeStyleProperty(l.style,"paddingLeft");else r.removeStyleProperty(l.style,"paddingLeft");(c=(u=this.getTailingWidget())?u.getElement():null)&&u.isShown()?((d=c.style).position=o,a?(p=Kekule.HtmlElementUtils.getElemPageRect(c),d.right=0,d.top=(h.height-p.height)/2+"px",l.style.paddingRight=p.width+"px"):(r.removeStyleProperty(d,"right"),r.removeStyleProperty(d,"top"),r.removeStyleProperty(l.style,"paddingRight"))):r.removeStyleProperty(l.style,"paddingRight")}}}),Kekule.Widget.ButtonTextBox=Class.create(Kekule.Widget.ComboTextBox,{CLASS_NAME:"Kekule.Widget.ButtonTextBox",initialize:function(r,a){this.tryApplySuper("initialize",[r,a]),this.setOverlapOnTextBox(!0)},initProperties:function(){this.defineProp("button",{dataType:"Kekule.Widget.Button",serializable:!1,setter:null,getter:function(){return this.getTailingWidget()}}),this.defineProp("buttonKind",{dataType:DataType.STRING,getter:function(){return this.getButton().getButtonKind()},setter:function(r){this.getButton().setButtonKind(r)}}),this.defineProp("buttonText",{dataType:DataType.STRING,getter:function(){return this.getButton().getText()},setter:function(r){this.getButton().setText(r).setShowText(!!r)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.BUTTONTEXTBOX},doCreateSubElements:function(r,a){var o=this.tryApplySuper("doCreateSubElements",[r,a]),l=this.createAssocButton();return l&&o.push(l.getElement()),o},createAssocButton:function(){var r=new Kekule.Widget.Button(this);return r.setShowText(!1),this.setTailingWidget(r),r.addEventListener("change",this.adjustWidgetsSize,this),r.addEventListener("execute",function(a){this.invokeEvent("buttonExecute",{widget:this})},this),r},execBtn:function(r){var a=this.getButton();if(a)return a.execute(r),!0},react_keypress:function(r){r.getKeyCode()===13&&this.execBtn(r)},react_keydown:function(r){if(this.getButtonKind()===Kekule.Widget.Button.Kinds.DROPDOWN){var a=Kekule.X.Event.KeyCode;r.getKeyCode()===a.DOWN&&this.execBtn(r)}}}),Kekule.Widget.TextArea=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextArea",BINDABLE_TAG_NAMES:["textarea"],initialize:function(r,a){this.tryApplySuper("initialize",[r]),a&&this.setText(a)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getValue()},setter:function(r){this.setValue(r),this.adjustAutoSize()}}),this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(r){this.getElement().placeholder=r}}),this.defineProp("autoSizeX",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("autoSizeX",r),this._autoSizeChanged()}}),this.defineProp("autoSizeY",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("autoSizeY",r),this._autoSizeChanged()}}),this.defineProp("wrap",{dataType:DataType.STRING,getter:function(){return this.getElement().wrap},setter:function(r){this.getElement().wrap=r}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.TEXTAREA},doCreateRootElement:function(r){return r.createElement("textarea")},doBindElement:function(r){this.tryApplySuper("doBindElement",[r]),this.adjustAutoSize()},setValue:function(r){this.tryApplySuper("setValue",[r]),this.adjustAutoSize()},widgetShowStateChanged:function(r,a){this.tryApplySuper("widgetShowStateChanged",[r,a]),r&&this.adjustAutoSize()},doFileDragDrop:function(r){if(r){if(Kekule.BrowserFeature.fileapi){var a=this,o=new FileReader;o.onload=function(l){var u=o.result;a.setText(u)},o.readAsText(r[0])}return!0}return this.tryApplySuper("doFileDragDrop")},reactValueChange:function(){this.adjustAutoSize(),this.tryApplySuper("reactValueChange")},react_keyup:function(){this.adjustAutoSize()},react_keypress:function(){this.adjustAutoSize()},doWidgetShowStateChanged:function(r){r&&this.adjustAutoSize()},_autoSizeChanged:function(){var r=this.getCoreElement().style;this.getAutoSizeX()?(r.overflowX="hidden",this.setWrap("off")):(r.overflowX="auto",this.setWrap("")),this.getAutoSizeY()?r.overflowY="hidden":r.overflowY="auto",this.adjustAutoSize()},adjustAutoSize:function(){(this.getAutoSizeX()||this.getAutoSizeY())&&this.adjustSizeByContent()},adjustSizeByContent:function(){var r=this.getCoreElement(),a=!this.getText(),o=r.style;this.getAutoSizeX()&&(o.width="1px"),this.getAutoSizeY()&&(o.height="1px");var l=Kekule.HtmlElementUtils.getElemScrollDimension(r),u=Kekule.HtmlElementUtils.getElemClientDimension(r);this.getAutoSizeX()&&(a?o.width="1em":l.width>u.width&&(o.width=l.width+"px")),this.getAutoSizeY()&&(a&&(o.height="1em"),l.height>u.height&&(o.height=l.height+"px"))}}),Kekule.Widget.SelectBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.SelectBox",BINDABLE_TAG_NAMES:["select"],ITEM_DATA_FIELD:"__$item_data__",ITEM_VALUE_FIELD:"__$item_value__",initialize:function(r,a){this.tryApplySuper("initialize",[r]),a&&this.setItems(a)},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){for(var r=this.getAllItemElems(),a=[],o=0,l=r.length;o<l;++o){var u=r[o],c=this._getBoxItemInfo(u);a.push(c)}return a},setter:function(r){var a=this.getElement();if(this.clear(),r)for(var o=Kekule.ArrayUtils.toArray(r),l=0,u=o.length;l<u;++l){var c=o[l];if(c){var d=this._createBoxItemElem(a);this._setBoxItemInfo(d,c)}}}}),this.defineProp("index",{dataType:DataType.INT,getter:function(){return this.getElement().selectedIndex},setter:function(r){this.getElement().selectedIndex=r}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.SELECTBOX},doCreateRootElement:function(r){return r.createElement("select")},_createBoxItemElem:function(r,a){var o=r.ownerDocument.createElement("option");return a?r.insertBefore(o,a):r.appendChild(o),o},doBindElement:function(r){this.tryApplySuper("doBindElement",[r])},doGetValue:function(){var r=this.getSelectedItemElem();return r?this._getBoxItemInfo(r).value:void 0},doSetValue:function(r){for(var a=this.getAllItemElems(),o=0,l=a.length;o<l;++o){var u=a[o];if(this._getBoxItemInfo(u).value===r)return void this.setIndex(o)}this.setIndex(-1)},getAllItemElems:function(){return e.getDirectChildElems(this.getElement(),"option")},getSelectedItemElem:function(){for(var r=this.getAllItemElems(),a=0,o=r.length;a<o;++a){var l=r[a];if(l.selected)return l}return null},getItemData:function(r){var a=this._getBoxItemInfo(r);return a&&a.data},getSelectedItemData:function(){var r=this.getSelectedItemElem();return r&&this.getItemData(r)},clear:function(){this.getElement().innerHTML=""},dropDown:function(){this.getDocument(),this.getElement();var r=this.getDocument().createEvent("MouseEvents");r.initEvent("mousedown",!0,!0),this.getElement().dispatchEvent(r)},_getBoxItemInfo:function(r){var a={};return a.text=t.getInnerText(r),a.value=r[this.ITEM_VALUE_FIELD],i.notUnset(r.title)&&(a.title=r.title),i.notUnset(r[this.ITEM_DATA_FIELD])&&(a.data=r[this.ITEM_DATA_FIELD]),a},_setBoxItemInfo:function(r,a){DataType.isSimpleValue(a)&&(a={value:a});var o=a.text||a.value;return i.notUnset(o)&&Kekule.DomUtils.setElementText(r,o),r.value=""+a.value,r[this.ITEM_VALUE_FIELD]=a.value,i.notUnset(a.title)&&(r.title=a.title),i.notUnset(a.data)&&(r[this.ITEM_DATA_FIELD]=a.data),a.selected?r.setAttribute("selected","selected"):r.selected=!1,this}}),Kekule.Widget.ComboBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function(r){this.tryApplySuper("initialize",[r])},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var r=this.getTextBox();return r?r.getText():null},setter:function(r){var a=this.getTextBox();a&&(a.setText(r),this.textChanged())}}),this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var r=this.getSelectBox();return r?r.getItems():null},setter:function(r){var a=this.getSelectBox();a&&a.setItems(r)}}),this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("selectBox",{dataType:"Kekule.Widget.SelectBox",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},finalize:function(){this._finalizeSubElements(),this.tryApplySuper("finalize")},_finalizeSubElements:function(){var r=this.getTextBox();r&&r.finalize();var a=this.getSelectBox();a&&a.finalize()},getCoreElement:function(){var r=this.getTextBox();return r?r.getElement():this.tryApplySuper("getCoreElement")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.COMBOBOX},doCreateRootElement:function(r){return r.createElement("span")},doCreateSubElements:function(r,a){var o=this;this._finalizeSubElements();var l=r.createElement("span");l.className=n.COMBOBOX_TEXTWRAPPER,a.appendChild(l);var u=new Kekule.Widget.TextBox(this);u.appendToElem(l),this.setPropStoreFieldValue("textBox",u);var c=new Kekule.Widget.SelectBox(this);return c.appendToElem(a),this.setPropStoreFieldValue("selectBox",c),c.addEventListener("valueChange",function(d){var h=c.getSelectedItemElem();if(h){var p=h.value,g=h.text||h.value;g!==u.getText()&&(u.setText(g),o.notifyValueChanged()),u.selectAll(),u.focus(),o.invokeEvent("valueSelect",{widget:o,value:p})}}),u.addEventListener("valueChange",function(d){o.textChanged()}),Kekule.X.Event.addListener(u.getElement(),"keydown",function(d){d.getKeyCode()===Kekule.X.Event.KeyCode.DOWN&&c.dropDown()}),[l]},relayEvent:function(r,a){var o=a.widget;if(o!==this.getTextBox()&&o!==this.getSelectBox()||(a.widget=this,r!=="valueChange"))return this.tryApplySuper("relayEvent",[r,a])},textChanged:function(){var r=this.getText(),a=this._getValueOfText(r);this.getSelectBox().setValue(a)},_getValueOfText:function(r){for(var a=this.getSelectBox().getItems(),o=0,l=a.length;o<l;++o){var u=a[o];if(u.text&&u.text===r)return u.value}return r},doSetEnabled:function(r){var a=this.getTextBox();a&&a.setEnabled(r);var o=this.getSelectBox();o&&o.setEnabled(r)},doGetValue:function(){var r=this.tryApplySuper("doGetValue");return this._getValueOfText(r)},doSetValue:function(r){var a=r,o=this.getSelectBox().getItems();this.getSelectBox().setIndex(-1);for(var l=0,u=o.length;l<u;++l){var c=o[l];if(c.value===r){a=c.text||c.value,this.getSelectBox().setIndex(l);break}}this.tryApplySuper("doSetValue",[a])}}),Kekule.Widget.NumInput=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.NumInput",BINDABLE_TAG_NAMES:["input"],DEF_MIN_VALUE:0,DEF_MAX_VALUE:100,DEF_STEP:1,initialize:function(r,a,o,l,u){this.tryApplySuper("initialize",[r]),i.notUnset(a)&&this.setMinValue(a),i.notUnset(o)&&this.setMaxValue(o),i.notUnset(l)&&this.setStep(l),u&&this.setControlType(u)},initProperties:function(){this.defineProp("minValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().min)||null},setter:function(r){this.getElement().min=r}}),this.defineProp("maxValue",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().max)||null},setter:function(r){this.getElement().max=r}}),this.defineProp("step",{dataType:DataType.NUMBER,getter:function(){return parseFloat(this.getElement().step)||null},setter:function(r){this.getElement().step=r}}),this.defineProp("controlType",{dataType:DataType.STRING,getter:function(){return this.getElement().getAttribute("type")},setter:function(r){this.getElement().setAttribute("type",r)}})},doGetValue:function(){var r=this.tryApplySuper("doGetValue");return r?parseFloat(r):0},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.NUMINPUT},doCreateRootElement:function(r){return r.createElement("input")},doBindElement:function(r){this.tryApplySuper("doBindElement",[r]),r.setAttribute("type","range")}})}(),function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{STATE_COLLAPSED:"K-State-Collapsed",STATE_EMPTY:"K-State-Empty",NESTED_CONTAINER:"K-NestedContainer",NESTED_CONTAINER_ITEM:"K-NestedContainer-Item"}),Kekule.Widget.NestedContainer=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.NestedContainer",DEF_CONTAINER_TAG:"ul",DEF_ITEM_TAG:"li",ITEM_DATA_FIELD:"__$itemData__",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){this.defineProp("itemInitialExpanded",{dataType:DataType.BOOL})},doCreateRootElement:function(e){return e.createElement("div")},doBindElement:function(e){this.tryApplySuper("doBindElement",[e])},getContainerElemTag:function(){return this.DEF_CONTAINER_TAG},getItemElemTag:function(){return this.DEF_ITEM_TAG},_createChildItemElem:function(){var e=this.doCreateChildItemElem();return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM),Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.STATE_EMPTY),e},doCreateChildItemElem:function(){return this.getDocument().createElement(this.getItemElemTag())},_createChildContainerElem:function(){var e=this.doCreateChildContainerElem();return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER),e},doCreateChildContainerElem:function(){return this.getDocument().createElement(this.getContainerElemTag())},getChildContainerElem:function(e,t){e||(e=this.getElement());var n=e.getElementsByTagName(this.getContainerElemTag()),i=n.length?n[0]:null;return!i&&t&&(i=this._createChildContainerElem(),e.appendChild(i)),i},getItemData:function(e){return e[this.ITEM_DATA_FIELD]},setItemData:function(e,t){this.doSetItemData(e,t),e[this.ITEM_DATA_FIELD]=t;var n=t.children;if(n&&Kekule.ArrayUtils.isArray(n)){this.clearChildItems(e);for(var i=0,r=n.length;i<r;++i){var a=n[i];this.appendChildItem(e,a)}}return this},doSetItemData:function(e,t){},hasChildItem:function(e){return this.getChildItemCount(e)>0},getChildItemCount:function(e){return this.getChildren(e).length},getChildren:function(e){var t=this.getChildContainerElem(e);return t?Kekule.DomUtils.getDirectChildElems(t,this.getItemElemTag()):[]},getChildItemAt:function(e,t){var n=this.getChildren(e);return n.length&&n.length>t?n[t]:null},insertChildItem:function(e,t,n){var i=this.getChildContainerElem(e,!0);if(t&&Kekule.DomUtils.isElement(t))r=t;else{var r=this._createChildItemElem();this.getItemInitialExpanded()||Kekule.HtmlElementUtils.addClass(r,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),t&&this.setItemData(r,t)}var a=DataType.isSimpleType(n)?this.getChildren(e)[n]:n;return a?i.insertBefore(r,a):i.appendChild(r),this.childItemsChanged(e),r},appendChildItem:function(e,t){return this.insertChildItem(e,t)},removeChildItem:function(e,t){var n=this.getChildContainerElem(e);return n&&(n.removeChild(t),this.hasChildItem(e)||e.removeChild(n),this.childItemsChanged(e)),this},removeChildItemAt:function(e,t){var n=this.getChildItemAt(e,t);return n&&this.removeChildItem(e,n),this},clearChildItems:function(e){var t=this.getChildContainerElem(e);e||(e=this.getElement()),t&&e.removeChild(t),this.childItemsChanged(e)},childItemsChanged:function(e){if(e){var t=Kekule.Widget.HtmlClassNames.STATE_EMPTY;this.hasChildItem(e)?Kekule.HtmlElementUtils.removeClass(e,t):Kekule.HtmlElementUtils.addClass(e,t)}},expandItem:function(e){return Kekule.HtmlElementUtils.removeClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},collapseItem:function(e){return Kekule.HtmlElementUtils.addClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},toggleExpandStateOfItem:function(e){return Kekule.HtmlElementUtils.toggleClass(e,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED),this},isChildItem:function(e){return Kekule.HtmlElementUtils.hasClass(e,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM)},getBelongedChildItem:function(e){for(var t=e,n=this.getElement(),i=this.getDocument().body;t!==n&&t!==i;)if(t=t.parentNode,this.isChildItem(t))return t;return null},getAllChildItems:function(e){var t=[],n=this.getChildContainerElem(e,!1);if(n)for(var i=Kekule.DomUtils.getDirectChildElems(n),r=0,a=i.length;r<a;++r){var o=i[r];if(this.isChildItem(o)){t.push(o);var l=this.getAllChildItems(o);t=t.concat(l)}}return t},getChildItemRange:function(e,t,n){var i=this.getAllChildItems(n),r=i.indexOf(e),a=i.indexOf(t);if(r>=0&&a>=0){if(r>a){var o=!0,l=r;r=a,a=l}var u=i.slice(r,a+1);return o&&(u=u.reverse()),u}return[]}})}(),function(){Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TREEVIEW:"K-TreeView",TREEVIEW_EXPANDMARK:"K-TreeView-ExpandMark",TREEVIEW_ITEMCONTENT:"K-TreeView-ItemContent"}),Kekule.Widget.TreeView=Class.create(Kekule.Widget.NestedContainer,{CLASS_NAME:"Kekule.Widget.TreeView",BELONGED_ITEM_FIELD:"__$treeItem__",initProperties:function(){this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var t=this.getPropStoreFieldValue("selection");return t||(t=[],this.setPropStoreFieldValue("selection",t)),t},setter:function(t){this.select(t)}}),this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var t=this.getSelection();return t.length?t[t.length-1]:null},setter:function(t){this.select(t)}}),this.defineProp("autoScrollToSelected",{dataType:DataType.BOOL}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TREEVIEW},doCreateChildItemElem:function(){var t=this.tryApplySuper("doCreateChildItemElem");if(t){var n=this.createGlyphContent(t,null,e.TREEVIEW_EXPANDMARK);n[this.BELONGED_ITEM_FIELD]=t,t._expandMarkerElem=n;var i=this.getDocument().createElement("span");i.className=e.TREEVIEW_ITEMCONTENT,t.appendChild(i),i[this.BELONGED_ITEM_FIELD]=t,t._contentElem=i}return t},doSetItemData:function(t,n){this.setItemText(t,n.text)},getExpandMarkerElem:function(t){return t._expandMarkerElem},getItemContentElem:function(t){return t._contentElem},getTextPartElem:function(t,n){var i=t._textPartElem;return!i&&n&&(i=this.createTextContent("",this.getItemContentElem(t)),t._textPartElem=i),i},setItemText:function(t,n){this.getTextPartElem(t,!0).innerHTML=n},isItemSelected:function(t){var n=this.getSelection();return!!n&&n.indexOf(t)>=0},selectionChanged:function(){if(this.getAutoScrollToSelected()){var t=this.getSelectedItem();t&&t.scrollIntoView&&t.scrollIntoViewIfNeeded()}this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange",{selection:this.getSelection(),selectedItem:this.getSelectedItem()})},clearSelection:function(){var t=this.getSelection();if(t.length){for(var n=0,i=t.length;n<i;++n){var r=t[n];Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(r),e.STATE_SELECTED)}this.setPropStoreFieldValue("selection",[]),this.selectionChanged()}return this},removeFromSelection:function(t){if(t){var n=Kekule.ArrayUtils.toArray(t);if(n&&n.length){for(var i=this.getSelection(),r=0,a=n.length;r<a;++r){var o=n[r];Kekule.ArrayUtils.remove(i,o)&&Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(o),e.STATE_SELECTED)}this.selectionChanged()}}return this},addToSelection:function(t){if(t){var n=Kekule.ArrayUtils.toArray(t);if(n&&n.length){this.getEnableMultiSelect()||(this.clearSelection(),n=[n[n.length-1]]);for(var i=this.getSelection(),r=0,a=n.length;r<a;++r){var o=n[r];this.isItemSelected(o)||(Kekule.HtmlElementUtils.addClass(this.getItemContentElem(o),e.STATE_SELECTED),i.push(o))}this.selectionChanged()}}return this},toggleSelectionState:function(t){if(t){this.beginUpdate();try{var n=Kekule.ArrayUtils.toArray(t);if(this.getSelection(),n&&n.length)for(var i=0,r=n.length;i<r;++i){var a=n[i];this.isItemSelected(a)?this.removeFromSelection(a):this.addToSelection(a)}}finally{this.endUpdate()}}},select:function(t,n){this.beginUpdate();try{if(this.clearSelection(),t)if(this.getEnableMultiSelect())this.addToSelection(t);else{var i=Kekule.ArrayUtils.toArray(t);this.addToSelection(i[i.length-1])}}finally{this.endUpdate()}},react_click:function(t){var n=t.getTarget(),i=n[this.BELONGED_ITEM_FIELD];if(i&&this.isChildItem(i))this.toggleExpandStateOfItem(i);else if(i=this.getBelongedChildItem(n),t.getShiftKey()){var r=this.getSelectedItem();if(r){var a=this.getChildItemRange(r,i);a.length&&(t.getCtrlKey()?this.addToSelection(a):this.select(a))}else this.select(i)}else t.getCtrlKey()?this.toggleSelectionState(i):i&&this.select(i)},react_dblclick:function(t){var n=t.getTarget(),i=this.getBelongedChildItem(n);i&&this.toggleExpandStateOfItem(i)}})}(),function(){var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,n=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{LISTVIEW:"K-ListView",LISTVIEW_ITEM_HOLDER:"K-ListView-ItemHolder",LISTVIEW_ITEM:"K-ListView-Item",LISTVIEW_ITEMCONTENT:"K-ListView-ItemContent"}),Kekule.Widget.ListView=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ListView",ITEM_DATA_FIELD:"__$itemData__",initialize:function(i){this.setPropStoreFieldValue("enableSelect",!0),this.setPropStoreFieldValue("enableMultiSelect",!0),this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:!1,getter:function(){for(var i=[],r=e.getDirectChildElems(this.getChildrenHolderElement()),a=0,o=r.length;a<o;++a){var l=r[a];this.isChildItemElem(l)&&i.push(l)}return i}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("enableSelect",i),i||this.clearSelection()}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("enableMultiSelect",i),i||this.clearSelection()}}),this.defineProp("enableSelectInSelection",{dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("enableSelectInSelection",i);var r=this.getSelectedItem();r&&(i?t.addClass(r,n.STATE_CURRENT_SELECTED):t.removeClass(r,n.STATE_CURRENT_SELECTED))}}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var i=this.getPropStoreFieldValue("selection");return i||(i=[],this.setPropStoreFieldValue("selection",i)),i},setter:function(i){this.select(i)}}),this.defineProp("currSelectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getSelectedItem()},setter:function(i){this.setSelectedItem(i)}}),this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var i=this.getSelection();return i.length?i[i.length-1]:null},setter:function(i){var r=this.getBelongedChildItem(i);if(r)if(this.getEnableSelectInSelection()){var a=this.getSelection(),o=a.indexOf(r);o>=0?(this.prepareChangingSelection(),a.splice(o,1),a.push(r),this.selectionChanged()):this.select(r)}else this.select(r);else this.clearSelection()}})},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[]);return this._holderElem=i.createElement("ul"),this._holderElem.className=n.LISTVIEW_ITEM_HOLDER,r.appendChild(this._holderElem),a=a.concat(this._holderElem)},getChildrenHolderElement:function(){return this._holderElem},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.LISTVIEW},doCreateRootElement:function(i){return i.createElement("ul")},getItemClassName:function(){return n.LISTVIEW_ITEM},createChildItem:function(i){var r=this.doCreateChildItem(i);return r&&(t.addClass(r,this.getItemClassName()),i&&this.setItemData(r,i)),r},doCreateChildItem:function(i){return this.getDocument().createElement("li")},getItemData:function(i){return i[this.ITEM_DATA_FIELD]},setItemData:function(i,r){return this.doSetItemData(i,r),i[this.ITEM_DATA_FIELD]=r,this},doSetItemData:function(i,r){r&&(r.text&&e.setElementText(i,r.text),r.hint&&i.setAttribute("title",r.hint))},isChildItemElem:function(i){return i.parentNode===this.getChildrenHolderElement()&&t.hasClass(i,n.LISTVIEW_ITEM)},getBelongedChildItem:function(i){return e.isDescendantOf(i,this.getElement())?this.isChildItemElem(i)?i:this.getBelongedChildItem(i.parentNode):null},getAllChildItems:function(){for(var i=[],r=e.getDirectChildElems(this.getChildrenHolderElement()),a=0,o=r.length;a<o;++a){var l=r[a];this.isChildItemElem(l)&&i.push(l)}return i},getChildItemElemRange:function(i,r){var a=this.getAllChildItems(),o=a.indexOf(i),l=a.indexOf(r);if(o>=0&&l>=0){if(o>l){var u=!0,c=o;o=l,l=c}var d=a.slice(o,l+1);return u&&(d=d.reverse()),d}return[]},indexOfItem:function(i){var r=-1,a=this.getBelongedChildItem(i);return a&&(r=this.getAllChildItems().indexOf(a)),r},getItemAt:function(i){return this.getAllChildItems()[i]},_itemBeforeInsert:function(i){},_itemInserted:function(i){t.addClass(i,this.getItemClassName())},_itemBeforeRemove:function(i){this.isItemSelected(i)&&this.removeFromSelection(i),t.removeClass(i,this.getItemClassName())},_itemRemoved:function(i){},appendItem:function(i){return i?e.isElement(i)||(i=this.createChildItem(i)):i=this.createChildItem(),this._itemBeforeInsert(i),this.getChildrenHolderElement().appendChild(i),this._itemInserted(i),i},insertItemBefore:function(i,r){i?e.isElement(i)||(i=this.createChildItem(i)):i=this.createChildItem();var a=r&&this.getBelongedChildItem(r);return a?(this._itemBeforeInsert(i),this.getChildrenHolderElement().insertBefore(i,a),this._itemInserted(i),i):this.appendItem(i)},removeItem:function(i){var r=this.getBelongedChildItem(i);return this._itemBeforeRemove(r),this.getChildrenHolderElement().removeChild(r),this._itemRemoved(r),i},removeItems:function(i){for(var r=i.length-1;r>=0;--r)this.removeItem(i[r]);return this},clearItems:function(){this.select();var i=this.getItems();return this.removeItems(i),this},isItemSelected:function(i){var r=this.getSelection();return!!r&&r.indexOf(i)>=0},prepareChangingSelection:function(){this._prevSelectedItem=this.getSelectedItem()},selectionChanged:function(i,r){var a={selection:this.getSelection(),selectedItem:this.getSelectedItem(),added:i,removed:r},o=this.getSelectedItem();this._prevSelectedItem&&this._prevSelectedItem!==o&&(a.prevSelectedItem=this._prevSelectedItem,t.removeClass(this._prevSelectedItem,n.STATE_CURRENT_SELECTED),this._prevSelectedItem=null),o&&this.getEnableSelectInSelection()&&t.addClass(o,n.STATE_CURRENT_SELECTED),this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange",a)},clearSelection:function(){var i=this.getSelection();return i.length&&(this.prepareChangingSelection(),this.doClearSelection(),this.selectionChanged(null,i)),this},doClearSelection:function(){var i=this.getSelection();if(i.length){for(var r=0,a=i.length;r<a;++r){var o=this.getBelongedChildItem(i[r]);t.removeClass(o,[n.STATE_SELECTED,n.STATE_CURRENT_SELECTED])}this.setPropStoreFieldValue("selection",[])}},removeFromSelection:function(i){if(i){var r=[],a=Kekule.ArrayUtils.toArray(i);if(a&&a.length){var o=this.getSelection();this.prepareChangingSelection();for(var l=0,u=a.length;l<u;++l){var c=a[l];Kekule.ArrayUtils.remove(o,c)&&(t.removeClass(this.getBelongedChildItem(c),[n.STATE_SELECTED,n.STATE_CURRENT_SELECTED]),r.push(c))}this.selectionChanged(null,r)}}return this},addToSelection:function(i){if(i){var r=Kekule.ArrayUtils.toArray(i);if(r&&r.length){this.prepareChangingSelection();var a=this.doAddToSelection(r);this.selectionChanged(a)}}return this},doAddToSelection:function(i){var r=[],a=Kekule.ArrayUtils.toArray(i);if(a&&a.length){this.getEnableMultiSelect()||this.clearSelection();for(var o=this.getSelection(),l=0,u=a.length;l<u;++l){var c=a[l];this.isItemSelected(c)||(t.addClass(this.getBelongedChildItem(c),n.STATE_SELECTED),o.splice(o.length-1,0,c),r.push(c))}}return r},toggleSelectionState:function(i){if(i){this.beginUpdate();try{var r=Kekule.ArrayUtils.toArray(i);if(this.getSelection(),r&&r.length)for(var a=0,o=r.length;a<o;++a){var l=r[a];this.isItemSelected(l)?this.removeFromSelection(l):this.addToSelection(l)}}finally{this.endUpdate()}}},select:function(i){this.beginUpdate();try{if(this.getSelection().length&&this.clearSelection(),i){var r=Kekule.ArrayUtils.toArray(i),a=this.getEnableMultiSelect()?r:r[r.length-1];this.addToSelection(a)}}finally{this.endUpdate()}},react_click:function(i){if(this.getEnableSelect()){var r=i.getTarget(),a=this.getBelongedChildItem(r);if(a)if(this.getEnableMultiSelect())if(i.getShiftKey()){var o=this.getSelectedItem();if(o){var l=this.getChildItemElemRange(o,a);l.length&&(i.getCtrlKey()?this.addToSelection(l):this.select(l))}else this.select(a)}else i.getCtrlKey()?this.toggleSelectionState(a):a&&(this.getEnableSelectInSelection()&&this.isItemSelected(a)?this.setSelectedItem(a):this.select(a));else this.select(a);else this.select(null)}return this.tryApplySuper("react_click",[i])}})}(),function(){var e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.StyleUtils),n=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DIALOG:"K-Dialog",DIALOG_INSIDE:"K-Dialog-Inside",DIALOG_OVERFLOW:"K-Dialog-Overflow",DIALOG_CLIENT:"K-Dialog-Client",DIALOG_CAPTION:"K-Dialog-Caption",DIALOG_BTN_PANEL:"K-Dialog-Button-Panel"}),Kekule.Widget.DialogButtons={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no",isPositive:function(i){var r=Kekule.Widget.DialogButtons;return[r.OK,r.YES].indexOf(i)>=0},isNegative:function(i){var r=Kekule.Widget.DialogButtons;return[r.CANCEL,r.NO].indexOf(i)>=0}},Kekule.Widget.Location={DEFAULT:1,CENTER:2,FULLFILL:3,CENTER_OR_FULLFILL:4},Kekule.Widget.Dialog=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Dialog",BINDABLE_TAG_NAMES:["div","span"],BTN_NAME_FIELD:"__$btnName__",initialize:function(i,r,a){this._dialogCallback=null,this._modalInfo=null,this._childButtons=[],this.setPropStoreFieldValue("location",Kekule.Widget.Location.CENTER),this.tryApplySuper("initialize",[i]),this._dialogOpened=!1,this.setUseCornerDecoration(!0),r&&this.setCaption(r),a&&this.setButtons(a),this.setDisplayed(!1)},doFinalize:function(){this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return e.getElementText(this.getCaptionElem())},setter:function(i){e.setElementText(this.getCaptionElem(),i),t.setDisplay(this.getCaptionElem(),!!i)}}),this.defineProp("buttons",{dataType:DataType.ARRAY,setter:function(i){this.setPropStoreFieldValue("buttons",i),this.getBtnPanelElem()&&t.setDisplay(this.getBtnPanelElem(),i&&i.length),this.buttonsChanged()}}),this.defineProp("result",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("location",{dataType:DataType.INT}),this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("btnPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMovable&&this.setMovable(!0)},getDefaultMovingGripper:function(){return this.getCaptionElem()},getCoreElement:function(){return this.getClientElem()},doGetWidgetClassName:function(){return n.DIALOG},doCreateRootElement:function(i){return i.createElement("div")},doCreateSubElements:function(i,r){var a,o=[];return(a=i.createElement("div")).className=n.DIALOG_CAPTION,r.appendChild(a),this.setPropStoreFieldValue("captionElem",a),o.push(a),this.setMovingGripper&&this.setMovingGripper(a),(a=i.createElement("div")).className=n.DIALOG_CLIENT,r.appendChild(a),this.setPropStoreFieldValue("clientElem",a),this.doCreateClientContents(a),o.push(a),(a=i.createElement("div")).className=n.DIALOG_BTN_PANEL,r.appendChild(a),this.setPropStoreFieldValue("btnPanelElem",a),o.push(a),this.buttonsChanged(),o},doCreateClientContents:function(i){},buttonsChanged:function(){for(var i=this._childButtons.length-1;i>=0;--i)this._childButtons[i].finalize();for(var r=this.getButtons()||[],a=(i=0,r.length);i<a;++i)this.createDialogButton(r[i])},createDialogButton:function(i,r,a,o){var l=this._getPredefinedButtonInfo(i);if(l||(l={text:i}),l){var u=new Kekule.Widget.Button(this,l.text);u[this.BTN_NAME_FIELD]=i,u.addEventListener("execute",this._reactDialogBtnExec,this),u.appendToElem(this.getBtnPanelElem()),u.__$name__=i;var c=r||this._getDialogButtonResName(i);return c&&u.linkStyleResource(c),this._childButtons.push(u),u}return null},_getDialogButtonResName:function(i){var r=Kekule.Widget.DialogButtons;return[r.OK,r.YES].indexOf(i)>=0?Kekule.Widget.StyleResourceNames.BUTTON_YES_OK:[r.CANCEL,r.NO].indexOf(i)>=0?Kekule.Widget.StyleResourceNames.BUTTON_NO_CANCEL:null},_reactDialogBtnExec:function(i){var r=Kekule.Widget.DialogButtons,a=[r.OK,r.YES,r.CANCEL,r.NO],o=i.target;if(o){var l=o.__$name__;a.indexOf(l)>=0&&(this.setResult(l),this.close(l))}},_getPredefinedButtonInfo:function(i){var r=Kekule.Widget.DialogButtons,a=[r.OK,r.CANCEL,r.YES,r.NO],o=[Kekule.$L("WidgetTexts.CAPTION_OK"),Kekule.$L("WidgetTexts.CAPTION_CANCEL"),Kekule.$L("WidgetTexts.CAPTION_YES"),Kekule.$L("WidgetTexts.CAPTION_NO")],l=a.indexOf(i);return l>=0?{text:o[l]}:null},getDialogButton:function(i){for(var r=this._childButtons.length-1;r>=0;--r){var a=this._childButtons[r];if(a[this.BTN_NAME_FIELD]===i)return a}return null},needAdjustPosition:function(){return this.getShowHideType()!==Kekule.Widget.ShowHideType.DROPDOWN},_storePositionInfo:function(){if(this.needAdjustPosition()){var i=this.getElement().style;this._posInfo={left:i.left,top:i.top,right:i.right,bottom:i.bottom,width:i.width,height:i.height,position:i.position}}},_restorePositionInfo:function(){if(this.needAdjustPosition()){var i=this.getElement();if(i){var r=i.style,a=this._posInfo;a&&(r.left=a.left,r.top=a.top,r.right=a.right,r.bottom=a.bottom,r.width=a.width,r.height=a.height,r.position=a.position)}}},adjustLocation:function(){if(this.needAdjustPosition()){this._storePositionInfo();var i=Kekule.Widget.Location,r=this.getLocation()||i.DEFAULT,a=!1;if(r!==i.DEFAULT){var o,l,u,c,d,h,p=this.getDisplayed(),g=this.getVisible();try{this.setDisplayed(!0,!0),this.setVisible(!0,!0);var f=Kekule.DocumentUtils.getInnerClientDimension(this.getDocument()),m=Kekule.HtmlElementUtils.getElemPageRect(this.getElement(),!0),C=m.right-m.left,_=m.bottom-m.top,y=this.getOffsetParent();y&&Kekule.HtmlElementUtils.getElemPageRect(y,!0),a=C>=f.width||_>=f.height}finally{this.setVisible(g,!0),this.setDisplayed(p,!0)}if(r===i.CENTER_OR_FULLFILL&&(a?(Kekule.DocumentUtils.getClientVisibleBox(this.getDocument()),C>=f.width?(o=0,d=0):o=(f.width-C)/2,_>=f.height?(l=0,h=0):l=(f.height-_)/2):r=i.CENTER),r===i.FULLFILL?(o=0,l=0,d=0,h=0):r===i.CENTER&&(o=(f.width-C)/2,l=(f.height-_)/2),a){this.removeClassName(n.DIALOG_INSIDE),this.addClassName(n.DIALOG_OVERFLOW);var T=Kekule.DocumentUtils.getScrollPosition(this.getDocument());(o+=T.left)<0&&(o=0),(l+=T.top)<0&&(l=0)}else this.removeClassName(n.DIALOG_OVERFLOW),this.addClassName(n.DIALOG_INSIDE);var E=this.getElement().style,b=Kekule.ObjUtils.notUnset;b(o)&&(E.left=o+"px"),b(l)&&(E.top=l+"px"),b(d)&&(E.right=d+"px"),b(h)&&(E.bottom=d+"px"),b(u)&&(E.width=u+"px"),b(c)&&(E.height=c+"px"),this.adjustClientSize(u,c,a)}this._posAdjusted=!0}},adjustClientSize:function(i,r,a){},prepareShow:function(i,r){var a=this.getElement();if(!a.parentNode){var o=this.getGlobalManager();(r?o.getContextRootElementOfCaller(r):a.ownerDocument.body).appendChild(a)}var l=this;setTimeout(function(){l._dialogCallback=i},0)},openModal:function(i,r){return this.getGlobalManager().prepareModalWidget(this,r),this.open(i,r)},openPopup:function(i,r){return this.open(i,r,Kekule.Widget.ShowHideType.POPUP)},open:function(i,r,a){return this.prepareShow(i,r),this.show(r,null,a||Kekule.Widget.ShowHideType.DIALOG),this._dialogOpened=!0,this},close:function(i){this.setResult(i),this.hide()},isPositiveResult:function(i){return Kekule.Widget.DialogButtons.isPositive(i||this.getResult())},isNegativeResult:function(i){return Kekule.Widget.DialogButtons.isNegative(i||this.getResult())},widgetShowStateBeforeChanging:function(i){this.tryApplySuper("widgetShowStateBeforeChanging",[i]),i&&(this.adjustLocation(),this.setResult(null))},doWidgetShowStateChanged:function(i){this.tryApplySuper("doWidgetShowStateChanged",[i]),i||this._dialogCallback&&(this._dialogCallback(this.getResult()),this._dialogCallback=null)},widgetShowStateDone:function(i){this.tryApplySuper("widgetShowStateDone",[i]),!i&&this._dialogOpened&&(this.getModalInfo()&&this.getGlobalManager().unprepareModalWidget(this),this.isShown()||this._restorePositionInfo(),this._dialogOpened=!1)}})}(),function(){var e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MSGPANEL:"K-MsgPanel",MSGPANEL_CONTENT:"K-MsgPanel-Content",MSGGROUP:"K-MsgGroup",MSGGROUP_FOR_WIDGET:"K-Widget-MsgGroup",MSG_NORMAL:"K-Msg-Normal",MSG_INFO:"K-Msg-Info",MSG_WARNING:"K-Msg-Warning",MSG_ERROR:"K-Msg-Error"}),Kekule.Widget.MsgType={NORMAL:"",INFO:"info",WARNING:"warning",ERROR:"error"},Kekule.Widget.MsgPanel=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.MsgPanel",BINDABLE_TAG_NAMES:["span","div"],initialize:function(n,i,r){this._contentElem=null,this._elemTextPart=null,this._elemLeadingGlyphPart=null,this._elemTailingGlyphPart=null,this.setPropStoreFieldValue("showText",!0),this.tryApplySuper("initialize",[n]),i&&this.setText(i),r&&this.setMsgType(r),this.setUseCornerDecoration(!0)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(n){this.changeContentText(n)}}),this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,setter:function(n){this.setPropStoreFieldValue("showLeadingGlyph",n),this._elemLeadingGlyphPart.style.display=n?"":"none"}}),this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,setter:function(n){this.setPropStoreFieldValue("showTailingGlyph",n),this._elemTailingGlyphPart.style.display=n?"":"none"}}),this.defineProp("msgType",{dataType:DataType.STRING,setter:function(n){var i=this.getMsgType();if(i!==n){var r=this.getClassNameForMsgType(i),a=this.getClassNameForMsgType(n);r!==a&&(this.removeClassName(r),this.addClassName(a)),this.setPropStoreFieldValue("msgType",n)}}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MSGPANEL},doCreateRootElement:function(n){return n.createElement("span")},doCreateSubElements:function(n,i){var r=this.tryApplySuper("doCreateSubElements",[n,i])||[],a=e.getInnerText(i);i.innerHTML="";var o=n.createElement("span");return o.className=t.MSGPANEL_CONTENT,i.appendChild(o),this._contentElem=o,this._elemTextPart=this.createTextContent(a,o),this._elemLeadingGlyphPart=this.createGlyphContent(o,this._elemTextPart,t.PART_PRI_GLYPH_CONTENT),this._elemTailingGlyphPart=this.createGlyphContent(o,null,t.PART_ASSOC_GLYPH_CONTENT),r.push(o),r},doSetUseCornerDecoration:function(n){this.tryApplySuper("doSetUseCornerDecoration",[n]),n?Kekule.HtmlElementUtils.addClass(this._contentElem,t.CORNER_ALL):Kekule.HtmlElementUtils.removeClass(this._contentElem,t.CORNER_ALL)},getTextSelectable:function(){return!0},changeContentText:function(n){Kekule.DomUtils.setElementText(this._elemTextPart,n||"",!0)},getClassNameForMsgType:function(n){var i=Kekule.Widget.MsgType;switch(n){case i.INFO:return t.MSG_INFO;case i.WARNING:return t.MSG_WARNING;case i.ERROR:return t.MSG_ERROR;default:return t.MSG_NORMAL}}}),Kekule.Widget.MsgGroup=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.MsgGroup",BINDABLE_TAG_NAMES:["span","div"],initialize:function(n){this.tryApplySuper("initialize",[n]),this.setLayout(Kekule.Widget.Layout.VERTICAL)},initProperties:function(){this.defineProp("reversedOrder",{dataType:DataType.BOOL}),this.defineProp("maxMsgCount",{dataType:DataType.INT,setter:function(n){this.setPropStoreFieldValue("maxMsgCount",n),this.clearExcessiveMsgs()}}),this.defineProp("msgFlashTime",{dataType:DataType.INT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMsgFlashTime(6e3)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.MSGGROUP},doCreateRootElement:function(n){return n.createElement("div")},addMessage:function(n,i,r,a){if(n||i){var o=new Kekule.Widget.MsgPanel(this,n,i);o.setFinalizeAfterHiding(!0),a&&o.addClassName(a),this.getReversedOrder()?o.insertToWidget(this,this.getChildAt(0)):o.appendToWidget(this);var l=Kekule.ObjUtils.isUnset(r)?this.getMsgFlashTime():r;return l?o.flash(l,this):o.show(this),this.clearExcessiveMsgs(),o}},clearExcessiveMsgs:function(){var n=this.getMaxMsgCount();if(n&&n>0){var i=this.getChildWidgets().length-n;if(i>0){var r,a=0,o=this,l=function(){a<i&&(r=o.getOldestMsgPanel(),o.hideMsgPanel(r,l),++a)};l()}}},getOldestMsgPanel:function(){return this.getReversedOrder()?this.getLastChild():this.getFirstChild()},hideMsgPanel:function(n,i){return n.hide(this,i),n}}),ClassEx.defineProp(Kekule.Widget.BaseWidget,"msgReporter",{dataType:"Kekule.Widget.MsgGroup",serializable:!1,setter:null,getter:function(n){var i=this.getPropStoreFieldValue("msgReporter");return!i&&n&&((i=new Kekule.Widget.MsgGroup(this)).addClassName(t.MSGGROUP_FOR_WIDGET),i.appendToWidget(this),this.setPropStoreFieldValue("msgReporter",i)),i}}),ClassEx.extend(Kekule.Widget.BaseWidget,{reportMessage:function(n,i,r,a){var o=this.getMsgReporter(!0),l=o.addMessage(n,i,r||0,a);return o.setDisplayed(!0),l},flashMessage:function(n,i,r,a){return this.reportMessage(n,i,r||this.getMsgReporter(!0).getMsgFlashTime(),a)},removeMessage:function(n){n.hide()}})}(),function(){Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames,t=Kekule.ArrayUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TABVIEW:"K-TabView",TABVIEW_TABBUTTON:"K-TabView-TabButton",TABVIEW_CLIENT:"K-TabView-Client",TABVIEW_PAGE:"K-TabView-Page",TABVIEW_ACTIVE_PAGE:"K-TabView-Active-Page",TABVIEW_TABBUTTON_CONTAINER:"K-TabView-TabButton-Container",TABVIEW_PAGE_CONTAINER:"K-TabView-Page-Container",TABBUTTONGROUP:"K-TabButtonGroup",TAB_AT_LEFT:"K-TabAtLeft",TAB_AT_RIGHT:"K-TabAtRight",TAB_AT_TOP:"K-TabAtTop",TAB_AT_BOTTOM:"K-TabAtBottom"}),Kekule.Widget.TabPage=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.TabPage",initProperties:function(){this.defineProp("text",{dataType:DataType.STRING}),this.defineProp("active",{dataType:DataType.STRING,getter:function(){var n=this.getTabView();return n?n.getActiveTabPage()===this:this.getPropStoreFieldValue("active")},setter:function(n){this.setPropStoreFieldValue("active",n);var i=this.getTabView();i&&n&&i.setActiveTabPage(this)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABVIEW_PAGE},doCreateRootElement:function(n){return n.createElement("div")},getTabView:function(){var n=this.getParent();return n instanceof Kekule.Widget.TabView?n:null}}),Kekule.Widget.TabButtonGroup=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.TabButtonGroup",initialize:function(n){this.tryApplySuper("initialize",[n]),this.addEventListener("execute",function(i){var r=i.target;r instanceof Kekule.Widget.RadioButton&&this.invokeEvent("switch",{button:r})},this),this.tabButtonPosChanged()},initProperties:function(){this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(n){this.getTabButtonPosition()!==n&&(this.setPropStoreFieldValue("tabButtonPosition",n),this.tabButtonPosChanged())}}),this.defineProp("activeTabIndex",{dataType:DataType.INT,getter:function(){for(var n=this.getTabButtons(),i=0,r=n.length;i<r;++i)if(n[i].getChecked())return i;return-1},setter:function(n){for(var i=this.getTabButtons(),r=0,a=i.length;r<a;++r)i[r].setChecked(r===n)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setUseCornerDecoration(!1)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABBUTTONGROUP},getTabButtons:function(){for(var n=[],i=this.getChildWidgets(),r=0,a=i.length;r<a;++r){var o=i[r];o instanceof Kekule.Widget.RadioButton&&n.push(o)}return n},tabButtonPosChanged:function(){var n=Kekule.Widget.Position,i=this.getTabButtonPosition(),r=i&n.LEFT||i&n.RIGHT,a=i&n.RIGHT?e.TAB_AT_RIGHT:i&n.BOTTOM?e.TAB_AT_BOTTOM:i&n.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP;this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=a,this.addClassName(this._lastTabBtnPosClassName),this.setLayout(r?Kekule.Widget.Layout.VERTICAL:Kekule.Widget.Layout.HORIZONTAL)}}),Kekule.Widget.TabView=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.TabView",TAB_BTN_FIELD:"__$tabButton__",initialize:function(n){this._tabBtnContainer=null,this._pageContainer=null,this.tryApplySuper("initialize",[n]),Kekule.ObjUtils.isUnset(this.getUseCornerDecoration())&&this.setUseCornerDecoration(!0),this.tabButtonPosChanged(),this.addEventListener("change",this.reactTabPagePropChange,this)},doFinalize:function(){this.getTabGroup()&&this.getTabGroup().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("tabPages",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var n=this.getPropStoreFieldValue("tabPages");return n||(n=[],this.setPropStoreFieldValue("tabPages",n)),n},setter:null}),this.defineProp("activeTabPage",{dataType:"Kekule.Widget.TabPage",serializable:!1,setter:function(n){var i=this.getActiveTabPage();i!==n&&this.hasChild(n)&&(this.setPropStoreFieldValue("activeTabPage",n),i&&(i.removeClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(i).setChecked(!1)),n&&(n.addClassName(e.TABVIEW_ACTIVE_PAGE),this._getPageTabButton(n).setChecked(!0),this.invokeEvent("switchTab",{tabPage:n})))}}),this.defineProp("activeTabIndex",{dataType:DataType.INT,serializable:!1,getter:function(){return this.getTabPages().indexOf(this.getActiveTabPage())},setter:function(n){var i=this.getTabPages()[n];i&&this.setActiveTabPage(i)}}),this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(n){this.getTabButtonPosition()!==n&&(this.setPropStoreFieldValue("tabButtonPosition",n),this.tabButtonPosChanged())}}),this.defineProp("showTabButtons",{dataType:DataType.BOOL,getter:function(){var n=this.getTabGroup();return n&&n.getDisplayed()},setter:function(n){var i=this.getTabGroup();i&&i.setDisplayed(n)}}),this.defineProp("tabGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TABVIEW},doCreateRootElement:function(n){return n.createElement("div")},doCreateSubElements:function(n,i){var r=n.createElement("div");r.className=e.TABVIEW_TABBUTTON_CONTAINER;var a=this.doCreateContainerElement(n,null,"div");return a.className=e.TABVIEW_PAGE_CONTAINER,this._tabBtnContainer=r,this._pageContainer=a,i.appendChild(r),i.appendChild(a),this.setPropStoreFieldValue("tabGroup",this.doCreateTabbar(n,r)),[r,a]},doCreateTabbar:function(n,i){var r=new Kekule.Widget.TabButtonGroup(n);return r.setParent(this),r.appendToElem(i),r.addEventListener("switch",function(a){var o=a.button,l=this._getPageOfTabButton(o);l&&this.setActiveTabPage(l)},this),r},getChildrenHolderElement:function(){return this._pageContainer},getContainerElement:function(){return this._pageContainer},_getPageTabButton:function(n){return n[this.TAB_BTN_FIELD]},_setPageTabButton:function(n,i){n[this.TAB_BTN_FIELD]=i},_getPageOfTabButton:function(n){for(var i=this.getTabPages(),r=0,a=i.length;r<a;++r){var o=i[r];if(this._getPageTabButton(o)===n)return o}return null},childWidgetAdded:function(n){if(this.tryApplySuper("childWidgetAdded",[n]),n instanceof Kekule.Widget.TabPage){var i=!this.getTabPages().length;n.appendToElem(this._pageContainer),this.getTabPages().push(n),this._insertTabButtonBefore(n),(i||n.getActive())&&this.setActiveTabPage(n)}},childWidgetRemoved:function(n){this.tryApplySuper("childWidgetRemoved",[n]),n instanceof Kekule.Widget.TabPage&&(t.remove(this.getTabPages(),n),this._removeTabButton(n))},childWidgetMoved:function(n,i){this.tryApplySuper("childWidgetMoved",[n,i]),n instanceof Kekule.Widget.TabPage&&this._changeTabIndex(n,i)},_insertTabButtonBefore:function(n,i){var r=this.getTabGroup(),a=new Kekule.Widget.RadioButton(this.getDocument());this._updateTabButton(n,a),this._setPageTabButton(n,a),i?a.insertToWidget(r,i):a.appendToWidget(r)},_updateTabButton:function(n,i){i||(i=this._getPageTabButton(n)),i.setText(n.getText()||""),n.getHint()&&i.setHint(n.getHint())},_removeTabButton:function(n){var i=this._getPageTabButton(n);i&&i.finalize()},_changeTabIndex:function(n,i){var r=this._getPageTabButton(n);this.getTabGroup()._moveChild(r,i);var a=this.getTabPages(),o=a.indexOf(n);o>=0&&o!==i&&t.changeItemIndex(a,n,i)},reactTabPagePropChange:function(n){var i=n.target;if(i instanceof Kekule.Widget.TabPage){var r=this._getPageTabButton(i);r&&this._updateTabButton(i,r)}},tabButtonPosChanged:function(){var n=Kekule.Widget.Position,i=this.getTabButtonPosition(),r=i&n.BOTTOM||i&n.RIGHT,a=(i&n.LEFT||n.RIGHT,i&n.RIGHT?e.TAB_AT_RIGHT:i&n.BOTTOM?e.TAB_AT_BOTTOM:i&n.LEFT?e.TAB_AT_LEFT:e.TAB_AT_TOP);this._lastTabBtnPosClassName&&this.removeClassName(this._lastTabBtnPosClassName),this._lastTabBtnPosClassName=a,this.addClassName(this._lastTabBtnPosClassName),this.getTabGroup().setTabButtonPosition(i),r?this.getElement().appendChild(this._tabBtnContainer):this.getElement().insertBefore(this._tabBtnContainer,this._pageContainer)},createNewTabPage:function(n,i,r){var a=this.getDocument(),o=new Kekule.Widget.TabPage(a);if(o.setText(n),i&&o.setHint(i),o.appendToWidget(this),r){var l=this.getChildWidgets().indexOf(r);this._moveChild(o,l)}return o}})}(),function(){var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,n=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{VALUELISTEDITOR:"K-ValueListEditor",VALUELISTEDITOR_ROW:"K-ValueListEditor-Row",VALUELISTEDITOR_CELL:"K-ValueListEditor-Cell",VALUELISTEDITOR_INDICATORCELL:"K-ValueListEditor-IndicatorCell",VALUELISTEDITOR_KEYCELL:"K-ValueListEditor-KeyCell",VALUELISTEDITOR_VALUECELL:"K-ValueListEditor-ValueCell",VALUELISTEDITOR_CELL_CONTENT:"K-ValueListEditor-CellContent",VALUELISTEDITOR_VALUECELL_TEXT:"K-ValueListEditor-ValueCellText",VALUELISTEDITOR_INLINE_EDIT:"K-ValueListEditor-InlineEdit",VALUELISTEDITOR_EXPANDMARK:"K-ValueListEditor-ExpandMark",VALUELISTEDITOR_ACTIVE_ROW:"K-ValueListEditor-ActiveRow"}),Kekule.Widget.ValueListEditor=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ValueListEditor",BINDABLE_TAG_NAMES:["table"],ROW_ELEM_TAG:"tr",CELL_ELEM_TAG:"td",ROW_DATA_FIELD:"__$row_data__",ROW_EDIT_INFO_FIELD:"__$row_edit_info__",initialize:function(r){this.tryApplySuper("initialize",[r]),this._inlineEdit=null,this._isActivitingRow=!1},initProperties:function(){this.defineProp("hash",{dataType:DataType.HASH,getter:function(){return this._getTotalHash()},setter:function(r){this._setTotalHash(r),this.setPropStoreFieldValue("hash",r)}}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("useKeyHint",{dataType:DataType.BOOL}),this.defineProp("valueDisplayMode",{dataType:DataType.INT,enumSource:Kekule.Widget.ValueListEditor.ValueDisplayMode,setter:function(r){this.getValueDisplayMode()!==r&&(this.setPropStoreFieldValue("valueDisplayMode",r),this.valueDisplayModeChanged())}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(r){var a=this.getActiveRow();a!==r&&(a&&(this.finishEditing(),t.removeClass(a,n.VALUELISTEDITOR_ACTIVE_ROW),this._showValueCellText(a)),this._inlineEdit&&this._inlineEdit.finalize(),r&&(t.addClass(r,n.VALUELISTEDITOR_ACTIVE_ROW),this.createValueEditWidget(r)),this.setPropStoreFieldValue("activeRow",r),this.invokeEvent("activeRowChange",{row:r}))}})},doGetWidgetClassName:function(){return n.VALUELISTEDITOR},doCreateRootElement:function(r){return r.createElement("table")},doBindElement:function(r){this.tryApplySuper("doBindElement",[r])},getRootElem:function(){return this.getElement()},createRowElem:function(r){var a=r.createElement(this.ROW_ELEM_TAG);return t.addClass(a,n.VALUELISTEDITOR_ROW),a},createCellElem:function(r){var a=r.createElement(this.CELL_ELEM_TAG);return t.addClass(a,n.VALUELISTEDITOR_CELL),a},createIndicatorCellElem:function(r){var a=this.createCellElem(r);t.addClass(a,n.VALUELISTEDITOR_INDICATORCELL);var o=r.createElement("span");return a.appendChild(o),a},createKeyCellElem:function(r){var a=this.createCellElem(r);return t.addClass(a,n.VALUELISTEDITOR_KEYCELL),a},createValueCellElem:function(r){var a=this.createCellElem(r);return t.addClass(a,n.VALUELISTEDITOR_VALUECELL),a},createValueEditWidget:function(r){var a=null;if(r===this.getActiveRow()?a=this._inlineEdit:this._inlineEdit&&(this._inlineEdit.finalize(),this._inlineEdit=null),!a){(a=this.getReadOnly()?this.doCreateReadOnlyValueEditWidget(r):this.doCreateValueEditWidget(r)).setBubbleUiEvents(!0),t.addClass(a.getElement(),n.VALUELISTEDITOR_INLINE_EDIT);var o=this.getValueCell(r),l=this.getCellContentWrapper(o,!0);a.appendToElem(l)}return a&&(a.focus&&a.focus(),a.selectAll&&a.selectAll(),this._inlineEdit=a,this._hideValueCellText(r)),a},doCreateValueEditWidget:function(r){var a=this.getValueEditWidgetInfo(r);return this._doCreateValueEditWidgetByWidgetInfo(r,a)},doCreateDefaultValueEditWidget:function(r){return this._doCreateValueEditWidgetByWidgetInfo(r,this.getDefaultValueEditWidgetInfo())},doCreateReadOnlyValueEditWidget:function(r){var a=this._doCreateValueEditWidgetByWidgetInfo(r,this.getReadOnlyValueEditWidgetInfo());return a.setReadOnly&&a.setReadOnly(!0),a},_doCreateValueEditWidgetByWidgetInfo:function(r,a){var o=this.getRowData(r),l=this.getValueCellText(r,o),u=new a.widgetClass(this);return a.propValues&&u.setPropValues(a.propValues),u.setValue(l),u},getDefaultValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getReadOnlyValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getValueEditWidgetInfo:function(r){return this.getRowEditInfo(r)||this.getDefaultValueEditWidgetInfo()},getRowElems:function(){return this.getRootElem()?e.getDirectChildElems(this.getRootElem(),this.ROW_ELEM_TAG):[]},getRows:function(){return this.getRowElems()},getRowCount:function(){var r=this.getRowElems();return r?r.length:0},getRowAt:function(r){var a=this.getRowElems();return a?a[r]:null},getPrevRow:function(r){for(var a=this.ROW_ELEM_TAG.toLowerCase(),o=r.previousSibling;o&&(o.nodeType!==Node.ELEMENT_NODE||o.tagName.toLowerCase()!==a);)o=o.previousSibling;return o},getNextRow:function(r){for(var a=this.ROW_ELEM_TAG.toLowerCase(),o=r.nextSibling;o&&(o.nodeType!==Node.ELEMENT_NODE||o.tagName.toLowerCase()!==a);)o=o.nextSibling;return o},getKeyCell:function(r){return e.getDirectChildElems(r,this.CELL_ELEM_TAG)[1]},getCellContentWrapper:function(r,a){var o=e.getDirectChildElems(r),l=o?o[0]:null;return!l&&a&&(l=r.ownerDocument.createElement("span"),r.appendChild(l),t.addClass(l,n.VALUELISTEDITOR_CELL_CONTENT)),l},getValueCellTextWrapper:function(r,a){var o=null,l=this.getCellContentWrapper(r,a);if(l){var u=l.getElementsByTagName("span");!(o=u?u[0]:null)&&a&&(o=r.ownerDocument.createElement("span"),l.appendChild(o),t.addClass(o,n.VALUELISTEDITOR_VALUECELL_TEXT))}return o},_hideValueCellText:function(r){var a=this.getValueCellTextWrapper(this.getValueCell(r));a&&(a.style.visibility="hidden")},_showValueCellText:function(r){var a=this.getValueCellTextWrapper(this.getValueCell(r));a&&(a.style.visibility="visible")},getValueCell:function(r){return e.getDirectChildElems(r,this.CELL_ELEM_TAG)[2]},getParentCell:function(r){return e.getNearestAncestorByTagName(r,this.CELL_ELEM_TAG,!0)},getParentRow:function(r){return e.getNearestAncestorByTagName(r,this.ROW_ELEM_TAG,!0)},_createNewRow:function(r){var a=this.getDocument(),o=this.createRowElem(a);if(o){var l=this.createIndicatorCellElem(a);o.appendChild(l);var u=this.createKeyCellElem(a);o.appendChild(u);var c=this.createValueCellElem(a);o.appendChild(c),r&&this.setRowData(o,r)}return o},insertRowBefore:function(r,a){var o=this._createNewRow(r);return o&&this.getRootElem().insertBefore(o,a||null),o},appendRow:function(r){return this.insertRowBefore(r,null)},removeRow:function(r){return r===this.getActiveRow()&&this.setActiveRow(null),this.getRootElem().removeChild(r),this},removeRowAt:function(r){var a=this.getRowAt(r);return a&&this.removeRow(a),this},clear:function(){this.setActiveRow(null),this.getRootElem()&&Kekule.DomUtils.clearChildContent(this.getRootElem())},updateAll:function(){for(var r=this.getRowElems(),a=0,o=r.length;a<o;++a){var l=r[a],u=this.getRowData(l);this.setRowData(l,u)}return this},valueDisplayModeChanged:function(){this.updateAll()},getKeyCellText:function(r,a){return a.title||a.key},getKeyCellHint:function(r,a){return a.hint||this.getKeyCellText(r,a)},getValueCellText:function(r,a){return this.getValueDisplayMode()===i.JSON?JSON.stringify(a.value):""+a.value},valueCellTextToValue:function(r,a,o){return this.getValueDisplayMode()===i.JSON?JSON.parse(r):r},setValueCellText:function(r,a){var o=this.getRowData(a),l=this.valueCellTextToValue(r,a,o);return o.value=l,this.setRowData(a,o),this},getRowData:function(r){return r[this.ROW_DATA_FIELD]},setRowData:function(r,a){r[this.ROW_DATA_FIELD]=a,this.setRowKeyCellContent(r,this.getKeyCellText(r,a),this.getKeyCellHint(r,a)),this.setRowValueCellContent(r,this.getValueCellText(r,a)),r===this.getActiveRow()&&this._inlineEdit&&this.createValueEditWidget(r)},setRowKeyCellContent:function(r,a,o){var l=this.getKeyCell(r),u=this.getCellContentWrapper(l,!0);u.innerHTML=a,this.getUseKeyHint()&&(u.title=o)},setRowValueCellContent:function(r,a){var o=this.getValueCell(r),l=this.getValueCellTextWrapper(o,!0),u=a;u===""?l.innerHTML="&nbsp;":Kekule.DomUtils.setElementText(l,u)},getRowEditInfo:function(r){return r[this.ROW_EDIT_INFO_FIELD]},setRowEditInfo:function(r,a){r[this.ROW_EDIT_INFO_FIELD]=a,r===this.getActiveRow()&&(this.setActiveRow(null),this.setActiveRow(r))},editRow:function(r){this.setActiveRow(r)},finishEditing:function(){var r=this.getActiveRow();return r&&this._inlineEdit&&(this.setValueCellText(this._inlineEdit.getValue(),r),this.invokeEvent("editFinish",{row:r})),this},cancelEditing:function(){var r=this.getActiveRow();if(r&&this._inlineEdit){var a=this.getRowData(r);this.setRowData(r,a),this.invokeEvent("editCancel",{row:r})}return this},_getTotalHash:function(){for(var r={},a=this.getRowElems(),o=0,l=a.length;o<l;++o){var u=a[o],c=this.getRowData(u);c&&(r[c.key]=c.value)}return r},_setTotalHash:function(r){for(var a=this.getRowElems(),o=a.length,l=Kekule.ObjUtils.getOwnedFieldNames(r),u=l.length,c=0;c<u;++c){var d,h=l[c],p=r[h];c<o?(d=this.getRowAt(c),this.setRowData(d,{key:h,value:p})):d=this.appendRow({key:h,value:p})}if(o>u)for(c=o-1;c>=u;--c)this.removeRow(a[c]);var g=this.getActiveRow();return g&&(this.setActiveRow(null),this.setActiveRow(g)),this},react_click:function(r){var a=r.getTarget(),o=this.getParentRow(a);o&&this.setActiveRow(o)},react_keydown:function(r){var a=r.getKeyCode();if(!(r.getAltKey()||r.getShiftKey()||r.getCtrlKey())){var o,l=this.getActiveRow();l&&(a===Kekule.X.Event.KeyCode.UP?o=this.getPrevRow(l):a===Kekule.X.Event.KeyCode.DOWN&&(o=this.getNextRow(l)),o&&this.setActiveRow(o))}},react_keyup:function(r){var a=r.getKeyCode();a===Kekule.X.Event.KeyCode.ESC?this.cancelEditing():a===Kekule.X.Event.KeyCode.ENTER&&this.finishEditing()},react_blur:function(r){}}),Kekule.Widget.ValueListEditor.ValueDisplayMode={SIMPLE:0,JSON:1};var i=Kekule.Widget.ValueListEditor.ValueDisplayMode}(),function(){Kekule.DomUtils,Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{COLORPICKER:"K-ColorPicker",COLORPICKER_HEADER:"K-ColorPicker-Header",COLORPICKER_SPEC_COLOR_PALETTE:"K-ColorPicker-Spec-Color-Palette",COLORPICKER_HEXBOX:"K-ColorPicker-HexBox",COLORPICKER_PREVIEWER:"K-ColorPicker-Previewer",COLORPICKER_INPUT:"K-ColorPicker-Input",COLORPICKER_BROWSE_BTN:"K-ColorPicker-Browse-Btn",COLORPICKER_PALETTE:"K-ColorPicker-Palette",COLORPICKER_PALETTE_LINE:"K-ColorPicker-Palette-Line",COLORPICKER_PALETTE_CELL:"K-ColorPicker-Palette-Cell",COLORPICKER_PALETTE_CELL_TRANSPARENT:"K-ColorPicker-Palette-Cell-Transparent",COLORPICKER_SPEC_COLOR_UNSET:"K-Color-Unset",COLORPICKER_SPEC_COLOR_DEFAULT:"K-Color-Default",COLORPICKER_SPEC_COLOR_MIXED:"K-Color-Mixed",COLORPICKER_SPEC_COLOR_TRANSPARENT:"K-Color-Transparent",COLORDROPTEXTBOX:"K-ColorDropTextBox",COLORDROPBUTTON:"K-ColorDropButton",COLORPREVIEWER:"K-ColorPreviewer"}),Kekule.Widget.ColorPicker=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",COLOR_VALUE_FIELD:"__$colorValue__",COLOR_TEXT_FIELD:"__$colorText__",COLOR_CLASS_FIELD:"__ $colorClass__",BINDABLE_TAG_NAMES:["div","span"],initialize:function(t){this.tryApplySuper("initialize",[t]),this.setUseCornerDecoration(!0),this.setValue("#000000"),this.setTouchAction("none")},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,setter:function(t){this.setPropStoreFieldValue("value",t),this.getHexBox().innerHTML=t||"&nbsp;",this.getPreviewer().style.backgroundColor=t||"transparent",this.getColorInput()&&(this.getColorInput().value=t)}}),this.defineProp("colorClassName",{dataType:DataType.STRING}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(t){this.setPropStoreFieldValue("specialColors",t),this._recreateSpecialColorPaletteCells(this.getDocument(),this.getSpecialColorPalette())}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("hexBox",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("palette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("previewer",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("colorInput",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("specialColorPalette",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("isPicking",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORPICKER},doCreateRootElement:function(t){return t.createElement("div")},doCreateSubElements:function(t,n){var i=[];return i.push(this.doCreateHeader(t,n)),i.push(this.doCreatePalette(t,n)),i},doCreateHeader:function(t,n){var i=t.createElement("div");i.className=e.COLORPICKER_HEADER,i.appendChild(this.doCreateSpecialColorPalette(t)),i.appendChild(this.doCreateHexBox(t)),i.appendChild(this.doCreatePreviewer(t));var r=this.doCreateColorInput(t);if(r){i.appendChild(r);var a=this.doCreateColorDialogBtn(t);a&&a.appendToElem(i)}return n.appendChild(i),i},doCreateSpecialColorPalette:function(t){var n=t.createElement("div");return n.className=e.COLORPICKER_SPEC_COLOR_PALETTE,this._recreateSpecialColorPaletteCells(t,n),this.setSpecialColorPalette(n),n},_isPredefinedSpecialColor:function(t){var n=Kekule.Widget.ColorPicker.SpecialColors;return[n.UNSET,n.DEFAULT,n.MIXED,n.TRANSPARENT].indexOf(t)>=0},_getPredefinedSpecialColorInfo:function(t){var n=Kekule.Widget.ColorPicker.SpecialColors,i=[n.UNSET,n.DEFAULT,n.MIXED,n.TRANSPARENT],r=[e.COLORPICKER_SPEC_COLOR_UNSET,e.COLORPICKER_SPEC_COLOR_DEFAULT,e.COLORPICKER_SPEC_COLOR_MIXED,e.COLORPICKER_SPEC_COLOR_TRANSPARENT],a=[Kekule.$L("WidgetTexts.S_COLOR_UNSET"),Kekule.$L("WidgetTexts.S_COLOR_DEFAULT"),Kekule.$L("WidgetTexts.S_COLOR_MIXED"),Kekule.$L("WidgetTexts.S_COLOR_TRANSPARENT")],o={value:t},l=i.indexOf(t);return l>=0&&(o.text=a[l],o.className=r[l]),o},_recreateSpecialColorPaletteCells:function(t,n){Kekule.DomUtils.clearChildContent(n);var i=this.getSpecialColors();if(i&&i.length)for(var r=0,a=i.length;r<a;++r){var o,l=i[r],u={};DataType.isObjectValue(l)?u=l:this._isPredefinedSpecialColor(l)?u=this._getPredefinedSpecialColorInfo(l):u.value=l,o=this.doCreatePaletteCell(t,u.value,u.text,u.className),u.className&&Kekule.HtmlElementUtils.addClass(o,u.className),n.appendChild(o)}},doCreateHexBox:function(t){var n=t.createElement("span");return n.className=e.COLORPICKER_HEXBOX,n.innerHTML="&nbsp",this.setHexBox(n),n},doCreatePreviewer:function(t){var n=t.createElement("span");return n.className=e.COLORPICKER_PREVIEWER,n.innerHTML="&nbsp",this.setPreviewer(n),n},doCreateColorInput:function(t){if(Kekule.BrowserFeature.html5Form.supportType("color")){var n=t.createElement("input");n.setAttribute("type","color"),n.className=e.COLORPICKER_INPUT;var i=this;return Kekule.X.Event.addListener(n,"change",function(r){var a=n.value;i.setValue(a),i.notifyColorSet()}),this.setColorInput(n),n}return null},doCreateColorDialogBtn:function(t){if(Kekule.BrowserFeature.html5Form.supportType("color")){var n=new Kekule.Widget.Button(t);return n.setText(Kekule.$L("WidgetTexts.CAPTION_BROWSE_COLOR")),n.setHint(Kekule.$L("WidgetTexts.HINT_BROWSE_COLOR")),n.setShowText(!1),n.doSetShowGlyph(!0),n.linkStyleResource(Kekule.Widget.StyleResourceNames.ICON_COLOR_PICK),n.addClassName(e.COLORPICKER_BROWSE_BTN),n.addEventListener("execute",this.openColorDialog,this),n}},doCreatePalette:function(t,n){var i=t.createElement("div");i.className=e.COLORPICKER_PALETTE;for(var r=["00","00","11","22","33","44","55","66","77","88","99","AA","BB","CC","DD","EE","FF",null],a=r.length,o=this.doCreatePaletteLine(t),l=0;l<a;l++){var u=r[l]?"#"+r[l]+r[l]+r[l]:"transparent",c=this.doCreatePaletteCell(t,u);o.appendChild(c)}for(i.appendChild(o),a=(r=["00","33","66","99","CC","FF"]).length,l=0;l<a;l++){o=this.doCreatePaletteLine(t);for(var d=0;d<a>>1;d++)for(var h=0;h<a;h++)u="#"+r[d]+r[l]+r[h],c=this.doCreatePaletteCell(t,u),o.appendChild(c);i.appendChild(o)}for(l=0;l<a;l++){for(o=this.doCreatePaletteLine(t),d=a>>1;d<a;d++)for(h=0;h<a;h++)u="#"+r[d]+r[l]+r[h],c=this.doCreatePaletteCell(t,u),o.appendChild(c);i.appendChild(o)}return n.appendChild(i),this.setPalette(i),i},doCreatePaletteCell:function(t,n,i,r){var a=t.createElement("span"),o=e.COLORPICKER_PALETTE_CELL;if(n==="transparent")o+=" "+e.COLORPICKER_PALETTE_CELL_TRANSPARENT;else try{a.style.backgroundColor=n}catch{}return a[this.COLOR_VALUE_FIELD]=n,a[this.COLOR_TEXT_FIELD]=i||n,a[this.COLOR_CLASS_FIELD]=r,a.className=o,a.title=i||n,a},doCreatePaletteLine:function(t){var n=t.createElement("div");return n.className=e.COLORPICKER_PALETTE_LINE,n},_isPaletteCellElem:function(t){return Kekule.HtmlElementUtils.hasClass(t,e.COLORPICKER_PALETTE_CELL)},openColorDialog:function(){return this.getColorInput()&&this.getColorInput().click(),this},applyColor:function(t){var n=t[this.COLOR_VALUE_FIELD];n&&this.setValue(n);var i=t[this.COLOR_TEXT_FIELD];i&&(this.getHexBox().innerHTML=i);var r=t[this.COLOR_CLASS_FIELD];this.setColorClassName(r)},notifyColorSet:function(){this.setIsDirty(!0),this.invokeEvent("valueSet",{value:this.getValue(),colorClassName:this.getColorClassName()}),this.invokeEvent("valueChange",{value:this.getValue(),colorClassName:this.getColorClassName()})},doReactActiviting:function(t){this.tryApplySuper("doReactActiviting",[t]);var n=t.getTarget();if(this._isPaletteCellElem(n))return this.setIsPicking(!0),this.applyColor(n),!0},doReactDeactiviting:function(t){if(this.getIsPicking()){this.setIsPicking(!1);var n=t.getTarget();return this._isPaletteCellElem(n)&&this.applyColor(n),this.notifyColorSet(),!0}this.tryApplySuper("doReactDeactiviting",[t])},reactPointerMoving:function(t){if(this.tryApplySuper("reactPointerMoving",[t]),this.getIsPicking()){var n=t.getTarget();if(t.getTouches()){var i={x:t.getClientX(),y:t.getClientY()},r=this.getDocument();n=r.elementFromPoint&&r.elementFromPoint(i.x,i.y)||n,t.preventDefault()}return n&&this._isPaletteCellElem(n)&&this.applyColor(n),t.preventDefault(),!0}}}),Kekule.Widget.ColorPicker.SpecialColors={UNSET:"(unset)",DEFAULT:"(default)",MIXED:"(mixed)",TRANSPARENT:"transparent"},Kekule.Widget.ColorDropTextBox=Class.create(Kekule.Widget.ButtonTextBox,{CLASS_NAME:"Kekule.Widget.ColorDropTextBox",initialize:function(t,n){this.tryApplySuper("initialize",[t]),this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),this.addEventListener("buttonExecute",this.reactDropbuttonExecute,this),this.setShowPreview(!0),n&&this.setValue(n)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(t){this.getPreviewElem().style.display=t?"inherit":""}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(t){var n=this.getPreviewElem();if(n){var i=this.getColorClassName();i&&Kekule.HtmlElementUtils.removeClass(n,i),t&&Kekule.HtmlElementUtils.addClass(n,t)}this.setPropStoreFieldValue("colorClassName",t)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var t=this.getPropStoreFieldValue("colorPicker");return t||((t=new Kekule.Widget.ColorPicker(this)).setDisplayed(!1),t.getElement().style.position="absolute",t.setSpecialColors(this.getSpecialColors()),t.addEventListener("valueChange",this.reactColorPickerValueSet,this),t.appendToElem(this.getElement()),this.setPropStoreFieldValue("colorPicker",t)),t}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(t){this.setPropStoreFieldValue("specialColors",t);var n=this.getPropStoreFieldValue("colorPicker");n&&n.setSpecialColors(t)}})},doFinalize:function(){var t=this.getPropStoreFieldValue("colorPicker");t&&t.finalize(),this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORDROPTEXTBOX},doCreateSubElements:function(t,n){this.tryApplySuper("doCreateSubElements",[t,n]);var i=new Kekule.Widget.DumbWidget(this);return i.addClassName(e.COLORPREVIEWER),this.setHeadingWidget(i),[i.getElement()]},getPreviewElem:function(){var t=this.getHeadingWidget();if(t)return t.getElement()},showColorPicker:function(){var t=this.getColorPicker();t.isShown()||(t.setValue(this.getValue()),t.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var t=this.getPropStoreFieldValue("colorPicker");t&&t.isShown()&&t.hide()},reactDropbuttonExecute:function(t){this.showColorPicker()},reactColorPickerValueSet:function(t){var n=t.value;this.setValue(n),this.setIsDirty(this.getIsDirty()||this.getColorPicker().getIsDirty()),this.setColorClassName(t.colorClassName),this.hideColorPicker(),t.stopPropagation()},doSetValue:function(t){this.tryApplySuper("doSetValue",[t]);var n=this.getPreviewElem();n&&(n.style.backgroundColor="transparent",n.style.backgroundColor=t)}}),Kekule.Widget.ColorDropButton=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.ColorDropButton",initialize:function(t,n){this.tryApplySuper("initialize",[t]),this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),this.setShowPreview(!0),n&&this.setValue(n)},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(t){try{this.getPreviewElem().style.display=t?"inherit":""}catch{}}}),this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getText()},setter:function(t){this.setText(t),this.updateColorPreview(t);var n=this.getPropStoreFieldValue("colorPicker");n&&n.setValue(t)}}),this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(t){var n=this.getPreviewElem();if(n){var i=this.getColorClassName();i&&Kekule.HtmlElementUtils.removeClass(n,i),t&&Kekule.HtmlElementUtils.addClass(n,t)}this.setPropStoreFieldValue("colorClassName",t)}}),this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var t=this.getPropStoreFieldValue("colorPicker");return t||((t=new Kekule.Widget.ColorPicker(this)).setDisplayed(!1),t.getElement().style.position="absolute",t.setSpecialColors(this.getSpecialColors()),t.addEventListener("valueChange",this.reactColorPickerValueSet,this),this.setPropStoreFieldValue("colorPicker",t)),t}}),this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(t){this.setPropStoreFieldValue("specialColors",t);var n=this.getPropStoreFieldValue("colorPicker");n&&n.setSpecialColors(t)}}),this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getColorPicker().getIsDirty()},setter:function(t){this.getColorPicker().setIsDirty(t)}})},doFinalize:function(){var t=this.getPropStoreFieldValue("colorPicker");t&&t.finalize(),this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.COLORDROPBUTTON},doGetDropDownWidget:function(){return this.getColorPicker()},getPreviewElem:function(){return this._elemLeadingGlyphPart},showColorPicker:function(){var t=this.getColorPicker();t.isShown()||(t.setValue(this.getValue()),t.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN))},hideColorPicker:function(){var t=this.getPropStoreFieldValue("colorPicker");t&&t.isShown()&&t.hide()},reactColorPickerValueSet:function(t){var n=t.value,i=t.colorClassName;this.setValue(n),this.setColorClassName(i),this.hideColorPicker(),this.invokeEvent("valueChange",{value:n}),t.stopPropagation()},updateColorPreview:function(t){var n=this.getPreviewElem();n&&(n.style.backgroundColor="transparent",n.style.backgroundColor=t)}})}(),function(){Kekule.DomUtils,Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TEXTEDITOR:"K-TextEditor",TEXTEDITOR_TOOLBAR:"K-TextEditor-Toolbar",TEXTEDITOR_TEXTAREA:"K-TextEditor-TextArea",TEXTEDITOR_FONTBOX:"K-TextEditor-FontBox",TEXTEDITOR_BTN_FONTSIZEINC:"K-TextEditor-Btn-FontSizeInc",TEXTEDITOR_BTN_FONTSIZEDEC:"K-TextEditor-Btn-FontSizeDec",TEXTEDITOR_BTN_TEXTWRAP:"K-TextEditor-Btn-TextWrap"}),Kekule.Widget.TextEditor=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextEditor",BINDABLE_TAG_NAMES:["div","span"],DEF_TOOLBAR_COMPONENTS:["fontFamily","fontSizeInc","fontSizeDec","textWrap"],DEF_AUTOWRAP_THRESHOLD:80,initialize:function(t){this._toolCompWidgets=[],this.setPropStoreFieldValue("showToolbar",!0),this.tryApplySuper("initialize",[t])},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){var t=this.getTextArea();return t?t.getText():null},setter:function(t){var n=this.getTextArea();n&&(n.setText(t),this._checkAutoWrap())}}),this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getTextArea().getReadOnly()},setter:function(t){return this.getTextArea().setReadOnly(t)}}),this.defineProp("wrap",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getTextArea().getWrap()},setter:function(t){var n=this.getTextArea().setWrap(t);return this.updateToolButtonStates(),n}}),this.defineProp("autoWrapThreshold",{dataType:DataType.INT,setter:function(t){var n=t===!0?this.DEF_AUTOWRAP_THRESHOLD:t;this.setPropStoreFieldValue("autoWrapThreshold",n),this._checkAutoWrap()}}),this.defineProp("textArea",{dataType:"Kekule.Widget.TextArea",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var t=this.getPropStoreFieldValue("textArea");return t||(t=this.createTextArea(),this.setPropStoreFieldValue("textArea",t)),t}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var t=this.getPropStoreFieldValue("toolbar");return t||this.getShowToolbar()&&(t=this.createToolbar(),this.setPropStoreFieldValue("styleToolbar",t)),t}}),this.defineProp("showToolbar",{dataType:DataType.BOOL,setter:function(t){this.setPropStoreFieldValue("showToolbar",t),this.getToolbar().setDisplayed(t)}}),this.defineProp("toolbarPos",{dataType:DataType.INT,setter:function(t){this.setPropStoreFieldValue("toolbarPos",t),this.updateChildWidgetPos()}}),this.defineProp("toolbarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var t=this.getPropStoreFieldValue("toolbarComponents");return t||(t=null,this.setPropStoreFieldValue("toolbarComponents",t)),t},setter:function(t){this.setPropStoreFieldValue("toolbarComponents",t),this.recreateToolbarComponents(t)}}),this.defineProp("candidateFontFamilies",{dataType:DataType.ARRAY}),this.defineProp("fontSizeLevel",{dataType:DataType.FLOAT,setter:function(t){this.setPropStoreFieldValue("fontSizeLevel",t),this.setTextStyle({fontSize:t+"em"})}})},finalize:function(){this._finalizeSubElements(),this.tryApplySuper("finalize")},_finalizeSubElements:function(){var t=this.getTextArea();t&&t.finalize()},getCoreElement:function(){var t=this.getTextArea();return t?t.getElement():this.tryApplySuper("getCoreElement")},getChildrenHolderElement:function(){return this.getElement()},doSetValue:function(t){this.tryApplySuper("doSetValue",[t]),this._checkAutoWrap()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.TEXTEDITOR},doCreateRootElement:function(t){return t.createElement("span")},doCreateSubElements:function(t,n){var i=this.createToolbar();i&&i.appendToElem(n);var r=this.createTextArea();return r.appendToElem(n),this.updateChildWidgetPos(),[i.getElement(),r.getElement()]},doWidgetShowStateChanged:function(t){this.tryApplySuper("doWidgetShowStateChanged",[t]),t&&(this.updateChildWidgetPos(),this.updateToolButtonStates())},doFileDragDrop:function(t){if(t){if(Kekule.BrowserFeature.fileapi){var n=this,i=new FileReader;i.onload=function(r){var a=i.result;n.setText(a)},i.readAsText(t[0])}return!0}return this.tryApplySuper("doFileDragDrop")},createToolbar:function(){if(this.getShowToolbar()){var t=new Kekule.Widget.Toolbar(this);return this.setPropStoreFieldValue("toolbar",t),t.addClassName(e.TEXTEDITOR_TOOLBAR),this.recreateToolbarComponents(),t}return null},recreateToolbarComponents:function(t){t||(t=this.getToolbarComponents());var n=t||this.DEF_TOOLBAR_COMPONENTS,i=this.getToolbar();if(i){var r;this._toolCompWidgets.length=0,i.clearWidgets(),i.setShowText(!1),i.setShowGlyph(!0);for(var a=0,o=n.length;a<o;++a){var l=n[a];r=l==="fontFamily"?this.createFontFamilyComboBox(i):this.createToolButton(i,l),this._toolCompWidgets[l]=r}this.updateToolButtonStates()}},createFontFamilyComboBox:function(t){for(var n=new Kekule.Widget.ComboBox(t),i=Kekule.Widget.FontEnumerator.getAvailableFontFamilies(this.getCandidateFontFamilies()),r=[],a=0,o=i.length;a<o;++a)r.push({text:i[a],value:i[a]});return n.setHint(Kekule.$L("WidgetTexts.HINT_CHOOSE_FONT_FAMILY")),n.addClassName(e.TEXTEDITOR_FONTBOX),n.setItems(r),n.appendToWidget(t),n.addEventListener("valueChange",function(l){this.setTextStyle({fontFamily:n.getValue()})},this),n},createToolButton:function(t,n){var i,r,a,o=new(n==="textWrap"?Kekule.Widget.CheckButton:Kekule.Widget.Button)(t);return o.appendToWidget(t),n==="textWrap"?(i=Kekule.$L("WidgetTexts.CAPTION_TOGGLE_TEXTWRAP"),r=Kekule.$L("WidgetTexts.HINT_TOGGLE_TEXTWRAP"),a=e.TEXTEDITOR_BTN_TEXTWRAP,o.setChecked(this.getWrap()!=="off"),o.addEventListener("checkChange",function(l){var u=o.getChecked();this.setWrap(u?"soft":"off")},this)):n==="fontSizeInc"?(i=Kekule.$L("WidgetTexts.CAPTION_INC_TEXT_SIZE"),r=Kekule.$L("WidgetTexts.HINT_INC_TEXT_SIZE"),a=e.TEXTEDITOR_BTN_FONTSIZEINC,o.addEventListener("execute",this.increaseTextSize,this)):n==="fontSizeDec"&&(i=Kekule.$L("WidgetTexts.CAPTION_DEC_TEXT_SIZE"),r=Kekule.$L("WidgetTexts.HINT_DEC_TEXT_SIZE"),a=e.TEXTEDITOR_BTN_FONTSIZEDEC,o.addEventListener("execute",this.decreaseTextSize,this)),o.setText(i),o.setHint(r),o.addClassName(a),o},createToolCheckButton:function(t,n){var i=new Kekule.Widget.CheckButton(t);return i.appendToWidget(t),i},getToolbarComponentWidget:function(t){return this._toolCompWidgets[t]},createTextArea:function(){var t=new Kekule.Widget.TextArea(this);return this.setPropStoreFieldValue("textArea",t),t.addClassName(e.TEXTEDITOR_TEXTAREA),t.addEventListener("valueChange",this._checkAutoWrap,this),t.addEventListener("valueInput",this._checkAutoWrap,this),t},updateChildWidgetPos:function(){var t=this.getToolbarPos(),n=this.getToolbar().getElement(),i=this.getTextArea().getElement(),r=n.parentNode;t===Kekule.Widget.Position.BOTTOM?r.insertBefore(i,n):r.insertBefore(n,i)},updateToolButtonStates:function(){var t=this._toolCompWidgets.textWrap;t&&t.setChecked(this.getWrap()!=="off")},setTextStyle:function(t){var n=this.getTextArea();if(n)for(var i=Kekule.ObjUtils.getOwnedFieldNames(t),r=0,a=i.length;r<a;++r){var o=i[r];n.setStyleProperty(o,t[o])}return this},increaseTextSize:function(){var t=this.getFontSizeLevel()||1,n=Kekule.ZoomUtils.getNextZoomInRatio(t);this.setFontSizeLevel(n)},decreaseTextSize:function(){var t=this.getFontSizeLevel()||1,n=Kekule.ZoomUtils.getNextZoomOutRatio(t);this.setFontSizeLevel(n)},_checkAutoWrap:function(){var t=this.getAutoWrapThreshold();if(t){var n=this.getToolbarComponentWidget("textWrap"),i=((this.getWrap()||"").toLowerCase(),this.getValue()||""),r=i.split(`
`).length,a=i.length/r;n.setChecked(a>t)}}})}(),function(){var e=Kekule.ArrayUtils,t=Kekule.StyleUtils,n=Kekule.DomUtils,i=Kekule.HtmlElementUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_GRID:"K-Widget-Grid",WIDGET_GRID_CELL:"K-Widget-Grid-Cell",WIDGET_GRID_ADD_CELL:"K-Widget-Grid-Add-Cell",WIDGET_GRID_INTERACTION_AREA:"K-Widget-Grid-Interaction-Area",WIDGET_GRID_WIDGET_PARENT:"K-Widget-Grid-Widget-Parent",WIDGET_GRID_BUTTON_REMOVE:"K-Widget-Grid-Button-Remove",WIDGET_GRID_ENABLE_CELL_INTERACTION:"K-Widget-Grid-Enable-Cell-Interaction"});var r=Kekule.Widget.HtmlClassNames;Kekule.Widget.WidgetGrid=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGrid",CELL_FIELD:"__$cell__",WIDGET_FIELD:"__$cellWidget__",INTERACTION_AREA_FIELD:"__$interactionArea__",EXCEED_TOPRIGHT_FIELD:"__$exceedTopRight__",BTN_REMOVE_CELL_FIELD:"__$removeCell__",initialize:function(a){this._floatClearer=null,this.reactCellMouseEnterBind=this.reactCellMouseEnter.bind(this),this.reactCellMouseLeaveBind=this.reactCellMouseLeave.bind(this),this.reactCellClickBind=this.reactCellClick.bind(this),this.tryApplySuper("initialize",[a]),this.addEventListener("change",this.reactChildWidgetChange,this)},initProperties:function(){this.defineProp("childWidgetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("cellWidth",{dataType:DataType.STRING}),this.defineProp("cellHeight",{dataType:DataType.STRING}),this.defineProp("widgetPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position}),this.defineProp("autoShrinkWidgets",{dataType:DataType.BOOL}),this.defineProp("keepWidgetAspectRatio",{dataType:DataType.BOOL}),this.defineProp("restoreWidgetSizeOnHotTrack",{dataType:DataType.BOOL}),this.defineProp("enableAdd",{dataType:DataType.BOOL,setter:function(a){if(this.setPropStoreFieldValue("enableAdd",a),a)this.setAddingCell(this.createAddCell());else{var o=this.getAddingCell();o&&this.getContainerElement().removeChild(o)}}}),this.defineProp("enableRemove",{dataType:DataType.BOOL,getter:function(){return this.hasClassName(r.WIDGET_GRID_ENABLE_CELL_INTERACTION)},setter:function(a){a?this.addClassName(r.WIDGET_GRID_ENABLE_CELL_INTERACTION):this.removeClassName(r.WIDGET_GRID_ENABLE_CELL_INTERACTION)}}),this.defineProp("hotCell",{dataType:DataType.OBJECT,serializable:!1,setter:function(a){this.getHotCell()!==a&&(this.hotCellChanged(this.getHotCell(),a),this.setPropStoreFieldValue("hotCell",a))}}),this.defineProp("addingCell",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.setPropStoreFieldValue("autoShrinkWidgets",!0),this.setPropStoreFieldValue("keepWidgetAspectRatio",!0),this.setPropStoreFieldValue("restoreWidgetSizeOnHotTrack",!0),this.setEnableRemove(!0),this.setUseCornerDecoration(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+r.WIDGET_GRID},doCreateRootElement:function(a){return a.createElement("div")},doSetUseCornerDecoration:function(a){this.tryApplySuper("doSetUseCornerDecoration",[a]),this.updateAllCells()},doObjectChange:function(a){this.tryApplySuper("doObjectChange",[a]),e.intersect(a,["autoShrinkWidgets","keepWidgetAspectRatio","cellWidth","cellHeight","widgetPos"]).length>0&&this.updateAllCells()},doWidgetShowStateChanged:function(a){return a&&this.updateAllCells(),this.tryApplySuper("doWidgetShowStateChanged",[a])},each:function(a){for(var o=Kekule.ArrayUtils.clone(this.getChildWidgets()),l=0,u=o.length;l<u;++l)a(o[l])},addWidget:function(a){a.setParent(this)},removeWidget:function(a,o){this.hasChild(a)&&(a.setParent(null),o&&a.finalize())},createWidget:function(){var a=this.doCreateNewChildWidget(this.getDocument());if(a)return a.setParent(this),a},doCreateNewChildWidget:function(a){return null},getFloatClearer:function(){return this._floatClearer||(this._floatClearer=this.getDocument().createElement("div"),this._floatClearer.style.clear="both",this.getContainerElement().appendChild(this._floatClearer)),this._floatClearer},createCell:function(a){var o=!a,l=this.getDocument(),u=l.createElement("div");u.className=r.WIDGET_GRID_CELL+" "+r.DYN_CREATED+(o?" "+r.WIDGET_GRID_ADD_CELL:""),u[this.WIDGET_FIELD]=a,Kekule.X.Event.addListener(u,"mouseenter",this.reactCellMouseEnterBind),Kekule.X.Event.addListener(u,"mouseleave",this.reactCellMouseLeaveBind),Kekule.X.Event.addListener(u,"click",this.reactCellClickBind);var c=l.createElement("div");if(c.className=r.WIDGET_GRID_WIDGET_PARENT+" "+r.DYN_CREATED,c[this.WIDGET_FIELD]=a,o&&(c.innerHTML=Kekule.$L("WidgetTexts.CAPTION_ADD_CELL"),c.title=Kekule.$L("WidgetTexts.HINT_ADD_CELL")),u.appendChild(c),a&&(a.appendToElem(c),a[this.CELL_FIELD]=u),!o){var d=l.createElement("div");d.className=r.WIDGET_GRID_INTERACTION_AREA+" "+r.DYN_CREATED,u.appendChild(d),c[this.INTERACTION_AREA_FIELD]=d,u[this.INTERACTION_AREA_FIELD]=d,this.createCellInteractionWidgets(d,u)}return this.getAddingCell()&&!o?this.getContainerElement().insertBefore(u,this.getAddingCell()):this.getContainerElement().insertBefore(u,this.getFloatClearer()),this.updateCell(u),u},createAddCell:function(){return this.createCell(null)},createCellInteractionWidgets:function(a,o){var l=new Kekule.Widget.Button(a.ownerDocument);l.setText(Kekule.$L("WidgetTexts.CAPTION_REMOVE_CELL")),l.setHint(Kekule.$L("WidgetTexts.HINT_REMOVE_CELL")),l.addClassName(r.WIDGET_GRID_BUTTON_REMOVE),l[this.BTN_REMOVE_CELL_FIELD]=!0;var u=this.getContainingWidget(o);l[this.WIDGET_FIELD]=u,l.setShowText(!1),l.setShowGlyph(!0),l.addEventListener("execute",function(c){var d=c.widget[this.WIDGET_FIELD];this.removeWidget(d,!0)},this),l.appendToElem(a)},getWidgetCell:function(a){return a[this.CELL_FIELD]},getWidgetParentElem:function(a){var o=a.getElement();return o&&o.parentNode},getWidgetParentElemOfCell:function(a){return a.children[0]},getInteractionAreaElemOfCell:function(a){return a[this.INTERACTION_AREA_FIELD]},getContainingWidget:function(a){return a[this.WIDGET_FIELD]},childWidgetAdded:function(a){this.tryApplySuper("childWidgetAdded",[a]),this.createCell(a)},childWidgetRemoved:function(a){this.tryApplySuper("childWidgetRemoved",[a]);var o=this.getWidgetCell(a);this.getContainerElement().removeChild(o)},childWidgetMoved:function(a,o){this.tryApplySuper("childWidgetMoved",[a,o]);var l=this.getWidgetCell(a),u=this.getChildWidgets()[o+1],c=u?this.getWidgetCell(u):null;c?this.getContainerElement().insertBefore(l,c):this.getContainerElement().appendChild(l)},childrenModified:function(){this.getContainerElement().appendChild(this.getFloatClearer())},getAllCells:function(){for(var a=this.getChildWidgets(),o=[],l=0,u=a.length;l<u;++l)o.push(this.getWidgetCell(a[l]));return this.getAddingCell()&&o.push(this.getAddingCell()),o},updateCell:function(a,o){var l=a.style,u=this.getCellWidth(),c=this.getCellHeight();u?l.width=u:t.removeStyleProperty(l,"width"),c?l.height=c:t.removeStyleProperty(l,"height"),this.getUseCornerDecoration()?i.addClass(a,r.CORNER_ALL):i.removeClass(a,r.CORNER_ALL),this.adjustCellWidgetPos(a,o),this.adjustInteractionArea(a,o)},adjustCellWidgetPos:function(a,o){for(var l=this.getWidgetParentElemOfCell(a),u=i.getElemOffsetDimension(l),c=i.getElemClientDimension(a),d=["top","right","bottom","left"],h={},p=0,g=d.length;p<g;++p){var f=t.getComputedStyle(a,"padding-"+d[p]);h[d[p]]=t.analysisUnitsValue(f).value||0}var m=Object.extend({},c);m.width-=h.left+h.right,m.height-=h.top+h.bottom;var C=this.getWidgetPos(),_=Kekule.Widget.Position,y=C&_.LEFT?h.left:C&_.RIGHT?c.width-u.width-h.right:(m.width-u.width)/2+h.left,T=C&_.TOP?h.top:C&_.BOTTOM?c.height-u.height-h.bottom:(m.height-u.height)/2+h.top;l.style.left=y+"px",l.style.top=T+"px";var E=this.getInteractionAreaElemOfCell(a);if(E){var b=i.getElemClientDimension(E),v=y+u.width+b.width>=c.width&&T<=b.height;a[this.EXCEED_TOPRIGHT_FIELD]=v}if(this.getAutoShrinkWidgets()&&!o||!this.getRestoreWidgetSizeOnHotTrack()){var I=u.width>m.width?m.width/u.width:null,R=u.height>m.height?m.height/u.height:1;if(this.getKeepWidgetAspectRatio()){var N=I&&R?Math.min(I,R):I||R;I=N,R=N}l.style.transform="scale("+I+", "+R+")";var L=C&_.LEFT?"0":C&_.RIGHT?"100%":"50%",U=C&_.TOP?"0":C&_.BOTTOM?"100%":"50%";l.style.transformOrigin=L+" "+U}else l.style.transform="none"},adjustInteractionArea:function(a,o){var l=this.getInteractionAreaElemOfCell(a);l&&(o?a[this.EXCEED_TOPRIGHT_FIELD]&&this.getWidgetParentElemOfCell(a).appendChild(l):a.appendChild(l))},updateAllCells:function(){for(var a=this.getAllCells(),o=0,l=a.length;o<l;++o)this.updateCell(a[o],a[o]===this.getHotCell())},restoreCellShrink:function(a){var o=this.getWidgetParentElemOfCell(a);o&&(o.style.transform="none")},hotCellChanged:function(a,o){a&&(this.updateCell(a,!1),i.removeClass(a,r.STATE_HOVER)),o&&(i.addClass(o,r.STATE_HOVER),this.getRestoreWidgetSizeOnHotTrack()&&(this.restoreCellShrink(o),this.adjustInteractionArea(o,!0)))},reactCellMouseEnter:function(a){var o=a.getTarget();this.setHotCell(o)},reactCellMouseLeave:function(a){var o=a.getTarget();this.getHotCell()===o&&this.setHotCell(null)},reactCellClick:function(a){var o=a.getTarget();(n.isDescendantOf(o,this.getAddingCell())||o===this.getAddingCell())&&this.createWidget()},reactChildWidgetChange:function(a){var o=a.widget;o&&this.hasChild(o)&&this.updateCell(this.getWidgetCell(o),this.getHotCell()===this.getWidgetCell(o))}})}(),function(){var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,n=Kekule.StyleUtils,i=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{PROPLISTEDITOR:"K-PropListEditor",PROPLISTEDITOR_PROPEXPANDMARKER:"K-PropListEditor-PropExpandMarker",PROPLISTEDITOR_PROPEXPANDED:"K-PropListEditor-PropExpanded",PROPLISTEDITOR_PROPCOLLAPSED:"K-PropListEditor-PropCollapsed",PROPLISTEDITOR_INDENTDECORATOR:"K-PropListEditor-IndentDecorator",PROPLISTEDITOR_READONLY:"K-PropListEditor-ReadOnly",OBJINSPECTOR:"K-ObjInspector",OBJINSPECTOR_FLEX_LAYOUT:"K-ObjInspector-Flex-Layout",OBJINSPECTOR_SUBPART:"K-ObjInspector-SubPart",OBJINSPECTOR_OBJSINFOPANEL:"K-ObjInspector-ObjsInfoPanel",OBJINSPECTOR_PROPINFOPANEL:"K-ObjInspector-PropInfoPanel",OBJINSPECTOR_PROPINFO_TITLE:"K-ObjInspector-PropInfoPanel-Title",OBJINSPECTOR_PROPINFO_DESCRIPTION:"K-ObjInspector-PropInfoPanel-Description",OBJINSPECTOR_PROPLISTEDITOR_CONTAINER:"K-ObjInspector-PropListEditorContainer"}),Kekule.Widget.ObjPropListEditor=Class.create(Kekule.Widget.ValueListEditor,{CLASS_NAME:"Kekule.Widget.ObjPropListEditor",PARENT_ROW_FIELD:"__$parentRow__",SUB_ROWS_FIELD:"__$subRows__",initialize:function(r){this.tryApplySuper("initialize",[r]),this.setValueDisplayMode(Kekule.Widget.ValueListEditor.ValueDisplayMode.SIMPLE),this.setPropStoreFieldValue("displayedPropScopes",[Class.PropertyScope.PUBLISHED]),this.setEnableLiveUpdate(!0),this.setSubPropNamePadding("1em"),this.setUseKeyHint(!0)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(r){var a=Kekule.ArrayUtils.toArray(r),o=this.getObjects();this.setPropStoreFieldValue("objects",a),this.inspectedObjectsChanged(a,o)}}),this.defineProp("displayedPropScopes",{dataType:DataType.ARRAY,setter:function(r){this.setPropStoreFieldValue("displayedPropScopes",r),this.updateAll()}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("subPropNamePadding",{dataType:DataType.STRING}),this.defineProp("activePropEditor",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var r=this.getActiveRow();return r?this.getRowPropEditor(r):null}}),this.defineProp("keyField",{dataType:DataType.STRING}),this.defineProp("sortField",{dataType:DataType.STRING}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC})},doFinalize:function(){this.tryApplySuper("doFinalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setKeyField("title"),this.setSortField("key")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.PROPLISTEDITOR},inspectedObjectsChanged:function(r,a){var o=Kekule.ArrayUtils.toArray(r);a&&this._uninstallObjectsEventHandlers(a),r&&this._installObjectsEventHandlers(o),this.updateAll(o)},_installObjectsEventHandlers:function(r){for(var a=0,o=r.length;a<o;++a){var l=r[a];l.addEventListener&&l.addEventListener("change",this.reactObjectsChange,this)}},_uninstallObjectsEventHandlers:function(r){for(var a=0,o=r.length;a<o;++a){var l=r[a];l.removeEventListener&&l.removeEventListener("change",this.reactObjectsChange,this)}},reactObjectsChange:function(r){if(this.getEnableLiveUpdate()){var a=r.changedPropNames;this.updateValues(a)}},getKeyCellExpandMarker:function(r,a){var o=null,l=this.getCellContentWrapper(r,a);if(l){for(var u=e.getDirectChildElems(l)||[],c=0,d=u.length;c<d;++c){var h=u[c];if(t.hasClass(h,i.PROPLISTEDITOR_PROPEXPANDMARKER)){o=h;break}}if(!o&&a){o=this.getDocument().createElement("span"),t.addClass(o,i.PROPLISTEDITOR_PROPEXPANDMARKER);var p=e.getChildNodesOfTypes(l,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];l.insertBefore(o,p)}}return o},getKeyCellIndentDecorator:function(r,a){var o=null,l=this.getCellContentWrapper(r,a);if(l){for(var u=e.getDirectChildElems(l)||[],c=0,d=u.length;c<d;++c){var h=u[c];if(t.hasClass(h,i.PROPLISTEDITOR_INDENTDECORATOR)){o=h;break}}if(!o&&a){o=this.getDocument().createElement("div"),t.addClass(o,i.PROPLISTEDITOR_INDENTDECORATOR);var p=e.getChildNodesOfTypes(l,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];l.insertBefore(o,p)}}return o},setRowKeyCellContent:function(r,a,o){var l=this.tryApplySuper("setRowKeyCellContent",[r,a,o]),u=this.getKeyCell(r),c=(this.getKeyCellExpandMarker(u,!0),this.getRowSubLevel(r)),d=this.getSubPropNamePadding();if(d){Kekule.StyleUtils.multiplyUnitsValue(d,c),d=Kekule.StyleUtils.multiplyUnitsValue(d,c);var h=this.getKeyCell(r);this.getCellContentWrapper(h,!0).style.paddingLeft=d}return l},updateAll:function(r){if(r||(r=this.getObjects()),r&&r.length){this.setActiveRow(null),this.collapseAllRows(),r[0];var a=this.getDisplayPropEditors(r);this.sortPropEditors(a),r.length;var o=this.getRows(),l=o.length,u=a.length,c=0,d=0,h=this.getValueDisplayMode();for(c=0;c<u;++c){var p=a[c];if(p.setValueTextMode(h),this.isPropEditorVisible(p)){var g=d<l?o[d]:this.appendRow();this.setRowPropEditor(g,p),++d}}if(l>d)for(c=l-1;c>=d;--c)this.removeRow(o[c]);return this}this.clear()},updateValues:function(r){for(var a=r&&r.length,o=this.getRows(),l=0,u=o.length;l<u;++l){var c=o[l];if(a){var d=this.getRowPropEditor(c);if(!d||r.indexOf(d.getPropertyName())<0)continue}this.updateRowPropValue(c)}},updateRowPropValue:function(r){var a=this.getRowPropEditor(r).getValueText(),o=this.getRowData(r);o.value=a,this.setRowData(r,o),this.updateRowExpandState(r);var l=this.getSubPropRows(r);if(l)for(var u=0,c=l.length;u<c;++u)this.updateRowPropValue(l[u])},setRowPropEditor:function(r,a){var o,l=this.getKeyField()||"title";l&&(l==="name"?o=a.getPropertyName():l==="title"?o=a.getTitle():o=a.getPropertyInfo()[l]),o||(o=a.getTitle()||a.getPropertyName());var u={key:a.getPropertyName(),value:a.getValueText(),title:o,hint:a.getHint(),propEditor:a,expanded:!1};a.isReadOnly()?t.addClass(r,i.PROPLISTEDITOR_READONLY):t.removeClass(r,i.PROPLISTEDITOR_READONLY),this.setRowData(r,u),this.updateRowExpandState(r)},getRowCascadeKey:function(r){if(r&&this.getRowData(r)){var a=this.getRowData(r).key,o=this.getParentPropRow(r);return o&&(a=this.getRowCascadeKey(o)+"."+a),a}return null},getActiveRowCascadeKey:function(){var r=this.getActiveRow();return r&&this.getRowCascadeKey(r)},getRowPropEditor:function(r){var a=this.getRowData(r);return a?a.propEditor:null},getPropEditor:function(r,a){var o=Kekule.PropertyEditor.findEditorClass(r,a);return o?new o:null},getPropEditorForType:function(r,a){var o=Kekule.PropertyEditor.findEditorClassForType(r,a);return o?new o:null},isPropEditorVisible:function(r){var a=!0;if(a=!(r.getObjects().length>1)||r.getAttributes()&Kekule.PropertyEditor.EditorAttributes.MULTIOBJS){var o=r.getPropertyInfo();if(o){var l=o.scope||Class.PropertyScope.DEFAULT;if(l){var u=this.getDisplayedPropScopes();u&&(a=u.indexOf(l)>=0)}}}return a},isRowExpandable:function(r){var a=this.getRowPropEditor(r);return!!a&&a.hasSubPropertyEditors()},isRowExpanded:function(r){return!!this.getRowData(r).expanded},updateRowExpandState:function(r){var a=this.isRowExpandable(r);a||this.removeSubPropertyRows(r),t.removeClass(r,i.PROPLISTEDITOR_PROPCOLLAPSED),t.removeClass(r,i.PROPLISTEDITOR_PROPEXPANDED),a&&(this.isRowExpanded(r)?t.addClass(r,i.PROPLISTEDITOR_PROPEXPANDED):t.addClass(r,i.PROPLISTEDITOR_PROPCOLLAPSED))},expandRow:function(r){return this._doExpandRow(r),this},_doExpandRow:function(r){if(this.isRowExpandable(r)&&!this.isRowExpanded(r)){t.removeClass(r,i.PROPLISTEDITOR_PROPCOLLAPSED),t.addClass(r,i.PROPLISTEDITOR_PROPEXPANDED),this.getRowData(r).expanded=!0;var a=this.getRowPropEditor(r).getSubPropertyEditors(this.getDisplayedPropScopes());return r[this.SUB_ROWS_FIELD]=this.addSubPropertyRows(r,a),r[this.SUB_ROWS_FIELD]}return null},collapseRow:function(r){return this.isRowExpandable(r)&&this.isRowExpanded(r)&&(t.removeClass(r,i.PROPLISTEDITOR_PROPEXPANDED),t.addClass(r,i.PROPLISTEDITOR_PROPCOLLAPSED),this.getRowData(r).expanded=!1,this.removeSubPropertyRows(r)),this},toggleRowExpandState:function(r){return this.isRowExpanded(r)?this.collapseRow(r):this.expandRow(r),this},collapseAllRows:function(){for(var r=this.getRows(),a=0,o=r.length;a<o;++a)this.collapseRow(r[a]);return this},expandAllRows:function(r){var a=this,o=function(u,c){for(var d=0,h=u.length;d<h;++d){var p=a._doExpandRow(u[d]);p&&c&&o(p,c)}},l=this.getRows();return o(l,r),this},addSubPropertyRows:function(r,a){var o=this.getNextRow(r),l=[];if(a&&a.length){this.sortPropEditors(a);for(var u=0,c=a.length;u<c;++u){var d=a[u];this.isPropEditorVisible(d)&&l.push(this.addSubPropRow(r,d,o))}}return l},addSubPropRow:function(r,a,o){var l=this.insertRowBefore(null,o);return l[this.PARENT_ROW_FIELD]=r,this.setRowPropEditor(l,a),l},removeSubPropertyRows:function(r){for(var a=this.getSubPropRows(r),o=a.length-1;o>=0;--o)this.removeSubPropertyRows(a[o]),this.removeRow(a[o]);r[this.SUB_ROWS_FIELD]=null},getSubPropRows:function(r){return r[this.SUB_ROWS_FIELD]||[]},getParentPropRow:function(r){return r[this.PARENT_ROW_FIELD]},getRowSubLevel:function(r){for(var a=0,o=this.getParentPropRow(r);o;)++a,o=this.getParentPropRow(o);return a},getValueCellText:function(r,a){return a.value},finishEditing:function(){var r=this.getActiveRow(),a=this.getRowPropEditor(r);if(a){var o=this.getOperHistory(),l=this.getEnableOperHistory()&&o,u=a.getValue();if(a.saveEditValue()){if(l){var c=new Kekule.Widget.PropEditorModifyOperation(a,a.getValue(),u);o.push(c)}this.updateValues(),this.invokeEvent("propertyChange",{propertyEditor:a,propertyInfo:a.getPropertyInfo(),oldValue:u,newValue:a.getValue()}),this.invokeEvent("editFinish",{row:r})}}return this},doCreateValueEditWidget:function(r){var a=this.getRowPropEditor(r),o=a.createEditWidget(this);return o?(this.getReadOnly()||a.isReadOnly())&&o.setReadOnly&&o.setReadOnly(!0):o=this.doCreateDefaultValueEditWidget(r),o},doCreateDefaultValueEditWidget:function(r){var a=new Kekule.Widget.TextBox(this);a.setReadOnly(!0);var o=this.getRowData(r).value;return a.setValue(o),a},isOperHistoryAvailable:function(){return this.getOperHistory()&&this.getEnableOperHistory()},undo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().undo(),this},redo:function(){return this.isOperHistoryAvailable()&&this.getOperHistory().redo(),this},getCommonSuperClass:function(r){return ClassEx.getCommonSuperClass(r)},getCommonPropNames:function(r){var a=[],o=this.getCommonSuperClass(r);if(o)for(var l=ClassEx.getPropListOfScopes(o,this.getDisplayedPropScopes()),u=0,c=l.getLength();u<c;++u){var d=l.getPropInfoAt(u);a.push(d.name)}return a},getDisplayPropNames:function(r){return this.getCommonPropNames(r)},getDisplayPropEditors:function(r){var a=[],o=this.getCommonSuperClass(r);if(o)(l=this.getPropEditor(null,{dataType:ClassEx.getClassName(o)}))&&(l.setObjects(r),a=a.concat(l.getSubPropertyEditors(this.getDisplayedPropScopes())||[]));else if(r.length===1){var l,u=r[0];DataType.isObjectValue(u)&&(l=this.getPropEditorForType("object"))&&(l.setObjects(u),a=a.concat(l.getSubPropertyEditors()||[]))}return a},sortPropEditors:function(r){var a=this.getSortField();if(a){a==="key"&&this.getKeyField();var o=function(l,u){return l[u]||l.name};r.sort(function(l,u){var c=o(l.getPropertyInfo(),a),d=o(u.getPropertyInfo(),a);return c<d?-1:c>d?1:0})}},getObjPropValue:function(r,a){return r instanceof ObjectEx?r.getPropValue(a):r instanceof Object?r[a]:void 0},getObjsPropValue:function(r,a){for(var o=r[0],l=this.getObjPropValue(o,a),u=1,c=r.length;u<c;++u)if(o=r[u],this.getObjPropValue(o,a)!==l)return;return l},react_click:function(r){var a=r.getTarget(),o=this.getParentRow(a);o&&a===this.getKeyCellExpandMarker(this.getKeyCell(o),!1)&&this.toggleRowExpandState(o),this.tryApplySuper("react_click",[r])},react_dblclick:function(r){var a=r.getTarget(),o=this.getParentCell(a);if(o){var l=this.getParentRow(o);o===this.getKeyCell(l)&&this.toggleRowExpandState(l)}},react_keydown:function(r){this.tryApplySuper("react_keydown",[r]);var a=r.getKeyCode();if(!(r.getAltKey()||r.getShiftKey()||r.getCtrlKey())){var o=this.getActiveRow();o&&(a===Kekule.X.Event.KeyCode.RIGHT?this.expandRow(o):a===Kekule.X.Event.KeyCode.LEFT&&this.collapseRow(o))}}}),Kekule.Widget.ObjectInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ObjectInspector",initialize:function(r){this._propListElem=null,this._objsInfoElem=null,this._propInfoElem=null,this.setPropStoreFieldValue("showObjsInfoPanel",!0),this.setPropStoreFieldValue("showPropInfoPanel",!0),this.tryApplySuper("initialize",[r])},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(r){var a=Kekule.ArrayUtils.toArray(r);this.setPropStoreFieldValue("objects",a),this.inspectedObjectsChanged(a)}}),this.defineProp("readOnly",{dataType:DataType.BOOL,getter:function(){var r=this.getPropEditor();return r&&r.getReadOnly()},setter:function(r){var a=this.getPropEditor();a&&a.setReadOnly(r)}}),this.defineProp("propEditor",{dataType:"Kekule.Widget.ObjPropListEditor",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("showObjsInfoPanel",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("showObjsInfoPanel",r),n.setDisplay(this._objsInfoElem,!!r),this._updateChildElemSize()}}),this.defineProp("showPropInfoPanel",{dataType:DataType.BOOL,setter:function(r){this.setPropStoreFieldValue("showPropInfoPanel",r),n.setDisplay(this._propInfoElem,!!r),this._updateChildElemSize()}}),this.defineProp("keyField",{dataType:DataType.STRING,getter:function(){var r=this.getPropEditor();return r&&r.getKeyField()},setter:function(r){var a=this.getPropEditor();a&&a.setKeyField(r)}}),this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){var r=this.getPropEditor();return r&&r.getSortField()},setter:function(r){var a=this.getPropEditor();a&&a.setSortField(r)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var r=this.getPropEditor();return r&&r.getActiveRow()},setter:function(r){var a=this.getPropEditor();a&&a.setActiveRow(r)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){var r=this.getPropEditor();return!!r&&r.getEnableOperHistory()},setter:function(r){var a=this.getPropEditor();return a?a.setEnableOperHistory(r):null}}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var r=this.getPropEditor();return r?r.getOperHistory():null},setter:function(r){var a=this.getPropEditor();return a?a.setOperHistory(r):null}})},doFinalize:function(){this._finalizeChildWidgets(),this.tryApplySuper("doFinalize")},getChildrenHolderElement:function(){return this._propListElem||this.tryApplySuper("getChildrenHolderElement")},doGetWidgetClassName:function(){var r=i.OBJINSPECTOR;return this._isUsingFlexLayout()&&(r+=" "+i.OBJINSPECTOR_FLEX_LAYOUT),r},_isUsingFlexLayout:function(){return!!Kekule.BrowserFeature.cssFlex},doBindElement:function(r){this.tryApplySuper("doBindElement",[r]),this._updateChildElemSize()},doCreateRootElement:function(r){return r.createElement("div")},doCreateSubElements:function(r,a){var o=this.tryApplySuper("doCreateSubElements",[r,a])||[],l=this._createSubPartElem(r);t.addClass(l,i.OBJINSPECTOR_OBJSINFOPANEL),a.appendChild(l),this._objsInfoElem=l;var u=this._createSubPartElem(r);t.addClass(u,i.OBJINSPECTOR_PROPINFOPANEL),a.appendChild(u),this._propInfoElem=u;var c=this._createSubPartElem(r);return t.addClass(c,i.OBJINSPECTOR_PROPLISTEDITOR_CONTAINER),a.appendChild(c),this._propListElem=c,this._createChildWidgets(c),o.concat([l,u,c])},_createSubPartElem:function(r){var a=r.createElement("div");return a.className=i.OBJINSPECTOR_SUBPART,a},_createChildWidgets:function(r){this._finalizeChildWidgets();var a=new Kekule.Widget.ObjPropListEditor(this);a.appendToWidget(this);var o=this;a.addEventListener("activeRowChange",function(l){o._updatePropInfo()}),this.setPropStoreFieldValue("propEditor",a)},_finalizeChildWidgets:function(){var r=this.getPropEditor();r&&r.finalize()},inspectedObjectsChanged:function(r){var a=this.getPropEditor();a&&a.setObjects(r),this._updateObjectsInfo(r),this._updatePropInfo()},_updateObjectsInfo:function(r){if(this._objsInfoElem){var a;if(r.length<=0)a=Kekule.$L("WidgetTexts.S_INSPECT_NONE");else if(r.length===1){var o=r[0],l=o.getId?o.getId():null,u=DataType.getType(o);a=l?Kekule.$L("WidgetTexts.S_INSPECT_ID_OBJECT").format(l,u):Kekule.$L("WidgetTexts.S_INSPECT_ANONYMOUS_OBJECT").format(u)}else a=Kekule.$L("WidgetTexts.S_INSPECT_OBJECTS").format(r.length);e.setElementText(this._objsInfoElem,a)}},_updatePropInfo:function(){if(this._propInfoElem){this._propInfoElem.innerHTML="";var r=this.getPropEditor().getActivePropEditor();if(r){var a,o=r.getTitle(),l=r.getDescription()||r.getPropertyType()||"",u=this._propInfoElem.ownerDocument;(a=u.createElement("div")).className=i.OBJINSPECTOR_PROPINFO_TITLE,e.setElementText(a,o),this._propInfoElem.appendChild(a),(a=u.createElement("div")).className=i.OBJINSPECTOR_PROPINFO_DESCRIPTION,e.setElementText(a,l),this._propInfoElem.appendChild(a)}}},undo:function(){return this.getPropEditor()&&this.getPropEditor().undo(),this},redo:function(){return this.getPropEditor()&&this.getPropEditor().redo(),this},getRowCascadeKey:function(r){var a=this.getPropEditor();return a&&a.getRowCascadeKey(r)},getActiveRowCascadeKey:function(){var r=this.getPropEditor();return r&&r.getActiveRowCascadeKey()},isRowExpandable:function(r){var a=this.getPropEditor();return a&&a.isRowExpandable(r)},isRowExpanded:function(r){var a=this.getPropEditor();return a&&a.isRowExpanded(r)},expandRow:function(r){var a=this.getPropEditor();return a&&a.expandRow(r),this},collapseRow:function(r){var a=this.getPropEditor();return a&&a.collapseRow(r),this},toggleRowExpandState:function(r){var a=this.getPropEditor();return a&&a.toggleRowExpandState(r),this},collapseAllRows:function(){var r=this.getPropEditor();return r&&r.collapseAllRows(),this},expandAllRows:function(r){var a=this.getPropEditor();return a&&a.expandAllRows(r),this},_updateChildElemSize:function(){var r=this;this._isUsingFlexLayout()||setTimeout(function(){var a,o;a=r.getShowObjsInfoPanel()?n.getComputedStyle(r._objsInfoElem,"height"):0,o=r.getShowPropInfoPanel()?n.getComputedStyle(r._propInfoElem,"height"):0,r._propListElem.style.top=a,r._propListElem.style.bottom=o},100)},setUseCornerDecoration:function(r){return this.tryApplySuper("setUseCornerDecoration",[r])}})}(),function(){var e=Kekule.ArrayUtils;Kekule.Widget.PropertyEditor={},Kekule.PropertyEditor=Kekule.Widget.PropertyEditor,Kekule.PropertyEditor.BaseEditor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PropertyEditor.BaseEditor",initialize:function(){this.tryApplySuper("initialize"),this._editWidget=null},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:!1,setter:function(n){var i=Kekule.ArrayUtils;this.setPropStoreFieldValue("objects",i.clone(i.toArray(n)))}}),this.defineProp("propertyInfo",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("propertyName",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var n=this.getPropertyInfo();return n?n.name:null}}),this.defineProp("propertyType",{dataType:DataType.VARIANT,serializable:!1,setter:null,getter:function(){var n=this.getPropertyInfo();return n?n.dataType:null}}),this.defineProp("parentEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("valueTextMode",{dataType:DataType.INT}),this.defineProp("readOnly",{dataType:DataType.BOOL}),this.defineProp("allowEmpty",{dataType:DataType.BOOL})},finalize:function(){this.finalizeWidget(),this.tryApplySuper("finalize")},finalizeWidget:function(){this._editWidget&&(this._editWidget.finalize(),this._editWidget=null)},getEditWidget:function(){return this._editWidget},getObjPropValue:function(n,i){return Kekule.ObjUtils.isUnset(i)?n:n instanceof ObjectEx?n.getPropValue(i):DataType.isArrayValue(n)||n instanceof Object?n[i]:void 0},setObjPropValue:function(n,i,r){return n instanceof ObjectEx?n.setPropValue(i,r):n instanceof Object&&(n[i]=r),this},getObjsPropValue:function(n,i){if(n){if(Kekule.ObjUtils.isUnset(i))return n;for(var r=n[0],a=this.getObjPropValue(r,i),o=1,l=n.length;o<l;++o)if(r=n[o],this.getObjPropValue(r,i)!==a)return;return a}},setObjsPropValue:function(n,i,r){if(!n||!i)return this;for(var a=0,o=n.length;a<o;++a){var l=n[a];this.setObjPropValue(l,i,r)}return this},isReadOnly:function(){return!!(this.getAttributes()&t.READONLY)},hasSubPropertyEditors:function(){return!!(this.getAttributes()&t.SUBPROPS)},getAttributes:function(){var n=t.MULTIOBJS|t.SIMPLEVALUE,i=this.getPropertyInfo();return Kekule.ObjUtils.isUnset(this.getReadOnly())?i&&!i.setter&&(n|=t.READONLY):this.getReadOnly()&&(n|=t.READONLY),n},getSubPropertyEditors:function(n){return null},getTitle:function(){var n=this.getPropertyInfo();return n?n.title||n.name:""},getHint:function(){return this.getTitle()},getDescription:function(){return this.getPropertyInfo().description},getValue:function(){return this.getObjsPropValue(this.getObjects(),this.getPropertyName())},getValueText:function(){var n=Kekule.Widget.ValueListEditor.ValueDisplayMode,i=this.getValue(),r=this.getValueTextMode();try{var a=r===n.JSON?JSON.stringify(i):Kekule.ObjUtils.isUnset(i)?"":""+i}catch{return""+i}return a},setValue:function(n){var i=this.setObjsPropValue(this.getObjects(),this.getPropertyName(),n);return this.getParentEditor()&&this.getParentEditor().notifyChildEditorValueChange&&this.getParentEditor().notifyChildEditorValueChange(this.getPropertyName(),n),i},createEditWidget:function(n){var i=this.getValue(),r=this.doCreateEditWidget(n,i);return r&&r.setIsDirty&&r.setIsDirty(!1),this._editWidget=r,r},doCreateEditWidget:function(n){},saveEditValue:function(){if(this._editWidget){if(!this._editWidget.getIsDirty||this._editWidget.getIsDirty()){var n=this.doSaveEditValue();return this._editWidget.setIsDirty&&this._editWidget.setIsDirty(!1),n}return!1}return!1},doSaveEditValue:function(){},notifyChildEditorValueChange:function(n,i){}}),Kekule.PropertyEditor.EditorAttributes={MULTIOBJS:1,SUBPROPS:2,SIMPLEVALUE:4,VALUELIST:8,CUSTOMEDIT:16,READONLY:32,INLINE_EDIT:128,DROP_EDIT:256,POPUP_EDIT:512};var t=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.EditorMananger=Class.create({initialize:function(){this._registeredItems=[],this._defaultItems=[]},register:function(n,i,r,a,o){var l={editorClass:n,propType:i,objClass:r,propName:a,matchFunc:o};return this._registeredItems.push(l),i||r||a||o||this._defaultItems.push(l),this},unregister:function(n){for(var i=(r=this._registeredItems).length-1;i>=0;--i)r[i].editorClass===n&&r.splice(i,1);var r;for(i=(r=this._defaultItems).length-1;i>=0;--i)r[i].editorClass===n&&r.splice(i,1);return this},_getDefaultItem:function(){var n=this._defaultItems;return n[n.length-1]},_getSuperiorItem:function(n,i){for(var r=["matchFunc","propName","objClass","propType"],a=0,o=r.length;a<o;++a)if(!!n[r]!=!!i[r])return n[r]?n:i;return n},_isMatchedPropType:function(n,i){var r=n===i;if(!r&&DataType.isObjectExType(n)&&DataType.isObjectExType(i)){var a=ClassEx.findClass(n),o=ClassEx.findClass(i);r=ClassEx.isOrIsDescendantOf(a,o)}return r},_testOnPropType:function(n,i){return n.propType&&i.dataType?this._isMatchedPropType(i.dataType,n.propType)?1:-1:0},_testOnObjClass:function(n,i){return n.objClass&&i?ClassEx.isOrIsDescendantOf(i,n.objClass)?1:-1:0},_testOnPropName:function(n,i){return n.propName&&i.name?n.propName===i.name?1:-1:0},_testOnMatchFunc:function(n,i,r){return n.matchFunc?n.matchFunc(i,r)?1:-1:0},findEditorClass:function(n,i){for(var r=null,a=this._registeredItems,o=a.length-1;o>=0;--o){var l=a[o],u=this._testOnPropType(l,i);if(!(u<0)){var c=this._testOnObjClass(l,n);if(!(c<0)){var d=this._testOnPropName(l,i);if(!(d<0)){var h=this._testOnMatchFunc(l,n,i);if(!(h<0)&&u+c+d+h>0&&(r=r?this._getSuperiorItem(r,l.editorClass):l.editorClass)&&l.matchFunc)break}}}}return r||(r=(l=this._getDefaultItem())?l.editorClass:null),r},findEditorClassForType:function(n,i){var r={dataType:n,name:i};return this.findEditorClass(null,r)}}),Kekule.ClassUtils.makeSingleton(Kekule.PropertyEditor.EditorMananger),Kekule.PropertyEditor.findEditorClass=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClass.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.findEditorClassForType=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClassForType.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.register=Kekule.PropertyEditor.EditorMananger.getInstance().register.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.unregister=Kekule.PropertyEditor.EditorMananger.getInstance().unregister.bind(Kekule.PropertyEditor.EditorMananger.getInstance()),Kekule.PropertyEditor.SimpleEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SimpleEditor",convertStrToValue:function(n,i){return DataType.isSimpleType(i)?!n&&this.getAllowEmpty()?null:Kekule.StrUtils.convertToType(n,i):n},setValueText:function(n){if(n===this._originValueText)return!1;var i,r=this.getPropertyType();return!(r&&!DataType.isSimpleType(r))&&(i=r?this.convertStrToValue(n,r):n,this.setValue(i),!0)},doCreateEditWidget:function(n){var i=this.getValueText();return this._originValueText=i,new Kekule.Widget.TextBox(n,i)},doSaveEditValue:function(){return this.setValueText(this.getEditWidget().getValue())}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.SimpleEditor),Kekule.PropertyEditor.TextEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.TextEditor",LINE_BREAK_REPLACER:"\\n",textToSingleLine:function(n){return n.split(`
`).join(this.LINE_BREAK_REPLACER)},textToMultiLine:function(n){return n.split(this.LINE_BREAK_REPLACER).join(`
`)},doCreateEditWidget:function(n){this._parentWidget=n;var i=this.getValueText();this._originValueText=i;var r=new Kekule.Widget.ButtonTextBox(n,this.textToSingleLine(i));return this._textbox=r,r.setButtonKind(Kekule.Widget.Button.Kinds.POPUP),r.addEventListener("buttonExecute",this.reactButtonExecute,this),r},reactButtonExecute:function(n){this.openPopupEditor()},openPopupEditor:function(){var n=this._popupDialog;n||(n=this.createPopupDialog(),this._popupDialog=n);var i=this._popupEditor;i.setValue(this.getValueText());var r=this;n.openPopup(function(a){a===Kekule.Widget.DialogButtons.OK&&(r._textbox.setValue(r.textToSingleLine(i.getValue())),r._textbox.setIsDirty(!0),r.saveEditValue())},this._textbox)},createPopupDialog:function(){var n=this._parentWidget.getDocument(),i=new Kekule.Widget.Dialog(n,this.getPropertyName(),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);i.setLocation(Kekule.Widget.Location.CENTER_OR_FULLFILL);var r=new Kekule.Widget.TextArea(n),a=r.getElement().style;return a.width="40em",a.height="20em",r.appendToWidget(i),this._popupEditor=r,i},doSaveEditValue:function(){var n=this.getEditWidget().getValue();return(n=this.textToMultiLine(n))!==this._originValueText&&(this.setValueText(n),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.TextEditor,DataType.STRING),Kekule.PropertyEditor.BoolEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.BoolEditor",boolToStr:function(n){return Kekule.StrUtils.boolToStr(n)},doCreateEditWidget:function(n){this._originValue=this.getValue();var i=new Kekule.Widget.CheckBox(n,this._originValue);i.setText(this.boolToStr(this._originValue));var r=this;return i.addEventListener("valueChange",function(a){var o=i.getChecked();i.setText(r.boolToStr(o))}),i},getValueText:function(){var n=this.getValue();return Kekule.ObjUtils.isUnset(n)?Kekule.$L("WidgetTexts.S_VALUE_UNSET"):this.tryApplySuper("getValueText")},doSaveEditValue:function(){var n=this.getEditWidget().getChecked();return n!==this._originValue&&(this.setValue(n),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.BoolEditor,DataType.BOOL),Kekule.PropertyEditor.SelectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SelectEditor",getValueText:function(){for(var n=this.getValue(),i=this.getSelectItems()||[],r=0,a=i.length;r<a;++r){var o=i[r];if(o.value===n)return o.text}return this.tryApplySuper("getValueText")},getSelectItems:function(){return[]},doCreateEditWidget:function(n){var i=new Kekule.Widget.SelectBox(n,this.getSelectItems());return this._originalValue=this.getValue(),i.setValue(this._originalValue),i},doSaveEditValue:function(){var n=this.getEditWidget().getValue();return n!==this._originalValue&&(this.setValue(n),!0)}}),Kekule.PropertyEditor.EnumEditor=Class.create(Kekule.PropertyEditor.SelectEditor,{CLASS_NAME:"Kekule.PropertyEditor.EnumEditor",initialize:function(){this.tryApplySuper("initialize"),this.enumInfos=[]},setPropertyInfo:function(n){if(this.tryApplySuper("setPropertyInfo",[n]),n){var i=n.enumSource;if(i&&DataType.isObjectValue(i)){var r=Kekule.ObjUtils.getOwnedFieldNames(i);this.enumInfos=[];for(var a=0,o=r.length;a<o;++a)this.enumInfos.push({text:r[a],value:i[r[a]]})}}},getSelectItems:function(){var n=this.getValue();if(Kekule.ObjUtils.isUnset(n)){var i=Kekule.ArrayUtils.clone(this.enumInfos);return i.unshift({text:Kekule.$L("WidgetTexts.S_VALUE_UNSET"),value:n}),i}return this.enumInfos}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.EnumEditor,null,null,null,function(n,i){return!!i.enumSource}),Kekule.PropertyEditor.ObjectExEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectExEditor",getAttributes:function(){var n=this.tryApplySuper("getAttributes");return n|=t.SUBPROPS},hasSubPropertyEditors:function(){return this.tryApplySuper("hasSubPropertyEditors")&&this.getValue()},getSubPropertyEditors:function(n){var i=[],r=this.getValue();if(r){if(r instanceof ObjectEx)var a=r.getClass();else a=ClassEx.getCommonSuperClass(r);for(var o=ClassEx.getPropListOfScopes(a,n),l=0,u=o.getLength();l<u;++l){var c=o.getPropInfoAt(l),d=Kekule.PropertyEditor.findEditorClass(a,c);if(d){var h=new d;h.setObjects(Kekule.ArrayUtils.toArray(r)),h.setPropertyInfo(c),h.setValueTextMode(this.getValueTextMode()),i.push(h)}}}return i},getValueText:function(){var n=this.getValue();return Kekule.ObjUtils.notUnset(n)?n.getClassName?"["+n.getClassName()+"]":this.tryApplySuper("getValueText"):Kekule.$L("WidgetTexts.S_OBJECT_UNSET")}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectExEditor,"ObjectEx"),Kekule.PropertyEditor.ObjectFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectFieldEditor",initialize:function(){},doCreateEditWidget:function(n){if(!this.getPropertyType()){var i=this.getValue();this.getPropertyInfo().dataType=DataType.getType(i)}return this.tryApplySuper("doCreateEditWidget",[n])}}),Kekule.PropertyEditor.ObjectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectEditor",initialize:function(){this.tryApplySuper("initialize"),this._initialObjValue=void 0},getFieldEditorClass:function(n,i){return Kekule.PropertyEditor.findEditorClass(null,i)||Kekule.PropertyEditor.ObjectFieldEditor},getFieldValueType:function(n,i){var r=n[i];return Kekule.ObjUtils.notUnset(r)?DataType.getType(r):null},createFieldEditor:function(n,i){var r=new(this.getFieldEditorClass(n,i));return r.setParentEditor(this),r.setReadOnly(!1),r.setAllowEmpty(this.getAllowEmpty()),r.setPropertyInfo(i),r.setObjects(n),r.setValueTextMode(this.getValueTextMode()),r},getObjFields:function(n){return n?Kekule.ObjUtils.getOwnedFieldNames(n):[]},getObjFieldInfos:function(n){for(var i=this.getObjFields(n),r=[],a=0,o=i.length;a<o;++a){var l={name:i[a],dataType:this.getFieldValueType(n,i[a])};r.push(l)}return r},notifyChildEditorValueChange:function(n,i){var r=this.getValue()||this._initialObjValue;r[n]=i,this.setValue(r)},getAttributes:function(){var n=this.tryApplySuper("getAttributes");return n|=t.SUBPROPS},hasSubPropertyEditors:function(){return this.tryApplySuper("hasSubPropertyEditors")&&this.getObjFieldInfos(this.getValue()).length},getValueText:function(){var n=Kekule.Widget.ValueListEditor.ValueDisplayMode;return this.getValueTextMode()===n.JSON?this.tryApplySuper("getValueText"):this.getValue()?"["+Kekule.$L("WidgetTexts.S_OBJECT")+"]":""},setValue:function(n){var i=this.tryApplySuper("setValue",[n]);return this._initialObjValue=n,i},getSubPropertyEditors:function(n){var i=[],r=e.toArray(this.getValue());if(r.length>1)return[];var a=r[0];this._initialObjValue=a||{};for(var o=this.getObjFieldInfos(a),l=[this._initialObjValue],u=0,c=o.length;u<c;++u){var d=this.createFieldEditor(l,o[u]);i.push(d)}return i}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectEditor,DataType.OBJECT),Kekule.PropertyEditor.ArrayEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ArrayEditor",getAttributes:function(){var n=this.tryApplySuper("getAttributes");return n|=t.SUBPROPS},hasSubPropertyEditors:function(){var n=this.getValue();return this.tryApplySuper("hasSubPropertyEditors")&&n&&n.length},getSubPropertyEditors:function(n){var i=[],r=this.getValue();if(DataType.isArrayValue(r)&&r.length)for(var a=this.getPropertyInfo().elementType,o=0,l=r.length;o<l;++o){var u=r[o],c=a||DataType.getType(u),d=Kekule.PropertyEditor.findEditorClassForType(c);if(d){var h=new d;h.setParentEditor(this),h.setObjects([r]);var p={name:o,title:o,dataType:c};h.setPropertyInfo(p),h.setValueTextMode(this.getValueTextMode()),i.push(h)}}return i},getValueText:function(){var n=this.getValue();return DataType.isArrayValue(n)?"["+n.length+" "+Kekule.$L("WidgetTexts.S_ITEMS")+"]":this.tryApplySuper("getValueText")}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ArrayEditor,DataType.ARRAY),Kekule.PropertyEditor.ColorEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ColorEditor",doCreateEditWidget:function(n){this._parentWidget=n;var i=this.getValue();this._originValue=i;var r=new Kekule.Widget.ColorDropTextBox(n,i);return r.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET]),r.addEventListener("valueSet",function(a){this.saveEditValue()},this),this._textbox=r,r},doSaveEditValue:function(){var n=this.getEditWidget().getValue();return(n===Kekule.Widget.ColorPicker.SpecialColors.UNSET||n==="")&&(n=void 0),n!==this._originValue&&(this.setValue(n),!0)}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ColorEditor,DataType.STRING,null,null,function(n,i){var r=i.name;return r&&r.toLowerCase().indexOf("color")>=0})}(),function(){Kekule.Widget.PropEditorModifyOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.Widget.PropEditorModifyOperation",initialize:function(e,t,n){this.tryApplySuper("initialize"),this.setPropEditor(e),this.setNewValue(t),this.setOldValue(n)},initProperties:function(){this.defineProp("propEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:!1}),this.defineProp("newValue",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("oldValue",{dataType:DataType.VARIANT,serializable:!1})},doExecute:function(){var e=this.getPropEditor();this.getOldValue()===void 0&&this.setOldValue(e.getValue()),e.setValue(this.getNewValue())},doReverse:function(){this.getPropEditor().setValue(this.getOldValue())}})}(),function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_CONFIGURATOR:"K-Widget-Configurator",WIDGET_CONFIGURATOR_CLIENT:"K-Widget-Configurator-Client",ACTION_OPEN_CONFIGURATOR:"K-Action-Open-Configurator"});var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.Configurator=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.Widget.Configurator",TAB_BTN_DATA_FIELD:"__$data__",DEF_TAB_POSITION:Kekule.Widget.Position.RIGHT,initialize:function(t){this.setPropStoreFieldValue("widget",t),this._objInspector=null,this._tabGroup=null,this.tryApplySuper("initialize",[t])},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1}),this.defineProp("autoUpdate",{dataType:DataType.BOOL}),this.defineProp("tabPosition",{dataType:DataType.INT,setter:function(t){this.setPropStoreFieldValue("tabPosition",t),this._tabGroup&&this._tabGroup.setTabButtonPosition(t||this.DEF_TAB_POSITION)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.WIDGET_CONFIGURATOR},doCreateRootElement:function(t){return t.createElement("div")},doCreateSubElements:function(t,n){var i=[],r=t.createElement("div");r.className=e.WIDGET_CONFIGURATOR_CLIENT,i.push(r);var a=new Kekule.Widget.ObjectInspector(this);a.setShowObjsInfoPanel(!1),a.setSortField(null),a.appendToElem(r),this._objInspector=a,a.addEventListener("propertyChange",function(g){this.invokeEvent("configChange",{obj:a.getObjects()[0],propertyName:g.propertyInfo.name,oldValue:g.oldValue,newValue:g.newValue})},this);var o,l=this.getCategoryInfos(),u=new Kekule.Widget.TabButtonGroup(this);this._tabGroup=u,u.setTabButtonPosition(this.getTabPosition()||this.DEF_TAB_POSITION);for(var c=0,d=l.length;c<d;++c){var h=l[c],p=new Kekule.Widget.RadioButton(u);p.setText(h.title||h.name),p.setHint(h.description||""),p[this.TAB_BTN_DATA_FIELD]=h.obj,p.appendToWidget(u),c===0&&(o=p)}return u.addEventListener("execute",function(g){var f=g.widget;f instanceof Kekule.Widget.RadioButton&&this._switchToTab(f)},this),u.appendToElem(r),l.length<=1&&u.setDisplayed("none"),o.setChecked(!0),this._switchToTab(o),n.appendChild(r),i},doWidgetShowStateChanged:function(t){this.tryApplySuper("doWidgetShowStateChanged",[t]),this.getAutoUpdate()&&(t?this.loadConfigValues():this.saveConfigValues())},loadConfigValues:function(){},saveConfigValues:function(){},getCategoryInfos:function(){var t=this.getWidget(),n=[],i=t.getSettingFacade();if(i){var r=t.getPropInfo("settingFacade");n.push({obj:i,name:r.name,title:r.title,descrption:r.description})}return n},_switchToTab:function(t){var n=t[this.TAB_BTN_DATA_FIELD];this._objInspector.setObjects(n)}}),Kekule.Widget.ActionOpenConfigWidget=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Widget.ActionOpenConfigWidget",HTML_CLASSNAME:e.ACTION_OPEN_CONFIGURATOR,initialize:function(t){this.tryApplySuper("initialize"),this.setWidget(t),this.setText(Kekule.$L("WidgetTexts.CAPTION_CONFIG")),this.setHint(Kekule.$L("WidgetTexts.HINT_CONFIG"))},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},doUpdate:function(){var t=this.getWidget();this.setEnabled(t&&t.getEnabled())},doExecute:function(t){this.getWidget().openConfigurator(t)}}),ClassEx.extend(Kekule.Widget.BaseWidget,{getSettingFacadeClass:function(){var t=this.getClass(),n=null;do{var i=ClassEx.getClassName(t)+".Settings";n=ClassEx.findClass(i),t=ClassEx.getSuperClass(t)}while(t&&!n);return n},getConfiguratorClass:function(){var t=this.getClass(),n=null;do{var i=ClassEx.getClassName(t)+".Configurator";n=ClassEx.findClass(i),t=ClassEx.getSuperClass(t)}while(t&&!n);return n},createConfigurator:function(){return new(this.getConfiguratorClass())(this)},getConfigurator:function(){return this._configurator||(this._configurator=this.createConfigurator()),this._configurator},openConfigurator:function(t){this.getConfigurator().show(t||this,null,Kekule.Widget.ShowHideType.DROPDOWN)}}),ClassEx.defineProp(Kekule.Widget.BaseWidget,"settingFacade",{dataType:DataType.OBJECTEX,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var t=this.getPropStoreFieldValue("settingFacade");if(!t){var n=this.getSettingFacadeClass();n&&(t=new n(this),this.setPropStoreFieldValue("settingFacade",t))}return t}}),Kekule.Widget.BaseWidget.Settings=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget.Settings",initialize:function(t){this._basedClass=null,this.tryApplySuper("initialize"),this.setWidget(t)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,scope:Class.PropertyScope.PUBLIC})},getBasedClass:function(){if(!this.hasOwnProperty("_basedClass")||!this._basedClass){var t=this.getClassName(),n=t.split(".");n.pop(),t=n.join("."),this._basedClass=ClassEx.findClass(t)}return this._basedClass},defineDelegatedProp:function(t,n){n||(n=t);var i=ClassEx.getPropInfo(this.getBasedClass(),n),r=Object.create(i);r.setter=null,r.getter=null,i.getter&&(r.getter=function(){return this.getWidget().getPropValue(n)}),i.setter&&(r.setter=function(a){this.getWidget().setPropValue(n,a)}),this.defineProp(t,r)},defineDelegatedProps:function(t,n){n||(n=[]);for(var i=0,r=t.length;i<r;++i){var a=t[i],o=n[i]||a;this.defineDelegatedProp(a,o)}}})}(),function(){Kekule.Widget.BaseDataSet=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseDataSet",PREFIX_SORT_DESC:"!",initProperties:function(){this.defineProp("enableCache",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableCache")&&this.getCacheAvailable()},setter:function(e){this.setPropStoreFieldValue("enableCache",e),e||this.clearCache()}}),this.defineProp("defaultTimeout",{dataType:DataType.INT}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(e){var t=e?Kekule.ArrayUtils.toArray(e):null;this.setPropStoreFieldValue("sortFields",t),this.sortFieldsChanged(t)}}),this.defineProp("cache",{dataType:DataType.ARRAY})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableCache(!0),this.setCache([]),this.setDefaultTimeout(2e4)},finalize:function(){this.clearCache(),this.setCache(null),this.tryApplySuper("finalize")},dataChanged:function(){this.clearCache(),this.invokeEvent("dataChange")},sortFieldsChanged:function(e){this.clearCache(),this.doSortFieldsChanged(e)},doSortFieldsChanged:function(e){},getTotalCount:function(){return this.doGetTotalCount()||0},doGetTotalCount:function(){},totalCountChanged:function(e){this.invokeEvent("totalCountChange",{totalCount:e})},getFirstIndex:function(){return 0},getLastIndex:function(){return(this.getTotalCount()||0)-1},getCacheAvailable:function(){return!0},clearCache:function(){return this.getCache().length=0,this},saveCacheData:function(e,t){for(var n=this.getCache(),i=t,r=0;r<e.length;++r)n[i]=e[r]||null,++i},loadCacheData:function(e,t){if(this.getEnableCache()){var n=this.getCache();if(n.length<e+t)return null;for(var i=[],r=e,a=e+t;r<a;++r){var o=n[r];if(o===void 0)return null;i.push(o)}return i}return null},fetch:function(e){var t=Object.extend({fromIndex:0,count:0},e);if(t.timeout=t.timeout||this.getDefaultTimeout(),this.getEnableCache()){var n=this.loadCacheData(t.fromIndex,t.count);if(n)return void t.callback(n)}var i=this,r=!1;if(t.timeout>0)var a=setTimeout(function(){a&&clearTimeout(a),r=!0,t.timeoutCallback?t.timeoutCallback():e.errCallback&&e.errCallback(Kekule.$L("ErrorMsg.FETCH_DATA_TIMEOUT"))},t.timeout);t.callback=function(o){r||(a&&clearTimeout(a),e.callback&&e.callback(o),i.getEnableCache()&&i.saveCacheData(o,t.fromIndex))},t.errCallback=function(o){r||(a&&clearTimeout(a),e.errCallback&&e.errCallback(o))},this.doFetch(t.fromIndex,t.count,t.callback,t.errCallback)},doFetch:function(e,t,n,i){}}),Kekule.Widget.ArrayDataSet=Class.create(Kekule.Widget.BaseDataSet,{CLASS_NAME:"Kekule.Widget.ArrayDataSet",initialize:function(e){this.tryApplySuper("initialize"),this.setData(e)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("data",e);var t=this.getSortFields();t&&this.doSortFieldsChanged(t),this.dataChanged()}})},getCacheAvailable:function(){return!1},doSortFieldsChanged:function(e){var t=this.getData()||[];return Kekule.ArrayUtils.sortHashArray(t,e),this.dataChanged(),this},doGetTotalCount:function(){return(this.getData()||[]).length},doFetch:function(e,t,n,i){for(var r=[],a=this.getData()||[],o=e,l=Math.min(e+t,a.length);o<l;++o){var u=a[o];r.push(u)}n(r)}}),Kekule.Widget.DataPager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DataPager",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("pageSize",10),this.setDataSet(e)},initProperties:function(){this.defineProp("dataSet",{dataType:"Kekule.Widget.BaseDataSet",setter:function(e){var t=this.getDataSet();e!==t&&(this.setPropStoreFieldValue("dataSet",e),this.dataSetChange(t,e),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("pageSize",{dataType:DataType.INT,setter:function(e){e!==this.getPageSize()&&(this.setPropStoreFieldValue("pageSize",e),this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0))}}),this.defineProp("currPageIndex",{dataType:DataType.INT}),this.defineProp("currPageData",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getDataSet()&&this.getDataSet().getSortFields()},setter:function(e){this.getDataSet()&&this.getDataSet().setSortFields(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setCurrPageIndex(0)},dataSetChange:function(e,t){e&&(e.RemoveEventListener("dataChange",this.reactDataSetDataChange,this),e.RemoveEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),t&&(t.addEventListener("dataChange",this.reactDataSetDataChange,this),t.addEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)),this.pageCountChanged(this.getPageCount())},reactDataSetDataChange:function(e){this.dataChanged()},dataChanged:function(){this.pageCountChanged(this.getPageCount()),this.switchToPage(this.getCurrPageIndex()||0)},reactDataSetTotalCountChange:function(e){this.pageCountChanged(this.getPageCount())},getPageCount:function(){var e=this.getDataSet(),t=e&&e.getTotalCount()||0;return Math.ceil(t/this.getPageSize())},pageCountChanged:function(e){this.invokeEvent("pageCountChange",{pageCount:e})},fetchPageData:function(e){var t=this.getPageSize()*(Kekule.ObjUtils.isUnset(e.pageIndex)?this.getCurrPageIndex():e.pageIndex),n=this.getPageSize(),i=Object.create(e);return Object.extend(i,{fromIndex:t,count:n}),this.getDataSet().fetch(i),this},switchToPage:function(e,t){var n=this,i={pageIndex:e,timeout:t,callback:function(r){n.setCurrPageData(r),n.setCurrPageIndex(e),n.invokeEvent("dataFetched",{pageIndex:e,data:r})},errCallback:function(r){n.invokeEvent("dataError",{error:r}),Kekule.error(r)}};this.invokeEvent("pageRetrieve",{pageIndex:e}),this.fetchPageData(i)}})}(),function(){var e=Kekule.DomUtils,t=Kekule.HtmlElementUtils,n=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DATAGRID:"K-DataGrid",DATATABLE:"K-DataTable",DATATABLE_ROW_ODD:"K-Odd",DATATABLE_ROW_EVEN:"K-Even",DATATABLE_CELL_WRAPPER:"K-DataTable-CellWrapper",DATATABLE_HEADCELL_INTERACTABLE:"K-DataTable-HeadCellInteractable",DATATABLE_OPER_COL:"K-DataTable-OperCol",DATATABLE_OPER_CELL:"K-DataTable-OperCell",DATATABLE_CHECK_COL:"K-DataTable-CheckCol",DATATABLE_CHECK_CELL:"K-DataTable-CheckCell",DATATABLE_DATA_COL:"K-DataTable-DataCol",DATATABLE_DATA_CELL:"K-DataTable-DataCell",DATATABLE_SORTMARK:"K-DataTable-SortMark",DATATABLE_SORTASC:"K-Sort-Asc",DATATABLE_SORTDESC:"K-Sort-Desc",DATATABLE_EDIT:"K-DataTable-Edit",DATATABLE_DELETE:"K-DataTable-Delete",DATATABLE_INSERT:"K-DataTable-Insert",PAGENAVIGATOR:"K-PageNavigator",PAGENAVIGATOR_FIRST:"K-PageNavigator-First",PAGENAVIGATOR_LAST:"K-PageNavigator-Last",PAGENAVIGATOR_PREV:"K-PageNavigator-Prev",PAGENAVIGATOR_NEXT:"K-PageNavigator-Next",PAGENAVIGATOR_PAGEINDEXER:"K-PageNavigator-PageIndexer",PAGENAVIGATOR_PAGEINPUT:"K-PageNavigator-PageInput",PAGENAVIGATOR_PAGESELECTOR:"K-PageNavigator-PageSelector"}),Kekule.Widget.DataTableColNames={OPER:"OPER",CHECK:"CHECK",ALL:"*"};var i=Kekule.Widget.DataTableColNames;Kekule.Widget.DataTable=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DataTable",BINDABLE_TAG_NAMES:["div","span"],PREFIX_SORT_DESC:"!",COLDEF_FIELD:"__$colDef__",ROWDATA_FIELD:"__$rowData__",ROW_OPER_TOOLBAR_FIELD:"__$rowOperToolbar__",ROW_CHECKBOX_FIELD:"__$rowCheckBox__",COLNAME_OPER:i.OPER,COLNAME_CHECK:i.CHECK,COLNAME_ALL:i.ALL,initialize:function(o){this._displayData=null,this.setPropStoreFieldValue("showTableHead",!0),this.tryApplySuper("initialize",[o])},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY}),this.defineProp("columns",{dataType:DataType.ARRAY}),this.defineProp("operColShowMode",{dataType:DataType.STRING}),this.defineProp("operWidgets",{dataType:DataType.ARRAY}),this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(o){var l=o?Kekule.ArrayUtils.toArray(o):null;this.setPropStoreFieldValue("sortFields",l),this.getDataPager()&&this.getDataPager().setSortFields(l)}}),this.defineProp("sortFunc",{dataType:DataType.FUNCTION}),this.defineProp("showTableHead",{dataType:DataType.BOOL}),this.defineProp("enableHeadInteraction",{dataType:DataType.BOOL}),this.defineProp("enableActiveRow",{dataType:DataType.BOOL,setter:function(o){this.setPropStoreFieldValue("enableActiveRow",o),o||this.setActiveCell(null)}}),this.defineProp("activeCell",{dataType:DataType.OBJECT,setter:function(o){var l=this.getActiveCell();if(l!==o)if(l&&t.removeClass(l,n.STATE_ACTIVE),this.setPropStoreFieldValue("activeCell",o),o){t.addClass(o,n.STATE_ACTIVE);var u=this.getParentRow(o);u&&this.setActiveRow(u)}else this.setActiveRow(null)}}),this.defineProp("activeRow",{dataType:DataType.OBJECT,setter:function(o){var l=this.getActiveRow();l!==o&&(this.activeRowChanged(l,o),this.setPropStoreFieldValue("activeRow",o))}}),this.defineProp("hoverCell",{dataType:DataType.OBJECT,setter:function(o){var l=this.getHoverCell();if(l!==o)if(l&&t.removeClass(l,n.STATE_HOVER),this.setPropStoreFieldValue("hoverCell",o),o){t.addClass(o,n.STATE_HOVER);var u=this.getParentRow(o);u&&this.setHoverRow(u)}else this.setHoverRow(null)}}),this.defineProp("hoverRow",{dataType:DataType.OBJECT,setter:function(o){var l=this.getHoverRow();l!==o&&(this.hoverRowChanged(l,o),this.setPropStoreFieldValue("hoverRow",o))}}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(o){var l=this.getDataPager();l!==o&&(this.setPropStoreFieldValue("dataPager",o),this.dataPagerChanged(o,l))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.reactOperEditBind=this.reactOperEdit.bind(this),this.reactOperDeleteBind=this.reactOperDelete.bind(this),this.reactOperInsertBind=this.reactOperInsert.bind(this)},doObjectChange:function(o){this.tryApplySuper("doObjectChange",[o]),Kekule.ArrayUtils.intersect(o,["data","columns","sortFields","sortFunc","showTableHead","enableHeadInteraction","operColShowMode","operWidgets"]).length&&this.recreateChildContent()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.DATATABLE},doCreateRootElement:function(o){return o.createElement("div")},doCreateSubElements:function(o,l){return this.doCreateDataTable(o,l)},doCreateDataTable:function(o,l){var u=o.createElement("table");return this.recreateChildContent(o,u),l.appendChild(u),u},getTableElement:function(){return this.getElement()&&this.getElement().getElementsByTagName("table")[0]},getShowOperCol:function(){return(this.getOperColShowMode()||Kekule.Widget.DataTable.OperColShowMode.NONE)!==Kekule.Widget.DataTable.OperColShowMode.NONE},recreateChildContent:function(o,l){this.setActiveCell(null),this.setHoverCell(null);var u=this.prepareData(),c=l||this.getTableElement(),d=[];return c&&(e.clearChildContent(c),!o&&(o=c.ownerDocument),d.push(this.doCreateDataTableColGroup(o,c,u.columns)),this.getShowTableHead()&&d.push(this.doCreateDataTableHead(o,c,u.columns)),d.push(this.doCreateDataTableBody(o,c,u.columns,u.data))),d},doCreateDataTableColGroup:function(o,l,u){for(var c=u||[],d=o.createElement("colgroup"),h=0,p=c.length;h<p;++h){var g=c[h]||{},f=o.createElement("col");g.colClassName&&(f.className=g.colClassName),g.colStyle&&(f.style.cssText=g.colStyle),d.appendChild(f)}return l.appendChild(d),d},doCreateDataTableCellWrapper:function(o,l){var u=o.createElement("span");return u.className=n.DATATABLE_CELL_WRAPPER,l.appendChild(u),u},doCreateDataTableHead:function(o,l,u){for(var c=u||[],d=this.getEnableHeadInteraction(),h=o.createElement("thead"),p=o.createElement("tr"),g=0,f=c.length;g<f;++g){var m=c[g]||{};this.doCreateDataTableHeadCell(o,p,m,d)}return h.appendChild(p),l.appendChild(h),h},doCreateDataTableHeadCell:function(o,l,u,c){var d=o.createElement("th");u.className&&(d.className=u.className),u.style&&(d.style.cssText=u.style);var h=this.doCreateDataTableCellWrapper(o,d);(Kekule.ObjUtils.notUnset(u.disableInteract)?!u.disableInteract:c)&&t.addClass(d,n.DATATABLE_HEADCELL_INTERACTABLE),e.setElementText(h,u.text||u.name);var p=this.doCreateDataTableHeadCellSortMark(o,d);return u.sorting===1?t.addClass(p,n.DATATABLE_SORTASC):u.sorting===-1&&t.addClass(p,n.DATATABLE_SORTDESC),h.title=u.hint||"",d[this.COLDEF_FIELD]=u,l.appendChild(d),d},doCreateDataTableHeadCellSortMark:function(o,l){var u=o.createElement("span");return u.className=n.DATATABLE_SORTMARK,l.appendChild(u),u},doCreateDataTableBody:function(o,l,u,c){var d=u||[],h=(c=c||[],o.createElement("tbody"));if(this.getShowOperCol())var p=this.getOperWidgetDefinitions();for(var g=!0,f=0,m=c.length;f<m;++f){var C=o.createElement("tr");C.className=g?n.DATATABLE_ROW_ODD:n.DATATABLE_ROW_EVEN,g=!g;var _=c[f]||{};C[this.ROWDATA_FIELD]=_;for(var y=0,T=d.length;y<T;++y){var E=d[y],b=E.name,v=_[b],I=o.createElement("td");E.className&&(I.className=E.className),E.style&&(I.style.cssText=E.style);var R=this.doCreateDataTableCellWrapper(o,I);if(E.isOperCol){var N={rowData:_,rowIndex:f,colIndex:y,childWidgetDefinitions:p},L=this.doCreateOperCellContent(R,N);C[this.ROW_OPER_TOOLBAR_FIELD]=L}else if(E.isCheckCol){N={rowData:_,rowIndex:f,colIndex:y};var U=this.doCreateCheckCellContent(R,N);C[this.ROW_CHECKBOX_FIELD]=U}else N={rowData:_,cellKey:b,cellValue:v,rowIndex:f,colIndex:y},this.doCreateDataCellContent(R,N);I.appendChild(R),C.appendChild(I)}h.appendChild(C)}return l.appendChild(h),h},doCreateDataCellContent:function(o,l){var u="";Kekule.ObjUtils.notUnset(l.cellValue)&&(u=""+l.cellValue),e.setElementText(o,u)},doCreateCheckCellContent:function(o,l){var u=new Kekule.Widget.CheckBox(this);return u.appendToElem(o),u},doCreateOperCellContent:function(o,l){var u=this.doCreateOperToolbar(o,l.childWidgetDefinitions),c=Kekule.Widget.DataTable.OperColShowMode;return this.getOperColShowMode()!==c.ALL&&u.setVisible(!1),u},doCreateOperToolbar:function(o,l){var u=new Kekule.Widget.ButtonGroup(this);return u.setChildDefs(l),u.appendToElem(o),u},getDefaultOperButtons:function(){var o=Kekule.Widget.DataTable.Components;return[o.EDIT,o.DELETE]},getOperWidgetDefinitions:function(){for(var o=[],l=this.getOperWidgets()||this.getDefaultOperButtons(),u=0,c=l.length;u<c;++u){var d=l[u];if(DataType.isObjectValue(d))o.push(d);else{var h=this.getDefaultComponentDefinitionHash(d);h&&o.push(h)}}return o},getDefaultComponentDefinitionHash:function(o){var l,u=Kekule.Widget.DataTable.Components;return o===u.EDIT?l={widget:"Kekule.Widget.Button",htmlClass:n.DATATABLE_EDIT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_EDIT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_EDIT"),"#execute":this.reactOperEditBind}:o===u.DELETE?l={widget:"Kekule.Widget.Button",htmlClass:n.DATATABLE_DELETE,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_DELETE"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_DELETE"),"#execute":this.reactOperDeleteBind}:o===u.INSERT&&(l={widget:"Kekule.Widget.Button",htmlClass:n.DATATABLE_INSERT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_INSERT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_INSERT"),"#execute":this.reactOperInsertBind}),l&&(l.internalName=o),l},hasExternalDataProvider:function(){return!!this.getDataPager()},needSort:function(){return this.getSortFields()||this.getSortFunc()},sortData:function(){var o=this.getData()||[];if(this.needSort()&&!this.hasExternalDataProvider()){var l=Kekule.ArrayUtils.clone(o);return Kekule.ArrayUtils.sortHashArray(l,this.getSortFields()),l}return o},prepareData:function(){var o={},l=this.sortData();o.data=l;var u=function(m){for(var C=[],_=0,y=m.length;_<y;++_){var T=Kekule.ObjUtils.getOwnedFieldNames(m[_]);Kekule.ArrayUtils.pushUnique(C,T)}var E=[];for(_=0,y=C.length;_<y;++_)E.push({name:C[_],text:C[_]});return E};this.getColumns()?o.columns=Kekule.ArrayUtils.clone(this.getColumns()):o.columns=u(l);for(var c=0;c<o.columns.length;){var d=o.columns[c];if(typeof d=="string"&&(d={name:d}),d.name===this.COLNAME_OPER)o.columns[c]={name:"",text:"",disableInteract:!0,isOperCol:!0,colClassName:n.DATATABLE_OPER_COL,className:n.DATATABLE_OPER_CELL};else if(d.name===this.COLNAME_CHECK)o.columns[c]={name:"",text:"",disableInteract:!0,isCheckCol:!0,colClassName:n.DATATABLE_CHECK_COL,className:n.DATATABLE_CHECK_CELL};else if(d.name===this.COLNAME_ALL){var h=u(l);h.unshift(1),h.unshift(c),o.columns.splice.apply(o.columns,h)}else d.colClassName=n.DATATABLE_DATA_COL+" "+(d.colClassName||""),d.className=n.DATATABLE_DATA_CELL+" "+(d.className||"");++c}if(this.needSort()&&!this.getSortFunc())for(var p=this.getSortFields(),g=(c=0,o.columns.length);c<g;++c){var f=o.columns[c].name;p.indexOf(f)>=0?o.columns[c].sorting=1:p.indexOf(this.PREFIX_SORT_DESC+f)>=0?o.columns[c].sorting=-1:o.columns[c].sorting=0}return o},activeRowChanged:function(o,l){var u=Kekule.Widget.DataTable.OperColShowMode,c=this.getOperColShowMode();o&&(t.removeClass(o,n.STATE_ACTIVE),c!==u.ACTIVE&&c!==u.HOVER||this.hideRowOperToolbar(o)),l&&(t.addClass(l,n.STATE_ACTIVE),c!==u.ACTIVE&&c!==u.HOVER||this.showRowOperToolbar(l))},hoverRowChanged:function(o,l){var u=Kekule.Widget.DataTable.OperColShowMode,c=this.getOperColShowMode();o&&(t.removeClass(o,n.STATE_HOVER),c===u.HOVER&&o!==this.getActiveRow()&&this.hideRowOperToolbar(o)),l&&(t.addClass(l,n.STATE_HOVER),c===u.HOVER&&this.showRowOperToolbar(l))},getParentCell:function(o){return e.isDescendantOf(o,this.getElement())?e.getNearestAncestorByTagName(o,"td",!0):null},getParentHeadCell:function(o){return e.isDescendantOf(o,this.getElement())?e.getNearestAncestorByTagName(o,"th",!0):null},getParentRow:function(o){return e.isDescendantOf(o,this.getElement())?e.getNearestAncestorByTagName(o,"tr",!0):null},getColCount:function(){return(this.getColumns()||[]).length},getRowCount:function(){return(this.getData()||[]).length},getDataRows:function(){var o=this.getElement().getElementsByTagName("tbody")[0];return o&&o.getElementsByTagName("tr")},getCheckedRows:function(){for(var o=[],l=this.getDataRows(),u=0,c=l.length;u<c;++u)this.isRowChecked(l[u])&&o.push(l[u]);return o},getRowData:function(o){return o?o[this.ROWDATA_FIELD]:null},isRowChecked:function(o){var l=this.getRowCheckBox(o);return l&&l.getChecked&&l.getChecked()},getRowCheckBox:function(o){return o&&o[this.ROW_CHECKBOX_FIELD]},getRowOperToolbar:function(o){return o?o[this.ROW_OPER_TOOLBAR_FIELD]:null},showRowOperToolbar:function(o){var l=this.getRowOperToolbar(o);l&&l.setVisible(!0)},hideRowOperToolbar:function(o){var l=this.getRowOperToolbar(o);l&&l.setVisible(!1)},dataPagerChanged:function(o,l){l&&(l.removeEventListener("pageRetrieve",this.reactPagerRetrieve,this),l.removeEventListener("dataFetched",this.reactPagerFetched,this),l.removeEventListener("dataError",this.reactPagerError,this)),o&&(o.addEventListener("pageRetrieve",this.reactPagerRetrieve,this),o.addEventListener("dataFetched",this.reactPagerFetched,this),o.addEventListener("dataError",this.reactPagerError,this),this.setData(o.getCurrPageData()))},reactPagerRetrieve:function(o){this.reportMessage&&(this._loadingDataMsg=this.reportMessage(Kekule.$L("WidgetTexts.MSG_RETRIEVING_DATA"),Kekule.Widget.MsgType.INFO))},reactPagerFetched:function(o){this.setData(o.data),this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg)},reactPagerError:function(o){this._loadingDataMsg&&this.removeMessage&&this.removeMessage(this._loadingDataMsg),this.flashMessage&&this.flashMessage(o.error.message||o.error,Kekule.Widget.MsgType.ERROR)},reactOperEdit:function(o){return this.reactOperExecute(r.EDIT,o)},reactOperDelete:function(o){return this.reactOperExecute(r.DELETE,o)},reactOperInsert:function(o){return this.reactOperExecute(r.INSERT,o)},reactOperExecute:function(o,l){var u=l.target,c=this.getParentRow(u.getElement()),d=this.getRowData(c);return this.doReactOperExecute(o,d,c,l)},doReactOperExecute:function(o,l,u,c){},react_click:function(o){this.tryApplySuper("react_click",[o]);var l=o.getTarget(),u=this.getParentHeadCell(l);if(u)this._autoSortOnHeadCell(u);else if(this.getEnableActiveRow()){var c=this.getParentCell(l);c&&this.setActiveCell(c)}},react_pointerover:function(o){this.tryApplySuper("react_pointerover",[o]);var l=o.getTarget();if(this.getEnableActiveRow()){var u=this.getParentCell(l);u?this.setHoverCell(u):this.setHoverCell(null)}},react_pointerleave:function(o){this.tryApplySuper("react_pointerleave",[o]),o.getTarget(),this.getEnableActiveRow()&&this.setHoverCell(null)},_autoSortOnHeadCell:function(o){if(o&&this.getEnableHeadInteraction()){var l=o[this.COLDEF_FIELD];if(l&&!l.disableInteract){var u=l.name;l.sorting===1&&(u=this.PREFIX_SORT_DESC+u),this.setSortFields([u])}}},load:function(o,l,u,c){this.beginUpdate();try{this.setData(o),this.setColumns(l),this.setSortFields(u?Kekule.ArrayUtils.toArray(u):null),this.setSortFunc(c)}finally{this.endUpdate()}return this},reload:function(){return this.recreateChildContent(),this}}),Kekule.Widget.DataTable.OperColShowMode={NONE:"none",ACTIVE:"active",HOVER:"hover",ALL:"all"},Kekule.Widget.DataTable.Components={EDIT:"edit",DELETE:"delete",INSERT:"insert"};var r=Kekule.Widget.DataTable.Components;Kekule.Widget.PageNavigator=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.PageNavigator",initProperties:function(){this.defineProp("components",{dataType:DataType.ARRAY}),this.defineProp("firstIndex",{dataType:DataType.INT}),this.defineProp("lastIndex",{dataType:DataType.INT}),this.defineProp("currIndex",{dataType:DataType.INT}),this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(o){var l=this.getDataPager();l!==o&&(this.setPropStoreFieldValue("dataPager",o),this.dataPagerChanged(o,l))}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowText(!0),this.setShowGlyph(!0),this.setFirstIndex(1),this.reactFirstBind=this.reactFirst.bind(this),this.reactLastBind=this.reactLast.bind(this),this.reactPrevBind=this.reactPrev.bind(this),this.reactNextBind=this.reactNext.bind(this),this.reactPageInputChangeBind=this.reactPageInputChange.bind(this)},doObjectChange:function(o){this.tryApplySuper("doObjectChange",[o]),Kekule.ArrayUtils.intersect(o,["firstIndex","lastIndex","currIndex"]).length&&this.updateChildComponent(),o.indexOf("currIndex")>=0&&this.invokeEvent("pageChange",{currIndex:this.getCurrIndex()})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.PAGENAVIGATOR},doCreateSubElements:function(o,l){return this.recreateChildContent(o,l)},getDefaultComponents:function(){return[a.FIRST,a.PREV,a.PAGESELECTOR,a.NEXT,a.LAST]},recreateChildContent:function(){for(var o=this.getComponents()||this.getDefaultComponents(),l=[],u=0,c=o.length;u<c;++u){var d=o[u];if(DataType.isObjectValue(d))l.push(d);else{var h=this.getDefaultComponentDefinitionHash(d);h&&l.push(h)}}this.setChildDefs(l),this.updateChildComponent()},getDefaultComponentDefinitionHash:function(o){var l;return(l=o===a.FIRST?{widget:"Kekule.Widget.Button",htmlClass:n.PAGENAVIGATOR_FIRST,text:Kekule.$L("WidgetTexts.CAPTION_FIRST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_FIRST_PAGE"),"#execute":this.reactFirstBind}:o===a.LAST?{widget:"Kekule.Widget.Button",htmlClass:n.PAGENAVIGATOR_LAST,text:Kekule.$L("WidgetTexts.CAPTION_LAST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_LAST_PAGE"),"#execute":this.reactLastBind}:o===a.PREV?{widget:"Kekule.Widget.Button",htmlClass:n.PAGENAVIGATOR_PREV,text:Kekule.$L("WidgetTexts.CAPTION_PREV_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_PREV_PAGE"),"#execute":this.reactPrevBind}:o===a.NEXT?{widget:"Kekule.Widget.Button",htmlClass:n.PAGENAVIGATOR_NEXT,text:Kekule.$L("WidgetTexts.CAPTION_NEXT_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_NEXT_PAGE"),"#execute":this.reactNextBind}:o===a.PAGEINPUT?{widget:"Kekule.Widget.TextBox",htmlClass:[n.PAGENAVIGATOR_PAGEINPUT,n.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:o===a.PAGESELECTOR?{widget:"Kekule.Widget.SelectBox",htmlClass:[n.PAGENAVIGATOR_PAGESELECTOR,n.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}:null)&&(l.internalName=o),l},getComponent:function(o){return this.getChildWidgetByInternalName(o)},setChildComponentEnabled:function(o,l){var u=this.getComponent(o);u&&u.setEnabled(l)},updateChildComponent:function(){var o=this.getFirstIndex()||0,l=this.getLastIndex()||0,u=this.getCurrIndex()||0,c=u<=o,d=u>=l;this.setChildComponentEnabled(a.FIRST,!c),this.setChildComponentEnabled(a.PREV,!c),this.setChildComponentEnabled(a.NEXT,!d),this.setChildComponentEnabled(a.LAST,!d),this.setChildComponentEnabled(a.PAGEINPUT,l>o),this.setChildComponentEnabled(a.PAGESELECTOR,l>o);var h=this.getComponent(a.PAGEINPUT);h&&h.setValue(u);var p=this.getComponent(a.PAGESELECTOR);if(p){for(var g=[],f=o;f<=l;++f)g.push({value:f});p.setItems(g),p.setValue(u)}},dataPagerChanged:function(o,l){l&&(l.removeEventListener("dataFetched",this.reactPagerFetched,this),o.removeEventListener("pageCountChange",this.reactPagerPageCountChange,this)),o&&(o.addEventListener("dataFetched",this.reactPagerFetched,this),o.addEventListener("pageCountChange",this.reactPagerPageCountChange,this),this.updatePageDetails(o),this.setCurrIndex(o.getCurrPageIndex()+this.getFirstIndex()))},reactPagerFetched:function(o){this.setCurrIndex(o.pageIndex+this.getFirstIndex())},reactPagerPageCountChange:function(o){this.updatePageDetails(this.getDataPager())},updatePageDetails:function(o){var l=this.getFirstIndex();this.setLastIndex(o.getPageCount()+l-1)},requestChangeCurrIndex:function(o){var l=this.getDataPager();l?l.switchToPage(o-this.getFirstIndex()):this.setCurrIndex(o)},reactFirst:function(o){this.requestChangeCurrIndex(this.getFirstIndex()||0)},reactLast:function(o){this.requestChangeCurrIndex(this.getLastIndex()||0)},reactPrev:function(o){var l=this.getFirstIndex()||0,u=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.max(u-1,l))},reactNext:function(o){var l=this.getLastIndex()||0,u=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.min(u+1,l))},reactPageInputChange:function(o){var l=o.target.getValue();typeof l=="string"&&(l=parseInt(l));var u=this.getFirstIndex()||0,c=this.getLastIndex()||0;l>=u&&l<=c?this.requestChangeCurrIndex(l):Kekule.error(Kekule.$L("ErrorMsg.PAGE_INDEX_OUTOF_RANGE"))}}),Kekule.Widget.PageNavigator.Components={FIRST:"first",LAST:"last",PREV:"prev",NEXT:"next",PAGEINPUT:"pageInput",PAGESELECTOR:"pageSelector"};var a=Kekule.Widget.PageNavigator.Components}(),function(){Kekule.HtmlElementUtils;var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{SYSMSGGROUP:"K-SysMsgGroup"}),Kekule.Widget.SysMsgGroup=Class.create(Kekule.Widget.MsgGroup,{CLASS_NAME:"Kekule.Widget.SysMsgGroup",initialize:function(t){this.tryApplySuper("initialize",[t])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMaxMsgCount(6)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.SYSMSGGROUP}}),Kekule.Widget.ExceptionHandler=Class.create(Kekule.ExceptionHandler,{CLASS_NAME:"Kekule.Widget.ExceptionHandler",initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getPropStoreFieldValue("document")||document}}),this.defineProp("sysMsgGroup",{dataType:"Kekule.Widget.SysMsgGroup",serializable:!1,setter:null,getter:function(){var t=this.getPropStoreFieldValue("sysMsgGroup");if(!t){var n=(t=new Kekule.Widget.SysMsgGroup(this.getDocument())).getGlobalManager();t.appendToElem(n.getDefaultContextRootElem()),this.setPropStoreFieldValue("sysMsgGroup",t)}return t}})},throwException:function(t,n){var i,r=Kekule.ExceptionLevel,a=Kekule.Widget.MsgType;if(n||(n=r.ERROR),i=typeof t=="string"?t:t.message){var o=n!==r.ERROR&&n!==r.NOT_FATAL_ERROR&&n?n===r.WARNING?a.WARNING:n===r.NOTE?a.INFO:a.NORMAL:a.ERROR;this.getSysMsgGroup().addMessage(i,o)}return this.tryApplySuper("throwException",[t,n])}}),Kekule.ClassUtils.makeSingleton(Kekule.Widget.ExceptionHandler),Kekule.X.domReady(function(){Kekule.exceptionHandler=Kekule.Widget.ExceptionHandler.getInstance()})}(),function(){var e=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OPER_HISTORY_TREE_VIEW:"K-OperHistory-TreeView"}),Kekule.Widget.OperHistoryTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.Widget.OperHistoryTreeView",initialize:function(t,n){this.tryApplySuper("initialize",[t]),this.setPropStoreFieldValue("objMap",new Kekule.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelect(!0),this.setOperHistory(n)},initProperties:function(){this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,setter:function(t){var n=this.getPropStoreFieldValue("operHistory");this.setPropStoreFieldValue("operHistory",t),this.operHistoryChanged(t,n)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.OPER_HISTORY_TREE_VIEW},operHistoryChanged:function(t,n){this.clearChildItems(),this.getObjMap().clear(),n&&this._uninstallRootEventHandler(n),t&&(this._fillTree(t),this._installRootEventHandler(t))},_installRootEventHandler:function(t){t.addEventListener("operChange",this.reactOperChange,this)},_uninstallRootEventHandler:function(t){t.removeEventListener("operChange",this.reactOperChange,this)},reactOperChange:function(t){this.getEnableLiveUpdate()&&(t.target,this._fillTree(t.target))},_fillTree:function(t){if(t){this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),t);var n=t.getCurrOperation(),i=n?this.getObjMap().get(n):null;this.select(i)}},_getOperChildCount:function(t){return t instanceof Kekule.OperationHistory?t.getOperationCount():t instanceof Kekule.MacroOperation?t.getChildCount():0},_getChildOperAt:function(t,n){return t instanceof Kekule.OperationHistory?t.getOperationAt(n):t instanceof Kekule.MacroOperation?t.getChildAt(n):null},_updateTreeItem:function(t,n){var i={text:this._getOperDisplayTitle(n),obj:n};this.setItemData(t,i),this.getObjMap().set(n,t);for(var r=this.getChildItemCount(t),a=this._getOperChildCount(n),o=0;o<a;++o){var l,u=this._getChildOperAt(n,o);l=o<r?this.getChildItemAt(t,o):this.appendChildItem(t),this._updateTreeItem(l,u)}if(r>a)for(o=r-1;o>=a;--o)this.removeChildItemAt(t,o)},_getOperDisplayTitle:function(t){var n=t.getClassName(),i=t.getTarget?t.getTarget():null;return i&&i.getId&&(n+="(target: "+i.getId()+")"),n}})}()}(_u)),_u.exports}Xv();Kekule.ChemWidget={},Kekule.ChemWidget.AbstractWidget=Kekule.Widget.BaseWidget,Kekule.ChemWidget.ComponentWidgetNames={menu:"menu",newDoc:"newDoc",clearObjs:"clearObjs",loadFile:"loadFile",loadData:"loadData",saveData:"saveData",zoomIn:"zoomIn",zoomOut:"zoomOut",resetZoom:"resetZoom",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molDisplayTypeCondensed:"molDisplayTypeCondensed",molDisplayTypeSkeletal:"molDisplayTypeSkeletal",molDisplayTypeWire:"molDisplayTypeWire",molDisplayTypeSticks:"molDisplayTypeSticks",molDisplayTypeBallStick:"molDisplayTypeBallStick",molDisplayTypeSpaceFill:"molDisplayTypeSpaceFill",molHideHydrogens:"molHideHydrogens",molAutoGenerateCoords:"molAutoGenerateCoords",openEditor:"openEditor",config:"config",objInspector:"objInspector",issueInspector:"issueInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",selectAll:"selectAll",toggleSelect:"toggleSelect",eraseSelection:"eraseSelection",recheckIssues:"recheckIssues",toggleShowAllIssues:"toggleShowAllIssues",dragScroll:"dragScroll",erase:"erase",manipulate:"manipulate",trackInput:"trackInput",molBond:"bond",molAtom:"atom",molFormula:"formula",molAtomAndFormula:"atomAndFormula",molCharge:"charge",textBlock:"textBlock",imageBlock:"imageBlock",molRing:"ring",glyph:"glyph",textImage:"textImage",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign",nodeDisplayMode:"nodeDisplayMode"},Kekule.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"},function(){Class.PropertyScope,Kekule.ChemWidget,Kekule.Widget.HtmlClassNames;var s=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR_REGION:"K-Chem-Dialog-LoadData-SrcEditorRegion",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile",DIALOG_LOADAPPENDDATA:"K-Chem-Dialog-LoadAppendData",DIALOG_LOADAPPENDDATA_APPENDCHECKBOX:"K-Chem-Dialog-LoadAppendData-AppendCheckBox"}),Kekule.ChemWidget.LoadDataDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.ChemWidget.LoadDataDialog",initialize:function(e,t,n){this._openFileAction=new Kekule.ActionLoadFileData,this._openFileAction.setBinaryDetector(this._detectBinaryFormat),this._openFileAction.update(),this._openFileAction.addEventListener("load",this.reactFileLoad,this),this._sBtnLoadFromFile=Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_FROM_FILE"),this._formatItems=null,this.tryApplySuper("initialize",[e,t||Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG"),n||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]]),this.setResizable&&this.setResizable(!0)},finalize:function(){this._openFileAction.finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:null,getter:function(){var e=this.getDataDetails();return e&&e.data?Kekule.IO.loadTypedData(e.data,e.mimeType,e.fileName):null}}),this.defineProp("allowedFormatIds",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("allowedFormatIds",e),this.updateFormatItems()}}),this.defineProp("defaultFormatId",{dataType:DataType.STRING,setter:function(e){this.setPropStoreFieldValue("defaultFormatId",e),this.updateFormatItems()}}),this.defineProp("dataDetails",{dataType:DataType.HASH,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoAdjustSizeOnPopup(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+s.DIALOG_LOADDATA},doCreateClientContents:function(e){this.tryApplySuper("doCreateClientContents");var t=this.getDocument();(n=t.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_FORMAT"),e.appendChild(n),n=t.createElement("div"),e.appendChild(n);var n,i=new Kekule.Widget.SelectBox(this);i.addClassName(s.DIALOG_LOADDATA_FORMATBOX),i.appendToElem(n),this._formatSelector=i,this.updateFormatItems(),(n=t.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_DATA_SRC"),e.appendChild(n),(n=t.createElement("div")).className=s.DIALOG_LOADDATA_SRCEDITOR_REGION,e.appendChild(n);var r=new Kekule.Widget.TextEditor(this);r.setWrap("off").setAutoWrapThreshold(!0).setFileDroppable(!0),r.setToolbarPos(Kekule.Widget.Position.BOTTOM),r.addClassName(s.DIALOG_LOADDATA_SRCEDITOR),r.appendToElem(n),this._dataEditor=r},getFormatSelectorItems:function(e){for(var t=[],n=this.getAllowedFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds(),i=this.getDefaultFormatId(),r=0,a=n.length;r<a;++r){var o=Kekule.IO.DataFormatsManager.getFormatInfo(n[r]);if(o){for(var l=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(o.fileExts)),u=0,c=l.length;u<c;++u)l[u]="*."+l[u];var d=l.join(", "),h=o.title;d&&(h+=" ("+d+")");var p=i&&i===o.id;t.push({value:o.id,formatId:o.id,text:h,title:o.mimeType,data:o,selected:p})}}return t.sort(function(g,f){return g.text<f.text?-1:g.text>f.text?1:0}),t},getFileFilters:function(e){for(var t=[],n=0,i=e.length;n<i;++n){var r=e[n],a=r.data,o=r.text||r.title||r.value,l=Kekule.ArrayUtils.toArray(a.fileExts);t.push({title:o,filter:"."+l.join(",.")})}return t.push(Kekule.NativeServices.FILTER_ALL_SUPPORT),t.push(Kekule.NativeServices.FILTER_ANY),t},updateFormatItems:function(){this._formatItems=this.getFormatSelectorItems(),this._formatSelector.setItems(this._formatItems);var e=this.getFileFilters(this._formatItems);this._openFileAction.setFilters(e)},doSetButtons:function(e){var t=e||[];t.indexOf(this._sBtnLoadFromFile)<0&&t.unshift(this._sBtnLoadFromFile),this.tryApplySuper("doSetButtons",[t]);var n=this.getDialogButton(this._sBtnLoadFromFile);n.setAction(this._openFileAction),n.linkStyleResource(Kekule.Widget.StyleResourceNames.BUTTON_LOAD_FILE),n.addClassName(s.DIALOG_LOADDATA_BTN_LOADFROMFILE),n.setEnabled(this._openFileAction.getEnabled())},reactFileLoad:function(e){var t=e.data,n=e.fileName;try{if(e.success&&Kekule.ObjUtils.notUnset(t)&&n){this.setPropStoreFieldValue("dataDetails",{data:t,fileName:n});var i=Kekule.Widget.DialogButtons.OK;this.close(i)}}catch(r){Kekule.error(r)}},open:function(e,t,n){return this.setPropStoreFieldValue("dataDetails",{}),this.tryApplySuper("open",[e,t,n])},close:function(e){var t=this.getDataDetails();if((!t||!t.data&&!t.fileName)&&this.isPositiveResult(e)){var n=this._dataEditor.getValue(),i=this._formatSelector.getSelectedItemData(),r=i.id,a=i.mimeType;try{this.setPropStoreFieldValue("dataDetails",{data:n,mimeType:a,formatId:r})}catch(o){Kekule.raise(o,Kekule.ExceptionLevel.ERROR)}}return this.tryApplySuper("close",[e])},_detectBinaryFormat:function(e,t){if(t&&e){var n=Kekule.UrlUtils.extractFileExt(e),i=Kekule.IO.DataFormatsManager.findFormat(null,n);if(i)return Kekule.IO.ChemDataType.isBinaryType(i.dataType)}return!1}}),Kekule.ChemWidget.LoadOrAppendDataDialog=Class.create(Kekule.ChemWidget.LoadDataDialog,{CLASS_NAME:"Kekule.ChemWidget.LoadOrAppendDataDialog",initialize:function(e,t,n){this._appendCheckBox=null,this.tryApplySuper("initialize",[e,t,n])},initProperties:function(){this.defineProp("displayAppendCheckBox",{dataType:DataType.BOOL}),this.defineProp("isAppending",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._appendCheckBox&&this._appendCheckBox.getChecked()},setter:function(e){this._appendCheckBox&&this._appendCheckBox.setChecked(!!e)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+s.DIALOG_LOADAPPENDDATA},doCreateClientContents:function(e){this.tryApplySuper("doCreateClientContents",[e]),this.getDocument();var t=new Kekule.Widget.CheckBox(this);t.addClassName(s.DIALOG_LOADAPPENDDATA_APPENDCHECKBOX),t.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA_DIALOG_APPENDMODE")),t.appendToElem(e),t.setDisplayed(this.getDisplayAppendCheckBox()),this._appendCheckBox=t},open:function(e,t,n){return this.setIsAppending(!1),this._appendCheckBox.setDisplayed(this.getDisplayAppendCheckBox()),this.tryApplySuper("open",[e,t,n])}})}(),function(){var s=Kekule.DomUtils,e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames,n=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"}),Kekule.globalOptions.add("chemWidget.periodicTable",{displayedComponents:["symbol","name","atomicNumber","groupHead","legend"]}),Kekule.ChemWidget.PeriodicTable=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function(i,r){this.setPropStoreFieldValue("displayedComponents",r||this.getDefaultDisplayedComponents()),this._elemCells=[],this._selectedElemCells=[],this.tryApplySuper("initialize",[i]),this.setEnableSelect(!0),this.setEnableMultiSelect(!0)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}}),this.defineProp("startingAtomNum",{dataType:DataType.INT}),this.defineProp("endingAtomNum",{dataType:DataType.INT}),this.defineProp("startingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var i=this.getStartingAtomNum();return i&&Kekule.ChemicalElementsDataUtil.getElementSymbol(i)},setter:function(i){this.setStartingAtomNum(i&&Kekule.ChemicalElementsDataUtil.getAtomicNumber(i)||null)}}),this.defineProp("endingElementSymbol",{dataType:DataType.INT,serializable:!1,getter:function(){var i=this.getEndingAtomNum();return i&&Kekule.ChemicalElementsDataUtil.getElementSymbol(i)},setter:function(i){this.setEndingAtomNum(i&&Kekule.ChemicalElementsDataUtil.getAtomicNumber(i)||null)}}),this.defineProp("enabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("disabledElementSymbols",{dataType:DataType.ARRAY}),this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("useMiniMode",i),i?this.addClassName(n.PERIODIC_TABLE_MINI):this.removeClassName(n.PERIODIC_TABLE_MINI)}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL}),this.defineProp("selected",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){for(var i=[],r=this._selectedElemCells||[],a=0,o=r.length;a<o;++a){var l=r[a][this.ELEM_DATA_FIELD];l&&i.push(l)}return i}}),this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(i){this.setSelectedSymbols([i])}}),this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var i=this.getSelection();if(i){for(var r=[],a=0,o=i.length;a<o;++a)r.push(i[a].symbol);return r}return[]},setter:function(i){this.selectSymbols(i)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.PERIODIC_TABLE},doCreateRootElement:function(i){return i.createElement("div")},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this.createMainTable(i,r);return a.concat([o])},doObjectChange:function(i){var r=["displayedComponents","startingAtomNum","endingAtomNum"];Kekule.ArrayUtils.intersect(i,r).length&&this.recreateMainTable(),r=["enabledElementSymbols","disabledElementSymbols"],Kekule.ArrayUtils.intersect(i,r).length&&this.updateCellEnableStates()},getDefaultDisplayedComponents:function(){return Kekule.globalOptions.chemWidget.periodicTable.displayedComponents},getShowElemSymbol:function(){return this.getDisplayedComponents().indexOf("symbol")>=0},getShowElemName:function(){return this.getDisplayedComponents().indexOf("name")>=0},getShowAtomicNum:function(){return this.getDisplayedComponents().indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){return this.getDisplayedComponents().indexOf("atomicWeight")>=0},getShowGroupHead:function(){return this.getDisplayedComponents().indexOf("groupHead")>=0},getShowPeriodHead:function(){return this.getDisplayedComponents().indexOf("periodHead")>=0},getShowLegend:function(){return this.getDisplayedComponents().indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var i=this.getElement();s.clearChildContent(i),this.createMainTable(i.ownerDocument,i)},createMainTable:function(i,r){var a=Kekule.chemicalElementsData,o=[];this._elemCells=[];for(var l=[],u=[],c=i.createElement("table"),d=0;d<=this.MAX_PERIOD;++d){for(var h=i.createElement("tr"),p=[],g=0;g<=this.MAX_GROUP;++g){var f=i.createElement("td");h.appendChild(f),p.push(f)}c.appendChild(h),o.push(p)}var m=i.createElement("table");for(d=0;d<2;++d){for(h=i.createElement("tr"),p=[],g=0;g<this.LA_SERIES.length;++g)f=i.createElement("td"),h.appendChild(f),p.push(f);m.appendChild(h),l.push(p)}for(var C=this.getStartingAtomNum()||0,_=this.getEndingAtomNum()||3e5,y=0,T=a.length;y<T;++y){var E=a[y],b=E.atomicNumber;if(!(b<C||b>_)){var v=E.symbol,I=E.period,R=E.group,N=E.chemicalSerie.replace(/\s/g,"");Kekule.ArrayUtils.pushUnique(u,E.chemicalSerie);var L=this.LA_SERIES.indexOf(v),U=this.AC_SERIES.indexOf(v);L>=0?f=l[0][L]:U>=0?f=l[1][U]:I&&R&&(f=o[I][R]),f&&(f.className=n.PERIODIC_TABLE_ELEM_CELL,f.appendChild(this.createElemCellContent(i,E,N.upperFirst())),f[this.ELEM_DATA_FIELD]=E,this._elemCells.push(f)),L!==0&&U!==0||((f=o[I][R]).className=n.PERIODIC_TABLE_ELEM_STUBSCELL,f.appendChild(this.createElemCellStubsContent(i,E,N.upperFirst())))}}if(this.getShowGroupHead()){var W=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(g=1;g<=this.MAX_GROUP;++g)(f=o[d=g===1||g===18?0:g===2||g>=13?1:3][g]).className=n.PERIODIC_TABLE_HEAD_CELL+" "+n.PERIODIC_TABLE_HEAD_CELL_GROUP,f.appendChild(this.createHeadContent(i,W[g-1]))}if(this.getShowPeriodHead())for(d=1;d<=this.MAX_PERIOD;++d)(f=o[d][0]).className=n.PERIODIC_TABLE_HEAD_CELL+" "+n.PERIODIC_TABLE_HEAD_CELL_PERIOD,f.appendChild(this.createHeadContent(i,d));if(r.appendChild(c),this.getShowLegend()){var M=i.createElement("a");M.href="javascript:void(0)",M.className=n.PERIODIC_TABLE_LEGEND+" "+t.CORNER_ALL,s.setElementText(M,Kekule.$L("ChemWidgetTexts.LEGEND_CAPTION"));var B=i.createElement("div");B.className=n.PERIODIC_TABLE_LEGEND_CONTENT+" "+t.CORNER_ALL;var V={symbol:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_SYMBOL"),atomicNumber:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_NUM"),naturalMass:Kekule.$L("ChemWidgetTexts.LEGEND_ATOMIC_WEIGHT"),name:Kekule.$L("ChemWidgetTexts.LEGEND_ELEM_NAME")},J=this.createElemCellContent(i,V,n.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);B.appendChild(J);var $=i.createElement("div");for($.className=n.PERIODIC_TABLE_LEGEND_COLORS,y=0,T=u.length;y<T;++y){var q=i.createElement("div");q.className=n.PERIODIC_TABLE_LEGEND_COLOR+" "+u[y].replace(/\s/g,""),s.setElementText(q,u[y]),$.appendChild(q)}B.appendChild($),M.appendChild(B),r.appendChild(M)}return r.appendChild(m),this.updateCellEnableStates(),c},createElemCellContent:function(i,r,a){var o=i.createElement("div"),l=n.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(a&&(l+=" "+a),o.className=l,this.getShowAtomicNum()&&o.appendChild(this.createElemContentComponent(i,r.atomicNumber,n.ATOMIC_NUM)),this.getShowAtomicWeight()){var u=r.naturalMass;if(u){var c=typeof u=="number"?u.toFixed(3):u;o.appendChild(this.createElemContentComponent(i,c,n.ATOMIC_WEIGHT))}else o.appendChild(this.createElemContentComponent(i," ",n.ATOMIC_WEIGHT))}return this.getShowElemSymbol()&&o.appendChild(this.createElemContentComponent(i,r.symbol,n.ELEM_SYMBOL)),this.getShowElemName()&&o.appendChild(this.createElemContentComponent(i,r.name,n.ELEM_NAME)),o},createElemCellStubsContent:function(i,r,a){var o,l,u,c=i.createElement("div");return c.className=n.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(a||""),u=r.chemicalSerie,r.symbol==="La"?(o="57-71",l="La-Lu"):(o="89-103",l="Ac-Lr"),this.getShowAtomicNum()&&c.appendChild(this.createElemContentComponent(i,o,n.ATOMIC_NUM)),this.getShowElemSymbol()&&c.appendChild(this.createElemContentComponent(i,l,n.ELEM_SYMBOL_STUBS,!0)),this.getShowElemName()&&c.appendChild(this.createElemContentComponent(i,u,n.ELEM_NAME)),c},createElemContentComponent:function(i,r,a,o){var l=i.createElement("span");if(l.className=a,o){var u=i.createElement("span");l.appendChild(u)}return s.setElementText(u||l,r),l},createHeadContent:function(i,r,a){var o=i.createElement("div");return o.className=n.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(a||""),s.setElementText(o,r),o},updateCellEnableStates:function(){var i=this.getEnabledElementSymbols()||[],r=!i.length&&this.getDisabledElementSymbols()||[];if(r.length||i.length)for(var a=this._elemCells,o=0,l=a.length;o<l;++o){var u=this._getCellData(a[o]).symbol;i.length?i.indexOf(u)<0&&this.setCellEnableState(a[o],!1):r.length&&r.indexOf(u)>=0&&this.setCellEnableState(a[o],!1)}},setCellEnableState:function(i,r){r?(e.removeClass(i,t.STATE_DISABLED),this._getCellData(i).disabled=null):(e.addClass(i,t.STATE_DISABLED),this._getCellData(i).disabled=!0)},_getCellData:function(i){return i[this.ELEM_DATA_FIELD]},_isCellDisabled:function(i){return!!this._getCellData(i).disabled},_getAtomCellElem:function(i){var r=s.getNearestAncestorByTagName(i,"td",!0);return r&&this._elemCells.indexOf(r)>=0?r:null},_getCellElemOfSymbol:function(i){for(var r=this._elemCells,a=0,o=r.length;a<o;++a){var l=r[a];if(l[this.ELEM_DATA_FIELD].symbol===i)return l}return null},isCellSelected:function(i){return this._selectedElemCells.indexOf(i)>=0},selectCell:function(i){i&&(e.addClass(i,t.STATE_SELECTED),Kekule.ArrayUtils.pushUnique(this._selectedElemCells,i),this.invokeEvent("select",{elemData:i[this.ELEM_DATA_FIELD]}))},deselectCell:function(i){i&&(e.removeClass(i,t.STATE_SELECTED),Kekule.ArrayUtils.remove(this._selectedElemCells,i),this.invokeEvent("deselect",{elemData:i[this.ELEM_DATA_FIELD]}))},toggleCell:function(i){this.isCellSelected(i)?this.deselectCell(i):this.selectCell(i)},deselectAll:function(){for(var i=this._selectedElemCells,r=i.length-1;r>=0;--r)this.deselectCell(i[r]);return this},selectSymbols:function(i){this.deselectAll();for(var r=Kekule.ArrayUtils.toArray(i),a=0,o=r.length;a<o;++a){var l=this._getCellElemOfSymbol(r[a]);l&&this.selectCell(l)}return this},react_click:function(i){if(this.getEnableSelect()){var r=i.getTarget(),a=this._getAtomCellElem(r);if(a&&!this._isCellDisabled(a))return this.getEnableMultiSelect()?this.toggleCell(a):(this.deselectAll(),this.selectCell(a)),!0}this.tryApplySuper("react_click",[i])}})}(),function(){var s=Class.PropertyScope,e=Kekule.ArrayUtils,t=(Kekule.DomUtils,Kekule.ZoomUtils),n=(Kekule.ChemWidget,Kekule.Widget.HtmlClassNames),i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_MOL_AUTO_COORD_GENERATION:"K-Chem-MolAutoCoordGeneration",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_COPY:"K-Chem-Copy",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CLEAROBJS:"K-Chem-ClearObjs",ACTION_CONFIG:"K-Chem-Config",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION:"K-Chem-Dialog-Choose-File-Format-PreviewerRegion",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"}),Kekule.ChemWidget.ChemObjDisplayerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs"),this.addConfigProp("environment2DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs"),this.addConfigProp("environment3DConfigs","Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("ioConfigs",new Kekule.ChemWidget.ChemObjDisplayerIOConfigs),this.setPropStoreFieldValue("environment2DConfigs",new Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs),this.setPropStoreFieldValue("environment3DConfigs",new Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs)}}),Kekule.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",!0),this.addBoolConfigProp("autoGenerateCoordsAfterLoad",!0)}}),Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerEnvironmentConfigs",initProperties:function(){this.addBoolConfigProp("antialias",!1),this.addFloatConfigProp("antialiasBlurRatio",0),this.addFloatConfigProp("overSamplingRatio",1)}}),Kekule.ChemWidget.ChemObjDisplayer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function(r,a,o,l){this._paintFlag=0,this._bgColorMap={},this._contextTransformOpsMap=new Kekule.MapEx,this._reactChemObjDrawBind=this._reactChemObjDraw.bind(this),this.setPropStoreFieldValue("resetAfterLoad",!0),this.setPropStoreFieldValue("renderType",o||Kekule.Render.RendererType.R2D),this.setPropStoreFieldValue("displayerConfigs",l||this.createDefaultConfigs()),this.tryApplySuper("initialize",[r]),a&&this.setChemObj(a),this.setEnableLoadNewFile(!0)},doFinalize:function(){this.clearSubViews(),this.setPropStoreFieldValue("chemObj",null),this.getPainter().finalize();var r=this.getPropStoreFieldValue("drawBridge"),a=this.getPropStoreFieldValue("drawContext");a&&r&&r.releaseContext(a),r&&r.finalize&&r.finalize(),this.setPropStoreFieldValue("drawBridge",null),this.setPropStoreFieldValue("drawContext",null),this._contextTransformOpsMap&&this._contextTransformOpsMap.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,scope:s.PUBLIC}),this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL}),this.defineProp("allowedInputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("allowedOutputFormatIds",{dataType:DataType.ARRAY}),this.defineProp("defaultInputFormatId",{dataType:DataType.STRING,serializable:!1}),this.defineProp("defaultOutputFormatId",{dataType:DataType.STRING,serializable:!1}),this.defineProp("standardizationOptions",{dataType:DataType.HASH}),this.defineProp("resetAfterLoad",{dataType:DataType.BOOL}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:s.PUBLISHED,setter:function(r){var a=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",r),this.chemObjChanged(r,a)}}),this.defineProp("chemObjData",{dataType:DataType.STRING,serializable:!1,getter:null,setter:function(r){var a,o;(a=typeof r=="object"?r:JSON.parse(r))&&(o=a.format?Kekule.IO.loadFormatData(a.data,a.format):a.mimeType?Kekule.IO.loadMimeData(a.data,a.mimeType):null)&&this._tryAutoGenerateChemObjCoordsAndLoad(o)}}),this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:!1,scope:s.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,enumSource:Kekule.Render.RendererType,scope:s.PUBLISHED,setter:function(r){if(this.getAllowRenderTypeChange()){var a=this.getRenderType();r!==a&&(this.setPropStoreFieldValue("renderType",r),this.resetRenderType(a,r))}else Kekule.error(Kekule.$L("ErrorMsg.RENDER_TYPE_CHANGE_NOT_ALLOWED"))}}),this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:!1,scope:s.PUBLIC,getter:function(){var r=this.getPropStoreFieldValue("renderConfigs");return r||(r=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()),r},setter:function(r){this.setPropStoreFieldValue("renderConfigs",r);var a=this.getPropStoreFieldValue("painter");a&&a.setRenderConfigs(this.getRenderConfigs())}}),this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:s.PUBLISHED,setter:function(r){this.setPropStoreFieldValue("backgroundColor",r),this._bgColorMap[this.getRenderType().toString()]=r,this.backgroundColorChanged()}}),this.defineProp("inheritedRenderStyles",{dataType:DataType.ARRAY,scope:s.PUBLIC,getter:function(){var r=this.getPropStoreFieldValue("inheritedRenderStyles");return r||(r=[],this.setPropStoreFieldValue("inheritedRenderStyles",r)),r},setter:function(r){this.setPropStoreFieldValue("inheritedRenderStyles",r||[]),this.requestRepaint()}}),this.defineProp("inheritedRenderColor",{dataType:DataType.BOOL,scope:s.PUBLISHED,getter:function(){var r=this.getInheritedRenderStyles();return!!(r&&r.indexOf("color")>=0)},setter:function(r){if(!!r!==this.getInheritedRenderColor()){var a=this.getInheritedRenderStyles();r?a.push("color"):Kekule.ArrayUtils.remove(a,"color"),this.setInheritedRenderStyles(a)}}}),this.defineProp("inheritedRenderBackgroundColor",{dataType:DataType.BOOL,scope:s.PUBLISHED,getter:function(){var r=this.getInheritedRenderStyles();return!!(r&&r.indexOf("backgroundColor")>=0)},setter:function(r){if(!!r!==this.getInheritedRenderBackgroundColor()){var a=this.getInheritedRenderStyles();r?a.push("backgroundColor"):Kekule.ArrayUtils.remove(a,"backgroundColor"),this.setInheritedRenderStyles(a)}}}),this.defineProp("enableCustomCssProperties",{dataType:DataType.BOOL,setter:function(r){r!=this.getEnableCustomCssProperties()&&(this.setPropStoreFieldValue("enableCustomCssProperties",!!r),this.requestRepaint())}}),this.defineProp("transformParams",{dataType:DataType.HASH,serializable:!1,scope:s.PUBLIC,getter:function(){var r=Object.extend({},this.getDrawOptions());return r.screenCoordOffset=this.getBaseCoordOffset(),r},setter:function(r){var a=r||{};this.setDrawOptions(a),this.setBaseCoordOffset(a.baseCoordOffset),this.drawOptionChanged()}}),this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:!1,scope:s.PUBLIC,getter:function(){var r=this.getPropStoreFieldValue("drawOptions");return r||(r={},this.setPropStoreFieldValue("drawOptions",r)),r},setter:function(r){this.setPropStoreFieldValue("drawOptions",r),this.drawOptionChanged()}}),this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).zoom},setter:function(r){return this.zoomTo(r),this}}),this.defineProp("initialZoom",{dataType:DataType.FLOAT}),this.defineProp("autofit",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autofit},setter:function(r){var a=this.getDrawOptions()||{};return a.autofit=r,this.setDrawOptions(a)}}),this.defineProp("autoShrink",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).autoShrink},setter:function(r){var a=this.getDrawOptions()||{};return a.autoShrink=r,this.setDrawOptions(a)}}),this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).moleculeDisplayType},setter:function(r){return this.getDrawOptions().moleculeDisplayType=r,this.drawOptionChanged(),this}}),this.defineProp("hideHydrogens",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).hideHydrogens},setter:function(r){return this.getDrawOptions().hideHydrogens=!!r,this.drawOptionChanged(),this}}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:!1,scope:s.PUBLIC,getter:function(){return Kekule.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}}),this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:!1,setter:function(r){r!=this.getAutoSize()&&(this.setPropStoreFieldValue("autoSize",r),r&&this.allowAutoSize()&&this.drawOptionChanged())}}),this.defineProp("padding",{dataType:DataType.INT,serializable:!1,setter:function(r){r!=this.getPadding()&&(this.setPropStoreFieldValue("padding",r),this.getDrawOptions().autofitContextPadding=r,this.drawOptionChanged())}}),this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:!1,setter:function(r){this.setPropStoreFieldValue("baseCoordOffset",r),this.getChemObjLoaded()&&this.repaint()}}),this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:!1,scope:s.PRIVATE,setter:null,getter:function(r){var a=this.getPropStoreFieldValue("drawBridge");return a||this.__$drawBridgeInitialized$__||(this.__$drawBridgeInitialized$__=!0,a=this.createDrawBridge(),this.setPropStoreFieldValue("drawBridge",a)),a}}),this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:!1,scope:s.PRIVATE,setter:null,getter:function(){var r=this.getPropStoreFieldValue("drawContext");if(!r){var a=this.getDrawBridge();if(a){var o=this.getDrawContextParentElem();if(!o)return null;var l=Kekule.HtmlElementUtils.getElemOffsetDimension(o);r=a.createContext(o,l.width,l.height,this.getContextCreationParams(this.getRenderType(),a)),this.setPropStoreFieldValue("drawContext",r)}}return r}}),this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,scope:s.PRIVATE,setter:null,getter:function(){var r=this.getPropStoreFieldValue("painter");return r||(r=this.createNewPainter()),r}}),this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,scope:s.PRIVATE,setter:null,getter:function(){var r=this.getPainter();return r?r.getRenderer():null}}),this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var r=this.getRootRenderer();return r&&r.getBoundInfoRecorder()}}),this.defineProp("subViews",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(r){var a=this.getPropStoreFieldValue("subViews");return!a&&r&&(a=[],this.setPropStoreFieldValue("subViews",a)),a}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setStandardizationOptions({unmarshalSubFragments:!1,clearHydrogens:!1})},doEndUpdate:function(r){this.tryApplySuper("doEndUpdate",[r]),this._requestRepainting&&this.repaint(this._requestRepainting.overrideOptions)},elementBound:function(r){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(r){this.tryApplySuper("doWidgetShowStateChanged",[r]),r&&this.setChemObj(this.getChemObj())},doFileDragDrop:function(r){if(r){var a=this;return(function(){Kekule.IO.loadFileData(r[0],function(o,l){l&&a.setChemObj(o)})}).defer(),!0}return this.tryApplySuper("doFileDragDrop")},notifyStyleAttribChanged:function(r){this.tryApplySuper("notifyStyleAttribChanged",[r]),(this.getInheritedRenderStyles()||[]).length&&this.requestRepaint()},getAllowRenderTypeChange:function(){return!1},resetRenderType:function(r,a){var o=this.getChemObj(),l=this.getPropStoreFieldValue("drawBridge"),u=this.getPropStoreFieldValue("drawContext");l&&u&&l.releaseContext(u),this.setPropStoreFieldValue("drawContext",null),this.setPropStoreFieldValue("drawBridge",null),this.__$drawBridgeInitialized$__=!1;var c=this.getBackgroundColorOfType(a);this.getDrawOptions().moleculeDisplayType=this.getDefaultMoleculeDisplayType(a),this.setPropStoreFieldValue("backgroundColor",c),this.backgroundColorChanged(!0),this._doLoadOnObj(o,{refreshOnly:!0}),this.resetDisplay()},resetRenderEnvironment:function(){return this.resetRenderType(null,this.getRenderType()),this},getDisplayerEnvironmentConfigs:function(){return this.getCoordMode()===Kekule.CoordMode.COORD3D?this.getDisplayerConfigs().getEnvironment3DConfigs():this.getDisplayerConfigs().getEnvironment2DConfigs()},getContextCreationParams:function(r,a){var o=this.getRenderConfigs(),l=this.getDisplayerConfigs();return r===Kekule.Render.RendererType.R3D?{alpha:!0,antialias:o.getEnvironmentConfigs().getAntialias()}:{alpha:!0,antialias:l.getEnvironment2DConfigs().getAntialias(),antialiasBlurRatio:l.getEnvironment2DConfigs().getAntialiasBlurRatio(),overSamplingRatio:l.getEnvironment2DConfigs().getOverSamplingRatio()}},createDefaultConfigs:function(){return new Kekule.ChemWidget.ChemObjDisplayerConfigs},getCoordMode:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},setCoordMode:function(r){var a=r===Kekule.CoordMode.COORD3D?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(a)},loadPredefinedResDataToProp:function(r,a,o){if(r==="chemObj")if(o)try{var l=Kekule.IO.loadTypedData(a.data,a.resType,a.resUri);l||(l=Kekule.IO.loadFormatData(a.data,a.resType)),l?this._tryAutoGenerateChemObjCoordsAndLoad(l):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}catch(u){this.reportException(u)}else this.reportException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+a.resUri||"")},reportException:function(r,a){Kekule.raise(r,a||Kekule.ExceptionLevel.ERROR)},createDrawBridge:function(r){var a=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.Render.DrawBridge3DMananger:Kekule.Render.DrawBridge2DMananger,o=a.getPreferredBridgeInstance();if(!o&&!r){var l=a.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));l&&this.reportException(l,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return o},getClientElement:function(){return this.getElement()},getDrawContextParentElem:function(r){var a=this._drawContextParentElem;if(!a&&!r){a=this.getDocument().createElement("div"),this._drawContextParentElem=a,Kekule.HtmlElementUtils.addClass(a,n.DYN_CREATED),Kekule.HtmlElementUtils.addClass(a,i.DISPLAYER_DRAWCONTEXT_PARENT),a.style.width="100%",a.style.height="100%";var o=this.getClientElement(),l=Kekule.DomUtils.getFirstChildElem(o);l?o.insertBefore(a,l):o.appendChild(a)}return a},allowAutoSize:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D},canModifyPartialGraphic:function(r){var a=this.getDrawBridge();return!!a.canModifyGraphic&&a.canModifyGraphic(r||this.getDrawContext())},doInsertedToDom:function(){this.doResize()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(r){if(this.getDrawBridge()&&this.getDrawContext()){var a=Kekule.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem()),o=this.changeContextDimension(a);!r&&o&&this.repaint()}},getContextDimension:function(){return this.getDrawBridge()&&this.getDrawContext()?this.getDrawBridge().getContextDimension(this.getDrawContext()):null},_getContextOverSamplingRatio:function(){var r=this.getDisplayerEnvironmentConfigs();return r.getAntialias&&r.getAntialias()&&r.getOverSamplingRatio&&r.getOverSamplingRatio()||1},changeContextDimension:function(r){return this.doChangeContextDimension(this.getDrawContext(),this.getDrawBridge(),r,!0)},doChangeContextDimension:function(r,a,o,l){if(a&&r){var u=o.width,c=o.height,d=a.getContextElem(r);if(d){var h=this._getContextOverSamplingRatio();if(h!==1&&Kekule.BrowserFeature.cssTranform&&l){var p=1/h;d.style.transform="scale("+p+","+p+")",d.style.transformOrigin="0 0",a.setContextParam(r,"overSamplingRatio",h)}else d.style.transform="",a.setContextParam(r,"overSamplingRatio",null)}return this._resizeContext(r,a,u,c),!0}return!1},_resizeContext:function(r,a,o,l){r&&a&&a.setContextDimension(r,o,l)},clearContext:function(){var r=this.getPropStoreFieldValue("drawContext");if(r){var a=this.getPropStoreFieldValue("painter");a&&a.clear(r),this.getDrawBridge().clearContext(r)}},createNewPainter:function(r){var a=this.getPropStoreFieldValue("painter");a&&(a.removeEventListener("draw",this._reactChemObjDrawBind),a.finalize());var o=this.getDrawBridge()?new Kekule.Render.ChemObjPainter(this.getRenderType(),r||this.getChemObj(),this.getDrawBridge()):null;return this.setPropStoreFieldValue("painter",o),o&&o.addEventListener("draw",this._reactChemObjDrawBind),o},isRenderable:function(){return!(!this.getDrawBridge()||!this.getDrawContext())},chemObjChanged:function(r,a){this.doLoad(r),this.getResetAfterLoad()&&a&&this.resetDisplay()},load:function(r){this.setChemObj(r)},doLoad:function(r,a){this._doLoadOnObj(r)},_doLoadOnObj:function(r,a){var o=a&&a.refreshOnly;this.clearSubViews(),this.refitDrawContext(!0),this.setPropStoreFieldValue("chemObjLoaded",!1);try{if(r){var l=this.createNewPainter(r);l&&l.setRenderConfigs(this.getRenderConfigs()),this.repaint(),this.setPropStoreFieldValue("chemObjLoaded",!0),o||this.invokeEvent("load",{obj:r})}else this.clearContext(),o||this.invokeEvent("load",{obj:r})}catch(u){this.clearContext(),this.reportException(u)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(r){},loadFromData:function(r,a,o,l,u){try{var c;return r?(l?c=Kekule.IO.loadFormatData(r,l):(a||o)&&(c=Kekule.IO.loadTypedData(r,a,o)),c?u?this._tryAutoGenerateChemObjCoordsForLoading(c,u):this._tryAutoGenerateChemObjCoordsAndLoad(c):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED")),c):(this.setChemObj(null),null)}catch(d){this.reportException(d)}},loadFromFile:function(r){if(r){var a=this;try{Kekule.IO.loadFileData(r,function(o,l){l&&a._tryAutoGenerateChemObjCoordsAndLoad(o)})}catch(o){this.reportException(o)}}else this.setChemObj(null)},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(r,a,o){o=o||this.getSavingTargetObj(),this.prepareSaveData(o);var l=Kekule.IO.ChemDataWriterManager.getWriterByFormat(r,null,o);return l?(this._needToCanonicalizeBeforeSaving()&&this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave()&&o.standardize&&(o=this._cloneSavingTargetObj(o)).standardize(this.getStandardizationOptions()),a||(a=Kekule.IO.DataFormatsManager.getFormatInfo(r).dataType),l.writeData(o,a,r)):(Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")),null)},_cloneSavingTargetObj:function(r){return r.clone?r.clone(!0):r},_needToCanonicalizeBeforeSaving:function(){return!1},prepareSaveData:function(r){},_molNeedAutoCoordGeneration:function(r,a){return r instanceof Kekule.StructureFragment&&r.getNodeCount()>0&&!r.nodesHasCoordOfMode(this.getCoordMode(),this.getAllowCoordBorrow(),!0)},_isCoordGeneratorAvailable:function(r){if(Kekule.Calculator&&Kekule.Calculator.Services){var a=r===Kekule.CoordMode.COORD3D?Kekule.Calculator.Services.GEN3D:Kekule.Calculator.Services.GEN2D;return Kekule.Calculator.hasService(a)}return!1},canAutoGenerateCoordForChemObj:function(r,a){return r||(r=this.getChemObj()),Kekule.ObjUtils.isUnset(a)&&(a=this.getCoordMode()),r&&r instanceof Kekule.StructureFragment&&r.hasCtab()&&Kekule.Calculator&&Kekule.Calculator.generateStructure&&this._isCoordGeneratorAvailable(a)},_tryAutoGenerateChemObjCoords:function(r,a,o){if(Kekule.ObjUtils.isUnset(a)&&(a=this.getCoordMode()),this.canAutoGenerateCoordForChemObj(r,a)){var l=a===Kekule.CoordMode.COORD3D?Kekule.Calculator.Services.GEN3D:Kekule.Calculator.Services.GEN2D;try{Kekule.Calculator.generateStructure(r,l,{modifySource:!0},function(u){o(u)},function(u){o(r),Kekule.error(u)})}catch{o(r)}}else o(r)},_tryAutoGenerateChemObjCoordsForLoading:function(r,a){this.getDisplayerConfigs().getIoConfigs().getAutoGenerateCoordsAfterLoad()&&(this._molNeedAutoCoordGeneration(r,this.getCoordMode())?this._tryAutoGenerateChemObjCoords(r,null,a):a(r))},_tryAutoGenerateChemObjCoordsAndLoad:function(r){var a=this;this._tryAutoGenerateChemObjCoordsForLoading(r,function(o){a.setChemObj(o)})},autoGenerateChemObjCoords:function(r,a,o){var l=!a&&Kekule.ObjUtils.isUnset(o);a||(a=this.getChemObj()),Kekule.ObjUtils.isUnset(o)&&(o=this.getCoordMode());var u=this;return this._tryAutoGenerateChemObjCoords(a,o,function(c){l&&u.load(c),r&&r(c)}),this},getDrawClientDimension:function(){return Kekule.HtmlElementUtils.getElemClientDimension(this.getCoreElement())},setDrawDimension:function(r,a){this.setDimension(r,a)},calcDrawBaseCoord:function(r,a){var o,l,u=this.getDrawContext(),c=this.getPainter();if(!this._isContinuousRepainting&&a&&this.getActualAutoSize()){var d=this.getPadding()||0,h=c.estimateScreenBox(u,o,r,this.getAllowCoordBorrow());if(h){var p=h.x2-h.x1+2*d,g=h.y2-h.y1+2*d;this.changeContextDimension({width:p,height:g}),this.setDrawDimension(p,g),l={width:p,height:g},o={x:p/2,y:g/2}}}else if(!(o=r?r.baseCoord:null)){var f=this.getDrawClientDimension();o={x:f.width/2,y:f.height/2};var m=this.getBaseCoordOffset();m&&(o=Kekule.CoordUtils.add(o,m))}return{baseCoord:o=this.getDrawBridge().transformScreenCoordToContext(u,o),baseCoordPos:Kekule.Render.CoordPos.CENTER,newWidgetDimension:l}},getActualDrawOptions:function(){return this.getDrawOptions()},getActualAutoSize:function(){return this.getAutoSize()&&this.allowAutoSize()&&!this.getAutofit()},calcDrawParams:function(r,a){var o=this.getActualDrawOptions();r&&(o=Object.extend(o,r));var l=this.calcDrawBaseCoord(o,a);return{drawOptions:o,baseCoord:l.baseCoord,baseCoordPos:l.baseCoordPos,newWidgetDimension:l.newWidgetDimension}},_savePainterInitialRenderTransformOptions:function(r,a){var o=a.getActualInitialRenderTransformOptions(r);this._contextTransformOpsMap.set(r,o)},requestRepaint:function(r){this._requestRepainting={overrideOptions:r};var a=this;(function(){a._requestRepainting&&a._repaintCore(a._requestRepainting.overrideOptions),a._requestRepainting=null}).delay(0)},repaint:function(r){if(!this.isUpdating()){try{var a=this._repaintCore(r)}finally{this._requestRepainting=null}return a}this._requestRepainting={overrideOptions:r}},_repaintCore:function(r){if(this.getElement()&&!this.isPainting()&&this.isRenderable()){this.beginPaint();try{if(this.getInheritedRenderBackgroundColor()){var a=this.getComputedStyle("backgroundColor");this.backgroundColorChanged(!0,a||null)}else this.backgroundColorChanged(!0);if(r&&r.doNotClear||this.clearContext(),!this.getChemObj())return;var o,l,u=this.getPainter(),c=this.getDrawContext(),d=!0;if(r&&r.preserveTransformOptions?(l=this._contextTransformOpsMap.get(c)||null,d=!1,o=this.calcDrawParams(l,!0)):o=this.calcDrawParams(r,!0),this._lastBaseCoord=o.baseCoord,this.getInheritedRenderColor()){var h=this.getComputedStyle("color");o.drawOptions.color=h}else o.drawOptions.color=null;this.getEnableCustomCssProperties()&&this._applyCustomCssProps(o.drawOptions),this._setupRenderingEnvironment(c,this.getDrawBridge()),u.draw(c,o.baseCoord,o.drawOptions),d&&this._savePainterInitialRenderTransformOptions(c,u),this.invokeEvent("repaint",{obj:this.getChemObj()})}finally{this.endPaint()}}},_setupRenderingEnvironment:function(r,a){var o=this.getDisplayerEnvironmentConfigs();if(o.getAntialias&&o.getAntialias()&&(u=o.getAntialiasBlurRatio&&o.getAntialiasBlurRatio()||0)){var l=this.getRenderConfigs().getLengthConfigs(),u=o.getAntialiasBlurRatio()||0,c=l.getActualLength("bondLineWidth")*u||0,d=a||this.getDrawBridge();d.setFilter&&d.clearFilter&&(c?d.setFilter(r,"blur("+c+"px)"):d.clearFilter(r))}},beginPaint:function(){this._paintFlag||(this._paintFlag=0),++this._paintFlag},endPaint:function(){this._paintFlag>0&&--this._paintFlag,this._paintFlag<0&&(this._paintFlag=0)},isPainting:function(){return this._paintFlag>0},_reactChemObjDraw:function(r){var a=r.obj;a===this.getChemObj()&&this.chemObjRendered(a,r.renderOptions||{})},chemObjRendered:function(r,a){},getBackgroundColorOfType:function(r){return this._bgColorMap[r.toString()]},setBackgroundColorOfType:function(r,a){this._bgColorMap[a.toString()]=r,a===this.getRenderType()&&this.setBackgroundColor(r)},backgroundColorChanged:function(r,a){var o=a;o===void 0&&(o=this.getBackgroundColor()),o==="transparent"&&(o=null);var l=this.getDrawBridge();l&&l.setClearColor&&(l.setClearColor(this.getDrawContext(),o),r||this.requestRepaint())},_getApplicableCustomCssPropNames:function(){return{r2d:["unitLength","moleculeDisplayType","hydrogenDisplayLevel","showCharge","chargeMarkFontSize","chargeMarkMargin","chemMarkerFontSize","chemMarkerMargin","distinguishSingletAndTripletRadical","fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","bondLengthScaleRatio","color","atomColor","bondColor","useAtomSpecifiedColor","opacity","fillColor","strokeColor","strokeWidth","atomRadius"],r3d:["displayMultipleBond","useVdWRadius","nodeRadius","connectorRadius","nodeRadiusRatio","connectorRadiusRatio","color","atomColor","bondColor","useAtomSpecifiedColor","hideHydrogens","bondSpliceMode"]}},_getRenderOptionDefinitionsHash:function(){if(!this.__$renderOptionDefinitionsHash__){this.__$renderOptionDefinitionsHash__={};var r,a,o=Kekule.Render.RenderOptionUtils.getOptionDefinitions(),l=Kekule.Render.Render3DOptionUtils.getOptionDefinitions();for(r=0,a=o.length;r<a;++r)this.__$renderOptionDefinitionsHash__[o[r].name]=o[r];for(r=0,a=l.length;r<a;++r)this.__$renderOptionDefinitionsHash__[l[r].name]=l[r]}return this.__$renderOptionDefinitionsHash__},_applyCustomCssProps:function(r){var a,o,l=this._getRenderOptionDefinitionsHash(),u=this._getApplicableCustomCssPropNames();for(a=0,o=u.r2d.length;a<o;++a){var c=u.r2d[a];this._applyCustomCssPropValue(c,l,r)}if(this.getRenderType()===Kekule.Render.RendererType.R3D)for(a=0,o=u.r3d.length;a<o;++a)c=u.r3d[a],this._applyCustomCssPropValue(c,l,r)},_applyCustomCssPropValue:function(r,a,o){if(a[r]){var l=this.getComputedCustomStyle(r);if(l&&l.trim){l=l.trim();var u=Kekule.StrUtils.convertToType(l,a.dataType);Kekule.ObjUtils.notUnset(u)&&(o[r]=u)}}},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var r=this.getPainter(),a=this.getDrawOptions();if(r&&r.supportGeometryOptionChange()){var o=this.getDrawContext();r.changeGeometryOptions(o,a.baseCoord||this._lastBaseCoord,a),this._savePainterInitialRenderTransformOptions(o,r),this.invokeEvent("repaint",{obj:this.getChemObj()})}else this.drawOptionChanged()},beginContinuousRepainting:function(){this._isContinuousRepainting=!0},endContinuousRepainting:function(){this._isContinuousRepainting&&(this._isContinuousRepainting=!1,this.repaint())},resetDisplay:function(){var r=this.getDrawOptions();return r.zoom=this.getInitialZoom()||1,r.rotateX=0,r.rotateY=0,r.rotateZ=0,r.rotateAngle=0,r.rotateAxisVector=null,r.rotateMatrix=null,this.setBaseCoordOffset(null),this.geometryOptionChanged(),this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(r,a,o){return this.getDrawOptions().zoom=r,a||this.geometryOptionChanged(),this},zoomIn:function(r,a){var o=this.getCurrZoom(),l=t.getNextZoomInRatio(o,r||1);return this.zoomTo(l,null,a)},zoomOut:function(r,a){var o=this.getCurrZoom(),l=t.getNextZoomOutRatio(o,r||1);return this.zoomTo(l,null,a)},resetZoom:function(r){return this.zoomTo(this.getInitialZoom()||1,null,r)},getDefaultMoleculeDisplayType:function(r){return r===Kekule.Render.RendererType.R3D?Kekule.Render.Molecule3DDisplayType.DEFAULT:Kekule.Render.Molecule2DDisplayType.DEFAULT},getCurrMoleculeDisplayType:function(){var r=this.getDrawOptions().moleculeDisplayType;return r||(r=this.getDefaultMoleculeDisplayType(this.getRenderType())),r},exportToDataUri:function(r,a){return this.getDrawBridge().exportToDataUri(this.getDrawContext(),r,a)},createConfigurator:function(){var r=this.tryApplySuper("createConfigurator");return r.addEventListener("configChange",function(a){this.repaint()},this),r},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getDrawContext())},findTopmostBoundInfo:function(r,a){if(r&&r.length){var o=null,l=r.length-1;for(o=r[l];l>=0&&a&&a.indexOf(o.obj)>=0;)o=r[--l];return o}return null},getBoundInfosAtCoord:function(r,a,o){var l=this.getBoundInfoRecorder(),u=o,c=this.screenCoordToContext(r),d=this.getRenderType()===Kekule.Render.RendererType.R3D?{x:0,y:0}:null;return l.getIntersectionInfos(this.getDrawContext(),c,d,u,a)},getTopmostBoundInfoAtCoord:function(r,a,o){return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(r,null,o),a,o)},getBasicObjectsAtCoord:function(r,a,o,l){var u=this.getBoundInfosAtCoord(r,null,a),c=[];if(u){o&&(u=e.filter(u,function(p){var g=u[d].obj;return!!g&&!(g&&o&&o.indexOf(g)>=0)}));for(var d=u.length-1;d>=0;--d){var h=u[d].obj;h&&o&&o.indexOf(h)>=0||c.push(h)}c&&l&&(c=e.filter(c,function(p){for(var g=0,f=l.length;g<f;++g)if(p instanceof l[g])return!0;return!1}))}return c},getTopmostBasicObjectAtCoord:function(r,a,o){var l=this.getBasicObjectsAtCoord(r,a,null,o);return l&&l[0]},translateCoord:function(r,a,o){if(!r)return null;var l=Kekule.Render.CoordSystem;if(a===l.SCREEN){if(o===l.SCREEN)return r;if(o===l.CONTEXT)return this.getDrawBridge()?this.getDrawBridge().transformScreenCoordToContext(this.getDrawContext(),r):r;var u=this.getDrawBridge()?this.getDrawBridge().transformScreenCoordToContext(this.getDrawContext(),r):r;return this.getDrawContext()?this.getRootRenderer().transformCoordToObj(this.getDrawContext(),this.getChemObj(),u):r}return a===l.CONTEXT?o===l.SCREEN?this.getDrawBridge()?this.getDrawBridge().transformContextCoordToScreen(this.getDrawContext(),r):r:o===l.CONTEXT?r:this.getDrawContext()?this.getRootRenderer().transformCoordToObj(this.getDrawContext(),this.getChemObj(),r):r:o===l.SCREEN?(u=this.getRootRenderer().transformCoordToContext(this.getDrawContext(),this.getChemObj(),r),this.getDrawBridge()?this.getDrawBridge().transformContextCoordToScreen(this.getDrawContext(),u):r):o===l.CONTEXT&&this.getDrawContext()?this.getRootRenderer().transformCoordToContext(this.getDrawContext(),this.getChemObj(),r):r},translateDistance:function(r,a,o){var l={x:r,y:0,z:0},u=this.translateCoord({x:0,y:0,z:0},a,o),c=this.translateCoord(l,a,o);return Kekule.CoordUtils.getDistance(u,c)},objCoordToContext:function(r){var a=Kekule.Render.CoordSystem;return this.translateCoord(r,a.CHEM,a.CONTEXT)},contextCoordToObj:function(r){var a=Kekule.Render.CoordSystem;return this.translateCoord(r,a.CONTEXT,a.CHEM)},objCoordToScreen:function(r){var a=Kekule.Render.CoordSystem;return this.translateCoord(r,a.CHEM,a.SCREEN)},screenCoordToObj:function(r){var a=Kekule.Render.CoordSystem;return this.translateCoord(r,a.SCREEN,a.CHEM)},screenCoordToContext:function(r){var a=Kekule.Render.CoordSystem;return this.translateCoord(r,a.SCREEN,a.CONTEXT)},contextCoordToScreen:function(r){var a=Kekule.Render.CoordSystem;return this.translateCoord(r,a.CONTEXT,a.SCREEN)},screenBoxToContext:function(r){var a=this.screenCoordToContext({x:r.x1,y:r.y1}),o=this.screenCoordToContext({x:r.x2,y:r.y2});return{x1:a.x,y1:a.y,x2:o.x,y2:o.y}},clearSubViews:function(){var r=this.getSubViews();if(r)for(var a=0,o=r.length;a<o;++a)r[a].finalize();this.setPropStoreFieldValue("subViews",void 0)},iterateSubViews:function(r){var a=this.getSubViews();if(a)for(var o=0,l=a.length;o<l;++o)r(a[o],o);return this},getSubView:function(r,a,o){var l,u=this.getSubViews();if(u)for(var c=0,d=u.length;c<d;++c){var h=u[c];if(h.getTarget()===r&&h instanceof a){l=h;break}}return!l&&o&&ClassEx.getPrototype(a).appliableToTarget(r)&&(l=new a(this,r),this.getSubViews(!0).push(l)),l},fetchSubView:function(r,a){return this.getSubView(r,a,!0)}}),Kekule.ChemWidget.ChemObjDisplayerSubView=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSubView",initialize:function(r,a){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("parent",r),this.setPropStoreFieldValue("target",a)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1,setter:null}),this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:!1,getter:function(){return this.getPropStoreFieldValue("target")||this.getParent().getChemObj()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setBubbleEvent(!0)},getHigherLevelObj:function(){return this.getParent()},appliableToTarget:function(r){return!1}}),Kekule.ChemWidget.ChemObjDisplayer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function(r){this.tryApplySuper("initialize",[r])},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}}),Kekule.ChemWidget.ChemObjDisplayer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(r){this.tryApplySuper("initialize",[r])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var r=this.tryApplySuper("getCategoryInfos"),a=this.getDisplayer(),o=[a.getDisplayerConfigs(),a.getRenderConfigs()],l=0,u=o.length;l<u;++l)for(var c=o[l],d=c.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),h=0,p=d.getLength();h<p;++h){var g=d.getPropInfoAt(h),f=c.getPropValue(g.name);f&&r.push({obj:f,name:g.name,title:g.title,description:g.description})}return r},getDisplayer:function(){return this.getWidget()}}),Kekule.ChemWidget.ActionDisplayerLoadFile=Class.create(Kekule.ActionLoadFileData,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:i.ACTION_LOADFILE,initialize:function(r){this.tryApplySuper("initialize"),this.setDisplayer(r),this.setText(Kekule.$L("ChemWidgetTexts.CAPTION_LOADFILE")),this.setHint(Kekule.$L("ChemWidgetTexts.HINT_LOADFILE"))},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer();this.setEnabled(this.getEnabled()&&r&&r.getEnabled()&&r.getEnableLoadNewFile())},doDataLoaded:function(r,a,o){o&&this.getDisplayer().loadFromData(r,null,a)}}),Kekule.ChemWidget.ActionOnDisplayer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function(r,a,o){this.tryApplySuper("initialize"),this.setDisplayer(r),this.setText(a),this.setHint(o)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:!1})},doUpdate:function(){var r=this.getDisplayer();this.setEnabled(r&&r.getChemObj()&&r.getChemObjLoaded()&&r.getEnabled())},execute:function(r,a){return!this.getDisplayer()&&r instanceof Kekule.ChemWidget.ChemObjDisplayer&&this.setDisplayer(r),this.tryApplySuper("execute",[r,a])}}),Kekule.ChemWidget.ActionDisplayerClear=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerClear",HTML_CLASSNAME:i.ACTION_CLEAROBJS,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_CLEAROBJS"),Kekule.$L("ChemWidgetTexts.HINT_CLEAROBJS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer();this.setEnabled(r&&r.getEnabled()&&r.getChemObj())},doExecute:function(r){this.getDisplayer().setChemObj(null)}}),Kekule.ChemWidget.ActionDisplayerLoadData=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:i.ACTION_LOADDATA,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_LOADDATA"),Kekule.$L("ChemWidgetTexts.HINT_LOADDATA")])},finalize:function(){this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.ChemWidget.LoadDataDialog",serializable:!1,setter:null,getter:function(){var r=this.getPropStoreFieldValue("dataDialog");return r||(r=this.createDataDialog(),this.setPropStoreFieldValue("dataDialog",r)),r}}),this.defineProp("dialogShowType",{dataType:DataType.INT})},createDataDialog:function(){var r=this.getDisplayer().getDocument();return new Kekule.ChemWidget.LoadDataDialog(r)},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer();this.setEnabled(r&&r.getEnabled()&&r.getEnableLoadNewFile())},doExecute:function(r){var a=this,o=this.getDataDialog();o.setPropStoreFieldValue("defaultFormatId",this.getDisplayer().getDefaultInputFormatId()),o.setAllowedFormatIds(this.getDisplayer().getAllowedInputFormatIds()||Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds()),o._formatSelector;var l=this.getDialogShowType();(l===Kekule.Widget.ShowHideType.DIALOG?o.openModal:o.open).apply(o,[function(u){if(o.isPositiveResult(u)){var c=o.getDataDetails()||{},d=a.getDisplayer();a.doLoadInDisplayer(d,c,o)}},r,l])},doLoadInDisplayer:function(r,a,o){return r.loadFromData(a.data,a.mimeType,a.fileName,a.formatId)}}),Kekule.ChemWidget.ActionDisplayerSaveFile=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:i.ACTION_SAVEFILE,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEFILE"),Kekule.$L("ChemWidgetTexts.HINT_SAVEFILE")]),this._saveAction=new Kekule.ActionFileSave},finalize:function(){this._saveAction.finalize(),this.tryApplySuper("finalize")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDialogShowType(Kekule.Widget.ShowHideType.DROPDOWN)},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:!1,setter:null,getter:function(){var r=this.getPropStoreFieldValue("formatDialog");return r||(r=this.createFormatDialog(),this.setPropStoreFieldValue("formatDialog",r)),r}}),this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:!1}),this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:!1}),this.defineProp("dialogShowType",{dataType:DataType.INT})},getChemObjSrcInfo:function(r){var a=this.getDisplayer();return a.getChemObjSrcInfo?a.getChemObjSrcInfo(r):r.getSrcInfo?r.getSrcInfo():null},getChemObjSrcFormat:function(r){var a=this.getChemObjSrcInfo(r);return a?a.format:null},createFormatDialog:function(){var r=this.getDisplayer().getDocument(),a=new Kekule.Widget.Dialog(r,Kekule.$L("ChemWidgetTexts.CAPTION_SAVEDATA_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);a.addClassName(i.DIALOG_CHOOSE_FILE_FORAMT),a.setAutoAdjustSizeOnPopup(!0),(o=r.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_FORMAT"),a.getClientElem().appendChild(o),o=r.createElement("div"),a.getClientElem().appendChild(o);var o,l=new Kekule.Widget.SelectBox(a);l.addClassName(i.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX),l.appendToElem(o),l.addEventListener("valueChange",this.reactFormatSelectorChange,this),a._formatSelector=l,(o=r.createElement("div")).innerHTML=Kekule.$L("ChemWidgetTexts.CAPTION_PREVIEW_FILE_CONTENT"),a.getClientElem().appendChild(o),(o=r.createElement("div")).className=i.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER_REGION,a.getClientElem().appendChild(o);var u=new Kekule.Widget.TextEditor(a);return u.setReadOnly(!0),u.setWrap("off").setAutoWrapThreshold(!0),u.setToolbarPos(Kekule.Widget.Position.BOTTOM),u.addClassName(i.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER),u.appendToElem(o),a._previewTextArea=u,a.setResizable&&a.setResizable(!0),a},getAvailableWriterInfos:function(r){return r?Kekule.IO.ChemDataWriterManager.getAvailableWriterInfos(null,r):[]},getFormatSelectorItems:function(r,a){for(var o=[],l=[],u=this.getChemObjSrcInfo(r),c=u?u.format:null,d=0,h=a.length;d<h;++d){var p=a[d];Kekule.ArrayUtils.pushUnique(l,p.formatId)}for(d=0,h=(l=Kekule.ArrayUtils.intersect(this.getAllowedFormatIds(),l)).length;d<h;++d){var g=Kekule.IO.DataFormatsManager.getFormatInfo(l[d]);if(g){for(var f=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(g.fileExts)),m=0,C=f.length;m<C;++m)f[m]="*."+f[m];var _=f.join(", "),y=g.title;_&&(y+=" ("+_+")");var T=c?l[d]===c:this.getDisplayer().getDefaultOutputFormatId()?l[d]===this.getDisplayer().getDefaultOutputFormatId():this.getLastFormat()?this.getLastFormat()===l[d]:d===0;o.push({value:g.id,text:y,title:g.mimeType,data:g,selected:T})}}return o.sort(function(E,b){return E.text<b.text?-1:E.text>b.text?1:0}),o},getAllowedFormatIds:function(){return this.getDisplayer().getAllowedOutputFormatIds()||Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds()},getFileFilters:function(r){for(var a=[],o=0,l=r.length;o<l;++o){var u=r[o],c=u.data,d=u.text||u.title||u.value,h=Kekule.ArrayUtils.toArray(c.fileExts);a.push({title:d,filter:"."+h.join(",.")})}return a.push(Kekule.NativeServices.FILTER_ALL_SUPPORT),a.push(Kekule.NativeServices.FILTER_ANY),a},updateFormatItems:function(r){this._formatItems=this.getFormatSelectorItems(r,this.getAvailableWriterInfos()),this._formatSelector.setItems(this._formatItems);var a=this.getFileFilters(this._formatItems);this._saveAction.setFilters(a)},reactFormatSelectorChange:function(){var r=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(r,this.getFormatDialog())},updatePreview:function(r,a){var o=a._previewTextArea;if(o.setValue(""),r){var l=Kekule.IO.DataFormatsManager.getFormatInfo(r),u=this.getTargetObj(),c=this.getChemObjSrcInfo(u);if(c&&c.format===r&&c.data)o.setValue(c.data),this.setCurrSaveData(c.data);else{var d=this.getDisplayer().saveData(r,l.dataType,u);o.setValue(d),this.setCurrSaveData(d)}}},getTargetObj:function(r){return this.getDisplayer().getSavingTargetObj()},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer();this._saveAction&&this._saveAction.update(),this.setEnabled(r&&r.getEnabled()&&r.getChemObj())},doExecute:function(r){var a=this,o=this.getFormatDialog(),l=this.getTargetObj(),u=o._formatSelector,c=this.getAvailableWriterInfos(l),d=this.getFormatSelectorItems(l,c);u.setItems(d),this.reactFormatSelectorChange();var h=!1;this._saveAction&&(h=this._saveAction.getEnabled());var p=o.getDialogButton(Kekule.Widget.DialogButtons.OK);p&&p.setEnabled(h);var g=this.getDialogShowType();(g===Kekule.Widget.ShowHideType.DIALOG?o.openModal:o.open).apply(o,[function(f){if(f===Kekule.Widget.DialogButtons.OK){var m=a.getCurrSaveData();a._saveAction.setData(m);var C=o._formatSelector.getValue();a.setLastFormat(C);var _=Kekule.IO.DataFormatsManager.getFormatInfo(C),y=_.fileExts,T=Kekule.ArrayUtils.toArray(y[0]||y),E=[{title:_.title||_.mimeType,filter:"."+T.join(",.")},Kekule.NativeServices.FILTER_ANY],b=Kekule.$L("ChemWidgetTexts.S_DEF_SAVE_FILENAME")+"."+T;a._saveAction.setFileName(b),a._saveAction.setFilters(E),a._saveAction.execute(r)}},r,g])}}),Kekule.ChemWidget.ActionDisplayerCopy=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerCopy",HTML_CLASSNAME:i.ACTION_COPY,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_COPY_WHOLE"),Kekule.$L("ChemWidgetTexts.HINT_COPY_WHOLE")])},doUpdate:function(){if(this.tryApplySuper("doUpdate"),this.getEnabled()){var r=this.getDisplayer().getChemObj();this.setEnabled(r&&r.clone)}},doExecute:function(){var r=this.getDisplayer();if(r){var a=r.getChemObj();a&&Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[a])}}}),Kekule.ChemWidget.ActionDisplayerReset=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:i.ACTION_RESET,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW")])},doExecute:function(){this.getDisplayer().resetDisplay()}}),Kekule.ChemWidget.ActionDisplayerZoomIn=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:i.ACTION_ZOOMIN,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMIN"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMIN")])},doExecute:function(){this.getDisplayer().zoomIn()}}),Kekule.ChemWidget.ActionDisplayerZoomOut=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:i.ACTION_ZOOMOUT,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_ZOOMOUT"),Kekule.$L("ChemWidgetTexts.HINT_ZOOMOUT")])},doExecute:function(){this.getDisplayer().zoomOut()}}),Kekule.ChemWidget.ActionDisplayerResetZoom=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:i.ACTION_RESET_ZOOM,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_RESETZOOM"),Kekule.$L("ChemWidgetTexts.HINT_RESETZOOM")])},doExecute:function(){this.getDisplayer().resetZoom()}}),Kekule.ChemWidget.ActionDisplayerHideHydrogens=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:i.ACTION_MOL_HIDE_HYDROGENS,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_HIDEHYDROGENS"),Kekule.$L("ChemWidgetTexts.HINT_HIDEHYDROGENS")])},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer(),a=r&&r.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(a).setEnabled(this.getEnabled()&&a),this.setChecked(r&&r.getHideHydrogens())},doExecute:function(){var r=!this.getChecked();this.setChecked(r),this.getDisplayer().setHideHydrogens(r)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function(r,a,o,l){this.tryApplySuper("initialize",[r,a,o]),this._displayType=l,this.setCheckGroup("__molDisplayType__")},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer();this.setChecked(r&&r.getCurrMoleculeDisplayType()===this.getMolDisplayType())},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType),this.setChecked(!0)},getMolDisplayType:function(){return this._displayType}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer(),a=r&&r.getRenderType()===Kekule.Render.RendererType.R2D;this.setDisplayed(a).setEnabled(this.getEnabled()&&a)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer(),a=r&&r.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(a).setEnabled(this.getEnabled()&&a)}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:i.ACTION_MOL_DISPLAY_SKELETAL,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_SKELETAL"),Kekule.$L("ChemWidgetTexts.HINT_SKELETAL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=Kekule.Render.Molecule2DDisplayType.SKELETAL,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:i.ACTION_MOL_DISPLAY_CONDENSED,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_CONDENSED"),Kekule.$L("ChemWidgetTexts.HINT_CONDENSED"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=Kekule.Render.Molecule2DDisplayType.CONDENSED,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:i.ACTION_MOL_DISPLAY_WIRE,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_WIRE"),Kekule.$L("ChemWidgetTexts.HINT_WIRE"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=Kekule.Render.Molecule3DDisplayType.WIRE,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:i.ACTION_MOL_DISPLAY_STICKS,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_STICKS"),Kekule.$L("ChemWidgetTexts.HINT_STICKS"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=Kekule.Render.Molecule3DDisplayType.STICKS,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:i.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_BALLSTICK"),Kekule.$L("ChemWidgetTexts.HINT_BALLSTICK"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=Kekule.Render.Molecule3DDisplayType.BALL_STICK,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:i.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_SPACEFILL"),Kekule.$L("ChemWidgetTexts.HINT_SPACEFILL"),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE])}}),Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=Kekule.Render.Molecule3DDisplayType.SPACE_FILL,Kekule.ChemWidget.ActionDisplayerAutoGenerateCoordsForMolecule=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerAutoGenerateCoordsForMolecule",HTML_CLASSNAME:i.ACTION_MOL_AUTO_COORD_GENERATION,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_AUTO_COORD_GENERATION"),Kekule.$L("ChemWidgetTexts.HINT_AUTO_COORD_GENERATION")])},getCoordMode:function(){return null},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getDisplayer(),a=this.getEnabled()&&!!r.canAutoGenerateCoordForChemObj(r.getChemObj(),Kekule.oneOf(this.getCoordMode(),r.getCoordMode()));this.setDisplayed(a).setEnabled(a)},doExecute:function(){this.getDisplayer().autoGenerateChemObjCoords()}})}(),function(){var s=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"}),Kekule.ChemWidget.StructureTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("objMap",new Kekule.MapEx(!0)),this.setEnableLiveUpdate(!0),this.setEnableMultiSelect(!0),this.setRootObj(t),this._pauseLiveUpdateFlag=0,this._changedObjects=[]},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:function(e){var t=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",e),this.rootObjChanged(e,t)}}),this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL}),this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:!1})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+s.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(e,t){this.clearChildItems(),this.getObjMap().clear(),t&&this._uninstallRootEventHandler(t),e&&(this._fillTree(e),this._installRootEventHandler(e))},pauseLiveUpdate:function(){return this._pauseLiveUpdateFlag>=0&&(this._pauseLiveUpdateFlag=0,this._changedObjects=[]),--this._pauseLiveUpdateFlag,this},resumeLiveUpdate:function(){if(++this._pauseLiveUpdateFlag,this._pauseLiveUpdateFlag>=0){this._pauseLiveUpdateFlag=0;for(var e=0,t=this._changedObjects.length;e<t;++e)this.refreshObject(this._changedObjects[e])}},isLiveUpdatePaused:function(){return this._pauseLiveUpdateFlag<0},_installRootEventHandler:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(e){this.getEnableLiveUpdate()&&(this.isLiveUpdatePaused()?this.getObjMap().get(e.target)&&Kekule.ArrayUtils.pushUnique(this._changedObjects,e.target):this.refreshObject(e.target))},refreshObject:function(e){var t=this.getObjMap().get(e);return t&&this._updateTreeItem(t,e),this},_fillTree:function(e){e&&(this.clearChildItems(),this._updateTreeItem(this.appendChildItem(),e))},_updateTreeItem:function(e,t){var n={text:this._getChemObjDisplayTitle(t),obj:t};this.setItemData(e,n),this.getObjMap().set(t,e);for(var i=this.getChildItemCount(e),r=t.getChildCount(),a=0;a<r;++a){var o,l=t.getChildAt(a);o=a<i?this.getChildItemAt(e,a):this.appendChildItem(e),this._updateTreeItem(o,l)}if(i>r)for(a=i-1;a>=r;--a)this.removeChildItemAt(e,a)},_getChemObjDisplayTitle:function(e){var t="",n=e.getId();n&&(t+='<span class="'+s.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+n+"</span>");var i=e.getClassName(),r=i.split("."),a=r.length?r[r.length-1]:i;return t+('<span class="'+s.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+a+")</span>")},selectChemObjs:function(e){for(var t=[],n=0,i=e.length;n<i;++n){var r=e[n],a=this.getObjMap().get(r);a&&t.push(a)}return this.select(t),this},getSelectedChemObjs:function(){var e=[],t=this.getSelection();if(t&&t.length)for(var n=0,i=t.length;n<i;++n){var r=this.getItemData(t[n]);r&&r.obj&&e.push(r.obj)}return e}})}(),function(){Kekule.oneOf,Kekule.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function(){this.tryApplySuper("initialize"),this.setVisible(!0)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT}),this.defineProp("visible",{dataType:DataType.BOOL}),this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("groups",{dataType:DataType.ARRAY})}}),Kekule.ChemWidget.MetaShapeUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker",initialize:function(s){this.tryApplySuper("initialize"),s&&this.setShapeInfo(s)},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT}),this.defineProp("shapeType",{dataType:DataType.INT,serializable:!1,setter:null,getter:function(){var s=this.getShapeInfo();return s?s.shapeType:null}})}}),Kekule.ChemWidget.MetaShapeUIMarker=Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.TextUiMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker",initialize:function(s,e){this.tryApplySuper("initialize"),s&&this.setText(s),e&&this.setCoord(e)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING}),this.defineProp("coord",{dataType:DataType.HASH})}}),Kekule.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var s=this.getPropStoreFieldValue("markers");return s||(s=[],this.setPropStoreFieldValue("markers",s)),s},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(s){return this.getMarkers()[s]},getMarkerOfName:function(s){for(var e=0,t=this.getMarkerCount();e<t;++e){var n=this.getMarkerAt(e);if(n.getName()===s)return n}return null},getMarkersOfGroup:function(s){for(var e=Kekule.ArrayUtils.toArray(s),t=[],n=0,i=this.getMarkerCount();n<i;++n){for(var r=this.getMarkerAt(n),a=r.getGroups(),o=!0,l=0,u=e.length;l<u;++l)if(a.indexOf(e[l])<0){o=!1;break}o&&t.push(r)}return t},addMarker:function(s){return this.getMarkers().push(s)},indexOfMarker:function(s){return this.getMarkers().indexOf(s)},removeMarker:function(s){var e=this.getMarkers(),t=e.indexOf(s);t>=0&&e.splice(t,1)},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}}),Kekule.ChemWidget.UiMarker2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerRenderer"}),Kekule.ChemWidget.MetaShapeUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUiMarker2DRenderer",doDrawSelf:function(s,e,t){var n=this.getChemObj(),i=n.getShapeInfo();if(!i)return null;var r,a=Object.create(t);if((a=Object.extend(a,n.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),Kekule.Render.MetaShapeUtils.isCompositeShape(i))if(i.length>1){r=this.createDrawGroup(s);for(var o=0,l=i.length;o<l;++o){var u=i[o];this.doDrawShape(s,r,u,a)}}else{if(i.length!==1)return null;r=this.doDrawShape(s,null,i[0],a)}else r=this.doDrawShape(s,null,i,a);return r},doDrawShape:function(s,e,t,n){var i,r=Kekule.Render.MetaShapeType;if(Kekule.Render.MetaShapeUtils.isCompositeShape(t)){i=this.createDrawGroup(s);for(var a=0,o=t.length;a<o;++a)this.doDrawShape(s,i,t[a],n)}else{var l=t.coords;switch(t.shapeType){case r.POINT:i=this.drawCircle(s,l[0],1,n);break;case r.CIRCLE:i=this.drawCircle(s,l[0],t.radius,n);break;case r.LINE:var u=n;t.width&&((u=Object.create(n)).strokeWidth=t.width),i=this.drawLine(s,l[0],l[1],u);break;case r.RECT:i=this.drawRect(s,l[0],l[1],n);break;case r.ARC:(u=Object.extend({},n)).strokeWidth=t.width,u.fillColor=null,i=this.drawArc(s,l[0],t.radius,t.startAngle,t.endAngle,t.anticlockwise,u);break;case r.POLYGON:case r.POLYLINE:var c=[];for(a=0,o=l.length;a<o;++a){var d=a===0?"M":"L";c.push(d);var h=[l[a].x,l[a].y];c.push(h)}t.shapeType===r.POLYGON&&(c.push("L"),h=[l[0].x,l[0].y],c.push(h));var p=Kekule.Render.DrawPathUtils.makePath.apply(this,c);i=this.drawPath(s,p,n)}}return e&&this.addToDrawGroup(i,e),i}}),Kekule.ChemWidget.TextUiMarker2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.TextUiMarker2DRenderer",doDrawSelf:function(s,e,t){var n=this.getChemObj(),i={textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};i=Object.extend(i,t),i=Object.extend(i,n.getDrawStyles()||{});var r=n.getCoord();return n.getText()&&r?this.drawText(s,r,n.getText(),i):null}}),Kekule.ChemWidget.UiMarkerCollection2DRenderer=Class.create(Kekule.ChemWidget.UiMarker2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection2DRenderer",getChildObjs:function(){for(var s=this.getChemObj().getMarkers(),e=[],t=0,n=s.length;t<n;++t)s[t].getVisible()&&e.push(s[t]);return e}}),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.MetaShapeUiMarker,Kekule.ChemWidget.MetaShapeUiMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.TextUiMarker,Kekule.ChemWidget.TextUiMarker2DRenderer),Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.UiMarkerCollection,Kekule.ChemWidget.UiMarkerCollection2DRenderer),Kekule.ChemWidget.UiMarkersRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function(s,e){this.tryApplySuper("initialize",[s,e]),this._drawGroup=null},initProperties:function(){},getObjDrawElem:function(s,e){return this.getExtraProp2(s,e,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(s,e,t){this.setExtraProp2(s,e,this.DRAW_ELEM_FIELD,t)},doEstimateRenderBox:function(s,e,t,n){return null},doDraw:function(s,e,t){this.tryApplySuper("doDraw",[s,e,t]);var n=this.getChemObj(),i=this.createDrawGroup(s);return this.setObjDrawElem(s,n,i),n.getMarkerCount()>0&&this.doDrawMarkers(s,i,n.getMarkers(),t),i},doUpdate1:function(s,e,t){if(this.canModifyGraphic(s)){var n=!1,i=Kekule.Render.ObjectUpdateType;switch(t){case i.ADD:n=this.doAddNew(s,e);break;case i.MODIFY:n=this.doModify(s,e);break;case i.REMOVE:var r=this._extractObjsOfUpdateObjDetails(e);n=this.doRemove(s,r);break;default:return this.tryApplySuper("doUpdate1",[s,e,t])}return n}return this.tryApplySuper("doUpdate1",[s,e,t])},doAddNew:function(s,e){return!!this.canRemoveElem()&&this.doModify(s,e)},doModify:function(s,e){if(!this.canRemoveElem())return!1;var t=this._extractObjsOfUpdateObjDetails(e);this.remove(s,t);var n=this.getChemObj(),i=this.getObjDrawElem(n),r=this.getDrawParams();t.indexOf(n)>=0?this.draw(s,r.baseCoord,r.options):this.doDrawMarkers(s,i,t,r.options)},doRemove:function(s,e){if(!this.canRemoveElem())return!1;var t=this.getObjDrawElem(e);if(t){var n=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(t,n),this.doRemoveElem(s,t),this.setObjDrawElem(e,null)}},doDrawMarkers:function(s,e,t,n){for(var i=0,r=t.length;i<r;++i){var a=t[i];a.getVisible()&&this.doDrawMarker(s,e,a,n)}},doDrawMarker:function(s,e,t,n){var i=t.getShapeInfo();if(!i)return null;var r,a=Object.create(n);if((a=Object.extend(t.getDrawStyles()||{})).color&&(a.strokeColor||(a.strokeColor=a.color),a.fillColor||(a.fillColor=a.color)),Kekule.ArrayUtils.isArray(i))if(i.length>1){r=this.createDrawGroup(s);for(var o=0,l=i.length;o<l;++o){var u=i[o];this.doDrawShape(s,r,u,a)}}else{if(i.length!==1)return null;r=this.doDrawShape(s,null,i[0],a)}else r=this.doDrawShape(s,null,i,a);return r&&(this.setObjDrawElem(s,t,r),e&&this.addToDrawGroup(r,e)),r},doDrawShape:function(s,e,t,n){var i,r=Kekule.Render.MetaShapeType;if(Kekule.Render.MetaShapeUtils.isCompositeShape(t)){i=this.createDrawGroup(s);for(var a=0,o=t.length;a<o;++a)this.doDrawShape(s,i,t[a],n)}else{var l=t.coords;switch(t.shapeType){case r.POINT:i=this.drawCircle(s,l[0],1,n);break;case r.CIRCLE:i=this.drawCircle(s,l[0],t.radius,n);break;case r.LINE:var u=n;t.width&&((u=Object.create(n)).strokeWidth=t.width),i=this.drawLine(s,l[0],l[1],u);break;case r.RECT:i=this.drawRect(s,l[0],l[1],n);break;case r.POLYGON:case r.POLYLINE:var c=[];for(a=0,o=l.length;a<o;++a){var d=a===0?"M":"L";c.push(d);var h=[l[a].x,l[a].y];c.push(h)}t.shapeType===r.POLYGON&&(c.push("L"),h=[l[0].x,l[0].y],c.push(h));var p=Kekule.Render.DrawPathUtils.makePath.apply(this,c);i=this.drawPath(s,p,n)}}return e&&this.addToDrawGroup(i,e),i}}),Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.ChemWidget.UiMarkersRenderer)}(),function(){var s=Class.PropertyScope,e=Kekule.ArrayUtils,t=(Kekule.ZoomUtils,Kekule.ChemWidget.ComponentWidgetNames),n=Kekule.ChemWidget,i=Kekule.Widget.EvokeMode;Kekule.globalOptions.add("chemWidget.viewer",{toolButtons:[t.loadData,t.saveData,t.molDisplayType,t.molHideHydrogens,t.zoomIn,t.zoomOut,t.rotateX,t.rotateY,t.rotateZ,t.rotateLeft,t.rotateRight,t.reset,t.copy,t.openEditor],menuItems:[t.loadData,t.saveData,Kekule.Widget.MenuItem.SEPARATOR_TEXT,t.molDisplayType,t.molHideHydrogens,t.zoomIn,t.zoomOut,{text:Kekule.$L("ChemWidgetTexts.CAPTION_ROTATE"),hint:Kekule.$L("ChemWidgetTexts.HINT_ROTATE"),children:[t.rotateLeft,t.rotateRight,t.rotateX,t.rotateY,t.rotateZ]},t.reset,Kekule.Widget.MenuItem.SEPARATOR_TEXT,t.copy,t.openEditor,t.config],toolbar:{evokeModes:[i.EVOKEE_CLICK,i.EVOKEE_MOUSE_ENTER,i.EVOKEE_TOUCH],revokeModes:[i.EVOKEE_MOUSE_LEAVE,i.EVOKER_TIMEOUT],pos:Kekule.Widget.Position.AUTO,marginHorizontal:10,marginVertical:10},editor:{modal:!0,restrainEditorWithCurrObj:!0,shareEditorInstance:!0},enableToolbar:!1,enableDirectInteraction:!0,enableTouchInteraction:!1,enableGestureInteraction:!1,showCaption:!1,useNormalBackground:!1,enableCustomCssProperties:!0,restraintRotation3DEdgeRatio:.18,enableRestraintRotation3D:!0}),Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_CLIENT:"K-Chem-Viewer-Client",VIEWER_CAPTION:"K-Chem-Viewer-Caption",VIEWER_EMBEDDED_TOOLBAR:"K-Chem-Viewer-Embedded-Toolbar",VIEWER_UICONTEXT_PARENT:"K-Chem-Viewer-UiContext-Parent",VIEWER_MENU_BUTTON:"K-Chem-Viewer-Menu-Button",VIEWER_EDITOR_FULLCLIENT:"K-Chem-Viewer-Editor-FullClient",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var r=Kekule.Widget.HtmlClassNames,a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerUiMarkerGroup={HOTTRACK:"hotTrack",SELECT:"select"},Kekule.ChemWidget.Viewer=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_BGCOLOR_2D:null,DEF_BGCOLOR_3D:"#000000",DEF_TOOLBAR_EVOKE_MODES:[i.EVOKEE_CLICK,i.EVOKEE_MOUSE_ENTER,i.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[i.EVOKEE_MOUSE_LEAVE,i.EVOKER_TIMEOUT],OBSERVING_GESTURES:["pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout"],initialize:function(u,c,d,h){this.setPropStoreFieldValue("renderType",d||Kekule.Render.RendererType.R2D),this.setPropStoreFieldValue("useCornerDecoration",!0);var p=Kekule.oneOf,g=Kekule.globalOptions.get("chemWidget.viewer")||{};this.setPropStoreFieldValue("enableToolbar",p(g.enableToolbar)),this.setPropStoreFieldValue("enableDirectInteraction",p(g.enableDirectInteraction,!0)),this.setPropStoreFieldValue("showCaption",p(g.showCaption,!1)),g=g.toolbar||{},this.setPropStoreFieldValue("toolbarEvokeModes",p(g.evokeModes,this.DEF_TOOLBAR_EVOKE_MODES)),this.setPropStoreFieldValue("toolbarRevokeModes",p(g.revokeModes,this.DEF_TOOLBAR_REVOKE_MODES)),this.setPropStoreFieldValue("toolbarPos",p(g.pos,Kekule.Widget.Position.AUTO)),this.setPropStoreFieldValue("toolbarMarginHorizontal",p(g.marginHorizontal,10)),this.setPropStoreFieldValue("toolbarMarginVertical",p(g.marginVertical,10)),this.tryApplySuper("initialize",[u,c,d]),this.setPropStoreFieldValue("viewerConfigs",h||this.createDefaultConfigs()),this.beginUpdate();try{this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding")),this._isContinuousRepainting=!1;var f=Kekule.Render.RendererType,m=this.getRenderType()===f.R2D&&this.getBackgroundColor()||this.DEF_BGCOLOR_2D,C=this.getRenderType()===f.R3D&&this.getBackgroundColor()||this.DEF_BGCOLOR_3D;this.setBackgroundColorOfType(m,f.R2D),this.setBackgroundColorOfType(C,f.R3D),this.useCornerDecorationChanged(),this.doResize()}finally{this.endUpdate()}var _=Kekule.globalOptions.get("chemWidget.viewer")||{};Kekule.ObjUtils.isUnset(this.getEnableGesture())&&this.setEnableGesture(p(_.enableGestureInteraction,!1)),this.addIaController("default",new Kekule.ChemWidget.ViewerBasicInteractionController(this),!0)},doFinalize:function(){var u=this.getUiMarkers();u&&u.finalize();var c=this.getToolbar();this.tryApplySuper("doFinalize"),c&&c.finalize(),this._composerDialog&&this._composerDialog.finalize(),this._composerPanel&&this._composerPanel.finalize()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(u){return this.setDisplayerConfigs(u)}}),this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){if(!this.getEnableUiContext())return null;var u=this.getPropStoreFieldValue("uiDrawBridge");return u||this.__$uiDrawBridgeInitialized$__||(this.__$uiDrawBridgeInitialized$__=!0,u=this.createUiDrawBridge(),this.setPropStoreFieldValue("uiDrawBridge",u)),u}}),this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:!1,getter:function(){if(!this.getEnableUiContext())return null;var u=this.getPropStoreFieldValue("uiContext");if(!u){var c=this.getUiDrawBridge();if(c){var d=this.getUiContextParentElem();if(!d)return null;var h=Kekule.HtmlElementUtils.getElemScrollDimension(d);u=c.createContext(d,h.width,h.height),this.setPropStoreFieldValue("uiContext",u)}}return u}}),this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,setter:null,getter:function(){var u=this.getPropStoreFieldValue("uiPainter");if(!u){var c=this.getUiMarkers();return(u=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,c,this.getUiDrawBridge())).setCanModifyTargetObj(!0),this.setPropStoreFieldValue("uiPainter",u),u}return u}}),this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null,getter:function(){var u=this.getUiPainter();return u?(u.getRenderer()||u.prepareRenderer(),u.getRenderer()||null):null}}),this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:!1,setter:null,getter:function(){var u=this.getPropStoreFieldValue("uiMarkers");return u||(u=new Kekule.ChemWidget.UiMarkerCollection,this.setPropStoreFieldValue("uiMarkers",u)),u}}),this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:s.PUBLIC,setter:function(u){this.setPropStoreFieldValue("allowedMolDisplayTypes",u),this.updateUiComps()}}),this.defineProp("retainAspect",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getDrawOptions()||{}).retainAspect},setter:function(u){var c=this.getDrawOptions()||{};return c.retainAspect=!!u,this.setDrawOptions(c)}}),this.defineProp("enableRestraintRotation3D",{dataType:DataType.BOOL}),this.defineProp("restraintRotation3DEdgeRatio",{dataType:DataType.FLOAT}),this.defineProp("enableHotKey",{dataType:DataType.FLOAT}),this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&this.getCoordMode()!==Kekule.CoordMode.COORD3D}}),this.defineProp("shareEditorInstance",{dataType:DataType.BOOL}),this.defineProp("enableEditFromVoid",{dataType:DataType.BOOL}),this.defineProp("restrainEditorWithCurrObj",{dataType:DataType.BOOL}),this.defineProp("modalEdit",{dataType:DataType.BOOL}),this.defineProp("editorProperties",{dataType:DataType.HASH}),this.defineProp("toolButtons",{dataType:DataType.ARRAY,scope:s.PUBLIC,getter:function(){return this.getPropStoreFieldValue("toolButtons")},setter:function(u){this.setPropStoreFieldValue("toolButtons",u),this.updateToolbar()}}),this.defineProp("menuItems",{dataType:DataType.ARRAY,scope:s.PUBLIC,setter:function(u){this.setPropStoreFieldValue("menuItems",u),this.updateMenu()}}),this.defineProp("menu",{dataType:"Kekule.Widget.Menu",serializable:!1,scope:s.PRIVATE,setter:function(u){var c=this.getMenu();u!==c&&(c&&(c.finalize(),c=null),this.setPropStoreFieldValue("menu",u))}}),this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1,scope:s.PRIVATE,setter:function(u){var c=this.getToolbar(),d=this.getToolbarEvokeHelper();if(u!==c){if(c){c.finalize();var h=this.getToolbarEvokeHelper();h&&h.finalize(),c=null}d&&d.finalize(),this.setPropStoreFieldValue("toolbar",u),u&&this.setPropStoreFieldValue("toolbarEvokeHelper",new Kekule.Widget.DynamicEvokeHelper(this,u,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}),this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(u){this.setPropStoreFieldValue("enableToolbar",u),this.updateToolbar()}}),this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(u){this.setPropStoreFieldValue("toolbarPos",u),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(u){this.setPropStoreFieldValue("toolbarMarginVertical",u),this.adjustToolbarPos()}}),this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(u){this.setPropStoreFieldValue("toolbarMarginHorizontal",u),this.adjustToolbarPos()}}),this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:!1,setter:null,scope:s.PRIVATE}),this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:s.PUBLIC,setter:function(u){this.setPropStoreFieldValue("toolbarEvokeModes",u||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setEvokeModes(u||[])}}),this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:s.PUBLIC,setter:function(u){this.setPropStoreFieldValue("toolbarRevokeModes",u||[]),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setRevokeModes(u||[])}}),this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(u){this.setPropStoreFieldValue("toolbarRevokeTimeout",u),this.getToolbarEvokeHelper()&&this.getToolbarEvokeHelper().setTimeout(u)}}),this.defineProp("toolbarParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:function(u){this.getToolbarParentElem()!==u&&(this.setPropStoreFieldValue("toolbarParentElem",u),this.updateToolbar())}}),this.defineProp("caption",{dataType:DataType.STRING,setter:function(u){this.setPropStoreFieldValue("caption",u),Kekule.DomUtils.setElementText(this.getCaptionElem(),u||""),this.captionChanged()}}),this.defineProp("showCaption",{dataType:DataType.BOOL,setter:function(u){this.setPropStoreFieldValue("showCaption",u),this.captionChanged()}}),this.defineProp("captionPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(u){this.setPropStoreFieldValue("captionPos",u),this.captionChanged()}}),this.defineProp("autoCaption",{dataType:DataType.BOOL,setter:function(u){this.setPropStoreFieldValue("autoCaption",u),u&&this.autoDetectCaption()}}),this.defineProp("captionElem",{dataType:DataType.OBJECT,scope:s.PRIVATE,setter:null,getter:function(u){var c=this.getPropStoreFieldValue("captionElem");return c||u||(c=this.doCreateCaptionElem(),this.setPropStoreFieldValue("captionElem",c)),c}}),this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:!1,scope:s.PUBLIC,setter:null,getter:function(){var u=this.getPropStoreFieldValue("actions");return u||(u=new Kekule.ActionList,this.setPropStoreFieldValue("actions",u)),u}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,scope:s.PRIVATE,setter:null,getter:function(){var u=this.getPropStoreFieldValue("actionMap");return u||(u=new Kekule.MapEx(!0),this.setPropStoreFieldValue("actionMap",u)),u}}),this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL}),this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(u){this.setPropStoreFieldValue("enableTouchInteraction",!!u),this.setTouchAction(u?"none":null)}}),this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(u){var c=!!u;this.getEnableGesture()!==c&&(this.setPropStoreFieldValue("enableGesture",c),c?this.startObservingGestureEvents(this.OBSERVING_GESTURES):this.stopObservingGestureEvents(this.OBSERVING_GESTURES))}}),this.defineProp("hotTrackedObjects",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("hotTrackedObjects")||[]},setter:function(u){this.changeHotTrackedObjects(u&&e.toArray(u),!0)}}),this.defineProp("selectedObjects",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("selectedObjects")||[]},setter:function(u){this.changeSelectedObjects(u&&e.toArray(u),!0)}})},initPropValues:function(){this.setStyleMode(Kekule.Widget.StyleMode.INHERITED);var u=Kekule.oneOf,c=Kekule.globalOptions.get("chemWidget.viewer")||{};this.setUseNormalBackground(u(c.useNormalBackground,!1)),this.setEnableCustomCssProperties(u(c.enableCustomCssProperties,!0)),this.setRestraintRotation3DEdgeRatio(u(c.restraintRotation3DEdgeRatio,.18)),this.setEnableRestraintRotation3D(u(c.enableRestraintRotation3D,!0)),this.setEnableTouchInteraction(u(c.enableTouchInteraction,!1)),c=c.editor||{},this.setModalEdit(u(c.modal,!0)),this.setRestrainEditorWithCurrObj(u(c.restrainEditorWithCurrObj,!0)),this.setShareEditorInstance(u(c.shareEditorInstance,!0))},createDefaultConfigs:function(){return new Kekule.ChemWidget.ViewerConfigs},canUsePlaceHolderOnElem:function(u){var c=u.getAttribute("src");return u.tagName.toLowerCase()==="img"&&!!c},doObjectChange:function(u){this.tryApplySuper("doObjectChange",[u]),this.updateActions()},doSetElement:function(u){var c=u;return c&&c.tagName.toLowerCase()==="img"&&(c=Kekule.DomUtils.replaceTagName(c,"span")),this.tryApplySuper("doSetElement",[c])},doUnbindElement:function(u){return this._drawContextParentElem&&this._drawContextParentElem.parentNode&&(this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem),this._drawContextParentElem=null),this.tryApplySuper("doUnbindElement",[u])},elementBound:function(u){this.setObserveElemResize(!0)},doCreateRootElement:function(u){return u.createElement("div")},doCreateSubElements:function(u,c){var d=u.createElement("div");return d.className=a.VIEWER_CLIENT,this._clientElement=d,c.appendChild(d),[d]},doGetWidgetClassName:function(){var u=this.tryApplySuper("doGetWidgetClassName")+" "+a.VIEWER;try{var c=this.getRenderType();u+=" "+this._getRenderTypeSpecifiedHtmlClassName(c)}catch{}return u},_getRenderTypeSpecifiedHtmlClassName:function(u){return u===Kekule.Render.RendererType.R3D?a.VIEWER3D:a.VIEWER2D},getClientElement:function(){return this._clientElement},getResizerElement:function(){return this.getElement()},doResize:function(){this.adjustDrawParentDim(),this.adjustToolbarPos(),this.tryApplySuper("doResize")},doWidgetShowStateChanged:function(u){u&&this.updateActions()},refitDrawContext:function(u){this.tryApplySuper("refitDrawContext",[u]),this.adjustToolbarPos()},changeContextDimension:function(u){return this.getEnableUiContext()&&this.getUiDrawBridge()&&this.getUiContext()&&this.doChangeContextDimension(this.getUiContext(),this.getUiDrawBridge(),u,!0),this.tryApplySuper("changeContextDimension",[u])},getAllowRenderTypeChange:function(){return!0},resetRenderType:function(u,c){this.tryApplySuper("resetRenderType",[u,c]);var d=this._getRenderTypeSpecifiedHtmlClassName(u),h=this._getRenderTypeSpecifiedHtmlClassName(c);this.removeClassName(d),this.addClassName(h),this.updateUiComps()},doLoad:function(u){this.beginUpdateUiMarkers();try{this.clearHotTrackedItems(),this.clearSelectedItems(),this.clearUiMarkers()}finally{this.endUpdateUiMarkers()}this.tryApplySuper("doLoad",[u])},doLoadEnd:function(u){this.updateActions(),this.autoDetectCaption()},_repaintCore:function(u){this.tryApplySuper("_repaintCore",[u])},chemObjRendered:function(u,c){var d=this.tryApplySuper("chemObjRendered",[u,c]);return this.updateUiMarkers(!0),d},doSetUseCornerDecoration:function(u){this.tryApplySuper("doSetUseCornerDecoration",[u]),this.useCornerDecorationChanged()},useCornerDecorationChanged:function(){var u=this.getDrawContextParentElem();u&&(this.getUseCornerDecoration()?Kekule.HtmlElementUtils.addClass(u,r.CORNER_ALL):Kekule.HtmlElementUtils.removeClass(u,r.CORNER_ALL))},getBoundInfosAtCoord:function(u,c,d){var h=this.tryApplySuper("getBoundInfosAtCoord",[u,c,d]),p=this.getViewerConfigs().getInteractionConfigs().getEnableTrackOnNearest();if(h&&h.length&&p){var g=new Kekule.MapEx;try{for(var f=Kekule.Render.MetaShapeUtils,m=h.length-1;m>=0;--m){var C=h[m],_=C.boundInfo,y=f.getDistance(u,_);g.set(C,y)}h.sort(function(T,E){var b=-(T.boundInfo.shapeType-E.boundInfo.shapeType);return b===0&&(b=-(g.get(T)-g.get(E))),b})}finally{g.finalize()}}return h},getEnableUiContext:function(){return!0},getUiContextParentElem:function(u){if(!this.getEnableUiContext())return null;var c=this._uiContextParentElem;if(!c&&!u){c=this.getDocument().createElement("div"),this._uiContextParentElem=c,Kekule.HtmlElementUtils.addClass(c,r.DYN_CREATED),Kekule.HtmlElementUtils.addClass(c,a.VIEWER_UICONTEXT_PARENT),c.style.width="100%",c.style.height="100%";var d=this.getDrawContextParentElem(),h=d?d.parentNode:this.getElement(),p=d&&d.nextSibling;p?h.insertBefore(c,p):h.appendChild(c)}return c},createUiDrawBridge:function(){var u=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!u){var c=Kekule.Render.DrawBridge2DMananger.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));c&&this.reportException(c,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return u},adjustDrawParentDim:function(){var u=this.getDrawContextParentElem(),c=u.parentNode,d=this.getCaptionElem(!0);if(Kekule.HtmlElementUtils.getElemClientDimension(c),d&&this.captionIsShown()&&d.parentNode===c){var h=Kekule.HtmlElementUtils.getElemClientDimension(d).height||0;this.getCaptionPos()&Kekule.Widget.Position.TOP?(u.style.top=h+"px",u.style.bottom="0px"):(u.style.top="0px",u.style.bottom=h+"px"),Kekule.StyleUtils.removeStyleProperty(u.style,"height")}else Kekule.StyleUtils.removeStyleProperty(u.style,"top"),Kekule.StyleUtils.removeStyleProperty(u.style,"bottom"),u.style.height="100%"},getInteractionReceiverElem:function(){return this.getClientElement()},setDrawDimension:function(u,c){var d=c;this.captionIsShown()&&(d+=Kekule.HtmlElementUtils.getElemClientDimension(this.getCaptionElem()).height||0),this.tryApplySuper("setDrawDimension",[u,d])},doCreateCaptionElem:function(){var u=this.getDocument().createElement("span");return u.className=r.DYN_CREATED+"  "+r.SELECTABLE+" "+a.VIEWER_CAPTION,this.getElement().appendChild(u),u},captionChanged:function(){if(this.captionIsShown()){var u=(c=this.getCaptionElem()).style;this.getCaptionPos()&Kekule.Widget.Position.TOP?(u.top=0,u.bottom="auto"):(u.bottom=0,u.top="auto"),u.display="block"}else{var c;(c=this.getCaptionElem(!0))&&(c.style.display="none")}this.doResize()},captionIsShown:function(){return this.getCaption()&&this.getShowCaption()},beginUpdateUiMarkers:function(){Kekule.ObjUtils.isUnset(this._uiMarkerUpdateFlag)&&(this._uiMarkerUpdateFlag=0),--this._uiMarkerUpdateFlag,this.beginUpdate()},endUpdateUiMarkers:function(){this.endUpdate(),++this._uiMarkerUpdateFlag,this._uiMarkerUpdateFlag>0&&(this._uiMarkerUpdateFlag=0),this.isUpdatingUiMarkers()||this.repaintUiMarker()},isUpdatingUiMarkers:function(){return this._uiMarkerUpdateFlag<0},_getUiMarkerOfName:function(u,c,d){var h=this.getUiMarkers().getMarkerOfName(u);return!h&&d&&(h=d.apply(this))&&(h.setName(u),h.setGroups(c)),h},_getDefaultHotTrackUiMarker:function(u){var c;return u&&(c=this.createShapeBasedMarker),this._getUiMarkerOfName("hotTrackMarker",[Kekule.ChemWidget.ViewerUiMarkerGroup.HOTTRACK],c)},_getDefaultSelectionUiMarker:function(u){var c;return u&&(c=this.createShapeBasedMarker),this._getUiMarkerOfName("selectionMarker",[Kekule.ChemWidget.ViewerUiMarkerGroup.SELECT],c)},recalcUiMarkers:function(){if(this.getUiDrawBridge()){this.beginUpdateUiMarkers();try{var u,c=this.getHotTrackedObjects();if(c&&c.length){var d=this._calcBoundsOfObjects(c),h=this.getViewerConfigs().getUiMarkerConfigs().getHotTrackMarkerStyles()||{};u=this._getDefaultHotTrackUiMarker(!0),this.modifyShapeBasedMarker(u,d,h,!1),this.showUiMarker(u)}else(u=this._getDefaultHotTrackUiMarker(!1))&&this.hideUiMarker(u,!1);var p=this.getSelectedObjects();p&&p.length?(d=this._calcBoundsOfObjects(p),h=this.getViewerConfigs().getUiMarkerConfigs().getSelectionMarkerStyles()||{},u=this._getDefaultSelectionUiMarker(!0),this.modifyShapeBasedMarker(u,d,h,!1),this.showUiMarker(u)):(u=this._getDefaultSelectionUiMarker(!1))&&this.hideUiMarker(u,!1)}finally{this.endUpdateUiMarkers()}}},repaintUiMarker:function(){if(!this.isUpdatingUiMarkers()&&this.getUiDrawBridge()&&this.getUiContext()){this.clearUiContext();var u=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),u.baseCoord,u.drawOptions)}},updateUiMarkers:function(u){this.doUpdateUiMarkers(),u&&this.repaintUiMarker()},doUpdateUiMarkers:function(){this.recalcUiMarkers()},createShapeBasedMarker:function(u,c,d,h){var p=new Kekule.ChemWidget.MetaShapeUiMarker;return u&&p.setShapeInfo(u),c&&p.setDrawStyles(c),d&&p.setPropValues(d),this.getUiMarkers().addMarker(p),h&&this.repaintUiMarker(),p},modifyShapeBasedMarker:function(u,c,d,h){Kekule.Render.ObjectUpdateType.MODIFY,c&&u.setShapeInfo(c),d&&u.setDrawStyles(d),h&&this.repaintUiMarker()},createTextBasedMarker:function(u,c,d,h,p){var g=new Kekule.ChemWidget.TextUiMarker;return u&&g.setCoord(u),c&&g.setText(c),d&&g.setDrawStyles(d),h&&g.setPropValues(h),this.getUiMarkers().addMarker(g),p&&this.repaintUiMarker(),g},modifyTextBasedMarker:function(u,c,d,h,p){Kekule.Render.ObjectUpdateType.MODIFY,c&&u.setCoord(c),d&&u.setText(d),h&&u.setDrawStyles(h),p&&this.repaintUiMarker()},getUiMarkersOfGroup:function(u){return this.getUiMarkers().getMarkersOfGroup(u)},modifyUiMarkers:function(u,c){for(var d=u instanceof Kekule.ChemWidget.UiMarkerCollection?u.getMarkers():e.toArray(u),h=0,p=d.length;h<p;++h)d[h].setPropValues(c)},setVisibleOfUiMarkers:function(u,c,d){return this.modifyUiMarkers(u,{visible:c}),d&&this.repaintUiMarker(),this},setVisibleOfUiMarkerGroup:function(u,c,d){var h=this.getUiMarkersOfGroup(u);return this.setVisibleOfUiMarkers(h,c,d)},hideUiMarker:function(u,c){u.setVisible(!1),c&&this.repaintUiMarker()},showUiMarker:function(u,c){u.setVisible(!0),c&&this.repaintUiMarker()},removeUiMarker:function(u){u&&(this.getUiMarkers().removeMarker(u),this.repaintUiMarker())},clearUiMarkers:function(){this.getUiMarkers().clearMarkers(),this.repaintUiMarker()},clearUiContext:function(){this.getUiContext()&&this.getUiDrawBridge()&&this.getUiDrawBridge().clearContext(this.getUiContext())},getEnableObjectSelect:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getViewerConfigs().getInteractionConfigs().getEnableBasicObjectSelect()},getEnableObjectHotTrack:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getViewerConfigs().getInteractionConfigs().getEnableBasicObjectHotTrack()},addToSelection:function(u){for(var c=e.clone(this.getSelectedObjects()),d=u?e.toArray(u):[],h=!1,p=0,g=d.length;p<g;++p){var f=d[p];c.indexOf(f)>=0||(c.push(f),h=!0)}h&&this.changeSelectedObjects(c,!0)},removeFromSelection:function(u){for(var c=e.clone(this.getSelectedObjects()),d=u?e.toArray(u):[],h=!1,p=0,g=d.length;p<g;++p){var f=d[p],m=c.indexOf(f);m>=0&&(c.splice(m,1),h=!0)}h&&this.changeSelectedObjects(c,!0)},toggleSelectingState:function(u){for(var c=e.clone(this.getSelectedObjects()),d=e.toArray(u),h=0,p=d.length;h<p;++h){var g=d[h],f=c.indexOf(g);f>=0?c.splice(f,1):c.push(g)}this.changeSelectedObjects(c,!0)},select:function(u){var c=u?e.toArray(u):[];this.changeSelectedObjects(c,!0)},clearHotTrackedItems:function(u,c){this.iterateSubViews(function(d){(!u||u.indexOf(d)<0)&&d.doClearHotTrackedItems()}),(!u||u.indexOf(this)<0)&&this.doClearHotTrackedItems(),c&&this.repaintUiMarker()},doClearHotTrackedItems:function(u){this.changeHotTrackedObjects([],u)},clearSelectedItems:function(u,c){this.iterateSubViews(function(d){u&&u.indexOf(d)<0&&d.doClearSelectedItems()}),u&&u.indexOf(this)<0&&this.doClearSelectedItems(),c&&this.repaintUiMarker()},doClearSelectedItems:function(u){this.changeSelectedObjects([],u)},_isSameHotTrackedOrSelectedObjs:function(u,c){var d=u,h=c;return d&&!d.length&&(d=null),h&&!h.length&&(h=null),d==h||!(!d||!h)&&e.compare(d,h,function(p,g){return p===g?0:-1})===0},_changeHotTrackOrSelectObjectRenderStyles:function(u,c,d,h){var p=!1,g=d?"_selectedObjectRenderStyles":"_hotTrackedObjectRenderStyles";if(u&&u.length){var f=this[g];if(f)for(var m=0,C=u.length;m<C;++m)(y=u[m]).removeOverrideRenderOptionItem&&(y.removeOverrideRenderOptionItem(f),p=!0)}if(c&&c.length){var _=d?this.getViewerConfigs().getUiMarkerConfigs().getSelectedObjectStyles():this.getViewerConfigs().getUiMarkerConfigs().getHotTrackedObjectStyles();if(_)for(this[g]=_,m=0,C=c.length;m<C;++m){var y;(y=c[m]).addOverrideRenderOptionItem&&(y.addOverrideRenderOptionItem(_),p=!0)}}else this[g]=null;h&&p&&this.requestRepaint()},changeHotTrackedObjects:function(u,c){var d=this.getHotTrackedObjects()||[],h=u?e.toArray(u):[];if(!this._isSameHotTrackedOrSelectedObjs(d,h)){c&&this.beginUpdateUiMarkers();try{this._changeHotTrackOrSelectObjectRenderStyles(d,h,!1,c),this.setPropStoreFieldValue("hotTrackedObjects",h),h&&h.length&&this.clearHotTrackedItems([this],!1),c&&this.updateUiMarkers(!0),this.invokeEvent("hotTrackOnObjects",{objects:h,prevObjects:d})}finally{c&&this.endUpdateUiMarkers()}}},changeSelectedObjects:function(u,c){var d=this.getSelectedObjects(),h=u?e.toArray(u):[];if(!this._isSameHotTrackedOrSelectedObjs(d,h)){c&&this.beginUpdateUiMarkers();try{this._changeHotTrackOrSelectObjectRenderStyles(d,h,!0,c),this.setPropStoreFieldValue("selectedObjects",h),h&&h.length&&this.clearSelectedItems([this],!1),c&&this.updateUiMarkers(!0),this.invokeEvent("selectionChange",{objects:h,prevObjects:d})}finally{c&&this.endUpdateUiMarkers()}}},_calcBoundsOfObjects:function(u,c){var d=[];Kekule.ObjUtils.isUnset(c)&&(c=this.getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation());for(var h=0;h<u.length;++h){var p=u[h],g=this.getBoundInfoRecorder().getBelongedInfos(this.getDrawContext(),p);if(g&&g.length)for(var f=0,m=g.length;f<m;++f){var C=g[f].boundInfo;C&&(C=Kekule.Render.MetaShapeUtils.inflateShape(C,c),Kekule.ArrayUtils.pushUnique(d,C))}}return d},getAllowEditing:function(){return this.getCoordMode()!==Kekule.CoordMode.COORD3D&&this.getEnableEdit()&&(this.getChemObj()||this.getEnableEditFromVoid())},getComposerDialog:function(){var u;return(u=this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerDialog:this._composerDialog)||Kekule.Editor.ComposerDialog&&(u=new Kekule.Editor.ComposerDialog(this.getDocument(),Kekule.$L("ChemWidgetTexts.CAPTION_EDIT_OBJ"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL])),this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerDialog=u:this._composerDialog=u,u},getComposerPanel:function(){var u;if(!(u=this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerPanel:this._composerPanel)&&Kekule.Editor.Composer){(u=new Kekule.Editor.Composer(this.getDocument())).addClassName(a.VIEWER_EDITOR_FULLCLIENT),u.setUseNormalBackground(!0);var c=Kekule.Editor.Composer.getMinPreferredDimension();u.setMinDimension(c),u.setEnableDimensionTransform(!0),u.setAutoResizeConstraints({width:1,height:1});var d=Kekule.globalOptions.chemWidget.composer.commonToolButtons;d=e.exclude(d,[t.cut,t.config,t.objInspector]),u.setCommonToolButtons(d);var h=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_DONE"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_DONE"),htmlClass:"K-Res-Button-YesOk",showText:!0,"#execute":function(){u._doneEditCallback(),u.hide()}},{text:Kekule.$L("ChemWidgetTexts.CAPTION_EDITOR_CANCEL"),hint:Kekule.$L("ChemWidgetTexts.HINT_EDITOR_CANCEL"),htmlClass:"K-Res-Button-NoCancel",showText:!0,"#execute":function(){u.hide()}}];u._customEndEditButtons=h}return this.getShareEditorInstance()?Kekule.ChemWidget.Viewer._composerPanel=u:this._composerPanel=u,u._invokerViewer=this,u._doneEditCallback=null,u},openEditor:function(u){if(this.getAllowEditing()){var c=this.getChemObj(),d=!c,h=c&&c.isEmpty&&c.isEmpty(),p=this.getRestrainEditorWithCurrObj(),g=Kekule.DocumentUtils.getClientDimension(this.getDocument()),f=Kekule.Editor.Composer.getMinPreferredDimension();g.width<=f.width+50||g.height<f.height+100?this._openEditComposer(u,c,p,d,h):this._openEditComposerDialog(u,c,p,d,h)}},_prepareEditComposer:function(u,c,d,h){u.setEnableCreateNewDoc(d||!c),u.setEnableLoadNewFile(d||!c),u.setAllowCreateNewChild(d||!c);var p=this.getEditorProperties();p&&u.setPropValues(p)},_feedbackEditResult:function(u,c,d){if(u.isDirty()){var h=u.getSavingTargetObj();d?this.setChemObj(h.clone()):this.getRestrainEditorWithCurrObj()?(c.getClass()===h.getClass()?c.assign(h.clone()):c.assign(h),c.setSrcInfo(null),this.setChemObj(c)):this.setChemObj(h),this.invokeEvent("editingDone",{obj:this.getChemObj()})}},_openEditComposerDialog:function(u,c,d,h,p){var g=this.getComposerDialog();if(g){var f,m=g.getComposer();this._prepareEditComposer(m,d,h,p),h||p?g.getComposer().newDoc():(f=c.clone(),g.setChemObj(f));var C=this,_=function(y){y===Kekule.Widget.DialogButtons.OK&&g.getComposer().isDirty()&&C._feedbackEditResult(g.getComposer(),c,h)};this.getModalEdit()?g.openModal(_,u||this):g.openPopup(_,u||this)}else Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},_openEditComposer:function(u,c,d,h,p){var g=this.getComposerPanel();if(g){this._prepareEditComposer(g,d,h,p);for(var f=g._customEndEditButtons,m=g.getCommonToolButtons()||[],C=!1,_=0,y=f.length;_<y;++_){var T=f[_];m.indexOf(T)<0&&(m.push(T),C=!0)}if(C&&g.setCommonToolButtons(m),h||p)g.newDoc();else{var E=c.clone();g.setChemObj(E)}var b=this;g._doneEditCallback=function(){b._feedbackEditResult(g,c,h)},g.show(u,function(){h||p||g.setChemObj(E)},Kekule.Widget.ShowHideType.POPUP)}else Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_CREATE_EDITOR"))},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(u,c){return this.rotate2DTo(this.getCurr2DRotationAngle()+u,c)},rotate2DTo:function(u,c){return this.getDrawOptions().rotateAngle=u,c||this.geometryOptionChanged(),this},getCurr3DRotationInfo:function(){for(var u={},c=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"],d=this.getDrawOptions(),h=0,p=c.length;h<p;++h){var g=c[h];u[g]=d[g]||0}return u.rotateAxisVector=d.rotateAxisVector||null,u},setRotate3DMatrix:function(u,c){return this.getDrawOptions().rotateMatrix=u,c||this.geometryOptionChanged(),this},rotate3DBy:function(u,c,d,h){var p=this.getCurr3DRotationInfo().rotateMatrix||Kekule.MatrixUtils.createIdentity(4),g=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:u,rotateY:c,rotateZ:d}),f=Kekule.MatrixUtils.multiply(g,p);return this.setRotate3DMatrix(f,h),this},rotate3DByAxis:function(u,c,d){var h=this.getCurr3DRotationInfo().rotateMatrix||Kekule.MatrixUtils.createIdentity(4),p=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:u,rotateAxisVector:c}),g=Kekule.MatrixUtils.multiply(p,h);return this.setRotate3DMatrix(g,d),this},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.viewer.toolButtons},isToolbarEmbedded:function(){return!this.getToolbarParentElem()},adjustToolbarPos:function(){var u=this.getToolbar();if(u)if(this.isToolbarEmbedded()){var c=Kekule.Widget.Position,d=Kekule.HtmlElementUtils.getElemPageRect(this.getDrawContextParentElem()),h=Kekule.HtmlElementUtils.getElemPageRect(u),p=this.getToolbarPos(),g=this.getToolbarMarginHorizontal(),f=this.getToolbarMarginVertical(),m="left",C="top",_="right",y="bottom",T=(d.width-h.width)/2,E=(d.height-h.height)/2;if(p===c.AUTO||!p){var b=2*(g>0?g:0)+h.width,v=2*(f>0?f:0)+h.height;b>d.width?(p|=c.LEFT,g=0):p|=c.RIGHT,v>d.height/2?(p|=c.BOTTOM,f=-1):p|=c.BOTTOM}p&c.LEFT?(m="left",_="right",T=g>=0?g:g-h.width):p&c.RIGHT&&(m="right",_="left",T=g>=0?g:g-h.width),p&c.TOP?(C="top",y="bottom",E=f>=0?f:f-h.height):p&c.BOTTOM&&(C="bottom",y="top",E=f>=0?f:f-h.height),u.removeStyleProperty(_),u.removeStyleProperty(y),u.setStyleProperty(m,T+"px"),u.setStyleProperty(C,E+"px")}else u.removeStyleProperty("left"),u.removeStyleProperty("top"),u.removeStyleProperty("width"),u.removeStyleProperty("height")},updateToolbar:function(){this.getEnableToolbar()?(this.createToolbar(),this.adjustToolbarPos()):this.setToolbar(null)},updateMenu:function(){this.createMenu()},updateUiComps:function(){this.updateToolbar(),this.updateMenu()},updateActions:function(){this.getActions()&&this.getActions().updateAll()},clearActions:function(){this.getActions().clear(),this.getActionMap().clear()},getCompActionClass:function(u){return this.getChildActionClass(u,!0)},_getActionOfComp:function(u,c,d){var h=this.getActionMap(),p=h.get(u);if(!p&&c){var g=this.getCompActionClass(u)||d;g&&(p=new g(this),h.set(u,p),this.getActions().add(p))}return p},getChildAction:function(u,c){var d=this._getActionOfComp(u,!0);return d||(d=this.tryApplySuper("getChildAction",[u,c])),d},createToolbar:function(){this.clearActions();var u=new Kekule.Widget.ButtonGroup(this);u.addClassName(r.DYN_CREATED),u.setDisplayed(!1),u.setShowText(!1),u.doSetShowGlyph(!0);for(var c=this.getToolButtons()||this.getDefaultToolBarButtons(),d=0,h=c.length;d<h;++d){var p=c[d];this.createToolButton(p,u)}return u.addClassName(a.INNER_TOOLBAR),this.isToolbarEmbedded()&&u.addClassName(a.VIEWER_EMBEDDED_TOOLBAR),u.appendToElem(this.getToolbarParentElem()||this.getElement()),this.setToolbar(u),u},createToolButton:function(u,c){var d=null,h=this.beginContinuousRepainting.bind(this),p=this.endContinuousRepainting.bind(this),g=[t.rotateX,t.rotateY,t.rotateZ,t.rotateLeft,t.rotateRight];if(DataType.isObjectValue(u)){var f=Object.extend({widget:Kekule.Widget.Button},u);d=Kekule.Widget.Utils.createFromHash(c,f),(C=f.actionClass)&&typeof C=="string"&&(C=ClassEx.findClass(f.actionClass)),C&&(m=this._getActionOfComp(d,!0,C))&&d.setAction(m)}else{if(u===t.molDisplayType)return this.createMolDisplayTypeButton(c);if(u===t.menu)return this.createMenuButton(c);var m,C=this.getCompActionClass(u),_=Kekule.Widget.Button;u===t.molHideHydrogens&&(_=Kekule.Widget.CheckButton),d=new _(c),(m=this._getActionOfComp(u,!0))&&d.setAction(m),g.indexOf(u)>=0&&(d.setPeriodicalExecInterval(20),d.setEnablePeriodicalExec(!0),d.addEventListener("activate",h),d.addEventListener("deactivate",p))}return d},createMenuButton:function(u){var c=new Kekule.Widget.DropDownButton(u);return c.setText(Kekule.$L("WidgetTexts.CAPTION_MENU")).setHint(Kekule.$L("WidgetTexts.HINT_MENU")),c.addClassName(a.VIEWER_MENU_BUTTON),this.getMenu()||this.createMenu(),c.setDropDownWidget(this.getMenu()),c},createMolDisplayTypeButton:function(u){var c=new Kekule.Widget.CompactButtonSet(u);c.getButtonSet().addClassName(a.INNER_TOOLBAR),c.setShowText(!1);var d=this._getActionOfComp(t.molDisplayType,!0);c.setAction(d),this.getActions().add(d);for(var h=this.getDocument(),p=this.getAllowedMolDisplayTypes(),g=this._getUsableMolDisplayActionClasses(p),f=0,m=g.length;f<m;++f){var C=g[f].TYPE,_=new Kekule.Widget.RadioButton(h);d=this._getActionOfComp(t.molDisplayType+C,!0,g[f]),_.setAction(d),c.append(_,C===this.getCurrMoleculeDisplayType())}return c},_getUsableMolDisplayActionClasses:function(u){for(var c=[],d=this.getRenderType()===Kekule.Render.RendererType.R3D?n.Viewer.molDisplayType3DActionClasses:n.Viewer.molDisplayType2DActionClasses,h=0,p=d.length;h<p;++h){var g=d[h].TYPE;u&&u.indexOf(g)<0&&g!==this.getCurrMoleculeDisplayType()||c.push(d[h])}return c},getDefaultMenuItems:function(){return Kekule.globalOptions.chemWidget.viewer.menuItems},prepareMenuItems:function(u){for(var c=[],d=Kekule.Widget.MenuItem.SEPARATOR_TEXT,h=0,p=u.length;h<p;++h){var g=u[h];if(typeof g=="string"){if(g!==d){var f=this.createPredefinedMenuItemDefHash(g);f&&c.push(f)}}else{var m=Object.extend({},g);if(g.widget||g.widgetClass||(m.widget=Kekule.Widget.MenuItem),g.children&&g.children.length){var C=this.prepareMenuItems(g.children);m.children=C}c.push(m)}}return c},createPredefinedMenuItemDefHash:function(u){if(u===t.molDisplayType)return this.createMolDisplayMenuDefHash();var c=[t.rotateX,t.rotateY,t.rotateZ,t.rotateLeft,t.rotateRight],d=this.beginContinuousRepainting.bind(this),h=this.endContinuousRepainting.bind(this),p=(this.getCompActionClass(u),Kekule.Widget.MenuItem),g=null,f=this._getActionOfComp(u,!0);return f&&(g={widget:p,action:f},c.indexOf(u)>=0&&(g=Object.extend(g,{periodicalExecInterval:20,enablePeriodicalExec:!0,"#activate":d,"@deactivate":h}))),g},createMolDisplayMenuDefHash:function(){for(var u=this._getActionOfComp(t.molDisplayType,!0),c={widget:Kekule.Widget.MenuItem,action:u},d=[],h=this.getAllowedMolDisplayTypes(),p=this._getUsableMolDisplayActionClasses(h),g=0,f=p.length;g<f;++g){var m=p[g].TYPE;u=this._getActionOfComp(t.molDisplayType+m,!0,p[g]),d.push({widget:Kekule.Widget.MenuItem,action:u})}return d.length&&(c.children=[{widget:Kekule.Widget.PopupMenu,children:d}]),c},createMenu:function(){var u=this.getMenu();u?u.clearMenuItems():((u=new Kekule.Widget.PopupMenu(this)).addClassName(r.DYN_CREATED),u.setDisplayed(!1));var c=this.getMenuItems()||this.getDefaultMenuItems();return c=this.prepareMenuItems(c),u.createChildrenByDefs(c),this.setMenu(u),u},autoDetectCaption:function(){if(this.getAutoCaption()){var u=this.getChemObj();if(u){var c=u&&u.getInfo(),d=u&&u.getSrcInfo();if(c&&d){var h=c.title||c.caption||u.getName()||d.fileName;h&&this.setCaption(h)}}}},reactHotKeys:function(u){if(this.getEnableHotKey()){for(var c=this.getCoordMode()||Kekule.CoordMode.COORD2D,d=this.getViewerConfigs().getHotKeyConfigs().getHotKeys(),h=Kekule.Widget.KeyboardUtils.getKeyParamsFromEvent(u),p=!1,g=d.length-1;g>=0;--g){var f=d[g],m=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(d[g].key,null,!1);if(m.repeat=f.repeat,Kekule.Widget.KeyboardUtils.matchKeyParams(h,m,!1)){var C=f.action;if(C&&(!f.coordMode||f.coordMode===c)){var _=this.getChildAction(C,!0);_&&(p=_.execute(this,u)||p)}}}if(p)return u.stopPropagation(),u.preventDefault(),!0}},react_keydown:function(u){if(!this.tryApplySuper("react_keydown",[u]))return this.reactHotKeys(u)}}),Kekule.ChemWidget.ViewerSubView=Class.create(Kekule.ChemWidget.ChemObjDisplayerSubView,{CLASS_NAME:"Kekule.ChemWidget.ViewerSubView",initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null,getter:function(){return this.getParent()}})},doClearHotTrackedItems:function(u){},doClearSelectedItems:function(u){}});var o=Kekule.X.Event;Kekule.ChemWidget.ViewerBasicInteractionController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function(u){this.tryApplySuper("initialize",[u]),this._enableMouseRotate=!0,this._transformInfo={isTransforming:!1,lastCoord:null,lastZoom:null},this._restraintCoord=null,this._doInteractiveTransformStepBind=this._doInteractiveTransformStep.bind(this)},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,getter:function(){return this.getWidget()},setter:function(u){this.setWidget(u)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var u=this.getViewer();return!!(u&&u.getEnableDirectInteraction()&&u.getChemObjLoaded())},getEnableTouchInteraction:function(){var u=this.getViewer();return!!(u&&u.getEnableDirectInteraction()&&u.getEnableTouchInteraction()&&u.getChemObjLoaded())},getEnableGestureManipulation:function(){var u=this.getViewer();return!!(u&&u.getEnableDirectInteraction()&&u.getEnableTouchInteraction()&&u.getEnableGesture()&&u.getChemObjLoaded())},_initTransform:function(){var u,c=this.getViewer(),d=c.getOffsetWidth(),h=c.getOffsetHeight(),p=this._transformInfo,g=this._restraintCoord;g?(u=g==="x"?h:d,p.angleRatio=1/u*Math.PI*2):(u=Math.min(d,h),p.angleRatio=1/u*Math.PI)},zoomViewer:function(u,c){var d=this.getViewer();d&&d.getChemObj()&&(u>0?d.zoomIn&&d.zoomIn(u,c):u<0&&d.zoomOut&&d.zoomOut(-u,c))},isEventFromInteractionArea:function(u){var c=u.getTarget(),d=this.getViewer().getInteractionReceiverElem();return c===d||Kekule.DomUtils.isDescendantOf(c,d)},_beginInteractTransformAtCoord:function(u,c,d,h,p,g){var f=this.getViewer();if(f&&f.getChemObj()){var m=this._transformInfo;m.isTransforming=!0,m.interactingPointerId=g,m.lastCoord={x:u,y:c},m.transformInitCoord={x:u,y:c},this.getViewerRenderType()!==Kekule.Render.RendererType.R3D&&(m.initBaseCoordOffset=f.getBaseCoordOffset()||{}),this._restraintCoord=this._calcRestraintRotateCoord(d,h),this._initTransform(),this._requestInteractiveTransform(u,c)}},_beginGestureInteractTransform:function(u){var c=this.getViewer();if(c&&c.getChemObj()){var d=this._transformInfo;d.isGestureTransforming=!0,d.isTransforming=!1,d.initialGestureZoomLevel=c.getCurrZoom(),this._requestInteractiveTransform()}},_clearInteractionTransformInfo:function(){this._transformInfo.interactingPointerId=null,this._transformInfo.isTransforming=!1,this._transformInfo.lastCoord=null,this._transformInfo.transformInitCoord=null,this._transformInfo.initBaseCoordOffset=null,this._transformInfo.isGestureTransforming=!1,this._transformInfo.initialGestureZoomLevel=null},_endInteractTransform:function(){this._clearInteractionTransformInfo(),this._doInteractiveTransformEnd()},isTransforming:function(){return this._transformInfo.isTransforming},_calcRestraintRotateCoord:function(u,c){var d=this.getViewer(),h=null,p=this._getRestraintRotate3DEdgeSize();if(p>0){var g,f,m,C,_=d.getDrawContextParentElem(!0),y=Kekule.HtmlElementUtils.getElemPageRect(_,!0),T=u-y.left,E=c-y.top,b=y.right-u,v=y.bottom-c;T<=b?(m=1,g=T):(m=-1,g=b),E<=v?(C=1,f=E):(C=-1,f=v);var I=Math.min(g,f);if(I>p)return null;f>I?m<0&&(h="x"):h=C>0?"z":"y"}return h},_interactTransformAtCoord:function(u,c,d){if(d===this._transformInfo.interactingPointerId){var h=this._transformInfo.lastCoord;if(h){var p={x:u,y:c};if(Kekule.CoordUtils.getDistance(h,p)<5)return}this._requestInteractiveTransform(u,c)}},_requestInteractiveTransform:function(u,c){this._transformInfo.interactScreenCoord={x:u,y:c},!this._interactiveTransformStepId&&Kekule.$jsRoot.requestAnimationFrame&&(this._interactiveTransformStepId=Kekule.$jsRoot.requestAnimationFrame(this._doInteractiveTransformStepBind))},_doInteractiveTransformStep:function(){if(this._transformInfo){if(this._transformInfo.isGestureTransforming)this._doGestureInteractTransformStep();else if(this._transformInfo.isTransforming){var u=this._transformInfo.interactScreenCoord;this.getViewerRenderType()===Kekule.Render.RendererType.R3D?this.rotateByXYDistance(u.x,u.y):this.moveByXYDistance(u.x,u.y)}this._interactiveTransformStepId=window.requestAnimationFrame(this._doInteractiveTransformStepBind)}},_doGestureInteractTransformStep:function(){var u=this.getViewer();if(u&&u.getChemObj()){var c=this._transformInfo;if(c.isGestureTransforming&&c.pinchScale){var d=c.pinchScale;if(d){var h=c.initialGestureZoomLevel*d;u.zoomTo(h)}}}},_doInteractiveTransformEnd:function(){this._interactiveTransformStepId&&(Kekule.$jsRoot.cancelAnimationFrame&&Kekule.$jsRoot.cancelAnimationFrame(this._interactiveTransformStepId),this._interactiveTransformStepId=null)},_getRestraintRotate3DEdgeSize:function(){var u=this.getViewer();if(u.getEnableRestraintRotation3D()&&u.getRenderType()===Kekule.Render.RendererType.R3D){var c=u.getDimension();return Math.min(c.width,c.height)*(u.getRestraintRotation3DEdgeRatio()||0)}return 0},tryHotTrackBasicObject:function(u,c){return this.doTryHotTrackBasicObject(u,c)},doTryHotTrackBasicObject:function(u,c){var d=this.getViewer();if(d.getEnableObjectHotTrack()){var h=d.getTopmostBasicObjectAtCoord(u,c);d.setHotTrackedObjects(h||null)}},trySelectBasicObject:function(u,c,d){return this.doTrySelectBasicObject(u,c,d)},doTrySelectBasicObject:function(u,c,d){var h=this.getViewer();if(h.getEnableObjectSelect()){var p=h.getTopmostBasicObjectAtCoord(u,d);c&&this.getViewer().getViewerConfigs().getInteractionConfigs().getEnableBasicObjectMultiSelect()?p&&h.toggleSelectingState(p):h.select(p||null)}},needReactEvent:function(u){return this.getEnableInteraction()&&this.isEventFromInteractionArea(u)},react_dblclick:function(u){this.needReactEvent(u)&&this.getViewer().resetDisplay()},react_mousewheel:function(u){if(this.needReactEvent(u)){var c=u.wheelDeltaY||u.wheelDelta;c&&(c/=120);var d=u.getOffsetCoord();return this.zoomViewer(c,d),u.preventDefault(),!0}},react_pointerdown:function(u){this.needReactEvent(u)&&u.getButton()===o.MouseButton.LEFT&&(u.getPointerType()!==o.PointerType.TOUCH||this.getEnableTouchInteraction())&&(this._pointerLeftButtonDownInitCoord={x:u.getScreenX(),y:u.getScreenY()},this._beginInteractTransformAtCoord(u.getScreenX(),u.getScreenY(),u.getClientX(),u.getClientY(),u,u.pointerId))},react_pointerhold:function(u){this.needReactEvent(u)&&u.getPointerType()===o.PointerType.TOUCH&&(u.getButton(),o.MouseButton.LEFT)},react_pointerleave:function(u){this._transformInfo.isTransforming&&this._endInteractTransform(),this.getViewer().clearHotTrackedItems(null,!0)},react_pointerup:function(u){if(u.getButton()===o.MouseButton.LEFT&&(this._transformInfo.isTransforming&&this._endInteractTransform(),this._pointerLeftButtonDownInitCoord)){var c={x:u.getScreenX(),y:u.getScreenY()};if(Kekule.CoordUtils.getDistance(c,this._pointerLeftButtonDownInitCoord)<3){var d=this._getEventMouseCoord(u),h=u.getShiftKey()||u.getCtrlKey();this.trySelectBasicObject(d,h,this.getViewer().getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation())}this._pointerLeftButtonDownInitCoord=null}},react_pointermove:function(u){if(this.needReactEvent(u)){if(this._transformInfo.isTransforming){this._interactTransformAtCoord(u.getScreenX(),u.getScreenY(),u.pointerId);try{u.preventDefault()}catch{}}var c=this._getEventMouseCoord(u);this.tryHotTrackBasicObject(c,this.getViewer().getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation())}},moveByXYDistance:function(u,c){var d=this._transformInfo;if(d&&d.isTransforming&&!d.calculating){var h=this.getViewer();if(h.getRenderType()===Kekule.Render.RendererType.R3D)return;d.calculating=!0;try{var p={x:u,y:c};if(!(d.lastCoord&&Kekule.CoordUtils.isEqual(p,d.lastCoord))){var g=Kekule.CoordUtils.substract(p,d.transformInitCoord),f=d.initBaseCoordOffset;f=Kekule.CoordUtils.add(f,g),h.setBaseCoordOffset(f),d.lastCoord=p}}finally{d.calculating=!1}}},rotateByXYDistance:function(u,c){var d=this._transformInfo;if(d&&d.isTransforming&&!d.calculating){var h=this.getViewer();if(h.getRenderType()!==Kekule.Render.RendererType.R3D)return;d.calculating=!0;try{var p={x:u,y:c};if(!(d.lastCoord&&Kekule.CoordUtils.isEqual(p,d.lastCoord))){var g,f,m,C=Kekule.CoordUtils.substract(p,d.lastCoord);if(C.y=-C.y,this._restraintCoord){var _=this._restraintCoord;_==="x"?(g=C.y,m={x:1,y:0,z:0}):(g=C.x,m=_==="y"?{x:0,y:-1,z:0}:{x:0,y:0,z:1}),f=-g*d.angleRatio}else f=(g=Kekule.CoordUtils.getDistance({x:0,y:0},C))*d.angleRatio,m={x:-C.y,y:C.x,z:0};h.rotate3DByAxis(f,m),d.lastCoord=p,d.calculating=!1}}catch{}finally{d.calculating=!1}}},doTestMouseCursor:function(u,c){var d="";return this._transformInfo.isTransforming&&(d="move"),d},react_pinchstart:function(u){this.getEnableGestureManipulation()&&this._beginGestureInteractTransform(u)},react_pinchmove:function(u){if(this.getEnableGestureManipulation()){var c=this._transformInfo;c.isGestureTransforming&&(c.pinchScale=u.scale)}},react_pinchend:function(u){this.getEnableGestureManipulation()&&this._transformInfo.isGestureTransforming&&this._endInteractTransform()},react_pinchcancel:function(u){this.getEnableGestureManipulation()&&this._transformInfo.isGestureTransforming&&this._endGestureInteractTransform()}}),Kekule.ChemWidget.Viewer2D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function(u,c){this.tryApplySuper("initialize",[u,c,Kekule.Render.RendererType.R2D])},getAllowRenderTypeChange:function(){return!1}}),Kekule.ChemWidget.Viewer3D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function(u,c){this.tryApplySuper("initialize",[u,c,Kekule.Render.RendererType.R3D])},getAllowRenderTypeChange:function(){return!1}});var l=Kekule.ObjPropSettingManager;l.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableEdit:!0,toolButtons:null}),l.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[t.saveData,t.molDisplayType,t.zoomIn,t.zoomOut],menuItems:[t.saveData,"-",t.molDisplayType,t.zoomIn,t.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.mini",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[t.menu],menuItems:[t.saveData,"-",t.molDisplayType,t.zoomIn,t.zoomOut]}),l.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:!1,enableDirectInteraction:!1,enableTouchInteraction:!1,toolButtons:[],menuItems:[]}),l.register("Kekule.ChemWidget.Viewer.editOnly",{enableToolbar:!0,enableEdit:!0,toolButtons:[t.openEditor],menuItems:[t.openEditor]}),Kekule.ChemWidget.Viewer.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}}),Kekule.ChemWidget.ViewerConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerConfigs",initProperties:function(){this.addConfigProp("interactionConfigs","Kekule.ChemWidget.ViewerInteractionConfigs"),this.addConfigProp("hotKeyConfigs","Kekule.ChemWidget.ViewerHotKeyConfigs"),this.addConfigProp("uiMarkerConfigs","Kekule.ChemWidget.ViewerUiMarkerConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("interactionConfigs",new Kekule.ChemWidget.ViewerInteractionConfigs),this.setPropStoreFieldValue("hotKeyConfigs",new Kekule.ChemWidget.ViewerHotKeyConfigs),this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.ChemWidget.ViewerUiMarkerConfigs)}}),Kekule.ChemWidget.ViewerInteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerInteractionConfigs",initProperties:function(){this.addBoolConfigProp("enableBasicObjectHotTrack",!1),this.addHashConfigProp("enableBasicObjectSelect",!1),this.addHashConfigProp("enableBasicObjectMultiSelect",!1),this.addBoolConfigProp("enableTrackOnNearest",!0),this.addIntConfigProp("objBoundTrackInflation",5)}}),Kekule.ChemWidget.ViewerHotKeyConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ViewerHotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var u=Kekule.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"Ctrl+C",action:u.copy},{key:"+",action:u.zoomIn},{key:"-",action:u.zoomOut},{key:"Space",action:u.reset},{key:"R",action:u.rotateLeft,repeat:null,coordMode:2},{key:"Shift-R",action:u.rotateRight,repeat:null,coordMode:2},{key:"X",action:u.rotateX,repeat:null,coordMode:3},{key:"Shift+X",action:u.rotateX,repeat:null,coordMode:3},{key:"Y",action:u.rotateY,repeat:null,coordMode:3},{key:"Shift+Y",action:u.rotateY,repeat:null,coordMode:3},{key:"Z",action:u.rotateZ,repeat:null,coordMode:3},{key:"Shift+Z",action:u.rotateZ,repeat:null,coordMode:3},{key:"H",action:u.molHideHydrogens,coordMode:3},{key:"1",action:u.molDisplayTypeSkeletal,coordMode:2},{key:"1",action:u.molDisplayTypeCondensed,coordMode:2},{key:"1",action:u.molDisplayTypeWire,coordMode:3},{key:"2",action:u.molDisplayTypeSticks,coordMode:3},{key:"3",action:u.molDisplayTypeBallStick,coordMode:3},{key:"4",action:u.molDisplayTypeSpaceFill,coordMode:3}])}}),Kekule.ChemWidget.ViewerUiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs",initProperties:function(){this.addHashConfigProp("hotTrackMarkerStyles",void 0),this.addHashConfigProp("selectionMarkerStyles",void 0),this.addHashConfigProp("hotTrackedObjectStyles",void 0),this.addHashConfigProp("selectedObjectStyles",void 0)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setHotTrackMarkerStyles({strokeColor:"#0000FF",opacity:.2}),this.setSelectionMarkerStyles({opacity:.35,strokeColor:"#0000FF",strokeWidth:2})}}),Kekule.ChemWidget.ActionOnViewer=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function(u,c,d){this.tryApplySuper("initialize",[u,c,d])},doUpdate:function(){var u=this.getDisplayer();this.setEnabled(u&&u.getChemObj()&&u.getChemObjLoaded()&&u.getEnabled())},getViewer:function(){var u=this.getDisplayer();return u instanceof Kekule.ChemWidget.Viewer?u:null}}),Kekule.ChemWidget.ActionViewerRotateBase=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function(u,c,d){this.tryApplySuper("initialize",[u,c,d]),this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})},isShiftModified:function(u){return u&&u.getShiftKey()}}),Kekule.ChemWidget.ActionViewerRotateBase2D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function(){this.tryApplySuper("doUpdate");var u=this.getViewer(),c=u&&u.getRenderType()===Kekule.Render.RendererType.R2D;this.setDisplayed(c).setEnabled(this.getEnabled()&&c)}}),Kekule.ChemWidget.ActionViewerRotateBase3D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function(){this.tryApplySuper("doUpdate");var u=this.getViewer(),c=u&&u.getRenderType()===Kekule.Render.RendererType.R3D;this.setDisplayed(c).setEnabled(this.getEnabled()&&c)}}),Kekule.ChemWidget.ActionViewerRotateLeft=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function(u){this.tryApplySuper("initialize",[u,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATELEFT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATELEFT")])},doExecute:function(u,c){var d=this.getDelta();this.getViewer().rotate2DBy(d)}}),Kekule.ChemWidget.ActionViewerRotateRight=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function(u){this.tryApplySuper("initialize",[u,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATERIGHT"),Kekule.$L("ChemWidgetTexts.HINT_ROTATERIGHT")])},doExecute:function(u,c){var d=-this.getDelta();this.getViewer().rotate2DBy(d)}}),Kekule.ChemWidget.ActionViewerRotateX=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function(u){this.tryApplySuper("initialize",[u,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEX"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEX")])},doExecute:function(u,c){var d=this.isShiftModified(c),h=-this.getDelta();d&&(h=-h),this.getViewer().rotate3DBy(h,0,0)}}),Kekule.ChemWidget.ActionViewerRotateY=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function(u){this.tryApplySuper("initialize",[u,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEY"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEY")])},doExecute:function(u,c){var d=this.isShiftModified(c),h=-this.getDelta();d&&(h=-h),this.getViewer().rotate3DBy(0,h,0)}}),Kekule.ChemWidget.ActionViewerRotateZ=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function(u){this.tryApplySuper("initialize",[u,Kekule.$L("ChemWidgetTexts.CAPTION_ROTATEZ"),Kekule.$L("ChemWidgetTexts.HINT_ROTATEZ")])},doExecute:function(u,c){var d=this.isShiftModified(c),h=-this.getDelta();d&&(h=-h),this.getViewer().rotate3DBy(0,0,h)}}),Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function(u){this.tryApplySuper("initialize",[u,Kekule.$L("ChemWidgetTexts.CAPTION_MOL_DISPLAY_TYPE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_DISPLAY_TYPE")])},doExecute:function(u){},doUpdate:function(){this.tryApplySuper("doUpdate");var u=this.getDisplayer();this.setEnabled(this.getEnabled()&&this._isMolInViewer(u))},_isMolInViewer:function(u){if(u){var c=u.getChemObj();if(c){if(c instanceof Kekule.ChemStructureNode)return!0;var d=Kekule.ChemStructureUtils.getAllStructFragments(c);return!(!d||!d.length)}return!1}return!1}}),Kekule.ChemWidget.ActionViewerEdit=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function(u){this.tryApplySuper("initialize",[u,Kekule.$L("ChemWidgetTexts.CAPTION_OPENEDITOR"),Kekule.$L("ChemWidgetTexts.HINT_OPENEDITOR")])},doUpdate:function(){this.tryApplySuper("doUpdate");var u=this.getViewer();this.setEnabled(u&&u.getAllowEditing()&&u.getEnabled()),this.setDisplayed(u&&u.getEnableEdit())},doExecute:function(u){this.getViewer().openEditor(u)}}),Kekule.ChemWidget.Viewer.rotate2DActionClasses=[n.ActionViewerRotateLeft,n.ActionViewerRotateRight],Kekule.ChemWidget.Viewer.rotate3DActionClasses=[n.ActionViewerRotateX,n.ActionViewerRotateY,n.ActionViewerRotateZ],Kekule.ChemWidget.Viewer.molDisplayType2DActionClasses=[n.ActionDisplayerChangeMolDisplayTypeSkeletal,n.ActionDisplayerChangeMolDisplayTypeCondensed],Kekule.ChemWidget.Viewer.molDisplayType3DActionClasses=[n.ActionDisplayerChangeMolDisplayTypeWire,n.ActionDisplayerChangeMolDisplayTypeSticks,n.ActionDisplayerChangeMolDisplayTypeBallStick,n.ActionDisplayerChangeMolDisplayTypeSpaceFill],Kekule._registerAfterLoadSysProc(function(){var u=Kekule.ActionManager,c=Kekule.ChemWidget,d=Kekule.ChemWidget.Viewer,h=u.registerNamedActionClass;h(t.loadFile,c.ActionDisplayerLoadFile,d),h(t.loadData,c.ActionDisplayerLoadData,d),h(t.saveData,c.ActionDisplayerSaveFile,d),h(t.clearObjs,c.ActionDisplayerClear,d),h(t.zoomIn,c.ActionDisplayerZoomIn,d),h(t.zoomOut,c.ActionDisplayerZoomOut,d),h(t.rotateLeft,c.ActionViewerRotateLeft,d),h(t.rotateRight,c.ActionViewerRotateRight,d),h(t.rotateX,c.ActionViewerRotateX,d),h(t.rotateY,c.ActionViewerRotateY,d),h(t.rotateZ,c.ActionViewerRotateZ,d),h(t.reset,c.ActionDisplayerReset,d),h(t.molHideHydrogens,c.ActionDisplayerHideHydrogens,d),h(t.molAutoGenerateCoords,c.ActionDisplayerAutoGenerateCoordsForMolecule,d),h(t.molDisplayType,c.ActionViewerChangeMolDisplayTypeStub,d),h(t.copy,c.ActionDisplayerCopy,d),h(t.openEditor,c.ActionViewerEdit,d),h(t.config,Kekule.Widget.ActionOpenConfigWidget,d),h(t.molDisplayTypeCondensed,c.ActionDisplayerChangeMolDisplayTypeCondensed,d),h(t.molDisplayTypeSkeletal,c.ActionDisplayerChangeMolDisplayTypeSkeletal,d),h(t.molDisplayTypeWire,c.ActionDisplayerChangeMolDisplayTypeWire,d),h(t.molDisplayTypeSticks,c.ActionDisplayerChangeMolDisplayTypeSticks,d),h(t.molDisplayTypeBallStick,c.ActionDisplayerChangeMolDisplayTypeBallStick,d),h(t.molDisplayTypeSpaceFill,c.ActionDisplayerChangeMolDisplayTypeSpaceFill,d)})}(),function(){Kekule._registerAfterLoadSysProc(function(){if(Kekule.ChemWidget&&Kekule.Spectroscopy){var s=Kekule.ArrayUtils,e=Kekule.ObjUtils,t=Kekule.ZoomUtils;Kekule.globalOptions.add("chemWidget.viewer",{enableSpectrumView:!0,enableLocalSpectrumView:!0}),Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs",initProperties:function(){this.addBoolConfigProp("enableSpectrumView",void 0),this.addBoolConfigProp("enableLocalSpectrumView",void 0),this.addNumConfigProp("spectrumAxisLabelFontSizeMin",15),this.addNumConfigProp("spectrumAxisLabelFontSizeMax",35),this.addNumConfigProp("spectrumAxisLabelFontSizeFixed",18),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeMin",13),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeMax",32),this.addNumConfigProp("spectrumAxisScaleLabelFontSizeFixed",15),this.addHashConfigProp("enableSpectrumDataHotTrackOnMode",void 0),this.addHashConfigProp("enableSpectrumDataSelectOnMode",void 0),this.addHashConfigProp("enableSpectrumDataMultiSelectOnMode",void 0),this.addHashConfigProp("spectrumDataHotTrackUiMarkersOnMode",void 0),this.addHashConfigProp("spectrumDataSelectUiMarkersOnMode",void 0),this.addHashConfigProp("spectrumHotTrackDataPointMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumSelectDataPointMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumHotTrackedDataPointDetailMarkerDrawStyles",void 0),this.addHashConfigProp("spectrumSelectedDataPointDetailMarkerDrawStyles",void 0),this.addIntConfigProp("spectrumDataPointMarkerSize",15),this.addIntConfigProp("spectrumDataPointMarkerWidth",2),this.addIntConfigProp("spectrumDataPointDetailMarkerValuePrecision",8),this.addIntConfigProp("spectrumDataPointDetailMarkerPadding",5),this.addHashConfigProp("spectrumPeakHotTrackStyles",void 0),this.addHashConfigProp("spectrumPeakSelectStyles",void 0),this.addNumConfigProp("spectrumDataPointSelectInflation",1.5),this.defineProp("spectrumZoomPrimaryModifierKeys",{dataType:DataType.ARRAY}),this.defineProp("spectrumZoomSecondaryModifierKeys",{dataType:DataType.ARRAY}),this.defineProp("spectrumZoomBothModifierKeys",{dataType:DataType.ARRAY})},initPropDefValues:function(){this.tryApplySuper("initPropDefValues");var i=Kekule.Spectroscopy.DataMode,r={default:!0};this.setEnableSpectrumDataHotTrackOnMode(r),r={default:!1},this.setEnableSpectrumDataSelectOnMode(r),r={default:!1},this.setEnableSpectrumDataMultiSelectOnMode(r),(r={})[i.CONTINUOUS]=[n.DATA_POINT,n.DATA_DETAIL],r[i.PEAK]=[n.PEAK,n.DATA_DETAIL],this.setSpectrumDataHotTrackUiMarkersOnMode(r),(r={})[i.CONTINUOUS]=[n.DATA_POINT],r[i.PEAK]=[n.PEAK],this.setSpectrumDataSelectUiMarkersOnMode(r),this.setSpectrumHotTrackDataPointMarkerDrawStyles({color:"#c21717",strokeWidth:1,opacity:1}),this.setSpectrumSelectDataPointMarkerDrawStyles({color:"#0077d6",strokeWidth:1,opacity:1}),this.setSpectrumHotTrackedDataPointDetailMarkerDrawStyles({fontFamily:"Arial, Helvetica, sans-serif",fontSize:15,color:"#c21717",strokeWidth:2,opacity:1}),this.setSpectrumSelectedDataPointDetailMarkerDrawStyles({fontFamily:"Arial, Helvetica, sans-serif",fontSize:15,color:"#0077d6",strokeWidth:2,opacity:1}),this.setSpectrumPeakHotTrackStyles({color:"#c21717"}),this.setSpectrumPeakSelectStyles({color:"#0077d6",spectrum_dataStrokeWidthRatio:.05}),this.setSpectrumZoomPrimaryModifierKeys([]),this.setSpectrumZoomSecondaryModifierKeys(["shift"]),this.setSpectrumZoomBothModifierKeys(["alt"])},initPropValues:function(){this.tryApplySuper("initPropValues")},getActualEnableSpectrumView:function(){return Kekule.oneOf(this.getEnableSpectrumView(),Kekule.globalOptions.chemWidget.viewer.enableSpectrumView)},getActualEnableLocalSpectrumView:function(){return Kekule.oneOf(this.getEnableLocalSpectrumView(),Kekule.globalOptions.chemWidget.viewer.enableLocalSpectrumView)},getDataModeSpecifiedConfigValue:function(i,r){var a=this.getPropValue(i);if(DataType.isObjectValue(a)){var o=a[r];return o===void 0&&(o=a.default),o}return a},setDataModeSpecifiedConfigValue:function(i,r,a){var o=this.getPropValue(i);o||(o={},this.setPropValue(i,o)),Kekule.ObjUtils.notUnset(a)?o[a]=r:o.default=r},getDataModeSpecifiedBoolConfigValueOfModeList:function(i,r,a){var o=s.toArray(r),l=this.getDataModeSpecifiedConfigValue(i,o[0]);if(!l&&a)return l;for(var u=0,c=o.length;u<c;++u)if(a){if(!(l=l&&this.getDataModeSpecifiedConfigValue(i,o[u])))return l}else l=l||this.getDataModeSpecifiedConfigValue(i,o[u]);return l}}),ClassEx.extendMethods(Kekule.ChemWidget.ChemObjDisplayerConfigs,{initProperties:function(i){i(),this.addConfigProp("spectrumViewConfigs","Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs")},initPropDefValues:function(i){i(),this.setPropStoreFieldValue("spectrumViewConfigs",new Kekule.ChemWidget.ChemObjDisplayerSpectrumViewConfigs)}}),Kekule.ChemWidget.Viewer.SpectrumSubView=Class.create(Kekule.ChemWidget.ViewerSubView,{CLASS_NAME:"Kekule.ChemWidget.Viewer.SpectrumSubView",initialize:function(i,r){this.tryApplySuper("initialize",[i,r])},initProperties:function(){this.defineProp("spectrum",{dataType:"Kekule.Spectroscopy.Spectrum",serializable:!1,getter:function(){return this.getTarget()},setter:function(i){this.setTarget(i)}}),this.defineProp("viewportRanges",{dataType:DataType.HASH,serializable:!1}),this.defineProp("hotTrackedDataItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var i=this.getHotTrackedDataItemEx();return i&&i.dataItem},setter:function(i){var r=i&&this._findSectionOfDataItem(i,!0),a=r?{section:r,dataValue:i}:null;this.changeHotTrackedDataItem(a,!0)}}),this.defineProp("hotTrackedDataItemEx",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var i=this.getHotTrackedDataItemsEx();return i&&i[0]},setter:function(i){var r=this._fetchDataItemsEx(i);this.changeHotTrackedDataItems(r,!0)}}),this.defineProp("hotTrackedDataItemsEx",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("hotTrackedDataItemsEx")||[]},setter:function(i){this.changeHotTrackedDataItems(i,!0)}}),this.defineProp("selectedDataItem",{dataType:DataType.OBJECT,serializable:!1,getter:function(i){var r=this.getSelectedDataItemEx();return r&&r.dataItem},setter:function(i){var r=i&&this._findSectionOfDataItem(i,!0),a=r?{section:r,dataValue:i}:null;this.changeSelectedDataItems(a&&[a],!0)}}),this.defineProp("selectedDataItems",{dataType:DataType.ARRAY,serializable:!1,getter:function(i){var r=this.getSelectedDataItemsEx();if(r){for(var a=[],o=0,l=r.length;o<l;++o)a.push(r[o].dataItem);return a}return[]},setter:function(i){var r=this._fetchDataItemsEx(i);this.changeSelectedDataItems(r,!0)}}),this.defineProp("selectedDataItemEx",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var i=this.getSelectedDataItemsEx();return i&&i[0]},setter:function(i){this.changeSelectedDataItems(i&&[i],!0)}}),this.defineProp("selectedDataItemsEx",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("selectedDataItemsEx")||[]},setter:function(i){this.changeSelectedDataItems(i,!0)}}),this.defineProp("isSpectrumWithReversedAxises",{dataType:DataType.BOOL,serializable:!1,setter:null,getter:function(){var i=this._getSpectrumRenderCache();return!(!i||!i.spectrum_reversedAxises)}})},appliableToTarget:function(i){return i instanceof Kekule.Spectroscopy.Spectrum},_getSpectrumRenderer:function(){var i=this.getSpectrum();if(i){var r=this.getViewer().getDrawContext(),a=this.getViewer().getRootRenderer();return a&&a.getDirectRendererForChildObj&&a.getDirectRendererForChildObj(r,i)}return null},_getSpectrumRenderCache:function(){var i=this._getSpectrumRenderer(),r=this.getViewer().getDrawContext();return i&&i.getRenderCache(r)},getDisplayedDataModes:function(){for(var i=this.getSpectrum(),r=i&&i.getDisplayedDataSections()||[],a=[],o=0,l=r.length;o<l;++o)a.push(r[o].getMode());return a},getClientScreenBox:function(){var i=this.getViewer(),r=this.getSpectrum();if(r){var a=i.getBoundInfoRecorder(),o=a&&a.getBound(i.getDrawContext(),r.getPseudoRenderSubObject("data"));return o.shapeType===Kekule.Render.MetaShapeType.RECT?Kekule.BoxUtils.createBox(o.coords[0],o.coords[1]):null}return null},fetchViewportRanges:function(){var i={},r=Kekule.VarDependency;return i[r.INDEPENDENT]=this.getViewportRange(r.INDEPENDENT),i[r.DEPENDENT]=this.getViewportRange(r.DEPENDENT),i},getViewportRange:function(i){var r=(this.getViewportRanges()||{})[i]||{};return Object.extend({rangeFrom:0,rangeTo:1},r)},setViewportRange:function(i,r,a){var o=this.getViewportRanges();o||(o={},this.setViewportRanges(o));var l=o[i];return l||(l={},o[i]=l),l.rangeFrom=Kekule.oneOf(r,0),l.rangeTo=Kekule.oneOf(a,1),this.applyToRenderOptions(),this},resetViewportRange:function(i){if(Kekule.ObjUtils.isUnset(i))this.setViewportRanges(void 0);else{var r=this.getViewportRange(i);r&&r[i]&&delete r[i]}this.applyToRenderOptions()},getViewportZoomInfo:function(i){i||(i=Kekule.VarDependency.INDEPENDENT);var r=this.getViewportRange(i);return{zoom:1/Math.abs(r.rangeTo-r.rangeFrom),center:(r.rangeTo+r.rangeFrom)/2}},setViewportZoom:function(i,r,a){i||(i=Kekule.VarDependency.INDEPENDENT),Kekule.ObjUtils.isUnset(a)&&(a=this.getViewportZoomInfo(i).center);var o=1/r/2,l={rangeFrom:a-o,rangeTo:a+o};this.setViewportRange(i,l.rangeFrom,l.rangeTo)},_zoomViewportTo:function(i,r,a,o){var l,u=this.getClientScreenBox(),c=this.getViewportRange(o),d=1/i-(c.rangeTo-c.rangeFrom);l=r?a==="x"?(r.x-u.x1)/(u.x2-u.x1):(u.y2-r.y)/(u.y2-u.y1):.5;var h=c.rangeFrom-d*l,p=c.rangeTo+d*(1-l);return this.setViewportRange(o,h,p),this},zoomViewportByDelta:function(i,r,a){var o=this.getViewer();o.beginUpdate();try{for(var l=0,u=a.length;l<u;++l){var c=a[l],d=c==="x";this.getIsSpectrumWithReversedAxises()&&(d=!d);var h,p=d?Kekule.VarDependency.INDEPENDENT:Kekule.VarDependency.DEPENDENT,g=this.getViewportZoomInfo(p).zoom;i>0?h=t.getNextZoomInRatio(g,i):i<0&&(h=t.getNextZoomOutRatio(g,-i)),this._zoomViewportTo(h,r,c,p)}}finally{o.endUpdate()}},_applyViewportRanges:function(){this.getViewer();for(var i=[Kekule.VarDependency.INDEPENDENT,Kekule.VarDependency.DEPENDENT],r=["independent","dependent"],a=this.getTarget(),o=0,l=r.length;o<l;++o){var u=this.getViewportRange(i[o]),c="spectrum_viewport"+r[o].upperFirst()+"DataRangeFrom",d="spectrum_viewport"+r[o].upperFirst()+"DataRangeTo",h={};h[c]=u.rangeFrom,h[d]=u.rangeTo,a.addOverrideRenderOptionItem(h)}},applyToRenderOptions:function(){this._applyViewportRanges(),this.doRepaintSpectrum()},doRepaintSpectrum:function(){var i=this.getViewer(),r=i.getRootRenderer();r&&(r.update(i.getDrawContext(),[{obj:this.getTarget()}]),this.updateSpectrumDataItemUiMarkers())},_getHotTrackedDataItemRenderStyles:function(){var i=this.getViewer();return i&&i.getDisplayerConfigs().getSpectrumViewConfigs().getSpectrumPeakHotTrackStyles()},_getSelectedDataItemRenderStyles:function(){var i=this.getViewer();return i&&i.getDisplayerConfigs().getSpectrumViewConfigs().getSpectrumPeakSelectStyles()},_findSectionOfDataItem:function(i,r){for(var a=this.getSpectrum(),o=r?a.getDisplayedDataSections():a.getDataSections(),l=0,u=o.length;l<u;++l){var c=o[l];if(c.indexOfDataItem(i)>=0)return c}return null},_fetchDataItemsEx:function(i){for(var r=i?s.toArray(i):[],a=[],o=0,l=r.length;o<l;++o){var u,c=r[o];if(DataType.isObjectValue(c)&&c.section&&c.dataValue)u=c;else{var d=c&&this._findSectionOfDataItem(c,!0);u=d?{section:d,dataValue:c}:null}u&&a.push(u)}return a},_indexOfDataItemEx:function(i,r){var a=r.indexOf(i);if(a<=0)for(var o=0,l=r.length;o<l;++o){var u=r[o];if(i.section&&u.section===i.section){if(i.section.isPeakSection()){var c=u.section._getDataValueSrc(u.dataValue);if(c&&i.section._getDataValueSrc(i.dataValue)===c){a=o;break}}else if(e.equal(i.dataValue,u.dataValue)){a=o;break}}}return a},addToSelection:function(i){for(var r=s.clone(this.getSelectedDataItemsEx()),a=this._fetchDataItemsEx(i),o=0,l=a.length;o<l;++o){var u=a[o];this._indexOfDataItemEx(u,r)>=0||r.push(u)}this.changeSelectedDataItems(r,!0)},removeFromSelection:function(i){for(var r=s.clone(this.getSelectedDataItemsEx()),a=this._fetchDataItemsEx(i),o=0,l=a.length;o<l;++o){var u=a[o],c=this._indexOfDataItemEx(u,r);c>=0&&r.splice(c,1)}this.changeSelectedDataItems(r,!0)},toggleSelectingState:function(i){for(var r=s.clone(this.getSelectedDataItemsEx()),a=this._fetchDataItemsEx(i),o=0,l=a.length;o<l;++o){var u=a[o],c=this._indexOfDataItemEx(u,r);c>=0?r.splice(c,1):r.push(u)}this.changeSelectedDataItems(r,!0)},select:function(i){var r=this._fetchDataItemsEx(i);this.changeSelectedDataItems(r,!0)},doClearHotTrackedItems:function(){this.changeHotTrackedDataItems(null,!1)},doClearSelectedItems:function(){this.changeSelectedDataItems(null,!1)},_hotTrackedDataItemsChanged:function(i,r){this._hotTrackedOrSelectDataItemsChanged(i,r,!1),this.invokeEvent("hotTrackOnSpectrumData",{spectrum:this.getSpectrum(),dataItems:r,prevDataItems:i})},_selectedDataItemsChanged:function(i,r){this._hotTrackedOrSelectDataItemsChanged(i,r,!0),this.invokeEvent("spectrumDataSelectionChange",{spectrum:this.getSpectrum(),dataItems:r,prevDataItems:i})},_hotTrackedOrSelectDataItemsChanged:function(i,r,a){var o=this.getViewer(),l=this.getSpectrum(),u=!1,c=a?"_selectDataItemRenderStyles":"_hotTrackedDataItemRenderStyles";if(r&&r.length&&(a?o.clearSelectedItems([this],!1):o.clearHotTrackedItems([this],!1)),i)for(var d=0,h=i.length;d<h;++d)this._updateHotTrackOrSelectUiMarkerToDataItem(null,a,d),this[c]&&(l.removeDataItemOverrideRenderOptionItem(i[d].dataValue,this[c]),u=!0);if(r)for(d=0,h=r.length;d<h;++d)this._updateHotTrackOrSelectUiMarkerToDataItem(r[d],a,d).needRepaintSpectrum&&(u=!0);else this._updateHotTrackOrSelectUiMarkerToDataItem(null,a);u&&o.requestRepaint()},_updateHotTrackOrSelectUiMarkerToDataItem:function(i,r,a){var o=this.getViewer(),l=this.getViewer().getDisplayerConfigs().getSpectrumViewConfigs(),u=r?"_selectDataItemRenderStyles":"_hotTrackedDataItemRenderStyles",c=i&&i.dataValue?r?this._getSpectrumDataSelectElements(l,i.section):this._getSpectrumDataHotTrackElements(l,i.section):[],d=c.indexOf(n.DATA_POINT)>=0,h=c.indexOf(n.DATA_DETAIL)>=0,p=r?"selectDataDetail":"hotTrackDataDetail";p+=a||0;var g=r?"selectDataPoint":"hotTrackDataPoint";g+=a||0;var f=o.getSpectrumUiMarker(p,!!h),m=o.getSpectrumUiMarker(g,!!d),C=!1;if(i&&c.length){var _=this.getSpectrum(),y=i.dataValue;if(i.section.isPeakSection()&&c.indexOf(n.PEAK)>=0){var T=r?this._getSelectedDataItemRenderStyles():this._getHotTrackedDataItemRenderStyles();T&&(_.addDataItemOverrideRenderOptionItem(i.dataValue,T),this[u]=T,C=!0)}if(d||h){var E=this.getClientScreenBox(),b=this.calcCoordAtSpectrumData(y,Kekule.Render.CoordSystem.CONTEXT),v=null;h&&(v=this._formatSpectrumDataValueString(y,l.getSpectrumDataPointDetailMarkerValuePrecision()))}var I=r?l.getSpectrumSelectedDataPointDetailMarkerDrawStyles():l.getSpectrumHotTrackedDataPointDetailMarkerDrawStyles(),R=r?l.getSpectrumSelectDataPointMarkerDrawStyles():l.getSpectrumHotTrackDataPointMarkerDrawStyles();this._updateDataDetailMarker(f,b,{text:v},h,I,E,!1),this._updateDataPointMarker(m,b,null,d,R,E,!1)}else f&&o.hideUiMarker(f,!1),m&&o.hideUiMarker(m,!1);return{needRepaintSpectrum:C}},updateSpectrumDataItemUiMarkers:function(i){var r=this.getHotTrackedDataItemsEx();if(r)for(var a=0,o=r.length;a<o;++a){var l=r[a];this._updateHotTrackOrSelectUiMarkerToDataItem(l,!1,a)}else i||this._updateHotTrackOrSelectUiMarkerToDataItem(null,!1,0);var u=this.getSelectedDataItemsEx();if(u)for(a=0,o=u.length;a<o;++a){var c=u[a];this._updateHotTrackOrSelectUiMarkerToDataItem(c,!0,a)}else i||this._updateHotTrackOrSelectUiMarkerToDataItem(null,!0,0)},_isSameHotTrackedOrSelectedItems:function(i,r){var a=i,o=r;return a&&!a.length&&(a=null),o&&!o.length&&(o=null),a==o||!(!a||!o)&&s.compare(a,o,function(l,u){return l===u?0:-1})===0},changeHotTrackedDataItems:function(i,r){var a=this.getHotTrackedDataItemsEx();if(!this._isSameHotTrackedOrSelectedItems(a,i)){var o=this.getViewer();r&&o.beginUpdateUiMarkers();try{this.setPropStoreFieldValue("hotTrackedDataItemsEx",i),this._hotTrackedDataItemsChanged(a,i),r&&o.updateUiMarkers(!0)}finally{r&&o.endUpdateUiMarkers()}}},changeSelectedDataItems:function(i,r){var a=this.getSelectedDataItemsEx();if(!this._isSameHotTrackedOrSelectedItems(a,i)){var o=this.getViewer();r&&o.beginUpdateUiMarkers();try{this.setPropStoreFieldValue("selectedDataItemsEx",i),this._selectedDataItemsChanged(a,i),r&&o.updateUiMarkers(!0)}finally{r&&o.endUpdateUiMarkers()}}},_getSpectrumDataHotTrackElements:function(i,r){var a=i,o=r.getMode();return a.getDataModeSpecifiedConfigValue("enableSpectrumDataHotTrackOnMode",o)?a.getDataModeSpecifiedConfigValue("spectrumDataHotTrackUiMarkersOnMode",o):[]},_getSpectrumDataSelectElements:function(i,r){var a=i,o=r.getMode();return a.getDataModeSpecifiedConfigValue("enableSpectrumDataSelectOnMode",o)?a.getDataModeSpecifiedConfigValue("spectrumDataSelectUiMarkersOnMode",o):[]},_formatSpectrumDataValueString:function(i,r){for(var a=Kekule.ObjUtils.getOwnedFieldNames(i),o=[],l=0,u=a.length;l<u;++l)Kekule.NumUtils.isNormalNumber(i[a[l]])&&o.push(a[l]+": "+i[a[l]].toPrecision(r));return o.join(", ")},_updateDataPointMarker:function(i,r,a,o,l,u,c){if(i){var d=this.getViewer(),h=o&&r;if(h&&(h=!!Kekule.CoordUtils.isInsideBox(r,u)),h){var p,g=d.getDisplayerConfigs().getSpectrumViewConfigs(),f=d.getRenderConfigs().getLengthConfigs().getUnitLength()||1,m=(g.getSpectrumDataPointMarkerWidth()||1)*f,C=r;if(g.getSpectrumDataPointMarkerSize()){var _=g.getSpectrumDataPointMarkerSize()/2*f;p=[Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:C.x-_,y:C.y},{x:C.x+_,y:C.y}],{width:m}),Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:C.x,y:C.y-_},{x:C.x,y:C.y+_}],{width:m})]}else u&&(p=[Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:u.x1,y:C.y},{x:u.x2,y:C.y}],{width:m}),Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.LINE,[{x:C.x,y:u.y1},{x:C.x,y:u.y2}],{width:m})]);var y=Object.create(l);y.strokeWidth*=f,d.modifyShapeBasedMarker(i,p,y,!1),d.showUiMarker(i,c)}else d.hideUiMarker(i,c)}},_updateDataDetailMarker:function(i,r,a,o,l,u,c){if(i){var d=this.getViewer(),h=a.text,p=o&&r&&h;if(p&&(p=!!Kekule.CoordUtils.isInsideBox(r,u)),p){var g=d.getDisplayerConfigs().getSpectrumViewConfigs(),f=d.getRenderConfigs().getLengthConfigs().getUnitLength()||1,m=Object.create(l);if(m.fontSize*=f,h){var C,_=d.getDrawBridge(),y=_.canMeasureText&&_.canMeasureText(),T=_.canMeasureDrawnText&&_.canMeasureDrawnText(),E=_.canMeasureText&&_.canModifyText();if(y)C=_.measureText(d.getDrawContext(),h,m);else if(T&&E){var b=this.getViewer().getUiContext(),v=_.drawText(b,{x:0,y:0},h,m);C=_.measureDrawnText(b,v),_.removeDrawnElem(b,v)}var I,R,N=(g.getSpectrumDataPointDetailMarkerPadding()||0)*f,L={x1:r.x-u.x1,x2:u.x2-r.x,y1:r.y-u.y1,y2:u.y2-r.y},U={};L.x2-N>=C.width?(U.x=r.x+N,I=Kekule.Render.BoxXAlignment.LEFT):L.x1-N>=C.width?(U.x=r.x-N,I=Kekule.Render.BoxXAlignment.RIGHT):L.x2>=L.x1?(U.x=u.x2-C.width,I=Kekule.Render.BoxXAlignment.LEFT):(U.x=u.x1+C.width,I=Kekule.Render.BoxXAlignment.RIGHT),L.y1-N>=C.height?(U.y=r.y-N,R=Kekule.Render.BoxYAlignment.BOTTOM):L.y2-N>=C.height?(U.y=r.y+N,R=Kekule.Render.BoxYAlignment.TOP):L.y1>=L.y2?(U.y=u.y1+C.height,R=Kekule.Render.BoxYAlignment.BOTTOM):(U.y=u.y2-C.height,R=Kekule.Render.BoxYAlignment.TOP),m.textBoxXAlignment=I,m.textBoxYAlignment=R}d.modifyTextBasedMarker(i,U,h,m,!1),d.showUiMarker(i,c)}else d.hideUiMarker(i,c)}},resetView:function(){this.changeHotTrackedDataItems(null,!1),this.changeSelectedDataItems(null,!1),this.resetViewportRange()},getSpectrumDataValueInfoFromIndependent:function(i,r,a){for(var o=this.getSpectrum(),l=r||o.getDisplayedDataSections()||[],u=0,c=l.length;u<c;++u){var d=l[u],h=d.getDataValueFromIndependent(i,a);if(Kekule.ObjUtils.notUnset(h))return{value:h,section:d}}return null},calcValueFromIndependent:function(i,r){var a={};return a=typeof i=="number"?this._convArrayToSymboledHash([i],this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):DataType.isArrayValue(i)?this._convArrayToSymboledHash(i,this.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT)):i,this.doCalcValueFromIndependent(a,r)},translateCoordToSpectrum:function(i,r){var a=this.getViewer().translateCoord(i,r,Kekule.Render.CoordSystem.CONTEXT),o=this._getSpectrumRenderCache().spectrumInvDataTransformMatrix,l=this.getViewer().getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;return o?l(a,o):a},translateCoordFromSpectrum:function(i,r){var a=this._getSpectrumRenderCache().spectrumDataTransformMatrix,o=this.getViewer().getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix,l=a?o(i,a):i;return this.getViewer().translateCoord(l,Kekule.Render.CoordSystem.CONTEXT,r)},getSpectrumDataValueItemInfoAtCoord:function(i,r,a){for(var o=this.translateCoordToSpectrum(i,r),l=this.getIsSpectrumWithReversedAxises()?o.y:o.x,u=this.getSpectrum().getDisplayedDataSections()||[],c=0,d=u.length;c<d;++c){var h=u[c],p=h.getDataValueFromIndependent(l,a);if(p)return{dataValue:p,dataSection:h}}return null},calcSpectrumDataAtCoord:function(i,r,a){for(var o=this.translateCoordToSpectrum(i,r),l=this.getIsSpectrumWithReversedAxises()?o.y:o.x,u=this.getSpectrum().getDisplayedDataSections()||[],c=0,d=u.length;c<d;++c){var h=u[c].calcValueFromIndependent(l,a);if(h)return h}return null},calcSpectrumDataRangeInCoordRange:function(i,r,a){for(var o=this.getIsSpectrumWithReversedAxises()?"y":"x",l=Kekule.Spectroscopy.Utils.expandDataRange({},i),u=[this.translateCoordToSpectrum({x:l.x.min,y:l.y.min},r),this.translateCoordToSpectrum({x:l.x.max,y:l.y.max},r)],c=[u[0][o],u[1][o]],d={min:Math.min(c[0],c[1]),max:Math.max(c[0],c[1])},h=this.getSpectrum().getDisplayedDataSections()||[],p=0,g=h.length;p<g;++p){var f=h[p],m=f.calcValueRangeFromIndependentRangeEx([d],a);if(m&&m.range)return m.dataSection=f,m}return null},calcSpectrumPrimaryDataValueInCoordRangeEx:function(i,r,a){var o=Object.create(a||null);o.findNearest=!0,o.findInReversedOrder=!0;var l=this.calcSpectrumDataRangeInCoordRange(i,r,o);if(!l)return null;var u,c=l.dataSection;if(c.isPeakSection()&&l.nearest)u=l.nearest.dataValue;else{var d=c.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT)[0];if(d){for(var h=this.getSpectrum(),p=Kekule.Spectroscopy.Utils.getSpectrumPeakPosition(h),g=l.dataValues,f=g[0],m=g.length-1;m>=0;--m){var C=g[m];(p===Kekule.Spectroscopy.DataPeakPosition.MIN&&C[d]<f[d]||C[d]>f[d])&&(f=C)}u=f}else u=g[Math.round((g.length-1)/2)+1]}return{dataValue:u,dataSection:c}},calcSpectrumPrimaryDataValueInCoordRange:function(i,r,a){return this.calcSpectrumPrimaryDataValueInCoordRangeEx(i,r,a).dataValue},calcCoordAtSpectrumData:function(i,r,a){var o=this.getIsSpectrumWithReversedAxises(),l=(this.getSpectrum().getDisplayedDataSections()||[])[0];if(l){var u=this._spectrumSectionDataValueToSpectrumCoord(i,l,o);return u&&this.translateCoordFromSpectrum(u,r)}return null},calcCoordAtSpectrumDataFromIndependent:function(i,r,a){for(var o=this.getSpectrum().getDisplayedDataSections()||[],l=this.getIsSpectrumWithReversedAxises(),u=0,c=o.length;u<c;++u){var d=o[u],h=d.calcValueFromIndependent(indepValue,a);if(h){var p=this._spectrumSectionDataValueToSpectrumCoord(h,d,l);return p&&this.translateCoordFromSpectrum(p,r)}}return null},_spectrumSectionDataValueToSpectrumCoord:function(i,r,a){var o=r.getLocalVarSymbolsOfDependency(Kekule.VarDependency.INDEPENDENT),l=r.getLocalVarSymbolsOfDependency(Kekule.VarDependency.DEPENDENT),u=function(h,p){for(var g=0,f=p.length;g<f;++g){var m=h[p[g]];if(Kekule.ObjUtils.notUnset(m))return m}return null},c=u(i,o),d=u(i,l);return{x:a?d:c,y:a?c:d}}}),Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP="spectrum",ClassEx.extend(Kekule.ChemWidget.Viewer,{createShapeBasedSpectrumUiMarker:function(i,r){return this.createShapeBasedMarker(null,null,{name:i,groups:[r,Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP]},!1)},createTextBasedSpectrumUiMarker:function(i,r){return this.createTextBasedMarker(null,null,null,{name:i,groups:[r,Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP]},!1)},getSpectrumUiMarker:function(i,r){var a=this.getUiMarkers().getMarkerOfName(i);if(!a&&r){var o=i.indexOf("DataDetail")>=0,l=i.indexOf("select")>=0?Kekule.ChemWidget.ViewerUiMarkerGroup.SELECT:i.indexOf("hotTrack")>=0?Kekule.ChemWidget.ViewerUiMarkerGroup.HOTTRACK:null;a=o?this.createTextBasedSpectrumUiMarker(i,l):this.createShapeBasedSpectrumUiMarker(i,l)}return a},getSpectrumUiMarkers:function(){return this.getUiMarkers().getMarkersOfGroup(Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP)},_hideAllSpectrumUiMarkers:function(i){this.setVisibleOfUiMarkerGroup(Kekule.ChemWidget.ViewerUiMarkerGroup.SPECTRUM_UI_MARKER_GROUP,!1,i)},updateSpectrumViewDataItemUiMarkers:function(){try{this._hideAllSpectrumUiMarkers(!1),this.iterateSubViews(function(i){i instanceof Kekule.ChemWidget.Viewer.SpectrumSubView&&i.updateSpectrumDataItemUiMarkers(!0)})}finally{}}}),ClassEx.extendMethods(Kekule.ChemWidget.Viewer,{_createSpectrumView:function(i){return this.fetchSubView(this.getChemObj(),Kekule.ChemWidget.Viewer.SpectrumSubView)},_isDisplayingSingleSpectrum:function(i){var r=this.getChemObj();return!!(r&&r instanceof Kekule.Spectroscopy.Spectrum)},getSpectrumView:function(i,r){return this.fetchSubView(r||this.getChemObj(),Kekule.ChemWidget.Viewer.SpectrumSubView)},isInSpectrumMode:function(i){return!(!Kekule.Spectroscopy||!Kekule.Spectroscopy.Spectrum)&&this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getDisplayerConfigs().getSpectrumViewConfigs().getActualEnableSpectrumView()&&this._isDisplayingSingleSpectrum()},isLocalSpectrumViewEnabled:function(i){return!(!Kekule.Spectroscopy||!Kekule.Spectroscopy.Spectrum)&&this.getRenderType()===Kekule.Render.RendererType.R2D&&this.getDisplayerConfigs().getSpectrumViewConfigs().getActualEnableLocalSpectrumView()},enableSpectrumInteraction:function(i){return this.isInSpectrumMode()||this.isLocalSpectrumViewEnabled()},getEnableUiContext:function(i){return!0},allowAutoSize:function(i){return!this.isInSpectrumMode()&&i()},getActualDrawOptions:function(i){var r=i();if(this.isInSpectrumMode()&&this.getSpectrumView()){var a=Object.create(r);return Kekule.ObjUtils.isUnset(r.retainAspect)&&(a.retainAspect=!1),a.autofit=!0,a}return r},doLoad:function(i,r){if(this.isInSpectrumMode()){var a=this.getSpectrumView();a&&a.resetView()}return i(r)},_repaintCore:function(i,r){var a=this.isInSpectrumMode(),o=this.isLocalSpectrumViewEnabled();if(a||o){var l=Object.create(r||{});if(l._spectrum_render_enable_sub_bounds=!0,a){var u=this.getDisplayerConfigs().getSpectrumViewConfigs();l.spectrum_axisLabelFontSizeMin=u.getSpectrumAxisLabelFontSizeMin(),l.spectrum_axisLabelFontSizeMax=u.getSpectrumAxisLabelFontSizeMax(),l.spectrum_axisLabelFontSizeFixed=u.getSpectrumAxisLabelFontSizeFixed(),l.spectrum_axisScaleLabelFontSizeMin=u.getSpectrumAxisScaleLabelFontSizeMin(),l.spectrum_axisScaleLabelFontSizeMax=u.getSpectrumAxisScaleLabelFontSizeMax(),l.spectrum_axisScaleLabelFontSizeFixed=u.getSpectrumAxisScaleLabelFontSizeFixed()}return i(l)}return i(r)},doUpdateUiMarkers:function(i){return this.updateSpectrumViewDataItemUiMarkers(),i()},repaintUiMarker:function(i){return i()},getCurrZoom:function(i){return this.isInSpectrumMode()&&this.getSpectrumView()?this.getSpectrumView().getViewportZoomInfo().zoom:i()},zoomTo:function(i,r,a,o){if(this.isInSpectrumMode()){var l=this.getSpectrumView();if(l){var u=l.getClientScreenBox(),c=l.getViewportRange(Kekule.VarDependency.INDEPENDENT),d=1/r-(c.rangeTo-c.rangeFrom),h=o?(o.x-u.x1)/(u.x2-u.x1):.5,p=c.rangeFrom-d*h,g=c.rangeTo+d*(1-h);l.setViewportRange(Kekule.VarDependency.INDEPENDENT,p,g),a||this.geometryOptionChanged()}else i(r,a,o)}else i(r,a,o);return this},resetZoom:function(i,r){if(this.isInSpectrumMode()){var a=this.getSpectrumView();return a?(a.resetViewportRange(),this):i(r)}return i(r)},resetDisplay:function(i){if(this.isInSpectrumMode()){var r=this.getSpectrumView();r&&r.resetView()}return i()}}),Kekule.ChemWidget.Viewer.SpectrumSubView.UiMarker={DATA_POINT:1,DATA_DETAIL:2,PEAK:4};var n=Kekule.ChemWidget.Viewer.SpectrumSubView.UiMarker;ClassEx.extend(Kekule.ChemWidget.ViewerBasicInteractionController,{getSpectrumUiMarker:function(i,r){return this.getViewer().getSpectrumUiMarker(i,r)},_setSpectrumUiMarkersVisible:function(i,r){var a=this.getViewer(),o=this.getSpectrumUiMarker("hotTrackDataPoint",i),l=this.getSpectrumUiMarker("hotTrackDataDetail",i);i?(o&&a.showUiMarker(o,!1),l&&a.showUiMarker(l,!1)):(o&&a.hideUiMarker(o,!1),l&&a.hideUiMarker(l,!1)),r&&a.repaintUiMarker()},hideSpectrumUiMarkers:function(i){this._setSpectrumUiMarkersVisible(!1,i)},showSpectrumUiMarkers:function(i){this._setSpectrumUiMarkersVisible(!0,i)},_getAncestorSpectrumObj:function(i){if(i instanceof Kekule.Spectroscopy.Spectrum)return i;if(i){var r=i.getParent?i.getParent():i.parent;return r?this._getAncestorSpectrumObj(r):null}return null},_getSpectrumObjAtScreenCoord:function(i,r){var a=this.getViewer().getTopmostBasicObjectAtCoord(i,r||0);return this._getAncestorSpectrumObj(a)},getActiveSpectrumViewAtScreenCoord:function(i){var r,a=this.getViewer();if(a.enableSpectrumInteraction()){var o=a.getViewerConfigs().getInteractionConfigs().getObjBoundTrackInflation()||0,l=this._getSpectrumObjAtScreenCoord(i,o);l&&(r=a.getSpectrumView(l))}return r},isTransformingSpectrum:function(){return!!this._transformInfo.currSpectrum}}),ClassEx.extendMethods(Kekule.ChemWidget.ViewerBasicInteractionController,{_beginInteractTransformAtCoord:function(i,r,a,o,l,u,c){i(r,a,o,l,u,c);var d=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(u));if(d){var h=d.getSpectrum();this._transformInfo.currSpectrum=h,this._transformInfo.spectrumActuallyTransformed=!1,this._transformInfo.initSpectrumViewportRanges=d.fetchViewportRanges()}else this._transformInfo.currSpectrum=void 0,this._transformInfo.initSpectrumViewportRanges=void 0},_endInteractTransform:function(i){this._transformInfo.currSpectrum=void 0,this._transformInfo.initSpectrumViewportRanges=void 0,i()},moveByXYDistance:function(i,r,a){var o=this.getViewer();if(!o.enableSpectrumInteraction())return i(r,a);var l=this._transformInfo;if(l&&l.isTransforming&&!l.calculating){var u=l.currSpectrum&&o.getSpectrumView(l.currSpectrum);if(!u)return i(r,a);l.calculating=!0;try{var c={x:r,y:a};if(!Kekule.CoordUtils.isEqual(c,l.lastCoord)){var d=Kekule.CoordUtils.substract(c,l.transformInitCoord),h=u.getClientScreenBox(),p=[d.x/(h.x2-h.x1),-d.y/(h.y2-h.y1)],g=u.getIsSpectrumWithReversedAxises()?[Kekule.VarDependency.DEPENDENT,Kekule.VarDependency.INDEPENDENT]:[Kekule.VarDependency.INDEPENDENT,Kekule.VarDependency.DEPENDENT];o.beginUpdate();try{for(var f=0,m=p.length;f<m;++f){var C=p[f],_=l.initSpectrumViewportRanges[g[f]]||{},y=_.rangeFrom||0,T=_.rangeTo||1,E=(T-y)*C;u.setViewportRange(g[f],y-E,T-E)}}finally{o.endUpdate()}l.lastCoord=c,l.spectrumActuallyTransformed=!0}}finally{l.calculating=!1}}},doZoomSpectrumViewer:function(i,r,a,o,l){var u=this.getViewer();if(u.enableSpectrumInteraction()){var c=u.getSpectrumView(r);c&&c.zoomViewportByDelta(a,o,l)}},_mayNeedSpectrumDataHotTrack:function(i,r,a){var o=r.getDisplayedDataModes();return a&&a.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataHotTrackOnMode",o)},_getSpectrumDataSelectCoordInflationRange:function(i,r,a){var o=a.getSpectrumDataPointSelectInflation(),l={x:o,y:o};return[Kekule.CoordUtils.substract(r,l),Kekule.CoordUtils.add(r,l)]},doTrySelectSpectrumData:function(i,r,a,o,l,u){var c=l;if(c){var d=null,h=u,p=c.getClientScreenBox();if(Kekule.CoordUtils.isInsideBox(r,p)){var g=this._getSpectrumDataSelectCoordInflationRange(r,h),f=c.calcSpectrumPrimaryDataValueInCoordRangeEx(g,Kekule.Render.CoordSystem.SCREEN);f&&(d={section:f.dataSection,dataValue:f.dataValue})}a&&h.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataMultiSelectOnMode",c.getDisplayedDataModes())?c.toggleSelectingState(d):c.select(d),o.requestRepaint()}},doTryHotTrackSpectrumData:function(i,r,a,o,l){var u=o,c=l,d=null,h=u.getClientScreenBox();if(Kekule.CoordUtils.isInsideBox(r,h)){var p=this._getSpectrumDataSelectCoordInflationRange(r,c),g=u.calcSpectrumPrimaryDataValueInCoordRangeEx(p,Kekule.Render.CoordSystem.SCREEN);g&&(d={section:g.dataSection,dataValue:g.dataValue})}u.setHotTrackedDataItemsEx(d&&[d])},doTryHotTrackBasicObject:function(i,r,a){var o=this.getViewer(),l=o.getDisplayerConfigs().getSpectrumViewConfigs(),u=this.getActiveSpectrumViewAtScreenCoord(r);return u&&o.getRenderType()===Kekule.Render.RendererType.R2D&&this._mayNeedSpectrumDataHotTrack(u,l)?this.doTryHotTrackSpectrumData(r,o,u,l):i(r,a)},doTrySelectBasicObject:function(i,r,a,o){var l=this.getViewer(),u=l.getDisplayerConfigs().getSpectrumViewConfigs(),c=this.getActiveSpectrumViewAtScreenCoord(r);return c&&l.getRenderType()===Kekule.Render.RendererType.R2D&&u.getDataModeSpecifiedBoolConfigValueOfModeList("enableSpectrumDataSelectOnMode",c.getDisplayedDataModes())?this.doTrySelectSpectrumData(r,a,l,c,u):i(r,a,o)},react_dblclick:function(i,r){if(this.needReactEvent(r)){var a=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(r));if(a){var o=this.getViewer();o.beginUpdate();try{a&&a.resetView()}finally{o.endUpdate()}}else i(r)}},react_pointerleave:function(i,r){return this.hideSpectrumUiMarkers(!0),i(r)},react_mousewheel:function(i,r){if(this.needReactEvent(r)){var a=this.getActiveSpectrumViewAtScreenCoord(this._getEventMouseCoord(r));if(a){var o=this.getViewer(),l=a.getSpectrum();this.hideSpectrumUiMarkers(!0);var u=o.getDisplayerConfigs().getSpectrumViewConfigs(),c=r.wheelDeltaY||r.wheelDelta;c&&(c/=120);var d=this._getEventMouseCoord(r),h=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(r,u);return this.doZoomSpectrumViewer(l,c,d,h),r.preventDefault(),!0}}return i(r)}}),ClassEx.extendMethods(Kekule.ChemWidget.ActionDisplayerZoomIn,{doExecute:function(i,r,a){var o=this.getDisplayer();if(o.isInSpectrumMode&&o.isInSpectrumMode()){var l=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(a,o.getDisplayerConfigs().getSpectrumViewConfigs()),u=o.getSpectrumView();u?u.zoomViewportByDelta(1,null,l):i()}else i()}}),ClassEx.extendMethods(Kekule.ChemWidget.ActionDisplayerZoomOut,{doExecute:function(i,r,a){var o=this.getDisplayer();if(o.isInSpectrumMode&&o.isInSpectrumMode()){var l=Kekule.ChemWidget.SpectrumViewUtils.getZoomDirectionsFromEvent(a,o.getDisplayerConfigs().getSpectrumViewConfigs()),u=o.getSpectrumView();u?u.zoomViewportByDelta(-1,null,l):i()}else i()}}),Kekule.ChemWidget.SpectrumCorrelationConnector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.SpectrumCorrelationConnector",initialize:function(i,r){this.reactLoadEventOnSpectrumViewerBind=this.reactLoadEventOnSpectrumViewer.bind(this),this.reactEventOnSpectrumViewerBind=this.reactEventOnSpectrumViewer.bind(this),this.reactEventOnMoleculeViewerBind=this.reactEventOnMoleculeViewer.bind(this),this.tryApplySuper("initialize"),i&&this.setSpectrumViewer(i),r&&this.setMoleculeViewer(r)},initProperties:function(){this.defineProp("spectrumViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:function(i){var r=this.getSpectrumViewer();r!==i&&(this.doSpectrumViewerChange(i,r),this.setPropStoreFieldValue("spectrumViewer",i))}}),this.defineProp("moleculeViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:function(i){var r=this.getMoleculeViewer();r!==i&&(this.doMoleculeViewerChange(i,r),this.setPropStoreFieldValue("moleculeViewer",i))}}),this.defineProp("autoLoadCorrelatedMolecule",{dataType:DataType.BOOL}),this.defineProp("fromSpectrumToMolecule",{dataType:DataType.BOOL}),this.defineProp("fromMoleculeToSpectrum",{dataType:DataType.BOOL}),this.defineProp("enabled",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoLoadCorrelatedMolecule(!0),this.setFromSpectrumToMolecule(!0),this.setFromMoleculeToSpectrum(!0),this.setEnabled(!0)},doFinalize:function(){this.setMoleculeViewer(null),this.setSpectrumViewer(null),this.tryApplySuper("doFinalize")},_getLoadedSpectrums:function(i){if(!i){var r=this.getSpectrumViewer();i=r&&r.getChemObj()}return i?i instanceof Kekule.Spectroscopy.Spectrum?[i]:i.filterChildren(function(a){return a&&a instanceof Kekule.Spectroscopy.Spectrum},!0):[]},_getRefMoleculesOfSpectrum:function(i){return i.getRefMolecules()||[]},_getDisplayedSpectrumDataSections:function(){for(var i=[],r=this._getLoadedSpectrums(),a=0,o=r.length;a<o;++a)if(r[a].getVisible()){var l=r[a].getDisplayedDataSections();i=i.concat(l)}return i},_getSpectrumDataItemAssignments:function(i,r){var a,o;return(o=typeof r=="number"?i.getExtraInfoAt(r):i.getExtraInfoOf(r))&&(o.getAssignments||o.assignments)&&(a=o.getAssignments()||o.assignments),a},_getDataItemsExOfCorrelatedMolObject:function(i,r){for(var a=[],o=[],l=0,u=r.length;l<u;++l){var c=r[l],d=c.getParentSpectrum(),h=a.indexOf(d);h<0&&(h=a.length,a.push(d),o[h]={spectrum:d,dataItemsEx:[]});var p=o[h].dataItemsEx;if(c.isPeakSection())for(l=0,u=c.getDataCount();l<u;++l){var g=this._getSpectrumDataItemAssignments(c,l);g&&g.length&&g.indexOf(i)>=0&&p.push({section:c,dataValue:c.getValueAt(l)})}}return o},doSpectrumViewerChange:function(i,r){r&&(r.removeEventListener("load",this.reactLoadEventOnSpectrumViewerBind),r.removeEventListener("hotTrackOnSpectrumData",this.reactEventOnSpectrumViewerBind),r.removeEventListener("spectrumDataSelectionChange",this.reactEventOnSpectrumViewerBind)),i&&(i.addEventListener("load",this.reactLoadEventOnSpectrumViewerBind),i.addEventListener("hotTrackOnSpectrumData",this.reactEventOnSpectrumViewerBind),i.addEventListener("spectrumDataSelectionChange",this.reactEventOnSpectrumViewerBind),this.doTryLoadSpectrumRefMoleculeInViewer(i.getChemObj()))},doMoleculeViewerChange:function(i,r){r&&(r.removeEventListener("hotTrackOnObjects",this.reactEventOnMoleculeViewerBind),r.removeEventListener("selectionChange",this.reactEventOnMoleculeViewerBind)),i&&(i.addEventListener("hotTrackOnObjects",this.reactEventOnMoleculeViewerBind),i.addEventListener("selectionChange",this.reactEventOnMoleculeViewerBind))},doSelectOrHotTrackSpectrumAssignments:function(i,r,a){for(var o,l=[],u=0,c=i.length;u<c;++u){var d=i[u];if(d instanceof Kekule.ChemStructureObject){var h=d.getRootFragment();if(h){if(o){if(o!==h)continue}else o=h;s.pushUnique(l,d)}}}var p=this.getMoleculeViewer();o&&p.getChemObj()!==o&&a&&this.doLoadMoleculeInViewer(o),r?p.setSelectedObjects(l):p.setHotTrackedObjects(l)},doSelectOrHotTrackSpectrumPeaks:function(i,r){var a=this._getDisplayedSpectrumDataSections(),o=new Kekule.MapEx;try{for(var l=[],u=[],c=0,d=i.length;c<d;++c){var h=this._getDataItemsExOfCorrelatedMolObject(i[c],a);if(h&&h.length)for(var p=0,g=h.length;p<g;++p){var f=h[p].spectrum;(_=o.get(f))||(l.push(f),_=[],o.set(f,_)),s.pushUnique(_,h[p].dataItemsEx),u.push({assignments:[i[c]],spectrum:f,dataSection:_.section,dataValue:_.dataValue})}}var m=!1,C=this.getSpectrumViewer();for(c=0,d=l.length;c<d;++c){var _=o.get(l[c]),y=C.getSubView(l[c],Kekule.ChemWidget.Viewer.SpectrumSubView,!0);if(y){r?y.setSelectedDataItemsEx(_):y.setHotTrackedDataItemsEx(_),m=!0;break}}m||(r?C.clearSelectedItems(null,!0):C.clearHotTrackedItems(null,!0)),this._invokeHotTrackOrSelectAssignmentPairEvent(u,r)}finally{o.finalize()}},_invokeHotTrackOrSelectAssignmentPairEvent:function(i,r){r?this.invokeEvent("assignmentSelected",{assignmentDetails:i}):this.invokeEvent("assignmentHotTracked",{assignmentDetails:i})},doLoadMoleculeInViewer:function(i){i&&i.setVisible(!0),this.getMoleculeViewer().setChemObj(i)},doTryLoadSpectrumRefMoleculeInViewer:function(i){if(this.getSpectrumViewer()&&this.getMoleculeViewer()&&this.getAutoLoadCorrelatedMolecule()){for(var r=this._getLoadedSpectrums(i)||[],a=null,o=0,l=r.length;o<l;++o){var u=this._getRefMoleculesOfSpectrum(r[o]);if(u.length){a=u[0];break}}this.doLoadMoleculeInViewer(a)}},reactLoadEventOnSpectrumViewer:function(i){this.getEnabled()&&this.doTryLoadSpectrumRefMoleculeInViewer(i.obj)},reactEventOnSpectrumViewer:function(i){if(this.getEnabled()&&this.getFromSpectrumToMolecule()&&!this._isReactingSpectrumViewerEvent){this._isReactingSpectrumViewerEvent=!0;try{for(var r=i.name,a=i.dataItems||[],o=[],l=[],u=0,c=a.length;u<c;++u){var d=a[u].section;if(d.isPeakSection()){var h=a[u].dataValue,p=this._getSpectrumDataItemAssignments(d,h);p&&(s.pushUnique(o,p),l.push({spectrum:d.getParentSpectrum(),dataSection:d,dataValue:h,assignments:p}))}}var g=r==="spectrumDataSelectionChange";this.doSelectOrHotTrackSpectrumAssignments(o,g,this.getAutoLoadCorrelatedMolecule()),this._invokeHotTrackOrSelectAssignmentPairEvent(l,g)}finally{this._isReactingSpectrumViewerEvent=!1}}},reactEventOnMoleculeViewer:function(i){if(this.getEnabled()&&this.getFromMoleculeToSpectrum()&&!this._isReactingMoleculeViewerEvent){this._isReactingMoleculeViewerEvent=!0;try{var r=i.name,a=i.objects||[];this.doSelectOrHotTrackSpectrumPeaks(a,r==="selectionChange")}finally{this._isReactingMoleculeViewerEvent=!1}}}}),Kekule.ChemWidget.SpectrumViewUtils={getZoomDirectionsFromEvent:function(i,r){var a=Kekule.Widget.KeyboardUtils,o=a.getKeyParamsFromEvent(i,!0);return a.matchKeyParams(o,a.createModifierKeyParamsFromArray(r.getSpectrumZoomSecondaryModifierKeys()),!0)?["y"]:a.matchKeyParams(o,a.createModifierKeyParamsFromArray(r.getSpectrumZoomBothModifierKeys()),!0)?["x","y"]:["x"]}}}})}(),function(){Kekule._registerAfterLoadSysProc(function(){if(Kekule.ChemWidget&&Kekule.Spectroscopy){Kekule.ObjUtils;var s=Kekule.ArrayUtils,e=Class.PropertyScope;Kekule.ChemWidget.ComponentWidgetNames=Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{changeSpectrumSection:"changeSpectrumSection",correlateSpectrumDataAndObject:"correlateSpectrumDataAndObject"});var t=Kekule.ChemWidget.ComponentWidgetNames;Kekule.globalOptions.add("chemWidget.spectrumInspector",{toolButtons:[t.loadData,t.saveData,t.changeSpectrumSection,t.zoomIn,t.zoomOut,t.reset,t.copy,t.config],assocViewerToolButtons:[t.saveData,t.copy],assocViewerSize:"25%",enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableGestureInteraction:!1}),Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{SPECTRUM_INSPECTOR:"K-SpectrumInspector",SPECTRUM_INSPECTOR_ASSOC_LEADING:"K-SpectrumInspector-AssocLeading",SPECTRUM_INSPECTOR_ASSOC_TAILING:"K-SpectrumInspector-AssocTailing",SPECTRUM_INSPECTOR_IN_EDITING:"K-SpectrumInspector-Editing",SPECTRUM_INSPECTOR_CLIENT:"K-SpectrumInspector-Client",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER:"K-SpectrumInspector-ClientComponentHolder",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_SPECTRUM_VIEWER:"K-SpectrumInspector-ClientComponentHolder-SpectrumViewer",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_ASSOC_VIEWER:"K-SpectrumInspector-ClientComponentHolder-AssocViewer",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_MODIFIER_PANEL:"K-SpectrumInspector-ClientComponentHolder-ModifierPanel",SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_HIDDEN_CANVAS:"K-SpectrumInspector-ClientComponentHolder-HiddenCanvas",SPECTRUM_INSPECTOR_SPECTRUM_VIEWER:"K-SpectrumInspector-SpectrumViewer",SPECTRUM_INSPECTOR_ASSOC_VIEWER:"K-SpectrumInspector-AssocViewer",SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM:"K-SpectrumInspector-MenuItem-Spectrum",SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM_DATASECTION:"K-SpectrumInspector-MenuItem-SpectrumDataSection",ACTION_SPECTRUM_INSPECTOR_CHANGE_SECTION:"K-SpectrumInspector-Change-Section",ACTION_SPECTRUM_INSPECTOR_CORRELATOR:"K-SpectrumInspector-Correlator"});var n=Kekule.Widget.HtmlClassNames,i=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.SpectrumInspector=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector",SPECTRUM_SELECT_MENU_SPECTRUM_FIELD:"__$spectrumIndex$__",SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD:"__$spectrumDataSectionIndex$__",initialize:function(o){this._spectrumViewerSetChemObjOverwriteBind=this._spectrumViewerSetChemObjOverwrite.bind(this),this._spectrumViewerCreateToolButtonOverwriteBind=this._spectrumViewerCreateToolButtonOverwrite.bind(this),this._spectrumViewerGetSavingTargetObjOverwriteBind=this._spectrumViewerGetSavingTargetObjOverwrite.bind(this),this._reactChildViewerShowStateChangeBind=this._reactChildViewerShowStateChange.bind(this),this.setPropStoreFieldValue("autoSyncUiMarkerStyles",!0),this.setPropStoreFieldValue("assocViewerVisualMode",r.AUTO),this.tryApplySuper("initialize",[o])},initProperties:function(){this.defineProp("spectrumViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null}),this.defineProp("assocViewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null}),this.defineProp("correlationConnector",{dataType:"Kekule.ChemWidget.SpectrumCorrelationConnector",serializable:!1,setter:null}),this.defineProp("autoSyncUiMarkerStyles",{dataType:DataType.BOOL,setter:function(o){o!=this.getAutoSyncUiMarkerStyles()&&(this.setPropStoreFieldValue("autoSyncUiMarkerStyles",!!o),o&&this.syncHotTrackAndSelectStylesBetweenViewers())}}),this.defineProp("assocViewerVisualMode",{dataType:DataType.INT,enumSource:Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode,setter:function(o){var l=this.getAssocViewerVisualMode();o!==l&&(this.setPropStoreFieldValue("assocViewerVisualMode",o),this.doAssocViewerVisualModeChange(o,l))}}),this.defineProp("autoShowHideAssocViewer",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getAssocViewerVisualMode()===r.AUTO},setter:function(o){var l=!!o;if(l!==this.getAutoShowHideAssocViewer())if(l)this.setAssocViewerVisualMode(r.AUTO);else{var u=this.getAssocViewer(),c=u&&u.isShown();this.setAssocViewerVisualMode(c?r.VISIBLE:r.INVISIBLE)}}}),this.defineProp("assocViewerPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(o){this.setPropStoreFieldValue("assocViewerPosition",o),this.doChangeAssocViewerPosition(o)}}),this.defineProp("assocViewerSize",{dataType:DataType.STRING,getter:function(){var o=this.getClientComponentHolderElems(),l=o&&o.assocViewer;return l&&this.getStyleProperty("flexBasis",l)},setter:function(o){var l=this.getClientComponentHolderElems(),u=l&&l.assocViewer;u&&this.setStyleProperty("flexBasis",o,u)}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,setter:function(o){var l=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",o),this.chemObjChanged(o,l)}}),this.defineProp("spectrums",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){return this.getPropStoreFieldValue("spectrums")||[]}}),this.defineProp("activeSpectrum",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getSpectrums()[this.getActiveSpectrumIndex()]},setter:function(o){var l=this.getSpectrums().indexOf(o);this.setActiveSpectrumIndex(l)}}),this.defineProp("activeSpectrumIndex",{dataType:DataType.INT,serializable:!1,setter:function(o){var l=this.getActiveSpectrum();this.setPropStoreFieldValue("activeSpectrumIndex",o);var u=this.getActiveSpectrum();this.activeSpectrumChanged(u,l)}}),this.defineProp("activeDataSection",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var o=this.getActiveSpectrum();return o&&o.getActiveDataSection()},setter:function(o){var l=this.getActiveSpectrum();if(l){var u=l.indexOfDataSection(o);u>=0&&this.setActiveDataSectionIndex(u)}}}),this.defineProp("activeDataSectionIndex",{dataType:DataType.INT,serializable:!1,setter:function(o){var l=this.getActiveSpectrum();if(l){var u=this.getActiveDataSection();l.setActiveDataSectionIndex(o);var c=l.getActiveDataSection();u!=c&&this.activeSpectrumDataSectionChanged(c,u)}}}),this.defineProp("spectrumViewportRanges",{dataType:DataType.HASH,serializable:!1,getter:function(){var o=this.getSpectrumSubView();return o&&o.getViewportRanges()},setter:function(o){var l=this.getSpectrumSubView();l&&(l.setViewportRanges(o),l.applyToRenderOptions())}}),this.defineProp("backgroundColor",{dataType:DataType.STRING,scope:e.PUBLISHED,setter:function(o){this.setPropStoreFieldValue("backgroundColor",o);var l=this.getSpectrumViewer();l&&l.setBackgroundColor(o);var u=this.getAssocViewer();u&&u.setBackgroundColor(o)}}),this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("clientComponentHolderElems",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("spectrumDataSectionSelectMenu",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("enableHotTrack",{dataType:DataType.BOOL,setter:function(o){var l=!!o;this._applyEnablePropertyToChildViewerConfigs("enableHotTrack",l),this.setPropStoreFieldValue("enableHotTrack",l)}}),this.defineProp("enableSelect",{dataType:DataType.BOOL,setter:function(o){var l=!!o;this._applyEnablePropertyToChildViewerConfigs("enableSelect",l),this.setPropStoreFieldValue("enableSelect",l)}}),this.defineProp("enableMultiSelect",{dataType:DataType.BOOL,setter:function(o){var l=!!o;this._applyEnablePropertyToChildViewerConfigs("enableMultiSelect",l),this.setPropStoreFieldValue("enableMultiSelect",l)}}),this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL,setter:function(o){var l=!!o;this._applyPropertyToChildViewerProperty("enableDirectInteraction",l),this.setPropStoreFieldValue("enableDirectInteraction",l)}}),this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL,setter:function(o){var l=!!o;this._applyPropertyToChildViewerProperty("enableTouchInteraction",l),this.setPropStoreFieldValue("enableTouchInteraction",l)}}),this.defineProp("enableGestureInteraction",{dataType:DataType.BOOL,setter:function(o){var l=!!o;this._applyPropertyToChildViewerProperty("enableGesture",l),this.setPropStoreFieldValue("enableGesture",l)}}),this.defineProp("enableEdit",{dataType:DataType.BOOL,scope:e.PRIVATE}),this.defineProp("isEditing",{dataType:DataType.BOOL,serializable:!1,setter:null,scope:e.PRIVATE}),this._defineSubWidgetDelegatedProperties(["autoLoadCorrelatedMolecule",["enableOperationFromSpectrumToMolecule","fromSpectrumToMolecule"],["enableOperationFromMoleculeToSpectrum","fromMoleculeToSpectrum"]],"correlationConnector"),this._defineSubWidgetDelegatedProperties(["viewerConfigs","enableHotKey","toolButtons","toolbar","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","toolbarParentElem","menuItems","menu","caption","showCaption","captionPos","autoCaption","captionElem","renderConfigs","enableLoadNewFile","allowedInputFormatIds","allowedOutputFormatIds","resetAfterLoad","zoom","initialZoom","padding","chemObjData","chemObjLoaded",["spectrumViewerConfigs","viewerConfigs"],["spectrumViewerRenderConfigs","renderConfigs"],["spectrumViewerDrawOptions","drawOptions"],["spectrumViewerbackgroundColor","backgroundColor"]],"spectrumViewer"),this._defineSubWidgetDelegatedProperties([["assocViewerConfigs","viewerConfigs"],["assocViewerbackgroundColor","backgroundColor"],["assocViewerAllowedMolDisplayTypes","allowedMolDisplayTypes"],["assocViewerRenderConfigs","renderConfigs"],["assocViewerDrawOptions","drawOptions"],["assocViewerAllowCoordBorrow","allowCoordBorrow"],["assocViewerAutoSize","autoSize"],["assocViewerAutofit","autofit"],["assocViewerAutoShrink","autoShrink"]],"assocViewer")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableHotTrack(!0).setEnableSelect(!0).setEnableMultiSelect(!1).setUseCornerDecoration(!0);var o=Kekule.oneOf,l=Kekule.globalOptions.get("chemWidget.spectrumInspector")||{};this.setEnableToolbar(o(l.enableToolbar,!0)).setEnableDirectInteraction(o(l.enableDirectInteraction,!0)).setEnableTouchInteraction(o(l.enableTouchInteraction,!0)).setEnableGestureInteraction(o(l.enableGestureInteraction,!0))},doFinalize:function(){this._finalizeSubWidgets(),this.tryApplySuper("doFinalize")},_finalizeSubWidgets:function(){var o=this.getCorrelationConnector();o&&o.finalize();var l=this.getSpectrumDataSectionSelectMenu();l&&l.finalize();var u=this.getAssocViewer();u&&u.finalize();var c=this.getSpectrumViewer();c&&c.finalize()},_defineSubWidgetDelegatedMethods:function(o,l){l||(l="spectrumViewer");for(var u,c,d=ClassEx.getPrototype(this.getClass()),h=0,p=o.length;h<p;++h){var g=o[h];s.isArray(g)?(u=g[0],c=g[1]):u=g,c||(c=u),d[u]=function(){var f=this.getPropValue(l),m=f[c].apply(f,arguments);return m===f&&(m=this),m}}},_defineSubWidgetDelegatedProperties:function(o,l){l||(l="spectrumViewer");for(var u,c,d=this.getPropInfo(l),h=ClassEx.findClass(d.dataType),p=this,g=0,f=o.length;g<f;++g){var m=o[g];c=null,s.isArray(m)?(u=m[0],c=m[1]):u=m,c||(c=u),function(C,_,y){var T=ClassEx.getPropInfo(C,y),E=Object.create(T);E.getter=null,E.setter=null,E.serializable=!1,T.getter&&(E.getter=function(){var b=this.getPropValue(l);return b?b.getPropValue(y):void 0}),T.setter&&(E.setter=function(b){var v=this.getPropValue(l);v&&v.setPropValue(y,b)}),p.defineProp(_,E)}(h,u,c)}},doObjectChange:function(o){var l=this.tryApplySuper("doObjectChange",[o]),u=this.getAssocViewer();if(u)for(var c=s.intersect(o,["toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","enableToolbar","enableHotKey"]),d=0,h=c.length;d<h;++d)u.setPropValue(c[d],this.getPropValue(c[d]));return l},loadPredefinedResDataToProp:function(o,l,u){if(o==="chemObj")if(u){var c=Kekule.IO.loadTypedData(l.data,l.resType,l.resUri);this.setChemObj(c)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+l.resUri||"")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+i.SPECTRUM_INSPECTOR},canUsePlaceHolderOnElem:function(o){var l=o.getAttribute("src");return o.tagName.toLowerCase()==="img"&&!!l},doSetElement:function(o){var l=o;return l&&l.tagName.toLowerCase()==="img"&&(l=Kekule.DomUtils.replaceTagName(l,"span")),this.tryApplySuper("doSetElement",[l])},getChildrenHolderElement:function(){return this.getClientElem()},doCreateRootElement:function(o){return o.createElement("span")},doCreateSubElements:function(o,l){var u=this.tryApplySuper("doCreateSubElements",[o,l]);this._finalizeSubWidgets();var c=this._createClientElem(o,l);this.setPropStoreFieldValue("clientElem",c),u.push(c);var d={spectrumViewer:this._createClientComponentHolderElem(o,c,i.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_SPECTRUM_VIEWER),modifierPanel:this._createClientComponentHolderElem(o,c,i.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_MODIFIER_PANEL),assocViewer:this._createClientComponentHolderElem(o,c,i.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_ASSOC_VIEWER),hiddenCanvas:this._createClientComponentHolderElem(o,c,i.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER_HIDDEN_CANVAS)};this.setPropStoreFieldValue("clientComponentHolderElems",d),this.setPropStoreFieldValue("spectrumDataSectionSelectMenu",this._createSpectrumDataSectionSelectMenu());var h=this._createSubSpectrumViewer(d.spectrumViewer);this.setPropStoreFieldValue("spectrumViewer",h),h.setToolButtons(this.getDefaultToolBarButtons()).setEnableToolbar(!0);var p=this._createSubAssocViewer(d.assocViewer);this.setPropStoreFieldValue("assocViewer",p);var g=Kekule.globalOptions.get("chemWidget.spectrumInspector")||{};return Kekule.ObjUtils.notUnset(g.assocViewerSize)&&this.setAssocViewerSize(g.assocViewerSize),this._applyAllEnablePropertiesToChildViewerConfigs(),this._createCorrelationConnector(h,p),u},_createClientElem:function(o,l){var u=o.createElement("div");return u.className=i.SPECTRUM_INSPECTOR_CLIENT,l.appendChild(u),u},_createClientComponentHolderElem:function(o,l,u){var c=o.createElement("div"),d=i.SPECTRUM_INSPECTOR_CLIENT_COMPONENT_HOLDER;return u&&(d+=" "+u),c.className=d,l.appendChild(c),c},_createCorrelationConnector:function(o,l){var u=this,c=new Kekule.ChemWidget.SpectrumCorrelationConnector(o,l);c.addEventListener("assignmentSelected",function(d){u.getSpectrumViewer().updateActions(),u.invokeEvent("spectrumAssignmentSelected",{assignmentDetails:d.assignmentDetails})}),c.addEventListener("assignmentHotTracked",function(d){u.invokeEvent("spectrumAssignmentHotTracked",{assignmentDetails:d.assignmentDetails})}),this.setPropStoreFieldValue("correlationConnector",c)},_createSubSpectrumViewer:function(o){var l=new Kekule.ChemWidget.Viewer2D(this,null,Kekule.Render.RendererType.R2D);this._overwriteSubSpectrumViewerMethods(l),l.setViewerConfigs(new Kekule.ChemWidget.ViewerConfigs),l.setPadding(20),l.setUseCornerDecoration(!1).setBackgroundColor(this.getBackgroundColor()),l.addClassName(i.SPECTRUM_INSPECTOR_SPECTRUM_VIEWER);var u=this;return l.addEventListener("showStateChange",this._reactChildViewerShowStateChangeBind),l.addEventListener("load",function(c){c.widget===u.getSpectrumViewer()&&u.invokeEvent("loadSpectrum",{spectrum:c.obj})}),l.appendToElem(o),l},_overwriteSubSpectrumViewerMethods:function(o){o.overwriteMethod("doSetChemObj",this._spectrumViewerSetChemObjOverwriteBind),o.overwriteMethod("createToolButton",this._spectrumViewerCreateToolButtonOverwriteBind),o.overwriteMethod("getSavingTargetObj",this._spectrumViewerGetSavingTargetObjOverwriteBind),o.overwriteMethod("getDefaultToolBarButtons",this.getDefaultToolBarButtons.bind(this))},_createSubAssocViewer:function(o){var l=new Kekule.ChemWidget.Viewer(this);l.setViewerConfigs(new Kekule.ChemWidget.ViewerConfigs);var u=l.getViewerConfigs().getInteractionConfigs();u.setEnableBasicObjectHotTrack(!0),u.setEnableBasicObjectSelect(!0),u.setEnableBasicObjectMultiSelect(!0),l.addClassName(i.SPECTRUM_INSPECTOR_ASSOC_VIEWER),l.setAutoShrink(!0),l.setToolButtons(Kekule.globalOptions.chemWidget.spectrumInspector.assocViewerToolButtons).setEnableToolbar(!0),l.setUseCornerDecoration(!1).setBackgroundColor(this.getBackgroundColor()),l.setDisplayed(!1),l.addEventListener("load",this._reactAssocViewerLoad.bind(this));var c=this;return l.addEventListener("showStateChange",this._reactChildViewerShowStateChangeBind),l.addEventListener("load",function(d){d.widget===c.getAssocViewer()&&c.invokeEvent("loadAssoc",{obj:d.obj})}),l.appendToElem(o),l},_reactAssocViewerLoad:function(o){var l=this.getAssocViewer();o.widget===l&&this.getAutoShowHideAssocViewer()&&this.doAutoShowHideAssocViewer()},doChangeAssocViewerPosition:function(o){var l=Kekule.Widget.Position;o&l.BOTTOM||o&l.RIGHT?(this.removeClassName(i.SPECTRUM_INSPECTOR_ASSOC_LEADING),this.addClassName(i.SPECTRUM_INSPECTOR_ASSOC_TAILING)):(this.removeClassName(i.SPECTRUM_INSPECTOR_ASSOC_TAILING),this.addClassName(i.SPECTRUM_INSPECTOR_ASSOC_LEADING))},getAssocViewerActualPosition:function(){var o=Kekule.Widget.Layout,l=Kekule.Widget.Position,u=this.getLayout(),c=this.getAssocViewerPosition();return u===o.VERTICAL?c&l.BOTTOM||c&l.RIGHT?l.BOTTOM:l.TOP:c&l.BOTTOM||c&l.RIGHT?l.RIGHT:l.LEFT},doAssocViewerVisualModeChange:function(o,l){var u=this.getAssocViewer();if(u){var c=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode;if(o===c.AUTO)this.doAutoShowHideAssocViewer();else if(o===c.VISIBLE||o===c.INVISIBLE){var d=o===c.VISIBLE;u.setDisplayed(d),d&&u.setVisible(d)}}},doAutoShowHideAssocViewer:function(){var o=this.getAssocViewer();if(o){var l=!!o.getChemObj();o.setDisplayed(l),l&&o.setVisible(l),Kekule.StyleUtils.setDisplay(this.getClientComponentHolderElems().assocViewer,l)}},_reactChildViewerShowStateChange:function(o){var l,u=o.isShown;o.widget===this.getAssocViewer()?l=this.getClientComponentHolderElems().assocViewer:o.widget===this.getSpectrumViewer()&&(l=this.getClientComponentHolderElems().spectrumViewer),l&&Kekule.StyleUtils.setDisplay(l,!!u)},_createSpectrumDataSectionSelectMenu:function(){var o=new Kekule.Widget.PopupMenu(this);return o.addClassName(n.DYN_CREATED),o.setDisplayed(!1),o.addEventListener("execute",this._reactSpectrumDataSectionSelectMenuItemExecute.bind(this)),o},_reactSpectrumDataSectionSelectMenuItemExecute:function(o){var l=o.widget,u=l[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD],c=l[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD],d=this.getSpectrumViewer();d.beginUpdate();try{u!==this.getActiveSpectrum()?(u.setActiveDataSection(c||u.getDataSectionAt(0)),this.setActiveSpectrum(u)):c&&c!==this.getActiveDataSection()&&this.setActiveDataSection(c)}finally{d.endUpdate()}},_refillSpectrumDataSectionSelectMenu:function(){var o=this.getSpectrums(),l=this.getSpectrumDataSectionSelectMenu();l.clearMenuItems();for(var u=0,c=o.length;u<c;++u){var d=o[u],h=d.getDataSectionCount(),p=this._getSpectrumTexts(d,u,c,!0);if(!(h<=0))if(h<=1){(m=this._getSpectrumDataSectionTexts(d,d.getDataSectionAt(0),0,h,!1)).caption&&(p.caption=p.caption+" - "+m.caption),m.hint&&(p.hint=p.hint+" - "+m.hint);var g=this._createSpectrumDataSectionSelectMenuSubItem(l,d,d.getDataSectionAt(0),p.caption,p.hint,i.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM);l.appendMenuItem(g)}else{g=this._createSpectrumDataSectionSelectMenuSubItem(l,d,null,p.caption,p.hint,i.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM),l.appendMenuItem(g);for(var f=0;f<h;++f){var m=this._getSpectrumDataSectionTexts(d,d.getDataSectionAt(f),f,h,!0);g=this._createSpectrumDataSectionSelectMenuSubItem(l,d,d.getDataSectionAt(f),m.caption,m.hint,i.SPECTRUM_INSPECTOR_MENU_ITEM_SPECTRUM_DATASECTION),l.appendMenuItem(g)}}}return this._updateSpectrumDataSectionSelectMenuCheckState(),l},_updateSpectrumDataSectionSelectMenuCheckState:function(){for(var o=this.getActiveSpectrum(),l=o&&o.getActiveDataSection(),u=this.getSpectrumDataSectionSelectMenu().getMenuItems(),c=0,d=u.length;c<d;++c){var h=u[c],p=h[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD],g=h[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD];p===o&&g===l?h.setChecked(!0):h.setChecked(!1)}},_createSpectrumDataSectionSelectMenuSubItem:function(o,l,u,c,d,h){var p=new Kekule.Widget.MenuItem(o,c);return p.addClassName(h),p[this.SPECTRUM_SELECT_MENU_SPECTRUM_FIELD]=l,p[this.SPECTRUM_SELECT_MENU_SPECTRUM_DATA_SECTION_FIELD]=u,p},_getSpectrumTexts:function(o,l,u,c){var d=o.getTitle()||o.getName();return!d&&c&&(d=this._getDefaultSpectrumCaption(o,l,u)),{caption:d,hint:d}},_getDefaultSpectrumCaption:function(o,l,u){return Kekule.$L("ChemWidgetTexts.CAPTION_SPECTRUM_WITH_INDEX").format(l+1)},_getSpectrumDataSectionTexts:function(o,l,u,c,d){var h=l.getTitle()||l.getName();return!h&&d&&(h=this._getDefaultSpectrumDataSectionCaption(o,l,u,c)),{caption:h,hint:h}},_getDefaultSpectrumDataSectionCaption:function(o,l,u,c){return Kekule.$L("ChemWidgetTexts.CAPTION_SPECTRUM_DATASECTION_WITH_INDEX").format(u+1)},_spectrumViewerSetChemObjOverwrite:function(o,l){this._isLoadingFromSubSpectrumViewer?o(l):this.load(l)},_spectrumViewerCreateToolButtonOverwrite:function(o,l,u){if(this._isCompActionDelegatableToSpectrumViewer(l)){this.getChildActionClass(l);var c=new(l===t.changeSpectrumSection?Kekule.Widget.DropDownButton:Kekule.Widget.Button)(u),d=this._getActionOfComp(l,!0);return d&&c.setAction(d),l===t.changeSpectrumSection&&c.setDropDownWidget(this.getSpectrumDataSectionSelectMenu()),c}return o(l,u)},_spectrumViewerGetSavingTargetObjOverwrite:function(o){return this.getChemObj()},_isCompActionDelegatableToSpectrumViewer:function(o){return[t.changeSpectrumSection,t.correlateSpectrumDataAndObject,t.reset,t.config].indexOf(o)>=0},_getActionOfComp:function(o,l,u){if(this._isCompActionDelegatableToSpectrumViewer(o)){var c=this.getSpectrumViewer(),d=c.getActionMap(),h=d.get(o);if(!h&&l){var p=this.getChildActionClass(o)||u;p&&(h=new p(this),d.set(o,h),c.getActions().add(h))}return h}return null},getDefaultToolBarButtons:function(){return Kekule.globalOptions.chemWidget.spectrumInspector.toolButtons},getSpectrumBaseClass:function(){return Kekule.Spectroscopy.Spectrum},chemObjChanged:function(o,l){var u=this.getSpectrumBaseClass();if(o){var c;c=o instanceof u?[o]:o.filterChildren(function(h){return h&&h instanceof u});var d=this.getSpectrums();this.invokeEvent("load",{obj:o,spectrums:c||[]}),this.spectrumsChanged(c,d)}else d=this.getSpectrums(),this.spectrumsChanged([],d)},spectrumsChanged:function(o,l){this.setPropStoreFieldValue("spectrums",o),this.setActiveSpectrumIndex(0),this._refillSpectrumDataSectionSelectMenu()},activeSpectrumChanged:function(o,l){this._loadInSpectrumViewer(o),this._updateSpectrumDataSectionSelectMenuCheckState(),this.getAutoSyncUiMarkerStyles()&&this.syncHotTrackAndSelectStylesBetweenViewers()},activeSpectrumDataSectionChanged:function(o,l){o!=l&&(this._repaintSpectrumViewer(),this._updateSpectrumDataSectionSelectMenuCheckState(),this.getAutoSyncUiMarkerStyles()&&this.syncHotTrackAndSelectStylesBetweenViewers())},_loadInSpectrumViewer:function(o){this._isLoadingFromSubSpectrumViewer=!0;try{this.getSpectrumViewer().load(o)}finally{this._isLoadingFromSubSpectrumViewer=!1}},_repaintSpectrumViewer:function(){this.getSpectrumViewer().requestRepaint()},getSpectrumViewerConfigs:function(){var o=this.getSpectrumViewer();return o&&o.getViewerConfigs()},getAssocViewerConfigs:function(){var o=this.getAssocViewer();return o&&o.getViewerConfigs()},_applyPropertyToChildViewerProperty:function(o,l){var u=this.getSpectrumViewer();u&&u.setPropValue(o,l),(u=this.getAssocViewer())&&u.setPropValue(o,l)},_applyEnablePropertyToChildViewerConfigs:function(o,l){var u,c;if(o==="enableHotTrack"?(u="enableSpectrumDataHotTrackOnMode",c="enableBasicObjectHotTrack"):o==="enableSelect"?(u="enableSpectrumDataSelectOnMode",c="enableBasicObjectSelect"):o==="enableMultiSelect"&&(u="enableSpectrumDataMultiSelectOnMode",c="enableBasicObjectMultiSelect"),u&&c){var d=this.getSpectrumViewerConfigs(),h=d&&d.getSpectrumViewConfigs(),p=d&&d.getInteractionConfigs(),g=this.getAssocViewerConfigs(),f=g&&g.getInteractionConfigs();if(f&&f.setPropValue(c,l),p&&p.setPropValue(c,l),h){var m=h.getPropValue(u);m?m.default=l:h.setPropValue({default:l})}}},_applyAllEnablePropertiesToChildViewerConfigs:function(){for(var o=["enableSelect","enableMultiSelect","enableHotTrack"],l=0,u=o.length;l<u;++l){var c=o[l],d=this.getPropValue(c);this._applyEnablePropertyToChildViewerConfigs(c,d)}},syncHotTrackAndSelectStylesBetweenViewers:function(){var o=this.getActiveDataSection();if(o){var l,u,c=this.getSpectrumViewer().getViewerConfigs().getSpectrumViewConfigs(),d=this.getAssocViewer().getViewerConfigs().getUiMarkerConfigs(),h=o.getMode(),p=c.getDataModeSpecifiedConfigValue("spectrumDataHotTrackUiMarkersOnMode",h)&&c.getDataModeSpecifiedConfigValue("spectrumHotTrackDataPointMarkerDrawStyles",h),g=c.getDataModeSpecifiedConfigValue("spectrumDataSelectUiMarkersOnMode",h)&&c.getDataModeSpecifiedConfigValue("spectrumSelectDataPointMarkerDrawStyles",h);h===Kekule.Spectroscopy.DataMode.PEAK&&(l=c.getSpectrumPeakHotTrackStyles(),u=c.getSpectrumPeakSelectStyles());var f={opacity:0,color:"transparent"};p?d.setHotTrackMarkerStyles(Object.extend({},p)):d.setHotTrackMarkerStyles(f),g?d.setSelectionMarkerStyles(Object.extend({},g)):d.setSelectionMarkerStyles(f),l?d.setHotTrackedObjectStyles(Object.extend({nodeDisplayMode:Kekule.Render.NodeLabelDisplayMode.SHOWN},l)):d.setHotTrackedObjectStyles({}),u?d.setSelectedObjectStyles(Object.extend({nodeDisplayMode:Kekule.Render.NodeLabelDisplayMode.SHOWN},u)):d.setSelectedObjectStyles({})}},getSpectrumSubView:function(){var o=this.getSpectrumViewer();return o&&o.getSubView(this.getActiveSpectrum(),Kekule.ChemWidget.Viewer.SpectrumSubView,!0)},resetDisplay:function(){var o;(o=this.getSpectrumViewer())&&o.resetDisplay(),(o=this.getAssocViewer())&&o.resetDisplay()},load:function(o){return this.doLoad(o)},doLoad:function(o){this.setChemObj(o)},loadFromData:function(o,l,u,c,d){try{var h;return o?(c?h=Kekule.IO.loadFormatData(o,c):(l||u)&&(h=Kekule.IO.loadTypedData(o,l,u)),h?this.load(h):Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED")),h):(this.setChemObj(null),null)}catch(p){this.reportException(p)}},loadFromFile:function(o){if(o){var l=this;try{Kekule.IO.loadFileData(o,function(u,c){c&&l.load(u)})}catch(u){this.reportException(u)}}else this.setChemObj(null)},getSavingTargetObj:function(){return this.getChemObj()},saveData:function(o,l,u){u=u||this.getSavingTargetObj(),this.prepareSaveData(u);var c=Kekule.IO.ChemDataWriterManager.getWriterByFormat(o,null,u);return c?(l||(l=Kekule.IO.DataFormatsManager.getFormatInfo(o).dataType),c.writeData(u,l,o)):(Kekule.error(Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")),null)},prepareSaveData:function(o){},getSelectedSpectrumDataItemsEx:function(){var o=this.getSpectrumSubView();return o&&o.getSelectedDataItemsEx()},getSelectedSpectrumDataItems:function(){var o=this.getSpectrumSubView();return o&&o.getSelectedDataItems()},getSelectedAssocObjects:function(){return this.getAssocViewer()&&this.getAssocViewer().getSelectedObjects()},doSetSpectrumDataAssignments:function(o,l){if(!(o&&o.length&&l&&l.length))return this;for(var u=0,c=o.length;u<c;++u){var d=o[u].dataValue,h=o[u].section,p=h.getExtraInfoOf(d);p&&p.setAssignments?p.setAssignments(l):((p=Kekule.Spectroscopy.Utils.createDefaultDataExtraInfoObject(h)).setAssignments(l),h.setExtraInfoOf(d,p))}return this},setSpectrumDataAssignmentsBySelectedObjects:function(){var o=this.getSelectedSpectrumDataItemsEx(),l=this.getSelectedAssocObjects();return this.doSetSpectrumDataAssignments(o,l)},exportToDataUriAsync:function(o,l,u){var c=l||{},d=this.getSpectrumViewer(),h=this.getAssocViewer();if(h.isShown())if(d.isShown()){var p=h.exportToDataUri(o,c),g=d.exportToDataUri(o,c),f=this.getAssocViewerActualPosition(),m=this._calcSubViewerOffsetsAndDimensionsForExportDataUri(d,h,f),C=this.getClientComponentHolderElems().hiddenCanvas,_=d.getDrawBridge(),y=_.createContext(C,m.totalDimension.width,m.totalDimension.height),T={},E=function(R,N){if(T[R]=N,!N){v();var L=R==="assocViewer"?Kekule.$L("ErrorMsg.FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_ASSOC"):Kekule.$L("ErrorMsg.FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_SPECTRUM");Kekule.warn(L)}T.spectrumViewer&&T.assocViewer&&b()},b=function(){var R=_.exportToDataUri(y,o,c);u&&u(R,m.totalDimension),v()},v=function(){y&&_.releaseContext(y),y=null};_.drawImage(y,g,m.spectrumViewerOffset,{x:m.spectrumViewerDimension.width,y:m.spectrumViewerDimension.height},{},function(R){E("spectrumViewer",R)}),_.drawImage(y,p,m.assocViewerOffset,{x:m.assocViewerDimension.width,y:m.assocViewerDimension.height},{},function(R){E("assocViewer",R)})}else I=h.isShown()?h.exportToDataUri(o,c):"",u(I,h.getContextDimension());else{var I=d.isShown()?d.exportToDataUri(o,c):"";u(I,d.getContextDimension())}},_calcSubViewerOffsetsAndDimensionsForExportDataUri:function(o,l,u){var c,d,h,p=l.getContextDimension(),g=o.getContextDimension(),f=Kekule.Widget.Position;return u&f.TOP?(c={x:0,y:0},d={x:0,y:p.height},h={width:Math.max(g.width,p.width),height:g.height+p.height}):u&f.BOTTOM?(c={x:0,y:g.height},d={x:0,y:0},h={width:Math.max(g.width,p.width),height:g.height+p.height}):u&f.RIGHT?(c={x:g.width,y:0},d={x:0,y:0},h={width:g.width+p.width,height:Math.max(g.height,p.height)}):(c={x:0,y:0},d={x:p.width,y:0},h={width:g.width+p.width,height:Math.max(g.height,p.height)}),{spectrumViewerOffset:d,assocViewerOffset:c,spectrumViewerDimension:g,assocViewerDimension:p,totalDimension:h}},repaint:function(o){var l=this.getSpectrumViewer();l&&l.repaint(o),(l=this.getAssocViewer())&&l.repaint(o)},requestRepaint:function(o){var l=this.getSpectrumViewer();l&&l.requestRepaint(o),(l=this.getAssocViewer())&&l.requestRepaint(o)},beginEditing:function(){return this.getEnableEdit()&&this.doBeginEditing(),this},doBeginEditing:function(){this.getCorrelationConnector().setEnabled(!1),this.__enablePropValueStorage__={enableHotTrack:this.getEnableHotTrack(),enableSelect:this.getEnableSelect(),enableMultiSelect:this.getEnableMultiSelect()},this.setEnableHotTrack(!0),this.setEnableSelect(!0),this.setEnableMultiSelect(!0),this.addClassName(i.SPECTRUM_INSPECTOR_IN_EDITING),this.setPropStoreFieldValue("isEditing",!0)},endEditing:function(){this.getIsEditing()&&this.doEndEditing()},doEndEditing:function(){var o=this.__enablePropValueStorage__;o&&(this.setEnableHotTrack(o.enableHotTrack),this.setEnableSelect(o.enableSelect),this.setEnableMultiSelect(o.enableMultiSelect)),this.getCorrelationConnector().setEnabled(!0),this.removeClassName(i.SPECTRUM_INSPECTOR_IN_EDITING),this.setPropStoreFieldValue("isEditing",!1)}}),Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode={VISIBLE:1,INVISIBLE:2,AUTO:0};var r=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode;Kekule.ChemWidget.SpectrumInspector.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector.Settings",initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile","enableHotTrack","enableSelect","enableMultiSelect","enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","autoSyncUiMarkerStyles","assocViewerVisualMode","assocViewerPosition","enableOperationFromSpectrumToMolecule","enableOperationFromMoleculeToSpectrum","assocViewerAutoSize","assocViewerAutofit","assocViewerAutoShrink"])},getSpectrumInspector:function(){return this.getWidget()}}),Kekule.ChemWidget.SpectrumInspector.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.SpectrumInspector.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(o){this.tryApplySuper("initialize",[o])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var o=this.tryApplySuper("getCategoryInfos"),l=this.getSpectrumInspector(),u=["spectrumViewerConfigs","spectrumViewerRenderConfigs","assocViewerConfigs","assocViewerRenderConfigs"],c=0,d=u.length;c<d;++c){var h=l.getPropInfo(u[c]),p=l.getPropValue(u[c]);p&&o.push({obj:p,name:h.name,title:h.title,description:h.description})}return o},getSpectrumInspector:function(){return this.getWidget()}});var a=Kekule.ObjPropSettingManager;a.register("Kekule.ChemWidget.SpectrumInspector.fullFunc",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,enableEdit:!0,toolButtons:null}),a.register("Kekule.ChemWidget.SpectrumInspector.basic",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!0,toolButtons:[t.saveData,t.changeSpectrumSection,t.zoomIn,t.zoomOut]}),a.register("Kekule.ChemWidget.SpectrumInspector.mini",{enableToolbar:!0,enableDirectInteraction:!0,enableTouchInteraction:!1,toolButtons:[t.changeSpectrumSection]}),a.register("Kekule.ChemWidget.SpectrumInspector.static",{enableToolbar:!1,enableDirectInteraction:!1,enableTouchInteraction:!1,toolButtons:[],menuItems:[]}),Kekule.ChemWidget.ActionOnSpectrumInspector=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnSpectrumInspector",initialize:function(o,l,u){this.tryApplySuper("initialize"),this.setTargetWidget(o),this.setText(l),this.setHint(u)},initProperties:function(){this.defineProp("targetWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1})},getSpectrumInspector:function(o){return o||(o=this.getTargetWidget()),o instanceof Kekule.ChemWidget.SpectrumInspector?o:o&&o.getParent()instanceof Kekule.ChemWidget.SpectrumInspector?o.getParent():void 0},doUpdate:function(){var o=this.getSpectrumInspector();this.setEnabled(o&&o.getChemObj()&&o.getChemObjLoaded()&&o.getEnabled())},execute:function(o,l){return!this.getSpectrumInspector()&&o instanceof Kekule.ChemWidget.SpectrumInspector&&this.setSpectrumInspector(o),this.tryApplySuper("execute",[o,l])}}),Kekule.ChemWidget.ActionSpectrumInspectorReset=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorReset",HTML_CLASSNAME:i.ACTION_RESET,initialize:function(o){this.tryApplySuper("initialize",[o,Kekule.$L("ChemWidgetTexts.CAPTION_RESETVIEW"),Kekule.$L("ChemWidgetTexts.HINT_RESETVIEW")])},doExecute:function(o){this.tryApplySuper("doExecute",[o]),this.getSpectrumInspector().resetDisplay()}}),Kekule.ChemWidget.ActionSpectrumInspectorChangeSpectrumSectionStub=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorChangeSpectrumSectionStub",HTML_CLASSNAME:i.ACTION_SPECTRUM_INSPECTOR_CHANGE_SECTION,initialize:function(o){this.tryApplySuper("initialize",[o,Kekule.$L("ChemWidgetTexts.CAPTION_CHANGE_SPECTRUM_SECTION"),Kekule.$L("ChemWidgetTexts.HINT_CHANGE_SPECTRUM_SECTION")])},doExecute:function(o){this.tryApplySuper("doExecute",[o])},doUpdate:function(){this.tryApplySuper("doUpdate")},_hasMultipleDisplayItems:function(o){var l=!1,u=o.getSpectrums();if(u.length>1)l=!0;else{var c=u[0];l=c&&c.getDataSectionCount()>1}return l}}),Kekule.ChemWidget.ActionSpectrumInspectorAssignmentCorrelate=Class.create(Kekule.ChemWidget.ActionOnSpectrumInspector,{CLASS_NAME:"Kekule.ChemWidget.ActionSpectrumInspectorAssignmentCorrelate",HTML_CLASSNAME:i.ACTION_SPECTRUM_INSPECTOR_CORRELATOR,initialize:function(o){this.tryApplySuper("initialize",[o,Kekule.$L("ChemWidgetTexts.CAPTION_SET_SPECTRUM_DATA_ASSIGNMENT"),Kekule.$L("ChemWidgetTexts.HINT_SET_SPECTRUM_DATA_ASSIGNMENT")])},doExecute:function(o){this.tryApplySuper("doExecute",[o]),this.getSpectrumInspector().setSpectrumDataAssignmentsBySelectedObjects()},doUpdate:function(){this.tryApplySuper("doUpdate");var o=this.getSpectrumInspector(),l=o.getSelectedSpectrumDataItems(),u=o.getSelectedAssocObjects();this.setEnabled(this.getEnabled()&&l&&l.length&&u&&u.length)}}),Kekule._registerAfterLoadSysProc(function(){var o=Kekule.ActionManager,l=Kekule.ChemWidget,u=Kekule.ChemWidget.SpectrumInspector,c=o.registerNamedActionClass;c(t.reset,l.ActionSpectrumInspectorReset,u),c(t.changeSpectrumSection,l.ActionSpectrumInspectorChangeSpectrumSectionStub,u),c(t.correlateSpectrumDataAndObject,l.ActionSpectrumInspectorAssignmentCorrelate,u),c(t.config,Kekule.Widget.ActionOpenConfigWidget,u)})}})}(),function(){var s=Class.PropertyScope;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER_GRID:"K-Chem-Viewer-Grid"}),Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ViewerGrid=Class.create(Kekule.Widget.WidgetGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid",initialize:function(t,n,i){this.setPropStoreFieldValue("renderType",n),this.setPropStoreFieldValue("viewerConfigs",i),this.tryApplySuper("initialize",[t])},initProperties:function(){this._shadowedPropPairs=[],this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,setter:null,scope:s.PUBLIC}),this.defineProp("chemObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,getter:function(){var t=[];return this.each(function(n){t.push(n.getChemObj())}),t}}),this.defineViewerShadowProps(["drawOptions","moleculeDisplayType","zoom","autoSize","enableLoadNewFile","viewerConfigs","allowedMolDisplayTypes","enableEdit","modalEdit","toolButtons","enableToolbar","toolbarPos","toolbarMarginVertical","toolbarMarginHorizontal","toolbarEvokeModes","toolbarRevokeModes","toolbarRevokeTimeout","caption","showCaption","autoCaption","captionPos","enableDirectInteraction","enableTouchInteraction"]),this.defineViewerShadowProps(["viewerPredefinedSetting"],["predefinedSetting"]),this.defineProp("actionLoadData",{dataType:"Kekule.ChemWidget.ActionDisplayerLoadData",serializable:!1,scope:s.PRIVATE,setter:null,getter:function(){var t=this.getPropStoreFieldValue("actionLoadData");return t||(t=new Kekule.ChemWidget.ActionDisplayerLoadData,this.setPropStoreFieldValue("actionLoadData",t)),t}})},defineViewerShadowProps:function(t,n){n||(n=[]);for(var i=0,r=t.length;i<r;++i){var a=t[i],o=n[i]||t[i];this.defineViewerShadowProp(a,o)}},defineViewerShadowProp:function(t,n){n||(n=t);var i=Kekule.ChemWidget.Viewer,r=ClassEx.getPropInfo(i,n);if(r){var a=Object.create(r);a.getter=void 0,a.setter=function(o){this.setPropStoreFieldValue(t,o),this.each(function(l){l.setPropValue(n,o)})},this.defineProp(t,a),this._shadowedPropPairs.push({prop:t,viewerProp:n})}},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+e.VIEWER_GRID},createWidget:function(){var t=this.getDocument(),n=new Kekule.ChemWidget.LoadDataDialog(t),i=this;n.openModal(function(r){if(n.isPositiveResult(r)){var a=n.getDataDetails();if(l=n.getChemObj()){var o=i.doCreateNewChildWidget(t,null,l),l=o.loadFromData(a.data,a.mimeType,a.fileName,a.formatId);o.setParent(i)}else a.data&&Kekule.error(Kekule.$L("ErrorMsg.LOAD_CHEMDATA_FAILED"))}},this.getAddingCell())},doCreateNewChildWidget:function(t,n){var i=new Kekule.ChemWidget.Viewer(t,null,this.getRenderType(),this.getViewerConfigs());return this.doSetShadowedPropValuesToViewer(i),n&&i.setChemObj(n),i},doSetShadowedPropValuesToViewer:function(t){for(var n=0,i=this._shadowedPropPairs.length;n<i;++n){var r=this._shadowedPropPairs[n],a=this.getPropValue(r.prop);a!==void 0&&t.setPropValue(r.viewerProp,a)}},addChemObj:function(t){return this.doCreateNewChildWidget(this.getDocument(),t).setParent(this),this},removeChemObj:function(t){var n=this;return this.each(function(i){i.getChemObj()===t&&n.removeWidget(i,!0)}),this}}),Kekule.ChemWidget.ViewerGrid2D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid2D",initialize:function(t,n){this.tryApplySuper("initialize",[t,Kekule.Render.RendererType.R2D,n])}}),Kekule.ChemWidget.ViewerGrid3D=Class.create(Kekule.ChemWidget.ViewerGrid,{CLASS_NAME:"Kekule.ChemWidget.ViewerGrid3D",initialize:function(t,n){this.tryApplySuper("initialize",[t,Kekule.Render.RendererType.R3D,n])}})}(),function(){var s=Class.PropertyScope,e=Kekule.ObjUtils,t=Kekule.DomUtils,n=Kekule.ArrayUtils,i=(Kekule.ChemWidget,Kekule.ChemWidget.ComponentWidgetNames);Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMOBJSETTER:"K-Chem-Obj-Setter",CHEMOBJSETTER_FLEX_LAYOUT:"K-Chem-Obj-Setter-Flex-Layout",CHEMOBJSETTER_TOOLBAR_AREA:"K-Chem-Obj-Setter-Toolbar-Area",CHEMOBJSETTER_CLIENT:"K-Chem-Obj-Setter-Client",CHEMOBJSETTER_VIEWER:"K-Chem-Obj-Setter-Viewer",CHEMOBJSETTER_TABGROUP:"K-Chem-Obj-Setter-TabGroup",CHEMOBJSETTER_INFOLABEL:"K-Chem-Obj-Setter-InfoLabel",CHEMOBJSETTER_STATUSLABEL:"K-Chem-Obj-Setter-StatusLabel",CHEMOBJSETTER_REGION:"K-Chem-Obj-Setter-Region",CHEMOBJSETTER_REGION_LABEL:"K-Chem-Obj-Setter-Region-Label",CHEMOBJSETTER_LINE:"K-Chem-Obj-Setter-Line",CHEMOBJSETTER_CONFIGURATOR:"K-Chem-Obj-Setter-Configurator",SPECTRUMOBJ_INSERTER:"K-SpectrumObjInserter",SPECTRUMOBJ_INSERTER_CONTAINER_ELEM:"K-SpectrumObjInserter-Container",SPECTRUMOBJ_INSERTER_CLIENT:"K-SpectrumObjInserter-Client",SPECTRUMOBJ_INSERTER_TOOLBAR_AREA:"K-SpectrumObjInserter-Toolbar-Area",SPECTRUMOBJ_INSERTER_INFOLABEL:"K-SpectrumObjInserter-InfoLabel",SPECTRUMOBJ_INSERTER_SPECTRUM_INSPECTOR:"K-SpectrumObjInserter-SpectrumInspector",SPECTRUMOBJ_INSERTER_CONFIGURATOR:"K-SpectrumObjInserter-Configurator"});var r=Kekule.Widget.HtmlClassNames,a=Kekule.ChemWidget.HtmlClassNames;Kekule.globalOptions.add("chemWidget.chemObjInserter",{autoSizeExport:!0,backgroundColor3D:"#000000",exportViewerPredefinedSetting:"basic",enable3DStructureAutoGeneration:!1,toolButtons:[i.loadData,i.saveData,i.clearObjs,i.molDisplayType,i.molHideHydrogens,i.molAutoGenerateCoords,i.zoomIn,i.zoomOut,i.rotateX,i.rotateY,i.rotateZ,i.rotateLeft,i.rotateRight,i.reset,i.openEditor,i.config]}),Kekule.ChemWidget.ChemObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter",DEF_BGCOLOR_2D:"transparent",DEF_BGCOLOR_3D:"#000000",initialize:function(o,l,u,c){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this),this._toolbarParentElem=null,this._infoLabel=null,this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT"),this.tryApplySuper("initialize",[o]);var d=this.getViewer();u&&d.setRenderType(u),c&&d.setViewerConfigs(c),this.adjustChildrenSizes()},doFinalize:function(){this._configAction&&this._configAction.finalize();var o=this.getPropStoreFieldValue("viewer");o&&o.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("viewer");return o||(o=this.createViewer(),this.setPropStoreFieldValue("viewer",o)),o}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:s.PUBLIC,getter:function(){return this.getPropStoreFieldValue("chemObj")},setter:function(o){this.setPropStoreFieldValue("chemObj",o),this.getViewer()&&this.getViewer().setChemObj(o)}}),this.defineProp("assoc3DChemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:s.PRIVATE,setter:function(o){if(o!==this.getAssoc3DChemObj()&&(this.setPropStoreFieldValue("assoc3DChemObj",o),this.getRenderType()===Kekule.Render.RendererType.R3D)){var l=this._getDisplayedChemObjForRenderType(this.getRenderType());this._changeDisplayedChemObj(l)}}}),this.defineProp("currDisplayedChemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:s.PRIVATE,setter:null,getter:function(){var o=this.getPropStoreFieldValue("viewer");return o&&o.getChemObj()}}),this.defineProp("renderType",{dataType:DataType.INT,serializable:!1,scope:s.PUBLIC,setter:function(o){var l=this.getRenderType();if(o!==l){this.setPropStoreFieldValue("renderType",o);var u=this._getDisplayedChemObjForRenderType(l),c=this._getDisplayedChemObjForRenderType(o);this.getViewer().setRenderType(o),u!==c&&this._changeDisplayedChemObj(c);var d=this.getTabs();if(d){var h=o===Kekule.Render.RendererType.R3D?1:0;d.getChildWidgets()[h].setChecked(!0)}}}}),this.defineProp("is3D",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getRenderType()===Kekule.Render.RendererType.R3D},setter:function(o){this.setRenderType(o?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D)}}),this.defineProp("enable3DStructureAutoGeneration",{dataType:DataType.BOOL}),this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(o){this._infoLabel&&Kekule.StyleUtils.setDisplay(this._infoLabel,o)}}),this.defineProp("statusMessage",{dataType:DataType.STRING,serializable:!1,scope:s.PUBLIC,getter:function(){var o=this._statusLabel;return o&&o.innerHTML},setter:function(o){this._updateStatusLabel(o)}}),this.defineProp("autoSizeExport",{dataType:DataType.BOOL}),this.defineProp("backgroundColor2D",{dataType:DataType.STRING,setter:function(o){this.setPropStoreFieldValue("backgroundColor2D",o),this.backgroundColorChange()}}),this.defineProp("backgroundColor3D",{dataType:DataType.STRING,setter:function(o){this.setPropStoreFieldValue("backgroundColor3D",o),this.backgroundColorChange()}}),this.defineProp("exportViewerPredefinedSetting",{dataType:DataType.STRING}),this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:s.PRIVATE}),this.defineProp("tabs",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:s.PRIVATE}),this._defineViewerDelegatedProp("chemObjLoaded"),this._defineViewerDelegatedProp("renderConfigs"),this._defineViewerDelegatedProp("drawOptions"),this._defineViewerDelegatedProp("allowCoordBorrow"),this._defineViewerDelegatedProp("autoSize"),this._defineViewerDelegatedProp("autofit"),this._defineViewerDelegatedProp("autoShrink"),this._defineViewerDelegatedProp("viewerConfigs"),this._defineViewerDelegatedProp("allowedMolDisplayTypes"),this._defineViewerDelegatedProp("enableEdit"),this._defineViewerDelegatedProp("enableEditFromVoid"),this._defineViewerDelegatedProp("modalEdit"),this._defineViewerDelegatedProp("restrainEditorWithCurrObj"),this._defineViewerDelegatedProp("editorProperties"),this._defineViewerDelegatedProp("toolButtons"),this._defineViewerDelegatedProp("enableDirectInteraction"),this._defineViewerDelegatedProp("enableTouchInteraction"),this._defineViewerDelegatedProp("enableGesture")},initPropValues:function(){this.tryApplySuper("initPropValues");var o=Object.extend({autoSizeExport:!0,backgroundColor3D:this.DEF_BGCOLOR_3D,exportViewerPredefinedSetting:"basic",enable3DStructureAutoGeneration:!1},Kekule.globalOptions.get("chemWidget.chemObjInserter"),{});this.setAutoSizeExport(o.autoSizeExport),this.setBackgroundColor3D(o.backgroundColor3D),this.setExportViewerPredefinedSetting(o.exportViewerPredefinedSetting)},_defineViewerDelegatedProp:function(o,l){l||(l=o);var u=ClassEx.getPropInfo(Kekule.ChemWidget.Viewer,l),c=Object.create(u);return c.getter=null,c.setter=null,u.getter&&(c.getter=function(){return this.getViewer().getPropValue(l)}),u.setter&&(c.setter=function(d){this.getViewer().setPropValue(l,d)}),this.defineProp(o,c)},loadPredefinedResDataToProp:function(o,l,u){if(o==="chemObj")if(u){var c=Kekule.IO.loadTypedData(l.data,l.resType,l.resUri);this.setChemObj(c)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+l.resUri||"")},doGetWidgetClassName:function(){var o=this.tryApplySuper("doGetWidgetClassName")+" "+a.CHEMOBJSETTER;return this._isUsingFlexLayout()&&(o+=" "+a.CHEMOBJSETTER_FLEX_LAYOUT),o},_isUsingFlexLayout:function(){return Kekule.BrowserFeature.cssFlex},doCreateRootElement:function(o){return o.createElement("div")},doCreateSubElements:function(o,l){var u=this.tryApplySuper("doCreateSubElements",[o,l]);this.createToolbarParent(l);var c=new Kekule.Widget.Panel(this);return c.addClassName(a.CHEMOBJSETTER_CLIENT),c.setUseCornerDecoration(!1),c.appendToElem(l),this.setPropStoreFieldValue("clientPanel",c),this.createViewer(c.getCoreElement()),this.createInfoLabel(l,this.getViewer()),this.createStatusLabel(l,this.getViewer()),this.createTabs(l),u},elementBound:function(o){this.setObserveElemResize(!0)},doResize:function(){this.adjustChildrenSizes()},doWidgetShowStateChanged:function(o){this.tryApplySuper("doWidgetShowStateChanged",[o]),this.adjustChildrenSizes()},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},getBackgroundColor:function(o){var l=o===Kekule.Render.RendererType.R3D?this.getBackgroundColor3D():this.getBackgroundColor2D();return l===Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT&&(l="transparent"),l},setBackgroundColor:function(o,l){if(l===Kekule.Render.RendererType.R3D){var u=o||this.DEF_BGCOLOR_3D;this.setBackgroundColor3D(u)}else u=o||this.DEF_BGCOLOR_2D,this.setBackgroundColor2D(u)},backgroundColorChange:function(){var o=this.getBackgroundColor(this.getRenderType()),l=this.getPropStoreFieldValue("viewer");l&&l.setBackgroundColor(o)},adjustChildrenSizes:function(){if(!this._isUsingFlexLayout()){this.getPageRect();var o=Kekule.HtmlElementUtils.getElemPageRect(this._toolbarParentElem),l=this.getTabs(),u=(l&&l.getPageRect()).top-o.bottom;this.getClientPanel().setHeight(u+"px")}this.getViewer().resized()},createViewer:function(o){var l=Kekule.ChemWidget.ComponentWidgetNames,u=Kekule.Widget.EvokeMode,c=new Kekule.ChemWidget.Viewer(this,null,this.getRenderType());c.addClassName([r.DYN_CREATED,a.CHEMOBJSETTER_VIEWER]),c.setRenderType(Kekule.Render.RendererType.R2D),c.setEnableEdit(!0),c.setEnableEditFromVoid(!0),c.setRestrainEditorWithCurrObj(!1),c.setEnableToolbar(!0),c.setPredefinedSetting("fullFunc");var d=this;c.overwriteMethod("createToolButton",function(p,g,f){if(g===l.config){var m=new Kekule.Widget.Button(f),C=d._configAction;return C&&m.setAction(C),m}return p(g,f)});var h=Kekule.globalOptions.chemWidget.chemObjInserter.toolButtons;return c.setToolbarParentElem(this._toolbarParentElem),c.setToolButtons(h),c.setToolbarPos(Kekule.Widget.Position.BOTTOM),c.setToolbarMarginVertical(-2),c.setToolbarEvokeModes([u.ALWAYS]),c.addEventListener("resize",this.updateInfoLabel,this),c.addEventListener("load",this._reactViewerLoad,this),c.appendToElem(o),c.setChemObj(this.getChemObj()),this.setPropStoreFieldValue("viewer",c),this.backgroundColorChange(),c},_reactViewerLoad:function(o){if(!this._changingDisplayedChemObjFlag||this._changingDisplayedChemObjFlag<=0){var l=o.obj||null;this.setPropStoreFieldValue("chemObj",l),this.setAssoc3DChemObj(null),this.tryAutoGenerate3DCoordsForChemObjInViewer()}},createToolbarParent:function(o){var l=o.ownerDocument.createElement("div");return l.className=a.CHEMOBJSETTER_TOOLBAR_AREA,o.appendChild(l),this._toolbarParentElem=l,l},createTabs:function(o){var l=[Kekule.$L("ChemWidgetTexts.CAPTION_2D"),Kekule.$L("ChemWidgetTexts.CAPTION_3D")],u=this.getRenderType()===Kekule.Render.RendererType.R3D?1:0,c=new Kekule.Widget.TabButtonGroup(this);c.setTabButtonPosition(Kekule.Widget.Position.BOTTOM),c.addClassName([r.DYN_CREATED,a.CHEMOBJSETTER_TABGROUP]);for(var d=[],h=0,p=l.length;h<p;++h){var g=new Kekule.Widget.RadioButton(c);g.setText(l[h]),h===u&&g.setChecked(!0),d.push(g)}return c.addEventListener("switch",function(f){var m=f.button,C=d.indexOf(m)===1?Kekule.Render.RendererType.R3D:Kekule.Render.RendererType.R2D;this.setRenderType(C),this.backgroundColorChange(),this.tryAutoGenerate3DCoordsForChemObjInViewer()},this),c.appendToElem(o),this.setPropStoreFieldValue("tabs",c),c},createInfoLabel:function(o,l){var u=this.getDocument().createElement("div");return u.className=r.DYN_CREATED+" "+a.CHEMOBJSETTER_INFOLABEL,l.getElement().appendChild(u),this._infoLabel=u,u},updateInfoLabel:function(){var o=this.getViewer();if(o&&this._infoLabel){var l=o.getContextDimension(),u=l?this._infoLabelTemplate.format(Math.round(l.width),Math.round(l.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,u)}},createStatusLabel:function(o,l){var u=this.getDocument().createElement("div");return u.className=r.DYN_CREATED+" "+a.CHEMOBJSETTER_STATUSLABEL,l.getElement().appendChild(u),this._statusLabel=u,u},_updateStatusLabel:function(o){this._statusLabel&&(this._statusLabel.innerHTML=o)},getContextDimension:function(){return this.getViewer().getContextDimension()},setContextDimension:function(o){var l=this.getContextDimension(),u=o.width-l.width,c=o.height-l.height,d=this.getDimension(),h={width:d.width+u,height:d.height+c};return this.setDimension(h.width,h.height),this},_getDisplayedChemObjForRenderType:function(o){return o===Kekule.Render.RendererType.R3D&&this.getAssoc3DChemObj()||this.getChemObj()},_changeDisplayedChemObj:function(o){this._changingDisplayedChemObjFlag||(this._changingDisplayedChemObjFlag=0),++this._changingDisplayedChemObjFlag;try{this.getViewer().setChemObj(o)}finally{--this._changingDisplayedChemObjFlag}},_getContainingMoleculesWithCtab:function(o){if(o||(o=this.getChemObj()),o instanceof Kekule.StructureFragment)return o.hasCtab()?[o]:[];for(var l=[],u=Kekule.ChemStructureUtils.getAllStructFragments(o),c=0,d=u.length;c<d;++c){var h=u[c];h.hasCtab&&h.hasCtab()&&l.push(h)}return l},_get3DCoordGenerationTargetForChemObj:function(o){o||(o=this.getChemObj());var l=this._getContainingMoleculesWithCtab(o);if(l&&l.length===1){var u=l[0];return u.nodesHasCoord3D(!1)?null:u}return null},_isCoordGeneratorAvailable:function(o){return this.getViewer()._isCoordGeneratorAvailable(o)},doGenerate3DCoordsForChemObjInViewer:function(o){var l=this.getChemObj(),u=this,c=function(h,p){u.setStatusMessage(""),o&&o(h,p)};if(l&&this._isCoordGeneratorAvailable(Kekule.CoordMode.COORD3D)){var d=this._get3DCoordGenerationTargetForChemObj(l);if(d){u.setStatusMessage(Kekule.$L("ChemWidgetTexts.CAPTION_CHEMOBJINSERTER_GENERATING_3D_STRUCTURE"));try{this.getViewer().autoGenerateChemObjCoords(c.bind(this,null),d,Kekule.CoordMode.COORD3D)}catch(h){c(h,l)}return this}}return c(null,l),this},generate3DCoordsForChemObjInViewer:function(o){var l=this;this.doGenerate3DCoordsForChemObjInViewer(function(u,c){!u&&c&&l.setAssoc3DChemObj(c)})},_isMolContainingCoordsOfMode:function(o,l){return o.getNodeCount()<=0||o.nodesHasCoordOfMode(l,!1,!0)},tryAutoGenerate3DCoordsForChemObjInViewer:function(o){if(this.getEnable3DStructureAutoGeneration()&&this.getRenderType()===Kekule.Render.RendererType.R3D&&!this.getAssoc3DChemObj()){var l=this.getChemObj(),u=this._get3DCoordGenerationTargetForChemObj(l);u&&!this._isMolContainingCoordsOfMode(u,Kekule.CoordMode.COORD3D)&&this.generate3DCoordsForChemObjInViewer(o)}},exportToDataUri:function(o,l){return this.getViewer().exportToDataUri(o,l)},exportDetails:function(o,l){this.getAutoSizeExport()&&this.setAutoSize(!0);var u=this.getViewer().getActualDrawOptions(),c=this.getViewer().getContextDimension(),d=this.getCurrDisplayedChemObj(),h=d?{dataUri:this.exportToDataUri(o,l),drawOptions:u,drawOptionsJson:JSON.stringify(u),chemObj:d,chemObjJson:Kekule.IO.saveMimeData(d,"chemical/x-kekule-json"),autoSize:this.getAutoSizeExport(),autofit:this.getAutofit(),width:Math.round(c.width),height:Math.round(c.height),renderType:this.getRenderType()||Kekule.Render.RendererType.R2D,backgroundColor:this.getBackgroundColor(this.getRenderType()),predefinedSetting:this.getExportViewerPredefinedSetting()}:null;if(this.getAutoSizeExport()){this.setAutoSize(!1);var p=this.getViewer().getElement();p.style.width="auto",p.style.height="auto",this.getViewer().resized()}return h},getImgExportDetailsAsync:function(o,l,u){u(this.exportDetails(o,l))},getExportImgElemAttributes:function(o,l){var u=this.exportDetails(o,l);if(!u)return null;var c="width:"+u.width+"px; height:"+u.height+"px",d={src:u.dataUri,style:c,width:u.width,height:u.height,"data-kekule-widget":"Kekule.ChemWidget.Viewer","data-render-type":u.renderType,"data-chem-obj":u.chemObjJson,"data-draw-options":u.drawOptionsJson,"data-predefined-setting":u.predefinedSetting};return Kekule.ObjUtils.notUnset(u.autoSize)&&(d["data-auto-size"]=u.autoSize),Kekule.ObjUtils.notUnset(u.autofit)&&(d["data-autofit"]=u.autofit),Kekule.ObjUtils.notUnset(u.backgroundColor)&&(d["data-background-color"]=u.backgroundColor),d},getExportImgElemAttributesAsync:function(o,l,u){u(this.getExportImgElemAttributes(o,l))},createExportImgElement:function(o,l,u){var c=this.getExportImgElemAttributes(l,u)||{};if(c){var d=o.createElement("img");return Kekule.DomUtils.setElemAttributes(d,c),d}return null},createExportHtmlElement:function(o,l,u){return this.createExportImgElement(o,l,u)},createExportHtmlElementAsync:function(o,l,u,c){try{var d=this.createExportImgElement(o,l,u);c&&c(d)}catch(h){throw c(null),h}},importChemObjWithDetails:function(o,l){return this.setChemObj(o),this.setRenderType(l.renderType||Kekule.Render.RendererType.R2D),Kekule.ObjUtils.notUnset(l.autoSize)&&this.setAutoSizeExport(!!l.autoSize),Kekule.ObjUtils.notUnset(l.autofit)&&this.setAutofit(!!l.autofit),!l.width||!l.height||l.autoSize&&l.renderType!==Kekule.Render.RendererType.R3D||this.setContextDimension({width:l.width,height:l.height}),l.drawOptions&&this.getViewer().setDrawOptions(l.drawOptions),l.backgroundColor&&this.setBackgroundColor(l.backgroundColor,this.getRenderType()),this},importFromDetails:function(o,l){return this.importChemObjWithDetails(o,details)},importFromElemAttribs:function(o){o.width=DataType.JsonUtility.parse(o.width),o.height=DataType.JsonUtility.parse(o.height);var l=o["data-chem-obj"],u=l?Kekule.IO.loadMimeData(l,"chemical/x-kekule-json"):null;return o["data-render-type"]&&(o.renderType=DataType.JsonUtility.parse(o["data-render-type"])),o["data-draw-options"]&&(o.drawOptions=DataType.JsonUtility.parse(o["data-draw-options"])),o["data-auto-size"]&&(o.autoSize=DataType.JsonUtility.parse(o["data-auto-size"])),o["data-autofit"]&&(o.autofit=DataType.JsonUtility.parse(o["data-autofit"])),o["data-background-color"]&&(o.backgroundColor=o["data-background-color"]),this.importChemObjWithDetails(u,o)},importFromElem:function(o){var l=Kekule.HtmlElementUtils.getElemPageRect(o),u=Kekule.DomUtils.fetchAttributeValuesToJson(o);return u.width||(u.width=l.width),u.height||(u.height=l.height),this.importFromElemAttribs(u)}}),Kekule.ChemWidget.ChemObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjInserter.Configurator",initialize:function(o){this._checkBoxAutoSize=null,this._checkBoxAutofit=null,this._checkBoxShowInfo=null,this._textBoxWidth=null,this._textBoxHeight=null,this._colorPicker=null,this.tryApplySuper("initialize",[o]),this.addEventListener("valueChange",function(l){this.saveConfigValues()},this)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoUpdate(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(o,l){var u;(h=o.createElement("div")).className=a.CHEMOBJSETTER_REGION,(d=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOSIZE")),d.addClassName(a.CHEMOBJSETTER_LINE),d.appendToElem(h),this._checkBoxAutoSize=d,(u=o.createElement("span")).className=r.PART_ASSOC_TEXT_CONTENT,t.setElementText(u,Kekule.$L("ChemWidgetTexts.HINT_AUTOSIZE")),h.appendChild(u),(d=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_AUTOFIT")),d.addClassName(a.CHEMOBJSETTER_LINE),d.appendToElem(h),this._checkBoxAutofit=d,(u=o.createElement("span")).className=r.PART_ASSOC_TEXT_CONTENT,t.setElementText(u,Kekule.$L("ChemWidgetTexts.HINT_AUTOFIT")),h.appendChild(u),l.appendChild(h),(h=o.createElement("div")).className=a.CHEMOBJSETTER_REGION,(p=o.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,t.setElementText(p,Kekule.$L("ChemWidgetTexts.CAPTION_LABEL_SIZE")),h.appendChild(p),h.appendChild(o.createElement("br")),(c=new Kekule.Widget.TextBox(this)).setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_WIDTH")),c.appendToElem(h),this._textBoxWidth=c;var c,d,h,p=o.createElement("span");t.setElementText(p,"×"),h.appendChild(p),(c=new Kekule.Widget.TextBox(this)).setPlaceholder(Kekule.$L("ChemWidgetTexts.PLACEHOLDER_HEIGHT")),c.appendToElem(h),this._textBoxHeight=c,(d=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_SHOWSIZEINFO")),d.appendToElem(h),this._checkBoxShowInfo=d,l.appendChild(h),(h=o.createElement("div")).className=a.CHEMOBJSETTER_REGION,(p=o.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,t.setElementText(p,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR")),h.appendChild(p),h.appendChild(o.createElement("br"));var g=new Kekule.Widget.ColorPicker(this);g.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]),g.appendToElem(h),this._colorPicker=g,l.appendChild(h)},loadConfigValues:function(){this.tryApplySuper("loadConfigValues");var o=this.getWidget();if(o){var l=!o.getIs3D();this._checkBoxAutoSize.setChecked(l&&o.getAutoSizeExport()),this._checkBoxAutoSize.setEnabled(l),this._checkBoxAutofit.setChecked(l&&o.getAutofit()),this._checkBoxAutofit.setEnabled(l),this._checkBoxShowInfo.setChecked(o.getShowInfo());var u=o.getContextDimension();this._textBoxWidth.setText(Math.round(u.width)),this._textBoxHeight.setText(Math.round(u.height));var c=l?o.getBackgroundColor2D():o.getBackgroundColor3D();this._colorPicker.setValue(c||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT)}},saveConfigValues:function(){this.tryApplySuper("saveConfigValues");var o=this.getWidget();if(o){o.getIs3D()?o.setBackgroundColor3D(this._colorPicker.getValue()):(o.setAutoSizeExport(this._checkBoxAutoSize.getChecked()),o.setAutofit(this._checkBoxAutofit.getChecked()),o.setBackgroundColor2D(this._colorPicker.getValue())),o.setShowInfo(this._checkBoxShowInfo.getChecked());var l={width:parseInt(this._textBoxWidth.getText()),height:parseInt(this._textBoxHeight.getText())};o.setContextDimension(l),o.invokeEvent("configSave")}}}),Kekule._registerAfterLoadSysProc(function(){Kekule.ChemWidget&&Kekule.Spectroscopy&&(Kekule.globalOptions.add("chemWidget.spectrumObjInserter",{toolButtons:[i.loadData,i.saveData,i.clearObjs,i.changeSpectrumSection,i.zoomIn,i.zoomOut,i.reset,i.copy,i.config]}),Kekule.ChemWidget.SpectrumObjInserter=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.SpectrumObjInserter",DEF_BGCOLOR_2D:"transparent",initialize:function(o,l){this._configAction=new Kekule.Widget.ActionOpenConfigWidget(this),this._toolbarParentElem=null,this._infoLabel=null,this._infoLabelTemplate=Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH_HEIGHT"),this.tryApplySuper("initialize",[o])},doFinalize:function(){this._configAction&&this._configAction.finalize();var o=this.getPropStoreFieldValue("spectrumInspector");o&&o.finalize();var l=this.getPropStoreFieldValue("clientPanel");l&&l.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("spectrumInspector",{dataType:"Kekule.ChemWidget.SpectrumInspector",serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("spectrumInspector");return o||(o=this.createSpectrumInspector(),this.setPropStoreFieldValue("spectrumInspector",o)),o}}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,scope:s.PUBLIC,getter:function(){var o=this.getPropStoreFieldValue("spectrumInspector");return o?o.getChemObj():this.getPropStoreFieldValue("chemObj")},setter:function(o){this.setPropStoreFieldValue("chemObj",o),this.getSpectrumInspector()&&this.getSpectrumInspector().setChemObj(o)}}),this.defineProp("showInfo",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._infoLabel&&Kekule.StyleUtils.isShown(this._infoLabel)},setter:function(o){this._infoLabel&&Kekule.StyleUtils.setDisplay(this._infoLabel,o)}}),this.defineProp("clientPanel",{dataType:DataType.OBJECT,serializable:!1,setter:!1,scope:s.PRIVATE}),this._defineSpectrumInspectorDelegatedProperties(["spectrumViewportRanges","backgroundColor","enableHotTrack","enableSelect","enableMultiSelect","enableDirectInteraction","enableTouchInteraction","enableGestureInteraction","chemObjLoaded","renderConfigs","viewerConfigs","toolButtons","spectrumViewerDrawOptions","assocViewerDrawOptions","assocViewerConfigs","assocViewerAllowCoordBorrow","assocViewerAutoSize","assocViewerAutofit","assocViewerAutoShrink","assocViewerAllowedMolDisplayTypes","assocViewerVisualMode","assocViewerSize"])},_defineSpectrumInspectorDelegatedProperties:function(o){for(var l,u,c=Kekule.ChemWidget.SpectrumInspector,d=this,h=0,p=o.length;h<p;++h){var g=o[h];u=null,n.isArray(g)?(l=g[0],u=g[1]):l=g,u||(u=l),function(f,m,C){var _=ClassEx.getPropInfo(f,C),y=Object.create(_);y.getter=null,y.setter=null,y.serializable=!1,_.getter&&(y.getter=function(){var T=this.getSpectrumInspector();return T?T.getPropValue(C):void 0}),_.setter&&(y.setter=function(T){var E=this.getSpectrumInspector();E&&E.setPropValue(C,T)}),d.defineProp(m,y)}(c,l,u)}},loadPredefinedResDataToProp:function(o,l,u){if(o==="chemObj")if(u){var c=Kekule.IO.loadTypedData(l.data,l.resType,l.resUri);this.setChemObj(c)}else Kekule.error(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+l.resUri||"")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.SPECTRUMOBJ_INSERTER},doCreateRootElement:function(o){return o.createElement("div")},doCreateSubElements:function(o,l){var u=this.tryApplySuper("doCreateSubElements",[o,l]),c=o.createElement("div");c.className=a.SPECTRUMOBJ_INSERTER_CONTAINER_ELEM,this._containerElem=c,this.createToolbarParent(c);var d=new Kekule.Widget.Panel(this);return d.addClassName(a.SPECTRUMOBJ_INSERTER_CLIENT),d.setUseCornerDecoration(!1),d.appendToElem(c),this.setPropStoreFieldValue("clientPanel",d),this.createSpectrumInspector(d.getCoreElement()),this.createInfoLabel(d.getCoreElement(),this.getSpectrumInspector()),l.appendChild(c),this.setResizable&&this.setResizable(!0),u},getResizerElement:function(){return this.getClientPanel()?this.getClientPanel().getCoreElement():this.getCoreElement()},createSpectrumInspector:function(o){var l=Kekule.ChemWidget.ComponentWidgetNames,u=Kekule.Widget.EvokeMode,c=new Kekule.ChemWidget.SpectrumInspector(this);c.addClassName([r.DYN_CREATED,a.SPECTRUMOBJ_INSERTER_SPECTRUM_INSPECTOR]);var d=this;c.getSpectrumViewer().overwriteMethod("createToolButton",function(p,g,f){if(g===l.config){var m=new Kekule.Widget.Button(f),C=d._configAction;return C&&m.setAction(C),m}return p(g,f)});var h=Kekule.globalOptions.chemWidget.spectrumObjInserter.toolButtons;return c.setToolbarParentElem(this._toolbarParentElem),c.setToolButtons(h),c.setToolbarPos(Kekule.Widget.Position.BOTTOM),c.setToolbarMarginVertical(-2),c.getSpectrumViewer().setToolbarEvokeModes([u.ALWAYS]),c.getAssocViewer().setToolbarEvokeModes([]),c.addEventListener("resize",this.updateInfoLabel,this),c.appendToElem(o),c.setChemObj(this.getChemObj()),this.setPropStoreFieldValue("spectrumInspector",c),c},createToolbarParent:function(o){var l=o.ownerDocument.createElement("div");return l.className=a.SPECTRUMOBJ_INSERTER_TOOLBAR_AREA,o.appendChild(l),this._toolbarParentElem=l,l},createInfoLabel:function(o,l){var u=this.getDocument().createElement("div");return u.className=r.DYN_CREATED+" "+a.SPECTRUMOBJ_INSERTER_INFOLABEL,o.appendChild(u),this._infoLabel=u,u},updateInfoLabel:function(){var o=this.getSpectrumInspector();if(o&&this._infoLabel){var l=o.getDimension(),u=l?this._infoLabelTemplate.format(Math.round(l.width),Math.round(l.height)):"";Kekule.DomUtils.setElementText(this._infoLabel,u)}},getSpectrumInspectorDimension:function(){return this.getSpectrumInspector().getDimension()},setSpectrumInspectorDimension:function(o){var l=this.getSpectrumInspectorDimension(),u=o.width-l.width,c=o.height-l.height,d=this.getDimension(),h={width:d.width+u,height:d.height+c};return this.setDimension(h.width,h.height),this},getImgExportDetailsAsync:function(o,l,u){try{var c=this.getSpectrumInspector(),d=c.getChemObj();if(d){var h={backgroundColor:c.getBackgroundColor(),enableHotTrack:c.getEnableHotTrack(),enableSelect:c.getEnableSelect(),enableMultiSelect:c.getEnableMultiSelect(),spectrumViewerDrawOptions:c.getSpectrumViewerDrawOptions(),spectrumViewerDrawOptionsJson:c.getSpectrumViewerDrawOptions()?JSON.stringify(c.getSpectrumViewerDrawOptions()):"",spectrumViewportRanges:c.getSpectrumViewportRanges(),spectrumViewportRangesJson:c.getSpectrumViewportRanges()?JSON.stringify(c.getSpectrumViewportRanges()):"",assocViewerDrawOptions:c.getAssocViewerDrawOptions(),assocViewerDrawOptionsJson:c.getAssocViewerDrawOptions()?JSON.stringify(c.getAssocViewerDrawOptions()):"",assocViewerVisualMode:c.getAssocViewerVisualMode(),assocViewerSize:c.getAssocViewerSize(),chemObj:d,chemObjJson:Kekule.IO.saveMimeData(this.getChemObj(),Kekule.IO.MimeType.KEKULE_JSON)};c.exportToDataUriAsync(o,l,function(p,g){h.dataUri=p,h.width=Math.round(g.width),h.height=Math.round(g.height),u(h)})}else u(null)}catch(p){throw u(null),p}},getExportImgElemAttributesAsync:function(o,l,u){this.getImgExportDetailsAsync(o,l,function(c){if(c){var d="width:"+c.width+"px; height:"+c.height+"px",h={src:c.dataUri,style:d,width:c.width,height:c.height,"data-kekule-widget":"Kekule.ChemWidget.SpectrumInspector","data-chem-obj":c.chemObjJson,"data-spectrum-viewer-draw-options":c.spectrumViewerDrawOptionsJson,"data-assoc-viewer-draw-options":c.assocViewerDrawOptionsJson};Kekule.ObjUtils.notUnset(c.assocViewerVisualMode)&&(h["data-assoc-viewer-visual-mode"]=JSON.stringify(c.assocViewerVisualMode)),Kekule.ObjUtils.notUnset(c.assocViewerSize)&&(h["data-assoc-viewer-size"]=c.assocViewerSize),c.spectrumViewportRangesJson&&(h["data-spectrum-viewport-ranges"]=c.spectrumViewportRangesJson),e.notUnset(c.enableHotTrack)&&(h["data-enable-hot-track"]=c.enableHotTrack),e.notUnset(c.enableSelect)&&(h["data-enable-select"]=c.enableSelect),e.notUnset(c.enableMultiSelect)&&(h["data-enable-multi-select"]=c.enableMultiSelect),Kekule.ObjUtils.notUnset(c.backgroundColor)&&(h["data-background-color"]=c.backgroundColor),u(h)}else u(null)})},exportToSingleImgElementAsync:function(o,l,u,c){this.getExportImgElemAttributesAsync(l,u,function(d){if(d){var h=o.createElement("img");Kekule.DomUtils.setElemAttributes(h,d),c(h)}else c(null)})},createExportHtmlElementAsync:function(o,l,u,c){this.exportToSingleImgElementAsync(o,l,u,function(d){c&&c(d)})},importFromDetails:function(o,l){this.setChemObj(o),this.getSpectrumInspector().beginUpdate();try{l.spectrumViewportRanges&&this.setSpectrumViewportRanges(l.spectrumViewportRanges),l.spectrumViewerDrawOptions&&this.setSpectrumViewerDrawOptions(l.spectrumViewerDrawOptions),l.assocViewerDrawOptions&&this.setAssocViewerDrawOptions(l.assocViewerDrawOptions),l.backgroundColor&&this.setBackgroundColor(l.backgroundColor),e.notUnset(l.enableHotTrack)&&this.setEnableHotTrack(l.enableHotTrack),e.notUnset(l.enableSelect)&&this.setEnableSelect(l.enableSelect),e.notUnset(l.enableMultiSelect)&&this.setEnableMultiSelect(l.enableMultiSelect),e.notUnset(l.assocViewerVisualMode)&&this.setAssocViewerVisualMode(l.assocViewerVisualMode),e.notUnset(l.assocViewerSize)&&this.setAssocViewerSize(l.assocViewerSize),l.width&&l.height&&this.setSpectrumInspectorDimension({width:l.width,height:l.height})}finally{this.getSpectrumInspector().endUpdate()}return this},importFromElemAttribs:function(o){o.width=DataType.JsonUtility.parse(o.width),o.height=DataType.JsonUtility.parse(o.height);var l=o["data-chem-obj"],u=l?Kekule.IO.loadMimeData(l,"chemical/x-kekule-json"):null;return o["data-spectrum-viewport-ranges"]&&(o.spectrumViewportRanges=DataType.JsonUtility.parse(o["data-spectrum-viewport-ranges"])),o["data-spectrum-viewer-draw-options"]&&(o.spectrumViewerDrawOptions=DataType.JsonUtility.parse(o["data-spectrum-viewer-draw-options"])),o["data-assoc-viewer-draw-options"]&&(o.assocViewerDrawOptions=DataType.JsonUtility.parse(o["data-assoc-viewer-draw-options"])),o["data-background-color"]&&(o.backgroundColor=o["data-background-color"]),o["data-enable-hot-track"]&&(o.enableHotTrack=DataType.JsonUtility.parse(o["data-enable-hot-track"])),o["data-enable-select"]&&(o.enableSelect=DataType.JsonUtility.parse(o["data-enable-select"])),o["data-enable-multi-select"]&&(o.enableMultiSelect=DataType.JsonUtility.parse(o["data-enable-multi-select"])),o["data-assoc-viewer-visual-mode"]&&(o.assocViewerVisualMode=DataType.JsonUtility.parse(o["data-assoc-viewer-visual-mode"])),this.importFromDetails(u,o)},importFromElem:function(o){var l=Kekule.HtmlElementUtils.getElemPageRect(o),u=Kekule.DomUtils.fetchAttributeValuesToJson(o);return u.width||(u.width=l.width),u.height||(u.height=l.height),this.importFromElemAttribs(u)}}),Kekule.ChemWidget.SpectrumObjInserter.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.SpectrumObjInserter.Configurator",initialize:function(o){this.tryApplySuper("initialize",[o]),this.addEventListener("valueChange",this._reactInputWidgetValueChange.bind(this))},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAutoUpdate(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+a.SPECTRUMOBJ_INSERTER_CONFIGURATOR+" "+a.CHEMOBJSETTER_CONFIGURATOR},doCreateSubElements:function(o,l){var u;(p=o.createElement("div")).className=a.CHEMOBJSETTER_REGION,(g=o.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,t.setElementText(g,Kekule.$L("ChemWidgetTexts.CAPTION_INTERACTIONS")),p.appendChild(g),p.appendChild(o.createElement("br")),(u=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_HOTTRACK")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(p),this._checkBoxEnableHotTrack=u,(u=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_SELECT")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(p),this._checkBoxEnableSelect=u,(u=new Kekule.Widget.CheckBox(this)).setText(Kekule.$L("ChemWidgetTexts.CAPTION_ENABLE_MULTISELECT")).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(p),this._checkBoxEnableMultiSelect=u,l.appendChild(p),(p=o.createElement("div")).className=a.CHEMOBJSETTER_REGION,(g=o.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,t.setElementText(g,Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE")),p.appendChild(g),p.appendChild(o.createElement("br"));var c=Kekule.ChemWidget.SpectrumInspector.AssocViewerVisualMode,d=new Kekule.Widget.SelectBox(this);d.setItems([{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_AUTO"),value:c.AUTO},{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_VISIBLE"),value:c.VISIBLE},{text:Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_VISUAL_MODE_INVISIBLE"),value:c.INVISIBLE}]).addClassName(a.CHEMOBJSETTER_LINE).appendToElem(p),this._selectBoxAssocViewerVisualMode=d,(p=o.createElement("div")).className=a.CHEMOBJSETTER_REGION,(g=o.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,t.setElementText(g,Kekule.$L("ChemWidgetTexts.CAPTION_ASSOC_VIEWER_SIZE")),p.appendChild(g),p.appendChild(o.createElement("br"));var h=o.createElement("input");h.setAttribute("type","range"),h.setAttribute("min","0"),h.setAttribute("max","100"),h.setAttribute("step","5");var p,g,f=this._reactRawInputElemValueChange.bind(this);Kekule.X.Event.addListener(h,"change",f),Kekule.X.Event.addListener(h,"input",f),this._assocViewerSizeInputElem=h,p.appendChild(h),l.appendChild(p),(p=o.createElement("div")).className=a.CHEMOBJSETTER_REGION,(g=o.createElement("label")).className=a.CHEMOBJSETTER_REGION_LABEL,t.setElementText(g,Kekule.$L("ChemWidgetTexts.CAPTION_BACKGROUND_COLOR")),p.appendChild(g),p.appendChild(o.createElement("br"));var m=new Kekule.Widget.ColorPicker(this);m.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT]),m.appendToElem(p),this._colorPicker=m,l.appendChild(p)},_reactInputWidgetValueChange:function(o){this.saveConfigValues()},_reactRawInputElemValueChange:function(o){this.saveConfigValues()},_getSpectrumInspectorAssovViewerSizePercent:function(){var o=this.__$spectrumInspectorAssocViewerSizePercent$__;if(e.isUnset(o)){var l=this.getWidget();if(l=l&&l.getSpectrumInspector()){var u=l.getAssocViewerSize();if(u&&typeof u=="string"){var c=Kekule.StyleUtils.analysisUnitsValue(u);(c.units="%")&&(o=c.value)}if(e.isUnset(o)){var d=l.getDimension()||{},h=l.getAssocViewer().getDimension()||{},p=l.getLayout()===Kekule.Widget.Layout.VERTICAL?"height":"width";o=100*(h[p]||0)/(d[p]||1)}}}return o<0?o=0:o>100&&(o=100),o},_setSpectrumInspectorAssovViewerSizePercent:function(o){this.__$spectrumInspectorAssocViewerSizePercent$__=o;var l=this.getWidget();(l=l&&l.getSpectrumInspector())&&l.setAssocViewerSize(Math.round(o)+"%")},loadConfigValues:function(){this.tryApplySuper("loadConfigValues");var o=this.getWidget();if(o){this._checkBoxEnableHotTrack.setChecked(o.getEnableHotTrack()),this._checkBoxEnableSelect.setChecked(o.getEnableSelect()),this._checkBoxEnableMultiSelect.setChecked(o.getEnableMultiSelect());var l=o.getBackgroundColor();this._colorPicker.setValue(l||Kekule.Widget.ColorPicker.SpecialColors.TRANSPARENT),this._selectBoxAssocViewerVisualMode.setValue(o.getAssocViewerVisualMode()),this._assocViewerSizeInputElem.value=Math.round(this._getSpectrumInspectorAssovViewerSizePercent())}},saveConfigValues:function(){this.tryApplySuper("saveConfigValues");var o=this.getWidget();if(o){o.beginUpdate();try{o.setEnableHotTrack(this._checkBoxEnableHotTrack.getChecked()),o.setEnableSelect(this._checkBoxEnableSelect.getChecked()),o.setEnableMultiSelect(this._checkBoxEnableMultiSelect.getChecked()),o.setBackgroundColor(this._colorPicker.getValue()),o.setAssocViewerVisualMode(this._selectBoxAssocViewerVisualMode.getValue()),this._setSpectrumInspectorAssovViewerSizePercent(parseFloat(this._assocViewerSizeInputElem.value)),o.invokeEvent("configSave")}finally{o.endUpdate()}}}}))})}(),function(){Kekule;var s=Kekule.CoordMode,e=Kekule.ArrayUtils;ClassEx.extend(Kekule.ChemObject,{isStandalone:function(){return!this.getIsAttachedToParent()},getStandaloneAncestor:function(){for(var t=this;t.isStandalone&&!t.isStandalone()&&t.getParent&&t.getParent();)t=t.getParent();return t},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(t){var n=this.getParent();n&&n.notifyBeforeCascadeRemove&&n.notifyBeforeCascadeRemove(this),t?this.finalize():this.removeSelf(),n&&n.notifyAfterCascadeRemove&&n.notifyAfterCascadeRemove(this)},notifyBeforeCascadeRemove:function(t,n){},notifyAfterCascadeRemove:function(t,n){!this.getKeepEmptyEvenOnCascadeRemove()&&this.isEmpty()&&this.cascadeRemove(n)},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){var t=[];return this.isCoordDependent()||t.push(this),t},getCoordDeterminateObjects:function(){var t=[];if(this.getAttachedMarkers)for(var n=this.getAttachedMarkers()||[],i=0,r=n.length;i<r;++i)t=t.concat(n[i].getCoordDependentObjects());var a=this.getAttachedCoordStickNodes();for(i=0,r=a.length;i<r;++i){var o=a[i];e.pushUnique(t,o),e.pushUnique(t,o.getCoordDeterminateObjects())}return t},getAllContainingConnectors:function(){return[]},getConstraintManipulationBaseObj:function(){if(this.isAttachedMarker&&this.isAttachedMarker()){var t=this.getParent();return t instanceof Kekule.StructureFragment?null:t}return null},transformAbsCoordByMatrix:function(t,n,i,r,a,o){if(this.getChildCount&&(r||Kekule.ObjUtils.isUnset(r)))for(var l=0,u=this.getChildCount();l<u;++l){var c=this.getChildAt(l);c&&c.transformAbsCoordByMatrix&&c.transformAbsCoordByMatrix(n,n,i,r,a,!0)}var d=i===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;if(o){if(this.getCoordOfMode&&this.setCoordOfMode){var h=d(this.getCoordOfMode(i,a),t);this.setCoordOfMode(h,i)}}else this.getAbsCoordOfMode&&this.setAbsCoordOfMode&&(h=d(this.getAbsCoordOfMode(i,a),t),this.setAbsCoordOfMode(h,i))},scaleSize:function(t,n,i,r){if(this.getSizeOfMode&&this.setSizeOfMode){var a=this.getSizeOfMode(n,r),o=Kekule.CoordUtils.multiply(a,t);this.setSizeOfMode(o,n)}if(this.getChildCount&&(i||Kekule.ObjUtils.isUnset(i)))for(var l=0,u=this.getChildCount();l<u;++l){var c=this.getChildAt(l);c&&c.scaleSize&&c.scaleSize(t,n,i,r)}}}),ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerAdded",function(t,n){var i=t(n);return n&&n.setIsAttachedToParent(!0),i}),ClassEx.extendMethod(Kekule.ChemObject,"_attachedMarkerRemoved",function(t,n){var i=t(n);return n&&n.setIsAttachedToParent(!1),i}),ClassEx.defineProps(Kekule.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC},{name:"isAttachedToParent",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]),ClassEx.extend(Kekule.ChemStructureObject,{getCascadeDeleteObjs:function(){for(var t=this.tryApplySuper("getCascadeDeleteObjs"),n=this.getLinkedConnectors?this.getLinkedConnectors():[],i=0,r=n.length;i<r;++i){var a=n[i];if(a.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(t,a);var o=a.getCascadeDeleteObjs();Kekule.ArrayUtils.pushUnique(t,o)}}return t},isStandalone:function(){return!1},getCoordDeterminateObjects:function(){for(var t=this.tryApplySuper("getCoordDeterminateObjects"),n=this.getLinkedConnectors(),i=0,r=n.length;i<r;++i){var a=n[i];e.pushUnique(t,a),e.pushUnique(t,a.getCoordDeterminateObjects())}return t}}),ClassEx.extend(Kekule.BaseStructureNode,{getCascadeDeleteObjs:function(){return this.tryApplySuper("getCascadeDeleteObjs")},isCoordDependent:function(){return!1},getCoordDependentObjects:function(){return this.tryApplySuper("getCoordDependentObjects")},move:function(t,n){var i=this.getCoordOfMode(n),r=Kekule.CoordUtils.add(i,t);return this.setCoordOfMode(r,n),r},move2D:function(t){return this.move(t,s.COORD2D)},move3D:function(t){return this.move(t,s.COORD3D)}}),ClassEx.extend(Kekule.BaseStructureConnector,{getCascadeDeleteObjs:function(){for(var t=this.tryApplySuper("getCascadeDeleteObjs"),n=this.getConnectedObjs(),i=0,r=n.length;i<r;++i){var a=n[i];a instanceof Kekule.BaseStructureNode&&a.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(t,a)}return t},isCoordDependent:function(){return!0},getCoordDependentObjects:function(){for(var t=this.tryApplySuper("getCoordDependentObjects"),n=this.getConnectedObjs(),i=0,r=n.length;i<r;++i){var a=n[i];if(a.isExposed)var o=a.isExposed()?a:a.getExposedAncestor();else o=a;o&&e.pushUnique(t,o.getCoordDependentObjects())}return t},move:function(t,n){for(var i=0,r=this.getConnectedObjCount();i<r;++i){var a=this.getConnectedObjAt(i);a.move&&a.move(t,n)}},move2D:function(t){return this.move(t,s.COORD2D)},move3D:function(t){return this.move(t,s.COORD3D)},setAbsBaseCoord:function(t,n){var i=this.getAbsBaseCoord(),r=Kekule.CoordUtils.substract(t,i);this.move(r,n)},setAbsBaseCoord2D:function(t){this.setAbsCoordOfMode(t,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(t){this.setAbsCoordOfMode(t,Kekule.CoordMode.COORD3D)}}),ClassEx.extend(Kekule.ChemStructureNode,{getConstraintManipulationBaseObj:function(){var t=this.getLinkedObjs();return t.length===1?t[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(Kekule.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function(){return[this.getParent()]},getConstraintManipulationBaseObj:function(){var t=this.getLinkedObjs();return t.length===1?t[0]:this.tryApplySuper("getConstraintManipulationBaseObj")}}),ClassEx.extend(Kekule.Glyph.PathGlyphConnectorControlNode,{getCoordDeterminateObjects:function(){var t=this.tryApplySuper("getCoordDeterminateObjects"),n=this.getParentConnector();return n&&(t=(t||[]).concat([n])),t}}),ClassEx.extend(Kekule.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function(){return[this.getParent()]},getCoordDependentObjects:function(){var t=this.tryApplySuper("getCoordDependentObjects"),n=this.getControlPoints&&this.getControlPoints();return n&&n.length&&(t=(t||[]).concat(n)),t}}),ClassEx.extend(Kekule.StructureFragment,{isStandalone:function(){return!this.getCrossConnectors().length},notifyBeforeCascadeRemove:function(t,n){var i=this._getObjsNeedToBeCascadeRemoved(t);if(i&&i.length)for(var r=i.length-1;r>=0;--r){var a=i[r];n?a.finalize():a.removeSelf()}this.tryApplySuper("notifyBeforeCascadeRemove",[t,n])},getCoordDependentObjects:function(){if(this.isExpanded&&!this.isExpanded())return this.tryApplySuper("getCoordDependentObjects");if(this.hasCtab()){for(var t=[],n=this.getChildCount(),i=0;i<n;++i){var r=this.getChildAt(i);e.pushUnique(t,r.getCoordDependentObjects())}return t}return this.tryApplySuper("getCoordDependentObjects")},transformAbsCoordByMatrix:function(t,n,i,r,a,o){if(r||Kekule.ObjUtils.isUnset(r))for(var l=0,u=this.getNodeCount();l<u;++l){var c=this.getNodeAt(l);c&&c.transformAbsCoordByMatrix&&c.transformAbsCoordByMatrix(n,n,i,r,a,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[t,n,i,!1,a,o])}}),ClassEx.extend(Kekule.Glyph.Base,{isStandalone:function(){return this.tryApplySuper("isStandalone")}}),ClassEx.extend(Kekule.Glyph.PathGlyph,{getCoordDependentObjects:function(){for(var t=[],n=this.getNodeCount(),i=0;i<n;++i){var r=this.getNodeAt(i);t.push(r)}return t},transformAbsCoordByMatrix:function(t,n,i,r,a,o){if(r||Kekule.ObjUtils.isUnset(r))for(var l=0,u=this.getNodeCount();l<u;++l){var c=this.getNodeAt(l);c&&c.transformAbsCoordByMatrix&&c.transformAbsCoordByMatrix(n,n,i,r,a,!0)}this.tryApplySuper("transformAbsCoordByMatrix",[t,n,i,!1,a,o])}}),ClassEx.extend(Kekule.Glyph.BaseArc,{ownerChanged:function(t,n){var i=!n&&t,r=this.tryApplySuper("ownerChanged",[t,n]);return i&&this.getIsEditing()&&this._autoAdjustClass(),r},_getChemStickTargets:function(){for(var t=[],n=0,i=this.getNodeCount();n<i;++n){var r=this.getNodeAt(n).getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(r)&&t.push(r)}return t},notifyChildCoordStickTargetChanged:function(t,n,i){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof Kekule.Glyph.ElectronPushingArrow||this.__changeClass__(Kekule.Glyph.ElectronPushingArrow):this instanceof Kekule.Glyph.ElectronPushingArrow&&this.__changeClass__(Kekule.Glyph.Arc))}}),ClassEx.extendMethod(Kekule.Glyph.BaseArc,"createDefaultStructure",function(t,n,i){var r=t(n,i);return this._autoAdjustClass(),r}),ClassEx.extend(Kekule.Glyph.BaseTwinArc,{ownerChanged:function(t,n){var i=!n&&t,r=this.tryApplySuper("ownerChanged",[t,n]);return i&&this.getIsEditing()&&this._autoAdjustClass(),r},_getChemStickTargets:function(){for(var t=[],n=this._getArrowStartingNodes(),i=0,r=n.length;i<r;++i){var a=n[i].getCoordStickTarget();this._isValidChemNodeOrConnectorStickTarget(a)&&t.push(a)}return t},notifyChildCoordStickTargetChanged:function(t,n,i){this._autoAdjustClass()},_autoAdjustClass:function(){this.getIsEditing()&&(this._getChemStickTargets().length>=2?this instanceof Kekule.Glyph.BondFormingElectronPushingArrow||(this.__changeClass__(Kekule.Glyph.BondFormingElectronPushingArrow),this.getElectronCount()||this.setElectronCount(1)):this instanceof Kekule.Glyph.BondFormingElectronPushingArrow&&this.__changeClass__(Kekule.Glyph.TwinArc))}})}(),function(){var s=Kekule.ObjUtils,e=Kekule.ArrayUtils,t=Kekule.HtmlElementUtils,n=Kekule.CoordUtils,i=Kekule.Widget.HtmlClassNames,r=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"}),Kekule.ChemWidget.Editor={},Kekule.Editor=Kekule.ChemWidget.Editor,Kekule.Editor.CoordSys=Kekule.Render.CoordSystem,Kekule.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20},Kekule.Editor.SelectMode={RECT:0,POLYGON:1,POLYLINE:2,ANCESTOR:10},Kekule.globalOptions.add("chemWidget.editor",{enableIssueCheck:!0,enableCreateNewDoc:!0,enableOperHistory:!0,enableOperContext:!0,initOnNewDoc:!0,enableSelect:!0,enableMove:!0,enableResize:!0,enableAspectRatioLockedResize:!0,enableRotate:!0,enableGesture:!0}),Kekule.globalOptions.add("chemWidget.editor.issueChecker",{enableAutoIssueCheck:!0,enableAutoScrollToActiveIssue:!0,enableIssueMarkerHint:!0,durationLimit:50}),Kekule.Editor.BaseEditor=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],OBSERVING_GESTURES:["rotate","rotatestart","rotatemove","rotateend","rotatecancel","pinch","pinchstart","pinchmove","pinchend","pinchcancel","pinchin","pinchout"],initialize:function(o,l,u,c){this._objSelectFlag=0,this._objectUpdateFlag=0,this._objectManipulateFlag=0,this._uiMarkerUpdateFlag=0,this._updatedObjectDetails=[],this._operatingObjs=[],this._operatingRenderers=[],this._initialRenderTransformParams=null,this._objChanged=!1,this._lengthCaches={};var d=Kekule.globalOptions.get;this.setPropStoreFieldValue("enableIssueCheck",d("chemWidget.editor.enableIssueCheck",!0)),this.setPropStoreFieldValue("enableCreateNewDoc",d("chemWidget.editor.enableCreateNewDoc",!0)),this.setPropStoreFieldValue("enableOperHistory",d("chemWidget.editor.enableOperHistory",!0)),this.setPropStoreFieldValue("enableOperContext",d("chemWidget.editor.enableOperContext",!0)),this.setPropStoreFieldValue("initOnNewDoc",d("chemWidget.editor.initOnNewDoc",!0)),this.tryApplySuper("initialize",[o,l,u]),!this.getChemObj()&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()&&this.newDoc(),this.setPropStoreFieldValue("editorConfigs",c||this.createDefaultConfigs()),Kekule.ObjUtils.isUnset(this.getEnableGesture())&&this.setEnableGesture(d("chemWidget.editor.enableGesture",!0))},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:!1,getter:function(){return this.getDisplayerConfigs()},setter:function(o){return this.setDisplayerConfigs(o)}}),this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:!1,getter:function(){var o=this.getPropStoreFieldValue("defBondLength");return o||(o=this.getEditorConfigs().getStructureConfigs().getDefBondLength()),o}}),this.defineProp("defBondScreenLength",{dataType:DataType.FLOAT,serializable:!1,setter:null,getter:function(){var o=this._lengthCaches.defBondScreenLength;if(o)return o;var l=this.getDefBondLength()||0,u=this.translateDistance(l,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);return this._lengthCaches.defBondScreenLength=u,u}}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,setter:null,getter:function(){var o=this.getCurrPointerType();return this.getInteractionBoundInflation(o)}}),this.defineProp("currPointerType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:!1,getter:function(){var o=this.getPropStoreFieldValue("operHistory");return o||(o=new Kekule.OperationHistory,this.setPropStoreFieldValue("operHistory",o),o.addEventListener("push",this.reactOperHistoryPush,this),o.addEventListener("pop",this.reactOperHistoryPop,this),o.addEventListener("undo",this.reactOperHistoryUndo,this),o.addEventListener("redo",this.reactOperHistoryRedo,this),o.addEventListener("clear",this.reactOperHistoryClear,this),o.addEventListener("change",this.reactOperHistoryChange,this)),o},setter:null}),this.defineProp("operationsInCurrManipulation",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,serializable:!1}),this.defineProp("selection",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var o=this.getPropStoreFieldValue("selection");return o||(o=[],this.setPropStoreFieldValue("selection",o)),o},setter:function(o){this.setPropStoreFieldValue("selection",o),this.selectionChanged()}}),this.defineProp("selectMode",{dataType:DataType.INT,getter:function(){var o=this.getPropStoreFieldValue("selectMode");return Kekule.ObjUtils.isUnset(o)&&(o=Kekule.Editor.SelectMode.RECT),o},setter:function(o){this.getSelectMode()!==o&&(this.setPropStoreFieldValue("selectMode",o),this.hideSelectingMarker())}}),this.defineProp("isToggleSelectOn",{dataType:DataType.BOOL}),this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(o){var l=o?Kekule.ArrayUtils.toArray(o):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){var u;if(this.setPropStoreFieldValue("hotTrackedObjs",l),l&&l.length){u=[];for(var c=0,d=l.length;c<d;++c){var h=this.getBoundInfoRecorder().getBound(this.getObjContext(),l[c]);u&&Kekule.ArrayUtils.pushUnique(u,h)}}u?this.changeHotTrackMarkerBounds(u):this.getUiHotTrackMarker().getVisible()&&this.hideHotTrackMarker()}}}),this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:!1,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(o){this.setHotTrackedObjs(o)}}),this.defineProp("hoveredBasicObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(o){if(this.setPropStoreFieldValue("enableOperContext",!!o),!o){var l=this.getPropStoreFieldValue("operContext"),u=this.getPropStoreFieldValue("drawBridge");u&&l&&u.releaseContext(l)}}}),this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("issueCheckExecutor");if(!o){o=this.createIssueCheckExecutor();var l=this;o.addEventListener("execute",function(u){l.setIssueCheckResults(u.checkResults)}),this.setPropStoreFieldValue("issueCheckExecutor",o)}return o}}),this.defineProp("issueCheckerIds",{dataType:DataType.ARRAY,getter:function(){return this.getIssueCheckExecutor().getCheckerIds()},setter:function(o){this.getIssueCheckExecutor().setCheckerIds(o)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,getter:function(){return this.getIssueCheckExecutor().getEnabled()},setter:function(o){this.getIssueCheckExecutor().setEnabled(!!o),o||this.setIssueCheckResults(null)}}),this.defineProp("issueCheckDurationLimit",{dataType:DataType.NUMBER,getter:function(){return this.getIssueCheckExecutor().getDurationLimit()},setter:function(o){this.getIssueCheckExecutor().setDurationLimit(o)}}),this.defineProp("enableAutoIssueCheck",{dataType:DataType.BOOL,setter:function(o){!!o!==this.getEnableAutoIssueCheck()&&(this.setPropStoreFieldValue("enableAutoIssueCheck",!!o),o&&this.checkIssues(),this.setShowAllIssueMarkers(!!o))}}),this.defineProp("issueCheckResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(o){var l=this.getActiveIssueCheckResult();this.setPropStoreFieldValue("issueCheckResults",o),l&&(o||[]).indexOf(l)<0&&this.setPropStoreFieldValue("activeIssueCheckResult",null),this.issueCheckResultsChanged()}}),this.defineProp("activeIssueCheckResult",{dataType:DataType.OBJECT,serializable:!1,setter:function(o){this.getActiveIssueCheckResult()!==o&&(this.setPropStoreFieldValue("activeIssueCheckResult",o),o&&this.deselectAll(),this.issueCheckResultsChanged())}}),this.defineProp("enableAutoScrollToActiveIssue",{dataType:DataType.BOOL}),this.defineProp("showAllIssueMarkers",{dataType:DataType.BOOL,setter:function(o){!!o!==this.getShowAllIssueMarkers()&&(this.setPropStoreFieldValue("showAllIssueMarkers",!!o),this.recalcIssueCheckUiMarkers())}}),this.defineProp("enableIssueMarkerHint",{dataType:DataType.BOOL}),this.defineProp("enableGesture",{dataType:DataType.BOOL,setter:function(o){var l=!!o;this.getEnableGesture()!==l&&(this.setPropStoreFieldValue("enableGesture",l),l?this.startObservingGestureEvents(this.OBSERVING_GESTURES):this.stopObservingGestureEvents(this.OBSERVING_GESTURES))}}),this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawContext()}}),this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){if(this.getEnableOperContext()){var o=this.getPropStoreFieldValue("operContext");if(!o){var l=this.getDrawBridge();if(l){var u=this.getOperContextParentElem();if(!u)return null;var c=Kekule.HtmlElementUtils.getElemScrollDimension(u);o=l.createContext(u,c.width,c.height),this.setPropStoreFieldValue("operContext",o)}}return o}return null}}),this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var o=this.getPropStoreFieldValue("uiContext");if(!o){var l=this.getUiDrawBridge();if(l){var u=this.getUiContextParentElem();if(!u)return null;var c=Kekule.HtmlElementUtils.getElemScrollDimension(u);o=l.createContext(u,c.width,c.height),this.setPropStoreFieldValue("uiContext",o)}}return o}}),this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){return this.getDrawBridge()}}),this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("uiDrawBridge");return o||this.__$uiDrawBridgeInitialized$__||(this.__$uiDrawBridgeInitialized$__=!0,o=this.createUiDrawBridge(),this.setPropStoreFieldValue("uiDrawBridge",o)),o}}),this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("uiPainter");if(!o){var l=this.getUiMarkers();return(o=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,l,this.getUiDrawBridge())).setCanModifyTargetObj(!0),this.setPropStoreFieldValue("uiPainter",o),o}return o}}),this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:!1,setter:null,getter:function(){var o=this.getUiPainter();return o?(o.getRenderer()||o.prepareRenderer(),o.getRenderer()||null):null}}),this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("uiMarkers");return o||(o=new Kekule.ChemWidget.UiMarkerCollection,this.setPropStoreFieldValue("uiMarkers",o)),o}}),this._defineUiMarkerProp("uiHotTrackMarker"),this._defineUiMarkerProp("uiSelectionAreaMarker"),this._defineUiMarkerProp("uiSelectingMarker"),this._defineIssueCheckUiMarkerGroupProps(),this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("objRendererMap");return o||(o=new Kekule.MapEx(!0),this.setPropStoreFieldValue("objRendererMap",o)),o}}),this.defineProp("zoomCenter",{dataType:DataType.HASH})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setOperationsInCurrManipulation([]);var o=Kekule.IssueCheck.CheckerIds,l=Kekule.globalOptions.get;this.setEnableAutoIssueCheck(l("chemWidget.editor.issueChecker.enableAutoIssueCheck",!0)),this.setEnableAutoScrollToActiveIssue(l("chemWidget.editor.issueChecker.enableAutoScrollToActiveIssue",!0)),this.setIssueCheckerIds(l("chemWidget.editor.issueChecker.issueCheckerIds",[o.ATOM_VALENCE,o.BOND_ORDER,o.NODE_DISTANCE_2D])),this.setIssueCheckDurationLimit(l("chemWidget.editor.issueChecker.durationLimit")||null),this.setEnableIssueMarkerHint(l("chemWidget.editor.issueChecker.enableIssueMarkerHint")||this.getEnableAutoIssueCheck())},_defineUiMarkerProp:function(o,l){return this.defineProp(o,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:!1,getter:function(){var u=this.getPropStoreFieldValue(o);return u||(u=this.createShapeBasedMarker(o,null,null,!1)),u},setter:function(u){l||(l=this.getUiMarkers());var c=this.getPropValue(o);c&&(l.removeMarker(c),c.finalize()),l.addMarker(u),this.setPropStoreFieldValue(o,u)}})},_defineIssueCheckUiMarkerGroupProps:function(o){for(var l=Kekule.ErrorLevel,u=function(f,m){return f+"_"+l.levelToString(m)},c="issueCheckUiMarker",d=[l.ERROR,l.WARNING,l.NOTE,l.LOG],h=0,p=d.length;h<p;++h){var g=u(c,d[h]);this._defineUiMarkerProp(g,o)}this._defineUiMarkerProp(c+"_active",o),this["get"+c.upperFirst()]=function(f){var m=u(c,f);return this.getPropValue(m)},this["set"+c.upperFirst()]=function(f,m){var C=u(c,f);return this.setPropValue(C,m)},this["getActive"+c.upperFirst()]=function(){return this.getPropValue(c+"_active")},this["getAll"+c.upperFirst()+"s"]=function(){for(var f=[],m=0,C=d.length;m<C;++m)f.push(this.getIssueCheckUiMarker(d[m]));var _=this.getActiveIssueCheckUiMarker();return _&&f.push(_),f}},doFinalize:function(){var o=this.getPropStoreFieldValue("operHistory");o&&(o.finalize(),this.setPropStoreFieldValue("operHistory",null));var l=this.getPropStoreFieldValue("objDrawBridge"),u=this.getPropStoreFieldValue("operContext");l&&u&&l.releaseContext(u),this.setPropStoreFieldValue("operContext",null),l=this.getPropStoreFieldValue("uiDrawBridge"),u=this.getPropStoreFieldValue("uiContext"),l&&u&&l.releaseContext(u),this.setPropStoreFieldValue("uiDrawBridge",null),this.setPropStoreFieldValue("uiContext",null);var c=this.getPropStoreFieldValue("objRendererMap");c&&c.finalize(),this.setPropStoreFieldValue("objRendererMap",null);var d=this.getPropStoreFieldValue("issueCheckExecutor");d&&d.finalize(),this.setPropStoreFieldValue("issueCheckExecutor",null),this.tryApplySuper("doFinalize")},elementBound:function(o){this.setObserveElemResize(!0)},createDefaultConfigs:function(){return new Kekule.Editor.BaseEditorConfigs},doCreateRootElement:function(o){return o.createElement("div")},doCreateSubElements:function(o,l){var u=o.createElement("div");return u.className=r.EDITOR_CLIENT,l.appendChild(u),this._editClientElem=u,[u]},getCoreElement:function(){return this._editClientElem||this.tryApplySuper("getCoreElement")},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function(){var o=this.tryApplySuper("doGetWidgetClassName")+" "+r.EDITOR;return o+=" "+(this.getRenderType()===Kekule.Render.RendererType.R3D?r.EDITOR3D:r.EDITOR2D)},doBindElement:function(o){this.createContextParentElems(),this.createUiEventReceiverElem()},doGetInitialZoom:function(){var o,l=this.getEditorConfigs();return l&&(o=l.getInteractionConfigs().getEditorInitialZoom()),o||(o=this.tryApplySuper("doGetInitialZoom")),o},doSetInitialZoom:function(o){var l=this.getEditorConfigs();l&&l.getInteractionConfigs().setEditorInitialZoom(o),this.tryApplySuper("doSetInitialZoom",[o])},zoomTo:function(o,l,u){var c=Kekule.CoordUtils,d=this.getCurrZoom(),h=o,p=this.tryApplySuper("zoomTo",[o,l]),g=this.getElement(),f={x:g.scrollLeft,y:g.scrollTop};u||(u=this.getZoomCenter()),u||(u=c.add(f,{x:g.clientWidth/2,y:g.clientHeight/2}));var m=c.multiply(u,h/d-1);return g.scrollLeft+=m.x,g.scrollTop+=m.y,p},changeClientSize:function(o,l,u){this._initialRenderTransformParams=null;var c=this.getCoreElement().style;u||(u=1);var d=o*u,h=l*u;d&&(c.width=d+"px"),h&&(c.height=h+"px");for(var p=[this.getObjContext(),this.getOperContext(),this.getUiContext()],g=0,f=p.length;g<f;++g){var m=p[g];m&&this.getDrawBridge().setContextDimension(m,d,h)}this.repaint()},getVisibleClientScreenBox:function(){var o=this.getEditClientElem().parentNode,l=Kekule.HtmlElementUtils.getElemClientDimension(o),u=this.getClientScrollPosition();return l.x1=u.x,l.y1=u.y,l.x2=l.x1+l.width,l.y2=l.y1+l.height,l},getVisibleClientBoxOfSys:function(o){var l=this.getVisibleClientScreenBox(),u=Kekule.BoxUtils.getMinMaxCoords(l),c=this.translateCoord(u.min,Kekule.Editor.CoordSys.SCREEN,o),d=this.translateCoord(u.max,Kekule.Editor.CoordSys.SCREEN,o);return Kekule.BoxUtils.createBox(c,d)},getVisibleClientObjBox:function(o){return this.getVisibleClientBoxOfSys(Kekule.Editor.CoordSys.CHEM)},isDirty:function(){return this.getEnableOperHistory()?this.getOperHistory().getCurrIndex()>=0:this._objChanged},getChemObjSrcInfo:function(o){return this.isDirty()?null:o.getSrcInfo?o.getSrcInfo():null},getActualDrawOptions:function(){var o=this.tryApplySuper("getActualDrawOptions");if(this._initialRenderTransformParams){var l=Object.extend({},this._initialRenderTransformParams);return l=Object.extend(l,o)}return o},repaint:function(o){var l=o,u=this.tryApplySuper("repaint",[l]);return this.isRenderable()&&(this._initialRenderTransformParams||(this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())),this.recalcUiMarkers()),u},newDoc:function(){this.load(this.doCreateNewDocObj())},doCreateNewDocObj:function(){return new Kekule.Molecule},getExportableClasses:function(){var o=this.getChemObj();return o&&o.getClass?[o.getClass()]:[]},exportObj:function(o){return this.exportObjs(o)[0]},exportObjs:function(o){var l=this.getChemObj();return o?l&&l instanceof o?[l]:[]:[l]},doLoad:function(o){this.deselectAll(),this._initialRenderTransformParams=null,this.getObjRendererMap().clear(),this.getOperHistory()&&this.getOperHistory().clear(),this.tryApplySuper("doLoad",[o]),this._objChanged=!1,this.setPropStoreFieldValue("hoveredBasicObjs",null),this.setIssueCheckResults(null),this.requestAutoCheckIssuesIfNecessary()},doLoadEnd:function(o){this.tryApplySuper("doLoadEnd"),o||(this._initialRenderTransformParams=null)},doResize:function(){this._initialRenderTransformParams=null,this.tryApplySuper("doResize")},geometryOptionChanged:function(){var o=this.getDrawOptions().zoom;this.zoomChanged(o),this._clearLengthCaches(),this.tryApplySuper("geometryOptionChanged")},zoomChanged:function(o){},_clearLengthCaches:function(){this._lengthCaches={}},chemObjChanged:function(o,l){this.tryApplySuper("chemObjChanged",[o,l]),o!==l&&(l&&this._uninstallChemObjEventListener(l),o&&this._installChemObjEventListener(o))},_installChemObjEventListener:function(o){o.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(o){o.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var o=this.getCoreElement();if(o){var l=o.ownerDocument.createElement("div");return l.className=r.EDITOR_UIEVENT_RECEIVER,o.appendChild(l),t.addClass(l,i.DYN_CREATED),this.setPropStoreFieldValue("uiEventReceiverElem",l),l}},createContextParentElems:function(){var o=this.getCoreElement();if(o){var l=o.ownerDocument;this._createContextParentElem(l,o,"objContextParentElem"),this._createContextParentElem(l,o,"operContextParentElem"),this._createContextParentElem(l,o,"uiContextParentElem")}},_createContextParentElem:function(o,l,u){var c=o.createElement("div");return c.style.position="absolute",c.style.width="100%",c.style.height="100%",c.className=u+" "+i.DYN_CREATED,this.setPropStoreFieldValue(u,c),l.appendChild(c),c},createNewPainter:function(o){var l=this.tryApplySuper("createNewPainter",[o]);return l&&(l.setCanModifyTargetObj(!0),this.installPainterEventHandlers(l)),l},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var o=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!o){var l=Kekule.Render.DrawBridge2DMananger.getUnavailableMessage()||Kekule.error(Kekule.$L("ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED"));l&&this.reportException(l,Kekule.ExceptionLevel.NOT_FATAL_ERROR)}return o},changeContextDimension:function(o){var l=this.tryApplySuper("changeContextDimension",[o]);return l&&(this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),o.width,o.height),this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),o.width,o.height)),l},_clearSpecContext:function(o,l){l&&o&&l.clearContext(o)},_renderSpecContext:function(o,l){l&&o&&l.renderContext(o)},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge()),this.getBoundInfoRecorder()&&this.getBoundInfoRecorder().clear(this.getObjContext())},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext(),this._operatingRenderers&&this.clearOperContext()},repaintOperContext:function(o){if(this._operatingRenderers&&this._operatingObjs){this.clearOperContext();try{var l={partialDrawObjs:this._operatingObjs,doNotClear:!0};this.repaint(l)}finally{this._renderSpecContext(this.getOperContext(),this.getDrawBridge())}}},getOperatingRenderers:function(){return this._operatingRenderers||(this._operatingRenderers=[]),this._operatingRenderers},setOperatingRenderers:function(o){this._operatingRenderers=o},installPainterEventHandlers:function(o){o.addEventListener("prepareDrawing",this.reactChemObjPrepareDrawing,this),o.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjPrepareDrawing:function(o){var l=o.context,u=o.obj;if(u&&(l===this.getObjContext()||l===this.getOperContext())){var c=o.target;if(this.getObjRendererMap().set(u,c),this.getEnableOperContext()){for(var d=this._operatingObjs||[],h=!1,p=0,g=d.length;p<g;++p)if(this._isChemObjDirectlyRenderedByRenderer(this.getObjContext(),d[p],c)){h=!0;break}h&&(this._setRendererToOperContext(c),e.pushUnique(this.getOperatingRenderers(),c))}}},reactChemObjClear:function(o){var l=o.context,u=o.obj;if(u&&(l===this.getObjContext()||l===this.getOperContext())){var c=o.target;this.getObjRendererMap().remove(u),e.remove(this.getOperatingRenderers(),c)}},reactChemObjChange:function(o){var l=o.target,u=o.changedPropNames||[];!(u=Kekule.ArrayUtils.exclude(u,["id","owner","ownedObjs"])).length&&o.changedPropNames||this.objectChanged(l,u)},reactOperHistoryPush:function(o){this.invokeEvent("operPush",o)},reactOperHistoryPop:function(o){this.invokeEvent("operPop",o)},reactOperHistoryUndo:function(o){this.invokeEvent("operUndo",o),this.notifyUserModificationDone()},reactOperHistoryRedo:function(o){this.invokeEvent("operRedo",o),this.notifyUserModificationDone()},reactOperHistoryClear:function(o){this.invokeEvent("operHistoryClear",o)},reactOperHistoryChange:function(o){this.invokeEvent("operChange",o)},beginUpdateObject:function(){this._objectUpdateFlag>=0&&this.invokeEvent("beginUpdateObject"),--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag,this.isUpdatingObject()||(this._updatedObjectDetails&&this._updatedObjectDetails.length&&(this.objectsChanged(this._updatedObjectDetails),this._updatedObjectDetails=[]),this._execAfterUpdateObjectProcs(),this.invokeEvent("endUpdateObject"))},isUpdatingObject:function(){return this._objectUpdateFlag<0},_registerAfterUpdateObjectProc:function(o){this.isUpdatingObject()?(this.endUpdateObject.suspendedProcs||(this.endUpdateObject.suspendedProcs=[]),this.endUpdateObject.suspendedProcs.push(o)):o.apply(this)},_execAfterUpdateObjectProcs:function(){var o=this.endUpdateObject.suspendedProcs;if(o)for(;o.length;){var l=o.shift();l&&l.apply(this)}},_mergeObjUpdatedDetails:function(o,l){for(var u=0,c=l.length;u<c;++u)this._mergeObjUpdatedDetailItem(o,l[u])},_mergeObjUpdatedDetailItem:function(o,l){for(var u=0,c=o.length;u<c;++u){var d=o[u];if(d.obj===l.obj)return d.propNames||(d.propNames=[]),void(l.propNames&&Kekule.ArrayUtils.pushUnique(d.propNames,l.propNames))}o.push(l)},_logUpdatedDetail:function(o){var l="";o.forEach(function(u){l+="Obj: "+u.obj.getId()+"["+u.obj.getClassName()+"]     ",l+="Props: ["+u.propNames.join(", ")+"]",l+=`
`}),console.log(l)},objectChanged:function(o,l){var u={obj:o,propNames:l},c=this.objectsChanged(u);return this.invokeEvent("editObjChanged",Object.extend({},u)),c},objectsChanged:function(o){var l=DataType.isArrayValue(o)?o:[o];if(this.isUpdatingObject())this._mergeObjUpdatedDetails(this._updatedObjectDetails,l);else{var u=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(l);this.doObjectsChanged(l,u),this.requestAutoCheckIssuesIfNecessary(),this.invokeEvent("editObjsUpdated",{details:Object.extend({},o)})}this._objChanged=!0,this.invokeEvent("editObjsChanged",{details:Object.extend({},o)});var c=this.getSelection();if(c&&u){var d=e.intersect(c,u);d.length&&this.invokeEvent("selectedObjsUpdated",{objs:d})}},doObjectsChanged:function(o,l){var u=Kekule.ArrayUtils.clone(o);l||(l=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(u));var c=this._getAdditionalRenderRelatedObjs(l);if(c.length){var d=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(c);Kekule.ArrayUtils.pushUnique(u,d)}Kekule.ArrayUtils.pushUnique(l,c);var h=this._operatingRenderers,p=h&&this._isAllObjsRenderedByRenderers(this.getObjContext(),l,h);this.canModifyPartialGraphic()?(this.getRootRenderer().modify(this.getObjContext(),u),this.recalcUiMarkers()):p?this.repaintOperContext():this.repaint()},beginManipulateObject:function(){this._objectManipulateFlag>=0&&this.invokeEvent("beginManipulateObject"),--this._objectManipulateFlag},endManipulateObject:function(){++this._objectManipulateFlag,this.isManipulatingObject()||(this._objectManipulateFlag=0,this.doManipulationEnd(),this.requestAutoCheckIssuesIfNecessary())},isManipulatingObject:function(){return this._objectManipulateFlag<0},doManipulationEnd:function(){this.setOperationsInCurrManipulation([]),this.invokeEvent("endManipulateObject"),this.notifyUserModificationDone()},beginManipulateAndUpdateObject:function(){this.beginManipulateObject(),this.beginUpdateObject()},endManipulateAndUpdateObject:function(){this.endUpdateObject(),this.endManipulateObject()},notifyUserModificationDone:function(){this.invokeEvent("userModificationDone")},_needToCanonicalizeBeforeSaving:function(){return!0},_getAdditionalRenderRelatedObjs:function(o){for(var l=[],u=0,c=o.length;u<c;++u){var d=o[u],h=d.getCoordDeterminateObjects?d.getCoordDeterminateObjects():[];Kekule.ArrayUtils.pushUnique(l,h)}return l},_isAllObjsRenderedByRenderers:function(o,l,u){for(var c=0,d=l.length;c<d;++c){for(var h=l[c],p=!1,g=0,f=u.length;g<f;++g)if(u[g].isChemObjRenderedBySelf(o,h)){p=!0;break}if(!p)return!1}return!0},prepareOperatingObjs:function(o){this._operatingRenderers&&this._operatingRenderers.length&&this.endOperatingObjs(!0),this.getEnableOperContext()&&(this._prepareRenderObjsInOperContext(o),this._operatingObjs=o),this.repaint()},endOperatingObjs:function(o){this.getEnableOperContext()&&(this._endRenderObjsInOperContext(),this._operatingObjs=null,o||this.repaint())},_isChemObjDirectlyRenderedByRenderer:function(o,l,u){var c=l.getStandaloneAncestor?l.getStandaloneAncestor():l;return u.isChemObjRenderedDirectlyBySelf(o,c)},_getStandaloneRenderObjsInOperContext:function(o){for(var l=[],u=0,c=o.length;u<c;++u){var d=o[u];d.getStandaloneAncestor&&(d=d.getStandaloneAncestor()),Kekule.ArrayUtils.pushUnique(l,d)}return l},_prepareRenderObjsInOperContext:function(o){for(var l=[],u=this.getObjRendererMap().getValues(),c=this.getObjContext(),d=this._getStandaloneRenderObjsInOperContext(o),h=0,p=d.length;h<p;++h)for(var g=d[h],f=0,m=u.length;f<m;++f)(C=u[f]).isChemObjRenderedDirectlyBySelf(c,g)&&Kekule.ArrayUtils.pushUnique(l,C);if(l.length>0){for(h=0,p=l.length;h<p;++h){var C=l[h];this._setRendererToOperContext(C)}this._operatingRenderers=l}else this._operatingRenderers=null},_endRenderObjsInOperContext:function(){var o=this._operatingRenderers;if(o&&o.length){for(var l=0,u=o.length;l<u;++l){var c=o[l];this._unsetRendererToOperContext(c)}this.clearOperContext()}this._operatingRenderers=null},_setRendererToOperContext:function(o){o.setRedirectContext(this.getOperContext())},_unsetRendererToOperContext:function(o){o.setRedirectContext(null)},getInteractionBoundInflation:function(o){var l=this._lengthCaches.interactionBoundInflations,u=o||"default";if(l&&l[u])return l[u];var c,d=this.getEditorConfigs().getInteractionConfigs(),h=d.getPropValue("objBoundTrackInflationRatio");if(o){var p=o.upperFirst(),g="objBoundTrackInflationRatio"+p;d.hasProperty(g)&&(c=d.getPropValue(g))}var f,m=c||h,C=m&&this.getDefBondScreenLength()*m,_=d.getPropValue("objBoundTrackMinInflation");if(o){var y="objBoundTrackMinInflation"+p;d.hasProperty(y)&&(f=d.getPropValue(y))}var T=f||_,E=Math.max(C||0,T);return l||(l={},this._lengthCaches.interactionBoundInflations=l),l[u]=E,E},getBoundInfosAtCoord:function(o,l,u){var c=u||this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation();return this.tryApplySuper("getBoundInfosAtCoord",[o,l,c])},getTopmostBoundInfoAtCoord:function(o,l,u){if(!this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest())return this.tryApplySuper("getTopmostBoundInfoAtCoord",[o,l,u]);for(var c,d,h,p=Kekule.Render.MetaShapeUtils,g=this.getBoundInfosAtCoord(o,null,u),f=function(T,E,b){c=T,d=E||T.boundInfo,h=Kekule.ObjUtils.notUnset(b)?b:p.getDistance(o,d)},m=g.length-1;m>=0;--m){var C=g[m];if(!(l&&l.indexOf(C.obj)>=0))if(c){var _=C.boundInfo;if(_.shapeType<d.shapeType)f(C,_);else if(_.shapeType===d.shapeType){var y=p.getDistance(o,_);y<h&&f(C,_,y)}}else f(C)}return c},getBasicObjectsAtCoord:function(o,l,u,c){var d=this.getBoundInfosAtCoord(o,null,l),h=[];if(d){u&&(d=e.filter(d,function(C){var _=d[f].obj;return!!_&&!(_&&u&&u.indexOf(_)>=0)}));var p=function(C){return C&&C.getCoordStickTarget&&C.getCoordStickTarget()?1:0};if(d.sort(function(C,_){return p(C.obj)-p(_.obj)}),this.getEditorConfigs().getInteractionConfigs().getEnableTrackOnNearest()){var g=Kekule.Render.MetaShapeUtils;d.sort(function(C,_){var y=0,T=C.boundInfo,E=_.boundInfo;return(y=-(T.shapeType-E.shapeType))||(y=-(g.getDistance(o,T)-g.getDistance(o,E))),y})}for(var f=d.length-1;f>=0;--f){var m=d[f].obj;m&&u&&u.indexOf(m)>=0||h.push(m)}h&&c&&(h=e.filter(h,function(C){for(var _=0,y=c.length;_<y;++_)if(C instanceof c[_])return!0;return!1}))}return h},getTopmostBasicObjectAtCoord:function(o,l,u){var c=this.getBasicObjectsAtCoord(o,l,null,u);return c&&c[0]},getChemObjBounds:function(o,l){var u=[],c=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),o);if(c&&c.length)for(var d=0,h=c.length;d<h;++d){var p=c[d].boundInfo;p&&(p=Kekule.Render.MetaShapeUtils.inflateShape(p,l),u.push(p))}return u},getUiMarkersAtCoord:function(o,l,u){for(var c=this.getUiMarkers(),d=u&&u.length?function(C){for(var _=0,y=u.length;_<y;++_)if(C instanceof u[_])return!0;return!1}:null,h=Kekule.Render.MetaShapeUtils,p=[],g=c.getMarkerCount()-1;g>=0;--g){var f=c.getMarkerAt(g);if(f.getVisible()&&(!d||d(f))){var m=f.shapeInfo;h.isCoordInside(o,m,l)&&p.push(f)}}return p},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag,this.isUpdatingUiMarkers()||this.repaintUiMarker()},isUpdatingUiMarkers:function(){return this._uiMarkerUpdateFlag<0},recalcUiMarkers:function(){if(this.getUiDrawBridge()){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker(),this.recalcSelectionAreaMarker(),this.recalcIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},repaintUiMarker:function(){if(!this.isUpdatingUiMarkers()&&this.getUiDrawBridge()&&this.getUiContext()){this.clearUiContext();var o=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),o.baseCoord,o.drawOptions)}},createShapeBasedMarker:function(o,l,u,c){var d=new Kekule.ChemWidget.MetaShapeUIMarker;return l&&d.setShapeInfo(l),u&&d.setDrawStyles(u),this.setPropStoreFieldValue(o,d),this.getUiMarkers().addMarker(d),c&&this.repaintUiMarker(),d},modifyShapeBasedMarker:function(o,l,u,c){Kekule.Render.ObjectUpdateType.MODIFY,l&&o.setShapeInfo(l),u&&o.setDrawStyles(u),c&&this.repaintUiMarker()},hideUiMarker:function(o,l){o.setVisible(!1),l&&this.repaintUiMarker()},showUiMarker:function(o,l){o.setVisible(!0),l&&this.repaintUiMarker()},removeUiMarker:function(o){o&&(this.getUiMarkers().removeMarker(o),this.repaintUiMarker())},clearUiMarkers:function(){this.getUiMarkers().clearMarkers(),this.repaintUiMarker()},changeHotTrackMarkerBounds:function(o){for(var l=Kekule.ArrayUtils.toArray(o),u=this.getEditorConfigs().getUiMarkerConfigs(),c={color:u.getHotTrackerColor(),opacity:u.getHotTrackerOpacity()},d=this.getCurrBoundInflation()||this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackMinInflation(),h=[],p=0,g=l.length;p<g;++p){var f=l[p],m=d?Kekule.Render.MetaShapeUtils.inflateShape(f,d):f;m&&h.push(m)}var C=this.getUiHotTrackMarker();return C.setVisible(!0),this.modifyShapeBasedMarker(C,h,c,!0),this},hideHotTrackMarker:function(){var o=this.getUiHotTrackMarker();return o&&this.hideUiMarker(o,!0),this},showHotTrackMarker:function(){var o=this.getUiHotTrackMarker();return o&&this.showUiMarker(o,!0),this},hotTrackOnCoord:function(o){return this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()&&this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(o,this.getCurrBoundInflation())),this},hotTrackOnObj:function(o){return this.setHotTrackedObj(o),this},hideHotTrack:function(o){return this.hideHotTrackMarker(),o||this.clearHotTrackedObjs(),this},clearHotTrackedObjs:function(){this.setHotTrackedObjs([])},addHotTrackedObj:function(o){var l=this.getHotTrackedObjs()||[];return Kekule.ArrayUtils.pushUnique(l,o),this.setHotTrackedObjs(l),this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},updateHintForChemObject:function(o){var l=this.getEditClientElem();if(l){var u=o||"";u&&this.updateHintForChemObject._cache==u&&(u+="\f"),l.title=u,u&&(this.updateHintForChemObject._cache=u)}},getChemObjHint:function(o){return null},getChemObjsHint:function(o){for(var l=[],u=0,c=o.length;u<c;++u){var d=this.getChemObjHint(o[u]);d&&e.pushUnique(l,d)}var h=this._getChemObjsRelatedIssuesHints(o);return h.length&&e.pushUnique(l,h),l.length?l.join(`
`):null},_getChemObjsRelatedIssuesHints:function(o){var l=[];if(this.getEnableIssueMarkerHint()&&this.getEnableIssueCheck())for(var u=this.getObjectsRelatedIssueItems(o,!0)||[],c=0,d=u.length;c<d;++c){var h=u[c].getMessage();e.pushUnique(l,h)}return l},issueCheckResultsChanged:function(){this.recalcIssueCheckUiMarkers();var o=this.getActiveIssueCheckResult();if(o&&this.getEnableAutoScrollToActiveIssue()){var l=o.getTargets();if(l&&l.length){var u=this._getExposedSelfOrParentObjs(l);u&&u.length&&this.getObjectsBoxAndClientBoxRelation(u)!==Kekule.IntersectionState.CONTAINED&&this.scrollClientToObject(u)}}},_needShowInactiveIssueMarkers:function(){return this.getEnableIssueCheck()&&this.getShowAllIssueMarkers()},recalcIssueCheckUiMarkers:function(){if(this.getChemObjLoaded()){this.beginUpdateUiMarkers();try{var o=this.getIssueCheckResults()||[];if(o.length&&this.getEnableIssueCheck()){var l=this._needShowInactiveIssueMarkers(),u=this.getActiveIssueCheckResult();this.getActiveIssueCheckUiMarker().setVisible(!!u);for(var c=this._groupUpIssueObjects(o,u,!0),d=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),h=Kekule.ErrorLevel.getAllLevels().concat("active"),p=0,g=h.length;p<g;++p){var f=[],m=h[p],C=c[m],_=C?C.level:m;if(C){var y=m==="active";if(y||l)for(var T=C.objs,E=0,b=T.length;E<b;++E)for(var v=T[E],I=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),v),R=0,N=I.length;R<N;++R){var L=I[R].boundInfo;L&&(L=Kekule.Render.MetaShapeUtils.inflateShape(L,d),f.push(L))}}this.changeIssueCheckUiMarkerBound(_,f,y)}}else this.hideIssueCheckUiMarkers()}finally{this.endUpdateUiMarkers()}}},changeIssueCheckUiMarkerBound:function(o,l,u){var c=u?this.getActiveIssueCheckUiMarker():this.getIssueCheckUiMarker(o);if(c)if(l&&l.length){var d=Kekule.ErrorLevel.levelToString(o),h=this.getEditorConfigs().getUiMarkerConfigs(),p=h.getIssueCheckMarkerColors()[d],g={strokeColor:u?p.activeStrokeColor:p.strokeColor,strokeWidth:u?h.getIssueCheckActiveMarkerStrokeWidth():h.getIssueCheckMarkerStrokeWidth(),fillColor:u?p.activeFillColor:p.fillColor,opacity:u?h.getIssueCheckActiveMarkerOpacity():h.getIssueCheckMarkerOpacity()};c.setVisible(!0),this.modifyShapeBasedMarker(c,l,g,!0)}else c.setVisible(!1);return this},_getExposedSelfOrParentObjs:function(o){for(var l=[],u=0,c=o.length;u<c;++u){var d=o[u];if(!d.isExposed||d.isExposed())l.push(d);else if(d.getExposedAncestor){var h=d.getExposedAncestor();h&&l.push(h)}}return l},_groupUpIssueObjects:function(o,l,u){for(var c={},d=0,h=o.length;d<h;++d){var p=o[d],g=p.getTargets(),f=p.getLevel();l&&p===l?c.active={level:f,objs:u?this._getExposedSelfOrParentObjs(g):g}:(c[f]||(c[f]={level:f,objs:[]}),c[f].objs=c[f].objs.concat(u?this._getExposedSelfOrParentObjs(g):g))}var m=Kekule.ErrorLevel,C=[m.LOG,m.NOTE,m.WARNING,m.ERROR,"active"];for(d=0,h=C.length;d<h;++d){var _=c[d]&&c[d].objs;if(_)for(var y=d+1,T=C.length;y<T;++y){var E=c[y]&&c[y].objs;if(E){var b=e.exclude(_,E);c[d].objs=b}}}return c},hideIssueCheckUiMarkers:function(){for(var o=this.getAllIssueCheckUiMarkers()||[],l=0,u=o.length;l<u;++l)this.hideUiMarker(o[l])},isObjectRelatedToIssue:function(o,l,u){if((l.getTargets()||[]).indexOf(o)>=0)return!0;if(u){var c=o.getParent();return!!c&&this.isObjectRelatedToIssue(c,l,u)}},getObjectIssueItems:function(o,l){var u=this.getIssueCheckResults()||[];if(u.length&&this.getEnableIssueCheck()){for(var c=[],d=0,h=u.length;d<h;++d){var p=u[d];this.isObjectRelatedToIssue(o,p,l)&&c.push(p)}return c}return[]},getObjectsRelatedIssueItems:function(o,l){if(!(this.getIssueCheckResults()||[]).length||!this.getEnableIssueCheck())return[];var u=[],c=[].concat(o);if(l)for(var d=0,h=o.length;d<h;++d)e.pushUnique(c,o[d].getParentList());for(d=0,h=c.length;d<h;++d){var p=this.getObjectIssueItems(c[d],!1);e.pushUnique(u,p)}return u},changeSelectionAreaMarkerBound:function(o,l){var u=this.getEditorConfigs().getUiMarkerConfigs();l||(l={strokeColor:u.getSelectionMarkerStrokeColor(),strokeWidth:u.getSelectionMarkerStrokeWidth(),fillColor:u.getSelectionMarkerFillColor(),opacity:u.getSelectionMarkerOpacity()});var c=this.getUiSelectionAreaMarker();return c&&(c.setVisible(!0),this.modifyShapeBasedMarker(c,o,l,!0)),this},hideSelectionAreaMarker:function(){var o=this.getUiSelectionAreaMarker();o&&this.hideUiMarker(o,!0)},showSelectionAreaMarker:function(){var o=this.getUiSelectionAreaMarker();o&&this.showUiMarker(o,!0)},recalcSelectionAreaMarker:function(o){this.beginUpdateUiMarkers();try{var l=this.getSelection(),u=l.length;if(u<=0)this.hideSelectionAreaMarker();else{for(var c=[],d=null,h=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation(),p=0;p<u;++p){var g=l[p],f=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),g);if(f&&f.length)for(var m=0,C=f.length;m<C;++m){var _=f[m].boundInfo;if(_){_=Kekule.Render.MetaShapeUtils.inflateShape(_,h),c.push(_);var y=Kekule.Render.MetaShapeUtils.getContainerBox(_);d=d?Kekule.BoxUtils.getContainerBox(d,y):y}}}if(this.setUiSelectionAreaContainerBox(d),d){var T=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:d.x1,y:d.y1},{x:d.x2,y:d.y2}]);c.push(T)}else this.hideSelectionAreaMarker();c.length&&this.changeSelectionAreaMarkerBound(c)}}finally{this.endUpdateUiMarkers()}},_highlightSelectionAreaMarker:function(){var o=this.getEditorConfigs().getUiMarkerConfigs(),l={strokeColor:o.getSelectionMarkerStrokeColor(),strokeWidth:o.getSelectionMarkerStrokeWidth(),fillColor:o.getSelectionMarkerFillColor(),opacity:o.getSelectionMarkerEmphasisOpacity()};this.changeSelectionAreaMarkerBound(null,l)},_restoreSelectionAreaMarker:function(){var o=this.getEditorConfigs().getUiMarkerConfigs(),l={strokeColor:o.getSelectionMarkerStrokeColor(),strokeWidth:o.getSelectionMarkerStrokeWidth(),fillColor:o.getSelectionMarkerFillColor(),opacity:o.getSelectionMarkerOpacity()};this.changeSelectionAreaMarkerBound(null,l)},pulseSelectionAreaMarker:function(o,l){if(this.getUiSelectionAreaMarker()){if(o||(o=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseDuration()||0),l||(l=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerDefPulseCount()||1),!o)return;var u=o/l;this.doPulseSelectionAreaMarker(u,l)}return this},doPulseSelectionAreaMarker:function(o,l){this._highlightSelectionAreaMarker(),setTimeout(this._restoreSelectionAreaMarker.bind(this),o),l>1&&setTimeout(this.doPulseSelectionAreaMarker.bind(this,o,l-1),2*o)},startSelecting:function(o,l){l===void 0&&(l=this.getIsToggleSelectOn()),l||this.deselectAll();var u=Kekule.Editor.SelectMode,c=this.getSelectMode();return this._currSelectMode=c,c===u.POLYLINE||c===u.POLYGON?this.startSelectingCurveDrag(o,l):this.startSelectingBoxDrag(o,l)},addSelectingAnchorCoord:function(o){var l=Kekule.Editor.SelectMode,u=this._currSelectMode;return u===l.POLYLINE||u===l.POLYGON?this.dragSelectingCurveToCoord(o):this.dragSelectingBoxToCoord(o)},endSelecting:function(o,l){l===void 0&&(l=this.getIsToggleSelectOn());var u,c=Kekule.Editor.SelectMode,d=this._currSelectMode,h=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();if(d===c.POLYLINE||d===c.POLYGON){var p=this._selectingCurveCoords,g=this.getEditorConfigs().getInteractionConfigs().getSelectingCurveSimplificationDistanceThreshold(),f=Kekule.GeometryUtils.simplifyCurveToLineSegments(p,g);if(this.endSelectingCurveDrag(o,l),d===c.POLYLINE){var m=this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth();u=this.getObjectsIntersetExtendedPolyline(f,m)}else u=this.getObjectsInPolygon(f,h),this.endSelectingCurveDrag(o,l)}else{var C=this._selectingBoxStartCoord,_=Kekule.BoxUtils.createBox(C,o);u=this.getObjectsInScreenBox(_,h),this.endSelectingBoxDrag(o,l)}u=this._getActualSelectedObjsInSelecting(u),l?this.toggleSelectingState(u):this.select(u),this.hideSelectingMarker()},cancelSelecting:function(){this.hideSelectingMarker()},_getActualSelectedObjsInSelecting:function(o){return o&&o.length?(this._isInAncestorSelectMode()&&(o=this._getAllStandaloneAncestorObjs(o)),o):[]},_isInAncestorSelectMode:function(){return this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},_getAllStandaloneAncestorObjs:function(o){for(var l=[],u=0,c=o.length;u<c;++u){var d=o[u];d&&d.getStandaloneAncestor&&(d=d.getStandaloneAncestor()),e.pushUnique(l,d)}return l},startSelectingBoxDrag:function(o,l){this._selectingBoxStartCoord=o},dragSelectingBoxToCoord:function(o){var l=this._selectingBoxStartCoord,u=o;this.changeSelectingMarkerBox(l,u)},endSelectingBoxDrag:function(o,l){this._selectingBoxStartCoord,this._selectingBoxEndCoord=o},startSelectingCurveDrag:function(o,l){this._selectingCurveCoords=[o]},dragSelectingCurveToCoord:function(o){this._selectingCurveCoords.push(o),this.changeSelectingMarkerCurve(this._selectingCurveCoords,this._currSelectMode===Kekule.Editor.SelectMode.POLYGON)},endSelectingCurveDrag:function(o,l){this._selectingCurveCoords.push(o)},selectOnCoord:function(o,l){l===void 0&&(l=this.getIsToggleSelectOn());var u=this.getTopmostBasicObjectAtCoord(o,this.getCurrBoundInflation());if(u){var c=this._getActualSelectedObjsInSelecting([u]);c&&(l?this.toggleSelectingState(c):this.select(c))}},changeSelectingMarkerBound:function(o,l){var u=this.getEditorConfigs().getUiMarkerConfigs();l||(l={strokeColor:u.getSelectingMarkerStrokeColor(),strokeWidth:u.getSelectingMarkerStrokeWidth(),strokeDash:u.getSelectingMarkerStrokeDash(),fillColor:u.getSelectingMarkerFillColor(),opacity:u.getSelectingMarkerOpacity()});var c=this.getUiSelectingMarker();return c.setVisible(!0),this.modifyShapeBasedMarker(c,o,l,!0),this},changeSelectingMarkerCurve:function(o,l){for(var u=[],c=0,d=o.length-1;c<d;++c)u.push(this.screenCoordToContext(o[c]));var h,p=Kekule.Render.MetaShapeUtils.createShapeInfo(l?Kekule.Render.MetaShapeType.POLYGON:Kekule.Render.MetaShapeType.POLYLINE,u);if(!l){var g=this.getEditorConfigs().getUiMarkerConfigs();h={strokeColor:g.getSelectingBrushMarkerStrokeColor(),strokeWidth:this.getEditorConfigs().getInteractionConfigs().getSelectingBrushWidth(),strokeDash:g.getSelectingBrushMarkerStrokeDash(),lineCap:g.getSelectingBrushMarkerStrokeLineCap(),lineJoin:g.getSelectingBrushMarkerStrokeLineJoin(),opacity:g.getSelectingBrushMarkerOpacity()}}return this.changeSelectingMarkerBound(p,h)},changeSelectingMarkerBox:function(o,l){var u=this.screenCoordToContext(o),c=this.screenCoordToContext(l),d=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:Math.min(u.x,c.x),y:Math.min(u.y,c.y)},{x:Math.max(u.x,c.x),y:Math.max(u.y,c.y)}]);return this.changeSelectingMarkerBound(d)},hideSelectingMarker:function(){var o=this.getUiSelectingMarker();o&&this.hideUiMarker(o,!0)},showSelectingMarker:function(){var o=this.getUiSelectingMarker();o&&this.showUiMarker(o,!0)},getCoordRegionInSelectionMarker:function(o,l){var u=Kekule.Editor.BoxRegion,c=Kekule.CoordUtils,d=this.screenCoordToContext(o),h=this.getUiSelectionAreaMarker();if(h&&h.getVisible()){var p=this.getUiSelectionAreaContainerBox();Kekule.ObjUtils.isUnset(l)&&(l=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation());var g=l/2||0,f=c.substract({x:p.x1,y:p.y1},{x:g,y:g}),m=c.add({x:p.x2,y:p.y2},{x:g,y:g});if(d.x<f.x||d.y<f.y||d.x>m.x||d.y>m.y)return u.OUTSIDE;var C=c.substract(d,f),_=c.substract(m,d),y=C.x,T=_.x,E=C.y,b=_.y;return E<b?y<T?E<=l?y<=l?u.CORNER_TL:u.EDGE_TOP:y<=l?u.EDGE_LEFT:u.INSIDE:E<=l?T<=l?u.CORNER_TR:u.EDGE_TOP:T<=l?u.EDGE_RIGHT:u.INSIDE:y<T?b<=l?y<=l?u.CORNER_BL:u.EDGE_BOTTOM:y<=l?u.EDGE_LEFT:u.INSIDE:b<=l?T<=l?u.CORNER_BR:u.EDGE_BOTTOM:T<=l?u.EDGE_RIGHT:u.INSIDE}return u.OUTSIDE},isCoordInSelectionMarkerBound:function(o){return this.getCoordRegionInSelectionMarker(o)!==Kekule.Editor.BoxRegion.OUTSIDE},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(o){return this.getRenderType()===Kekule.Render.RendererType.R3D?o.addOverrideRender3DOptionItem:o.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(o){return this.getRenderType()===Kekule.Render.RendererType.R3D?o.removeOverrideRender3DOptionItem:o.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(o){var l=this.getObjSelectedRenderOptions();return l?this._getObjRenderOptionItemAppendMethod(o).apply(o,[l]):null},_removeSelectRenderOptions:function(o){return this.getObjSelectedRenderOptions()?this._getObjRenderOptionItemRemoveMethod(o).apply(o,[this.getObjSelectedRenderOptions()]):null},beginUpdateSelection:function(){this.beginUpdateObject(),--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag,this._objSelectFlag>=0&&this.selectionChanged(),this.endUpdateObject()},isUpdatingSelection:function(){return this._objSelectFlag<0},selectionChanged:function(){if(!this.isUpdatingSelection())return this.notifyPropSet("selection",this.getSelection()),this.invokeEvent("selectionChange"),this.doSelectionChanged()},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(o){return!!o&&this.getSelection().indexOf(o)>=0},addObjToSelection:function(o){if(!o)return this;var l=this.getSelection();return Kekule.ArrayUtils.pushUnique(l,o.getNearestSelectableObject()),this._addSelectRenderOptions(o),this.selectionChanged(),this},removeObjFromSelection:function(o,l){if(!o)return this;var u=this.getSelection(),c=o.getNearestSelectableObject&&o.getNearestSelectableObject();Kekule.ArrayUtils.remove(u,o),this._removeSelectRenderOptions(o),c&&(Kekule.ArrayUtils.remove(u,c),this._removeSelectRenderOptions(c));for(var d=u.length-1;d>=0;--d){var h=u[d];h.isChildOf&&(h.isChildOf(o)||c&&h.isChildOf(c))&&this.removeObjFromSelection(h,!0)}return l||this.selectionChanged(),this},selectAll:function(){var o=[],l=this.getChemObj();if(l){var u=l.getChildren()||[];o=u.length?u:[l]}return this.select(o)},deselectAll:function(){var o=this.getSelection();return this.removeFromSelection(o)},select:function(o){this.beginUpdateSelection();try{this.deselectAll(),this.addToSelection(o)}finally{this.endUpdateSelection()}return this},addToSelection:function(o){if(o){var l=DataType.isArrayValue(o)?o:[o];this.beginUpdateSelection();try{for(var u=0,c=l.length;u<c;++u)this.addObjToSelection(l[u])}finally{this.endUpdateSelection()}return this}},removeFromSelection:function(o){if(o){var l=DataType.isArrayValue(o)?o:[o];this.beginUpdateSelection();try{for(var u=l.length-1;u>=0;--u)this.removeObjFromSelection(l[u])}finally{this.endUpdateSelection()}return this}},toggleSelectingState:function(o){if(o){var l=DataType.isArrayValue(o)?o:[o];this.beginUpdateSelection();try{for(var u=0,c=l.length;u<c;++u){var d=l[u],h=d.getNearestSelectableObject&&d.getNearestSelectableObject();this.isInSelection(d)?this.removeObjFromSelection(d):h&&this.isInSelection(h)?this.removeObjFromSelection(h):this.addObjToSelection(d)}}finally{this.endUpdateSelection()}return this}},hasSelection:function(){return!!this.getSelection().length},deleteSelectedObjs:function(){},requestAutoCheckIssuesIfNecessary:function(){this.getEnableAutoIssueCheck()&&this._tryCheckIssueOnIdle()},_tryCheckIssueOnIdle:function(){return this.isUpdatingObject()||this.isManipulatingObject()?null:this.checkIssues()},createIssueCheckExecutor:function(){return new Kekule.IssueCheck.ExecutorForEditor(this)},checkIssues:function(o){var l=null,u=o||this.getChemObj();return u&&this.getEnableIssueCheck()&&(l=this.getIssueCheckExecutor(!0).execute(u)),l},getObjectsIntersetExtendedPolyline:function(o,l){for(var u=[],c=0,d=o.length;c<d;++c)u.push(this.screenCoordToContext(o[c]));var h=[],p=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),g=Kekule.Render.MetaShapeUtils.isIntersectingPolyline;for(c=0,d=p.length;c<d;++c){var f=p[c],m=f.boundInfo;m&&g(m,u,l)&&h.push(f.obj)}return h},getObjectsInPolygon:function(o,l){for(var u=[],c=0,d=o.length;c<d;++c)u.push(this.screenCoordToContext(o[c]));var h=[],p=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),g=l?Kekule.Render.MetaShapeUtils.isIntersectingPolygon:Kekule.Render.MetaShapeUtils.isInsidePolygon;for(c=0,d=p.length;c<d;++c){var f=p[c],m=f.boundInfo;m&&g(m,u)&&h.push(f.obj)}return h},getObjectsInScreenBox:function(o,l){for(var u=this.screenBoxToContext(o),c=[],d=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext()),h=l?Kekule.Render.MetaShapeUtils.isIntersectingBox:Kekule.Render.MetaShapeUtils.isInsideBox,p=0,g=d.length;p<g;++p){var f=d[p],m=f.boundInfo;m&&h(m,u)&&c.push(f.obj)}return c},selectObjectsInScreenBox:function(o,l){var u=this.getObjectsInScreenBox(o,l);return u&&u.length&&this.select(u),u},addObjectsInScreenBoxToSelection:function(o,l){var u=this.getObjectsInScreenBox(o,l);return u&&u.length&&this.addToSelection(u),u},removeObjectsInScreenBoxFromSelection:function(o,l){var u=this.getObjectsInScreenBox(o,l);return u&&u.length&&this.removeFromSelection(u),u},toggleSelectingStateOfObjectsInScreenBox:function(o,l){var u=this.getObjectsInScreenBox(o,l);return u&&u.length&&this.toggleSelectingState(u),u},getObjectsContainerBox:function(o,l){for(var u=Kekule.ArrayUtils.toArray(o),c=l||0,d=null,h=0,p=u.length;h<p;++h){var g=u[h],f=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),g);if(f&&f.length)for(var m=0,C=f.length;m<C;++m){var _=f[m].boundInfo;if(_){c&&(_=Kekule.Render.MetaShapeUtils.inflateShape(_,c));var y=Kekule.Render.MetaShapeUtils.getContainerBox(_);d=d?Kekule.BoxUtils.getContainerBox(d,y):y}}}return d},getObjectsBoxAndClientBoxRelation:function(o){var l=this.getObjectsContainerBox(o);if(l){var u=this.getVisibleClientScreenBox();return Kekule.BoxUtils.getIntersectionState(l,u)}},getSelectionContainerBox:function(o){return this.getObjectsContainerBox(this.getSelection(),o)},isSelectionVisible:function(){var o=this.getSelectionContainerBox();if(o){var l=this.getVisibleClientScreenBox();return Kekule.BoxUtils.hasIntersection(o,l)}return!1},getObjSize:function(o){return this.doGetObjSize(o)},doGetObjSize:function(o){var l=this.getCoordMode();return o.getSizeOfMode?o.getSizeOfMode(l):null},setObjSize:function(o,l){this.doSetObjSize(o,l),this.objectChanged(o)},doSetObjSize:function(o,l){o.setSizeOfMode&&o.setSizeOfMode(l,this.getCoordMode())},getObjCoord:function(o,l){return this.doGetObjCoord(o,l)},doGetObjCoord:function(o,l){if(!o)return null;var u=this.getCoordMode(),c=this.getAllowCoordBorrow(),d=o.getAbsBaseCoord?o.getAbsBaseCoord(u,c):o.getAbsCoordOfMode?o.getAbsCoordOfMode(u,c):o.getCoordOfMode?o.getCoordOfMode(u,c):null;if(u===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(l)&&l!==Kekule.Render.CoordPos.DEFAULT){c=this.getAllowCoordBorrow();var h=o.getExposedContainerBox?o.getExposedContainerBox(u,c):o.getContainerBox?o.getContainerBox(u,c):null;if(h&&l===Kekule.Render.CoordPos.CORNER_TL){var p={x:(h.x2-h.x1)/2,y:(h.y2-h.y1)/2};d.x=d.x-p.x,d.y=d.y+p.y}}return d},setObjCoord:function(o,l,u){this.doSetObjCoord(o,l,u),this.objectChanged(o)},doSetObjCoord:function(o,l,u){var c=Object.create(l),d=this.getCoordMode();if(d===Kekule.CoordMode.COORD2D&&Kekule.ObjUtils.notUnset(u)&&u!==Kekule.Render.CoordPos.DEFAULT){var h=this.getAllowCoordBorrow(),p=o.getExposedContainerBox?o.getExposedContainerBox(d,h):o.getContainerBox?o.getContainerBox(d,h):null;if(p){var g={x:(p.x2-p.x1)/2,y:(p.y2-p.y1)/2};u===Kekule.Render.CoordPos.CORNER_TL&&(c.x=l.x+g.x,c.y=l.y-g.y)}}o.setAbsBaseCoord?o.setAbsBaseCoord(c,d):o.setAbsCoordOfMode?o.setAbsCoordOfMode(c,d):o.setAbsCoordOfMode&&o.setCoordOfMode(c,d)},getObjectContextCoord:function(o,l){var u=this.getObjCoord(o,l);return this.objCoordToContext(u)},setObjectContextCoord:function(o,l,u){var c=this.contextCoordToObj(l);c&&this.setObjCoord(o,c,u)},getObjectScreenCoord:function(o,l){var u=this.getObjCoord(o,l);return this.objCoordToScreen(u)},setObjectScreenCoord:function(o,l,u){var c=this.screenCoordToObj(l);c&&this.setObjCoord(o,c,u)},getCoord:function(o,l,u){var c=this.getObjCoord(o,u);return this.translateCoord(c,Kekule.Editor.CoordSys.OBJ,l)},setCoord:function(o,l,u,c){var d=this.translateCoord(l,u,Kekule.Editor.CoordSys.OBJ);this.setObjCoord(o,d,c)},getSize:function(o,l){var u=this.getObjSize(o);return this.translateCoord(u,Kekule.Editor.CoordSys.OBJ,l)},setSize:function(o,l,u){var c=this.translateCoord(l,u,Kekule.Editor.CoordSys.OBJ);this.setObjSize(o,c)},transformCoordAndSizeOfObjects:function(o,l){var u=this.getCoordMode(),c=this.getAllowCoordBorrow(),d=u===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(l):Kekule.CoordUtils.calcTransform2DMatrix(l),h=Object.extend({},l);h=Object.extend(h,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var p=u===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(h):Kekule.CoordUtils.calcTransform2DMatrix(h),g=0,f=o.length;g<f;++g){var m=o[g];m.transformAbsCoordByMatrix(d,p,u,!0,c),m.scaleSize(l.scale,u,!0,c)}},createDefaultNode:function(o,l,u){var c=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId(),d=new Kekule.Atom;return d.setIsotopeId(c),u&&u.appendNode(d),this.setCoord(d,o,l),d},operationDone:function(o){this.doOperationDone(o)},doOperationDone:function(o){},clearOperHistory:function(){var o=this.getOperHistory();o&&o.clear()},pushOperation:function(o,l){if(o){var u=this.getOperHistory();if(u&&u.push(o),this.getOperationsInCurrManipulation().push(o),l){this.beginUpdateObject();try{o.execute()}finally{this.endUpdateObject()}}}},popOperation:function(o){var l,u=this.getOperHistory();if(u){if(l=u.pop(),o){this.beginUpdateObject();try{l.reverse()}finally{this.endUpdateObject()}}var c=this.getOperationsInCurrManipulation(),d=c.indexOf(l);return d>=0&&c.splice(d,1),l}return null},execOperation:function(o){var l=e.toArray(o);this.beginManipulateAndUpdateObject();try{for(var u=0,c=l.length;u<c;++u){var d=l[u];d.execute(),this.getEnableOperHistory()&&this.pushOperation(d,!1)}}finally{this.endManipulateAndUpdateObject()}return this},execOperations:function(o){if(o.length===1)return this.execOperation(o[0]);var l=new Kekule.MacroOperation(o);return this.execOperation(l)},replaceOperationInHistory:function(o,l){var u=this.getOperHistory();return u&&u.replaceOperation(o,l)},undo:function(){var o,l=this.getOperHistory();if(l){this.beginUpdateObject();try{o=l.undo()}finally{this.endUpdateObject(),o&&this.operationDone(o)}}return o},redo:function(){var o,l=this.getOperHistory();if(l){this.beginUpdateObject();try{o=l.redo()}finally{this.endUpdateObject(),o&&this.operationDone(o)}}return o},undoAll:function(){var o,l=this.getOperHistory();if(l){this.beginUpdateObject();try{o=l.undoAll()}finally{this.endUpdateObject()}}return o},canUndo:function(){var o=this.getOperHistory();return!!o&&o.canUndo()},canRedo:function(){var o=this.getOperHistory();return!!o&&o.canRedo()},modifyObjects:function(o,l,u){var c=Kekule.ArrayUtils.toArray(o);try{for(var d=new Kekule.MacroOperation,h=0,p=c.length;h<p;++h){var g=c[h],f=new Kekule.ChemObjOperation.Modify(g,l,this);d.add(f)}d.execute()}finally{u&&this.getEnableOperHistory()&&d.getChildCount()&&this.pushOperation(d)}return this},modifyObjectsRenderOptions:function(o,l,u,c){var d=Kekule.ArrayUtils.toArray(o),h=u?"render3DOptions":"renderOptions",p=u?"getRender3DOptions":"getRenderOptions";try{for(var g=new Kekule.MacroOperation,f=0,m=d.length;f<m;++f){var C=d[f];if(C[p]){var _=C[p](),y=Object.extend({},_);y=Object.extend(y,l);var T={};T[h]=y;var E=new Kekule.ChemObjOperation.Modify(C,T,this);g.add(E)}}this.beginManipulateAndUpdateObject(),g.execute()}finally{c&&this.getEnableOperHistory()&&g.getChildCount()&&this.pushOperation(g),this.endManipulateAndUpdateObject()}return this},getClientDimension:function(){var o=this.getElement();return{width:o.clientWidth,height:o.clientHeight}},getClientScrollPosition:function(){var o=this.getEditClientElem().parentNode;return o?{x:o.scrollLeft,y:o.scrollTop}:null},getClientScrollCoord:function(o){var l=this.getClientScrollPosition();return s.isUnset(o)||o===Kekule.Editor.CoordSys.SCREEN?l:this.translateCoord(l,Kekule.Editor.CoordSys.SCREEN,o)},getClientVisibleRect:function(){var o=this.getClientDimension(),l=this.getClientScrollPosition();return o.x1=o.left=l.x,o.y1=o.top=l.y,o.x2=o.x1+o.width,o.y2=o.y1+o.height,o},scrollClientTo:function(o,l){return this.scrollClientToCoord({y:o,x:l})},scrollClientToTop:function(){return this.scrollClientTo(0,null)},scrollClientToBottom:function(){var o=this.getEditClientElem(),l=Kekule.HtmlElementUtils.getElemClientDimension(o);return this.scrollClientTo(l.height,null)},scrollClientToCoord:function(o,l,u){var c,d=s.notUnset(o.x),h=s.notUnset(o.y),p=u&&u.scrollToCenter;if(c=s.isUnset(l)?o:this.translateCoord(o,l,Kekule.Editor.CoordSys.SCREEN),p){var g=this.getVisibleClientScreenBox(),f={x:g.width/2,y:g.height/2};c=Kekule.CoordUtils.substract(c,f)}var m=this.getEditClientElem().parentNode;return h&&(m.scrollTop=c.y),d&&(m.scrollLeft=c.x),this},scrollClientToObject:function(o,l){if(Kekule.BoxUtils,!o)return this;var u=this.getChemObj();if(!u)return this;var c=e.toArray(o),d=this._getTargetObjsExposedContainerBoxInfo(c,u),h=d.totalBox,p=d.boxes;if(h){var g=Object.extend({scrollToCenter:!0,coverMostObjs:!0},l||{});return this._scrollClientToContainerBox(h,p,g)}return this},_scrollClientToContainerBox:function(o,l,u){var c,d=Kekule.BoxUtils,h=this.getVisibleClientBoxOfSys(Kekule.Editor.CoordSys.CHEM);c=(o.x2-o.x1>h.x2-h.x1||o.y2-o.y1>h.y2-h.y1)&&u.coverMostObjs?this._getMostIntersectedContainerBox(h.x2-h.x1,h.y2-h.y1,l,o):o;var p=u.scrollToCenter?d.getCenterCoord(c):{x:c.x1,y:c.y2};return this.scrollClientToCoord(p,Kekule.Editor.CoordSys.CHEM,u)},_getTargetObjsExposedContainerBoxInfo:function(o,l){var u=Kekule.BoxUtils;if(l||(l=this.getChemObj()),l)for(var c=null,d=[],h=0,p=o.length;h<p;++h){var g=o[h];if(g.getExposedContainerBox&&g.isChildOf&&g.isChildOf(l)){var f=g.getExposedContainerBox(this.getCoordMode());f&&(d.push(f),c=c?u.getContainerBox(c,f):f)}}return{totalBox:c,boxes:d}},_getMostIntersectedContainerBox:function(o,l,u,c){for(var d,h=Kekule.BoxUtils,p=function(v,I){var R=n.add(v,{x:o*I.x,y:l*I.y});R.x<c.x1?R.x=c.x1:R.x>c.x2&&(R.x=c.x2),R.y<c.y1?R.y=c.y1:R.y>c.y2&&(R.y=c.y2);var N=n.add(R,{x:-o*I.x,y:-l*I.y});return h.createBox(N,R)},g=function(v,I){for(var R=0,N=0,L=I.length;N<L;++N){var U=I[N];h.hasIntersection(U,v)&&++R}return R},f=0,m=0,C=u.length;m<C;++m)for(var _=h.getCornerCoords(u[m]),y=[p(_[0],{x:1,y:1}),p(_[1],{x:1,y:-1}),p(_[2],{x:-1,y:1}),p(_[3],{x:-1,y:-1})],T=0,E=y.length;T<E;++T){var b=g(y[T],u);b>f&&(f=b,d=y[T])}return d},doBeforeDispatchUiEvent:function(o){var l=o.getType();if(["pointerdown","pointermove","pointerup"].indexOf(l)>=0&&(this.setCurrPointerType(o.pointerType),l==="pointermove"&&this.isRenderable())){var u=this._getEventMouseCoord(o,this.getCoreElement()),c=this.getBasicObjectsAtCoord(u,this.getCurrBoundInflation())||[],d=this.getHoveredBasicObjs();this.setPropStoreFieldValue("hoveredBasicObjs",c),d&&c.length===d.length&&e.intersect(d,c).length===c.length||this.notifyHoverOnObjs(c)}return this.tryApplySuper("doBeforeDispatchUiEvent",[o])},notifyHoverOnObjs:function(o){var l=this.getChemObjsHint(o);this.updateHintForChemObject(l),this.invokeEvent("hoverOnObjs",{objs:o})},reactHotKeys:function(o){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotKey()){for(var l=this.getEditorConfigs().getHotKeyConfigs().getHotKeys(),u=Kekule.Widget.KeyboardUtils.getKeyParamsFromEvent(o),c=!1,d=[],h=l.length-1;h>=0;--h){var p=Kekule.Widget.KeyboardUtils.shortcutLabelToKeyParams(l[h].key,null,!1);if(p.repeat=l[h].repeat,Kekule.Widget.KeyboardUtils.matchKeyParams(u,p,!1)){var g=l[h].action;if(g){var f=this.getChildAction(g,!0);if(f)if(f instanceof Kekule.Editor.ActionOperationCreate.Base){var m=f.createOperations(this);(c=!(!m||!m.length)||c)&&(d=d.concat(m))}else c=f.execute(this,o)||c}}}if(d.length&&this.execOperations(d),c)return o.stopPropagation(),o.preventDefault(),!0}},react_keydown:function(o){if(!this.tryApplySuper("react_keydown",[o]))return this.reactHotKeys(o)}}),Kekule.Editor.BaseEditor.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(o){this.getEditor().setEnableCreateNewDoc(o)}}),this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(o){this.getEditor().setInitOnNewDoc(o)}}),this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(o){this.getEditor().setEnableOperHistory(o)}}),this.defineProp("enableIssueCheck",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getEnableIssueCheck()},setter:function(o){this.getEditor().setEnableIssueCheck(o)}})},getEditor:function(){return this.getDisplayer()}}),Kekule.Editor.IaControllerManager={_controllerMap:new Kekule.MapEx(!0),register:function(o,l){a._controllerMap.set(o,l)},unregister:function(o){a._controllerMap.remove(o)},getAllControllerClasses:function(){return a._controllerMap.getKeys()},getAvailableControllerClasses:function(o){for(var l=[],u=a.getAllControllerClasses(),c=0,d=u.length;c<d;++c){var h=u[c],p=a._controllerMap.get(h);p&&!ClassEx.isOrIsDescendantOf(o,p)||l.push(h)}return l}};var a=Kekule.Editor.IaControllerManager;Kekule.Editor.BaseEditorBaseIaController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(o){this.tryApplySuper("initialize",[o])},_defineEditorConfigBasedProperty:function(o,l,u){var c={dataType:DataType.VARIANT,serializable:!1,setter:null};u&&u.overwrite?(c.getter=function(){var h=this.getPropStoreFieldValue(o),p=this.getEditorConfigs();return h&&p.getCascadePropValue(l)},c.setter=function(h){this.setPropStoreFieldValue(o,h)}):c.getter=function(){return this.getEditorConfigs().getCascadePropValue(l)};var d=Object.extend(c,u||{});this.defineProp(o,d)},getDefId:function(){return Kekule.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(o){return this.setWidget(o)},getEditorConfigs:function(){var o=this.getEditor();return o?o.getEditorConfigs():null}}),Kekule.Editor.BaseEditorIaController=Class.create(Kekule.Editor.BaseEditorBaseIaController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function(o){this.tryApplySuper("initialize",[o])},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("currBoundInflation",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getEditor().getCurrBoundInflation()},setter:null}),this.defineProp("activePointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){var o=this.getEditor();return o&&o.getCurrPointerType()||this.getPropStoreFieldValue("activePointerType")},setter:function(o){var l=this.getEditor();l?l.setCurrPointerType(o):this.setStoreFieldValue("activePointerType",o)}})},notifyEditorBeginManipulateObjects:function(){this.getEditor().beginManipulateObject()},notifyEditorEndManipulateObjects:function(){this.getEditor().endManipulateObject()},getInteractionBoundInflation:function(o){return this.getEditor().getInteractionBoundInflation(o)},handleUiEvent:function(o){var l=!1,u=o.getTarget&&o.getTarget()||o.target,c=this.getEditor().getUiEventReceiverElem();c?(u===c||Kekule.DomUtils.isDescendantOf(u,c))&&(l=!0):l=!0,l&&this.tryApplySuper("handleUiEvent",[o])},canInteractWithObj:function(o){return!!o},getInteractableTargetClasses:function(){return null},getAllInteractableObjsAtScreenCoord:function(o){return this.getEditor().getBasicObjectsAtCoord(o,this.getCurrBoundInflation(),null,this.getInteractableTargetClasses())},getTopmostInteractableObjAtScreenCoord:function(o){var l=this.getAllInteractableObjsAtScreenCoord(o);if(l){for(var u=0,c=l.length;u<c;++u)if(this.canInteractWithObj(l[u]))return l[u]}return null},getTopmostInteractableObjAtCurrPointerPos:function(){var o=this.getEditor().getHoveredBasicObjs();if(o){for(var l=0,u=o.length;l<u;++l)if(this.canInteractWithObj(o[l]))return o[l]}return null},hotTrackOnObj:function(o){this.getEditor().hotTrackOnObj(o)},zoomEditor:function(o,l){o>0?this.getEditor().zoomIn(o,l):o<0&&this.getEditor().zoomOut(-o,l)},_filterBasicObjectsInEditor:function(o){for(var l=this.getEditor().getChemObj(),u=[],c=0,d=o.length;c<d;++c){var h=o[c];h.isChildOf(l)&&u.push(h)}return u},doneInsertOrModifyBasicObjects:function(o){if(this.needAutoSelectNewlyInsertedObjects()){var l=this._filterBasicObjectsInEditor(o);this.getEditor().select(l)}},needAutoSelectNewlyInsertedObjects:function(){var o=this.getActivePointerType(),l=this.getEditorConfigs().getInteractionConfigs();return l.getAutoSelectNewlyInsertedObjectsOnTouch()&&o==="touch"||l.getAutoSelectNewlyInsertedObjects()},react_pointerdown:function(o){return this.setActivePointerType(o.pointerType),o.preventDefault(),!0},react_pointermove:function(o){var l=this.getTopmostInteractableObjAtCurrPointerPos();return this.getManuallyHotTrack()||(l?this.hotTrackOnObj(l):this.hotTrackOnObj(null)),o.preventDefault(),!0},react_mousewheel:function(o){if(o.getCtrlKey()){var l=this._getEventMouseCoord(o);try{var u=o.wheelDeltaY||o.wheelDelta;u&&(u/=120),this.zoomEditor(u,l)}finally{}return o.preventDefault(),!0}},_getEventMouseCoord:function(o,l){var u=l||this.getWidget().getCoreElement();return this.tryApplySuper("_getEventMouseCoord",[o,u])}}),Kekule.Editor.ClientDragScrollIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ClientDragScrollIaController",initialize:function(o){this.tryApplySuper("initialize",[o]),this._isExecuting=!1},canInteractWithObj:function(o){return!1},doTestMouseCursor:function(o,l){return this.isExecuting()?["grabbing","-webkit-grabbing","-moz-grabbing","move"]:["grab","-webkit-grab","-moz-grab","pointer"]},isExecuting:function(){return this._isExecuting},startScroll:function(o){this._startCoord=o,this._originalScrollPos=this.getEditor().getClientScrollPosition(),this._isExecuting=!0},endScroll:function(){this._isExecuting=!1,this._startCoord=null,this._originalScrollPos=null},scrollTo:function(o){if(this.isExecuting()){var l=this._startCoord,u=Kekule.CoordUtils.substract(l,o),c=Kekule.CoordUtils.add(this._originalScrollPos,u);this.getEditor().scrollClientTo(c.y,c.x)}},react_pointerdown:function(o){if(this.setActivePointerType(o.pointerType),o.getButton()===Kekule.X.Event.MouseButton.LEFT){if(!this.isExecuting()){var l={x:o.getScreenX(),y:o.getScreenY()};this.startScroll(l),o.preventDefault()}}else o.getButton()===Kekule.X.Event.MouseButton.RIGHT&&this.isExecuting()&&(this.endScroll(),o.preventDefault())},react_pointerup:function(o){o.getButton()===Kekule.X.Event.MouseButton.LEFT&&this.isExecuting()&&(this.endScroll(),o.preventDefault())},react_pointermove:function(o){if(this.tryApplySuper("react_pointermove",[o]),this.isExecuting()){var l={x:o.getScreenX(),y:o.getScreenY()};this.scrollTo(l),o.preventDefault()}return!0}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ClientDragScrollIaController,Kekule.Editor.BaseEditor),Kekule.Editor.BasicEraserIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function(o){this.tryApplySuper("initialize",[o]),this._isExecuting=!1},canInteractWithObj:function(o){return!!o},removeObjs:function(o){if(o&&o.length){var l=this.getEditor();l.beginUpdateObject();try{var u=this.doGetActualRemovedObjs(o);this.doRemoveObjs(u)}finally{l.endUpdateObject()}}},doRemoveObjs:function(o){},doGetActualRemovedObjs:function(o){return o},removeSelection:function(){var o=this.getEditor();this.removeObjs(o.getSelection()),o.deselectAll()},removeOnScreenCoord:function(o){var l=this.getEditor().getTopmostBasicObjectAtCoord(o);return!!l&&(this.removeObjs([l]),!0)},startRemove:function(){this._isExecuting=!0},endRemove:function(){this._isExecuting=!1},isRemoving:function(){return this._isExecuting},reactUiEvent:function(o){var l=this.tryApplySuper("reactUiEvent",[o]),u=o.getType();return["touchstart","touchend","touchcancel","touchmove"].indexOf(u)>=0&&o.preventDefault(),l},react_pointerdown:function(o){if(this.setActivePointerType(o.pointerType),o.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.startRemove();var l=this._getEventMouseCoord(o);this.removeOnScreenCoord(l),o.preventDefault()}else o.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT&&(this.endRemove(),o.preventDefault())},react_pointerup:function(o){o.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&(this.endRemove(),o.preventDefault())},react_pointermove:function(o){if(this.tryApplySuper("react_pointermove",[o]),this.isRemoving()){var l=this._getEventMouseCoord(o);this.removeOnScreenCoord(l),o.preventDefault()}return!0}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicEraserIaController,Kekule.Editor.BaseEditor),Kekule.Editor.BasicManipulationIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function(o){this.tryApplySuper("initialize",[o]),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._suppressConstrainedResize=!1,this._manipulationStepBuffer={},this._suspendedOperations=null,this.execManipulationStepBind=this.execManipulationStep.bind(this)},initProperties:function(){this.defineProp("selectMode",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableGestureManipulation",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("startBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("endBox",{dataType:DataType.HASH,serializable:!1}),this.defineProp("lastRotateAngle",{dataType:DataType.FLOAT,serializable:!1}),this.defineProp("rotateRefCoord",{dataType:DataType.HASH,serializable:!1}),this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:!1,getter:function(){var o=this.getPropStoreFieldValue("rotateCenter");if(!o){var l=this._getManipulateObjsCenterCoord();o=this.getEditor().objCoordToScreen(l),this.setPropStoreFieldValue("rotateCenter",o)}return o}}),this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableAspectRatioLockedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:!1}),this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:!1,setter:function(o){this.setPropStoreFieldValue("manipulateObjs",o),o?this.getEditor().prepareOperatingObjs(o):this.getEditor().endOperatingObjs()}}),this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("manipulateObjInfoMap");return o||(o=new Kekule.MapEx(!0),this.setPropStoreFieldValue("manipulateObjInfoMap",o)),o}}),this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var o=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");return o||(o=new Kekule.MapEx(!0),this.setPropStoreFieldValue("manipulateObjCurrInfoMap",o)),o}}),this.defineProp("manipulationType",{dataType:DataType.INT,serializable:!1}),this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isOffsetManipulating",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("manipulationPointerType",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getActivePointerType()},setter:function(o){this.setActivePointerType(o)}}),this.defineProp("activePointerId",{dataType:DataType.INT,serializable:!1}),this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("moveWrapperOperation",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var o=this.getPropStoreFieldValue("objOperationMap");return o||(o=new Kekule.MapEx(!0),this.setPropStoreFieldValue("objOperationMap",o)),o}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableGestureManipulation(!1);var o=Kekule.globalOptions.get("chemWidget.editor")||{},l=Kekule.oneOf;this.setEnableMove(l(o.enableMove,!0)),this.setEnableResize(l(o.enableResize,!0)),this.setEnableAspectRatioLockedResize(l(o.enableAspectRatioLockedResize,!0)),this.setEnableRotate(l(o.enableRotate,!0))},doFinalize:function(){var o=this.getPropStoreFieldValue("manipulateObjInfoMap");o&&o.clear(),(o=this.getPropStoreFieldValue("objOperationMap"))&&o.clear(),this.tryApplySuper("doFinalize")},hotTrackOnObj:function(o){if(this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR){var l=this.getStandaloneAncestor(o);return o&&o.getStandaloneAncestor&&o.getStandaloneAncestor(),this.tryApplySuper("hotTrackOnObj",[l])}return this.tryApplySuper("hotTrackOnObj",[o])},getStandaloneAncestor:function(o){return o&&o.getStandaloneAncestor?o.getStandaloneAncestor():o},isInAncestorSelectMode:function(){return this.getEnableSelect()&&this.getSelectMode()===Kekule.Editor.SelectMode.ANCESTOR},isAspectRatioLockedResize:function(){return this.getEnableAspectRatioLockedResize()&&!this._suppressConstrainedResize},getCoordOnSelectionRotationRegion:function(o){var l=Kekule.Editor.BoxRegion,u=this.getEditor();if(u.getCoordRegionInSelectionMarker(o)!==l.OUTSIDE)return!1;var c=u.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation(),d=u.getUiSelectionAreaContainerBox();if(d&&u.hasSelection()){for(var h=[l.CORNER_TL,l.CORNER_TR,l.CORNER_BR,l.CORNER_BL],p=[{x:d.x1,y:d.y1},{x:d.x2,y:d.y1},{x:d.x2,y:d.y2},{x:d.x1,y:d.y2}],g=!1,f=c,m=0,C=h.length;m<C;++m){var _=h[m],y=p[m],T=Kekule.CoordUtils.getDistance(y,o);T<=f&&(g=_,f=T)}return g}return!1},createManipulateOperation:function(){return this.doCreateManipulateMoveAndResizeOperation()},doCreateManipulateMoveAndResizeOperation:function(){var o=[];this.setMoveOperations(o);var l=this.getManipulateObjs(),u=this.getManipulateObjInfoMap();this.getObjOperationMap().clear();var c=new Kekule.ChemObjOperation.MoveAndResizeObjs([],[],this.getEditor().getCoordMode(),!0,this.getEditor());c.setDisableIndirectCoord(!0);for(var d=0,h=l.length;d<h;++d){var p=l[d],g=u.get(p),f=new Kekule.ChemObjOperation.MoveAndResize(p,null,null,this.getEditor().getCoordMode(),!0,this.getEditor());f.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow()),f.setOldCoord(g.objCoord),f.setOldDimension(g.size),o.push(f),c.getChildOperations().push(f),this.setMoveWrapperOperation(c)}return[c]},updateChildMoveOperation:function(o,l,u){this.getMoveOperations()[o].setNewCoord(u)},updateChildResizeOperation:function(o,l,u){this.getMoveOperations()[o].setNewDimension(u)},getAllObjOperations:function(o){var l=this.getMoveOperations(),u=l?Kekule.ArrayUtils.clone(l):[];if(u.length){var c=this.getMoveWrapperOperation();return c.setChildOperations(u),[c]}return[]},getActiveOperation:function(o){var l=this.getAllObjOperations(o);return(l=Kekule.ArrayUtils.toUnique(l)).length<=0?null:l.length===1?l[0]:new Kekule.MacroOperation(l)},reverseActiveOperation:function(){return this.getActiveOperation().reverse()},addOperationToEditor:function(){var o=this.getEditor();if(o&&o.getEnableOperHistory()){var l=this.getActiveOperation(!0);l&&o.pushOperation(l)}},getCurrAvailableManipulationTypes:function(){var o=Kekule.Editor.BasicManipulationIaController.ManipulationType,l=this.getEditor().getSelectionContainerBox();if(l){var u=[];return this.getEnableMove()&&u.push(o.MOVE),Kekule.NumUtils.isFloatEqual(l.x1,l.x2,1e-10)&&Kekule.NumUtils.isFloatEqual(l.y1,l.y2,1e-10)||(this.getEnableResize()&&u.push(o.RESIZE),this.getEnableRotate()&&u.push(o.ROTATE),(this.getEnableResize()||this.getEnableRotate())&&u.push(o.TRANSFORM)),u}return[]},getActualManipulatingObjects:function(o){for(var l=[],u=0,c=o.length;u<c;++u){var d=o[u],h=d.getCoordDependentObjects?d.getCoordDependentObjects():[d];Kekule.ArrayUtils.pushUnique(l,h)}return l},doPrepareManipulatingObjects:function(o,l){var u=this.getActualManipulatingObjects(o);this.setManipulateOriginObjs(o),this.setManipulateObjs(u);var c=this.getManipulateObjInfoMap();c.clear(),this.getEditor();for(var d=0,h=u.length;d<h;++d){var p=u[d],g=this.createManipulateObjInfo(p,d,l);c.set(p,g)}},doPrepareManipulatingStartingCoords:function(o,l,u,c){this.setStartBox(l),this.setRotateCenter(u),this.setRotateRefCoord(c),this.setLastRotateAngle(null)},prepareManipulating:function(o,l,u,c,d,h){this.setManipulationType(o),this.doPrepareManipulatingObjects(l,u),this.doPrepareManipulatingStartingCoords(u,c,d,h),this.createManipulateOperation(),this._cachedTransformCompareThresholds=null,this._runManipulationStepId=Kekule.window.requestAnimationFrame(this.execManipulationStepBind)},cancelManipulate:function(){this.getEditor(),this.getManipulateObjs(),this.reverseActiveOperation(),this.notifyCoordChangeOfObjects(this.getManipulateObjs()),this.manipulateEnd()},_getManipulateObjsCenterCoord:function(){var o=this.getManipulateObjs();if(!o||!o.length)return null;for(var l=this.getEditor().getCoordMode(),u=this.getEditor().getAllowCoordBorrow(),c={x:0,y:0,z:0},d=0,h=o.length;d<h;++d){var p=o[d],g=p.getAbsBaseCoord?p.getAbsBaseCoord(l,u):p.getAbsCoord?p.getAbsCoord(l,u):p.getCoordOfMode?p.getCoordOfMode(l,u):null;g&&(c=Kekule.CoordUtils.add(c,g))}return Kekule.CoordUtils.divide(c,o.length)},_maniplateObjsFrameEnd:function(o){},_addManipultingObjNewInfo:function(o,l){var u=this.getManipulateObjCurrInfoMap(),c=u.get(o)||{};c=Object.extend(c,l),u.set(o,c)},applyManipulatingObjsInfo:function(o){var l=this.getManipulateObjs(),u=this.getManipulateObjCurrInfoMap(),c=this._getIndirectCoordObjs(l);this._setEnableIndirectCoordOfObjs(c,!1);try{for(var d=0,h=l.length;d<h;++d){var p=l[d],g=u.get(p);this.applySingleManipulatingObjInfo(d,p,g,o)}}finally{this._setEnableIndirectCoordOfObjs(c,!0)}},_getIndirectCoordObjs:function(o){for(var l=[],u=0,c=o.length;u<c;++u){var d=o[u];d.getEnableIndirectCoord&&d.getEnableIndirectCoord()&&l.push(d)}return l},_setEnableIndirectCoordOfObjs:function(o,l){if(o)for(var u=0,c=o.length;u<c;++u)o[u].setEnableIndirectCoord(l)},applySingleManipulatingObjInfo:function(o,l,u,c){u&&(u.screenCoord&&this.doMoveManipulatedObj(o,l,u.screenCoord,c),u.size&&this.doResizeManipulatedObj(o,l,u.size))},_calcRotateAngle:function(o){var l,u=Kekule.CoordUtils,c=!1,d=this.getRotateCenter(),h=this.getRotateRefCoord()||this.getStartCoord(),p=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(p){if(u.getDistance(h,d)<p)return l=0,c=!0,this.setStartCoord(o),!1;if(u.getDistance(o,d)<p)return l=0,c=!0,!1}if(!c){var g=u.substract(o,d),f=Math.atan2(g.y,g.x);g=u.substract(h,d);var m=Math.atan2(g.y,g.x);l=f-m}return{angle:l,startAngle:m,endAngle:f}},_calcActualRotateAngle:function(o,l,u,c){return l},_calcManipulateObjsRotationParams:function(o,l){if(!this.getEnableRotate())return!1;var u=this.getRotateCenter(),c=this._calcRotateAngle(l);if(!c)return!1;var d=this._calcActualRotateAngle(o,c.angle,c.startAngle,c.endAngle),h=this.getLastRotateAngle();return(!Kekule.ObjUtils.notUnset(h)||!Kekule.NumUtils.isFloatEqual(d,h,.0175))&&(this.setLastRotateAngle(d),{center:u,rotateAngle:d})},_calcActualResizeScales:function(o,l){return l},_calcManipulateObjsResizeParams:function(o,l,u){if(!this.getEnableResize())return!1;var c,d,h=Kekule.Editor.BoxRegion,p=Kekule.CoordUtils,g=this.getStartBox(),f=p.substract(u,this.getStartCoord());l===h.EDGE_TOP?(f.x=0,c={x:(g.x1+g.x2)/2,y:g.y2}):l===h.EDGE_BOTTOM?(f.x=0,c={x:(g.x1+g.x2)/2,y:g.y1}):l===h.EDGE_LEFT?(f.y=0,c={x:g.x2,y:(g.y1+g.y2)/2}):l===h.EDGE_RIGHT?(f.y=0,c={x:g.x1,y:(g.y1+g.y2)/2}):(this.isAspectRatioLockedResize()&&(d=!0),c=l===h.CORNER_TL?{x:g.x2,y:g.y2}:l===h.CORNER_TR?{x:g.x1,y:g.y2}:l===h.CORNER_BL?{x:g.x2,y:g.y1}:{x:g.x1,y:g.y1});var m,C,_=l===h.CORNER_TL||l===h.CORNER_BL||l===h.EDGE_LEFT,y=l===h.CORNER_TL||l===h.CORNER_TR||l===h.EDGE_TOP;if(m=Kekule.NumUtils.isFloatEqual(g.x1,g.x2,1e-10)?1:1+f.x/(g.x2-g.x1)*(_?-1:1),C=Kekule.NumUtils.isFloatEqual(g.y1,g.y2,1e-10)?1:1+f.y/(g.y2-g.y1)*(y?-1:1),d){var T=Math.abs(m),E=Math.abs(C);T>=E?C=(Math.sign(C)||1)*T:m=(Math.sign(m)||1)*E}var b=this._calcActualResizeScales(o,{scaleX:m,scaleY:C});return{center:c,scaleX:b.scaleX,scaleY:b.scaleY}},_calcManipulateObjsTransformInfo:function(o,l){for(var u=Kekule.CoordUtils,c=u.calcTransform2DMatrix(l),d=l.scaleX||l.scale,h=l.scaleY||l.scale,p=this._isManipulatingSingleStickedObj(o),g=0,f=o.length;g<f;++g){var m=o[g],C=this.getManipulateObjInfoMap().get(m),_={};if(!C.hasNoCoord){var y=C.screenCoord;if(!C.stickTarget||p){var T=u.transform2DByMatrix(y,c);_.screenCoord=T}else _.screenCoord=y}if(C.size&&(d||h)){var E={x:C.size.x*Math.abs(d||1),y:C.size.y*Math.abs(h||1)};_.size=E}this._addManipultingObjNewInfo(m,_)}return!0},_isStickedObj:function(o){return o&&o.getCoordStickTarget&&o.getCoordStickTarget()},_isManipulatingSingleStickedObj:function(o){var l=!1;if(o.length===1){var u=o[0];l=!!this.getManipulateObjInfoMap().get(u).stickTarget}return l},doTransformManipulatedObjs:function(o,l,u){var c=Kekule.Editor.BasicManipulationIaController.ManipulationType,d=this.getEditor(),h=this.getManipulateObjs(),p=u;if(p||(o===c.RESIZE?p=this._calcManipulateObjsResizeParams(h,this.getResizeStartingRegion(),l):o===c.ROTATE&&(p=this._calcManipulateObjsRotationParams(h,l))),(!this._lastTransformParams||!this._isSameTransformParams(this._lastTransformParams,p,null,d.getCoordMode()))&&p&&this._calcManipulateObjsTransformInfo(h,p)){this._lastTransformParams=p,d.beginUpdateObject(),this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(l),this._maniplateObjsFrameEnd(h),this.notifyCoordChangeOfObjects(h)}finally{d.endUpdateObject(),this.manipulateStepDone()}}},_isSameTransformParams:function(o,l,u,c){return u||(u=this._cachedTransformCompareThresholds),u||(u=this._getTransformCompareThresholds(),this._cachedTransformCompareThresholds=u),c===Kekule.CoordMode.COORD2D?n.isSameTransform2DOptions(o,l,{translate:u.translate,scale:u.scale,rotate:u.rotate}):n.isSameTransform3DOptions(o,l,{translate:u.translate,scale:u.scale,rotate:u.rotate})},_getTransformCompareThresholds:function(o){return{translate:.1,scale:.1,rotate:.1}},_calcActualMovedScreenCoord:function(o,l,u){return u},_calcManipulateObjsMoveInfo:function(o,l){var u=Kekule.CoordUtils,c=(this.getManipulateObjCurrInfoMap(),this.getEditor()),d=this._isManipulatingSingleStickedObj(o),h=this.isDirectManipulating()&&o.length===1,p=!h||o[0]&&o[0].getSizeOfMode&&o[0].getSizeOfMode(c.getCoordMode(),c.getAllowCoordBorrow()),g=h&&!p&&this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObj();if(g){var f=this.getStartCoord();u.getDistance(l,f)<=this.getEditorConfigs().getInteractionConfigs().getFollowPointerCoordOnDirectManipulatingSingleObjDistanceThreshold()&&(g=!1)}for(var m=0,C=o.length;m<C;++m){var _,y=o[m],T=this.getManipulateObjInfoMap().get(y);T.hasNoCoord||(!T.stickTarget||d)&&(_=g?l:u.add(l,T.screenCoordOffset),_=this._calcActualMovedScreenCoord(y,T,_),this._addManipultingObjNewInfo(y,{screenCoord:_}))}},moveManipulatedObjs:function(o){Kekule.CoordUtils;var l=this.getEditor(),u=this.getManipulateObjs();this._calcManipulateObjsMoveInfo(u,o),l.beginUpdateObject(),this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(o),this._maniplateObjsFrameEnd(u),this.notifyCoordChangeOfObjects(u)}finally{l.endUpdateObject(),this.manipulateStepDone()}},doMoveManipulatedObj:function(o,l,u,c){var d=this.getEditor();this.updateChildMoveOperation(o,l,d.screenCoordToObj(u)),d.setObjectScreenCoord(l,u)},doResizeManipulatedObj:function(o,l,u){this.updateChildResizeOperation(o,l,u),l.setSizeOfMode&&l.setSizeOfMode(u,this.getEditor().getCoordMode())},isDirectManipulating:function(){return this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&!this.getIsManipulatingSelection()},startDirectManipulate:function(o,l,u,c,d,h){return this.manipulateBegin(),this.doStartDirectManipulate(o,l,u,c,d,h)},doStartDirectManipulate:function(o,l,u,c,d,h){var p=Kekule.ArrayUtils.toArray(l);this.setState(Kekule.Editor.BasicManipulationIaController.State.MANIPULATING),this.setBaseCoord(u),this.setStartCoord(u),this.setRotateRefCoord(h),this.setIsManipulatingSelection(!1),this.prepareManipulating(o||Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE,p,u,c,d,h)},manipulateStepDone:function(){},doManipulateObjectsEnd:function(o){for(var l=this.getManipulateObjInfoMap(),u=o.length-1;u>=0;--u)this.doManipulateObjectEnd(o[u],l.get(o[u]))},doManipulateObjectEnd:function(o,l){},manipulateBegin:function(){this.notifyEditorBeginManipulateObjects()},manipulateEnd:function(){this._runManipulationStepId&&(Kekule.window.cancelAnimationFrame(this._runManipulationStepId),this._runManipulationStepId=null),this.doManipulateObjectsEnd(this.getManipulateObjs()),this._lastTransformParams=null,this.setIsOffsetManipulating(!1),this.setManipulateObjs(null),this.getManipulateObjInfoMap().clear(),this.getObjOperationMap().clear(),this.notifyEditorEndManipulateObjects()},manipulateBeforeStopping:function(){},stopManipulate:function(){this.manipulateEnd()},refreshManipulateObjs:function(){this.setManipulateObjs(this.getManipulateObjs())},createManipulateObjInfo:function(o,l,u){var c=this.getEditor(),d={objCoord:c.getObjCoord(o),screenCoord:c.getObjectScreenCoord(o),size:c.getObjSize(o),enableIndirectCoord:!(!o.getEnableIndirectCoord||!o.getEnableIndirectCoord())};return d.hasNoCoord=!d.objCoord,!d.hasNoCoord&&u&&(d.screenCoordOffset=Kekule.CoordUtils.substract(d.screenCoord,u)),o.getCoordStickTarget&&(d.stickTarget=o.getCoordStickTarget()),d},notifyCoordChangeOfObjects:function(o){for(var l=[],u=this.getEditor(),c=this.getEditor().getCoordMode()===Kekule.CoordMode.COORD3D?"coord3D":"coord2D",d=0,h=o.length;d<h;++d){var p=o[d];Kekule.ArrayUtils.pushUnique(l,{obj:p,propNames:[c]});for(var g=p.getCoordDeterminateObjects?p.getCoordDeterminateObjects():[p],f=0,m=g.length;f<m;++f)Kekule.ArrayUtils.pushUnique(l,{obj:g[f],propNames:[c]})}u.objectsChanged(l)},canInteractWithObj:function(o){return this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL&&o},doTestMouseCursor:function(o,l){if(!this.getEditor().isRenderable())return"";var u="",c=this._getEventMouseCoord(l,this.getEditor().getEditClientElem());if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL){var d=Kekule.Editor.BoxRegion,h=this.getEditor().getCoordRegionInSelectionMarker(c);if(this.getEnableSelect()){var p=Kekule.Editor.BasicManipulationIaController.ManipulationType,g=this.getCurrAvailableManipulationTypes();if(g.indexOf(p.MOVE)>=0&&(u=h===d.INSIDE?"move":""),!u&&g.indexOf(p.RESIZE)>=0&&(u=h===d.CORNER_TL?"nwse-resize":h===d.CORNER_TR||h===d.CORNER_BL?"nesw-resize":h===d.CORNER_BR?"nwse-resize":h===d.EDGE_TOP||h===d.EDGE_BOTTOM?"ns-resize":h===d.EDGE_LEFT||h===d.EDGE_RIGHT?"ew-resize":""),!u&&g.indexOf(p.ROTATE)>=0&&(h=this.getCoordOnSelectionRotationRegion(c))){var f=Kekule.Widget.StyleResourceNames;u=h===d.CORNER_TL?f.CURSOR_ROTATE_NW:h===d.CORNER_TR?f.CURSOR_ROTATE_NE:h===d.CORNER_BL?f.CURSOR_ROTATE_SW:h===d.CORNER_BR?f.CURSOR_ROTATE_SE:f.CURSOR_ROTATE}}}return u},setSuspendedOperations:function(o,l,u){return this._suspendedOperations&&this.haltSuspendedOperations(),this._suspendedOperations={immediate:o,delayed:l,delayExecId:setTimeout(this.execSuspendedDelayOperation.bind(this),u)},this._suspendedOperations},execSuspendedImmediateOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var o=this._suspendedOperations.immediate;return this._suspendedOperations=null,o.apply(this)}},execSuspendedDelayOperation:function(){if(this._suspendedOperations){clearTimeout(this._suspendedOperations.delayExecId);var o=this._suspendedOperations.delayed;return this._suspendedOperations=null,o.apply(this)}},haltSuspendedOperations:function(){this._suspendedOperations&&(clearTimeout(this._suspendedOperations.delayExecId),this._suspendedOperations=null)},_startNewSelecting:function(o,l){this.getEnableSelect()&&(this.getEditor().startSelecting(o,l||this.getEditor().getIsToggleSelectOn()),this.setState(Kekule.Editor.BasicManipulationIaController.State.SELECTING))},_startOffSelectionManipulation:function(o){this.setIsOffsetManipulating(!0),this.startManipulation(o,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE),this.getEditor().pulseSelectionAreaMarker()},startManipulation:function(o,l,u){var c=Kekule.Editor.BasicManipulationIaController.State,d=Kekule.Editor.BasicManipulationIaController.ManipulationType,h=this.getCurrAvailableManipulationTypes(),p=l&&l.pointerType==="touch";l&&this.setManipulationPointerType(l&&l.pointerType),this.manipulateBegin(),this.setBaseCoord(o),this.setStartCoord(o),this._lastTransformParams=null;var g=o&&this.getEditor().getCoordRegionInSelectionMarker(o),f=Kekule.Editor.BoxRegion,m=o&&this.getCoordOnSelectionRotationRegion(o),C=h.indexOf(d.TRANSFORM)>=0&&u===d.TRANSFORM;if(C)this._availTransformTypes=h;else var _=!p&&h.indexOf(d.RESIZE)>=0&&(u===d.RESIZE||g!==f.INSIDE&&g!==f.OUTSIDE),y=!_&&h.indexOf(d.MOVE)>=0&&(u===d.MOVE||g!==f.OUTSIDE),T=!p&&!_&&!y&&h.indexOf(d.ROTATE)>=0&&(u===d.ROTATE||!!m);if(!C&&!_&&!T){var E=this.getEditor().getTopmostBasicObjectAtCoord(o,this.getCurrBoundInflation());if(E&&!p&&(this.isInAncestorSelectMode()&&(E=this.getStandaloneAncestor(E)),E=E.getNearestMovableObject(),this.getEnableMove()))return void this.doStartDirectManipulate(null,E,o)}if(C)this.setState(c.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(g),this.setRotateStartingRegion(m),this.prepareManipulating(d.TRANSFORM,this.getEditor().getSelection(),o,this.getEditor().getSelectionContainerBox());else if(_)this.setState(c.MANIPULATING),this.setIsManipulatingSelection(!0),this.setResizeStartingRegion(g),this.prepareManipulating(d.RESIZE,this.getEditor().getSelection(),o,this.getEditor().getSelectionContainerBox());else if(y)this.setState(c.MANIPULATING),this.setIsManipulatingSelection(!0),this.prepareManipulating(d.MOVE,this.getEditor().getSelection(),o);else if(T)this.setState(c.MANIPULATING),this.setIsManipulatingSelection(!0),this.setRotateStartingRegion(m),this.prepareManipulating(d.ROTATE,this.getEditor().getSelection(),o,this.getEditor().getSelectionContainerBox());else if(E)this.getEnableMove()&&this.startDirectManipulate(null,E,o);else if(this.getEnableMove()&&this.getEnableSelect()&&this.getEditorConfigs().getInteractionConfigs().getEnableOffSelectionManipulation()&&this.getEditor().hasSelection()&&this.getEditor().isSelectionVisible()){this.setState(c.SUSPENDING);var b=this.getEditorConfigs().getInteractionConfigs().getOffSelectionManipulationActivatingTimeThreshold(),v=l&&l.getShiftKey();this.setSuspendedOperations(this._startNewSelecting.bind(this,o,v),this._startOffSelectionManipulation.bind(this,o),b)}else this.getEnableSelect()&&(v=l&&l.getShiftKey(),this._startNewSelecting(o,v))},execManipulationStep:function(o){if(this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING)return!1;var l=this._manipulationStepBuffer.coord,u=this._manipulationStepBuffer.event,c=this._manipulationStepBuffer.explicitTransformParams;c?this.doExecManipulationStepWithExplicitTransformParams(c,this._manipulationStepBuffer):l&&u&&this.doExecManipulationStep(l,u,this._manipulationStepBuffer),this._manipulationStepBuffer.coord=null,this._manipulationStepBuffer.event=null,this._manipulationStepBuffer.explicitTransformParams=null,this._runManipulationStepId=Kekule.window.requestAnimationFrame(this.execManipulationStepBind)},doExecManipulationStep:function(o,l,u){var c=Kekule.Editor.BasicManipulationIaController.ManipulationType,d=this.getManipulationType(),h=this.getEditor();h.beginUpdateObject();try{this._isBusy=!0,d===c.MOVE?this.moveManipulatedObjs(o):d===c.RESIZE?this.doTransformManipulatedObjs(d,o):d===c.ROTATE&&this.doTransformManipulatedObjs(d,o)}finally{h.endUpdateObject(),this._isBusy=!1}},doExecManipulationStepWithExplicitTransformParams:function(o,l){var u=Kekule.Editor.BasicManipulationIaController.ManipulationType,c=this.getManipulationType();if(c===u.TRANSFORM){var d=this.getEditor();d.beginUpdateObject();try{this._isBusy=!0,this.doTransformManipulatedObjs(c,null,o)}finally{d.endUpdateObject(),this._isBusy=!1}}},updateManipulationStepBuffer:function(o,l){Object.extend(o,l)},react_pointermove:function(o){if(this.tryApplySuper("react_pointermove",[o]),this._isBusy||Kekule.ObjUtils.notUnset(this.getActivePointerId())&&o.pointerId!==this.getActivePointerId())return!0;var l,u=Kekule.Editor.BasicManipulationIaController.State,c=(Kekule.Editor.BasicManipulationIaController.ManipulationType,this.getState()),d=this._getEventMouseCoord(o);if((c===u.NORMAL||c===u.SUSPENDING)&&this._lastMouseMoveCoord){var h=Kekule.CoordUtils.getDistance(d,this._lastMouseMoveCoord);if(l=h,h<4)return!0}if(this._lastMouseMoveCoord=d,c===u.SUSPENDING){var p=this.getEditorConfigs().getInteractionConfigs().getUnmovePointerDistanceThreshold()||0;Kekule.ObjUtils.notUnset(l)&&l>p&&this.execSuspendedImmediateOperation()}return c===u.SELECTING?(this.getEnableSelect()&&this.getEditor().addSelectingAnchorCoord(d),o.preventDefault()):c===u.MANIPULATING&&(this.updateManipulationStepBuffer(this._manipulationStepBuffer,{coord:d,event:o}),o.preventDefault()),!0},react_pointerdown:function(o){this.tryApplySuper("react_pointerdown",[o]),this.setActivePointerId(o.pointerId);var l=Kekule.Editor.BasicManipulationIaController.State;if(o.getButton()===Kekule.X.Event.MouseButton.LEFT){this._lastMouseMoveCoord=null;var u=this._getEventMouseCoord(o);if(this.getState()===l.NORMAL){var c=this,d=function(){c.getState()!==l.NORMAL&&c.getState()!==l.SUSPENDING||(c.startManipulation(u,o),o.preventDefault())};this.setState(l.SUSPENDING),this.setSuspendedOperations(d,d,50)}}else o.getButton()===Kekule.X.Event.MouseButton.RIGHT&&(this.getState()===l.MANIPULATING?(this.cancelManipulate(),this.setState(l.NORMAL),o.stopPropagation(),o.preventDefault()):this.getState()===l.SUSPENDING&&this.haltSuspendedOperations());return!0},react_pointerup:function(o){if(o.getButton()===Kekule.X.Event.MouseButton.LEFT){var l=this._getEventMouseCoord(o);this.setEndCoord(l);var u=this.getStartCoord(),c=l,d=o.getShiftKey(),h=Kekule.Editor.BasicManipulationIaController.State;this.getState()===h.SUSPENDING&&this.execSuspendedImmediateOperation();var p=this.getState();p===h.SELECTING?(this.getEditor().endSelecting(l,d||this.getEditor().getIsToggleSelectOn()),this.setState(h.NORMAL),o.preventDefault(),this.getEditor().endManipulateObject()):p===h.MANIPULATING&&(u&&c&&Kekule.CoordUtils.isEqual(u,c)?this.getEnableSelect()&&this.getEditor().selectOnCoord(u,d||this.getEditor().getIsToggleSelectOn()):(this.manipulateBeforeStopping(),this.addOperationToEditor()),this.stopManipulate(),this.setState(h.NORMAL),o.preventDefault())}return!0},react_mousewheel:function(o){if(o.getCtrlKey()){if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL)return this.tryApplySuper("react_mousewheel",[o]);o.preventDefault()}},_isGestureManipulationEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureManipulation()},_isGestureZoomOnEditorEnabled:function(){return this.getEditorConfigs().getInteractionConfigs().getEnableGestureZoomOnEditor()},_isInGestureManipulation:function(){return!!this._initialGestureTransformParams},_isGestureZoomOnEditor:function(){return!!this._initialGestureZoomLevel},beginGestureTransform:function(o){this.getEditor().hasSelection()?(this._initialGestureZoomLevel=null,this._isGestureManipulationEnabled()?(this.haltSuspendedOperations(),this._initialGestureTransformParams={angle:o.rotation*Math.PI/180||0},this.getState()!==Kekule.Editor.BasicManipulationIaController.State.MANIPULATING?this.startManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM):this.getManipulationType()!==Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM&&this.startManipulation(null,null,Kekule.Editor.BasicManipulationIaController.ManipulationType.TRANSFORM)):this._initialGestureTransformParams=null):this._isGestureZoomOnEditorEnabled()&&(this.getEditor().cancelSelecting(),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureZoomLevel=this.getEditor().getZoom())},endGestureTransform:function(){this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&this._isInGestureManipulation()&&(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),this._initialGestureTransformParams=null),this._isGestureZoomOnEditor()&&(this._initialGestureZoomLevel=null)},doGestureTransformStep:function(o){var l=Kekule.Editor.BasicManipulationIaController.ManipulationType;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING&&this.getManipulationType()===l.TRANSFORM&&this._isInGestureManipulation()){var u,c=this._availTransformTypes||[],d=this.getRotateCenter();if(c.indexOf(l.RESIZE)>=0){var h=o.scale;u=this._calcActualResizeScales(this.getManipulateObjs(),{scaleX:h,scaleY:h})}else u={scaleX:1,scaleY:1};if(c.indexOf(l.ROTATE)>=0){var p=o.rotation*Math.PI/180,g=p-this._initialGestureTransformParams.angle;g=this._calcActualRotateAngle(this.getManipulateObjs(),g,this._initialGestureTransformParams.angle,p)}else g=0;this.updateManipulationStepBuffer(this._manipulationStepBuffer,{explicitTransformParams:{center:d,scaleX:u.scaleX,scaleY:u.scaleY,rotateAngle:g}}),o.preventDefault()}else if(this._isGestureZoomOnEditor()){var f=this.getEditor(),m=(h=o.scale,this._initialGestureZoomLevel);f.zoomTo(m*h,null,o.center)}},react_rotatestart:function(o){this.getEnableGestureManipulation()&&this.beginGestureTransform(o)},react_rotate:function(o){this.getEnableGestureManipulation()&&this.doGestureTransformStep(o)},react_rotateend:function(o){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_rotatecancel:function(o){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchstart:function(o){this.getEnableGestureManipulation()&&this.beginGestureTransform(o)},react_pinchmove:function(o){this.getEnableGestureManipulation()&&this.doGestureTransformStep(o)},react_pinchend:function(o){this.getEnableGestureManipulation()&&this.endGestureTransform()},react_pinchcancel:function(o){this.getEnableGestureManipulation()&&this.endGestureTransform()}}),Kekule.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2,WAITING:10,SUSPENDING:11},Kekule.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2,TRANSFORM:4},Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicManipulationIaController,Kekule.Editor.BaseEditor)}(),function(){var s=Kekule.ArrayUtils;Kekule.ChemObjOperation={},Kekule.ChemObjOperation.Base=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function(e,t){this.tryApplySuper("initialize"),this.setTarget(e),t&&this.setEditor(t)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},notifyBeforeAddingByEditor:function(e,t,n){e.beforeAddingByEditor&&e.beforeAddingByEditor(t,n)},notifyBeforeRemovingByEditor:function(e,t){e.beforeRemovingByEditor&&e.beforeRemovingByEditor(t)},notifyBeforeModifyingByEditor:function(e,t){e.beforeModifyingByEditor&&e.beforeModifyingByEditor(t)},notifyAfterAddingByEditor:function(e,t,n){e.afterAddingByEditor&&e.afterAddingByEditor(t,n)},notifyAfterRemovingByEditor:function(e,t){e.afterRemovingByEditor&&e.afterRemovingByEditor(t)},notifyAfterModifyingByEditor:function(e,t){e.afterModifyingByEditor&&e.afterModifyingByEditor(t)}}),Kekule.ChemObjOperation.ChangeClass=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ChangeClass",initialize:function(e,t,n){this.tryApplySuper("initialize",[e,n]),t&&this.setNewClass(t)},initProperties:function(){this.defineProp("newClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("oldClass",{dataType:DataType.CLASS,serializable:!1})},doExecute:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),this.getOldClass()||this.setOldClass(e.getClass()),e.__changeClass__(this.getNewClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}},doReverse:function(){var e=this.getTarget();e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,{}),e.__changeClass__(this.getOldClass()),this.notifyAfterModifyingByEditor(e,{})}finally{e.endUpdate()}}}),Kekule.ChemObjOperation.Modify=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function(e,t,n){this.tryApplySuper("initialize",[e,n]),t&&this.setNewPropValues(t)},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH}),this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var e={},t=this.getNewPropValues(),n=this.getTarget();n.beginUpdate();try{for(var i in this.notifyBeforeModifyingByEditor(n,t),t){var r=t[i];e[i]=n.getPropValue(i),n.setPropValue(i,r)}this.notifyAfterModifyingByEditor(n,t)}finally{n.endUpdate()}this.setOldPropValues(e)},doReverse:function(){var e=this.getOldPropValues(),t=this.getTarget();t.beginUpdate();try{for(var n in this.notifyBeforeModifyingByEditor(t,e),e){var i=e[n];t.setPropValue(n,i)}this.notifyAfterModifyingByEditor(t,e)}finally{t.endUpdate()}}}),Kekule.ChemObjOperation.ModifyHashProp=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.ModifyHashProp",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,i]),t&&this.setPropName(t),n&&this.setNewPropValue(n)},initProperties:function(){this.defineProp("propName",{dataType:DataType.STRING}),this.defineProp("newPropValue",{dataType:DataType.HASH}),this.defineProp("oldPropValue",{dataType:DataType.HASH})},_extendHash:function(e,t){},doExecute:function(){var e=this.getTarget(),t=this.getPropName(),n=e.getPropValue(this.getPropName()),i=Object.extend(Object.extend({},n),this.getNewPropValue(),!1),r={};r[t]=i,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,r),e.setPropValue(t,i),this.notifyAfterModifyingByEditor(e,r)}finally{e.endUpdate()}this.getOldPropValue()||this.setOldPropValue(n)},doReverse:function(){var e=this.getTarget(),t=this.getPropName(),n=this.getOldPropValue(),i=(e.getPropValue(t),n),r={};r[t]=i,e.beginUpdate();try{this.notifyBeforeModifyingByEditor(e,r),e.setPropValue(t,i),this.notifyAfterModifyingByEditor(e,r)}finally{e.endUpdate()}}}),Kekule.ChemObjOperation.MoveTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function(e,t,n,i,r){this.tryApplySuper("initialize",[e,r]),t&&this.setNewCoord(t),this.setCoordMode(n||Kekule.CoordMode.COORD2D),this.setUseAbsBaseCoord(!!i)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH}),this.defineProp("oldCoord",{dataType:DataType.HASH}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsBaseCoord",{dataType:DataType.BOOL})},setObjCoord:function(e,t,n){if(e&&t&&n){var i=!1;if(this.getUseAbsBaseCoord()?e.setAbsBaseCoord&&(e.setAbsBaseCoord(t,n,this.getAllowCoordBorrow()),i=!0):e.setCoordOfMode&&(e.setCoordOfMode(t,n),i=!0),!i){var r=e.getClassName?e.getClassName():typeof e;Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS").format(r))}}},getObjCoord:function(e,t){if(this.getUseAbsBaseCoord()){if(e.getAbsBaseCoord)return e.getAbsBaseCoord(t,this.getAllowCoordBorrow())}else if(e.getCoordOfMode)return e.getCoordOfMode(t,this.getAllowCoordBorrow());return null},doExecute:function(){var e=this.getTarget();this.getOldCoord()||this.setOldCoord(this.getObjCoord(e,this.getCoordMode())),this.getNewCoord()&&this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())},doReverse:function(){this.getOldCoord()&&this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}),Kekule.ChemObjOperation.MoveAndResize=Class.create(Kekule.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function(e,t,n,i,r,a){this.tryApplySuper("initialize",[e,n,i,r,a])},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH}),this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(e,t,n){if(e&&t)if(e.setSizeOfMode)e.setSizeOfMode(t,n);else{var i=e.getClassName?e.getClassName():typeof e;Kekule.warn(Kekule.$L("ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS").format(i))}},getObjSize:function(e,t){return e.getSizeOfMode?e.getSizeOfMode(t,this.getAllowCoordBorrow()):null},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this.getOldDimension()||this.setOldDimension(this.getObjSize(e,this.getCoordMode())),this.getNewDimension()&&this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())},doReverse:function(){this.getOldDimension()&&this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode()),this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.MoveAndResizeObjs=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResizeObjs",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[null,i]),e&&this.setObjCoordAndSizeInfo(e),this.setCoordMode(t||Kekule.CoordMode.COORD2D),this.setUseAbsCoord(!!n),this.setPropStoreFieldValue("childOperations",[])},initProperties:function(){this.defineProp("objCoordAndSizeInfo",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("useAbsCoord",{dataType:DataType.BOOL}),this.defineProp("disableIndirectCoord",{dataType:DataType.BOOL}),this.defineProp("childOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("indirectCoordObjs",{dataType:DataType.ARRAY,serializable:!1})},_setEnableIndirectCoordOfObjs:function(e,t){if(e)for(var n=0,i=e.length;n<i;++n)e[n].setEnableIndirectCoord(t)},_prepareIndirectCoordObjs:function(e){var t=[];if(this.getDisableIndirectCoord())for(var n=0,i=e.length;n<i;++n){var r=e[n];if(r&&r instanceof Kekule.ChemObjOperation.MoveAndResize){var a=r.getTarget();a.hasProperty("enableIndirectCoord")&&a.getEnableIndirectCoord()&&(a.setEnableIndirectCoord(!1),t.push(a))}}this.setIndirectCoordObjs(t)},_prepareExecute:function(){var e=this.getChildOperations();if(!e.length){e.length=0;for(var t=this.getObjCoordAndSizeInfo(),n=0,i=t.length;n<i;++n){var r=t[n],a=r.obj,o=new Kekule.ChemObjOperation.MoveAndResize(a,r.newDimension,r.newCoord,this.getCoordMode(),this.getUseAbsCoord(),this.getEditor());o.setAllowCoordBorrow(this.getAllowCoordBorrow()),r.oldDimension&&o.setOldDimension(r.oldDimension),r.oldCoord&&o.setOldCoord(r.oldCoord),e.push(o)}}this._prepareIndirectCoordObjs(e)},_prepareReverse:function(){this.getDisableIndirectCoord()&&(this.getIndirectCoordObjs()||this._prepareIndirectCoordObjs(this.getChildOperations()),this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!1))},_doneMoveAndResize:function(){this._setEnableIndirectCoordOfObjs(this.getIndirectCoordObjs(),!0)},doExecute:function(){this.tryApplySuper("doExecute");try{this._prepareExecute();for(var e=this.getChildOperations(),t=0,n=e.length;t<n;++t)e[t].execute()}finally{this._doneMoveAndResize()}},doReverse:function(){try{this._prepareReverse();for(var e=this.getChildOperations(),t=e.length-1;t>=0;--t)e[t].reverse()}finally{this._doneMoveAndResize()}this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.StickTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.StickTo",initialize:function(e,t,n){this.tryApplySuper("initialize",[e,n]),t&&this.setStickTarget(t)},initProperties:function(){this.defineProp("stickTarget",{dataType:Kekule.ChemObject,serializable:!1}),this.defineProp("oldStickTarget",{dataType:Kekule.ChemObject,serializable:!1})},_canExecute:function(e){return e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(this.getStickTarget())},doExecute:function(){this.tryApplySuper("doExecute");var e=this.getTarget();this._canExecute(e)&&(this.getOldStickTarget()===void 0&&this.setOldStickTarget(e.getCoordStickTarget()||null),e.setCoordStickTarget(this.getStickTarget()))},doReverse:function(){this.getTarget().setCoordStickTarget(this.getOldStickTarget()),this.tryApplySuper("doReverse")}}),Kekule.ChemObjOperation.StickTo.canStick=function(e,t,n,i){var r=e&&e.getAllowCoordStickTo&&e.getAllowCoordStickTo(t);if(t&&(r=(r=(r=(r=(r=r&&t&&t.getAbsCoordOfMode)&&t!==e)&&t.getAcceptCoordStickFrom&&t.getAcceptCoordStickFrom(e))&&(!t.getCoordStickTarget||t.getCoordStickTarget()!==e))&&(n||!(t instanceof Kekule.StructureFragment)))&&!i){var a=e.getParent(),o=t.getParent();r=a!==o||!a||!o}return r},Kekule.ChemObjOperation.Add=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,i]),this.setParentObj(t),this.setRefSibling(n)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1})},doExecute:function(){var e=this.getParentObj(),t=this.getTarget();if(e&&t){var n=this.getRefSibling()||null;this.notifyBeforeAddingByEditor(t,e,n),e.insertBefore(t,n),this.notifyAfterAddingByEditor(t,e,n)}},doReverse:function(){var e=this.getTarget(),t=this.getParentObj();if(t&&e){var n=this.getRefSibling();n||(n=e.getNextSibling(),this.setRefSibling(n)),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t)}}}),Kekule.ChemObjOperation.Remove=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,i]),this.setParentObj(t),this.setRefSibling(n)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("ownerObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("removedRelations",{dataType:DataType.ARRAY,serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},_getRelatedObjRefRelations:function(e){var t=[],n=e.getOwner();if(n){var i=n.findObjRefRelations({dest:e},{checkDestChildren:!0});if(i&&i.length)for(var r=0,a=i.length;r<a;++r){var o=Object.extend({},i[r]);s.isArray(o.dest)&&(o.dest=s.clone(o.dest)),t.push(o)}}return t},_restoreRelations:function(e){if(e)for(var t=0,n=e.length;t<n;++t){var i=e[t];i.srcObj.setPropValue(i.srcProp.name,i.dest)}},doExecute:function(){var e=this.getTarget(),t=this.getParentObj(),n=this.getOwnerObj();if(!t&&e.getParent&&(t=e.getParent(),this.setParentObj(t)),!n&&e.getOwner&&(n=e.getOwner(),this.setOwnerObj(n)),t&&e){if(!this.getRefSibling()){var i=e.getNextSibling?e.getNextSibling():null;this.setRefSibling(i)}var r=this._getRelatedObjRefRelations(e);this.setRemovedRelations(r);var a=this.getEditor(),o=this._isInEditorSelection(e);o&&a.beginUpdateSelection(),this.notifyBeforeRemovingByEditor(e,t),t.removeChild(e),this.notifyAfterRemovingByEditor(e,t),o&&(a.removeFromSelection(e),a.endUpdateSelection())}},doReverse:function(){var e=this.getParentObj(),t=this.getOwnerObj(),n=this.getTarget();if(e&&n){var i=this.getRefSibling();t&&n.setOwner(t),this.notifyBeforeAddingByEditor(n,e,i),e.insertBefore(n,i),this._restoreRelations(this.getRemovedRelations()),this.setRemovedRelations([]),this.notifyAfterAddingByEditor(n,e,i)}}}),Kekule.ChemStructOperation={},Kekule.ChemStructOperation.AddNode=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"}),Kekule.ChemStructOperation.RemoveNode=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectorInfos",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){if(!this.getLinkedConnectorInfos()){for(var e=this.getTarget(),t=e.getLinkedConnectors(),n=[],i=0,r=t.length;i<r;++i){var a,o=t[i],l=e.getActualConnectedObjToConnector(o)||e,u=o.indexOfConnectedObj(e);a=u<0?null:o.getConnectedObjAt(u+1)||null,n.push({connector:o,refSibling:a}),l!==e&&(n.actualLinkedNode=l)}this.setLinkedConnectorInfos(n)}this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getLinkedConnectorInfos();if(e)for(var t=this.getTarget(),n=0,i=e.length;n<i;++n){var r=e[n].connector,a=e[n].refSibling,o=e[n].actualLinkedNode||t;r.insertConnectedObjBefore(o,a)}}}),Kekule.ChemStructOperation.ReplaceNode=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function(e,t,n,i){this.tryApplySuper("initialize"),this.setOldNode(e),this.setNewNode(t),this.setParentObj(n),this.setEditor(i)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},_isInEditorSelection:function(e){var t=this.getEditor();return(t&&t.getSelection&&t.getSelection()||[]).indexOf(e)>=0},doExecute:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var n=this.getParentObj();if(n||(n=e.getParent(),this.setParentObj(n)),n.replaceNode){var i=this.getEditor(),r=this._isInEditorSelection(e);r&&i.beginUpdateSelection(),n.replaceNode(e,t),r&&(i.removeFromSelection(e),i.addObjToSelection(t),i.endUpdateSelection())}}},doReverse:function(){var e=this.getOldNode(),t=this.getNewNode();if(e&&t){var n=this.getParentObj()||t.getParent();if(n.replaceNode){var i=this.getEditor(),r=this._isInEditorSelection(t);r&&i.beginUpdateSelection(),n.replaceNode(t,e),r&&(i.removeFromSelection(t),i.addObjToSelection(e),i.endUpdateSelection())}}}}),Kekule.ChemStructOperation.AddConnector=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function(e,t,n,i,r){this.tryApplySuper("initialize",[e,t,n,r]),this.setConnectedObjs(i)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.tryApplySuper("doExecute");var e=Kekule.ArrayUtils.clone(this.getConnectedObjs());e&&e.length&&this.getTarget().setConnectedObjs(e)},doReverse:function(){this.tryApplySuper("doReverse")}}),Kekule.ChemStructOperation.RemoveConnector=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1})},doExecute:function(){this.getConnectedObjs()||this.setConnectedObjs(Kekule.ArrayUtils.clone(this.getTarget().getConnectedObjs())),this.tryApplySuper("doExecute")},doReverse:function(){this.tryApplySuper("doReverse");var e=this.getConnectedObjs();e&&e.length&&this.getTarget().setConnectedObjs(e)}}),Kekule.ChemStructOperation.MergeNodesBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesBase",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,i]),this.setDest(t),this.setEnableStructFragmentMerge(n||!1),this._refSibling=null,this._nodeParent=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("mergeConnectorPropsFromTarget",{dataType:DataType.BOOL})},getCommonSiblings:function(e,t){var n=e.getLinkedObjs(),i=t.getLinkedObjs();return Kekule.ArrayUtils.intersect(n,i)},doExecute:function(){},doReverse:function(){}}),Kekule.ChemStructOperation.MergeNodes=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,t,n,i]),this._refSibling=null,this._nodeParent=null,this._structFragmentMergeOperation=null,this._removeConnectorOperations=[],this._removeNodeOperation=null,this._modifyConnecorOperations=[]},initProperties:function(){this.defineProp("relinkedConnectors",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:!1})},getMergeConnPropsOperation:function(e,t){var n;if(e instanceof Kekule.Bond&&t instanceof Kekule.Bond&&e.getBondType()===t.getBondType()&&e.getBondType()===Kekule.BondType.COVALENT){var i=e.getBondOrder();i>t.getBondOrder()&&(n=new Kekule.ChemObjOperation.Modify(t,{bondOrder:i}))}return n},doExecute:function(){var e=this.getMergeConnectorPropsFromTarget(),t=this._modifyConnecorOperations||[],n=this.getTarget(),i=this.getDest(),r=n.getParentFragment(),a=i.getParentFragment();if(r!==a){if(!this.getEnableStructFragmentMerge())return null;this._structFragmentMergeOperation=new Kekule.ChemStructOperation.MergeStructFragment(r,a,this.getEditor()),this._structFragmentMergeOperation.execute(),r=a}this._nodeParent=r,r.beginUpdate();try{var o,l=this.getEditor();if(!(u=this.getRemovedConnectors())){t=[],o=this.getCommonSiblings(n,i);var u=[];if(o.length)for(var c=0,d=o.length;c<d;++c){var h=o[c];(y=n.getConnectorTo(h))&&y.getConnectedObjCount()==2&&u.push(y)}var p=n.getConnectorTo(i);p&&u.push(p),this.setRemovedConnectors(u)}if(!(g=this.getRelinkedConnectors())){var g=Kekule.ArrayUtils.clone(n.getLinkedConnectors())||[];g=Kekule.ArrayUtils.exclude(g,u),this.setRelinkedConnectors(g)}for(this._refSibling=n.getNextSibling(),c=0,d=g.length;c<d;++c){var f=(y=g[c]).indexOfConnectedObj(n);y.removeConnectedObj(n),y.insertConnectedObjAt(i,f)}if(e&&!t.length&&u&&u.length)for(o||(o=this.getCommonSiblings(n,i)),c=0,d=o.length;c<d;++c){h=o[c];var m=n.getConnectorTo(h);if(u.indexOf(m)>=0){var C=i.getConnectorTo(h);if(C){var _=this.getMergeConnPropsOperation(m,C);_&&t.push(_)}}}for(this._removeConnectorOperations=[],c=0,d=u.length;c<d;++c){var y=u[c],T=new Kekule.ChemStructOperation.RemoveConnector(y,null,null,l);T.execute(),this._removeConnectorOperations.push(T)}if(this._removeNodeOperation=new Kekule.ChemStructOperation.RemoveNode(n,null,null,l),this._removeNodeOperation.execute(),t)for(this._modifyConnecorOperations=t,c=0,d=t.length;c<d;++c)t[c].execute()}finally{r.endUpdate()}},doReverse:function(){var e=this.getTarget(),t=this.getDest(),n=this._nodeParent;n.beginUpdate();try{var i=this._modifyConnecorOperations;if(i)for(var r=0,a=i.length;r<a;++r)i[r].reverse();if(this._removeNodeOperation.reverse(),this._removeConnectorOperations.length)for(r=this._removeConnectorOperations.length-1;r>=0;--r)this._removeConnectorOperations[r].reverse();this._removeConnectorOperations=[];var o=this.getRelinkedConnectors();for(r=0,a=o.length;r<a;++r){var l=o[r],u=l.indexOfConnectedObj(t);l.removeConnectedObj(t),l.insertConnectedObjAt(e,u)}}finally{n.endUpdate()}this._structFragmentMergeOperation&&this._structFragmentMergeOperation.reverse()}}),Kekule.ChemStructOperation.MergeNodes.canMerge=function(e,t,n,i){if(e instanceof Kekule.StructureFragment||t instanceof Kekule.StructureFragment||!(e instanceof Kekule.ChemStructureNode&&t instanceof Kekule.ChemStructureNode))return!1;var r=e.getParent()===t.getParent()||n;return i||(r=r&&!e.getConnectorTo(t)),r},Kekule.ChemStructOperation.MergeNodesPreview=Class.create(Kekule.ChemStructOperation.MergeNodesBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodesPreview",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,t,n,i]),this._nodeParent=null},doExecute:function(){this._moveNodeOperations=[];var e=this.getTarget(),t=this.getDest(),n=e.getParentFragment(),i=Kekule.CoordMode,r=[i.COORD2D,i.COORD3D];n&&n.beginUpdate();try{for(var a=0,o=r.length;a<o;++a){var l=t.getAbsBaseCoord(r[a],!1),u=new Kekule.ChemObjOperation.MoveTo(e,l,r[a],!0,this.getEditor());u.execute(),this._moveNodeOperations.push(u)}this._nodeParent=n}finally{n&&n.endUpdate()}},doReverse:function(){var e=this._nodeParent;e&&e.beginUpdate();try{for(var t=this._moveNodeOperations,n=t.length-1;n>=0;--n)t[n].reverse()}finally{e&&e.endUpdate()}this._moveNodeOperations=null}}),Kekule.ChemStructOperation.MergeNodesPreview.canMerge=Kekule.ChemStructOperation.MergeNodes.canMerge,Kekule.ChemStructOperation.MergeConnectorsBase=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectorsBase",initialize:function(e,t,n,i,r){this.tryApplySuper("initialize",[e,r]),this.setDest(t),this.setCoordMode(n||Kekule.CoordMode.COORD2D),this.setEnableStructFragmentMerge(i||!1),this._refSibling=null,this._nodeParent=null,this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:!1}),this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT})},getMergeNodeOperationClass:function(){},doExecute:function(){Kekule.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge())||Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_MERGE_CONNECTORS"));for(var e=this.getCoordMode(),t=[this.getTarget(),this.getDest()],n=Kekule.ArrayUtils,i=n.clone(this.getTarget().getConnectedObjs()),r=n.clone(this.getDest().getConnectedObjs()),a=this.getAllowCoordBorrow(),o=0,l=t.length;o<l;++o){var u=t[o],c=u.getConnectedObjAt(0).getAbsCoordOfMode(e,a),d=u.getConnectedObjAt(1).getAbsCoordOfMode(e,a),h=Kekule.CoordUtils.substract(c,d),p=Math.abs(h.x)>Math.abs(h.y)?"x":"y";Kekule.ObjUtils.notUnset(c.z)&&Math.abs(h.z)>Math.abs(h.x)&&(p="z"),(o===0?i:r).sort(function(C,_){var y=C.getAbsCoordOfMode(e,a),T=_.getAbsCoordOfMode(e,a);return y[p]-T[p]||0})}var g=n.intersect(i,r);i=n.exclude(i,g),r=n.exclude(r,g),this._nodeMergeOperations=[];var f=this.getMergeNodeOperationClass();for(o=0,l=i.length;o<l;++o){if(i[o]!==r[o]){var m=new f(i[o],r[o],this.getEnableStructFragmentMerge());m.execute()}this._nodeMergeOperations.push(m)}},doReverse:function(){for(var e=this._nodeMergeOperations.length-1;e>=0;--e)this._nodeMergeOperations[e].reverse();this._nodeMergeOperations=[]}}),Kekule.ChemStructOperation.MergeConnectors=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodes}}),Kekule.ChemStructOperation.MergeConnectors.canMerge=function(e,t,n){if(!n&&e.getParent()!==t.getParent()||e.isConnectingConnector()||t.isConnectingConnector())return!1;var i=e.getConnectedExposedObjs(),r=t.getConnectedObjs();return i.length===r.length&&i.length===2&&!(Kekule.ArrayUtils.intersect(i,r).length>=1)},Kekule.ChemStructOperation.MergeConnectorsPreview=Class.create(Kekule.ChemStructOperation.MergeConnectorsBase,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",getMergeNodeOperationClass:function(){return Kekule.ChemStructOperation.MergeNodesPreview}}),Kekule.ChemStructOperation.MergeConnectorsPreview.canMerge=Kekule.ChemStructOperation.MergeConnectors.canMerge,Kekule.ChemStructOperation.MergeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function(e,t,n){this.tryApplySuper("initialize",[e,n]),this.setDest(t),this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:!1})},moveChildBetweenStructFragment:function(e,t,n,i){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(e,t,n,i)},doExecute:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){var n=Kekule.ArrayUtils.clone(e.getNodes());this.setMergedNodes(n);var i=Kekule.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(i),this.moveChildBetweenStructFragment(e,t,n,i);var r=e.getParent();r&&(this._removeOperation=new Kekule.ChemObjOperation.Remove(e,r,null,this.getEditor()),this._removeOperation.execute())}},doReverse:function(){var e=this.getTarget(),t=this.getDest();if(e&&t){this._removeOperation&&(this._removeOperation.reverse(),this._removeOperation=null);var n=this.getMergedNodes(),i=this.getMergedConnectors();this.moveChildBetweenStructFragment(t,e,n,i)}}}),Kekule.ChemStructOperation.SplitStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:!1,setter:null})},doExecute:function(){var e=Kekule.ChemStructureUtils.splitStructFragment(this.getTarget());if(e.length>1){this.setPropStoreFieldValue("splittedFragments",e);var t=this.getTarget().getParent(),n=this.getTarget().getNextSibling();t.beginUpdate();try{if(t)for(var i=1,r=e.length;i<r;++i){var a=e[i];t.insertBefore(a,n)}}finally{t.endUpdate()}}else this.setPropStoreFieldValue("splittedFragments",null)},doReverse:function(){var e=this.getSplittedFragments();if(e&&e.length)for(var t=this.getTarget(),n=0,i=e.length;n<i;++n){var r=e[n];if(r!==t){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(r,t,Kekule.ArrayUtils.clone(r.getNodes()),Kekule.ArrayUtils.clone(r.getConnectors()));var a=r.getParent();a&&a.removeChild(r),r.finalize()}}}}),Kekule.ChemStructOperation.StandardizeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function(e,t){this.tryApplySuper("initialize",[e,t]),this.setEnableSplit(!0),this.setEnableRemove(!0),this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL}),this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var e=this.getTarget(),t=e.getNodeCount();this._concreteOper=null;var n=this.getEditor();return t<=0?this.getEnableRemove()&&(this._concreteOper=new Kekule.ChemObjOperation.Remove(e,null,null,n)):this.getEnableSplit()&&(this._concreteOper=new Kekule.ChemStructOperation.SplitStructFragment(e,n)),this._concreteOper?this._concreteOper.execute():null},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}}),Kekule.ChemSpaceEditorOperation={},Kekule.ChemSpaceEditorOperation.ChangeSpaceSize=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSize",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,i]),this.setCoordMode(n||Kekule.CoordMode.COORD2D),t&&this.setNewSize(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var n=this.getCoordMode();this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(n,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),n)}finally{}},doReverse:function(){var e=this.getEditor();if(this.getTarget(),this.getOldSize())try{var t=this.getCoordMode();e.changeChemSpaceSize(this.getOldSize(),t)}finally{}}}),Kekule.ChemSpaceEditorOperation.ShiftChildrenCoords=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ShiftChildrenCoords",initialize:function(e,t,n,i){this.tryApplySuper("initialize",[e,i]),this.setCoordMode(n||Kekule.CoordMode.COORD2D),t&&this.setCoordDelta(t)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH})},doExecute:function(){var e=this.getEditor(),t=(this.getTarget(),this.getCoordDelta()),n=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,n)}finally{}},doReverse:function(){var e=this.getEditor(),t=(this.getTarget(),Kekule.CoordUtils.multiply(this.getCoordDelta(),-1)),n=this.getCoordMode();try{e._shiftChemSpaceChildCoord(t,n)}finally{}}}),Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords",initialize:function(e,t,n,i,r){this.setPropStoreFieldValue("restoreScrollPosition",!0),this.tryApplySuper("initialize",[e,r]),this.setCoordMode(i||Kekule.CoordMode.COORD2D),t&&this.setNewSize(t),n&&this.setCoordDelta(n)},initProperties:function(){this.defineProp("restoreScrollPosition",{dataType:DataType.BOOL}),this.defineProp("coordMode",{dataType:DataType.INT}),this.defineProp("coordDelta",{dataType:DataType.HASH}),this.defineProp("newSize",{dataType:DataType.HASH}),this.defineProp("oldSize",{dataType:DataType.HASH,serializable:!1})},doExecute:function(){var e=this.getEditor(),t=this.getTarget();try{var n,i=this.getCoordMode(),r=this.getRestoreScrollPosition();r&&(n=e.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.getNewSize()&&(this.getOldSize()||this.setOldSize(Object.extend({},t.getSizeOfMode(i,e.getAllowCoordBorrow()))),e.changeChemSpaceSize(this.getNewSize(),i)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(this.getCoordDelta(),i),n=Kekule.CoordUtils.add(n,this.getCoordDelta())),r&&e._registerAfterUpdateObjectProc(function(){e.scrollClientToCoord(n,Kekule.Editor.CoordSys.CHEM)})}finally{}},doReverse:function(){var e=this.getEditor();if(this.getTarget(),this.getOldSize()||this.getCoordDelta())try{var t,n=this.getRestoreScrollPosition(),i=this.getCoordMode();n&&(t=e.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.getCoordDelta()&&(e._shiftChemSpaceChildCoord(Kekule.CoordUtils.multiply(this.getCoordDelta(),-1),i),t=Kekule.CoordUtils.substract(t,this.getCoordDelta())),this.getOldSize()&&e.changeChemSpaceSize(this.getOldSize(),i),this.getRestoreScrollPosition()&&t&&e._registerAfterUpdateObjectProc(function(){e.scrollClientToCoord(t,Kekule.Editor.CoordSys.CHEM)})}finally{}}})}(),Kekule.Editor.StructureUtils={getCascadeDeleteObjs:function(s){return Kekule.ChemStructureUtils.getCascadeDeleteObjs(s)},getSurroundingObjs:function(s){var e=s.getLinkedObjs();if(s instanceof Kekule.ChemStructureConnector){var t=s.getConnectedObjs();Kekule.ArrayUtils.pushUnique(e,t)}return e},calcMostEmptyDirectionAngleOfChemObj:function(s,e,t){var n=[];e||(e=s.getLinkedObjs());for(var i=s.getAbsBaseCoord2D(t),r=0,a=e.length;r<a;++r){var o=e[r].getAbsBaseCoord2D(t);o=Kekule.CoordUtils.substract(o,i);var l=Math.atan2(o.y,o.x);l<0&&(l=2*Math.PI+l),n.push(l)}if(n.sort(),(a=n.length)===0)return 0;if(a===1)return-n[0];var u=0,c=0;for(r=0;r<a;++r){var d=n[r],h=n[(r+1)%a]-d;h<0&&(h+=2*Math.PI),h>u&&(u=h,c=r)}return n[c]+u/2},calcPreferred2DBondGrowingDirection:function(s,e,t){var n=s.getAbsBaseCoord2D(t),i=Kekule.Editor.StructureUtils.getSurroundingObjs(s);switch(i?i.length:0){case 0:return e;case 1:var r=i[0].getAbsBaseCoord2D(t),a=Kekule.CoordUtils.substract(r,n),o=Math.atan2(a.y,a.x),l=o-e,u=o+e;return l<0&&(l+=2*Math.PI),u<0&&(u+=2*Math.PI),l!==u?Math.min(l>Math.PI?Math.abs(l-2*Math.PI):l,Math.abs(l-Math.PI))<=Math.min(u>Math.PI?Math.abs(u-2*Math.PI):u,Math.abs(u-Math.PI))?l:u:l;default:return Kekule.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(s,i,t)}},calcPreferred2DBondGrowingLocation:function(s,e,t,n){var i=s.getAbsBaseCoord2D(n),r=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(s,t,n);return Kekule.CoordUtils.add(i,{x:e*Math.cos(r),y:e*Math.sin(r)})},isBondPropsMatch:function(s,e,t){var n=!0;return n&&t.indexOf("bondType")>=0&&(n=s.bondType==e.bondType||!s.bondType&&!e.bondType),n&&s.bondType===Kekule.BondType.COVALENT&&((n&&t.indexOf("bondOrder")>=0||!s.bondOrder&&!e.bondOrder)&&(n=s.bondOrder==e.bondOrder),n&&t.indexOf("stereo")>=0&&(n=s.stereo==e.stereo||!s.stereo&&!e.stereo)),n&&(n=Kekule.ObjUtils.equal(s,e,["bondType","bondOrder","stereo"])),n},getChemStructureNodeLabel:function(s,e,t){if(s.getIsotopeId){var n=s.getIsotopeId();if(t&&t.includeExplicitHydrogens){var i=s.getExplicitHydrogenCount&&s.getExplicitHydrogenCount();i>0&&(n+="H"),i>1&&(n+=i.toString())}return n}if(s instanceof Kekule.SubGroup){var r=s.getAbbr()||s.getFormulaText();return e&&(r=r||e.getRgroup()),r}var a=s.getCoreDisplayRichTextItem(null,null,e);return Kekule.Render.RichTextUtils.toText(a)},getAllChemStructureNodesLabel:function(s,e,t){for(var n,i=0,r=s.length;i<r;++i){var a=s[i],o=Kekule.Editor.StructureUtils.getChemStructureNodeLabel(a,e,t);if(n){if(n!==o)return null}else n=o}return n},getAllChemStructureNodesHtmlCode:function(s,e,t,n){for(var i,r=0,a=s.length;r<a;++r){var o=s[r].getCoreDisplayRichTextItem(e,t,n),l=Kekule.Render.RichTextUtils.toSimpleHtmlCode(o);if(i){if(i!==l)return null}else i=l}return i},getStructureCenterAbsBaseCoord:function(s,e,t){for(var n=null,i=Kekule.CoordUtils.add,r=s.getNodeCount(),a=0;a<r;++a){var o=s.getNodeAt(a).getAbsBaseCoord(e,t);n=n?i(n,o):o}return n=Kekule.CoordUtils.divide(n,r)}},Kekule.Editor.RepositoryStructureUtils={_calcNodeMergeAdjustRotateAngle:function(s,e,t){var n=0,i=s.getCoordMode();if(i!==Kekule.CoordMode.COORD3D){var r=s.getAllowCoordBorrow(),a=s.getEditorConfigs().getStructureConfigs(),o=Kekule.Editor.StructureUtils.getSurroundingObjs(e),l=Kekule.Editor.StructureUtils.getSurroundingObjs(t);if(o.length===1){var u=(h=e.getLinkedConnectorAt(0)).getBondOrder?h.getBondOrder():0,c=a.getNewBondDefAngle(t,u);p=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(t,c,r);var d=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(e,o[0],i,r);n=p-Math.atan2(d.y,d.x)}else if(l.length===1){u=(h=t.getLinkedConnectorAt(0)).getBondOrder?h.getBondOrder():0,c=a.getNewBondDefAngle(e,u);var h,p=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(e,c,r);d=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(t,l[0],i,r),n=Math.atan2(d.y,d.x)-p}else{c=a.getNewBondDefAngle(t,null),p=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(t,c,r);for(var g={},f=0,m=o.length;f<m;++f){d=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(e,o[f],i,r);var C=Math.atan2(d.y,d.x);(Kekule.ObjUtils.isUnset(g.min)||C<g.min)&&(g.min=C),(Kekule.ObjUtils.isUnset(g.max)||C>g.max)&&(g.max=C)}n=p-(g.max+g.min)/2}}return n},_calcConnectorMergeTransformParams:function(s,e,t){var n=e.getConnectedObjAt(0),i=e.getConnectedObjAt(1),r=t.getConnectedObjAt(0),a=t.getConnectedObjAt(1),o=s.getObjCoord(n),l=s.getObjCoord(i),u=s.getObjCoord(r),c=s.getObjCoord(a);return Kekule.CoordUtils.calcCoordGroup2DTransformParams(o,l,c,u)},calcRepObjInitialTransformParams:function(s,e,t,n,i){var r,a=t.baseObjCoord,o=s.getDefBondLength()/e.getRefLength(),l=a;if(t.mergeObj&&(n=t.mergeDest||n)){if(i=s.getObjectScreenCoord(n),t.mergeObj instanceof Kekule.ChemStructureNode&&n instanceof Kekule.ChemStructureNode)r=Kekule.Editor.RepositoryStructureUtils._calcNodeMergeAdjustRotateAngle(s,t.mergeObj,n);else if(t.mergeObj instanceof Kekule.ChemStructureConnector&&n instanceof Kekule.ChemStructureConnector)return Kekule.Editor.RepositoryStructureUtils._calcConnectorMergeTransformParams(s,t.mergeObj,n)}var u=s.translateCoord(i,Kekule.Editor.CoordSys.SCREEN,Kekule.Editor.CoordSys.CHEM);return a&&(u=Kekule.CoordUtils.substract(u,a)),{scale:o,translateX:u.x,translateY:u.y,translateZ:u.z,rotateAngle:r,center:l}},transformChemObjectsCoordAndSize:function(s,e,t){var n=s.getCoordMode(),i=s.getAllowCoordBorrow(),r=n===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(t):Kekule.CoordUtils.calcTransform2DMatrix(t),a=Object.extend({},t);a=Object.extend(a,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});for(var o=n===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.calcTransform3DMatrix(a):Kekule.CoordUtils.calcTransform2DMatrix(a),l=0,u=e.length;l<u;++l){var c=e[l];c.transformAbsCoordByMatrix(r,o,n,!0,i),c.scaleSize(t.scale,n,!0,i)}}},Kekule.Editor.OperationUtils={createNodeModificationOperation:function(s,e,t,n,i){var r,a,o=s.getClass();if(e&&!t&&(t=e.getClass()),e||t!==o){r=new Kekule.MacroOperation,e||(e=new t);var l=new Kekule.ChemStructureNode;l.assign(s),e.assign(l);var u=new Kekule.ChemStructOperation.ReplaceNode(s,e,null,i);r.add(u)}else e=s;return n&&(Kekule.ObjUtils.match(e,n)||(a=new Kekule.ChemObjOperation.Modify(e,n,i),r&&r.add(a))),r||a},createNodeModificationOperationFromData:function(s,e,t){if(!e)return null;var n,i=e.nodeClass,r=e.props,a=e.repositoryItem;if(a){var o=a.createObjects(s)||{},l=o.objects,u=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(t,a,o,s,null);t.transformCoordAndSizeOfObjects(l,u),i=(n=l[0]).getClass()}if(e.isUnknownPseudoatom&&!t.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(i=null),i){if(r){var c=Object.extend({},r);if(s.getExplicitHydrogenCount&&s.getExplicitHydrogenCount()&&(c.explicitHydrogenCount=null),c.inputHydrogenCount&&c.isotopeId){var d,h=n||s;if(h&&h.getDisableImplicitHydrogenEstimation&&h.getDisableImplicitHydrogenEstimation())d=0;else{var p=s._getCurrCovalentBondsInfo&&s._getCurrCovalentBondsInfo()||{},g=s._getCurrIonicBondsInfo&&s._getCurrIonicBondsInfo()||{},f=Kekule.IsotopesDataUtil.getIsotopeIdDetail(c.isotopeId).symbol,m=Kekule.ChemicalElementsDataUtil.getAtomicNumber(f),C=Math.round(s.getCharge&&s.getCharge()||0),_=s.getRadical?Kekule.RadicalOrder.getRadicalElectronCount(s.getRadical()):0;d=Kekule.ChemStructureUtils.getImplicitHydrogenCount(m,{coValenceBondValenceSum:p.valenceSum||0,otherBondValenceSum:g.valenceSum||0,charge:C,radicalECount:_})}d!==c.inputHydrogenCount&&(c.explicitHydrogenCount=c.inputHydrogenCount,delete c.inputHydrogenCount)}}return Kekule.Editor.OperationUtils.createNodeModificationOperation(s,n,i,c,t)}return Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL")),null}},function(){var s=Class.PropertyScope;Kekule.Editor.BaseEditorConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs"),this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs"),this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs"),this.addConfigProp("hotKeyConfigs","Kekule.Editor.HotKeyConfigs")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.Editor.UiMarkerConfigs),this.setPropStoreFieldValue("interactionConfigs",new Kekule.Editor.InteractionConfigs),this.setPropStoreFieldValue("structureConfigs",new Kekule.Editor.StructureConfigs),this.setPropStoreFieldValue("hotKeyConfigs",new Kekule.Editor.HotKeyConfigs)}}),Kekule.Editor.ChemSpaceEditorConfigs=Class.create(Kekule.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs"),this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",void 0,{scope:s.PUBLIC})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("chemSpaceConfigs",new Kekule.Editor.ChemSpaceConfigs),this.setPropStoreFieldValue("styleSetterConfigs",new Kekule.Editor.StyleSetterConfigs)}}),Kekule.ClassUtils.makeSingleton(Kekule.Editor.ChemSpaceEditorConfigs),Kekule.Editor.InteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){var e=Math.PI/180;this.addBoolConfigProp("enableTrackOnNearest",!0),this.addBoolConfigProp("enableHotTrack",!0),this.addBoolConfigProp("scrollToObjAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterLoading",!0),this.addBoolConfigProp("autoExpandClientSizeAfterManipulation",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjects",!1),this.addBoolConfigProp("autoSelectNewlyInsertedObjectsOnTouch",!0),this.addIntConfigProp("objBoundTrackMinInflation",5),this.addIntConfigProp("objBoundTrackMinInflationMouse",null),this.addIntConfigProp("objBoundTrackMinInflationPen",null),this.addIntConfigProp("objBoundTrackMinInflationTouch",10),this.addFloatConfigProp("objBoundTrackInflationRatio",.2),this.addFloatConfigProp("objBoundTrackInflationRatioMouse",null),this.addFloatConfigProp("objBoundTrackInflationRatioPen",null),this.addFloatConfigProp("objBoundTrackInflationRatioTouch",.33),this.addBoolConfigProp("enablePartialAreaSelecting",!1),this.addFloatConfigProp("selectingBrushWidth",12),this.addBoolConfigProp("enableOffSelectionManipulation",!0),this.addIntConfigProp("offSelectionManipulationActivatingTimeThreshold",800),this.addFloatConfigProp("unmovePointerDistanceThreshold",5,{scope:s.PUBLIC}),this.addIntConfigProp("selectingCurveSimplificationDistanceThreshold",2,{scope:s.PUBLIC}),this.addIntConfigProp("selectionMarkerInflation",5),this.addIntConfigProp("selectionMarkerEdgeInflation",5),this.addIntConfigProp("selectionMarkerDefPulseDuration",500),this.addIntConfigProp("selectionMarkerDefPulseCount",2),this.addBoolConfigProp("followPointerCoordOnDirectManipulatingSingleObj",!0),this.addIntConfigProp("followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold",2),this.addFloatConfigProp("constrainedResizeStep",.125),this.addIntConfigProp("rotationRegionInflation",10),this.addFloatConfigProp("constrainedRotateStep",7.5*e),this.addIntConfigProp("rotationLocationPointDistanceThreshold",10),this.addIntConfigProp("directedMoveDistanceThreshold",10),this.addBoolConfigProp("enableMergePreview",!0),this.addBoolConfigProp("enableMagneticMerge",!0),this.addBoolConfigProp("enableNodeMerge",!0),this.addBoolConfigProp("enableNeighborNodeMerge",!0),this.addBoolConfigProp("enableConnectorMerge",!0),this.addBoolConfigProp("enableStructFragmentMerge",!0),this.addBoolConfigProp("enableGestureManipulation",!0),this.addBoolConfigProp("enableGestureZoomOnEditor",!0),this.addBoolConfigProp("enableHotKey",!0),this.addIntConfigProp("clonedObjectScreenOffset",10),this.addIntConfigProp("atomSetterFontSize",14),this.addBoolConfigProp("allowUnknownAtomSymbol",!0),this.addBoolConfigProp("enableBondKekulizeHucklize",!0),this.addIntConfigProp("trackSimplifierDistanceThreshold",8),this.addIntConfigProp("trackSimplifierIgnoreSegmentThreshold",10),this.addIntConfigProp("trackMergeDistanceThreshold",20),this.addFloatConfigProp("trackOptimizationAngleConstraint",30*e),this.addConfigProp("trackOptimizationDistanceConstraints",DataType.ARRAY,void 0,{scope:s.PUBLIC}),this.addIntConfigProp("trackOptimizationPrimaryDistanceConstraint",1),this.addFloatConfigProp("trackTouchRefLength",.5,{scope:s.PUBLIC}),this.addBoolConfigProp("autoAdjustZoomLevelOnTrackTouching",!1,{scope:s.PUBLIC}),this.addFloatConfigProp("editorInitialZoom",1.5)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTrackOptimizationDistanceConstraints([.5,1,3,4,5])}}),Kekule.Editor.UiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF"),this.addFloatConfigProp("hotTrackerOpacity",.5),this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF"),this.addFloatConfigProp("selectionMarkerStrokeWidth",2),this.addStrConfigProp("selectionMarkerFillColor","#0000FF"),this.addFloatConfigProp("selectionMarkerOpacity",.2),this.addFloatConfigProp("selectionMarkerEmphasisOpacity",.4),this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:s.PUBLIC}),this.addFloatConfigProp("selectionTransformMarkerOpacity",.4,{scope:s.PUBLIC}),this.addStrConfigProp("selectingMarkerStrokeColor","#000000"),this.addFloatConfigProp("selectingMarkerStrokeWidth",1),this.addStrConfigProp("selectingMarkerStrokeDash",!0),this.addStrConfigProp("selectingMarkerFillColor",null),this.addFloatConfigProp("selectingMarkerOpacity",.7),this.addStrConfigProp("selectingBrushMarkerStrokeColor","#0000FF"),this.addStrConfigProp("selectingBrushMarkerStrokeDash",!1),this.addFloatConfigProp("selectingBrushMarkerStrokeLineCap","round"),this.addFloatConfigProp("selectingBrushMarkerStrokeLineJoin","round"),this.addFloatConfigProp("selectingBrushMarkerOpacity",.3),this.addStrConfigProp("trackMarkerStrokeColor","#0000AA"),this.addFloatConfigProp("trackMarkerStrokeWidth",2),this.addStrConfigProp("trackMarkerStrokeDash",!1),this.addFloatConfigProp("trackMarkerOpacity",.5),this.addHashConfigProp("issueCheckMarkerColors",{error:{strokeColor:"#FF0000",fillColor:null,activeStrokeColor:"#FF0000",activeFillColor:"#FF6666"},warning:{strokeColor:"#f1a200",fillColor:null,activeStrokeColor:"#f1a200",activeFillColor:"#ffdb15"},note:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"},log:{strokeColor:"#00b0f0",fillColor:null,activeStrokeColor:"#007ca8",activeFillColor:"#00b0f0"}}),this.addFloatConfigProp("issueCheckMarkerStrokeWidth",2),this.addFloatConfigProp("issueCheckActiveMarkerStrokeWidth",2),this.addStrConfigProp("issueCheckMarkerOpacity",.3),this.addStrConfigProp("issueCheckActiveMarkerOpacity",.6),this.addStrConfigProp("flexStructureAssocMarkerColor","#0000AA"),this.addFloatConfigProp("flexStructureAssocMarkerOpacity",.5),this.addIntConfigProp("flexStructureAssocMarkerFontSize",14),this.addStrConfigProp("flexStructureAssocMarkerFontFamily","Arial, Helvetica, sans-serif")}}),Kekule.Editor.StructureConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",Kekule.BondType.DEFAULT,{enumSource:Kekule.BondType}),this.addIntConfigProp("defBondOrder",Kekule.BondOrder.SINGLE,{enumSource:Kekule.BondOrder}),this.addFloatConfigProp("defBondLength",Kekule.globalOptions.structure.defaultBondLength2D||.8),this.addConfigProp("defBondAngles",DataType.ARRAY,void 0,{scope:s.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionDelta",void 0,{scope:s.PUBLIC}),this.addConfigProp("bondConstrainedDirectionAngles",DataType.ARRAY,void 0,{scope:s.PUBLIC}),this.addFloatConfigProp("bondConstrainedDirectionAngleThreshold",void 0,{scope:s.PUBLIC}),this.addFloatConfigProp("initialBondDirection",void 0,{scope:s.PUBLIC}),this.addStrConfigProp("defIsotopeId","C"),this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,void 0,{scope:s.PUBLIC}),this.addIntConfigProp("maxFlexChainAtomCount",0),this.addIntConfigProp("minFlexRingAtomCount",3),this.addIntConfigProp("maxFlexRingAtomCount",18),this.addHashConfigProp("enabledNonAtomNodeTypes",{RGroup:!0,pseudoatomDummy:!0,pseudoatomHetero:!0,pseudoatomAny:!0,variableAtomList:!0,variableAtomNotList:!0}),this.addHashConfigProp("enabledBondForms",{single:!0,double:!0,triple:!0,quad:!0,explicitAromatic:!0,up:!0,upInverted:!0,down:!0,downInverted:!0,upOrDown:!0,eOrZ:!0,closer:!0,ionic:!1,coordinate:!1,metallic:!1,hydrogen:!0})},initPropValues:function(){this.tryApplySuper("initPropValues");var e=Math.PI/180,t=[],n=Kekule.BondOrder,i=2*Math.PI/3;t[0]=i,t[n.EXPLICIT_AROMATIC]=[i],t[n.TRIPLE]=[Math.PI],t[n.DOUBLE]=[i],t[n.DOUBLE][n.DOUBLE]=Math.PI,t[n.SINGLE]=[i],this.setDefBondAngles(t),this.setBondConstrainedDirectionDelta(10*Math.PI/180),this.setBondConstrainedDirectionAngles([0,90*e,180*e,270*e]),this.setBondConstrainedDirectionAngleThreshold(3*e),this.setInitialBondDirection(30*e),this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I","Si","D","C13"])},getDefAngleOfBonds:function(e,t){var n=e||0,i=t||0;n>i&&(n=t||0,i=e||0);var r=this.getDefBondAngles(),a=r[i];return a?a[n]||a[0]:r[0]},getNewBondDefAngle:function(e,t){var n;Kekule.ObjUtils.isUnset(t)&&(t=this.getDefBondOrder());var i=Kekule.Editor.StructureUtils.getSurroundingObjs(e);if(i.length===1){var r=e.getLinkedConnectorAt(0);if(r&&r.getConnectedObjs().indexOf(i[0])>=0){var a=r.getBondOrder?r.getBondOrder():null;Kekule.ObjUtils.notUnset(a)&&(n=this.getDefAngleOfBonds(t,a))}}else n=i.length===0?this.getInitialBondDirection():this.getDefAngleOfBonds(t,0);return n}}),Kekule.Editor.ChemSpaceConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D"),this.addHashConfigProp("defScreenSize3D"),this.addHashConfigProp("autoExpandScreenSize2D"),this.addHashConfigProp("autoExpandScreenSize3D"),this.addNumConfigProp("defPadding",50)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setDefScreenSize2D({x:900,y:1500}),this.setDefScreenSize3D({x:600,y:600,z:600}),this.setAutoExpandScreenSize2D({x:200,y:200}),this.setAutoExpandScreenSize3D({x:100,y:100,z:100})}}),Kekule.Editor.StyleSetterConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY}),this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]),this.setListedFontNames(Kekule.Widget.FontEnumerator.getAvailableFontFamilies())}}),Kekule.Editor.HotKeyConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.HotKeyConfigs",initProperties:function(){this.defineProp("hotKeys",{dataType:DataType.ARRAY})},initPropValues:function(){var e=Kekule.ChemWidget.ComponentWidgetNames;this.tryApplySuper("initPropValues"),this.setHotKeys([{key:"c",action:"atom_C"},{key:"h",action:"atom_H"},{key:"o",action:"atom_O"},{key:"n",action:"atom_N"},{key:"p",action:"atom_P"},{key:"s",action:"atom_S"},{key:"f",action:"atom_F"},{key:"Shift+C",action:"atom_Cl"},{key:"b",action:"atom_Br"},{key:"i",action:"atom_I"},{key:"Shift+B",action:"atom_B"},{key:"k",action:"atom_K"},{key:"Shift+N",action:"atom_Na"},{key:"d",action:"atom_D"},{key:"m",action:"subgroup_methyl"},{key:"e",action:"subgroup_ethyl"},{key:"t",action:"subgroup_TMS"},{key:"Shift+P",action:"subgroup_phenyl"},{key:"Shift+T",action:"subgroup_OTs"},{key:"Shift+E",action:"subgroup_COOCH3"},{key:"a",action:"atom_any"},{key:"q",action:"atom_hetero"},{key:"l",action:"atom_variable"},{key:"r",action:"subgroup_R"},{key:"1",action:"bond_single"},{key:"2",action:"bond_double"},{key:"3",action:"bond_triple"},{key:"4",action:"bond_quad"},{key:"b",action:"bond_closer"},{key:"w",action:"bond_up"},{key:"h",action:"bond_down"},{key:"Shift+W",action:"bond_down"},{key:"y",action:"bond_upOrDown"},{key:"Ctrl+A",action:e.selectAll},{key:"Ctrl+C",action:e.copy},{key:"Ctrl+X",action:e.cut},{key:"Ctrl+V",action:e.paste},{key:"Ctrl+Z",action:e.undo},{key:"Ctrl+Shift+Z",action:e.redo},{key:"+",action:e.zoomIn},{key:"-",action:e.zoomOut},{key:"Delete",action:e.eraseSelection},{key:"Backspace",action:e.eraseSelection}])}})}(),Kekule.Editor.RepositoryData={subGroups:[{name:"methyl",inputTexts:["Me","CH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Thu, 15 Sep 2016 15:49:02 GMT"},"__type__":"object"},"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Me","__type__":"Kekule.SubGroup"}'},{name:"ethyl",inputTexts:["Et","C2H5"],structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Et","__type__":"Kekule.SubGroup"}'},{name:"n-propyl",inputTexts:["n-Pr","nPr","C3H7"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Pr","formulaText":"C3H7","__type__":"Kekule.SubGroup"}'},{name:"i-propyl",inputTexts:["i-Pr","iPr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Pr","__type__":"Kekule.SubGroup"}'},{name:"n-butyl",inputTexts:["n-Bu","nBu","C4H9"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"n-Bu","formulaText":"C4H9","__type__":"Kekule.SubGroup"}'},{name:"i-butyl",inputTexts:["i-Bu","iBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.6928203230275507,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"i-Bu","__type__":"Kekule.SubGroup"}'},{name:"s-butyl",inputTexts:["s-Bu","sBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"s-Bu","__type__":"Kekule.SubGroup"}'},{name:"t-butyl",inputTexts:["t-Bu","tBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"t-Bu","__type__":"Kekule.SubGroup"}'},{name:"phenyl",inputTexts:["Ph","C6H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ph","formulaText":"C6H5","__type__":"Kekule.SubGroup"}'},{name:"benzyl",inputTexts:["Bn"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":1.1999999999999957,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bn","__type__":"Kekule.SubGroup"}'},{name:"benzoyl",inputTexts:["Bz"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":8.881784197001252e-16,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275516,"y":-0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":8.881784197001252e-16,"y":0.9999999999999964,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"overrideRenderOptionItems":[],"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Bz","__type__":"Kekule.SubGroup"}'},{inputTexts:["CF3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CF3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CCl3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CCl3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CBr3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CBr3","__type__":"Kekule.SubGroup"}'},{inputTexts:["CI3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999915,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CI3","__type__":"Kekule.SubGroup"}'},{inputTexts:["OMe","OCH3"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["OEt","OC2H5"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ot-Bu","OtBu"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275525,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275454,"y":0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.7763568394002505e-15,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ot-Bu","__type__":"Kekule.SubGroup"}'},{inputTexts:["CO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO","__type__":"Kekule.SubGroup"}'},{inputTexts:["CHO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CHO","__type__":"Kekule.SubGroup"}'},{name:"carboxyl",inputTexts:["COOH","CO2H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOH","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOOH","CO3H","CO2OH"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["COONa"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Na"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COONa","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOK"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"K"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOK","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOCH3","COOMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["COOC2H5","COOEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.039230484541326,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.039230484541326,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":1.039230484541326,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COOEt","__type__":"Kekule.SubGroup"}'},{inputTexts:["COCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["COBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COBr","__type__":"Kekule.SubGroup"}'},{inputTexts:["CONH2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CONH2","__type__":"Kekule.SubGroup"}'},{inputTexts:["Ac"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.34641016151377535,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Ac","__type__":"Kekule.SubGroup"}'},{inputTexts:["OAc"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"OAc","__type__":"Kekule.SubGroup"}'},{inputTexts:["MeCO","COMe"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34641016151377535,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.3464101615137771,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.3464101615137771,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COMe","__type__":"Kekule.SubGroup"}'},{inputTexts:["EtCO","COEt"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275525,"y":0.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-1.7763568394002505e-15,"y":-0.5999999999999943,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"COEt","__type__":"Kekule.SubGroup"}'},{name:"hydroxymethyl",inputTexts:["CH2OH"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999968,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CH2OH","__type__":"Kekule.SubGroup"}'},{inputTexts:["NMe2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NMe2","__type__":"Kekule.SubGroup"}'},{name:"nitro",inputTexts:["NO2"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275507,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO2","__type__":"Kekule.SubGroup"}'},{name:"nitroso",inputTexts:["NO"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"NO","__type__":"Kekule.SubGroup"}'},{name:"diazo",inputTexts:["N2","NN","N2 +"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3999999999999986,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.3999999999999986,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Cl","NNCl","N2 +Cl-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Cl-","__type__":"Kekule.SubGroup"}'},{inputTexts:["N2Br","NNBr","N2 +Br-"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.7763568394002505e-15,"y":0,"__type__":"object"},"charge":1,"radical":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":0,"__type__":"object"},"charge":-1,"radical":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"ionic","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"N2 +Br-","__type__":"Kekule.SubGroup"}'},{name:"nitrile group",inputTexts:["CN"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[],"coord2D":{"x":-0.34641016151377535,"y":0.19999999999999574,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.34641016151377535,"y":-0.20000000000000284,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":3,"electronCount":6,"isInAromaticRing":false,"connectedObjs":[1,0]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"CN","__type__":"Kekule.SubGroup"}'},{name:"pyridyl",inputTexts:["Py"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-8.881784197001252e-16,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.6928203230275498,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"Py","__type__":"Kekule.SubGroup"}'},{name:"sulfonic group",inputTexts:["SO3H"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000213,"y":7.105427357601002e-15,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000213,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.399999999999995,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO3H","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Cl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Cl","__type__":"Kekule.SubGroup"}'},{inputTexts:["SO2Br"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","id":null,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"SO2Br","__type__":"Kekule.SubGroup"}'},{inputTexts:["TMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"TMS","__type__":"Kekule.SubGroup"}'},{inputTexts:["OTMS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Si"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTMS","__type__":"Kekule.SubGroup"}'},{name:"OTs",inputTexts:["OTs","OTS"],dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":0.1999999999999993,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":1.7999999999999936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":1.399999999999988,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999989,"y":-0.5999999999999979,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-1.399999999999995,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.SubGroup","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275525,"y":-1.7999999999999936,"__type__":"object"},"charge":0,"parity":null}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[6,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[9,10]}],"__type__":"Kekule.StructureConnectionTable"},"abbr":"OTs","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgCl"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgCl","__type__":"Kekule.SubGroup"}'},{inputTexts:["MgBr"],dataFormat:"Kekule-JSON",structData:'{"id":null,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","id":null,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Mg"},{"__type__":"Kekule.Atom","id":null,"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","id":null,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"formulaText":"MgBr","__type__":"Kekule.SubGroup"}'}],fragments:[{name:"methane",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Sat, 25 Feb 2017 04:21:08 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[0],"connectors":[],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"fischer1",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0,"y":0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":1.7763568394002505e-15,"y":-0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer2",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.2000000000000028,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"fischer3",dataFormat:"Kekule-JSON",structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.7999999999999972,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.7763568394002505e-15,"y":1.6000000000000014,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999989,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.8000000000000007,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.7999999999999972,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-1.6000000000000085,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.8000000000000007,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'},{name:"sawhorseStaggered",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:51:35 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.34060000000000024,"y":-0.642199999999999,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.37219999999999764,"y":-1.0575999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.0877999999999997,"y":-0.648899999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3686000000000007,"y":-1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.34060000000000024,"y":0.6422000000000061,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.0877999999999997,"y":0.6489000000000011,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3686000000000007,"y":1.8829999999999991,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"zIndex2D":0,"coord2D":{"x":0.3722000000000012,"y":1.0576000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[6],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[7,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-6","__type__":"Kekule.Molecule"}'},{name:"sawhorseEclipsed",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:50:51 GMT"},"__type__":"object"},"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.3022000000000009,"y":0.4405000000000001,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.4229000000000003,"y":0.8340999999999994,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":1.1265,"y":0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null,null],"coord2D":{"x":0.44500000000000206,"y":1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-1.1265,"y":-1.6214000000000084,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":-0.4015000000000004,"y":-1.2276999999999987,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":0.3013999999999992,"y":-1.657899999999998,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"coord2D":{"x":-0.38010000000000055,"y":-0.4025999999999996,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-5","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:43:26 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.5715736151962387,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9715297072546738,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.20235354281841378,"y":-0.12653156366939555,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.5714766561436155,"y":-0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9715297072546738,"y":0.3463377359594517,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.20225658376579414,"y":0.1266285227220152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[1],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-1","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneChair2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:44:10 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.9716412105880998,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.5715992908679759,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.20239696641355032,"y":-0.14362717166194017,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":0.9716412105880998,"y":-0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.571696270727303,"y":0.3464120575127936,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.20239696641355032,"y":0.14372415152126905,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-2","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:35 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4999174283497734,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.4999174283497734,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclohexaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:47:08 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.47495070097202685,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.49991742834977515,"y":0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-1.1228227044047205,"y":-0.002525816777513512,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":1,"coord2D":{"x":0.47495070097202685,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":-0.49991742834977515,"y":-0.4693161866221871,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":10,"isInAromaticRing":false,"connectedObjs":[4,5]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-3","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth1",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:11 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.48039814732735664,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":-0.4815600495278858,"y":0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788133624967433,"y":-0.05620701895063007,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0006293636919529888,"y":-0.23639868521610907,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[3],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,4]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"cyclopentaneHaworth2",dataFormat:"Kekule-JSON",structData:'{"info":{"generator":"ChemDraw","date":{"__type__":"date","date":"Tue, 17 Jan 2017 12:48:04 GMT"},"__type__":"object"},"attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":-1,"coord2D":{"x":0.4804171472781027,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":-1,"coord2D":{"x":-0.48158784071773564,"y":0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[null],"zIndex2D":0,"coord2D":{"x":-0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":1,"coord2D":{"x":0.0005848625620670234,"y":-0.23640551451237002,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"overrideRenderOptionItems":[],"zIndex2D":0,"coord2D":{"x":0.7788490794655241,"y":-0.05617585542339043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[2],"connectors":[{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[4,3]},{"__type__":"Kekule.Bond","attachedMarkers":[],"coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"name":"Untitled Document-4","__type__":"Kekule.Molecule"}'},{name:"substituentMark",dataFormat:"Kekule-JSON",scale:.7,structData:'{"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Pseudoatom","coordPos2D":0,"coordPos3D":0,"renderOptions":{"nodeDisplayMode":-1,"__type__":"object"},"coord2D":{"x":0.40000000000000036,"y":0,"__type__":"object"},"charge":0,"parity":null,"atomType":"any","symbol":"A"}],"anchorNodes":[0],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"renderOptions":{"opacity":0.5,"__type__":"object"},"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}'}]},function(){Kekule.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAvailableCoordModes:function(){return[]},createObjects:function(e,t){},getScale:function(){return this.doGetScale()||1},doGetScale:function(){return 1},getRefLength:function(){return this.doGetRefLength()/(this.getScale()||1)},doGetRefLength:function(){},isOneStructureFragmentObj:function(){return!1}}),Kekule.Editor.MolRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRepositoryItem2D",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("molScale",{dataType:DataType.FLOAT}),this.defineProp("molManipulationCenterCoord",{dataType:DataType.HASH}),this.defineProp("molManipulationDefDirectionCoord",{dataType:DataType.HASH})},doGetScale:function(){return this.getMolScale()||this.tryApplySuper("doGetScale")},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},isOneStructureFragmentObj:function(){return!0},createObjects:function(e,t){var n=this.doCreateObjects(e,t);if(!n)return null;var i=null,r=null,a={x:0,y:0};return e&&(i=e instanceof Kekule.ChemStructureNode?this.doGetMergableNode(n,e):e instanceof Kekule.ChemStructureConnector?this.doGetMergableConnector(n,e):null)&&(r=e,a=i.getAbsBaseCoord2D()),{objects:[n],mergeObj:i,mergeDest:r,baseObjCoord:a,centerCoord:{x:0,y:0}}},doCreateObjects:function(e,t){return null},doGetMergableNode:function(e,t){return null},doGetMergableConnector:function(e,t){return null}}),Kekule.Editor.StoredStructFragmentRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredStructFragmentRepositoryItem2D",initialize:function(e,t,n){this.tryApplySuper("initialize"),this.beginUpdate();try{t&&this.setDataFormat(t),e&&this.setStructData(e),n&&this.setMolScale(n)}finally{this.endUpdate()}},initProperties:function(){this.defineProp("structureFragment",{dataType:"Kekule.StructureFragment",setter:null,serializable:!1}),this.defineProp("structData",{dataType:DataType.STRING}),this.defineProp("dataFormat",{dataType:DataType.STRING})},objectChange:function(e){if(this.tryApplySuper("objectChange",[e]),e.indexOf("structData")>=0||e.indexOf("dataFormat")>=0){var t=null;this.getStructData()&&(t=this._createTemplateStructFragment()),this.setPropStoreFieldValue("structureFragment",t)}},_createTemplateStructFragment:function(){var e=null;return this.getStructData()&&(e=Kekule.IO.loadFormatData(this.getStructData(),this.getDataFormat()||Kekule.IO.DataFormat.KEKULE_JSON)),e&&this._adjustTemplateStructureFragmentCoords(e),e},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=Kekule.Render.ObjUtils.getContainerBox(e,Kekule.CoordMode.COORD2D,!0);if(t){e.getCoordOfMode&&e.getCoordOfMode(Kekule.CoordMode.COORD2D,!0);var n={};n.x=-(t.x2+t.x1)/2,n.y=-(t.y2+t.y1)/2,e.beginUpdate();try{for(var i=0,r=e.getNodeCount();i<r;++i){var a=e.getNodeAt(i),o=a.getCoord2D(!0);o=Kekule.CoordUtils.add(o,n),a.setCoord2D(o)}}finally{e.endUpdate()}}},doGetRefLength:function(){var e=this.getStructureFragment();return e?e.getConnectorLengthMedian(Kekule.CoordMode.COORD2D,!0):0},doCreateObjects:function(e,t){var n=this.getStructureFragment();return n?n.clone():null},doGetMergableNode:function(e,t){return e.getAnchorNodeAt(0)||e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null}}),Kekule.Editor.StoredSubgroupRepositoryItem2D=Class.create(Kekule.Editor.StoredStructFragmentRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.StoredSubgroupRepositoryItem2D",initialize:function(e,t,n){this.tryApplySuper("initialize",[e,t,n])},initProperties:function(){this.defineProp("inputTexts",{dataType:DataType.STRING})},doCreateObjects:function(e,t){var n=this.getStructureFragment();if(n){var i=new Kekule.SubGroup;return i.assign(n,!1),i}return null},createObjects:function(e){return this.tryApplySuper("createObjects",[e])},_adjustTemplateStructureFragmentCoords:function(e){e.setCoord2D({x:0,y:0});var t=e.getCurrConnectableObj();if(t){var n=Kekule.CoordUtils.substract({x:0,y:0},t.getCoord2D(!0));e.beginUpdate();try{for(var i=0,r=e.getNodeCount();i<r;++i){var a=e.getNodeAt(i),o=a.getCoord2D(!0);o=Kekule.CoordUtils.add(o,n),a.setCoord2D(o)}}finally{e.endUpdate()}}}}),Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText=function(e){for(var t=Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[],n=0,i=t.length;n<i;++n){var r=t[n];if((r.getInputTexts()||[]).indexOf(e)>=0)return r}return null},Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems=function(){return Kekule.Editor.RepositoryItemManager.getAllItems(Kekule.Editor.StoredSubgroupRepositoryItem2D)||[]},Kekule.Editor.MolRingRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function(e,t){this.tryApplySuper("initialize"),this.setRingAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT,setter:function(e){e!==this.getBondLength()&&this.setPropStoreFieldValue("bondLength",e)}}),this.defineProp("isAromatic",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var n=t&&t.originalStructFragment;return this.generateRing(n)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return e.getConnectorAt(0)},generateRing:function(e,t){var n;t||(t=Kekule.Molecule),n=e||new t;var i=this.getRingAtomCount();n.beginUpdate();try{n.setCoord2D({x:0,y:0});var r,a=n.getNodeCount();if(a>i)for(var o=a-1;o>=i;--o)n.removeNodeAt(o);for(o=n.getConnectorCount()-1;o>=0;--o)n.removeConnectorAt(o);r=this.getEnableCoordCache()&&this._hasCoordCache(i)?this._getCachedCoords(i):this._calcAtomCoords(i);var l,u,c,d=this.getBondLength();for(o=0;o<i;++o){var h=n.getNodeAt(o);h||(h=this._generateAtom(o),n.appendNode(h));var p=r[o];if(d!==1&&(p=Kekule.CoordUtils.multiply(p)),h.setCoord2D(p),o===0&&(c=h),l){var g=this._generateBond(u,o);n.appendConnector(g),g.appendConnectedObj(l),g.appendConnectedObj(h)}l=h,u=o}g=this._generateBond(i-1,0),n.appendConnector(g),g.appendConnectedObj(l),g.appendConnectedObj(c)}finally{n.endUpdate()}return n},_generateAtom:function(e){return new Kekule.Atom(null,"C")},_generateBond:function(e,t){var n=Kekule.BondOrder.SINGLE;return this.getIsAromatic()&&e%2&&(n=Kekule.BondOrder.DOUBLE),new Kekule.Bond(null,null,n)},_calcAtomCoords:function(e){for(var t=this.getEnableCoordCache(),n=Math.PI/e,i=2*n,r=.5/Math.sin(n),a=e===4||e===8?-Math.PI/2-i/2:-Math.PI/2,o=[],l=0;l<e;++l){var u={x:r*Math.cos(a),y:r*Math.sin(a)};o.push(u),t&&this._setCoordToCache(u,e,l),a+=i}return o},_initCoordCache:function(){this._coordCache=[];for(var e=3;e<13;++e)this._calcAtomCoords(e)},_clearCoordCache:function(){this._coordCache=[]},_setCoordToCache:function(e,t,n){var i=this._coordCache[t];i||(i=[],this._coordCache[t]=i),i[n]=e},_getCachedCoord:function(e,t){var n=this._coordCache[e];return n&&n[t]},_getCachedCoords:function(e){return this._coordCache[e]},_hasCoordCache:function(e){return!(!this._coordCache||!this._coordCache[e])}}),Kekule.Editor.MolChainRepositoryItem2D=Class.create(Kekule.Editor.MolRepositoryItem2D,{CLASS_NAME:"Kekule.Editor.MolChainRepositoryItem2D",STEP_X_INC:Math.cos(30/180*Math.PI),STEP_Y_INC:Math.sin(30/180*Math.PI),initialize:function(e,t){this.tryApplySuper("initialize"),this.setAtomCount(e),this.setBondLength(t||1)},initProperties:function(){this.defineProp("atomCount",{dataType:DataType.INT}),this.defineProp("bondLength",{dataType:DataType.FLOAT}),this.defineProp("negativeDirection",{dataType:DataType.BOOL}),this.defineProp("enableCoordCache",{dataType:DataType.BOOL,setter:function(e){e!==this.getEnableCoordCache()&&(this.setPropStoreFieldValue("enableCoordCache",e),e&&!this._coordCache&&this._initCoordCache())}})},doGetRefLength:function(){return this.getBondLength()},doCreateObjects:function(e,t){var n=t&&t.originalStructFragment;return this.generateChain(n)},doGetMergableNode:function(e,t){return e.getNodeAt(0)},doGetMergableConnector:function(e,t){return null},generateChain:function(e,t){t||(t=Kekule.Molecule);var n=e||new t,i=this.getAtomCount(),r=this.getBondLength()||1,a=this.getNegativeDirection();n.beginUpdate();try{n.setCoord2D({x:0,y:0});var o=n.getNodeCount();if(o>i)for(var l=o-1;l>=i;--l)n.removeNodeAt(l);var u,c,d=n.getConnectorCount();if(d>i-1)for(l=d-1;l>=i-1;--l)n.removeConnectorAt(l);l=0;for(var h=i;l<h;++l){u=p;var p,g=!1;(p=n.getNodeAt(l))||(p=this._generateAtom(l),g=!0);var f=this._getCachedCoord(l);f||(f=this._calcAtomCoord(l)),r!==1&&(f=Kekule.CoordUtils.multiply(f,r)),a&&(f={x:f.x,y:-f.y}),p.setCoord2D(f),g&&n.appendNode(p),u&&g&&(c=this._generateBond(l-1,l),n.appendConnector(c),c.appendConnectedObj(u),c.appendConnectedObj(p))}}finally{n.endUpdate()}return this.setMolManipulationCenterCoord({x:0,y:0}),this.setMolManipulationDefDirectionCoord({x:1,y:0}),n},_generateAtom:function(e){return new Kekule.Atom(null,"C")},_generateBond:function(e,t){var n=Kekule.BondOrder.SINGLE;return new Kekule.Bond(null,null,n)},_calcAtomSetCoords:function(e){var t=this.getEnableCoordCache(),n={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},i=[],r={x:0,y:0};i.push(r),this._coordCache[0]=r;for(var a=1,o=e;a<o;++a)r={x:r.x+n.x,y:a%2?n.y:0},i.push(r),t&&(this._coordCache[a]=r);return i},_calcAtomCoord:function(e){var t={x:1*this.STEP_X_INC,y:1*this.STEP_Y_INC},n={x:t.x*e,y:e%2?t.y:0};return this._coordCache&&(this._coordCache[e]=n),n},_initCoordCache:function(){this._coordCache=[],this._calcAtomSetCoords(30)},_clearCoordCache:function(){this._coordCache=[]},_getCachedCoord:function(e){return this._coordCache&&this._coordCache[e]}}),Kekule.Editor.PathGlyphRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function(e,t,n){this.tryApplySuper("initialize"),this.setGlyphClass(e),this.setGlyphRefLength(t||1),this.setGlyphInitialParams(n)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},doGetRefLength:function(){return this.getGlyphRefLength()},createObjects:function(e){var t={x:0,y:0};return{objects:[this.generateGlyph()],mergeObj:null,mergeDest:null,baseObjCoord:t,centerCoord:t}},generateGlyph:function(){return new(this.getGlyphClass())(null,this.getGlyphRefLength(),this.getGlyphInitialParams())}}),Kekule.Editor.RepositoryItemManager={_itemClassMap:new Kekule.MapEx(!0),_itemNameMap:new Kekule.MapEx(!0),getAllItems:function(e){return s._itemClassMap.get(e)},getItem:function(e){return s._itemNameMap.get(e)},register:function(e){var t,n=e.getName();n&&(t=s.getItem(),s._itemNameMap.set(n,e));var i=e.getClass(),r=s.getAllItems(i);r?t?Kekule.ArrayUtils.replace(r,t,e):Kekule.ArrayUtils.pushUnique(r,e):(r=[e],s._itemClassMap.set(i,r))},unregister:function(e){var t=e.getClass(),n=s.getAllItems(t);n&&Kekule.ArrayUtils.remove(n,e);var i=e.getName();i&&s._itemNameMap.remove(i)}};var s=Kekule.Editor.RepositoryItemManager;Kekule._registerAfterLoadSysProc(function(){if(Kekule.Editor.RepositoryData){for(var e=0,t=(i=Kekule.Editor.RepositoryData.subGroups||[]).length;e<t;++e){var n=i[e];(r=new Kekule.Editor.StoredSubgroupRepositoryItem2D(n.structData,n.dataFormat,n.scale)).setInputTexts(n.inputTexts).setName(n.name||n.inputTexts[0]),s.register(r)}var i;for(e=0,t=(i=Kekule.Editor.RepositoryData.fragments||[]).length;e<t;++e){var r;n=i[e],(r=new Kekule.Editor.StoredStructFragmentRepositoryItem2D(n.structData,n.dataFormat,n.scale)).setName(n.name),s.register(r)}}})}(),function(){var s=Kekule.ObjUtils,e=Kekule.ArrayUtils,t=Kekule.Widget.HtmlClassNames,n=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{STRUCTURE_NODE_SELECT_PANEL:"K-Chem-StructureNodeSelectPanel",STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureNodeSelectPanel-SetButton",STRUCTURE_NODE_SETTER:"K-Chem-StructureNodeSetter",STRUCTURE_NODE_SETTER_INPUTBOX:"K-Chem-StructureNodeSetter-InputBox",STRUCTURE_CONNECTOR_SELECT_PANEL:"K-Chem-StructureConnectorSelectPanel",STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON:"K-Chem-StructureConnectorSelectPanel-SetButton",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV:"K-Chem-StructureConnectorSelectPanelAdv",STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Kekulize",STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE:"K-Chem-StructureConnectorSelectPanelAdv-ExtraSection-Button-Hucklize",CHARGE_SELECT_PANEL:"K-Chem-Charge-SelectPanel",CHARGE_SELECT_PANEL_BTNGROUP:"K-Chem-Charge-SelectPanel-BtnGroup",CHARGE_SELECT_PANEL_CHARGE_BUTTON:"K-Chem-Charge-SelectPanel-ChargeButton",GLYPH_PATH_ARROW_SETTING_PANEL:"K-Chem-GlyphPath-Arrow-SettingPanel",GLYPH_PATH_ARROW_STYLE_BTNGROUP:"K-Chem-GlyphPath-Arrow-StyleButtonGroup",GLYPH_PATH_ARROW_STYLE_BUTTON:"K-Chem-GlyphPath-Arrow-StyleButton",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BTNGROUP:"K-Chem-GlyphPath-Arrow-ContinuousSidesButtonGroup",GLYPH_PATH_ARROW_CONTINUOUS_SIDES_BUTTON:"K-Chem-GlyphPath-Arrow-ContinuousSidesButton",GLYPH_Path_ARROW_SIZE_SETTER:"K-Chem-GlyphPath-Arrow-SizeSetter",GLYPH_REACTION_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ReactionArrow-PresetSelector",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonSet-DropDown",GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ReactionArrow-PresetSelector-Button",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP:"K-Chem-Glyph-ReactionArrow-PresetSelector-ButtonGroup",GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON:"K-Chem-Glyph-ElectronPushingArrow-PresetSelector-Button",GLYPH_PATH_LINE_SETTING_PANEL:"K-Chem-GlyphPath-Line-SettingPanel",GLYPH_PATH_SETTING_PANEL:"K-Chem-GlyphPath-SettingPanel",GLYPH_PATH_SETTING_PANEL_SECTION:"K-Chem-GlyphPath-SettingPanel-Section",GLYPH_PATH_SETTING_PANEL_SECTION_TITLE:"K-Chem-GlyphPath-SettingPanel-Section-Title",GLYPH_PATH_SETTING_PANEL_SECTION_PANEL:"K-Chem-GlyphPath-SettingPanel-Section-Panel",GLYPH_MULTIPATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel",GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP:"K-Chem-GlyphMultiPath-SettingPanel-PathTabGroup",GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL:"K-Chem-GlyphMultiPath-SettingPanel-PathSettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL:"K-Chem-ReactionArrow-SettingPanel",GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION:"K-Chem-ReactionArrow-SettingPanel-ArrowPresetSection",GLYPH_ARC_PATH_SETTING_PANEL:"K-Chem-ArcPath-SettingPanel",GLYPH_MULTIARC_PATH_SETTING_PANEL:"K-Chem-MultiArcPath-SettingPanel",GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-ElectronPusingArrow-SettingPanel",GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL:"K-Chem-MultiElectronPusingArrow-SettingPanel"}),Kekule.ChemWidget.StructureNodeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSelectPanel",BTN_DATA_FIELD:"__$btn_data__",initialize:function(i){this.setPropStoreFieldValue("displayElements",!0),this.setPropStoreFieldValue("displayNonElements",!0),this.setPropStoreFieldValue("displaySubgroups",!0),this.tryApplySuper("initialize",[i]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("elementSymbols",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("nonElementInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupInfos",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("subGroupRepItems",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(i){this.setPropStoreFieldValue("subGroupRepItems",i),this._updateSubGroupInfosFromRepItems(i)}}),this.defineProp("displayElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displayNonElements",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("displaySubgroups",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLISHED}),this.defineProp("activeNode",{dataType:DataType.ARRAY,serializable:!1,setter:function(i){this.setPropStoreFieldValue("activeNode",i),this.activeNodeChanged(i)}}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PRIVATE,serializable:!1,setter:null,getter:function(i){var r=this.getPropStoreFieldValue("periodicTableDialog");if(!r&&i){var a=this.getCoreElement(),o=this.getDocument();r=this._createPeriodicTableDialogWidget(o,a),this.setPropStoreFieldValue("periodicTableDialog",r)}return r}})},initPropValues:function(){return this.tryApplySuper("initPropValues")},doFinalize:function(){var i=this.getPeriodicTableDialog();i&&i.finalize(),this.tryApplySuper("doFinalize")},setSelectableInfos:function(i){this.beginUpdate();try{this.setPropValues(i)}finally{this.endUpdate()}},reactSelButtonExec:function(i){var r=this,a=i.target;if(this._selButtons.indexOf(a)>=0){var o=a[this.BTN_DATA_FIELD];o&&(o.isPeriodicTable?this._openPeriodicTableDialog(a,function(l){if(l===Kekule.Widget.DialogButtons.OK){var u=r._periodicTable.getSelectedSymbol();r.doValueChanged(r.generateSelectableDataFromElementSymbol(u))}},{isSimpleAtom:!0}):o.isVarList||o.isVarNotList?this._openPeriodicTableDialog(a,function(l){if(l===Kekule.Widget.DialogButtons.OK){var u=r._periodicTable.getSelectedSymbols(),c=Kekule.VariableAtom,d=o.isVarList?{allowedIsotopeIds:u,disallowedIsotopeIds:null}:{allowedIsotopeIds:null,disallowedIsotopeIds:u};r.doValueChanged({nodeClass:c,props:d})}},{isVarList:o.isVarList,isVarNotList:o.isVarNotList}):this.doValueChanged(o))}},doValueChanged:function(i){this.setPropStoreFieldValue("value",i),this.invokeEvent("valueChange",{value:{nodeClass:i.nodeClass,props:i.props,repositoryItem:i.repositoryItem}})},activeNodeChanged:function(i){},doObjectChange:function(i){Kekule.ArrayUtils.intersect(i,["elementSymbols","nonElementInfos","subGroupInfos","displayElements","displayNonElements","displaySubGroups"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_NODE_SELECT_PANEL},doCreateRootElement:function(i){return i.createElement("span")},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]);return this.updatePanelContent(i,this.getChildrenHolderElement()),a},_updateSubGroupInfosFromRepItems:function(i){var r=[];if(i&&i.length){for(var a=0,o=i.length;a<o;++a){var l=i[a],u=l.getStructureFragment(),c=u.getAbbr();if(!c){var d=u.getFormulaText(),h=Kekule.FormulaUtils.textToFormula(d).getDisplayRichText();c=Kekule.Render.RichTextUtils._toDebugHtml(h)}var p={text:c,repositoryItem:l,nodeClass:u.getClass(),node:u,hint:l.getName()};r.push(p)}this.setSubGroupInfos(r)}},updatePanelContent:function(i,r){if(this._selButtons)for(var a=this._selButtons.length-1;a>=0;--a){var o=this._selButtons[a];this.removeWidget(o)}this._selButtons=[],Kekule.DomUtils.clearChildContent(r);var l=this.generateSelectableData(),u=this._getDisplayedTabPageNames(),c=new Kekule.Widget.TabView(this);if(u.indexOf("atom")>=0){var d=c.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM"));this.getDisplayElements()&&this.doCreateSelButtonSection(i,d.getCoreElement(),l.elementData),this.getDisplayNonElements()&&this.doCreateSelButtonSection(i,d.getCoreElement(),l.nonElementData,!0)}if(u.indexOf("subgroup")>=0){var h=c.createNewTabPage(Kekule.$L("ChemWidgetTexts.CAPTION_SUBGROUP"));this.doCreateSelButtonSection(i,h.getCoreElement(),l.subGroupData,!0)}c.setShowTabButtons(u.length>1)},_getDisplayedTabPageNames:function(){var i=[];return(this.getDisplayElements()||this.getDisplayNonElements())&&i.push("atom"),this.getDisplaySubgroups()&&i.push("subgroup"),i},generateSelectableDataFromElementSymbol:function(i){var r=i,a=Kekule.IsotopesDataUtil.getIsotopeInfoById(i);return a&&(r=a.isotopeAlias?a.isotopeAlias:"<sup>"+a.massNumber+"</sup>"+a.elementSymbol),{text:r,nodeClass:Kekule.Atom,props:{isotopeId:i}}},generateSelectableData:function(){for(var i=this.getElementSymbols()||[],r=[],a=0,o=i.length;a<o;++a){var l;l=i[a]==="..."?{text:"…",nodeClass:null,hint:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE"),isPeriodicTable:!0}:this.generateSelectableDataFromElementSymbol(i[a]),r.push(l)}return{elementData:r,nonElementData:this.getNonElementInfos(),subGroupData:this.getSubGroupInfos()}},doCreateSelButton:function(i,r,a,o){var l=a.text;o&&a.description&&(l+='<span style="font-size:80%"> '+a.description+"</span>");var u=new Kekule.Widget.Button(i,l);return u.addClassName(n.STRUCTURE_NODE_SELECT_PANEL_SET_BUTTON),u.setGroup&&u.setGroup(this.getClassName()),a.hint&&u.setHint(a.hint),u[this.BTN_DATA_FIELD]=a,this._selButtons.push(u),u},doCreateSectionSelButtons:function(i,r,a,o){if(a)for(var l=0,u=a.length;l<u;++l){var c=this.doCreateSelButton(i,r,a[l],o);c.setParent(this),c.appendToElem(r)}},doCreateSection:function(i,r){var a=i.createElement("div");return a.className=t.SECTION,r&&r.appendChild(a),a},doCreateSelButtonSection:function(i,r,a,o){var l=this.doCreateSection(i,r);return this.doCreateSectionSelButtons(i,l,a,o),l},_createPeriodicTableDialogWidget:function(i,r){var a=new Kekule.Widget.Dialog(i,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),o=new Kekule.ChemWidget.PeriodicTable(i);return o.setUseMiniMode(!0).setEnableSelect(!0),o.setParent(a),o.appendToElem(a.getClientElem()),this._periodicTable=o,a},_openPeriodicTableDialog:function(i,r,a){var o=this.getPeriodicTableDialog(!0),l=a.isVarList||a.isVarNotList;this._periodicTable.setEnableMultiSelect(l).setSelectedSymbol(null);var u=this.getActiveNode();if((a.isVarList||a.isVarNotList)&&u instanceof Kekule.VariableAtom){var c=u.getAllowedIsotopeIds(),d=u.getDisallowedIsotopeIds();this._periodicTable.setSelectedSymbols(a.isVarList?c:d)}!l&&u instanceof Kekule.Atom&&this._periodicTable.setSelectedSymbol(u.getSymbol()),o.openPopup(r,i||this)}}),Kekule.ChemWidget.StructureNodeSetter=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.ChemWidget.StructureNodeSetter",initialize:function(i){this.tryApplySuper("initialize",[i]),this._valueSetBySelectPanel=!1},initProperties:function(){this.defineProp("enableHydrogenCountInput",{dataType:DataType.BOOL}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:function(i){var r=Kekule.ArrayUtils.toArray(i);this.setPropStoreFieldValue("nodes",r),this.nodesChanged(r)}}),this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(){var i=this.getPropStoreFieldValue("value");if(!i&&!this._valueSetBySelectPanel){var r=this.getNodeInputBox().getValue();i=this._getValueFromDirectInputText(r)||i}return i}}),this.defineProp("nodeLabel",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getNodeInputBox().getValue()}}),this.defineProp("nodeInputBox",{dataType:"Kekule.Widget.ButtonTextBox",serializable:!1,setter:!1}),this.defineProp("nodeInputBoxFontSize",{dataType:DataType.STRING,serializable:!1,setter:function(i){this.getNodeInputBox().getTextBox().getElement().style.fontSize=i,this.setPropStoreFieldValue("nodeInputBoxFontSize",i)}}),this.defineProp("nodeSelectPanel",{dataType:"Kekule.ChemWidget.StructureNodeSelectPanel",serializable:!1,setter:!1}),this.defineProp("showInputBox",{dataType:DataType.BOOL,getter:function(){return this.getNodeInputBox().getDisplayed()},setter:function(i){this.getNodeInputBox().setDisplayed(i)}}),this.defineProp("showSelectPanel",{dataType:DataType.BOOL,getter:function(){return this.getNodeSelectPanel().getDisplayed()},setter:function(i){this.getNodeSelectPanel().setDisplayed(i)}}),this.defineProp("useDropDownSelectPanel",{dataType:DataType.BOOL,setter:function(i){this.getUseDropDownSelectPanel()!==i&&(this.setPropStoreFieldValue("useDropDownSelectPanel",i),this._updateDropDownSettings(i))}}),this.defineProp("labelConfigs",{dataType:DataType.OBJECT,serializable:!1}),this._defineSelectPanelDelegatedProp("selectableElementSymbols","elementSymbols"),this._defineSelectPanelDelegatedProp("selectableNonElementInfos","nonElementInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupInfos","subGroupInfos"),this._defineSelectPanelDelegatedProp("selectableSubGroupRepItems","subGroupRepItems"),this._defineSelectPanelDelegatedProp("displaySelectableElements","displayElements"),this._defineSelectPanelDelegatedProp("displaySelectableNonElements","displayNonElements"),this._defineSelectPanelDelegatedProp("displaySelectableSubgroups","displaySubgroups")},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableHydrogenCountInput(!0)},doFinalize:function(){var i=this.getNodeSelectPanel();i&&i.finalize();var r=this.getNodeInputBox();r&&r.finalize(),this.tryApplySuper("doFinalize")},_defineSelectPanelDelegatedProp:function(i,r){r||(r=i);var a=ClassEx.getPropInfo(Kekule.ChemWidget.StructureNodeSelectPanel,r),o=Object.create(a);return o.getter=null,o.setter=null,a.getter&&(o.getter=function(){return this.getNodeSelectPanel().getPropValue(r)}),a.setter&&(o.setter=function(l){this.getNodeSelectPanel().setPropValue(r,l)}),this.defineProp(i,o)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_NODE_SETTER},doCreateRootElement:function(i){return i.createElement("span")},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this,l=new Kekule.Widget.ButtonTextBox(this);this.setPropStoreFieldValue("nodeInputBox",l),l.addClassName(n.STRUCTURE_NODE_SETTER_INPUTBOX),l.appendToElem(this.getCoreElement()),l.addEventListener("valueChange",function(c){o._valueSetBySelectPanel=!1,c.stopPropagation()}),l.addEventListener("keyup",function(c){var d=c.htmlEvent.getKeyCode();d===Kekule.X.Event.KeyCode.ENTER&&o._applyDirectInput(),o.getUseDropDownSelectPanel()&&(d===Kekule.X.Event.KeyCode.DOWN?o.showNodeSelectPanel():d===Kekule.X.Event.KeyCode.UP&&o.hideNodeSelectPanel())}),l.addEventListener("blur",function(c){c.target===l.getTextBox()&&l.getIsDirty()&&o._applyDirectInput()}),l.getButton().addEventListener("execute",function(c){o.getUseDropDownSelectPanel()?o.toggleNodeSelectPanel():o._applyDirectInput()});var u=new Kekule.ChemWidget.StructureNodeSelectPanel(this);return this.setPropStoreFieldValue("nodeSelectPanel",u),u.appendToElem(this.getCoreElement()),u.addEventListener("valueChange",function(c){Object.extend({},c),c.stopPropagation(),o._valueSetBySelectPanel=!0,o.doValueChanged(c.value,!0),o.getUseDropDownSelectPanel()&&u.hide()}),this._updateDropDownSettings(this.getUseDropDownSelectPanel()),a},_updateDropDownSettings:function(i){var r=this.getNodeInputBox(),a=this.getNodeSelectPanel();i?(r.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),a.removeFromDom(),a.hide(null,null,Kekule.Widget.ShowHideType.DEFAULT)):(r.setButtonKind(Kekule.Widget.Button.Kinds.ENTER),a.appendToElem(this.getCoreElement()),a.setStyleProperty("position",""),a.show(null,null,Kekule.Widget.ShowHideType.DEFAULT))},_indexOfNonElementLabel:function(i){for(var r=this.getNonAtomLabelInfos(),a=0,o=r.length;a<o;++a)if(r[a].nodeLabel===i)return a;return-1},_getNonAtomInfo:function(i){var r=this.getSelectableNonElementInfos();if(r)for(var a=0,o=r.length;a<o;++a){var l=r[a];if(l.text===i)return l}return null},_getNodeWithExplicitHInfo:function(i){var r={},a=i.trim().match(/^(\d*[A-Z][a-z]?\d*)H(\d*)$/);return a?(r.core=a[1],r.explicitHCount=parseInt(a[2])||1):r.core=i,r},_getValueFromDirectInputText:function(i){if(!i)return null;var r,a,o,l,u,c=this._getNonAtomInfo(i);if(c)r=c.nodeClass,a=c.props;else{var d=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(i);if(o=d,d)r=d.getStructureFragment().getClass();else if(i){var h=i;if(!(r=Kekule.ChemStructureNodeFactory.getClassByLabel(h,null))){if(this.getEnableHydrogenCountInput()){var p=this._getNodeWithExplicitHInfo(h);p.explicitHCount&&(r=Kekule.ChemStructureNodeFactory.getClassByLabel(p.core,null))&&(u=p.explicitHCount,h=p.core)}r||(r=Kekule.Pseudoatom,l=!0)}a=r===Kekule.Atom?{isotopeId:h,inputHydrogenCount:u}:r===Kekule.Pseudoatom?{symbol:i}:{}}}return{nodeClass:r,props:a,repositoryItem:o,isUnknownPseudoatom:l}},_applyDirectInput:function(){this._valueSetBySelectPanel=!1;var i=this.getNodeInputBox();if(i.getIsDirty()){var r=i.getValue();if(r){var a=this._getValueFromDirectInputText(r);a&&this.doValueChanged(a)}i.setIsDirty(!1)}else this.doValueChanged(null)},_getVarAtomListLabel:function(){var i=this.getLabelConfigs();return i?i.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var i=this.getLabelConfigs();return"~"+(i?i.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},_getAllNodeLabels:function(i){var r={};return this.getEnableHydrogenCountInput()&&(r.includeExplicitHydrogens=!0),Kekule.Editor.StructureUtils.getAllChemStructureNodesLabel(i,this.getLabelConfigs(),r)},nodesChanged:function(i){var r=this._getAllNodeLabels(i)||"",a=r?i[0]:null;this.getNodeSelectPanel().setActiveNode(a),this.getNodeInputBox().setValue(r),this.getNodeInputBox().setIsDirty(!1),this.setPropStoreFieldValue("value",null),this._valueSetBySelectPanel=!1},doValueChanged:function(i,r){this.setPropStoreFieldValue("value",i);var a=i&&{nodeClass:i.nodeClass,props:i.props,repositoryItem:i.repositoryItem,isUnknownPseudoatom:i.isUnknownPseudoatom};r&&this.invokeEvent("valueSelect",{value:a}),this.invokeEvent("valueChange",{value:a})},setSelectableInfos:function(i){this.getNodeSelectPanel().setSelectableInfos(i)},showNodeSelectPanel:function(){var i=this.getNodeSelectPanel();i.isShown()||i.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)},hideNodeSelectPanel:function(){var i=this.getNodeSelectPanel();i.isShown()&&i.hide()},toggleNodeSelectPanel:function(){var i=this.getNodeSelectPanel();i.isShown()?i.hide():i.show(this.getNodeInputBox(),null,Kekule.Widget.ShowHideType.DROPDOWN)}}),Kekule.ChemWidget.StructureConnectorSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanel",BTN_DATA_FIELD:"__$btn_data__",BTN_GROUP:"__$bond_btn_group__",initialize:function(i){this.tryApplySuper("initialize",[i]),this._selButtons=[],this._activeBtn=null,this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,serializable:!1,setter:null}),this.defineProp("bondData",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}),this.defineProp("activeBondPropValues",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC,setter:function(i){this.setPropStoreFieldValue("activeBondPropValues",i),this.activeBondPropsChanged(i)}}),this.defineProp("activeBondHtmlClass",{dataType:DataType.STRING,scope:Class.PropertyScope.PRIVATE,setter:null,getter:function(){var i=this._activeBtn;if(i){var r=i[this.BTN_DATA_FIELD];return r&&r.htmlClass}return null}}),this.defineProp("bondPropNames",{dataType:DataType.ARRAY,serializable:!1})},doObjectChange:function(i){Kekule.ArrayUtils.intersect(i,["bondData"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_CONNECTOR_SELECT_PANEL},doCreateRootElement:function(i){return i.createElement("span")},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]);return this.updatePanelContent(i,r),a},activeBondPropsChanged:function(i){if(this._activeBtn&&(this._activeBtn.setChecked(!1),this._activeBtn=null),i)for(var r=this._selButtons,a=0,o=r.length;a<o;++a){var l=r[a][this.BTN_DATA_FIELD];if(l&&this._isBondPropsMatch(i,l.bondProps,this.getBondPropNames())){r[a].setChecked(!0),this._activeBtn=r[a];break}}},_isBondPropsMatch:function(i,r,a){return Kekule.Editor.StructureUtils.isBondPropsMatch(i,r,a)},reactSelButtonExec:function(i){var r=i.target;if(this._selButtons.indexOf(r)>=0){this._activeBtn=r;var a=r[this.BTN_DATA_FIELD];a&&(this.setPropStoreFieldValue("activeBondPropValues",a.bondProps),this.doValueChanged(a.bondProps))}},doValueChanged:function(i){this.setPropStoreFieldValue("value",i),this.invokeEvent("valueChange",{value:i})},updatePanelContent:function(i,r){if(this._selButtons)for(var a=this._selButtons.length-1;a>=0;--a){var o=this._selButtons[a];this.removeWidget(o)}var l=[];this._selButtons=[];var u=this.getBondData();if(u){a=0;for(var c=u.length;a<c;++a){var d=u[a],h=d.bondProps;(o=this._createBondSelButton(i,d)).appendToElem(r),this._selButtons.push(o),h&&e.pushUnique(l,Kekule.ObjUtils.getOwnedFieldNames(h))}}this.getBondPropNames()||this.setPropStoreFieldValue("bondPropNames",l)},_createBondSelButton:function(i,r){var a=new Kekule.Widget.RadioButton(this);return a.addClassName(n.STRUCTURE_CONNECTOR_SELECT_PANEL_SET_BUTTON),a.setGroup(this.BTN_GROUP).setShowGlyph(!0).setShowText(!1),a.setText(r.text||null).setHint(r.hint||r.description||null),r.htmlClass&&a.addClassName(r.htmlClass),a[this.BTN_DATA_FIELD]=r,a}}),Kekule.ChemWidget.StructureConnectorSelectPanelAdv=Class.create(Kekule.ChemWidget.StructureConnectorSelectPanel,{CLASS_NAME:"Kekule.ChemWidget.StructureConnectorSelectPanelAdv",initialize:function(i){this.setPropStoreFieldValue("extraComponents",[Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]),this._additionalCompWidgets=[],this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("extraComponents",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV},doObjectChange:function(i){this.tryApplySuper("doObjectChange",[i]),Kekule.ArrayUtils.intersect(i,["extraComponents"]).length&&this.updatePanelContent(this.getDocument(),this.getCoreElement())},updatePanelContent:function(i,r){this.clearAdditionalSections(),this.tryApplySuper("updatePanelContent",[i,r]);var a=this.getExtraComponents();a&&a.indexOf(Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE)>=0&&this._createKekulizeSection(i,r).appendToElem(r)},reactSelButtonExec:function(i){this.tryApplySuper("reactSelButtonExec",[i]);var r=i.target;r._command&&this.invokeEvent("command",{command:r._command})},clearAdditionalSections:function(){if(this._additionalCompWidgets){for(var i=0,r=this._additionalCompWidgets.length;i<r;++i)this._additionalCompWidgets[i].finalize();this._additionalCompWidgets=[]}},createAdditionalSection:function(i,r){var a=new Kekule.Widget.Container(i);return a.addClassName(n.STRUCTURE_CONNECTOR_SELECT_PANEL_ADV_EXTRA_SECTION),this._additionalCompWidgets.push(a),a.appendToElem(r),a.setParent(this),a},_createKekulizeSection:function(i,r){var a=this.createAdditionalSection(i,r),o=new Kekule.Widget.Button(a);o.addClassName([n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_KEKULIZE]).setText(Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_KEKULIZE")).setHint(Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_KEKULIZE")).setShowGlyph(!0).setShowText(!1),o._command=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands.KEKULIZE,a.appendWidget(o);var l=i.createElement("span");Kekule.DomUtils.setElementText(l," ◀ ▶ "),a.getElement().appendChild(l);var u=new Kekule.Widget.Button(a);return u.addClassName([n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON,n.STRUCTURE_CONNECTOR_SELECT_PANEL_EXTRA_SECTION_BUTTON_HUCKLIZE]).setText(Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_HUCKLIZE")).setHint(Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_HUCKLIZE")).setShowGlyph(!0).setShowText(!1),u._command=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands.HUCKLIZE,a.appendWidget(u),a}}),Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components={KEKULIZE:"kekulize"},Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands={KEKULIZE:"kekulize",HUCKLIZE:"hucklize"},Kekule.ChemWidget.ChargeSelectPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.ChargeSelectPanel",CHARGE_FIELD:"__$charge__",initialize:function(i){this._chargeBtnGroups={},this._selectedButton=null,this._chargeButtonMap=[],this.setPropStoreFieldValue("maxCharge",4),this.setPropStoreFieldValue("minCharge",-4),this.tryApplySuper("initialize",[i]),this.addEventListener("execute",this.reactSelButtonExec.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(i){var r=this.getValue();if(i!==r){var a=this._chargeButtonMap[r];a&&(a.setChecked(!1),a.blur()),this.setPropStoreFieldValue("value",i);var o=this._chargeButtonMap[i];o&&o.setChecked(!0),this._selectedButton=o}}}),this.defineProp("minCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(i){i!==this.getMinCharge()&&(this.setPropStoreFieldValue("minCharge",i),this.updateChargeButtons())}}),this.defineProp("maxCharge",{dataType:DataType.NUMBER,scope:Class.PropertyScope.PUBLIC,setter:function(i){i!==this.getMaxCharge()&&(this.setPropStoreFieldValue("maxCharge",i),this.updateChargeButtons())}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.CHARGE_SELECT_PANEL},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]);return this.updateChargeButtons(i,r),a},updateChargeButtons:function(i,r){for(var a=this._chargeBtnGroups,o=["zero","positive","negative"],l=0,u=o.length;l<u;++l)(c=a[o[l]])?c.clearWidgets():((c=new Kekule.Widget.ButtonGroup(this)).addClassName(n.CHARGE_SELECT_PANEL_BTNGROUP),c.appendToElem(r),a[o[l]]=c);var c,d=Math.floor(this.getMaxCharge()),h=Math.floor(this.getMinCharge()),p=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"),g=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE");if(d>=1&&(c=this._chargeBtnGroups.positive))for(l=Math.max(h,1);l<=d;++l)this._createChargeButton(c,l,l+p);if(d>=0&&h<=0&&(c=this._chargeBtnGroups.zero)&&this._createChargeButton(c,0,Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NONE"),Kekule.$L("ChemWidgetTexts.HINT_CHARGE_NONE")),h<=-1&&(c=this._chargeBtnGroups.negative))for(l=Math.min(d,-1);l>=h;--l)this._createChargeButton(c,l,Math.abs(l)+g)},_createChargeButton:function(i,r,a,o){var l=new Kekule.Widget.RadioButton(i,a);return l[this.CHARGE_FIELD]=r,this._chargeButtonMap[r]=l,o&&l.setHint(o),l.addClassName(n.CHARGE_SELECT_PANEL_CHARGE_BUTTON),l.appendToWidget(i),this.getValue()===r&&(l.setChecked(!0),this._selectedButton=l),l},reactSelButtonExec:function(i){var r=i.target[this.CHARGE_FIELD];Kekule.ObjUtils.notUnset(r)&&(this.setValue(r),this.notifyValueChange(r))},notifyValueChange:function(i){this.invokeEvent("valueChange",{value:i})}}),Kekule.ChemWidget.GlyphPathArrowSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathArrowSettingPanel",DATA_FIELD:"__$data$__",initialize:function(i){this._isSettingValue=!1,this._arrowWidthInputter=null,this._arrowLengthInputter=null,this._arrowStyleButtons=null,this.setPropStoreFieldValue("arrowWidthMin",0),this.setPropStoreFieldValue("arrowWidthMax",.5),this.setPropStoreFieldValue("arrowWidthStep",.1),this.setPropStoreFieldValue("arrowLengthMin",0),this.setPropStoreFieldValue("arrowLengthMax",.5),this.setPropStoreFieldValue("arrowLengthStep",.1),this.setPropStoreFieldValue("showContinousArrowSidesSetter",!1),this.setPropStoreFieldValue("defaultValue",{arrowType:Kekule.Glyph.ArrowType.NONE,arrowSide:Kekule.Glyph.ArrowSide.BOTH}),this.tryApplySuper("initialize",[i]),this.addEventListener("check",this.reactArrowStyleButtonCheck.bind(this)),this.addEventListener("valueChange",this.reactArrowSizeInputterChange.bind(this)),this.addEventListener("valueInput",this.reactArrowSizeInputterInput.bind(this))},initProperties:function(){this.defineProp("defaultValue",{dataType:DataType.HASH,scope:Class.PropertyScope.PRIVATE}),this.defineProp("value",{dataType:DataType.HASH,getter:function(){var i=this.getPropStoreFieldValue("value");return i||(i={},this.setPropStoreFieldValue("value",i)),i},setter:function(i){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",i);for(var r=Object.extend(Object.extend({},this.getDefaultValue()),i,!1,!0),a=0,o=this._arrowStyleButtons.length;a<o;++a){var l=this._arrowStyleButtons[a],u=l[this.DATA_FIELD];u.arrowType!==r.arrowType||u.arrowSide!==r.arrowSide&&u.arrowType!==Kekule.Glyph.ArrowType.NONE?l.setChecked(!1):l.setChecked(!0)}this._arrowWidthInputter.setValue(r.arrowWidth||0),this._arrowLengthInputter.setValue(r.arrowLength||0)}finally{this._isSettingValue=!1}}}),this.defineProp("allowedArrowTypes",{dataType:DataType.ARRAY}),this.defineProp("allowedArrowSides",{dataType:DataType.ARRAY}),this.defineProp("arrowWidthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowWidthStep",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMin",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthMax",{dataType:DataType.NUMBER}),this.defineProp("arrowLengthStep",{dataType:DataType.NUMBER})},doObjectChange:function(i){(i.indexOf("allowedArrowTypes")>=0||i.indexOf("allowedArrowSides")>=0)&&this._updateStyleButtons(),e.intersect(i,["arrowWidthMin","arrowWidthMax","arrowWidthStep"]).length&&this._updateWidthInputter(),e.intersect(i,["arrowLengthMin","arrowLengthMax","arrowLengthStep"]).length&&this._updateLengthInputter()},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_PATH_ARROW_SETTING_PANEL},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this.doCreateSectionElem(i,r),l=(this.doCreateArrowStyleButtons(i,o),this.doCreateSectionElem(i,r));return this.doCreateArrowSizeControls(i,l),a.concat(o).concat(l)},doCreateSectionElem:function(i,r){var a=i.createElement("div");return r.appendChild(a),a},doCreateArrowStyleButtons:function(i,r){var a=Kekule.Glyph.ArrowType,o=Kekule.Glyph.ArrowSide,l={};l[a.NONE]="None",l[a.OPEN]="Open",l[a.TRIANGLE]="Triangle";var u={};u[o.BOTH]="Both",u[o.SINGLE]="Single",u[o.REVERSED]="Reversed";var c=[a.NONE,a.OPEN,a.TRIANGLE],d=[o.BOTH,o.SINGLE,o.REVERSED],h=new Kekule.Widget.ButtonGroup(this);h.addClassName(n.GLYPH_PATH_ARROW_STYLE_BTNGROUP),this._arrowStyleButtons=[];var p=c.indexOf(a.NONE);if(p>=0){c.splice(p,1);var g=T=b=l[a.NONE],f=n.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+b;(E=new Kekule.Widget.RadioButton(h,T)).setHint(g).addClassName(f),E[this.DATA_FIELD]={arrowType:a.NONE,arrowSide:(this.getDefaultValue()||{}).arrowSide},this._arrowStyleButtons.push(E)}for(var m=0,C=c.length;m<C;++m)for(var _=0,y=d.length;_<y;++_){var T,E,b=l[c[m]],v=u[d[_]];g=T=b+" / "+v,f=n.GLYPH_PATH_ARROW_STYLE_BUTTON+"-"+b+"-"+v,(E=new Kekule.Widget.RadioButton(h,T)).setHint(g).addClassName(f),E[this.DATA_FIELD]={arrowType:c[m],arrowSide:d[_]},this._arrowStyleButtons.push(E)}return h.setShowGlyph(!0).setShowText(!1),this._updateStyleButtons(this._arrowStyleButtons),h.appendToElem(r),[h]},doCreateArrowSizeControls:function(i,r){var a=this._createArrowSizeSlider(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_WIDTH")+":"),o=this._createArrowSizeSlider(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_LENGTH")+":");return this._arrowWidthInputter=a,this._arrowLengthInputter=o,this._updateWidthInputter(a),this._updateLengthInputter(o),[a,o]},_createArrowSizeSlider:function(i,r,a){var o=i.createElement("div");o.className=n.GLYPH_Path_ARROW_SIZE_SETTER;var l=i.createElement("label");Kekule.DomUtils.setElementText(l,a);var u=new Kekule.Widget.NumInput(this);return u.appendToElem(l),o.appendChild(l),r.appendChild(o),u},_updateStyleButtons:function(i){var r=this.getAllowedArrowTypes(),a=this.getAllowedArrowSides();if(i||(i=this._arrowStyleButtons),i)for(var o=0,l=i.length;o<l;++o){var u=i[o][this.DATA_FIELD],c=r&&r.indexOf(u.arrowType)<0||a&&a.indexOf(u.arrowSide)<0;i[o].setDisplayed(!c)}},_updateSizeInputter:function(i,r,a,o,l){var u=s.notUnset;u(a)&&i.setMinValue(a),u(o)&&i.setMaxValue(o),u(l)&&i.setStep(l),u(r)&&i.setValue(r)},_updateWidthInputter:function(i){i||(i=this._arrowWidthInputter),this._updateSizeInputter(i,this.getValue().arrowWidth,this.getArrowWidthMin(),this.getArrowWidthMax(),this.getArrowWidthStep())},_updateLengthInputter:function(i){i||(i=this._arrowLengthInputter),this._updateSizeInputter(i,this.getValue().arrowLength,this.getArrowLengthMin(),this.getArrowLengthMax(),this.getArrowLengthStep())},getDefaultAllowedArrowTypes:function(){var i=Kekule.Glyph.ArrowType;return[i.NONE,i.OPEN,i.TRIANGLE]},notifyValueChange:function(i){this.notifyPropSet("value",i),this.invokeEvent("valueChange",{value:i})},notifyValueInput:function(i){this.notifyPropSet("value",i),this.invokeEvent("valueInput",{value:i})},reactArrowStyleButtonCheck:function(i){if(!this._isSettingValue){var r=i.widget;if(r&&r[this.DATA_FIELD]){var a=this.getValue();a.arrowType=r[this.DATA_FIELD].arrowType,a.arrowSide=r[this.DATA_FIELD].arrowSide,this.notifyValueChange(a),i.stopPropagation()}}},reactArrowSizeInputterChange:function(i){if(!this._isSettingValue){var r=i.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var a=r.getValue()&&r.getValue();if(s.notUnset(a)){var o=this.getValue();r===this._arrowWidthInputter?o.arrowWidth=a:r===this._arrowLengthInputter&&(o.arrowLength=a),this.notifyValueChange(o),i.stopPropagation()}}}},reactArrowSizeInputterInput:function(i){if(!this._isSettingValue){var r=i.widget;if(r===this._arrowWidthInputter||r===this._arrowLengthInputter){var a=r.getValue()&&r.getValue();if(s.notUnset(a)){var o=this.getValue();r===this._arrowWidthInputter?o.arrowWidth=a:r===this._arrowLengthInputter&&(o.arrowLength=a),this.notifyValueInput(o),i.stopPropagation()}}}}}),Kekule.ChemWidget.GlyphReactionArrowPresetSelector=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(i){this._isSettingValue=!1,this._buttonSet=null,this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(i){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",i);for(var r=this._buttonSet.getButtonSet().getChildWidgets(),a=0,o=r.length;a<o;++a){var l=r[a];l[this.DATA_FIELD].reactionArrowType===i?l.setChecked(!0):l.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_REACTION_ARROW_PRESET_SELECTOR},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this.doCreateButtonSet(i,r);return a.concat([o.getElement()])},doCreateButtonSet:function(i,r){var a=new Kekule.Widget.CompactButtonSet(this);a.addClassName(n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET),a.getButtonSet().addClassName(n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BTNSET_DROPDOWN);for(var o=this.getAllowedReactionArrowTypes()||this.getDefaultAllowedReactionTypes(),l=0,u=o.length;l<u;++l){var c=new Kekule.Widget.RadioButton(a),d=this._getPresetButtonDetails(o[l]);c.addClassName(d.className,!0).setText(d.caption).setHint(d.hint).setShowText(!0).setShowGlyph(!0),c[this.DATA_FIELD]={reactionArrowType:o[l]},a.append(c)}var h=this;return a.addEventListener("select",function(p){if(!h._isSettingValue&&p.target===a){var g=p.selected;if(g&&g[h.DATA_FIELD]){var f=g[h.DATA_FIELD].reactionArrowType;h.setPropStoreFieldValue("value",f),h.notifyValueChange(f)}}}),a.appendToElem(r),this._buttonSet=a,a},_getPresetButtonDetails:function(i){Kekule.Glyph.ReactionArrowType;var r=i?i.toUpperCase():"UNSET",a=i?i.upperFirst():"Unset",o="REACTION_ARROW_"+r;return{caption:Kekule.$L("ChemWidgetTexts.CAPTION_"+o),hint:Kekule.$L("ChemWidgetTexts.HINT_"+o),className:n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+" "+n.GLYPH_REACTION_ARROW_PRESET_SELECTOR_BUTTON+"-"+a}},notifyValueChange:function(i){this.notifyPropSet("value",i),this.invokeEvent("valueChange",{value:i})},getDefaultAllowedReactionTypes:function(){var i=Kekule.Glyph.ReactionArrowType;return[null,i.NORMAL,i.REVERSIBLE,i.RESONANCE,i.RETROSYNTHESIS,i.CUSTOM]}}),Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector",DATA_FIELD:"__$data$__",initialize:function(i){this._isSettingValue=!1,this._buttonGroup=null,this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("value",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("value")||""},setter:function(i){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",i);for(var r=this._buttonGroup.getChildWidgets(),a=0,o=r.length;a<o;++a){var l=r[a];l[this.DATA_FIELD].electronCount===i?l.setChecked(!0):l.setChecked(!1)}}finally{this._isSettingValue=!1}}}),this.defineProp("allowedReactionArrowTypes",{dataType:DataType.ARRAY})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this.doCreateButtonGroup(i,r);return a.concat([o.getElement()])},doCreateButtonGroup:function(i,r){var a=new Kekule.Widget.ButtonGroup(this);a.addClassName(n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BTNGROUP);for(var o=[2,1],l=0,u=o.length;l<u;++l){var c=o[l],d=new Kekule.Widget.RadioButton(a),h=this._getPresetButtonDetails(c);d.addClassName(h.className,!0).setText(h.caption).setHint(h.hint).setShowText(!0).setShowGlyph(!0),d[this.DATA_FIELD]={electronCount:c},a.appendWidget(d)}var p=this;return a.addEventListener("check",function(g){if(!p._isSettingValue){var f=g.widget;if(f&&f[p.DATA_FIELD]){var m=f[p.DATA_FIELD].electronCount;p.setPropStoreFieldValue("value",m),p.notifyValueChange(m)}}}),a.appendToElem(r),this._buttonGroup=a,a},_getPresetButtonDetails:function(i){var r=i.toString(),a="ELECTRON_PUSHING_ARROW_"+i;return{caption:Kekule.$L("ChemWidgetTexts.CAPTION_"+a+"_ABBR"),hint:Kekule.$L("ChemWidgetTexts.HINT_"+a),className:n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+" "+n.GLYPH_ELECTRON_PUSHING_ARROW_PRESET_SELECTOR_BUTTON+"-"+r}},notifyValueChange:function(i){this.notifyPropSet("value",i),this.invokeEvent("valueChange",{value:i})}}),Kekule.ChemWidget.GlyphPathLineSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathLineSettingPanel",initialize:function(i){this._isSettingValue=!1,this.setPropStoreFieldValue("lineCountMin",1),this.setPropStoreFieldValue("lineCountMax",5),this.setPropStoreFieldValue("lineCountStep",1),this.setPropStoreFieldValue("lineGapMin",0),this.setPropStoreFieldValue("lineGapMax",.8),this.setPropStoreFieldValue("lineGapStep",.1),this.tryApplySuper("initialize",[i]),this.addEventListener("valueChange",this.reactInputWidgetChange.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var i=this.getPropStoreFieldValue("value");return i||(i={},this.setPropStoreFieldValue("value",i)),i},setter:function(i){this._isSettingValue=!0;try{this.setPropStoreFieldValue("value",i),this._lineCountInput.setValue(i.lineCount),this._lineGapInput.setValue(i.lineGap)}finally{this._isSettingValue=!1}}}),this.defineProp("lineCountMin",{dataType:DataType.NUMBER}),this.defineProp("lineCountMax",{dataType:DataType.NUMBER}),this.defineProp("lineCountStep",{dataType:DataType.NUMBER}),this.defineProp("lineGapMin",{dataType:DataType.NUMBER}),this.defineProp("lineGapMax",{dataType:DataType.NUMBER}),this.defineProp("lineGapStep",{dataType:DataType.NUMBER})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_PATH_LINE_SETTING_PANEL},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this.doCreateNumInputSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_LINE_COUNT")+":");this._lineCountInput=o.widget,this._updateLineCountInput();var l=this.doCreateNumInputSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_LINE_GAP")+":");return this._lineGapInput=l.widget,this._updateLineGapInput(),a.concat([o.elem,l.elem])},doCreateNumInputSection:function(i,r,a){var o=i.createElement("span"),l=i.createElement("label");Kekule.DomUtils.setElementText(l,a);var u=new Kekule.Widget.NumInput(this,null,null,null,"number");return u.appendToElem(l),o.appendChild(l),r.appendChild(o),{elem:o,widget:u}},_updateInputWidget:function(i,r,a,o,l){var u=s.notUnset;i&&(i.setValue(r),u(a)&&i.setMinValue(a),u(o)&&i.setMaxValue(o),u(l)&&i.setStep(l))},_updateLineCountInput:function(){this._updateInputWidget(this._lineCountInput,this.getValue().lineCount,this.getLineCountMin(),this.getLineCountMax(),this.getLineCountStep())},_updateLineGapInput:function(){this._updateInputWidget(this._lineGapInput,this.getValue().lineGap,this.getLineGapMin(),this.getLineGapMax(),this.getLineGapStep())},notifyValueChange:function(i){this.notifyPropSet("value",i),this.invokeEvent("valueChange",{value:i})},reactInputWidgetChange:function(i){if(!this._isSettingValue){var r=i.widget;if(r===this._lineCountInput||r===this._lineGapInput){var a=r.getValue()&&r.getValue();if(s.notUnset(a)){var o=this.getValue();r===this._lineCountInput?o.lineCount=a:r===this._lineGapInput&&(o.lineGap=a),this.notifyValueChange(o),i.stopPropagation()}}}}}),Kekule.ChemWidget.GlyphPathSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow","line"],initialize:function(i){this.tryApplySuper("initialize",[i]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var i={};return this._startingArrowSetter&&(i=Object.extend(i,this._addPropPrefix(this._startingArrowSetter.getValue(),"start"))),this._endingArrowSetter&&(i=Object.extend(i,this._addPropPrefix(this._endingArrowSetter.getValue(),"end"))),this._lineSetter&&(i=Object.extend(i,this._lineSetter.getValue())),i},setter:function(i){if(i){var r=this._splitChildSetterValues(i);this._startingArrowSetter&&this._startingArrowSetter.setValue(r.startingArrow),this._endingArrowSetter&&this._endingArrowSetter.setValue(r.endingArrow),this._lineSetter&&this._lineSetter.setValue(r.line)}}}),this.defineProp("components",{dataType:DataType.ARRAY})},doObjectChange:function(i){return i.indexOf("components")>=0&&this.updateComponents(),this.tryApplySuper("doObjectChange",[i])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_PATH_SETTING_PANEL},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this.doCreateArrowSettingSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_STARTING_ARROW"));this._startingArrowSetter=o.widget,this._startingArrowElem=o.elem;var l=this.doCreateArrowSettingSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_ENDING_ARROW"));this._endingArrowSetter=l.widget,this._endingArrowElem=l.elem;var u=this.doCreateLineSettingSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_LINE"));return this._lineSetter=u.widget,this._lineElem=u.elem,a=a.concat([o.elem,l.elem,u.elem]),this.updateComponents(),a},doCreateSectionElem:function(i,r,a,o){var l=i.createElement("div"),u=i.createElement("label");Kekule.DomUtils.setElementText(u,a),u.className=n.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,l.appendChild(u);var c=n.GLYPH_PATH_SETTING_PANEL_SECTION;return o&&(c+=" "+o),l.className=c,r.appendChild(l),l},doCreateArrowSettingSection:function(i,r,a){var o=this.doCreateSectionElem(i,r,a),l=new Kekule.ChemWidget.GlyphPathArrowSettingPanel(this);return l.addClassName(n.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),l.appendToElem(o),{elem:o,widget:l}},doCreateLineSettingSection:function(i,r,a){var o=this.doCreateSectionElem(i,r,a),l=new Kekule.ChemWidget.GlyphPathLineSettingPanel(this);return l.addClassName(n.GLYPH_PATH_SETTING_PANEL_SECTION_PANEL),l.appendToElem(o),{elem:o,widget:l}},updateComponents:function(){var i=this.getComponents()||this.DEF_COMPONENTS,r=Kekule.StyleUtils;r.setDisplay(this._startingArrowElem,i.indexOf("startingArrow")>=0),r.setDisplay(this._endingArrowElem,i.indexOf("endingArrow")>=0),r.setDisplay(this._lineElem,i.indexOf("line")>=0)},reactChildSetterValueChange:function(i){var r=i.widget;if(r&&this.getChildValueSetterWidgets().indexOf(r)>=0){var a=this.getValue();i.stopPropagation(),this.notifyPropSet("value",a),this.invokeEvent("valueChange",{value:a})}},reactChildSetterValueInput:function(i){var r=i.widget;if(r&&this.getChildValueSetterWidgets().indexOf(r)>=0){var a=this.getValue();i.stopPropagation(),this.notifyPropSet("value",a),this.invokeEvent("valueInput",{value:a})}},getChildValueSetterWidgets:function(i){return[this._startingArrowSetter,this._endingArrowSetter,this._lineSetter]},getStartingArrowSetter:function(){return this._startingArrowSetter},getEndingArrowSetter:function(){return this._endingArrowSetter},_addPropPrefix:function(i,r){for(var a={},o=s.getOwnedFieldNames(i,!1),l=0,u=o.length;l<u;++l){var c=i[o[l]];a[r+o[l].capitalizeFirst()]=c}return a},_splitChildSetterValues:function(i){for(var r={startingArrow:{},endingArrow:{},line:{}},a=s.getOwnedFieldNames(i),o=0,l=a.length;o<l;++o){var u,c=a[o],d=i[c];c.startsWith("startArrow")?(u="arrow"+c.substr(10),r.startingArrow[u]=d):c.startsWith("endArrow")?(u="arrow"+c.substr(8),r.endingArrow[u]=d):r.line[c]=d}return r}}),Kekule.ChemWidget.GlyphMultiPathSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiPathSettingPanel",DEF_PATH_COUNT:2,DEF_COMPONENTS:["endingArrow"],initialize:function(i){this.setPropStoreFieldValue("value",[]),this.tryApplySuper("initialize",[i]),this.getPathCount()||this.setPathCount(this.DEF_PATH_COUNT),this.setActivePathIndex(0);var r=this.reactChildSetterValueChange.bind(this),a=this.reactChildSetterValueInput.bind(this);this.addEventListener("valueChange",r),this.addEventListener("valueInput",a),this.addEventListener("switch",this.reactPathTabSwitch.bind(this))},initProperties:function(){this.defineProp("pathCount",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getTabButtons().length},setter:function(i){this._updatePathTabGroup(i)}}),this.defineProp("pathSettingPanel",{dataType:"Kekule.ChemWidget.GlyphPathSettingPanel",serializable:!1,setter:null}),this.defineProp("pathTabGroup",{dataType:"Kekule.Widget.TabButtonGroup",serializable:!1,setter:null}),this.defineProp("activePathIndex",{dataType:DataType.INT,getter:function(){return this.getPathTabGroup().getActiveTabIndex()},setter:function(i){this.getPathTabGroup().setActiveTabIndex(i),this._switchToNewPathTab(i)}}),this.defineProp("value",{dataType:DataType.HASH,setter:function(i){if(i){var r=e.toArray(i);this.setPropStoreFieldValue("value",r),r.length>this.getActivePathIndex()&&this.getPathSettingPanel().setValue(r[this.getActivePathIndex()])}else this.setPropStoreFieldValue("value",[])}}),this.defineProp("components",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var i=this.getPathSettingPanel();return i&&i.getComponents()},setter:function(i){this.getPathSettingPanel().setComponents(i)}})},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_MULTIPATH_SETTING_PANEL},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=new Kekule.Widget.TabButtonGroup(this);o.setTabButtonPosition(Kekule.Widget.Position.TOP).addClassName(n.GLYPH_MULTIPATH_SETTING_PANEL_PATH_TABGROUP),this.setPropStoreFieldValue("pathTabGroup",o);var l=new Kekule.ChemWidget.GlyphPathSettingPanel(this);return l.addClassName(n.GLYPH_MULTIPATH_SETTING_PANEL_PATH_SETTING_PANEL),l.setComponents(this.DEF_COMPONENTS),this.setPropStoreFieldValue("pathSettingPanel",l),a},getStartingArrowSetter:function(){return this.getPathSettingPanel().getStartingArrowSetter()},getEndingArrowSetter:function(){return this.getPathSettingPanel().getEndingArrowSetter()},_updatePathTabGroup:function(i){this.getActivePathIndex();var r=this.getPathCount();if(r!==i){var a=this.getPathTabGroup(),o=a.getTabButtons();if(r>i)for(var l=r-1;l>=i;--l){var u=o[l];a.removeWidget(u)}else for(l=r;l<i;++l){u=new Kekule.Widget.RadioButton(a);var c=Kekule.$L("ChemWidgetTexts.CAPTION_PATH_INDEX").format(""+(l+1)),d=Kekule.$L("ChemWidgetTexts.HINT_PATH_INDEX").format(""+(l+1));u.setText(c).setHint(d)}}},_switchToNewPathTab:function(i){if(i>=0){var r=(this.getValue()||[])[i];this.getPathSettingPanel().setValue(r||{})}},reactChildSetterValueChange:function(i){var r=this.getActivePathIndex();if(r>=0){var a=i.widget;if(a===this.getPathSettingPanel()){var o=a.getValue();i.stopPropagation();var l=this.getValue()||[];l[r]=o,this.setPropStoreFieldValue("value",l),this.notifyPropSet("value",l),this.invokeEvent("valueChange",{value:l})}}},reactChildSetterValueInput:function(i){var r=this.getActivePathIndex();if(r>=0){var a=i.widget;if(a===this.getPathSettingPanel()){var o=a.getValue();i.stopPropagation();var l=this.getValue()||[];l[r]=o,this.setPropStoreFieldValue("value",l),this.notifyPropSet("value",l),this.invokeEvent("valueInput",{value:l})}}},reactPathTabSwitch:function(i){if(i.widget===this.getPathTabGroup()){var r=i.button,a=this.getPathTabGroup().getTabButtons().indexOf(r);this._switchToNewPathTab(a)}}}),Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel",doGetValue:function(){var i=this.tryApplySuper("doGetValue")||{};return this._reactionArrowPresetSelector&&(i.reactionArrowType=this._reactionArrowPresetSelector.getValue()),i},doSetValue:function(i){this.tryApplySuper("doSetValue",[i]),this._reactionArrowPresetSelector&&(this._reactionArrowPresetSelector.setValue(i.reactionArrowType),this._updateArrowSettingPanelEnableState())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL},doCreateSubElements:function(i,r){var a=this.doCreateReactionArrowPresetSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_TYPE"));this._reactionArrowPresetSelector=a.widget,this._reactionArrowPresetElem=a.elem;var o=this.tryApplySuper("doCreateSubElements",[i,r]);return this.updateComponents(),o},doCreateReactionArrowPresetSection:function(i,r,a){var o=this.doCreateSectionElem(i,r,a,n.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION),l=new Kekule.ChemWidget.GlyphReactionArrowPresetSelector(this);return l.appendToElem(o),{elem:o,widget:l}},updateComponents:function(){this.tryApplySuper("updateComponents"),this._updateArrowSettingPanelEnableState()},_updateArrowSettingPanelEnableState:function(){var i=Kekule.Glyph.ReactionArrowType,r=this._reactionArrowPresetSelector.getValue(),a=null,o=null,l=i.getDefPathParamOfArrowType(r);if(l){l.startArrowType,l.endArrowType;var u=l.hasOwnProperty("startArrowType")&&l.startArrowType,c=l.hasOwnProperty("endArrowType")&&l.endArrowType;u&&(a=this._startingArrowSetter.getDefaultAllowedArrowTypes(),a=e.exclude(a,[Kekule.Glyph.ArrowType.NONE])),c&&(o=this._endingArrowSetter.getDefaultAllowedArrowTypes(),o=e.exclude(o,[Kekule.Glyph.ArrowType.NONE])),this._startingArrowSetter.setEnabled(u),this._endingArrowSetter.setEnabled(c)}else this._startingArrowSetter.setEnabled(!0),this._endingArrowSetter.setEnabled(!0);this._startingArrowSetter.setAllowedArrowTypes(a),this._endingArrowSetter.setAllowedArrowTypes(o)},_updatePathParamsByReactionArrowPreset:function(i){var r=Kekule.Glyph.ArrowType,a=Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType(i);if(a||i||(a={startArrowType:r.NONE,endArrowType:r.NONE}),a){var o={},l={},u={};a.startArrowType!==void 0&&(o.arrowType=a.startArrowType),a.startArrowSide!==void 0&&(o.arrowSide=a.startArrowSide),a.endArrowType!==void 0&&(l.arrowType=a.endArrowType),a.endArrowSide!==void 0&&(l.arrowSide=a.endArrowSide),a.lineCount&&(u.lineCount=a.lineCount),a.lineGap&&(u.lineGap=a.lineGap),s.getOwnedFieldNames(o).length&&this._startingArrowSetter.setValue(Object.extend(this._startingArrowSetter.getValue(),o)),s.getOwnedFieldNames(l).length&&this._endingArrowSetter.setValue(Object.extend(this._endingArrowSetter.getValue(),l)),s.getOwnedFieldNames(u).length&&this._lineSetter.setValue(Object.extend(this._lineSetter.getValue(),u))}},getChildValueSetterWidgets:function(){var i=this.tryApplySuper("getChildValueSetterWidgets");return i.push(this._reactionArrowPresetSelector),i},reactChildSetterValueChange:function(i){i.widget===this._reactionArrowPresetSelector&&(this._updateArrowSettingPanelEnableState(),this._updatePathParamsByReactionArrowPreset(i.value)),this.tryApplySuper("reactChildSetterValueChange",[i])}}),Kekule.ChemWidget.GlyphArcPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_ARC_PATH_SETTING_PANEL}}),Kekule.ChemWidget.GlyphMultiArcPathSettingPanel=Class.create(Kekule.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiArcPathSettingPanel",DEF_COMPONENTS:["startingArrow","endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_MULTIARC_PATH_SETTING_PANEL}}),Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(i){this._glyphPathSettingPanel=null,this._endingArrowSetter=null,this._arrowPresetSelector=null,this.tryApplySuper("initialize",[i]),this.addEventListener("valueChange",this.reactChildSetterValueChange.bind(this)),this.addEventListener("valueInput",this.reactChildSetterValueInput.bind(this))},initProperties:function(){this.defineProp("value",{dataType:DataType.HASH,getter:function(){var i=this._glyphPathSettingPanel.getValue()||{};return i.electronCount=this._arrowPresetSelector.getValue(),i},setter:function(i){this._glyphPathSettingPanel.setValue(i),this._arrowPresetSelector.setValue(i&&i.electronCount),this._updateArrowSettingPanel()}})},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r]),o=this.doCreateArrowPresetSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));this._arrowPresetSelector=o.widget,this._arrowPresetElem=o.elem,Kekule.HtmlElementUtils.addClass(this._arrowPresetElem,n.GLYPH_REACTION_ARROW_PATH_SETTING_PANEL_ARROW_PRESET_SECTION);var l=this.doCreateGlyphPathSettingSection(i,r);if(this._glyphPathSettingPanel=l.widget,this._glyphPathSettingPanel&&(this._glyphPathSettingPanel.removeClassName(t.PANEL),this._glyphPathSettingPanel.setComponents&&this._glyphPathSettingPanel.setComponents(this.DEF_COMPONENTS),this._glyphPathSettingPanel.getEndingArrowSetter)){this._endingArrowSetter=this._glyphPathSettingPanel.getEndingArrowSetter();var u=Kekule.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([u.OPEN,u.TRIANGLE])}return a.concat([o.elem,l.elem])},doCreateSectionElem:function(i,r,a,o){var l=i.createElement("div");if(a){var u=i.createElement("label");Kekule.DomUtils.setElementText(u,a),u.className=n.GLYPH_PATH_SETTING_PANEL_SECTION_TITLE,l.appendChild(u)}var c=n.GLYPH_PATH_SETTING_PANEL_SECTION;return o&&(c+=" "+o),l.className=c,r.appendChild(l),l},doCreateArrowPresetSection:function(i,r,a){var o=this.doCreateSectionElem(i,r,a),l=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return l.appendToElem(o),{elem:o,widget:l}},doCreateGlyphPathSettingSection:function(i,r,a){var o=this.doCreateGlyphPathSettingWidget();if(o){var l=this.doCreateSectionElem(i,r,a);return o.appendToElem(l),{elem:l,widget:o}}return null},doCreateGlyphPathSettingWidget:function(){return null},reactChildSetterValueChange:function(i){var r=i.widget;r===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(r)>=0&&(i.stopPropagation(),this.invokeEvent("valueChange",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueChange",[i])},reactChildSetterValueInput:function(i){var r=i.widget;r===this._arrowPresetSelector&&this._updateArrowSettingPanel(),[this._arrowPresetSelector,this._glyphPathSettingPanel].indexOf(r)>=0&&(i.stopPropagation(),this.invokeEvent("valueInput",{value:this.getValue()})),this.tryApplySuper("reactChildSetterValueInput",[i])},_updateArrowSettingPanel:function(){var i=Kekule.Glyph.ArrowSide,r=this._endingArrowSetter,a=this._arrowPresetSelector.getValue(),o=[];o=a>=2?[i.BOTH]:a===1?[i.SINGLE,i.REVERSED]:[i.BOTH,i.SINGLE,i.REVERSED],r.setAllowedArrowSides(o)}}),Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel=Class.create(Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new Kekule.ChemWidget.GlyphArcPathSettingPanel(this)}}),Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel=Class.create(Kekule.ChemWidget.BaseGlyphElectronArrowSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",doCreateGlyphPathSettingWidget:function(){return new Kekule.ChemWidget.GlyphMultiArcPathSettingPanel(this)}}),Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel_OLD=Class.create(Kekule.ChemWidget.GlyphPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],initialize:function(i){this.tryApplySuper("initialize",[i]);var r=Kekule.Glyph.ArrowType;this._endingArrowSetter.setAllowedArrowTypes([r.OPEN,r.TRIANGLE])},doGetValue:function(){var i=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(i.electronCount=this._arrowPresetSelector.getValue()),i},doSetValue:function(i){this.tryApplySuper("doSetValue",[i]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(i.electronCount),this._updateArrowSettingPanel())},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_ELECTRON_PUSHING_ARROW_SETTING_PANEL},doCreateSubElements:function(i,r){var a=this.doCreateArrowPresetSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=a.widget,this._arrowPresetElem=a.elem,this.tryApplySuper("doCreateSubElements",[i,r])},doCreateArrowPresetSection:function(i,r,a){var o=this.doCreateSectionElem(i,r,a),l=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return l.appendToElem(o),{elem:o,widget:l}},getChildValueSetterWidgets:function(){var i=this.tryApplySuper("getChildValueSetterWidgets");return i.push(this._arrowPresetSelector),i.push(this._reversedArrowSideCheckBox),i},reactChildSetterValueChange:function(i){i.widget===this._arrowPresetSelector&&this._updateArrowSettingPanel(),this.tryApplySuper("reactChildSetterValueChange",[i])},_updateArrowSettingPanel:function(){var i=Kekule.Glyph.ArrowSide,r=this.getEndingArrowSetter(),a=this._arrowPresetSelector.getValue(),o=[];o=a>=2?[i.BOTH]:a===1?[i.SINGLE,i.REVERSED]:[i.BOTH,i.SINGLE,i.REVERSED],r.setAllowedArrowSides(o)}}),Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel_OLD=Class.create(Kekule.ChemWidget.GlyphMultiPathSettingPanel,{CLASS_NAME:"Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel",DEF_COMPONENTS:["endingArrow"],doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+n.GLYPH_MULTI_ELECTRON_PUSHING_ARROW_SETTING_PANEL},initialize:function(i){this.tryApplySuper("initialize",[i]);var r=Kekule.Glyph.ArrowType;this._endingArrowSetter=this.getPathSettingPanel().getEndingArrowSetter(),this._endingArrowSetter.setAllowedArrowTypes([r.OPEN,r.TRIANGLE])},doGetValue:function(){var i=this.tryApplySuper("doGetValue")||{};return this._arrowPresetSelector&&(i.electronCount=this._arrowPresetSelector.getValue()),i},doSetValue:function(i){this.tryApplySuper("doSetValue",[i]),this._arrowPresetSelector&&(this._arrowPresetSelector.setValue(i.electronCount),this._updateArrowSettingPanel())},doCreateSubElements:function(i,r){var a=this.doCreateArrowPresetSection(i,r,Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_TYPE"));return this._arrowPresetSelector=a.widget,this._arrowPresetElem=a.elem,this.tryApplySuper("doCreateSubElements",[i,r])},doCreateSectionElem:function(i,r,a,o){var l=i.createElement("div"),u=i.createElement("label");Kekule.DomUtils.setElementText(u,a),l.appendChild(u);var c=n.GLYPH_PATH_SETTING_PANEL_SECTION;return o&&(c+=" "+o),l.className=c,r.appendChild(l),l},doCreateArrowPresetSection:function(i,r,a){var o=this.doCreateSectionElem(i,r,a),l=new Kekule.ChemWidget.GlyphElectronPushingArrowPresetSelector(this);return l.appendToElem(o),{elem:o,widget:l}},_updateArrowSettingPanel:function(){var i=Kekule.Glyph.ArrowSide,r=this.getEndingArrowSetter(),a=this._arrowPresetSelector.getValue(),o=[];o=a>=2?[i.BOTH]:a===1?[i.SINGLE,i.REVERSED]:[i.BOTH,i.SINGLE,i.REVERSED],r.setAllowedArrowSides(o)}})}(),function(){var s=Kekule.ArrayUtils,e=Kekule.CoordUtils,t=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_ATOM_SETTER:"K-ChemEditor-Atom-Setter",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter",CHEMEDITOR_FORMULA_SETTER:"K-ChemEditor-Formula-Setter"}),Kekule.globalOptions.add("chemWidget.editor",{enableSelect:!0,enableFileDrop:!0,allowCreateNewChild:!0,autoCreateNewStructFragment:!0,allowAppendDataToCurr:!0,enableGesture:!0,initOnNewDoc:!0}),Kekule.globalOptions.add("chemWidget.editor.molManipulation",{enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0}),Kekule.globalOptions.add("chemWidget.editor.bondManipulation",{enableBondModification:!0,allowBondingToBond:!1,autoSwitchBondOrder:!1}),Kekule.Editor.ChemSpaceEditor=Class.create(Kekule.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function(i,r,a,o){var l=Kekule.globalOptions.get;this.setPropStoreFieldValue("allowCreateNewChild",l("chemWidget.editor.allowCreateNewChild",!0)),this.setPropStoreFieldValue("autoCreateNewStructFragment",l("chemWidget.editor.autoCreateNewStructFragment",!0)),this.setPropStoreFieldValue("allowAppendDataToCurr",l("chemWidget.editor.autoCreateNewStructFragment",!0)),this.tryApplySuper("initialize",[i,r,a,o]),this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:!1,getter:function(){return this.getChemObj()},setter:function(i){this.setChemObj(i)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setFileDroppable(Kekule.globalOptions.get("chemWidget.editor.enableFileDrop",!0))},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0)},getActualDrawOptions:function(){var i=this.tryApplySuper("getActualDrawOptions");return i.useExplicitSpaceSize=!0,i},doSetChemObj:function(i){var r=this.getChemObj();if(r!==i)if(r&&this._containerChemSpace&&(r.finalize(),this._containerChemSpace=null),i){if(i instanceof Kekule.ChemSpace)this._initChemSpaceDefProps(i),this.tryApplySuper("doSetChemObj",[i]);else{var a=this.createContainerChemSpace(null,i);this._containerChemSpace=a,this.tryApplySuper("doSetChemObj",[a])}if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterLoading()&&this.autoExpandChemSpaceSize(),i instanceof Kekule.ChemSpace&&this.getEditorConfigs().getInteractionConfigs().getScrollToObjAfterLoading()){var o=i.getChildren();o&&o.length&&this.scrollClientToObject(o)}}else this.tryApplySuper("doSetChemObj",[i]);else this.tryApplySuper("doSetChemObj",[i])},getExportableClasses:function(){var i=this.tryApplySuper("getExportableClasses"),r=this.getChemSpace();return r&&r.iterateChildren(function(a){if(a.isStandalone&&a.isStandalone()&&a.getClass){var o=a.getClass();Kekule.ArrayUtils.pushUnique(i,o)}},!0),i},exportObjs:function(i){var r=this.tryApplySuper("exportObjs",[i]);return(!r||!r.length)&&i&&(r=[],r=this.getChemSpace().filterChildren(function(a){return a&&a instanceof i},!0)),r},getSavingTargetObj:function(){var i=this.getChemSpace();return i.getChildCount()===1?i.getChildAt(0):this.tryApplySuper("getSavingTargetObj")},_cloneSavingTargetObj:function(i){var r=this.getChemSpace();return r.getChildCount()===1&&i===r.getChildAt(0)?r.clone(!0).getChildAt(0):this.tryApplySuper("_cloneSavingTargetObj",[i])},createDefaultConfigs:function(){return Kekule.Editor.ChemSpaceEditorConfigs.getInstance()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoad:function(i){this._supplyChemMarkersOnObj(i),this.tryApplySuper("doLoad",[i])},doLoadEnd:function(i){var r=this.tryApplySuper("doLoadEnd",[i]),a=null;if(i){var o=i.getAllContainingConnectors();if(o&&o.length){var l=this.getRenderType()===Kekule.Render.RendererType.R3D?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;a=Kekule.ChemStructureUtils.getConnectorLengthMedian(o,l,this.getAllowCoordBorrow())}}return this.setDefBondLength(a),r},resetDisplay:function(){this.tryApplySuper("resetDisplay"),this.resetClientDisplay()},resetClientDisplay:function(i){if(!this.isUpdatingObject())return this._resetClientDisplayCore(i);var r=this;this._registerAfterUpdateObjectProc(function(){r._resetClientDisplayCore(i)})},_resetClientDisplayCore:function(i){var r=this.getChemObj();if(r){var a;i&&(a=this.getClientScrollPosition());var o=r.getScreenSize();this.changeClientSize(o.x,o.y,this.getCurrZoom());var l=this.getEditClientElem().parentNode,u=Kekule.HtmlElementUtils.getElemClientDimension(l);i?this.scrollClientTo(a.y,a.x):this.scrollClientTo(0,(o.x*this.getCurrZoom()-u.width)/2)}},zoomChanged:function(i){this.tryApplySuper("zoomChanged");var r=this.getChemObj();if(r){var a=r.getScreenSize();this.changeClientSize(a.x,a.y,i)}},createNewBoundInfoRecorder:function(i){this.tryApplySuper("createNewBoundInfoRecorder",[i]);var r=this.getBoundInfoRecorder();r&&r.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)},reactUpdateBasicDrawObject:function(i){var r=i.obj;if(r&&r instanceof Kekule.TextBlock){var a=i.boundInfo;this.updateTextBlockSize(r,a)}},objectChanged:function(i,r){return this.tryApplySuper("objectChanged",[i,r])},doManipulationEnd:function(){if(this.getEditorConfigs().getInteractionConfigs().getAutoExpandClientSizeAfterManipulation()){var i=this._calcChemSpaceAutoExpandInfo();if(i){var r=this._createChemSpaceAutoExpandOperations(i);if(r){this.getEnableOperHistory()&&this._appendOpersToLastManipulationOperation(r);for(var a=0,o=r.length;a<o;++a)r[a].execute()}}}return this.tryApplySuper("doManipulationEnd")},_appendOpersToLastManipulationOperation:function(i){var r=this.getOperationsInCurrManipulation();if(r&&r.length){var a=r[r.length-1],o=this.getOperHistory();if(o){var l=o.getOperations(),u=l.indexOf(a);if(u>=0){var c;a instanceof Kekule.MacroOperation?c=a:(c=new Kekule.MacroOperation([a]),l.splice(u,1,c),r.splice(r.length-1,1,c));for(var d=0,h=i.length;d<h;++d)c.add(i[d])}}}},updateTextBlockSize:function(i,r){this.getCoordMode()===Kekule.CoordMode.COORD2D&&i.getNeedRecalcSize()&&(r.shapeType,Kekule.Render.BoundShapeType.RECT)},createContainerChemSpace:function(i,r){var a=new Kekule.ChemDocument(i);if(this._initChemSpaceDefProps(a,r),r){a.appendChild(r);var o,l=a.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow()),u=Kekule.Render.ObjUtils.getContainerBox(r,this.getCoordMode(),this.getAllowCoordBorrow());if(this.getCoordMode()===Kekule.CoordMode.COORD2D)var c=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding(),d=a.getObjScreenLengthRatio();var h=r.getAbsBaseCoord&&r.getAbsBaseCoord(this.getCoordMode(),this.getAllowCoordBorrow())||{};if(d&&u){o=Kekule.CoordUtils.divide(l,2);var p={x:(u.x1+u.x2)/2,y:(u.y1+u.y2)/2},g={x:o.x,y:l.y-c*d-(u.y2-u.y1)/2},f=Kekule.CoordUtils.substract(g,p);o=Kekule.CoordUtils.add(h,f)}else o=Kekule.CoordUtils.divide(l,2);r.setAbsBaseCoord&&r.setAbsBaseCoord(o,this.getCoordMode())}return a},_initChemSpaceDefProps:function(i,r,a){var o=this.getEditorConfigs(),l=o.getChemSpaceConfigs();if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var u=i.getScreenSize();if(u.x||u.y||(u=l.getDefScreenSize2D(),i.setScreenSize(u)),!i.getDefAutoScaleRefLength()){var c,d;r&&r.getAllAutoScaleRefLengths?c=(d=r.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow()))&&d.length?Kekule.ArrayUtils.getMedian(d):null:c=(d=i.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow())).length?Kekule.ArrayUtils.getMedian(d):null,c||(c=o.getStructureConfigs().getDefBondLength()),i.setDefAutoScaleRefLength(c)}if(!i.getSize2D()||a){var h=this.getRenderConfigs().getLengthConfigs().getDefBondLength(),p=i.getDefAutoScaleRefLength()/h;i.setObjScreenLengthRatio(p),i.setSize2D({x:u.x*p,y:u.y*p})}}i.setIsEditing&&i.setIsEditing(!0)},_getChemSpaceObjScreenLengthRatio:function(){var i=this.getChemSpace(),r=i.getObjScreenLengthRatio();if(!r){var a=this.getRenderConfigs().getLengthConfigs().getDefBondLength();r=i.getDefAutoScaleRefLength()/a}return r},changeChemSpaceSize:function(i,r){var a=this.getChemSpace();a.beginUpdate();try{if(a.setSizeOfMode(i,r),r===Kekule.CoordMode.COORD2D){var o=this._getChemSpaceObjScreenLengthRatio();o&&a.setScreenSize({x:i.x/o,y:i.y/o})}}finally{a.endUpdate()}this.resetClientDisplay(!0)},changeChemSpaceScreenSize:function(i){var r=this.getChemSpace();r.beginUpdate();try{var a=this._getChemSpaceObjScreenLengthRatio();a&&r.setSize2D({x:i.x*a,y:i.y*a}),r.setScreenSize(i)}finally{r.endUpdate()}this.resetClientDisplay(!0)},_shiftChemSpaceChildCoord:function(i,r,a){var o=this.getChemSpace(),l=o.getChildren();if(l){var u;a&&(u=this.getClientScrollCoord(Kekule.Editor.CoordSys.CHEM)),this.beginUpdateObject();try{o.beginUpdate();try{for(var c=this.getAllowCoordBorrow(),d=0,h=l.length;d<h;++d){var p=l[d];if(p&&p.setCoordOfMode){var g=p.getCoordOfMode(r,c)||{};p.setCoordOfMode(e.add(g,i))}}a&&this.scrollClientToCoord(u,Kekule.Editor.CoordSys.CHEM)}finally{o.endUpdate()}}finally{this.endUpdateObject()}}},_calcExpandChemSpaceSizeToTargetObjsInfo:function(i,r){if(i&&i.length){var a=this._getTargetObjsExposedContainerBoxInfo(i).totalBox;if(a)return this._calcExpandChemSpaceSizeToContainerBoxInfo(a,r)}return null},_calcExpandChemSpaceSizeToContainerBoxInfo:function(i,r){var a=Kekule.CoordMode,o=this.getChemSpace(),l=r===a.COORD3D,u=["x","y"];l&&u.push("z");for(var c=this.getEditorConfigs().getChemSpaceConfigs(),d=this._getChemSpaceObjScreenLengthRatio(),h=c.getDefPadding()*d,p=l?o.getSize3D():o.getSize2D(),g=Kekule.BoxUtils.getMinMaxCoords(i),f=g.min,m={},C=!1,_=0,y=u.length;_<y;++_)(v=f[u[_]])<h?(m[u[_]]=h-v,C=!0):m[u[_]]=0;var T=g.max,E={},b=!1;for(_=0,y=u.length;_<y;++_){var v;(v=T[u[_]])>p[u[_]]-h?(E[u[_]]=v-(p[u[_]]-h),b=!0):E[u[_]]=0}var I={},R={};if(C||b){var N=l?c.getAutoExpandScreenSize2D():c.getAutoExpandScreenSize3D(),L=e.multiply(N,d);for(_=0,y=u.length;_<y;++_){var U=u[_];I[U]=m[U]+E[U];var W=Math.ceil(I[U]/L[U]);R[U]=W*L[U]}var M={newSize:e.add(p,R)};return C&&(M.coordShift=m),M}return null},_expandChemSpaceSizeAndShiftChildrenCoords:function(i,r,a){this.beginUpdateObject();try{r&&this._shiftChemSpaceChildCoord(r,a,!0),this.changeChemSpaceSize(i,a)}finally{this.endUpdateObject()}},_expandChemSpaceSizeToContainerBox:function(i,r){var a=this._calcExpandChemSpaceSizeToContainerBoxInfo(i,r);return a&&this._expandChemSpaceSizeAndShiftChildrenCoords(a.newSize,a.coordShift,r),a},expandChemSpaceSizeToTargetObjs:function(i,r){if(Kekule.ObjUtils.isUnset(r)&&(r=this.getCoordMode()),i&&i.length){var a=this._getTargetObjsExposedContainerBoxInfo(i).totalBox;a&&this._expandChemSpaceSizeToContainerBox(a,r)}return this},autoExpandChemSpaceSize:function(){if(this._isAutoExpandingChemSpace)return this;this._isAutoExpandingChemSpace=!0;try{var i=this.getChemSpace().getChildren();i&&this.expandChemSpaceSizeToTargetObjs(i,this.getCoordMode())}finally{this._isAutoExpandingChemSpace=!1}return this},_calcChemSpaceAutoExpandInfo:function(){var i=this.getChemSpace().getChildren();return i?this._calcExpandChemSpaceSizeToTargetObjsInfo(i,this.getCoordMode()):null},_createChemSpaceAutoExpandOperations:function(i){if(i){var r=[],a=this.getChemSpace(),o=this.getCoordMode();return r.push(new Kekule.ChemSpaceEditorOperation.ChangeSpaceSizeAndShiftChildrenCoords(a,i.newSize,i.coordShift,o,this)),r}return null},createNewStructFragmentAnchor:function(i){if(this.getAutoCreateNewStructFragment()){var r=new Kekule.Molecule(i);return this.getChemSpace().appendChild(r),r}return null},createStructStartingAtom:function(i,r,a,o){this.beginUpdateObject();try{if(i){o||(o=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId());var l=new Kekule.Atom(null,o);return i.appendNode(l),l.setAbsCoordOfMode(a,this.getCoordMode()),l}return null}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(i,r,a){this.beginUpdateObject();try{var o;return(o=this.createNewStructFragmentAnchor(i))?this.createStructStartingAtom(o,i,r,a):null}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var i=!1;if(this.getChemSpace().getChildCount()===1){var r=this.getChemSpace().getChildAt(0);r instanceof Kekule.StructureFragment&&r.getNodeCount()<=0&&r.getConnectorCount()<=0&&!r.hasFormula()&&(i=!0)}return i},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment())return this.getChemSpace().getChildAt(0)},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||this.getChemSpace().getChildCount()<=0},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(i,r,a,o){var l=this;if(!this.getChemSpace())return null;for(var u=this.getAllowCreateNewChild(),c=function(q,Q){for(var ie=0,Y=Q.length;ie<Y;++ie)if(Q[ie].isChildOf(q))return!0;return!1},d=function(q,Q,ie){if(ie.indexOf(Q)>=0)s.remove(ie,Q);else if(q.getChildAt&&Q.getChildAt)for(var Y=Q.getChildCount()-1;Y>=0;--Y){var ne=q.getChildAt(Y);if(ie.length){var de=Q.getChildAt(Y);ie.indexOf(de)>=0?s.remove(ie,de):c(de,ie)?de.getChildObjs&&d(ne,de,ie):q.removeChild(ne)}else q.removeChild(ne)}},h=function(q,Q){for(var ie=0,Y=Q.length;ie<Y;++ie){var ne=Q[ie];if(q===ne||q.isChildOf&&q.isChildOf(ne))return ne}return null},p=function(q,Q,ie){var Y,ne,de=q.relation,Ae=q.srcParent,Ce=q.destParents,pe=[],fe=ie[Q.indexOf(Ae)];if(de.srcObj===Ae?ne=fe:(Y=Ae.indexStackOfChild&&Ae.indexStackOfChild(de.srcObj))&&(ne=fe.getChildAtIndexStack&&fe.getChildAtIndexStack(Y)),!ne)return null;for(var Te=s.isArray(de.dest),xe=Te?de.dest:[de.dest],Re=0,we=Ce.length;Re<we;++Re){var Me,Le=Ce[Re],Ue=ie[Q.indexOf(Le)];Le&&(Le===xe[Re]?pe.push(Ue):xe[Re]&&(Y=Le.indexStackOfChild&&Le.indexStackOfChild(xe[Re]))&&(Me=Ue.getChildAtIndexStack&&Ue.getChildAtIndexStack(Y))&&pe.push(Me))}if(!pe.length)return null;var at=Te?pe:pe[0];return{srcObj:ne,srcProp:de.srcProp,dest:at}},g=Kekule.ArrayUtils.toArray(i),f=[],m=new Kekule.MapEx,C=0,_=g.length;C<_;++C){var y=(N=g[C]).getStandaloneAncestor?N.getStandaloneAncestor():N;if(y.clone){Kekule.ArrayUtils.pushUnique(f,y);var T=m.get(y);T||(T=[],m.set(y,T)),T.push(N)}}var E=function(q,Q){var ie=[];Q||(Q=l.getChemObj());var Y=Q.getObjRefRelations&&Q.getObjRefRelations();if(Y)for(var ne=0,de=Y.length;ne<de;++ne){var Ae=Y[ne],Ce=Ae.srcObj,pe=s.toArray(Ae.dest),fe=h(Ce,q),Te=[],xe=!1;if(fe){for(var Re=0,we=pe.length;Re<we;++Re){var Me=pe[Re],Le=h(Me,q);Le&&(xe=!0),Te.push(Le)}xe&&ie.push({relation:Ae,srcParent:fe,destParents:Te})}}return ie}(f,this.getChemSpace()),b=this.getChemSpace(),v=[],I=(this.getCoordMode(),this.getAllowCoordBorrow(),f.length);for(C=0;C<I;++C)(L=(N=f[C]).clone()).clearIds&&L.clearIds(),v.push(L);var R=[];for(C=0,_=E.length;C<_;++C)(B=p(E[C],f,v))&&R.push(B);for(C=0;C<I;++C){var N=f[C],L=v[C];if(d(L,N,m.get(N)),a&&u&&(b.appendChild(L),r)){var U=this.getObjectScreenCoord(L),W=Kekule.CoordUtils.add(U,r);this.setObjectScreenCoord(L,W)}}for(C=0,_=R.length;C<_;++C){var M,B=R[C];if(h(B.srcObj,v)){if(s.isArray(B.dest)){M=[];for(var V=0,J=B.dest.length;V<J;++V){var $=B.dest[V];h($,v)&&M.push($)}M.length||(M=null)}else h(B.dest,v)&&(M=B.dest);M&&B.srcObj.setPropValue(B.srcProp.name,M)}}return m.finalize(),v},cloneSelection:function(i,r,a){i===void 0&&(i=this.getDefaultCloneScreenCoordOffset());var o=this.getSelection();o=function(u,c){for(var d=[],h=0,p=u.length;h<p;++h){var g=u[h];if(g instanceof Kekule.ChemSpace&&!c){var f=g.getChildren();s.pushUnique(d,f)}else s.pushUnique(d,g)}return d}(o,a);var l=this.cloneObjects(o,i,r);return r&&this.setSelection(l),l},getDefaultCloneScreenCoordOffset:function(){var i=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0,r={x:i,y:i};return this.getCoordMode()===Kekule.CoordMode.COORD3D&&(r.z=i),r},_supplyChemMarkersOnObj:function(i){if(i){var r=Kekule.ChemStructureUtils.getAllStructFragments(i,!0);if(r||r.length)for(var a=0,o=r.length;a<o;++a)this._createLosingChemMarkerOnStructFragment(r[a])}},_createLosingChemMarkerOnStructFragment:function(i){i.beginUpdate();try{i.getCharge&&i.getCharge()&&i.fetchChargeMarker(!0),i.getNodes();for(var r=0,a=i.getNodeCount();r<a;++r){var o=i.getNodeAt(r);o.beginUpdate();try{o.getCharge()&&o.fetchChargeMarker(!0),o.getRadical()&&o.fetchRadicalMarker(!0),o.getNodeAt&&this._createLosingChemMarkerOnStructFragment(o)}finally{o.endUpdate()}}}finally{i.endUpdate()}},getEnabledNonAtomInputData:function(){var i=[],r=this.getRenderConfigs().getDisplayLabelConfigs(),a=this.getEditorConfigs().getStructureConfigs().getEnabledNonAtomNodeTypes();return a.RGroup&&i.push({text:r.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")}),a.pseudoatomDummy&&i.push({text:r.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),a.pseudoatomHetero&&i.push({text:r.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),a.pseudoatomAny&&i.push({text:r.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),a.variableAtomList&&i.push({text:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,isVarList:!0,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),a.variableAtomNotList&&i.push({text:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,isVarNotList:!0,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),i},_getVarAtomListLabel:function(){var i=this.getRenderConfigs().getDisplayLabelConfigs();return i?i.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},_getVarAtomNotListLabel:function(){var i=this.getRenderConfigs().getDisplayLabelConfigs();return"~"+(i?i.getVariableAtom():Kekule.ChemStructureNodeLabels.VARIABLE_ATOM)},getEnabledBondFormData:function(){for(var i=Kekule.BondType,r=Kekule.BondOrder,a=Kekule.BondStereo,o=Kekule.$L,l="K-Chem-MolBondIaController-",u={single:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),htmlClass:l+"Single",isDefault:!0,bondProps:{bondType:i.COVALENT,bondOrder:r.SINGLE,stereo:a.NONE}},double:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),htmlClass:l+"Double",bondProps:{bondType:i.COVALENT,bondOrder:r.DOUBLE,stereo:a.NONE}},triple:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),htmlClass:l+"Triple",bondProps:{bondType:i.COVALENT,bondOrder:r.TRIPLE,stereo:a.NONE}},quad:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_QUAD"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_QUAD"),htmlClass:l+"Quad",bondProps:{bondType:i.COVALENT,bondOrder:r.QUAD,stereo:a.NONE}},explicitAromatic:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_EXPLICIT_AROMATIC"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_EXPLICIT_AROMATIC"),htmlClass:l+"Aromatic",bondProps:{bondType:i.COVALENT,bondOrder:r.EXPLICIT_AROMATIC,stereo:a.NONE}},up:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),htmlClass:l+"WedgeUp",bondProps:{bondType:i.COVALENT,bondOrder:r.SINGLE,stereo:a.UP}},upInverted:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP_INVERTED"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP_INVERTED"),htmlClass:l+"WedgeUpInverted",bondProps:{bondType:i.COVALENT,bondOrder:r.SINGLE,stereo:a.UP_INVERTED}},down:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),htmlClass:l+"WedgeDown",bondProps:{bondType:i.COVALENT,bondOrder:r.SINGLE,stereo:a.DOWN}},downInverted:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN_INVERTED"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN_INVERTED"),htmlClass:l+"WedgeDownInverted",bondProps:{bondType:i.COVALENT,bondOrder:r.SINGLE,stereo:a.DOWN_INVERTED}},upOrDown:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),htmlClass:l+"WedgeUpOrDown",bondProps:{bondType:i.COVALENT,bondOrder:r.SINGLE,stereo:a.UP_OR_DOWN}},closer:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),htmlClass:l+"Closer",bondProps:{bondType:i.COVALENT,bondOrder:r.SINGLE,stereo:a.CLOSER}},eOrZ:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),htmlClass:l+"Double-Either",bondProps:{bondType:i.COVALENT,bondOrder:r.DOUBLE,stereo:a.E_OR_Z}},ionic:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_IONIC"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_IONIC"),htmlClass:l+"Ionic",bondProps:{bondType:i.IONIC,bondOrder:r.SINGLE,stereo:a.NONE}},coordinate:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_COORDINATE"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_COORDINATE"),htmlClass:l+"Coordinate",bondProps:{bondType:i.COORDINATE,bondOrder:r.SINGLE,stereo:a.NONE}},metallic:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_METALLIC"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_METALLIC"),htmlClass:l+"Metallic",bondProps:{bondType:i.METALLIC,bondOrder:r.SINGLE,stereo:a.NONE}},hydrogen:{text:o("ChemWidgetTexts.CAPTION_MOL_BOND_HYDROGEN"),hint:o("ChemWidgetTexts.HINT_MOL_BOND_HYDROGEN"),htmlClass:l+"Hydrogen",bondProps:{bondType:i.HYDROGEN,bondOrder:r.SINGLE,stereo:a.NONE}}},c=(o("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),o("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),this.getEditorConfigs().getStructureConfigs().getEnabledBondForms()),d=Kekule.ObjUtils.getOwnedFieldNames(c,!1),h=[],p=0,g=d.length;p<g;++p){var f=d[p];c[f]&&(DataType.isObjectValue(c[f])?h.push(c[f]):u[f]&&h.push(u[f]))}return h}}),Kekule.Editor.ChemSpaceEditor.Settings=Class.create(Kekule.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(i){this.getEditor().setAllowCreateNewChild(i)}}),this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAutoCreateNewStructFragment()},setter:function(i){this.getEditor().setAutoCreateNewStructFragment(i)}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this.getEditor().getAllowAppendDataToCurr()},setter:function(i){this.getEditor().setAllowAppendDataToCurr(i)}})}}),Kekule.Editor.BasicMolEraserIaController=Class.create(Kekule.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function(i){this.tryApplySuper("initialize",[i])},doGetActualRemovedObjs:function(i){for(var r=[],a=this.getEditor().getChemObj(),o=0,l=i.length;o<l;++o){var u,c=i[o];c instanceof Kekule.ChemSpace&&c===a?u=c.getChildren():(Kekule.ArrayUtils.pushUnique(r,c),u=c.getCascadeDeleteObjs?c.getCascadeDeleteObjs():[]),u&&Kekule.ArrayUtils.pushUnique(r,u)}return r},doRemoveObjs:function(i){if(i.length){for(var r=new Kekule.MacroOperation,a=[],o=0,l=i.length;o<l;++o){var u,c=i[o],d=(c.getParent(),this.getEditor());c instanceof Kekule.BaseStructureNode?(u=new Kekule.ChemStructOperation.RemoveNode(c,null,null,d),Kekule.ArrayUtils.pushUnique(a,c.getParent())):c instanceof Kekule.BaseStructureConnector?(u=new Kekule.ChemStructOperation.RemoveConnector(c,null,null,d),Kekule.ArrayUtils.pushUnique(a,c.getParent())):u=new Kekule.ChemObjOperation.Remove(c,null,null,d),u&&r.add(u)}for(o=0,l=a.length;o<l;++o){var h=a[o];if(h&&h instanceof Kekule.StructureFragment){var p=new Kekule.ChemStructOperation.StandardizeStructFragment(h,d);p.setEnableSplit(this.getEditor().canCreateNewChild()),r.add(p)}}d.execOperation(r)}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolEraserIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.BasicMolManipulationIaController=Class.create(Kekule.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this._suppressConstrainedMoving=!1,this._suppressConstrainedRotating=!1,this._isInDirectedMoving=!1,this._directedMovingDirection=null},initProperties:function(){this._defineEditorConfigBasedProperty("enableMagneticMerge","interactionConfigs.enableMagneticMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNodeMerge","interactionConfigs.enableNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableNeighborNodeMerge","interactionConfigs.enableNeighborNodeMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableConnectorMerge","interactionConfigs.enableConnectorMerge",{overwrite:!0}),this._defineEditorConfigBasedProperty("enableStructFragmentMerge","interactionConfigs.enableStructFragmentMerge",{overwrite:!0}),this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableNodeStick",{dataType:DataType.BOOL}),this.defineProp("enableSiblingStick",{dataType:DataType.BOOL}),this.defineProp("enableStructFragmentStick",{dataType:DataType.BOOL}),this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("stickOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergePreviewOperations",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("mergingDests",{dataType:DataType.ARRAY,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues");var i=Kekule.globalOptions.get("chemWidget.editor.molManipulation",{});i=Object.extend({enableMagneticMerge:!0,enableNodeMerge:!0,enableNeighborNodeMerge:!0,enableConnectorMerge:!0,enableStructFragmentMerge:!0,enableNodeStick:!0,enableStructFragmentStick:!0,enableConstrainedMove:!0,enableConstrainedRotate:!0,enableConstrainedResize:!0,enableDirectedMove:!0},i),this.setEnableMagneticMerge(i.enableMagneticMerge),this.setEnableNodeMerge(i.enableNodeMerge),this.setEnableNeighborNodeMerge(i.enableNeighborNodeMerge),this.setEnableConnectorMerge(i.enableConnectorMerge),this.setEnableStructFragmentMerge(i.enableStructFragmentMerge),this.setEnableNodeStick(i.enableNodeStick),this.setEnableStructFragmentStick(i.enableStructFragmentStick),this.setEnableConstrainedMove(i.enableConstrainedMove),this.setEnableConstrainedRotate(i.enableConstrainedRotate),this.setEnableConstrainedResize(i.enableConstrainedResize),this.setEnableDirectedMove(i.enableDirectedMove)},canInteractWithObj:function(i){return this.tryApplySuper("canInteractWithObj",[i])||this._isMerging&&i},doSetManipulateObjs:function(i){var r=i?s.clone(i):[];this.getMergingDests()&&!this.useMergePreview()&&s.pushUnique(r,this.getMergingDests()),this.setPropStoreFieldValue("manipulateObjs",i),i?this.getEditor().prepareOperatingObjs(r):this.getEditor().endOperatingObjs()},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isConstrainedResize:function(){return this.getEnableConstrainedResize()},isConstrainedMove:function(){if(!this.getEnableConstrainedMove())return!1;var i=this.getManipulateObjs();if(i.length===1){var r=i[0],a=this.getEditor().getSelection();if(a&&a.indexOf(r)<0)return r.getConstraintManipulationBaseObj&&r.getConstraintManipulationBaseObj()}return!1},isInActualConstrainedRotation:function(){return this.isConstrainedRotate()&&!this._suppressConstrainedRotating},isDirectedMove:function(){return this.getEnableDirectedMove()&&!this.isConstrainedMove()&&this._isInDirectedMoving},useMergePreview:function(){return this._useMergePreview},setUseMergePreview:function(i){this._useMergePreview=i},getMergeOperationsInManipulating:function(){return this._useMergePreview?this.getMergePreviewOperations():this.getMergeOperations()},createManipulateObjInfo:function(i,r,a){var o=this.getEditor(),l=this.tryApplySuper("createManipulateObjInfo",[i,r,a]);if(this.isConstrainedMove()){var u=i.getConstraintManipulationBaseObj();if(u&&(l.isConstrained=!0,!l.hasNoCoord)){l.originScreenCoord=o.getObjectScreenCoord(i),l.refScreenCoord=o.getObjectScreenCoord(u),l.connectorScreenLength=Kekule.CoordUtils.getDistance(l.screenCoord,l.refScreenCoord),l.connectorObjLength=Kekule.CoordUtils.getDistance(o.getObjCoord(i),o.getObjCoord(u));var c=Kekule.CoordUtils.substract(l.originScreenCoord,l.refScreenCoord);l.originBondDirectionAngle=Math.atan2(c.y,c.x),l.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta(),l.constrainedBondDirectionAngles=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngles(),l.constrainedBondDirectionAngleThreshold=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionAngleThreshold()}}return l},getAllowLengthChangeInConstrainedMoving:function(i){return i instanceof Kekule.Glyph.PathGlyphNode},_getTransformCompareThresholds:function(i){return i===Kekule.CoordMode.COORD3D?this.tryApplySuper("_getTransformCompareThresholds",[i]):{translate:this.getEditorConfigs().getStructureConfigs().getDefBondLength()||this.getEditor().getChemSpace().getAutoScaleRefLength()||.05,rotate:this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep()/5,scale:this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep()/5}},_calcActualMovedScreenCoord:function(i,r,a){var o,l=Kekule.CoordUtils,u=a;if(r.isConstrained&&!this._suppressConstrainedMoving){var c,d,h=r.constrainedBondDirectionDelta||null,p=r.constrainedBondDirectionAngles||null,g=r.constrainedBondDirectionAngleThreshold||null,f=!1,m=l.substract(a,r.refScreenCoord),C=Math.atan2(m.y,m.x),_=l.getDistance(m);if(p&&g)for(var y=0,T=p.length;y<T;++y){var E=p[y];Math.abs(E-C)<=g&&(f=!0,c=E)}if(!f&&h){var b=Math.round((C-r.originBondDirectionAngle)/h);c=r.originBondDirectionAngle+b*h,f=!0}if(f||(c=C),this.getAllowLengthChangeInConstrainedMoving(i)){var v=this.getEditor().getDefBondScreenLength(),I=_/v,R=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();d=v*(I=(Math.round(I/R)||1)*R)}else d=r.connectorScreenLength;o=l.add(r.refScreenCoord,{x:d*Math.cos(c),y:d*Math.sin(c)})}else o=u;return o},_calcActualRotateAngle:function(i,r,a,o){var l=this.isConstrainedRotate()&&!this._suppressConstrainedRotating?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;return l?Math.round(r/l)*l:this.tryApplySuper("_calcActualRotateAngle",[i,r])},_calcActualResizeScales:function(i,r){if(this.isConstrainedResize()&&!this._suppressConstrainedResize){var a=this.getEditorConfigs().getInteractionConfigs().getConstrainedResizeStep();return a?{scaleX:(Math.round(r.scaleX/a)||1)*a,scaleY:(Math.round(r.scaleY/a)||1)*a}:r}return r},prepareManipulating:function(i,r,a,o,l,u){this.setUseMergePreview(this.getEditorConfigs().getInteractionConfigs().getEnableMergePreview()),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([]),this.tryApplySuper("prepareManipulating",[i,r,a,o,l,u]),this._directedMovingDirection=null,this.setManuallyHotTrack(!0)},manipulateBeforeStopping:function(){if(this.tryApplySuper("manipulateBeforeStopping"),this.useMergePreview()){var i=this.getMergePreviewOperations();if(i&&i.length){for(var r=this.getMergeOperations(),a=0,o=i.length;a<o;++a){var l=i[a];if(l){var u=l instanceof Kekule.ChemStructOperation.MergeConnectorsBase?this.createConnectorMergeOperation(l.getTarget(),l.getDest()):this.createNodeMergeOperation(l.getTarget(),l.getDest());r.push(u)}}this.executeMergeOpers(r)}}},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.getEditor().hideHotTrack(),this.setManuallyHotTrack(!1)},createManipulateOperation:function(){this.tryApplySuper("createManipulateOperation"),this.setMergeOperations([]),this.setMergePreviewOperations([]),this.setStickOperations([])},getAllObjOperations:function(i){var r=this.getMergeOperations(),a=this.tryApplySuper("getAllObjOperations")||[];r&&r.length&&Kekule.ArrayUtils.pushUnique(a,r);var o=this.getStickOperations();if(o&&o.length)for(var l=0,u=o.length;l<u;++l){var c=o[l];c&&(c.getStickTarget&&!c.getStickTarget()?a.unshift(c):a.push(c))}return a},_objCanBeMagneticMerged:function(i){return!(i instanceof Kekule.StructureFragment)&&(i instanceof Kekule.ChemStructureNode||i instanceof Kekule.ChemStructureConnector)},_objCanBeMagneticSticked:function(i){return!(i instanceof Kekule.StructureFragment)&&i instanceof Kekule.BaseStructureNode&&i.getAllowCoordStickTo()},_canStickNode:function(i,r){if(this.getEnableNodeStick()){var a=this.getEnableStructFragmentStick(),o=this.getEnableSiblingStick();return Kekule.ChemObjOperation.StickTo.canStick(i,r,a,o)}return!1},_canMergeNodes:function(i,r){if(this.getEnableNodeMerge()){var a=this.getEnableStructFragmentMerge(),o=this.getEnableNeighborNodeMerge();return Kekule.ChemStructOperation.MergeNodes.canMerge(i,r,a,o)}return!1},_canMergeConnectors:function(i,r){if(this.getEnableConnectorMerge()){var a=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeConnectors.canMerge(i,r,a)}return!1},_findSuitableMergeTargetBoundInfo:function(i,r,a,o){for(var l=i.length-1;l>=0;--l){var u=i[l],c=u.obj;if(!(r.indexOf(c)>=0)&&c instanceof a&&(!o||o(c)))return u}return null},_getCoordStickActualTarget:function(i){for(var r=i,a=r.getCoordStickTarget&&r.getCoordStickTarget();a;)a=(r=a).getCoordStickTarget&&r.getCoordStickTarget();return r},_getMagneticNodeMergeOrStickDestInfo:function(i,r,a){var o=this.getEditor(),l=this;if(r){var u=o.getBoundInfosAtCoord(r,function(p){var g=p.obj,f=l._getCoordStickActualTarget(g);return i!==g&&a.indexOf(g)<0&&(g instanceof Kekule.BaseStructureNode&&l._canMergeNodes(i,g)||l._canStickNode(i,f))},this.getCurrBoundInflation()),c=u.length?u[u.length-1]:null;if(c){var d=c.obj,h=this._getCoordStickActualTarget(d);return this._canMergeNodes(i,d)?{obj:d,isMerge:!0}:this._canStickNode(i,h)?{obj:h,isStick:!0}:null}return null}return null},moveManipulatedObjs:function(i){var r;if(this.isDirectedMove()){var a=Kekule.CoordUtils,o=this.getStartCoord(),l=a.getDistance(o,i),u=a.substract(i,o),c=this._directedMovingDirection;this._directedMovingDirection||(c=Math.abs(u.x)>=Math.abs(u.y)?"x":"y",l<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()||(this._directedMovingDirection=c)),(r=Object.extend({},o))[c]=i[c]}else r=i;return this.tryApplySuper("moveManipulatedObjs",[r])},applyManipulatingObjsInfo:function(i){var r={MERGE:0,MERGE_BOND:1,STICK:10,UNSTICK:20};this.setAllManipulateObjsMerged(!1);var a=this.useMergePreview(),o=this.getEditor();o.hotTrackOnObj(null);var l=Kekule.Editor.BasicManipulationIaController.ManipulationType,u=this.getManipulationType(),c=this.getManipulateOriginObjs(),d=this.getManipulateObjs(),h=[].concat(c);Kekule.ArrayUtils.pushUnique(h,d);var p=this.getMergeOperationsInManipulating(),g=this.getStickOperations(),f=this,m=c.length===1&&c[0]instanceof Kekule.ChemStructureConnector,C=d.length===1&&d[0]instanceof Kekule.BaseStructureNode&&(this._objCanBeMagneticMerged(d[0])||this._objCanBeMagneticSticked(d[0])),_=u===l.MOVE&&!this.getIsOffsetManipulating()&&(m&&this.getEnableConnectorMerge()||C&&this.getEnableNodeMerge()),y=!m&&this.getEnableMagneticMerge();if(y||_){var T=this.getManipulateObjCurrInfoMap(),E=this.getManipulateObjInfoMap(),b=[],v=[],I=[],R=[];if(_){var N=m?c[0]:d[0],L=this._calcMagneticMergeOrStickInfoOnScreenCoord(i,N,this._isManipulatingSingleStickedObj(d),T,E,h,r);if(L)b=[0],v=[L.magneticObj],I=[L.magneticDest],R=[L.magneticType];else if(m&&this.getEnableConnectorMerge()){var U=o.getBoundInfosAtCoord(i,null,this.getCurrBoundInflation()),W=Kekule.ChemStructureConnector,M=(N=c[0],this._findSuitableMergeTargetBoundInfo(U,h,W,function(Z){return f._canMergeConnectors(N,Z)}));M&&(b=[0],v=[N],I=[M.obj],R=[r.MERGE_BOND])}}if(!v.length&&y){var B=this._calcMagneticMergeOrStickInfos(d,T,E,h,r);b=B.magneticObjIndexes,v=B.magneticObjs,I=B.magneticDests,R=B.magneticTypes}if(v.length||g.length){var V=v.length;this.setAllManipulateObjsMerged(V===d.length);for(var J=V===1,$=!1,q=!1,Q=[],ie=[],Y=0,ne=v.length;Y<ne;++Y){var de=v[Y],Ae=I[Y],Ce=b[Y];if(R[Y]===r.STICK){if(!q){if(!(fe=g[Ce])||!this.isSameNodeStick(fe,de,Ae)){q=!0;break}ie.push(fe)}}else $||((pe=p[Ce])&&this.isSameNodeMerge(pe,de,Ae)?Q.push(pe):$=!0);if($&&q)break}for(Y=0,ne=p.length;Y<ne;++Y){var pe;if(pe=p[Y]){if((Ce=Q.indexOf(pe))<0){$=!0;break}Q.splice(Ce,1)}}for(Y=0,ne=g.length;Y<ne;++Y){var fe;if(fe=g[Y]){if((Ce=ie.indexOf(fe))<0){q=!0;break}ie.splice(Ce,1)}}if($||q||J){$&&this.reverseMergeOpers(this.getMergeOperationsInManipulating()),q&&this.reverseStickOpers(this.getStickOperations());var Te=Kekule.CoordUtils;if(V===1||o.getCoordMode()===Kekule.CoordMode.COORD3D){if(R[0]!==r.MERGE_BOND){var xe=(Mt=T.get(v[0]))&&Mt.screenCoord,Re=o.getObjectScreenCoord(I[0]);if(xe&&Re){var we=Te.substract(Re,xe),Me=!1,Le=Kekule.NumUtils.isFloatEqual;if(!Le(we.x,0,1e-10)||!Le(we.y,0,1e-10))for(Y=0,ne=d.length;Y<ne;++Y){de=d[Y];var Ue=T.get(de);if(de!==v[0]){if(Ue&&Ue.screenCoord){var at=Te.add(Ue.screenCoord,we);Ue.screenCoord=at,this._getMagneticNodeMergeOrStickDestInfo(de,at,h)&&(Me=!0)}}else Ue&&Ue.screenCoord&&(Ue.screenCoord=Re)}if(Me)return this.applyManipulatingObjsInfo(i);for(Y=0,ne=d.length;Y<ne;++Y)de=d[Y],Ue=T.get(de),this.applySingleManipulatingObjInfo(Y,de,Ue,i)}}}else if(V>1&&o.getCoordMode()!==Kekule.CoordMode.COORD3D){var Bt=v[0],Fe=v[1];if(Bt&&Fe){var Nt=E.get(Bt).screenCoord,Xe=E.get(Fe).screenCoord,vt=o.getObjectScreenCoord(I[0]),yt=o.getObjectScreenCoord(I[1]),Ht=Te.calcCoordGroup2DTransformParams(Nt,Xe,vt,yt),Dr=Te.calcTransform2DMatrix(Ht);for(Me=!1,Y=0,ne=d.length;Y<ne;++Y)if(de=d[Y],v.indexOf(de)<0){Ue=E.get(de);var Mt=T.get(de);Ue.screenCoord&&(at=Te.transform2DByMatrix(Ue.screenCoord,Dr),Mt.screenCoord=at,this._getMagneticNodeMergeOrStickDestInfo(de,at,h)&&(Me=!0)),Ue.size&&(Mt.size=Te.multiply(Ue.size,Ht.scale))}if(Me)return this.applyManipulatingObjsInfo(i);for(Y=0,ne=d.length;Y<ne;++Y)de=d[Y],v.indexOf(de)<0&&(Mt=T.get(de),this.applySingleManipulatingObjInfo(Y,de,Mt,i))}}if($||q){var ae=[];for(this._mergeOperationsChanged(V,v,I),Y=0,ne=V;Y<ne;++Y){de=v[Y],Ae=I[Y],Ce=b[Y];var D=R[Y];if(D===r.STICK){if(Ae!==E.get(de).stickTarget)var O=this.createNodeStickOperation(de,Ae);this.getStickOperations()[Ce]=O,Ae||ae.push({index:Ce,obj:de,newInfo:T.get(de)})}else if(a){var k=D===r.MERGE_BOND?this.createConnectorMergeOperation(de,Ae,!0):this.createNodeMergeOperation(de,Ae,!0);this.getMergePreviewOperations()[Ce]=k}else{var w=D===r.MERGE_BOND?this.createConnectorMergeOperation(de,Ae):this.createNodeMergeOperation(de,Ae);this.getMergeOperations()[Ce]=w}}if($&&this.executeMergeOpers(this.getMergeOperationsInManipulating()),q&&this.executeStickOpers(this.getStickOperations()),ae.length)for(Y=0,ne=ae.length;Y<ne;++Y){var z=ae[Y];this.applySingleManipulatingObjInfo(z.index,z.obj,z.newInfo,i)}}}return void o.hotTrackOnObj(I)}}(p=this.getMergeOperationsInManipulating())&&p.length&&(this._mergeOperationsChanged(0,[],[]),this.reverseMergeOpers(p)),this.tryApplySuper("applyManipulatingObjsInfo",[i])},_calcMagneticMergeOrStickInfoOnScreenCoord:function(i,r,a,o,l,u,c){var d=this.getEditor(),h=(this._objCanBeMagneticMerged,this._objCanBeMagneticSticked,r),p=i;if(p){d.getBoundInfosAtCoord(p,null,this.getCurrBoundInflation());var g=this._getMagneticNodeMergeOrStickDestInfo(h,p,u),f=null,m=null;if(g&&(g.isStick?m=g.obj:g.isMerge&&(f=g.obj)),f||m)return{magneticObj:h,magneticDest:f||m,magneticType:m?c.STICK:c.MERGE};if(!m&&a&&l.get(h).stickTarget)return{magneticObj:h,magneticDest:null,magneticType:c.STICK}}},_calcMagneticMergeOrStickInfos:function(i,r,a,o,l){for(var u=this._isManipulatingSingleStickedObj(i),c=this._objCanBeMagneticMerged,d=this._objCanBeMagneticSticked,h=(this.getEditor(),[]),p=[],g=[],f=[],m=0,C=i.length;m<C;++m){var _=i[m];if(c(_)||d(_)){var y=r.get(_),T=y&&y.screenCoord;if(T){var E=this._calcMagneticMergeOrStickInfoOnScreenCoord(T,_,u,r,a,o,l);E&&(h.push(m),p.push(E.magneticObj),g.push(E.magneticDest),f.push(E.magneticType))}}}return{magneticObjIndexes:h,magneticObjs:p,magneticDests:g,magneticTypes:f}},_mergeOperationsChanged:function(i,r,a){},doMoveManipulatedObj_old:function(i,r,a,o){var l=this.getEditor(),u=(this.getManipulateObjInfoMap().get(r),a),c=this.getManipulateOriginObjs(),d=this.getManipulationType(),h=d===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE&&c.length===1&&c[0]instanceof Kekule.ChemStructureConnector,p=u,g=null,f=this.getMergeOperations(),m=f[i],C=this.getManipulateObjs();if(!h&&this.getEnableMagneticMerge()&&r instanceof Kekule.ChemStructureNode){var _=l.getBoundInfosAtCoord(p);if(_&&_.length){for(var y=_.length-1;y>=0;--y){var T=_[y].obj;if(T!==r&&!(C.indexOf(T)>=0)&&T instanceof Kekule.ChemStructureNode&&this._canMergeNodes(r,T)){if(l.addHotTrackedObj(T),this.isSameNodeMerge(m,r,T))return;g=this.createNodeMergeOperation(r,T);break}}g?(m&&this.reverseMergeOpers(i),this.getMergeOperations()[i]=g,this.executeMergeOpers()):l.hotTrackOnObj(null)}}if(p=o,d===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE){var E=c[0];if(c&&c.length===1){var b=l.getTopmostBoundInfoAtCoord(p,[E]);if(b){var v=b.obj;if(v&&C.indexOf(v)<0){if(h&&E instanceof Kekule.ChemStructureConnector&&v instanceof Kekule.ChemStructureConnector)this.getEnableConnectorMerge()&&(l.hotTrackOnObj(v),(this.getEnableStructFragmentMerge()||E.getParent()===v.getParent())&&(g=this.createConnectorMergeOperation(E,v)));else if(E instanceof Kekule.ChemStructureNode&&v instanceof Kekule.ChemStructureNode&&this._canMergeNodes(E,v)){if(l.hotTrackOnObj(v),this.isSameNodeMerge(m,E,v))return;g=this.createNodeMergeOperation(E,v)}if(g)return(m=f[i])&&this.reverseMergeOpers(i),this.getMergeOperations()[i]=g,void this.executeMergeOpers()}}}}g||(l.hideHotTrack(),this.getMergeOperations().length&&this.reverseMergeOpers(i),this.tryApplySuper("doMoveManipulatedObj_old",[i,r,a,o]))},createNodeMergeOperation:function(i,r,a){var o=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeNodes.canMerge(i,r,o,this.getEnableNeighborNodeMerge())?a?new Kekule.ChemStructOperation.MergeNodesPreview(i,r,o,this.getEditor()):new Kekule.ChemStructOperation.MergeNodes(i,r,o,this.getEditor()):null},createConnectorMergeOperation:function(i,r,a){var o=this.getEnableStructFragmentMerge();return Kekule.ChemStructOperation.MergeConnectors.canMerge(i,r,o)?new(a?Kekule.ChemStructOperation.MergeConnectorsPreview:Kekule.ChemStructOperation.MergeConnectors)(i,r,this.getEditor().getCoordMode(),o,this.getEditor()):null},createNodeStickOperation:function(i,r){return this.getEnableStructFragmentStick(),this._canStickNode(i,r)?new Kekule.ChemObjOperation.StickTo(i,r,this.getEditor()):null},isSameConnectorMerge:function(i,r,a){return i&&i instanceof Kekule.ChemStructOperation.MergeConnectorsBase&&r===i.getTarget()&&a===i.getDest()},isSameNodeMerge:function(i,r,a){return i&&i instanceof Kekule.ChemStructOperation.MergeNodesBase&&r===i.getTarget()&&a===i.getDest()},isSameNodeStick:function(i,r,a){return i&&i instanceof Kekule.ChemObjOperation.StickTo&&r===i.getTarget()&&a===i.getStickTarget()},isSameNodeMergeOrStick:function(i,r,a){return this.isSameNodeMerge(i,r,a)||this.isSameNodeStick(i,r,a)},executeStickOpers:function(i){var r=this.getEditor(),a=Kekule.ArrayUtils.toUnique(i||this.getStickOperations());r.beginUpdateObject();try{for(var o=0,l=a.length;o<l;++o)a[o]&&a[o].execute()}finally{r.endUpdateObject()}},reverseStickOpers:function(i){var r=this.getEditor(),a=i||this.getStickOperations(),o=Kekule.ArrayUtils.toUnique(a);if(o&&o.length){r.beginUpdateObject();try{for(var l=o.length-1;l>=0;--l)o[l]&&o[l].reverse();a.length=0}finally{r.endUpdateObject()}}},executeMergeOpers:function(i){var r=this.getEditor(),a=Kekule.ArrayUtils.toUnique(i||this.getMergeOperationsInManipulating()),o=[];r.beginUpdateObject();try{for(var l=0,u=a.length;l<u;++l)if(a[l]){a[l].execute();var c=a[l].getDest?a[l].getDest():null;c&&s.pushUnique(o,c)}this.setMergingDests(o.length?o:null),this.refreshManipulateObjs(),this._mergeJustReversed=!1}finally{r.endUpdateObject()}},reverseMergeOpers:function(i){var r=this.getEditor();this.setMergingDests(null);var a=i||this.getMergeOperationsInManipulating(),o=Kekule.ArrayUtils.toUnique(a);if(o&&o.length){r.beginUpdateObject();try{for(var l=o.length-1;l>=0;--l)o[l]&&o[l].reverse();a.length=0,this._mergeJustReversed=!0,this.refreshManipulateObjs()}finally{r.endUpdateObject()}}},react_pointermove:function(i){return this._suppressConstrainedMoving=i.getAltKey(),this._suppressConstrainedRotating=i.getAltKey(),this._suppressConstrainedResize=i.getAltKey(),this._isInDirectedMoving=i.getShiftKey(),this.tryApplySuper("react_pointermove",[i])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolManipulationIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.SelectIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.SelectIaController",initialize:function(i){this.tryApplySuper("initialize",[i])},initPropValues:function(){this.tryApplySuper("initPropValues");var i=Kekule.globalOptions.get;this.setEnableSelect(i("chemWidget.editor.enableSelect",!0)),this.setEnableGestureManipulation(i("chemWidget.editor.enableGesture",!0))}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.SelectIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.StructureInsertIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.StructureInsertIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this._manipulatedBasicObjs=null},getInsertedObjs:function(){return this._manipulatedBasicObjs},doSetManipulateOriginObjs:function(i){return this._manipulatedBasicObjs=this._getManipulatedBasicObjects(i),this.tryApplySuper("doSetManipulateOriginObjs",[i])},_getManipulatedBasicObjects:function(i){for(var r=[],a=0,o=i.length;a<o;++a){var l=i[a];if(l instanceof Kekule.ChemStructureObject)if(l instanceof Kekule.StructureFragment&&l.isExpanded()){var u=[].concat(l.getNodes()).concat(l.getConnectors());s.pushUnique(r,u)}else s.pushUnique(r,l);else s.pushUniqueEx(r,l)}return r},stopManipulate:function(){if(this.needAutoSelectNewlyInsertedObjects()){var i=this.getInsertedObjs();this.doneInsertOrModifyBasicObjects(i)}return this.tryApplySuper("stopManipulate")}}),Kekule.Editor.MolBondIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setState(n.State.INITIAL),this.setBondOrder(Kekule.BondOrder.SINGLE)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("state",{dataType:DataType.INT,serializable:!1}),this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:!1}),this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:!1}),this.defineProp("bond",{dataType:"Kekule.Bond",serializable:!1}),this.defineProp("bondType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("bondOrder",{dataType:DataType.INT,serializable:!1}),this.defineProp("bondStereo",{dataType:DataType.INT,serializable:!1}),this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!1),this.setEnableMove(!0),this.setEnableNeighborNodeMerge(!1);var i=Kekule.globalOptions.get;this.setEnableBondModification(i("chemWidget.editor.bondManipulation.enableBondModification",!0)),this.setAllowBondingToBond(i("chemWidget.editor.bondManipulation.allowBondingToBond",!1)),this.setAutoSwitchBondOrder(i("chemWidget.editor.bondManipulation.autoSwitchBondOrder",!1))},_isBondDifferent:function(i){var r=this.getBondStereo(),a=Kekule.BondStereo;return r===a.UP||r===a.UP_INVERTED||r===a.DOWN||r===a.DOWN_INVERTED||i.getBondType()!==this.getBondType()||i.getBondOrder()!==this.getBondOrder()||i.getStereo()!==this.getBondStereo()},_isBondOrderSwitchApplicable:function(i){return this.getAutoSwitchBondOrder()&&this.getBondOrder()===Kekule.BondOrder.SINGLE&&this.getBondType()===Kekule.BondType.COVALENT&&this.getBondStereo()===Kekule.BondStereo.NONE&&(!i.getBondType()||i.getBondType()===Kekule.BondType.COVALENT)&&(!i.getStereo()||i.getStereo()===Kekule.BondStereo.NONE)},canInteractWithObj:function(i){if(this.getState()!==n.State.INITIAL)return this.tryApplySuper("canInteractWithObj",[i]);if(i instanceof Kekule.ChemStructureNode)return!0;if(i instanceof Kekule.ChemStructureConnector){if(this.getAllowBondingToBond())return!0;if(!this.getEnableBondModification())return!1;if(i instanceof Kekule.Bond)return this._isBondDifferent(i)||this._isBondOrderSwitchApplicable(i)}},doTestMouseCursor:function(i,r){return""},getInsertedObjs:function(){var i=this.getBond();return i?[i]:this.tryApplySuper("getInsertedObjs")},isObjValidBondTerminator:function(i){return!!i&&(this.getAllowBondingToBond()?i instanceof Kekule.ChemStructureNode||i instanceof Kekule.ChemStructureConnector:i instanceof Kekule.ChemStructureNode)},isBond:function(i){return i instanceof Kekule.Bond},getNewBondDefAngle:function(i,r){return this.getEditorConfigs().getStructureConfigs().getNewBondDefAngle(i,r)},addDefBond:function(i,r,a){var o;(c=this.getEditor()).beginUpdateObject();try{if(r)this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(null);else{if(!this.getEditor().canAddUnconnectedStructFragment())return null;var l=this.getEditor().screenCoordToObj(i),u=this.getEditor().getOnlyOneBlankStructFragment();u?(r=this.getEditor().createStructStartingAtom(u,null,l),this.setAutoCreatedStructFragment(null),this.setAutoCreatedStartingObj(r)):(r=this.getEditor().createNewStructFragmentAndStartingAtom(null,l),this.setAutoCreatedStartingObj(null),this.setAutoCreatedStructFragment(r?r.getParent():null))}if(this.isObjValidBondTerminator(r)){var c=this.getEditor();this.setStartingObj(r);var d=r.getParent();this.setStructFragment(d);var h=this.getEditorConfigs().getStructureConfigs(),p=Kekule.oneOf(this.getBondType(),h.getDefBondType()),g=Kekule.oneOf(this.getBondOrder(),h.getDefBondOrder()),f=Kekule.oneOf(this.getBondStereo(),Kekule.BondStereo.NONE),m=c.getDefBondLength?c.getDefBondLength():h.getDefBondLength(),C=this.getNewBondDefAngle(r,g),_=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(r,m,C,this.getEditor().getAllowCoordBorrow()),y=this.getEditor().createDefaultNode(_,Kekule.Editor.CoordSys.OBJ,d);this.setEndingObj(y);var T=new Kekule.Bond;T.setBondType(p),T.setBondOrder(g),T.setStereo(f),d.appendConnector(T),T.appendConnectedObj(r),T.appendConnectedObj(y),this.setBond(T),a&&this.getEditor().objectsChanged([{obj:T},{obj:y}]),o=_}else o=null}finally{c.endUpdateObject()}return o},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getAllObjOperations:function(i){var r=this.tryApplySuper("getAllObjOperations",[i])||[],a=this.getAddBondOperation();return a&&r.unshift(a),r},getAddBondOperation:function(){var i=new Kekule.MacroOperation,r=this.getEditor(),a=this.getAutoCreatedStructFragment();if(a){var o=new Kekule.ChemObjOperation.Add(a,this.getEditor().getChemObj(),null,this.getEditor());i.add(o)}var l=this.getStartingObj(),u=this.getEndingObj(),c=this.getBond(),d=this.getStructFragment(),h=(r=this.getEditor(),this.getAutoCreatedStartingObj());if(h){var p=new Kekule.ChemStructOperation.AddNode(h,d,null,r);i.add(p)}p=new Kekule.ChemStructOperation.AddNode(u,d,null,r),i.add(p);var g=new Kekule.ChemStructOperation.AddConnector(c,d,null,[l,u],r);return i.add(g),i},modifyBond:function(i){var r,a=this.getBondType(),o=Kekule.BondOrder,l=[o.SINGLE,o.DOUBLE,o.TRIPLE];if(this._isBondOrderSwitchApplicable(i)){var u=i.getBondOrder(),c=l.indexOf(u);r=l[c=c>=0?++c%l.length:0]}else r=this.getBondOrder();var d=i.getStereo(),h=this.getBondStereo();d===h&&(h=Kekule.BondStereo.getInvertedDirection(h));var p={bondType:a,bondOrder:r,stereo:h},g=!1;for(var f in p)if(i.getPropValue(f)!==p[f]){g=!0;break}if(g){var m=this.getEditor();m.beginUpdateObject();try{var C=new Kekule.ChemObjOperation.Modify(i,p,this.getEditor());C.execute(),m.pushOperation(C);for(var _=[i].concat(i.getConnectedObjs()),y=[],T=0,E=_.length;T<E;++T)y.push({obj:_[T]});this.getEditor().objectsChanged(y)}finally{m.endUpdateObject()}}},react_pointerdown:function(i){if(this.setActivePointerType(i.pointerType),i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var r=n.State,a=this._getEventMouseCoord(i);if(this.getState()===r.INITIAL){var o=this.getEditor().getTopmostBoundInfoAtCoord(a,null,this.getCurrBoundInflation());if(o){var l=o.obj;if(this.isObjValidBondTerminator(l))return this.addDefBond(a,l,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),a),this.moveManipulatedObjs(a)),!0;if(this.isBond(l)&&this.getEnableBondModification())return this.modifyBond(l),!0;i.preventDefault()}else if(this.getEditor().canAddUnconnectedStructFragment())return this.addDefBond(a,null,!0)&&(this.startDirectManipulate(null,this.getEndingObj(),a),this.moveManipulatedObjs(a)),i.preventDefault(),!0}}},react_pointerup:function(i){var r=this.getState(),a=this.getStartCoord(),o=this._getEventMouseCoord(i),l=Kekule.Editor.BasicManipulationIaController.State;return r===l.MANIPULATING&&i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&(i.preventDefault(),Kekule.CoordUtils.isEqual(a,o))?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(l.NORMAL),!0):this.tryApplySuper("react_pointerup",[i])}}),Kekule.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var n=Kekule.Editor.MolBondIaController;Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolBondIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolAtomIaController_OLD=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController_OLD",initialize:function(i){this.tryApplySuper("initialize",[i]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1})},canInteractWithObj:function(i){return!!this.isValidNode(i)},isValidNode:function(i){return i instanceof Kekule.ChemStructureNode},getNodeLabel:function(i){var r=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();if(i.getIsotopeId)return i.getIsotopeId();if(i instanceof Kekule.SubGroup)return i.getAbbr()||i.getFormulaText()||r.getRgroup();if(i instanceof Kekule.VariableAtom){var a=i.getAllowedIsotopeIds(),o=i.getDisallowedIsotopeIds();return a&&a.length?this._getVarAtomListLabel():o&&o.length?this._getVarAtomNotListLabel():this._getVarAtomListLabel()}var l=i.getCoreDisplayRichTextItem(null,null,r);return Kekule.Render.RichTextUtils.toText(l)},_getVarAtomListLabel:function(){return this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_getVarAtomNotListLabel:function(){return"~"+this.getEditor().getRenderConfigs().getDisplayLabelConfigs().getVariableAtom()},_createNonAtomLabelInfos:function(){var i=[],r=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return i.push({nodeLabel:r.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.$L("ChemWidgetTexts.CAPTION_RGROUP")}),i.push({nodeLabel:r.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.$L("ChemWidgetTexts.CAPTION_DUMMY_ATOM")}),i.push({nodeLabel:r.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.$L("ChemWidgetTexts.CAPTION_HETERO_ATOM")}),i.push({nodeLabel:r.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.$L("ChemWidgetTexts.CAPTION_ANY_ATOM")}),i.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_ATOM")}),i.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.$L("ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM")}),this.setNonAtomLabelInfos(i),i},_indexOfNonAtomLabel:function(i){for(var r=this.getNonAtomLabelInfos(),a=0,o=r.length;a<o;++a)if(r[a].nodeLabel===i)return a;return-1},_getNonAtomInfo:function(i){var r=this._indexOfNonAtomLabel(i);return r<0?null:this.getNonAtomLabelInfos()[r]},getAtomSetterWidget:function(i){var r=this.getAtomSetter();if(!r&&i){var a=this.getEditor().getCoreElement(),o=a.ownerDocument;r=this._createAtomSetterWidget(o,a),this.setAtomSetter(r)}return r},_createAtomSetterWidget:function(i,r){for(var a=new Kekule.Widget.ComboBox(i),o=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms(),l=[],u=0,c=o.length;u<c;++u)l.push({value:o[u],data:{props:{isotopeId:o[u]}}});l.push({value:Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")});var d=this.getNonAtomLabelInfos();for(u=0,c=d.length;u<c;++u){var h=d[u],p={value:h.nodeLabel,data:{props:h.props}};h.description&&(p.text=h.nodeLabel+" - "+h.description),l.push(p)}a.setItems(l),a.appendToElem(r);var g=this;return a.addEventListener("keyup",function(f){f.htmlEvent.getKeyCode()===Kekule.X.Event.KeyCode.ENTER&&(g.applySetter(a),a.dismiss())}),a.addEventListener("valueSelect",function(f){g.applySetter(a),a.dismiss()}),a.addEventListener("showStateChange",function(f){f.isShown||f.isDismissed||g.getAtomSetter()&&g.getAtomSetter().isShown()&&g.applySetter(a)}),a},getPeriodicTableDialogWidget:function(i){var r=this.getPeriodicTableDialog();if(!r&&i){var a=this.getEditor().getCoreElement(),o=a.ownerDocument;r=this._createPeriodicTableDialogWidget(o,a),this.setPeriodicTableDialog(r)}return r},_createPeriodicTableDialogWidget:function(i,r){var a=new Kekule.Widget.Dialog(i,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),o=new Kekule.ChemWidget.PeriodicTable(i);return o.setUseMiniMode(!0),o.setEnableSelect(!0),o.appendToElem(a.getClientElem()),this.setPeriodicTable(o),a},openSetterUi:function(i,r){if(this.getAtomSetter(),this.isValidNode(r)){this.setCurrAtom(r);var a=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,o=a/1.5,l=this.getNodeLabel(r),u=this.getAtomSetterWidget(!0);u.setValue(l),u.setIsDirty(!1);var c=u.getElement().style;c.position="absolute",c.fontSize=a,c.left=i.x-o+"px",c.top=i.y-o+"px",u._applied=!1,u.setStandaloneOnShowHide(!0),u.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),(function(){u.focus(),u.selectAll()}).defer()}},applySetter:function(i,r){if(!i._applied&&i.getIsDirty()){var a;r||(r=this.getCurrAtom());var o=null,l=i.getValue();if(l===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){(c=this.getPeriodicTableDialogWidget(!0)).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var u=r.getSymbol?r.getSymbol():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!1).setSelectedSymbol(u)}else if(l===this._getVarAtomListLabel()||l===this._getVarAtomNotListLabel()){var c,d=l===this._getVarAtomNotListLabel();(c=this.getPeriodicTableDialogWidget(!0)).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM"));var h=r.getAllowedIsotopeIds?r.getAllowedIsotopeIds():null,p=r.getDisallowedIsotopeIds?r.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(!0).setEnableMultiSelect(!0).setSelectedSymbols(d?p:h)}if(c){var g=this;c.openModal(function(E){if(E===Kekule.Widget.DialogButtons.OK){var b,v;if(l===Kekule.$L("ChemWidgetTexts.CAPTION_ATOMLIST_PERIODIC_TABLE")){var I=g.getPeriodicTable().getSelectedSymbol();b=Kekule.Atom,v={isotopeId:I}}if(l===g._getVarAtomListLabel()){var R=g.getPeriodicTable().getSelectedSymbols();b=Kekule.VariableAtom,v={allowedIsotopeIds:R,disallowedIsotopeIds:null}}l===g._getVarAtomNotListLabel()&&(R=g.getPeriodicTable().getSelectedSymbols(),b=Kekule.VariableAtom,v={allowedIsotopeIds:null,disallowedIsotopeIds:R}),g.applyModification(r,null,b,v)}},this)}else{var f=null,m=this._getNonAtomInfo(l);if(m)a=m.nodeClass,o=m.props;else{var C=Kekule.Editor.StoredSubgroupRepositoryItem2D.getRepItemOfInputText(l);if(C){var _=C.createObjects(r)||{},y=_.objects,T=Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),C,_,r,null);this.getEditor().transformCoordAndSizeOfObjects(y,T),a=(f=y[0]).getClass()}else(a=Kekule.ChemStructureNodeFactory.getClassByLabel(l,null))||this.getEditorConfigs().getInteractionConfigs().getAllowUnknownAtomSymbol()&&(a=Kekule.Pseudoatom),o=a===Kekule.Atom?{isotopeId:l}:a===Kekule.Pseudoatom?{symbol:l}:{}}a?(this.applyModification(r,f,a,o),i._applied=!0):Kekule.error(Kekule.$L("ErrorMsg.INVALID_ATOM_SYMBOL"))}}},applyModification:function(i,r,a,o){var l,u,c=i.getClass();if(r&&!a&&(a=r.getClass()),r||a!==c){l=new Kekule.MacroOperation,r||(r=new a);var d=new Kekule.ChemStructureNode;d.assign(i),r.assign(d);var h=new Kekule.ChemStructOperation.ReplaceNode(i,r,null,this.getEditor());l.add(h)}else r=i;o&&(u=new Kekule.ChemObjOperation.Modify(r,o,this.getEditor()),l&&l.add(u));var p=l||u;if(p){var g=this.getEditor();g.beginManipulateAndUpdateObject();try{p.execute()}catch(f){throw f}finally{g.endManipulateAndUpdateObject()}g&&g.getEnableOperHistory()&&p&&g.pushOperation(p)}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var r=this._getEventMouseCoord(i),a=this.getEditor().getTopmostBoundInfoAtCoord(r,null,this.getCurrBoundInflation());if(a){var o=a.obj;if(this.isValidNode(o)){var l=this.getEditor().getObjectScreenCoord(o);i.preventDefault(),i.stopPropagation(),this.openSetterUi(l,o),this.getEditor().setSelection([o])}return!0}}}}),Kekule.Editor.MolAtomIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this._createNonAtomLabelInfos(),this._setterShown=!1},finalize:function(){this.getAtomSetter()&&this.getAtomSetter().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:!1,setter:function(i){var r=this.getAtomSetter();r&&this.unbindAtomSetter(r),this.setPropStoreFieldValue("atomSetter",i),i&&this.bindAtomSetter(i)}})},canInteractWithObj:function(i){return!!this.isValidNode(i)},isValidNode:function(i){return i instanceof Kekule.ChemStructureNode&&!(i instanceof Kekule.StructureFragment&&i.isStandalone())},_createNonAtomLabelInfos:function(){var i=this.getEditor(),r=i&&i.getEnabledNonAtomInputData&&i.getEnabledNonAtomInputData();return this.setNonAtomLabelInfos(r),r},_indexOfNonAtomLabel:function(i){for(var r=this.getNonAtomLabelInfos(),a=0,o=r.length;a<o;++a)if(r[a].nodeLabel===i)return a;return-1},_getNonAtomInfo:function(i){var r=this._indexOfNonAtomLabel(i);return r<0?null:this.getNonAtomLabelInfos()[r]},getAtomSetterWidget:function(i){var r=this.getAtomSetter();if(!r&&i){var a=this.getEditor().getCoreElement(),o=a.ownerDocument;r=this._createAtomSetterWidget(o,a),this.setAtomSetter(r)}return r},bindAtomSetter:function(i){this._initAtomSetterWidgetSettings(i),this._setAtomSetterEventListener(i,!0)},unbindAtomSetter:function(i){this._setAtomSetterEventListener(i,!1)},_createAtomSetterWidget:function(i,r){var a=new Kekule.ChemWidget.StructureNodeSetter(this.getEditor());return a.setUseDropDownSelectPanel(!0),a.appendToElem(r),a},_initAtomSetterWidgetSettings:function(i){if(i.addClassName(t.CHEMEDITOR_ATOM_SETTER),i.setSelectableInfos){var r=s.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());r.push("...");var a=this.getNonAtomLabelInfos();i.setSelectableInfos({elementSymbols:r,nonElementInfos:a,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()})}},_setAtomSetterEventListener:function(i,r){r?i.addEventListener("valueChange",this._reactAtomSetterValueChange,this):i.removeEventListener("valueChange",this._reactAtomSetterValueChange,this)},_reactAtomSetterValueChange:function(i){var r=this.getAtomSetter();r&&r.isShown()&&(i.value&&this.applySetter(r),r.dismiss())},_reactAtomSetterShowStateChange:function(i){var r=this.getAtomSetter();i.target!==r||i.byDomChange||i.isShown||i.isDismissed||r&&r.isShown()&&this.applySetter(r)},getPeriodicTableDialogWidget:function(i){var r=this.getPeriodicTableDialog();if(!r&&i){var a=this.getEditor().getCoreElement(),o=a.ownerDocument;r=this._createPeriodicTableDialogWidget(o,a),this.setPeriodicTableDialog(r)}return r},_createPeriodicTableDialogWidget:function(i,r){var a=new Kekule.Widget.Dialog(i,Kekule.$L("ChemWidgetTexts.CAPTION_PERIODIC_TABLE_DIALOG"),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]),o=new Kekule.ChemWidget.PeriodicTable(i);return o.setUseMiniMode(!0),o.setEnableSelect(!0),o.appendToElem(a.getClientElem()),this.setPeriodicTable(o),a},openSetterUi:function(i,r){var a=this.getAtomSetter();if(a&&a.isShown()&&(a.hide(),a._haltPrevShowHideProcess()),this.isValidNode(r)){this.setCurrAtom(r);var o=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0,l=(o*=this.getEditor().getZoom()||1)/1.5,u=this.getAtomSetterWidget(!0);u.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),u.setNodes([r]);var c=this.getEditor().getCoreElement();u.appendToElem(c);var d=u.getNodeInputBox(),h=u.getElement().style;h.position="absolute",h.left=i.x-l+"px",h.top=i.y-l+"px",h.opacity=1,u.setNodeInputBoxFontSize&&u.setNodeInputBoxFontSize(o+"px"),u._applied=!1,u.setStandaloneOnShowHide(!0),u.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),(function(){d.focus(),d.selectAll()}).defer()}},applySetter:function(i,r){if(!i._applied){r||(r=this.getCurrAtom());var a=i.getValue();if(a){var o=Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(r,a,this.getEditor());if(o){var l=this.getEditor();l.beginManipulateAndUpdateObject();try{o.execute()}catch(u){throw u}finally{l.endManipulateAndUpdateObject()}l&&l.getEnableOperHistory()&&o&&l.pushOperation(o)}}}},applyModification:function(i,r,a,o){var l=Kekule.Editor.OperationUtils.createNodeModificationOperation(i,r,a,o,this.getEditor());if(l){var u=this.getEditor();u.beginManipulateAndUpdateObject();try{l.execute()}catch(c){throw c}finally{u.endManipulateAndUpdateObject()}u&&u.getEnableOperHistory()&&l&&u.pushOperation(l)}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var r=this._getEventMouseCoord(i),a=this.getTopmostInteractableObjAtScreenCoord(r),o=this.getEditor().getObjectScreenCoord(a);return i.preventDefault(),i.stopPropagation(),this.openSetterUi(o,a),this.doneInsertOrModifyBasicObjects([a]),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolAtomIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.RepositoryIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setEnableSelect(!1),this._repObjStartingScreenCoord=null},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:!1}),this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:!1}),this.defineProp("initialTransformParams",{dataType:DataType.HASH,serializable:!1}),this.defineProp("currRepositoryObjects",{dataType:"Kekule.ChemObject",serializable:!1})},doTestMouseCursor:function(i,r){return""},canInteractWithObj:function(i){return this.tryApplySuper("canInteractWithObj",[i])},isValidStartingObj:function(i){return!0},calcInitialTransformParams:function(i,r,a,o){return Kekule.Editor.RepositoryStructureUtils.calcRepObjInitialTransformParams(this.getEditor(),i,r,a,o)},getRepObjCreationOptions:function(){return null},createObjFromRepositoryItem:function(i,r){return r.createObjects(i,this.getRepObjCreationOptions())||{}},addRepositoryObj:function(i,r,a){var o=this.getEditor();this.setAddRepObjsOper(null);var l=null;o.beginUpdateObject();try{var u=o.getChemSpace(),c=this.getRepositoryItem(),d=(l=this.createObjFromRepositoryItem(i,c)).objects;this.setCurrRepositoryObjects(d);var h=c.isOneStructureFragmentObj(),p=!1,g=this.getEditor().getOnlyOneBlankStructFragment();if(!o.canCreateNewChild()&&!l.mergeObj&&!a){if(!h||!o.canAddUnconnectedStructFragment())return null;p=!0}for(var f=new Kekule.MacroOperation,m=0,C=d.length;m<C;++m){var _,y=d[m];_=p?new Kekule.ChemStructOperation.MergeStructFragment(y,g,o):new Kekule.ChemObjOperation.Add(y,u,null,o),f.add(_)}f.execute(),this.setAddRepObjsOper(f);var T=p?[g]:d,E=this.calcInitialTransformParams(c,l,i,r);this._transformObjectsCoordAndSize(T,E),this.setInitialTransformParams(E),l.objects=T;var b=c.getMolManipulationCenterCoord&&c.getMolManipulationCenterCoord();b&&(l.manipulationCenterCoord=Kekule.CoordUtils.transform2D(b,E));var v=c.getMolManipulationDefDirectionCoord&&c.getMolManipulationDefDirectionCoord();v&&(l.manipulationDefDirectionCoord=Kekule.CoordUtils.transform2D(v,E))}finally{o.endUpdateObject()}return l},doRefreshRepositoryObj:function(i,r,a,o,l){this.doPrepareManipulatingObjects(i,r),this.doPrepareManipulatingStartingCoords(r,a,o,l),this.doCreateManipulateMoveAndResizeOperation()},_transformObjectsCoordAndSize:function(i,r){return this.getEditor().transformCoordAndSizeOfObjects(i,r)},getAllObjOperations:function(i){var r=this.tryApplySuper("getAllObjOperations",[i])||[],a=this.getAddRepObjsOper();return a&&r.unshift(a),r},addOperationToEditor:function(){return this.tryApplySuper("addOperationToEditor")},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE},doInsertRepositoryObjToEditor:function(i,r,a,o){o||(this._initialStartingObj=a,this._repObjStartingScreenCoord=r);var l=i;if(l){var u=l.objects,c=null,d=null,h=this.getInitManipulationType();return l.mergeObj?(c=this.getEditor().getObjectScreenCoord(l.mergeObj),h=Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE):l.manipulationCenterCoord&&(c=this.getEditor().objCoordToScreen(l.manipulationCenterCoord)),l.manipulationDefDirectionCoord&&(d=this.getEditor().objCoordToScreen(l.manipulationDefDirectionCoord)),{objects:u,manipulateType:h,coord:r,box:this.getEditor().getObjectsContainerBox(u),rotateCenter:c,rotateRefCoord:d,startingObj:a}}return null},insertRepositoryObjToEditor:function(i,r,a){var o=this.addRepositoryObj(r,i);return this.doInsertRepositoryObjToEditor(o,i,r,a)},updateRepositoryObjInEditor:function(){var i=this.getEditor();i.beginUpdateObject();try{this.useMergePreview()||this.reverseActiveOperation();for(var r=this.getCurrRepositoryObjects(),a=this.addRepositoryObj(this._initialStartingObj,this._repObjStartingScreenCoord,!0),o=s.exclude(r,(a||{}).objects),l=0,u=o.length;l<u;++l){var c=o[l],d=c.getParent();d&&d.removeChild(c)}this.useMergePreview()&&!o.length||(this.setMergeOperations([]),this.setMergePreviewOperations([]));var h=this.doInsertRepositoryObjToEditor(a,this._repObjStartingScreenCoord,this._initialStartingObj,!0);h&&(this.doRefreshRepositoryObj(h.objects,h.coord,h.box,h.rotateCenter,h.rotateRefCoord),this.moveManipulatedObjs(this._repObjStartingScreenCoord))}finally{i.endUpdateObject()}return h},getDirectManipulateObjs:function(i,r){return i},react_pointerdown:function(i){if(this.setActivePointerType(i.pointerType),i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var r=n.State,a=this._getEventMouseCoord(i);if(this.getState()===r.INITIAL){var o=this.getEditor().getTopmostBoundInfoAtCoord(a,null,this.getCurrBoundInflation()),l=o?o.obj:null,u=this.insertRepositoryObjToEditor(a,l);if(u){var c=u.objects||[],d=this.getDirectManipulateObjs(u.objects,u)||[];s.exclude(c,d).length||s.exclude(d,c).length?(this.startDirectManipulate(u.manipulateType,c,u.coord,u.box,u.rotateCenter),this.moveManipulatedObjs(a),this.notifyEditorEndManipulateObjects(),this.startDirectManipulate(u.manipulateType,d,u.coord,u.box,u.rotateCenter),this.moveManipulatedObjs(a)):(this.startDirectManipulate(u.manipulateType,c,u.coord,u.box,u.rotateCenter),this.moveManipulatedObjs(a))}return i.preventDefault(),!0}}},react_pointerup:function(i){var r=this.getState(),a=this.getStartCoord(),o=this._getEventMouseCoord(i),l=Kekule.Editor.BasicManipulationIaController.State;return r===l.MANIPULATING&&i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT&&Kekule.CoordUtils.isEqual(a,o)?(this.manipulateBeforeStopping(),this.addOperationToEditor(),this.stopManipulate(),this.setState(l.NORMAL),i.preventDefault(),!0):this.tryApplySuper("react_pointerup",[i])}}),Kekule.Editor.RepositoryStructureFragmentIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.RepositoryStructureFragmentIaController",initialize:function(i){this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("repItemName",{dataType:DataType.STRING,setter:function(i){if(i!==this.getRepItemName()){var r=Kekule.Editor.RepositoryItemManager.getItem(i);r&&(this.setRepositoryItem(r),this.setPropStoreFieldValue("repItemName",i))}}})}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.RepositoryStructureFragmentIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolFlexStructureIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolFlexStructureIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setEnableSelect(!1)},initProperties:function(){this.defineProp("assocMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var i=this.getPropStoreFieldValue("assocMarker");return i||(i=new Kekule.ChemWidget.TextUiMarker,this.setPropStoreFieldValue("assocMarker",i)),i}})},manipulateEnd:function(){this.tryApplySuper("manipulateEnd"),this.hideAssocMarker()},initAssocMarker:function(){var i=this.getAssocMarker(),r=this.getEditorConfigs().getUiMarkerConfigs(),a={color:r.getFlexStructureAssocMarkerColor(),opacity:r.getFlexStructureAssocMarkerOpacity(),fontSize:r.getFlexStructureAssocMarkerFontSize(),fontFamily:r.getFlexStructureAssocMarkerFontFamily(),textBoxXAlignment:Kekule.Render.BoxXAlignment.CENTER,textBoxYAlignment:Kekule.Render.BoxYAlignment.CENTER};return i.setDrawStyles(a),i.setVisible(!0),this.getEditor().getUiMarkers().addMarker(i),i},hideAssocMarker:function(){var i=this.getPropStoreFieldValue("assocMarker");i&&(i.setVisible(!1),this.getEditor().getUiMarkers().removeMarker(i),this.repaintMarker())},updateAssocMarker:function(i,r,a){var o=this.getAssocMarker();i&&o.setCoord(i),r&&o.setPropValues(r),a||this.repaintMarker()},repaintMarker:function(){this.getEditor().repaintUiMarker()}}),Kekule.Editor.MolFlexChainIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexChainIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setEnableSelect(!1),this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._isForceReversedChainDirection=!1,this._assocMarkerInitCoord=null,this._manipulateObjInfoCache=[],this._chain=null;var r=new Kekule.Editor.MolChainRepositoryItem2D(2);r.setEnableCoordCache(!0),this.setRepositoryItem(r)},updateAssocMarker:function(i,r,a){var o=this.getEditor(),l=this.getAssocMarker().getDrawStyles(),u=this._chain,c=i;if(!c&&u){var d,h=u.getNodeAt(0),p=u.getNodeAt(u.getNodeCount()-1),g=o.getObjectContextCoord(h);if((c=o.getObjectContextCoord(p))&&g&&(d=e.substract(c,g)),d){var f=(l.fontSize||10)/2,m={x:0,y:0};if(c){var C=e.getDistance(d);m={x:f*(d.x/C),y:f*(d.y/C)},c=Kekule.CoordUtils.add(c,m)}}}this.tryApplySuper("updateAssocMarker",[c,r,a])},getChainMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexChainAtomCount(),0)},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(i,r,a){var o=this.getRepositoryItem().getNegativeDirection(),l=this._getCachedManipulateObjInfo(r,o);if(l)return l;var u=this.tryApplySuper("createManipulateObjInfo",[i,r,a]);return this._setCachedManipulateObjInfo(u,r,o),u},canInteractWithObj:function(i){return this.tryApplySuper("canInteractWithObj",[i])&&i instanceof Kekule.ChemStructureNode},getActualManipulatingObjects:function(i){var r=this.getCurrRepositoryObjects()[0];return r?s.clone(r.getNodes()):[]},_setCachedManipulateObjInfo:function(i,r,a){var o=a?1:0,l=this._manipulateObjInfoCache[o];l||(l=[],this._manipulateObjInfoCache[o]=l),l[r]=i},_getCachedManipulateObjInfo:function(i,r){var a=r?1:0,o=this._manipulateObjInfoCache[a];return o&&o[i]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var i=this.getRepositoryItem().getBondLength(),r=this.getInitialTransformParams(),a=this.getEditor(),o=a.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},r)),l=a.objCoordToScreen(Kekule.CoordUtils.transform2D({x:i*Math.cos(Math.PI/6),y:0},r));return Kekule.CoordUtils.getDistance(o,l)},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(i,r,a){var o=this.tryApplySuper("addRepositoryObj",[i,r,a]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,o},insertRepositoryObjToEditor:function(i,r,a){if(!a){this._deltaDistance=null,this._deltaCount=0,this._lastDeltaCount=1;var o=2;this.getRepositoryItem().setAtomCount(o)}this._isUpdateRepObj=a;var l=this.tryApplySuper("insertRepositoryObjToEditor",[i,r,a]);return this._chain=l&&l.objects[0],l&&!a&&(this.initAssocMarker(),this.updateAssocMarker(null,{text:""+o})),l},_updateChain:function(){this._isUpdateRepObj=!0;var i=this.updateRepositoryObjInEditor();return this._chain=i.objects[0],this._repObjNeedUpdate=!1,i},doTransformManipulatedObjs:function(i,r,a){var o=r;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var l=this.getBaseCoord();if(l){var u=Kekule.CoordUtils.getDistance(o,l),c=Math.max(Math.round(u/this._deltaDistance),1);if(!this._lastDeltaCount||c!==this._lastDeltaCount){this._deltaCount=c;var d=this.getChainMaxAtomCount(),h=d?Math.min(d,c+1):c+1;this.getRepositoryItem().getAtomCount()!==h&&(this.getRepositoryItem().setAtomCount(h),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+h},!0)),this._lastDeltaCount=c}var p,g=this._calcRotateAngle(o),f=g&&g.angle,m=this.isInActualConstrainedRotation();if(m){var C=m?2*this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;p=Math.round(f/C)*C-f<0}else p=!1;this._isForceReversedChainDirection&&(p=!p),!!this.getRepositoryItem().getNegativeDirection()!==p&&(this.getRepositoryItem().setNegativeDirection(p),this._repObjNeedUpdate=!0)}}this._repObjNeedUpdate&&this._updateChain();var _=this.getCurrRepositoryObjects()[0];_.beginUpdate();try{var y=this.tryApplySuper("doTransformManipulatedObjs",[i,r,a]);this.updateAssocMarker(null,null,!1)}finally{_.endUpdate()}return y},react_pointermove:function(i){return this._isForceReversedChainDirection=!!i.getShiftKey(),this.tryApplySuper("react_pointermove",[i])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexChainIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolFlexRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolFlexRingIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setEnableSelect(!1),this._deltaDistance=null,this._lastDeltaCount=1,this._repObjStartingScreenCoord=null,this._repObjNeedUpdate=!1,this._manipulateObjInfoCache=[];var r=new Kekule.Editor.MolRingRepositoryItem2D(3);r.setEnableCoordCache(!0),this.setRepositoryItem(r)},getRingMaxAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMaxFlexRingAtomCount(),0)},getRingMinAtomCount:function(){return Math.max(this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount(),3)},getActualManipulatingObjects:function(i){var r=this.getCurrRepositoryObjects()[0];return r?s.clone(r.getNodes()):[]},manipulateEnd:function(){this._clearManipulateObjInfoCache(),this.tryApplySuper("manipulateEnd")},createManipulateObjInfo:function(i,r,a){var o=this.getRepositoryItem().getRingAtomCount(),l=this._getCachedManipulateObjInfo(r,o);if(l)return l;var u=this.tryApplySuper("createManipulateObjInfo",[i,r,a]);return this._setCachedManipulateObjInfo(u,r,o),u},_setCachedManipulateObjInfo:function(i,r,a){var o=this._manipulateObjInfoCache[a];o||(o=[],this._manipulateObjInfoCache[a]=o),o[r]=i},_getCachedManipulateObjInfo:function(i,r){var a=this._manipulateObjInfoCache[r];return a&&a[i]},_clearManipulateObjInfoCache:function(){this._manipulateObjInfoCache=[]},_calcStepDeltaDistance:function(){var i=this.getRepositoryItem().getBondLength(),r=this.getInitialTransformParams(),a=this.getEditor(),o=a.objCoordToScreen(Kekule.CoordUtils.transform2D({x:0,y:0},r)),l=a.objCoordToScreen(Kekule.CoordUtils.transform2D({x:i,y:0},r));return Kekule.CoordUtils.getDistance(o,l)/3},getRepObjCreationOptions:function(){return this._isUpdateRepObj?{originalStructFragment:this.getCurrRepositoryObjects()[0]}:null},addRepositoryObj:function(i,r,a){var o=this.tryApplySuper("addRepositoryObj",[i,r,a]);return this._deltaDistance=this._calcStepDeltaDistance(),this._repObjNeedUpdate=!1,o},insertRepositoryObjToEditor:function(i,r,a){if(!a){this._deltaDistance=null,this._lastDeltaCount=1;var o=this.getEditorConfigs().getStructureConfigs().getMinFlexRingAtomCount();this.getRepositoryItem().setRingAtomCount(o)}this._isUpdateRepObj=a;var l=this.tryApplySuper("insertRepositoryObjToEditor",[i,r]);if(l&&!a){var u=l.objects[0];this.initAssocMarker(),this.updateAssocMarker(this._getRingCenterAbsContextCoord(u),{text:""+o})}return l},updateAssocMarker:function(i,r,a){if(!i){var o=this._getManipulateObjsCenterCoord();i=this.getEditor().objCoordToContext(o)}return this.tryApplySuper("updateAssocMarker",[i,r,a])},_getRingCenterAbsContextCoord:function(i){var r=this.getEditor(),a=Kekule.Editor.StructureUtils.getStructureCenterAbsBaseCoord(i,r.getCoordMode(),r.getAllowCoordBorrow());return r.objCoordToContext(a)},_updateRing:function(){this._isUpdateRepObj=!0;var i=this.updateRepositoryObjInEditor();return this._repObjNeedUpdate=!1,i},doTransformManipulatedObjs:function(i,r,a){var o=r;if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.MANIPULATING){var l=this.getBaseCoord();if(l){var u=this.getRingMinAtomCount(),c=Kekule.CoordUtils.getDistance(o,l),d=Math.round(c/this._deltaDistance)+u;if(!this._lastDeltaCount||d!==this._lastDeltaCount){var h=this.getRingMaxAtomCount(),p=h?Math.min(h,d):d;p=u?Math.max(p,u):p,this.getRepositoryItem().getRingAtomCount()!==p&&(this.getRepositoryItem().setRingAtomCount(p),this._repObjNeedUpdate=!0,this.updateAssocMarker(null,{text:""+p},!0)),this._lastDeltaCount=d}}}this._repObjNeedUpdate&&this._updateRing();var g=this.getCurrRepositoryObjects()[0];g.beginUpdate();try{var f=this.tryApplySuper("doTransformManipulatedObjs",[i,r,a]);this.updateAssocMarker(null,null,!1)}finally{g.endUpdate()}return f}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolFlexRingIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolRingIaController=Class.create(Kekule.Editor.MolFlexStructureIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setRepositoryItem(new Kekule.Editor.MolRingRepositoryItem2D),this.setEnableSelect(!1),this._currBondOrders=null},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(i){this.getRepositoryItem().setRingAtomCount(i)}}),this.defineProp("isAromatic",{dataType:DataType.INT})},getActualManipulatingObjects:function(i){var r=this.getCurrRepositoryObjects()[0];return r?s.clone(r.getNodes()):[]},createNodeMergeOperation:function(i,r,a){var o=this.tryApplySuper("createNodeMergeOperation",[i,r,a]);return this.getIsAromatic()&&o&&o.setMergeConnectorPropsFromTarget&&o.setMergeConnectorPropsFromTarget(!0),o},manipulateBeforeStopping:function(){return this._currBondOrders&&this.useMergePreview()&&this._applyBondOrdersToSrcStruct(null,this._currBondOrders),this.tryApplySuper("manipulateBeforeStopping")},_mergeOperationsChanged:function(i,r,a){this.tryApplySuper("_mergeOperationsChanged",[i,r,a]);var o=this.getCurrRepositoryObjects(),l=o&&o[0];if(l){var u=this._getMergedDestObjs(l,i,r,a);this.updateRepStructureBondOrders(l,u,this.useMergePreview())}},createObjFromRepositoryItem:function(i,r){var a=this.tryApplySuper("createObjFromRepositoryItem",[i,r]);return this.updateRepStructureBondOrders(a.objects[0],null),this._currBondOrders=null,a},updateRepStructureBondOrders:function(i,r,a){if(this.getIsAromatic()){if(!i){var o=this.getCurrRepositoryObjects();i=o&&o[0]}r||(r={nodes:[],connectors:[],nodeCount:0,connectorCount:0});var l=this._calcSrcBondOrders(i,r),u=l.bondOrders,c=l.previewBondOrders;this._currBondOrders=u,this._applyBondOrdersToSrcStruct(i,a?c:u)}},_applyBondOrdersToSrcStruct:function(i,r){if(!i){var a=this.getCurrRepositoryObjects();i=a&&a[0]}var o=this.getEditor();try{o.beginUpdateObject(),i.beginUpdate();try{for(var l=0,u=i.getConnectorCount();l<u;++l){var c=i.getConnectorAt(l);if(c&&c.setBondOrder){var d=r[l];c.setBondOrder(d)}}}finally{i.endUpdate()}}finally{o.endUpdateObject()}},_getMergedDestObjs:function(i,r,a,o){var l=i;if(l){for(var u=function(C,_,y){for(var T=C.getConnectedChemNodes(),E=[],b=0,v=T.length;b<v;++b){var I=T[b],R=y[_.indexOf(I)];if(!R)return null;E.push(R)}if(E.length===2){var N=E[0].getLinkedConnectors();for(b=0,v=N.length;b<v;++b){var L=N[b],U=L.getConnectedChemNodes();if(U.length===2&&U.indexOf(E[1])>=0)return L}}return null},c={nodes:[],connectors:[],nodeCount:0,connectorCount:0},d=0,h=l.getNodeCount();d<h;++d){var p=l.getNodeAt(d),g=a.indexOf(p),f=g>=0?o[g]:null;c.nodes.push(f),f&&++c.nodeCount}for(d=0,h=l.getConnectorCount();d<h;++d){var m=u(l.getConnectorAt(d),l.getNodes(),c.nodes)||null;c.connectors.push(m),m&&++c.connectorCount}}return c},_calcSrcBondOrders:function(i,r){if(i&&i.getNodeCount()){r&&r.nodeCount;for(var a=i.getConnectors(),o=r.connectors,l=i.getNodes(),u=r.nodes,c=function(v){return v>Kekule.BondOrder.SINGLE&&v<=Kekule.BondOrder.QUAD},d=function(v){var I=v.getLinkedBonds(Kekule.BondType.COVALENT),R=!1;if(I.length){for(var N=0,L=I.length;N<L;++N)if(I[N].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC){R=!0;break}}return R},h=function(v,I){var R=v.getLinkedBonds(Kekule.BondType.COVALENT),N=s.exclude(R,I),L=!1;if((N=s.exclude(N,a)).length)for(var U=0,W=N.length;U<W;++U){var M=N[U].getBondOrder();if(c(M)){L=!0;break}}return L},p=function(v,I){var R=v.getLinkedBonds(Kekule.BondType.COVALENT),N=s.intersect(R,I),L=!1;if(N.length)for(var U=0,W=N.length;U<W;++U){var M=N[U].getBondOrder();if(c(M)){L=!0;break}}return L},g=function(v,I,R,N,L,U,W){var M,B,V=Kekule.BondOrder,J=v-1;J<0&&(J=I.length-1);var $,q=!!U[J],Q=q?U[J]:null,ie=I[v],Y=N[v],ne=Y&&Y.getBondOrder(),de=0;if(ne&&c(ne))M=[ne],B=[V.SINGLE],Q&&c(Q)&&++de;else if(q&&c(Q))M=[V.SINGLE];else{for(var Ae=ie.getConnectedChemNodes(),Ce=!1,pe=!1,fe=0,Te=Ae.length;fe<Te;++fe){var xe=L[R.indexOf(Ae[fe])];if(xe&&(Ce=h(xe,N),pe=p(xe,N),Ce||pe))break}M=Ce||pe?[V.SINGLE]:[V.DOUBLE,V.SINGLE]}for(fe=0,Te=M.length;fe<Te;++fe){var Re=M[fe];if(U[v]=Re,W[v]=B&&B[fe]||Re,v<I.length-1&&(de+=g(++v,I,R,N,L,U,W),(Kekule.ObjUtils.isUnset($)||$>de)&&($=de),de<=0))break}return de},f=[],m=[],C=!1,_=0,y=u.length;_<y;++_){var T=u[_];if(T&&d(T)){C=!0;break}}if(C){for(f=[],_=0,y=a.length;_<y;++_)f[_]=Kekule.BondOrder.EXPLICIT_AROMATIC;return f}for(_=0,y=o.length;_<y;++_){var E=o[_];if(E){var b=E.getBondOrder();c(b)&&(f[_]=b)}}return g(0,a,l,o,u,f,m),{bondOrders:f,previewBondOrders:m}}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolRingIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.PathGlyphIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.PathGlyphIaController",initialize:function(i){this.tryApplySuper("initialize",[i])},getDirectManipulateObjs:function(i,r){var a;if(i.length===1){var o=i[0];o.getNodeAt&&o.getNodeCount&&(o.getNodeCount(),o.getDirectManipulationTarget&&(a=o.getDirectManipulationTarget()))}return a||(a=this.tryApplySuper("getDirectManipulateObjs",[i,r])),a},getInsertedObjs:function(){return this.getCurrRepositoryObjects()}}),Kekule.Editor.ArrowLineIaController=Class.create(Kekule.Editor.PathGlyphIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setRepositoryItem(new Kekule.Editor.PathGlyphRepositoryItem2D)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(i){this.getRepositoryItem().setGlyphRefLength(i)}}),this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:!1,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(i){this.getRepositoryItem().setGlyphClass(i)}}),this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(i){this.getRepositoryItem().setGlyphInitialParams(i)}})},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function(i,r,a){return this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength()),this.tryApplySuper("addRepositoryObj",[i,r,a])}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ArrowLineIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.FormulaIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.FormulaIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this._operAddMol=null},initProperties:function(){this.defineProp("currMol",{dataType:DataType.OBJECT,serializable:!1}),this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(i){return!(!i||!this.isValidMol(i))},isValidMol:function(i){return i instanceof Kekule.StructureFragment&&i.hasFormula()&&!i.hasCtab()},getFormulaText:function(i){return i.hasFormula()?i.getFormula().getText():""},createNewMol:function(i,r){var a=this.getEditor();if(!a.canCreateNewChild()&&!(o=a.getOnlyOneBlankStructFragment()))return null;a.beginUpdateObject();try{if(!o)var o=new Kekule.Molecule;o.getFormula(!0),i.appendChild(o),a.setObjectScreenCoord(o,r);var l=new Kekule.ChemObjOperation.Add(o,i,null,a);this._operAddBlock=l}finally{a.endUpdateObject()}return o},getTextSetterWidget:function(i){var r=this.getTextSetter();if(!r&&i){var a=this.getEditor().getCoreElement(),o=a.ownerDocument;r=this._createTextSetterWidget(o,a),this.setTextSetter(r)}return r},_createTextSetterWidget:function(i,r){var a=new Kekule.Widget.TextBox(this.getEditor());a.addClassName(t.CHEMEDITOR_FORMULA_SETTER),a.appendToElem(r);var o=this;return a.addEventListener("keyup",function(l){var u=l.htmlEvent.getKeyCode();u===Kekule.X.Event.KeyCode.ENTER?(o.applySetter(a),a.dismiss()):u===Kekule.X.Event.KeyCode.ESC&&(a.dismiss(),o.cancelSetter())}),a.addEventListener("showStateChange",function(l){l.byDomChange||(l.isShown||l.isDismissed||o.applySetter(a),l.isShown&&(a._applied=!1))}),a},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(i,r){if(!i._applied){r||(r=this.getCurrMol());var a=i.getText();if(a)var o=new Kekule.ChemObjOperation.Modify(r.getFormula(),{text:a},this.getEditor());else this._operAddBlock?this.cancelSetter():o=new Kekule.ChemObjOperation.Remove(r,r.getParent(),null,this.getEditor());var l=this.getEditor();if(l&&o){l.beginManipulateAndUpdateObject();try{if(o.execute(),l.getEnableOperHistory()){if(this._operAddBlock){var u=new Kekule.MacroOperation;u.add(this._operAddBlock),u.add(o),l.pushOperation(u),this._operAddBlock=null}else l.pushOperation(o);this.doneInsertOrModifyBasicObjects([r])}}finally{l.endManipulateAndUpdateObject()}}i._applied=!0}},openSetterUi:function(i,r){var a=this.getTextSetter();if(a&&a.isShown()&&(this.applySetter(a,this.getCurrMol()),a.hide(),a._haltPrevShowHideProcess()),r||(r=this.createNewMol(this.getEditor().getChemObj(),i)),this.isValidMol(r)){this.setCurrMol(r),this.getEditor().setSelection([r]);var o=r.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();o*=this.getEditor().getZoom()||1;var l=r.getCascadedRenderOption("fontFamily")||"",u=this.getFormulaText(r),c=this.getTextSetterWidget(!0),d=this.getEditor().getCoreElement();c.appendToElem(d);var h=u||"";c.setValue(h);var p=c.getElement().style;p.position="absolute",p.fontSize=o+"px",p.left=i.x+"px",p.top=i.y+"px",p.fontFamily=l,c._applied=!1,c.setStandaloneOnShowHide(!0),c.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),c.selectAll(),c.focus()}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var r,a=this._getEventMouseCoord(i),o=this.getTopmostInteractableObjAtScreenCoord(a);r=o;var l,u=o&&this.getEditor().getChemObjBounds(o),c=u&&u[0];return l=c&&c.boundInfo?c.boundInfo.coords[0]:a,i.preventDefault(),i.stopPropagation(),this.openSetterUi(l,r),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.FormulaIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.ContentBlockIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.ContentBlockIaController",initialize:function(i){this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:!1})},canInteractWithObj:function(i){return i&&this.isValidBlock(i)},isValidBlock:function(i){return i instanceof Kekule.ContentBlock},execute:function(i,r,a){},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MouseButton.LEFT){this.getEditor().setSelection(null);var r=this._getEventMouseCoord(i),a=this.getTopmostInteractableObjAtScreenCoord(r),o=a?this.getEditor().getObjectScreenCoord(a):r;return i.preventDefault(),i.stopPropagation(),this.execute(this.getEditor().getChemObj(),o,a),!0}}}),Kekule.Editor.TextBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this._operAddBlock=null},initProperties:function(){this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:!1})},isValidBlock:function(i){return i instanceof Kekule.TextBlock},createNewBlock:function(i,r){var a=this.getEditor();if(!a.canCreateNewChild())return null;a.beginUpdateObject();try{var o=new Kekule.TextBlock;if(o){i.appendChild(o),a.setObjectScreenCoord(o,r,Kekule.Render.CoordPos.CORNER_TL);var l=new Kekule.ChemObjOperation.Add(o,i,null,a);this._operAddBlock=l}}finally{a.endUpdateObject()}return o},getBlockText:function(i){return i.getText()},execute:function(i,r,a){this.openSetterUi(r,a)},getTextSetterWidget:function(i){var r=this.getTextSetter();if(!r&&i){var a=this.getEditor().getCoreElement(),o=a.ownerDocument;r=this._createTextSetterWidget(o,a),this.setTextSetter(r)}return r},_createTextSetterWidget:function(i,r){var a=new Kekule.Widget.TextArea(this.getEditor());a.setAutoSizeX(!0),a.setAutoSizeY(!0),a.setDisplayed(!1),a.addClassName(t.CHEMEDITOR_TEXT_SETTER),a.appendToElem(r);var o=this;return a.addEventListener("keyup",function(l){var u=l.htmlEvent,c=u.getKeyCode();c===Kekule.X.Event.KeyCode.ENTER&&u.getCtrlKey()?(o.applySetter(a),a.dismiss()):c===Kekule.X.Event.KeyCode.ESC&&(a.dismiss(),o.cancelSetter())}),a.addEventListener("showStateChange",function(l){l.byDomChange||(l.isShown||l.isDismissed||o.applySetter(a),l.isShown&&(a._applied=!1))}),a},cancelSetter:function(){this._operAddBlock&&(this._operAddBlock.reverse(),this._operAddBlock=null)},applySetter:function(i,r){if(!i._applied){r||(r=this.getCurrBlock());var a,o=i.getText();o?a=new Kekule.ChemObjOperation.Modify(r,{text:o},this.getEditor()):this._operAddBlock?this.cancelSetter():a=new Kekule.ChemObjOperation.Remove(r,r.getParent(),null,this.getEditor());var l=this.getEditor();if(a&&l){l.beginManipulateAndUpdateObject();try{if(a.execute(),l.getEnableOperHistory())if(this._operAddBlock){var u=new Kekule.MacroOperation;u.add(this._operAddBlock),u.add(a),l.pushOperation(u),this._operAddBlock=null}else l.pushOperation(a)}finally{l.endManipulateAndUpdateObject()}this.doneInsertOrModifyBasicObjects([r])}i._applied=!0}},openSetterUi:function(i,r){var a=this.getTextSetter();if(a&&a.isShown()&&(this.applySetter(a,this.getCurrBlock()),a._haltPrevShowHideProcess()),r||(r=this.createNewBlock(this.getEditor().getChemObj(),i)),this.isValidBlock(r)){this.setCurrBlock(r);var o=this.getEditor().getObjectScreenCoord(r,Kekule.Render.CoordPos.CORNER_TL),l=r.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();l*=this.getEditor().getZoom()||1;var u=r.getCascadedRenderOption("fontFamily")||"",c=this.getBlockText(r),d=this.getTextSetterWidget(!0);d._applied=!1,d.setValue(c);var h=c||Kekule.$L("ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT");d.setPlaceholder(h);var p=this.getEditor().getCoreElement();d.appendToElem(p);var g=d.getElement().style;g.position="absolute",g.fontSize=l+"px",g.left=o.x+"px",g.top=o.y+"px",g.fontFamily=u,g.opacity=1,d.setStandaloneOnShowHide(!0),d.show(this.getEditor(),null,Kekule.Widget.ShowHideType.POPUP),(function(){d.selectAll(),d.focus()}).defer()}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.TextBlockIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.ImageBlockIaController=Class.create(Kekule.Editor.ContentBlockIaController,{CLASS_NAME:"Kekule.Editor.ImageBlockIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this._operAddBlock=null,this._imgProbeElem=null,this._actionOpenFile=this.createOpenAction()},doFinalize:function(){this._actionOpenFile&&this.actionOpenFile.finalize()},initProperties:function(){},isValidBlock:function(i){return i instanceof Kekule.ImageBlock},createNewBlock:function(i,r,a,o){var l=this.getEditor();if(!l.canCreateNewChild())return null;l.beginUpdateObject();try{var u=new Kekule.ImageBlock;o&&u.setSrc(o),a&&u.setSize2D(a),l.setObjectScreenCoord(u,r,Kekule.Render.CoordPos.CORNER_TL);var c=new Kekule.ChemObjOperation.Add(u,i,null,l);this._operAddBlock=c}finally{l.endUpdateObject()}return u},_getImgFilters:function(){return[{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_PNG"),filter:".png"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_JPG"),filter:".jpg,.jpeg"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_GIF"),filter:".gif"},{title:Kekule.$L("WidgetTexts.TITLE_IMG_FORMAT_SVG"),filter:".svg"},Kekule.NativeServices.FILTER_ALL_SUPPORT,Kekule.NativeServices.FILTER_ANY]},createOpenAction:function(){var i=new Kekule.ActionFileOpen;return i.setFilters(this._getImgFilters()),i.on("open",this.reactImageFileOpen,this),i},reactImageFileOpen:function(i){var r=i.file;if(r){var a=this,o=new FileReader;o.addEventListener("load",function(){var l=a._getImageProbeElem();l.ownerDocument;try{delete l.width,delete l.height}catch{}l.src=o.result;var u=a.getEditor();(function(){if((g={x:l.width,y:l.height}).x<=0||g.y<=0)Kekule.error(Kekule.$L("ErrorMsg.INVALID_OR_EMPTY_IMAGE"));else{var c=a._currCoord,d=u.objCoordToContext(c),h=Kekule.CoordUtils.add(d,g),p=u.contextCoordToObj(h),g=Kekule.CoordUtils.substract(p,c);g=Kekule.CoordUtils.absValue(g);var f,m=a.getCurrBlock(),C=u.getChemObj();if(m)f=new Kekule.ChemObjOperation.Modify(m,{src:o.result,size2D:g});else{var _=a.createNewBlock(a.getEditor().getChemObj(),a._currCoord,g,o.result);a.setCurrBlock(_),f=new Kekule.ChemObjOperation.Add(_,C,null,u)}if(f){u.beginManipulateAndUpdateObject();try{f.execute(),u&&u.getEnableOperHistory()&&u.pushOperation(f),a.doneInsertOrModifyBasicObjects([a.getCurrBlock()])}finally{u.endManipulateAndUpdateObject()}}}}).defer()}),o.readAsDataURL(r)}},_getImageProbeElem:function(){if(!this._imgProbeElem){var i=this.getEditor().getElement().ownerDocument;this._imgProbeElem=i.createElement("img")}return this._imgProbeElem},execute:function(i,r,a){this.setCurrBlock(a),this._currCoord=r,this._actionOpenFile.execute(this.getEditor())}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.ImageBlockIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.AttachedMarkerIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.AttachedMarkerIaController",initialize:function(i){this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("markerClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("targetClass",{dataType:DataType.CLASS,serializable:!1}),this.defineProp("markerClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getMarkerClass())},setter:function(i){this.setMarkerClass(ClassEx.findClass(i))}}),this.defineProp("targetClassName",{dataType:DataType.STRING,getter:function(){return ClassEx.getClassName(this.getTargetClass())},setter:function(i){this.setTargetClass(ClassEx.findClass(i))}}),this.defineProp("initialPropValues",{dataType:DataType.HASH})},canInteractWithObj:function(i){return this.isValidTarget(i)},isValidTarget:function(i){var r=this.getTargetClass();return i instanceof r||!r},createMarker:function(){var i,r=this.getMarkerClass();if(r){i=new r;var a=this.getInitialPropValues();a&&i&&i.setPropValues&&i.setPropValues(a)}return i},createOperations:function(i){var r,a=this.createMarker();return a&&(r=new Kekule.ChemObjOperation.Add(a,i,null,this.getEditor())),[r]},apply:function(i){var r=this.createOperations(i),a=r.length<=0?null:r.length===1?r[0]:new Kekule.MacroOperation(r);if(a){a.execute();var o=this.getEditor();o&&o.getEnableOperHistory()&&o.pushOperation(a)}},react_pointerup:function(i){if(i.getButton()===Kekule.X.Event.MouseButton.LEFT){var r=this._getEventMouseCoord(i),a=this.getEditor().getTopmostBoundInfoAtCoord(r,null,this.getCurrBoundInflation());if(a){var o=a.obj;return this.isValidTarget(o)&&(this.apply(o),i.preventDefault(),i.stopPropagation()),!0}}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.AttachedMarkerIaController,Kekule.Editor.ChemSpaceEditor),Kekule.Editor.MolNodeChargeIaController=Class.create(Kekule.Editor.AttachedMarkerIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("charge",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("radical",{dataType:DataType.INT,serializable:!1}),this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setTargetClass(Kekule.ChemStructureNode)},createOperations:function(i){var r=!1,a=!1,o={},l=i.getCharge();Kekule.ObjUtils.notUnset(this.getCharge())?l!==this.getCharge()&&(o.charge=this.getCharge(),r=!0):this.getChargeInc()&&(l+=this.getChargeInc(),o.charge=l,r=!0);var u=i.getRadical();this.getRadical()!==u&&(o.radical=this.getRadical(),a=!0);var c,d,h=[],p=[],g=this.getEditor();if(r){var f=i.fetchChargeMarker(!1);o.charge===0||f||((c=new Kekule.ChemMarker.Charge).setValue(o.charge),p.push(new Kekule.ChemObjOperation.Add(c,i,null,g))),o.charge===0&&f&&p.push(new Kekule.ChemObjOperation.Remove(f,null,null,g))}if(a){var m=i.fetchRadicalMarker(!1);o.radical===0||m||((c=new Kekule.ChemMarker.Radical).setValue(o.radical),p.push(new Kekule.ChemObjOperation.Add(c,i,null,g))),o.radical===0&&m&&p.push(new Kekule.ChemObjOperation.Remove(m,null,null,g))}return h=h.concat(p),(r||a)&&(d=new Kekule.ChemObjOperation.Modify(i,o,this.getEditor()),h.push(d)),h}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolNodeChargeIaController,Kekule.Editor.ChemSpaceEditor)}(),function(){Kekule.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.EditorNexus",initialize:function(s){this.tryApplySuper("initialize"),this._currInvoker=null,s&&(s.editor&&this.setEditor(s.editor),s.structureTreeView&&this.setStructureTreeView(s.structureTreeView),s.objectInspector&&this.setObjectInspector(s.objectInspector),s.issueInspector&&this.setIssueInspector(s.issueInspector))},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:function(s){var e=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",s),this.editorChanged(s,e)}}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:function(s){var e=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",s),this.structureTreeViewChanged(s,e)}}),this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:function(s){var e=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",s),this.objectInspectorChanged(s,e)}}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:function(s){var e=this.getPropStoreFieldValue("issueInspector");this.setPropStoreFieldValue("issueInspector",s),this.issueInspectorChanged(s,e)}})},editorChanged:function(s,e){e&&this._uninstallEditorEventHandler(e),s&&this._installEditorEventHandler(s)},structureTreeViewChanged:function(s,e){e&&this._uninstallStructureTreeViewEventHandler(e),s&&(this._installStructureTreeViewEventHandler(s),this._updateByEditor())},objectInspectorChanged:function(s,e){var t=this.getEditor();t&&(e&&e.getOperHistory()===t.getOperHistory()&&(this._uninstallObjInspectorEventHandler(e),e.setOperHistory(null)),s&&(s.setOperHistory(t.getOperHistory()),s.setEnableOperHistory(t.getEnableOperHistory()),this._installObjInspectorEventHandler(s),this._updateByEditor()))},issueInspectorChanged:function(s,e){e&&this._uninstallIssueInspectorEventHandler(e),s&&this._installIssueInspectorEventHandler(s),this.getEditor()&&s&&this._updateByEditor()},_installEditorEventHandler:function(s){s.addEventListener("change",this._reactEditorChanged,this),s.addEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),s.addEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_uninstallEditorEventHandler:function(s){s.removeEventListener("change",this._reactEditorChanged,this),s.removeEventListener("beginUpdateObject",this._reactEditorBeginUpdateObject,this),s.removeEventListener("endUpdateObject",this._reactEditorEndUpdateObject,this)},_installStructureTreeViewEventHandler:function(s){s.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(s){s.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_installObjInspectorEventHandler:function(s){s.addEventListener("propertyChange",this._reactObjInspectorPropertyChange,this)},_uninstallObjInspectorEventHandler:function(s){s.removeEventListener("propertyChange",this._reactObjInspectorPropertyChange,this)},_installIssueInspectorEventHandler:function(s){s.addEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_uninstallIssueInspectorEventHandler:function(s){s.removeEventListener("selectResult",this._reactIssueInspectorSelectResult,this)},_reactEditorChanged:function(s){if(!this._currInvoker){var e=s.target;if(e===this.getEditor()){var t=s.changedPropNames;if(t.indexOf("chemObj")>=0&&this.changeRootObj(e.getChemObj(),e),t.indexOf("selection")>=0&&this.changeSelection(e.getSelection(),e),t.indexOf("operHistory")>=0||t.indexOf("enableOperHistory")>=0){var n=this.getObjectInspector();n&&(n.setOperHistory(e.getOperHistory()),n.setEnableOperHistory(e.getEnableOperHistory()))}var i=this.getIssueInspector();i&&(t.indexOf("issueCheckExecutor")>=0&&i.setIssueCheckExecutor(e.getIssueCheckExecutor()),t.indexOf("issueCheckResults")>=0&&i.setCheckResults(e.getIssueCheckResults()))}}},_reactEditorBeginUpdateObject:function(s){this.pauseLiveUpdate()},_reactEditorEndUpdateObject:function(s){this.resumeLiveUpdate()},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory","issueCheckExecutor","issueCheckResults"]})},_reactStructureTreeViewChanged:function(s){if(!this._currInvoker){var e=s.target;if(e===this.getStructureTreeView()&&s.changedPropNames.indexOf("selection")>=0){var t=e.getSelectedChemObjs();this.changeSelection(t,e)}}},_reactIssueInspectorSelectResult:function(s){var e=s.selectedResult,t=this.getEditor();t&&t.setActiveIssueCheckResult&&t.setActiveIssueCheckResult(e)},_reactObjInspectorPropertyChange:function(s){var e=this.getEditor();e&&e.notifyUserModificationDone&&e.notifyUserModificationDone()},pauseLiveUpdate:function(){var s=this.getStructureTreeView();s&&s.pauseLiveUpdate()},resumeLiveUpdate:function(){var s=this.getStructureTreeView();s&&s.resumeLiveUpdate()},changeSelection:function(s,e){this._currInvoker=e;try{var t=this.getEditor();t&&this._currInvoker!==t&&t.setSelection(s);var n=this.getStructureTreeView();n&&this._currInvoker!==n&&n.selectChemObjs(s);var i=this.getObjectInspector();i&&this._currInvoker!==i&&i.setObjects(s)}finally{this._currInvoker=null}},changeRootObj:function(s,e){this._currInvoker=e;try{var t=this.getEditor();t&&this._currInvoker!==t&&t.setChemObj(s);var n=this.getStructureTreeView();n&&this._currInvoker!==n&&n.setRootObj(s);var i=this.getIssueInspector();i&&this._currInvoker!==i&&i.setRootObj(s)}finally{this._currInvoker=null}}})}(),function(){var s=Kekule.ArrayUtils,e=Kekule.ChemWidget.ComponentWidgetNames,t=Kekule.ChemWidget.HtmlClassNames,n=(Kekule.ActionManager,[]);function i(){(function(){for(var r=["C","H","O","N","P","S","Si","F","Cl","Br","I","B","K","Na","D"],a=["methyl","ethyl","phenyl","Ac","TMS","COOCH3","OTs"],o=Kekule.Editor.ActionOperationCreate.ChemNodeModify,l=Kekule.Editor.createEditorOperationCreateActionClass,u=0,c=r.length;u<c;++u)l(null,h="atom_"+r[u],o,{nodeClass:Kekule.Atom,props:{isotopeId:r[u]}});for(u=0,c=a.length;u<c;++u){var d=a[u],h="subgroup_"+d,p=Kekule.Editor.RepositoryItemManager.getItem(d),g=p.getStructureFragment&&p.getStructureFragment();g&&l(null,h,o,{nodeClass:g.getClass(),repositoryItem:p})}l(null,"subgroup_R",o,{nodeClass:Kekule.SubGroup}),l(null,"atom_variable",o,{nodeClass:Kekule.VariableAtom}),l(null,"atom_dummy",o,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY}}),l(null,"atom_hetero",o,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO}}),l(null,"atom_any",o,{nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY}})})(),function(){for(var r=Kekule.BondType,a=Kekule.BondOrder,o=Kekule.BondStereo,l={single:{bondType:r.COVALENT,bondOrder:a.SINGLE,stereo:o.NONE},double:{bondType:r.COVALENT,bondOrder:a.DOUBLE,stereo:o.NONE},triple:{bondType:r.COVALENT,bondOrder:a.TRIPLE,stereo:o.NONE},quad:{bondType:r.COVALENT,bondOrder:a.QUAD,stereo:o.NONE},up:{bondType:r.COVALENT,bondOrder:a.SINGLE,stereo:o.UP},down:{bondType:r.COVALENT,bondOrder:a.SINGLE,stereo:o.DOWN},closer:{bondType:r.COVALENT,bondOrder:a.SINGLE,stereo:o.CLOSER},upOrDown:{bondType:r.COVALENT,bondOrder:a.SINGLE,stereo:o.UP_OR_DOWN}},u=Kekule.Editor.ActionOperationCreate.ChemConnectorModify,c=Kekule.Editor.createEditorOperationCreateActionClass,d=Kekule.ObjUtils.getOwnedFieldNames(l),h=0,p=d.length;h<p;++h)c(null,"bond_"+d[h],u,l[d[h]])}()}Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_SELECT_ALL:"K-Chem-SelectAll",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_SELECT:"K-Chem-Toggle-Select-State",ACTION_ERASE_SELECTION:"K-Chem-Erase-Selection",ACTION_RECHECK_ISSUES:"K-Chem-Recheck-Issues",ACTION_TOGGLE_OBJ_INSPECTOR:"K-Chem-Toggle-ObjInspector",ACTION_TOGGLE_ISSUE_INSPECTOR:"K-Chem-Toggle-IssueInspector",ACTION_TOGGLE_SHOW_ISSUES:"K-Chem-Toggle-ShowIssues"}),Object.extend(Kekule.ChemWidget.ComponentWidgetNames,{manipulateMarquee:"manipulateMarquee",manipulateLasso:"manipulateLasso",manipulateBrush:"manipulateBrush",manipulateAncestor:"manipulateAncestor",molBondSingle:"bondSingle",molBondDouble:"bondDouble",molBondTriple:"bondTriple",molBondCloser:"bondCloser",molBondWedgeUp:"bondWedgeUp",molBondWedgeDown:"bondWedgeDown",molBondWedgeUpOrDown:"bondWedgeUpOrDown",molBondDoubleEither:"bondDoubleEither",molChargeClear:"chargeClear",molChargePositive:"chargePositive",molChargeNegative:"chargeNegative",molRadicalSinglet:"radicalSinglet",molRadicalTriplet:"radicalTriplet",molRadicalDoublet:"radicalDoublet",molElectronLonePair:"electronLonePair",molChain:"chain",molRing3:"ring3",molRing4:"ring4",molRing5:"ring5",molRing6:"ring6",molRing7:"ring7",molRing8:"ring8",molRingAr6:"ringAr6",molRingAr5:"ringAr5",molFlexRing:"flexRing",molRepCyclopentaneHaworth1:"repCyclopentaneHaworth1",molRepCyclopentaneHaworth2:"repCyclopentaneHaworth2",molRepCyclohexaneHaworth1:"repCyclohexaneHaworth1",molRepCyclohexaneHaworth2:"repCyclohexaneHaworth2",molRepCyclohexaneChair1:"repCyclohexaneChair1",molRepCyclohexaneChair2:"repCyclohexaneChair2",molRepSubBondMark:"subBondMark",molRepMethane:"methane",molRepFischer1:"repFischer1",molRepFischer2:"repFischer2",molRepFischer3:"repFischer3",molRepSawhorseStaggered:"repSawhorseStaggered",molRepSawhorseEclipsed:"repSawhorseEclipsed",glyphRepLine:"repLine",glyphRepOpenArrowLine:"repOpenArrowLine",glyphRepTriangleArrowLine:"repTriangleArrowLine",glyphRepDiOpenArrowLine:"repDiOpenArrowLine",glyphRepDiTriangleArrowLine:"repDiTriangleArrowLine",glyphRepReversibleArrowLine:"repReversibleArrowLine",glyphRepOpenArrowDiLine:"repOpenArrowDiLine",glyphRepOpenArrowArc:"repOpenArrowArc",glyphRepSingleSideOpenArrowArc:"repSingleSideOpenArrowArc",glyphRepHeatSymbol:"repHeatSymbol",glyphRepAddSymbol:"repAddSymbol",glyphElectronPushingArrow:"repElectronPushingArrow",glyphElectronPushingArrowDouble:"repElectronPushingArrowDouble",glyphElectronPushingArrowSingle:"repElectronPushingArrowSingle",glyphElectronPushingArrowBondForming:"repElectronPushingArrowBondForming",glyphRepSegment:"repGlyphSegment",glyphReactionArrowNormal:"repGlyphReactionArrowNormal",glyphReactionArrowReversible:"glyphReactionArrowReversible",glyphReactionArrowResonance:"glyphReactionArrowResonance",glyphReactionArrowRetrosynthesis:"glyphReactionArrowRetrosynthesis"}),Kekule.Editor.ActionOperUtils={getObjsCenterScreenCoord:function(r,a){for(var o=Kekule.BoxUtils,l=Kekule.CoordUtils,u=null,c=0,d=a.length;c<d;++c){var h=Kekule.Render.ObjUtils.getContainerBox(a[c],r.getCoordMode(),r.getAllowCoordBorrow());u=u?o.getContainerBox(h,u):h}var p=o.getMinMaxCoords(u),g={min:r.objCoordToScreen(p.min),max:r.objCoordToScreen(p.max)},f=l.add(g.min,g.max);return f=l.divide(f,2)},addObjectsToChemSpaceEditor:function(r,a,o){var l,u,c,d=Object.extend({autoAdjustPosition:!0},o),h=r.getChemSpace&&r.getChemSpace();if(r&&h&&r.canAddNewStandaloneObject&&r.canAddNewStandaloneObject()){for(var p=[],g=0,f=a.length;g<f;++g){var m=(l=a[g],u=void 0,c=void 0,u=[],(c=h)&&l&&(u=l.getClass()===c.getClass()||l instanceof Kekule.ChemSpace?s.clone(l.getChildren()):[l]),u);m&&m.length&&s.pushUnique(p,m)}r.beginManipulateAndUpdateObject();try{var C=new Kekule.MacroOperation;for(g=0,f=p.length;g<f;++g){var _=p[g],y=new Kekule.ChemObjOperation.Add(_,h,null,r);C.add(y)}C.execute();var T=d.screenCoordOffset;if(!T&&d.autoAdjustPosition){var E=r.getClientVisibleRect(),b={x:E.left+E.width/2,y:E.top+E.height/2},v=this.getObjsCenterScreenCoord(r,p);T=Kekule.CoordUtils.substract(b,v)}if(T)for(g=0,f=p.length;g<f;++g){_=p[g];var I=r.getObjectScreenCoord(_),R=Kekule.CoordUtils.add(I,T);r.setObjectScreenCoord(_,R)}r.pushOperation(C),d.autoSelect&&r.select(p)}finally{r.endManipulateAndUpdateObject()}}}},Kekule.Editor.ActionOnEditor=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function(r,a,o){this.tryApplySuper("initialize",[r,a,o])},initProperties:function(){this.defineProp("explicitGroup",{dataType:DataType.STRING})},getPreferredWidgetClass:function(){return null},doUpdate:function(){var r=this.getDisplayer();this.setEnabled(r&&r.getChemObj()&&r.getChemObjLoaded()&&r.getEnabled())},getEditor:function(){var r=this.getDisplayer();return r instanceof Kekule.Editor.BaseEditor?r:null}}),Kekule.Editor.ActionEditorUndo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:t.ACTION_UNDO,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_UNDO"),Kekule.$L("ChemWidgetTexts.HINT_UNDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canUndo())},doExecute:function(){var r=this.getEditor();r&&r.undo()}}),Kekule.Editor.ActionEditorRedo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:t.ACTION_REDO,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_REDO"),Kekule.$L("ChemWidgetTexts.HINT_REDO")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getEnableOperHistory()&&this.getEditor().canRedo())},doExecute:function(){var r=this.getEditor();r&&r.redo()}}),Kekule.Editor.ActionEditorNewDoc=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:t.ACTION_NEWDOC,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_NEWDOC"),Kekule.$L("ChemWidgetTexts.HINT_NEWDOC")])},doUpdate:function(){var r=this.getDisplayer();this.setEnabled(r&&r.getEnabled()&&r.getEnableCreateNewDoc())},doExecute:function(){var r=this.getEditor();r&&r.newDoc()}}),Kekule.Editor.ActionEditorLoadData=Class.create(Kekule.ChemWidget.ActionDisplayerLoadData,{CLASS_NAME:"Kekule.Editor.ActionEditorLoadData",initialize:function(r){this.tryApplySuper("initialize",[r])},initProperties:function(){this.defineProp("enableAppend",{dataType:DataType.BOOL})},doExecute:function(r){var a=this.getDataDialog();return a&&a.setDisplayAppendCheckBox&&a.setDisplayAppendCheckBox(this._isEditorRootObjAppendable()&&!this._isEditorEmpty()),this.tryApplySuper("doExecute",[r])},_getEditorRootObj:function(){return this.getDisplayer().getChemObj()},_isEditorRootObjAppendable:function(){var r=this.getDisplayer(),a=this._getEditorRootObj();return a&&a instanceof Kekule.ChemSpace&&r.canAddNewStandaloneObject&&r.canAddNewStandaloneObject()&&r.getAllowAppendDataToCurr&&r.getAllowAppendDataToCurr()},_isEditorEmpty:function(){var r=this._getEditorRootObj();return!r||r.getChildCount&&r.getChildCount()===0},createDataDialog:function(){var r=this.getDisplayer().getDocument();return new Kekule.ChemWidget.LoadOrAppendDataDialog(r)},doLoadInDisplayer:function(r,a,o){var l=r||this.getDisplayer();if(!o.getIsAppending()||this._isEditorEmpty()||!this._isEditorRootObjAppendable())return this.tryApplySuper("doLoadInDisplayer",[r,a,o]);var u=this._getEditorRootObj();l.loadFromData(a.data,a.mimeType,a.fileName,a.formatId,function(c){if(c){l.beginUpdateObject();try{u.beginUpdate();try{Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(l,[c],{autoSelect:!0})}finally{u.endUpdate()}}finally{l.endUpdateObject()}}})}}),Kekule.Editor.ActionSelectAll=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionSelectAll",HTML_CLASSNAME:t.ACTION_SELECT_ALL,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_SELECT_ALL"),Kekule.$L("ChemWidgetTexts.HINT_SELECT_ALL")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().getChemObj())},doExecute:function(){this.getEditor().selectAll()}}),Kekule.Editor.ActionCloneSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:t.ACTION_CLONE_SELECTION,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_CLONE_SELECTION"),Kekule.$L("ChemWidgetTexts.HINT_CLONE_SELECTION")])},_hasCloneMethod:function(){var r=this.getEditor();return r&&r.cloneSelection},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection()),this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var r=this.getEditor();if(r&&r.getChemSpace){var a=r.getDefaultCloneScreenCoordOffset&&r.getDefaultCloneScreenCoordOffset(),o=r.cloneSelection();Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(r,o,{screenCoordOffset:a,autoSelect:!0})}}}),Kekule.Editor.ActionCopySelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:t.ACTION_COPY,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_COPY"),Kekule.$L("ChemWidgetTexts.HINT_COPY")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var r=this.getEditor(),a=r.getChemSpace&&r.getChemSpace();if(r&&a){var o=r.cloneSelection(),l=new Kekule.IntermediateChemSpace;try{l.appendChildren(o),Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[l])}finally{l.finalize()}}}}),Kekule.Editor.ActionCutSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:t.ACTION_CUT,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_CUT"),Kekule.$L("ChemWidgetTexts.HINT_CUT")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var r=this.getEditor(),a=r.getChemSpace&&r.getChemSpace();if(r&&a){var o=r.cloneSelection(),l=new Kekule.IntermediateChemSpace;try{l.appendChildren(o),Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,[l])}finally{l.finalize()}var u=r.getIaController("BasicMolEraserIaController");u&&u.removeSelection()}}}),Kekule.Editor.ActionPaste=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:t.ACTION_PASTE,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_PASTE"),Kekule.$L("ChemWidgetTexts.HINT_PASTE")]),Kekule.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function(){Kekule.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this),this.tryApplySuper("finalize")},_reactClipboardChange:function(){this.update()},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(Kekule.Widget.clipboard.hasData(Kekule.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())},getObjsCenterScreenCoord:function(r,a){return Kekule.Editor.ActionOperUtils.getObjsCenterScreenCoord(r,a)},doExecute:function(){var r=this.getEditor();if(r&&r.getChemSpace){var a,o,l=Kekule.Widget.clipboard.getObjects(Kekule.IO.MimeType.JSON);l.length===1&&l[0]instanceof Kekule.IntermediateChemSpace?(a=l[0],o=s.clone(a.getChildren()),a.removeChildren(o)):o=l,a&&a.finalize();var u=null,c=r.getSelection();if(c&&c.length){u=r.getDefaultCloneScreenCoordOffset?r.getDefaultCloneScreenCoordOffset():null;var d=s.clone(c);if(d&&d.length&&u){var h=this.getObjsCenterScreenCoord(r,d),p=this.getObjsCenterScreenCoord(r,o),g=Kekule.CoordUtils.substract(h,p);u=Kekule.CoordUtils.add(u,g)}}Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(r,o,{screenCoordOffset:u,autoSelect:!0})}}}),Kekule.Editor.ActionToggleSelectState=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleSelectState",HTML_CLASSNAME:t.ACTION_TOGGLE_SELECT,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SELECT"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SELECT")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate"),this.setChecked(this.getEditor().getIsToggleSelectOn())},checkedChanged:function(){this.tryApplySuper("checkedChanged")},doExecute:function(r,a){this.tryApplySuper("doExecute",[r,a]);var o=this.getChecked();this.getEditor().setIsToggleSelectOn(!o),this.setChecked(!o)}}),Kekule.Editor.ActionEraseSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEraseSelection",HTML_CLASSNAME:t.ACTION_ERASE_SELECTION,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_ERASE_SELECTION"),Kekule.$L("ChemWidgetTexts.HINT_ERASE_SELECTION")])},doUpdate:function(){this.tryApplySuper("doUpdate"),this.getEnabled()&&this.setEnabled(this.getEditor().hasSelection())},doExecute:function(){var r=this.getEditor();if(r){var a=r.getIaController("BasicMolEraserIaController");a&&a.removeSelection()}}}),Kekule.Editor.ActionRecheckIssues=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionRecheckIssues",HTML_CLASSNAME:t.ACTION_RECHECK_ISSUES,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_RECHECK_ISSUES"),Kekule.$L("ChemWidgetTexts.HINT_RECHECK_ISSUES")])},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getEditor();this.setEnabled(r.getEnableIssueCheck()).setDisplayed(r.getEnableIssueCheck())},doExecute:function(r,a){this.tryApplySuper("doExecute",[r,a]);var o=this.getEditor();o&&o.checkIssues()}}),Kekule.Editor.ActionToggleShowIssueMarkers=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionToggleShowIssueMarkers",HTML_CLASSNAME:t.ACTION_TOGGLE_SHOW_ISSUES,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_SHOW_ISSUE_MARKERS"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_SHOW_ISSUE_MARKERS")]),this.setExplicitGroup("")},getPreferredWidgetClass:function(){return Kekule.Widget.CheckButton},doUpdate:function(){this.tryApplySuper("doUpdate");var r=this.getEditor();this.setChecked(r.getShowAllIssueMarkers()),this.setEnabled(r.getEnableIssueCheck()).setDisplayed(r.getEnableIssueCheck())},doExecute:function(r,a){this.tryApplySuper("doExecute",[r,a]);var o=this.getChecked();this.getEditor().setShowAllIssueMarkers(!o),this.setChecked(!o)}}),Kekule.Editor.ActionOperationCreate={},Kekule.Editor.ActionOperationCreate.Base=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.Base",initialize:function(r){this.tryApplySuper("initialize",[r])},applicable:function(r){var a=this.getOperationTargets();if(a&&a.length){for(var o=this.getData(),l=0,u=a.length;l<u;++l)if(this.applicableOnTarget(a[l],o,r))return!0;return!1}return!1},applicableOnTarget:function(r,a,o){return!1},getOperationTargets:function(r){return[]},getData:function(){return this.ACTION_DATA||{}},createOperations:function(r){for(var a=this.getOperationTargets(r),o=this.getData(),l=[],u=0,c=a.length;u<c;++u){var d=a[u];if(this.applicableOnTarget(d,o,r)){var h=this.doCreateOperationOnTarget(d,o,r);h&&l.push(h)}}return l},doCreateOperationOnTarget:function(r,a,o){return null},doExecute:function(){var r=this.getEditor(),a=this.getModificationTargets(r),o=this.createOperations(a,data,r);return!(!o||!o.length)&&(r.execOperations(o),!0)}}),Kekule.Editor.ActionOperationCreate.ChemObjModify=Class.create(Kekule.Editor.ActionOperationCreate.Base,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemObjModify",getOperationTargets:function(r){var a=r.getHotTrackedObjs();return a&&a.length||(a=r.getSelection()),a}}),Kekule.Editor.ActionOperationCreate.ChemNodeModify=Class.create(Kekule.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemNodeModify",applicableOnTarget:function(r,a,o){return r instanceof Kekule.ChemStructureNode&&!(r instanceof Kekule.Molecule)&&r.getLinkedBonds().length},doCreateOperationOnTarget:function(r,a,o){return Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(r,a,o)}}),Kekule.Editor.ActionOperationCreate.ChemConnectorModify=Class.create(Kekule.Editor.ActionOperationCreate.ChemObjModify,{CLASS_NAME:"Kekule.Editor.ActionOperationCreate.ChemConnectorModify",applicableOnTarget:function(r,a,o){return r instanceof Kekule.ChemStructureConnector},doCreateOperationOnTarget:function(r,a,o){return Kekule.ObjUtils.match(r,a)?null:new Kekule.ChemObjOperation.Modify(r,a,o)}}),Kekule.Editor.createEditorOperationCreateActionClass=function(r,a,o,l){var u={};r&&(u.CLASS_NAME="Kekule.Editor.ActionOperationCreate."+r),l&&(u.ACTION_DATA=l);var c=Class.create(o,u);return a&&n.push({name:a,actionClass:c}),c},Kekule.Editor.ActionOnComposer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function(r,a,o){this.tryApplySuper("initialize"),this.setText(a),this.setHint(o),this.setComposer(r)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1})},doUpdate:function(){var r=this.getComposer(),a=this.getEditor();this.setEnabled(r&&r.getEnabled()&&a&&a.getChemObj()&&a.getChemObjLoaded()&&a.getEnabled())},getEditor:function(){var r=this.getComposer();return r?r.getEditor():null}}),Kekule.Editor.ActionOnComposerAdv=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function(r,a,o){var l=new Kekule.ActionList;l.setOwnActions(!0),this.setPropStoreFieldValue("attachedActions",l),this.tryApplySuper("initialize",[r,a,o])},finalize:function(){this.getAttachedActions().finalize(),this.tryApplySuper("finalize")},initProperties:function(){this.defineProp("attachedActionClasses",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null}),this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:!1})},checkedChanged:function(){this.tryApplySuper("checkedChanged");var r=this.getChecked();if(this.hasAttachedActions()){var a=this.getComposer();if(a)if(r){var o=this.getAttachedActions();a.bindAssocActions(o),a.showAssocToolbar();var l=o.getCheckedAction(this.getClassName());l||(l=this.getDefaultAttachedAction()),l&&(l.setChecked(!1),l.execute())}else a.hideAssocToolbar()}},hasAttachedActions:function(){return!!this.getAttachedActions().getActionCount()},setAttachedActionIndex:function(r,a){var o=this.getAttachedActions();return o&&o.setActionIndex(r,a),this},addAttachedAction:function(r,a){return this.getAttachedActions().add(r),a&&this.setDefaultAttachedAction(r),this},removeAttachedAction:function(r){return this.getDefaultAttachedAction()===r&&this.setDefaultAttachedAction(null),this.getAttachedActions().remove(r),this},clearAttachedActions:function(){this.setDefaultAttachedAction(null),this.getAttachedActions().clear()},doExecute:function(){},update:function(){this.tryApplySuper("update"),this.getAttachedActions().updateAll()}}),Kekule.Editor.ActionComposerToggleObjInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleObjInspector",HTML_CLASSNAME:t.ACTION_TOGGLE_OBJ_INSPECTOR,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_OBJ_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_OBJ_INSPECTOR")])},doUpdate:function(){var r=this.getComposer();r&&this.setChecked(r.getShowObjInspector())},doExecute:function(){var r=this.getComposer();r&&(this.setChecked(!this.getChecked()),r.setShowObjInspector(this.getChecked()))}}),Kekule.Editor.ActionComposerToggleInspector=Kekule.Editor.ActionComposerToggleObjInspector,Kekule.Editor.ActionComposerToggleIssueInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleIssueInspector",HTML_CLASSNAME:t.ACTION_TOGGLE_ISSUE_INSPECTOR,initialize:function(r){this.tryApplySuper("initialize",[r,Kekule.$L("ChemWidgetTexts.CAPTION_TOGGLE_ISSUE_INSPECTOR"),Kekule.$L("ChemWidgetTexts.HINT_TOGGLE_ISSUE_INSPECTOR")])},doUpdate:function(){var r=this.getComposer();r&&(this.setChecked(r.getShowIssueInspector()),this.setEnabled(r.getEnableIssueCheck()).setDisplayed(r.getEnableIssueCheck()))},doExecute:function(){var r=this.getComposer();r&&(this.setChecked(!this.getChecked()),r.setShowIssueInspector(this.getChecked()))}}),Kekule.Editor.ActionComposerSetIaController=Class.create(Kekule.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function(r,a,o,l){this.tryApplySuper("initialize",[r,a,o]),this.setPropStoreFieldValue("iaControllerId",l)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:!1,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}}),Kekule.Editor.createComposerIaControllerActionClass=function(r,a,o,l,u,c,d,h,p,g){u||(u=l),u.startsWith(Kekule.ChemWidget.HtmlClassNames.PREFIX)||(u=Kekule.ChemWidget.HtmlClassNames.PREFIX+u);var f,m={CLASS_NAME:r,HTML_CLASSNAME:u,initialize:function(_){this.tryApplySuper("initialize",[_,a,o,l]),this.initAttachedActions&&this.initAttachedActions()}};h&&(m=Object.extend(m,h)),c&&(m.doExecute&&(f=m.doExecute),m.doExecute=function(){var _=this.getEditor().getIaController(l);_&&_.setPropValues(c),f?f.apply(this):this.tryApplySuper("doExecute")}),d&&(m.initAttachedActions=function(){this.setPropStoreFieldValue("attachedActionClasses",d)});var C=Class.create(Kekule.Editor.ActionComposerSetIaController,m);return p&&n.push({name:p,actionClass:C,widgetClass:g}),C},Kekule.Editor.ActionComposerClientDragScrollController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerClientDragScrollController",Kekule.$L("ChemWidgetTexts.CAPTION_CLIENT_DRAGSCROLL"),Kekule.$L("ChemWidgetTexts.HINT_CLIENT_DRAGSCROLL"),"ClientDragScrollIaController",null,null,null,null,e.dragScroll),Kekule.Editor.ActionComposerSetManipulateControllerMarquee=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerMarquee",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_MARQUEE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_MARQUEE"),"SelectIaController","SelectIaController-Marquee",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.RECT},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.RECT)}},e.manipulateMarquee),Kekule.Editor.ActionComposerSetManipulateControllerLasso=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerLasso",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_LASSO"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_LASSO"),"SelectIaController","SelectIaController-Lasso",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.POLYGON},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.POLYGON)}},e.manipulateLasso),Kekule.Editor.ActionComposerSetManipulateControllerBrush=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerBrush",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_BRUSH"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_BRUSH"),"SelectIaController","SelectIaController-Brush",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.POLYLINE},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.POLYLINE)}},e.manipulateBrush),Kekule.Editor.ActionComposerSetManipulateControllerAncestor=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateControllerAncestor",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE_ANCESTOR"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE_ANCESTOR"),"SelectIaController","SelectIaController-Ancestor",{enableGestureManipulation:!0,selectMode:Kekule.Editor.SelectMode.ANCESTOR},null,{doExecute:function(){this.tryApplySuper("doExecute"),this.getEditor().setSelectMode(Kekule.Editor.SelectMode.ANCESTOR)}},e.manipulateAncestor),Kekule.Editor.ActionComposerSetManipulateController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",Kekule.$L("ChemWidgetTexts.CAPTION_MANIPULATE"),Kekule.$L("ChemWidgetTexts.HINT_MANIPULATE"),"SelectIaController",null,null,[Kekule.Editor.ActionComposerSetManipulateControllerMarquee,Kekule.Editor.ActionComposerSetManipulateControllerLasso,Kekule.Editor.ActionComposerSetManipulateControllerBrush,Kekule.Editor.ActionComposerSetManipulateControllerAncestor,Kekule.Editor.ActionComposerClientDragScrollController,Kekule.Editor.ActionToggleSelectState],null,e.manipulate),Kekule.Editor.ActionComposerSetEraserController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",Kekule.$L("ChemWidgetTexts.CAPTION_ERASE"),Kekule.$L("ChemWidgetTexts.HINT_ERASE"),"BasicMolEraserIaController",null,null,null,{doExecute:function(){this.tryApplySuper("doExecute");var r=this.getEditor();r.hasSelection()&&r.getActiveIaController().removeSelection()}},e.erase),Kekule.Editor.ActionComposerSetTrackController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTrackController",Kekule.$L("ChemWidgetTexts.CAPTION_TRACK_INPUT"),Kekule.$L("ChemWidgetTexts.HINT_TRACK_INPUT"),"TrackInputIaController",null,null,null,null,e.trackInput),Kekule.Editor.ActionComposerSetBondControllerSingle=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_SINGLE"),"MolBondIaController","MolBondIaController-Single",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.NONE},null,null,e.molBondSingle),Kekule.Editor.ActionComposerSetBondControllerDouble=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE"),"MolBondIaController","MolBondIaController-Double",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.NONE},null,null,e.molBondDouble),Kekule.Editor.ActionComposerSetBondControllerTriple=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_TRIPLE"),"MolBondIaController","MolBondIaController-Triple",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.TRIPLE,bondStereo:Kekule.BondStereo.NONE},null,null,e.molBondTriple),Kekule.Editor.ActionComposerSetBondControllerCloser=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerCloser",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_CLOSER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_CLOSER"),"MolBondIaController","MolBondIaController-Closer",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.CLOSER},null,null,e.molBondCloser),Kekule.Editor.ActionComposerSetBondControllerWedgeUp=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP"),"MolBondIaController","MolBondIaController-WedgeUp",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP},null,null,e.molBondWedgeUp),Kekule.Editor.ActionComposerSetBondControllerWedgeDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN"),"MolBondIaController","MolBondIaController-WedgeDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.DOWN},null,null,e.molBondWedgeDown),Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_WAVY"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_WAVY"),"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP_OR_DOWN},null,null,e.molBondWedgeUpOrDown),Kekule.Editor.ActionComposerSetBondControllerDoubleEither=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDoubleEither",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE_EITHER"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND_DOUBLE_EITHER"),"MolBondIaController","MolBondIaController-Double-Either",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.E_OR_Z},null,null,e.molBondDoubleEither),Kekule.Editor.ActionComposerSetRepositoryFischer1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer1",{repItemName:"fischer1"},null,null,e.molRepFischer1),Kekule.Editor.ActionComposerSetRepositoryFischer2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer2",{repItemName:"fischer2"},null,null,e.molRepFischer2),Kekule.Editor.ActionComposerSetRepositoryFischer3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryFischer3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_FISCHER3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_FISCHER3"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Fischer3",{repItemName:"fischer3"},null,null,e.molRepFischer3),Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_STAGGERED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_STAGGERED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseStaggered",{repItemName:"sawhorseStaggered"},null,null,e.molRepSawhorseStaggered),Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SAWHORSE_ECLIPSED"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SAWHORSE_ECLIPSED"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SawhorseEclipsed",{repItemName:"sawhorseEclipsed"},null,null,e.molRepSawhorseEclipsed),Kekule.Editor.ActionComposerSetRepositoryMethaneController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMethaneController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_METHANE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_METHANE"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-Methane",{repItemName:"methane"},null,null,e.molRepMethane),Kekule.Editor.ActionComposerSetRepositorySubBondMarkController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySubBondMarkController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_SUBBOND_MARK"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_SUBBOND_MARK"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-SubBondMark",{repItemName:"substituentMark"},null,null,e.molRepSubBondMark),Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXCHAIN"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXCHAIN"),"MolFlexChainIaController","MolFlexChainIaController",null,null,null,e.molChain),Kekule.Editor.ActionComposerSetBondController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_BOND"),Kekule.$L("ChemWidgetTexts.HINT_MOL_BOND"),"MolBondIaController",null,null,[Kekule.Editor.ActionComposerSetBondControllerSingle,Kekule.Editor.ActionComposerSetBondControllerDouble,Kekule.Editor.ActionComposerSetBondControllerTriple,Kekule.Editor.ActionComposerSetBondControllerWedgeUp,Kekule.Editor.ActionComposerSetBondControllerWedgeDown,Kekule.Editor.ActionComposerSetRepositoryMolFlexChainController,Kekule.Editor.ActionComposerSetTrackController,Kekule.Editor.ActionComposerSetRepositoryFischer1Controller,Kekule.Editor.ActionComposerSetRepositorySawhorseStaggeredController,Kekule.Editor.ActionComposerSetRepositorySawhorseEclipsedController],null,e.molBond),Kekule.Editor.ActionComposerSetAtomController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM"),"MolAtomIaController",null,null,null,null,e.molAtom),Kekule.Editor.ActionComposerSetFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FORMULA"),"FormulaIaController",null,null,null,null,e.molFormula),Kekule.Editor.ActionComposerSetAtomAndFormulaController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomAndFormulaController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ATOM_AND_FORMULA"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ATOM_AND_FORMULA"),"MolAtomIaController",null,null,[Kekule.Editor.ActionComposerSetAtomController,Kekule.Editor.ActionComposerSetRepositoryMethaneController,Kekule.Editor.ActionComposerSetFormulaController],null,e.molAtomAndFormula),Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_ELECTRON_LONEPAIR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_ELECTRON_LONEPAIR"),"AttachedMarkerIaController","AttachedMarkerIaController-LonePair",{markerClassName:"Kekule.ChemMarker.UnbondedElectronSet",targetClassName:"Kekule.AbstractAtom",initialPropValues:{electronCount:2}},null,null,e.molElectronLonePair),Kekule.Editor.ActionComposerSetNodeChargeControllerClear=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR"),"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,radical:Kekule.RadicalOrder.NONE},null,null,e.molChargeClear),Kekule.Editor.ActionComposerSetNodeChargeControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1,radical:Kekule.RadicalOrder.NONE},null,null,e.molChargePositive),Kekule.Editor.ActionComposerSetNodeChargeControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE"),"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1,radical:Kekule.RadicalOrder.NONE},null,null,e.molChargeNegative),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.SINGLET},null,null,e.molRadicalSinglet),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.TRIPLET},null,null,e.molRadicalTriplet),Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET"),"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.DOUBLET},null,null,e.molRadicalDoublet),Kekule.Editor.ActionComposerSetNodeChargeController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_CHARGE"),Kekule.$L("ChemWidgetTexts.HINT_MOL_CHARGE"),"MolNodeChargeIaController",null,null,[Kekule.Editor.ActionComposerSetNodeChargeControllerClear,Kekule.Editor.ActionComposerSetNodeChargeControllerPositive,Kekule.Editor.ActionComposerSetNodeChargeControllerNegative,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet,Kekule.Editor.ActionComposerSetAttachedMarkerIaControllerLonePair],null,e.molCharge),Kekule.Editor.ActionComposerSetTextBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_BLOCK"),"TextBlockIaController",null,null,null,null,e.textBlock),Kekule.Editor.ActionComposerSetImageBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetImageBlockController",Kekule.$L("ChemWidgetTexts.CAPTION_IMAGE_BLOCK"),Kekule.$L("ChemWidgetTexts.HINT_IMAGE_BLOCK"),"ImageBlockIaController",null,null,null,null,e.imageBlock),Kekule.Editor.ActionComposerSetTextImageController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextImageController",Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_IMAGE"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_IMAGE"),"TextImageIaController","TextImageIaController",null,[Kekule.Editor.ActionComposerSetTextBlockController,Kekule.Editor.ActionComposerSetImageBlockController],null,e.textImage),Kekule.Editor.ActionComposerSetRepositoryRing3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_3"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_3"),"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:!1},null,null,e.molRing3),Kekule.Editor.ActionComposerSetRepositoryRing4Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_4"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_4"),"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:!1},null,null,e.molRing4),Kekule.Editor.ActionComposerSetRepositoryRing5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_5"),"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:!1},null,null,e.molRing5),Kekule.Editor.ActionComposerSetRepositoryRing6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_6"),"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:!1},null,null,e.molRing6),Kekule.Editor.ActionComposerSetRepositoryRing7Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_7"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_7"),"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:!1},null,null,e.molRing7),Kekule.Editor.ActionComposerSetRepositoryRing8Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_8"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_8"),"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:!1},null,null,e.molRing8),Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6"),"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:!0},null,null,e.molRingAr6),Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5"),"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:!0},null,null,e.molRingAr5),Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController",Kekule.$L("ChemWidgetTexts.CAPTION_MOL_FLEXRING"),Kekule.$L("ChemWidgetTexts.HINT_MOL_FLEXRING"),"MolFlexRingIaController","MolFlexRingIaController",null,null,null,e.molFlexRing),Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth1",{repItemName:"cyclopentaneHaworth1"},null,null,e.molRepCyclopentaneHaworth1),Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclopentaneHaworth2",{repItemName:"cyclopentaneHaworth2"},null,null,e.molRepCyclopentaneHaworth2),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth1",{repItemName:"cyclohexaneHaworth1"},null,null,e.molRepCyclohexaneHaworth1),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneHaworth2",{repItemName:"cyclohexaneHaworth2"},null,null,e.molRepCyclohexaneHaworth2),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR1"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair1",{repItemName:"cyclohexaneChair1"},null,null,e.molRepCyclohexaneChair1),Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_CYCLOHEXANE_CHAIR2"),"RepositoryStructureFragmentIaController","RepositoryStructureFragmentIaController-CyclohexaneChair2",{repItemName:"cyclohexaneChair2"},null,null,e.molRepCyclohexaneChair2),Kekule.Editor.ActionComposerSetRepositoryRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_RING"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_RING"),"MolRingIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryRing3Controller,Kekule.Editor.ActionComposerSetRepositoryRing4Controller,Kekule.Editor.ActionComposerSetRepositoryRing5Controller,Kekule.Editor.ActionComposerSetRepositoryRing6Controller,Kekule.Editor.ActionComposerSetRepositoryMolFlexRingController,Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller,Kekule.Editor.ActionComposerSetRepositoryCyclopentaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneHaworth1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair1Controller,Kekule.Editor.ActionComposerSetRepositoryCyclohexaneChair2Controller],null,e.molRing),Kekule.Editor.ActionComposerSetRepositoryPathLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5},null,null,e.glyphRepLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,e.glyphRepOpenArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,e.glyphRepTriangleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,e.glyphRepDiOpenArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.TRIANGLE,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5}},null,null,e.glyphRepDiTriangleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE"),"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowSide:Kekule.Glyph.ArrowSide.REVERSED,startArrowWidth:.25,startArrowLength:.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.SINGLE,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,e.glyphRepReversibleArrowLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE"),"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1,lineCount:2}},null,null,e.glyphRepOpenArrowDiLine),Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowArcController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowArcController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-OpenArrowArc",{glyphClass:Kekule.Glyph.BaseArc,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,e.glyphRepOpenArrowArc),Kekule.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathSingleSideOpenArrowArcController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC"),"ArrowLineIaController","ArrowLineIaController-SingleSideOpenArrowArc",{glyphClass:Kekule.Glyph.BaseArc,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.REVERSED,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,e.glyphRepSingleSideOpenArrowArc),Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:Kekule.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}},null,null,e.glyphRepHeatSymbol),Kekule.Editor.ActionComposerSetRepositoryAddSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL"),"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:Kekule.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}},null,null,e.glyphRepAddSymbol),Kekule.Editor.ActionComposerSetRepositoryLineSegmentController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryLineSegmentController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE"),"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.Segment,glyphInitialParams:{startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,e.glyphRepSegment),Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_NORMAL"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_NORMAL"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowNormal",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionArrowType:Kekule.Glyph.ReactionArrowType.NORMAL,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,e.glyphReactionArrowNormal),Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_REVERSIBLE"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_REVERSIBLE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowReversible",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.REVERSIBLE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,e.glyphReactionArrowReversible),Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RESONANCE"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RESONANCE"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowResonance",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.RESONANCE,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,e.glyphReactionArrowResonance),Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_RETROSYNTHESIS"),Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_RETROSYNTHESIS"),"ArrowLineIaController","ArrowLineIaController-ReactionArrowRetrosynthesis",{glyphClass:Kekule.Glyph.ReactionArrow,glyphInitialParams:{reactionType:Kekule.Glyph.ReactionArrowType.RETROSYNTHESIS,startArrowWidth:.25,startArrowLength:.25,endArrowWidth:.25,endArrowLength:.25,lineLength:1.5,lineGap:.1}},null,null,e.glyphReactionArrowRetrosynthesis),Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_2"),Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_2"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowDouble",{glyphClass:Kekule.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:2,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,e.glyphElectronPushingArrowDouble),Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_1"),Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-ElectronPushingArrowSingle",{glyphClass:Kekule.Glyph.ElectronPushingArrow,glyphInitialParams:{electronCount:1,endArrowWidth:.25,endArrowLength:.25,lineLength:1,lineGap:.1,lineCount:1}},null,null,e.glyphElectronPushingArrowSingle),Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController",Kekule.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),Kekule.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1"),"ArrowLineIaController","ArrowLineIaController-BondFormingElectronPushingArrowSingle",{glyphClass:Kekule.Glyph.BondFormingElectronPushingArrow,glyphInitialParams:{endArrowWidth:.25,endArrowLength:.25,lineLength:1,pathEndGap:.1,lineCount:1}},null,null,e.glyphElectronPushingArrowBondForming),Kekule.Editor.ActionComposerSetRepositoryGlyphController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",Kekule.$L("ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE"),Kekule.$L("ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE"),"ArrowLineIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryNormalReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryReversibleReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryResonanceReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryRetrosynthesisReactionArrowController,Kekule.Editor.ActionComposerSetRepositoryLineSegmentController,Kekule.Editor.ActionComposerSetRepositoryDoubleElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositorySingleElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositoryBondFormingElectronPushingArrowController,Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController,Kekule.Editor.ActionComposerSetRepositoryAddSymbolController],null,e.glyph),Kekule._registerAfterLoadSysProc(function(){var r=Kekule.ActionManager,a=Kekule.ChemWidget,o=Kekule.Editor,l=Kekule.Editor.ChemSpaceEditor,u=r.registerNamedActionClass;u(e.newDoc,o.ActionEditorNewDoc,l),u(e.loadFile,a.ActionDisplayerLoadFile,l),u(e.loadData,o.ActionEditorLoadData,l),u(e.saveData,a.ActionDisplayerSaveFile,l),u(e.zoomIn,a.ActionDisplayerZoomIn,l),u(e.zoomOut,a.ActionDisplayerZoomOut,l),u(e.resetZoom,a.ActionDisplayerResetZoom,l),u(e.reset,a.ActionDisplayerReset,l),u(e.config,Kekule.Widget.ActionOpenConfigWidget,l),u(e.undo,o.ActionEditorUndo,l),u(e.redo,o.ActionEditorRedo,l),u(e.selectAll,o.ActionSelectAll,l),u(e.cloneSelection,o.ActionCloneSelection,l),u(e.copy,o.ActionCopySelection,l),u(e.cut,o.ActionCutSelection,l),u(e.paste,o.ActionPaste,l),u(e.toggleSelect,o.ActionToggleSelectState,l),u(e.eraseSelection,o.ActionEraseSelection,l),u(e.recheckIssues,o.ActionRecheckIssues,l),u(e.toggleShowAllIssues,o.ActionToggleShowIssueMarkers,l),u(e.objInspector,o.ActionComposerToggleObjInspector,l),u(e.issueInspector,o.ActionComposerToggleIssueInspector,l),i();for(var c=0,d=n.length;c<d;++c){var h=n[c];u(h.name,h.actionClass,h.widgetClass||l)}})}(),function(){var s=Kekule.ArrayUtils,e=Kekule.CoordUtils;Kekule.Editor.PointerTrackConstraint={NONE:0,LEADING:1,BOTH:2,CIRCLE:5},Kekule.Editor.TrackParser=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackParser",simplifyCurveToLineSegments:function(t,n){return Kekule.GeometryUtils.simplifyCurveToLineSegments(t,n)},addLineCrossPoints:function(t){for(var n=[],i=t.length,r=0;r<i-1;++r)for(var a={coord1:t[r],coord2:t[r+1]},o=r+2;o<i-1;++o){var l={coord1:t[o],coord2:t[o+1]},u=Kekule.GeometryUtils.getCrossPointOfLines(a.coord1,a.coord2,l.coord1,l.coord2);u&&(this._addInsertedPoint(r,u,n),this._addInsertedPoint(o,u,n))}for(r=0;r<i-1;++r)n[r]&&this._sortInsertedPointsInLine(n[r],t[r],t[r+1]);var c=[];for(r=0;r<i-1;++r)if(c.push(t[r]),n[r]){o=0;for(var d=n[r].length;o<d;++o)c.push(n[r][o])}return c.push(t[i-1]),c},addVertexToLineMergePoint:function(t,n){if(n<=0)return t;for(var i=t.length,r=[],a=0;a<i-1;++a)for(var o=t[a],l=0;l<i-1;++l)if(l<a-1||l>a+1){var u=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(o,t[l],t[l+1],!1);u&&Kekule.CoordUtils.getDistance(o,u)<=n&&(o.x=u.x,o.y=u.y,this._addInsertedPoint(l,o,r))}var c=[];for(a=0;a<i-1;++a)if(c.push(t[a]),r[a]){this._sortInsertedPointsInLine(r[a],t[a],t[a+1]),l=0;for(var d=r[a].length;l<d;++l)c.push(r[a][l])}return c.push(t[i-1]),c},_addInsertedPoint:function(t,n,i){i[t]||(i[t]=[]),i[t].push(n)},_sortInsertedPointsInLine:function(t,n,i){if(t){var r=i.x-n.x,a=i.y-n.y;t.sort(function(o,l){return Math.abs(a)>Math.abs(r)?-(l.y-o.y)*a:-(l.x-o.x)*r})}},mergeNearbyTrackPoints:function(t,n){if(n<=0)return t;for(var i=t.length,r=t.concat([]),a=0;a<i;++a){var o=r[a];if(!o.__$merge_handled__)for(var l=a+1;l<i;++l){var u=r[l];if(!u.__$merge_handled__){var c=o.__$merge_weight__||1,d=u.__$merge_weight__||1;if(Kekule.CoordUtils.getDistance(o,u)<=n){var h,p=c+d;o.__$merge_weight__=p,o.boundObj?h=o:u.boundObj?(h=u,o.boundObj=u.boundObj):(h=c===1?o:e.multiply(o,c),h=e.add(h,d===1?u:e.multiply(u,d)),h=e.divide(h,p)),o.x=h.x,o.y=h.y,r.splice(l,1,o)}}}o.__$merge_handled__=!0}return r},mergeCloseVertexes:function(t,n){return(n=n||this.getVertexMergeRadius())<=0?t:this._doMergeCloseVertexes(t,n)},_doMergeCloseVertexes:function(t,n){for(var i=t.getVertexes(),r=i.length,a=!1,o=0;o<r;++o){for(var l=i[o],u=i[o].getData("coord"),c=o+1;c<r;++c){var d=i[c],h=d.getData("coord");if(Kekule.CoordUtils.getDistance(u,h)<=n){this._doMergeVertex(t,l,d),a=!0;break}}if(a)break}return a?this._doMergeCloseVertexes(t,n):t},_doMergeVertex:function(t,n,i){for(var r=n.getData("coord"),a=n.getData("weight")||1,o=i.getData("coord"),l=i.getData("weight")||1,u=s.clone(i.getEdges()),c=0,d=u.length;c<d;++c)u[c].replaceVertex(i,n);t.removeVertex(i);var h=a===1?r:e.multiply(r,a);h+=l===1?o:e.multiply(o,l),h=e.divide(h,a+l),n.setData("coord",h)},removeRepetitivePoints:function(t){for(var n=[],i=null,r=0,a=t.length;r<a;++r)t[r]!==i&&(n.push(t[r]),i=t[r]);return n},refineTrack:function(t,n,i){var r=this.simplifyCurveToLineSegments(t,n);return r=this.addLineCrossPoints(r),r=this.addVertexToLineMergePoint(r,i),r=this.mergeNearbyTrackPoints(r,i),r=this.removeRepetitivePoints(r)},convertTrackToStructure:function(t,n,i,r){if(!n||!n.length)return null;var a=n.length;if(a<2)return null;for(var o,l=r||new Kekule.StructureFragment,u=0;u<a;++u){var c=n[u],d=c.__$structure_node__;if(d||((d=new Kekule.Atom).setIsotopeId(i),t.setObjectScreenCoord(d,c),c.__$structure_node__=d,l.appendNode(d)),o&&o!==d&&!d.getConnectorTo(o)){var h=new Kekule.Bond(null,[o,d]);h.setBondOrder(1),l.appendConnector(h)}o=d}return l},convertLinesToGraph:function(t){if(t&&t.length){for(var n,i=new Kekule.Graph,r=t.length,a=0;a<r;++a){var o,l=t[a];if((o=l.__$graph_vertex__)||((o=new Kekule.GraphVertex).setData("coord",l),l.__$graph_vertex__=o,i.addVertex(o)),n&&!o.getEdgeTo(n)){var u=new Kekule.GraphEdge;i.addEdge(u,n,o)}n=o}return i}return null}}),Kekule.Editor.TrackLayoutOptimizer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.TrackLayoutOptimizer",OPTIMIZED_COORD_FIELD:"__$optimizedCoord__",COORD_INDEX_FIELD:"__$coordIndex__",RING_END_INDEX_FIELD:"__$ringEndIndex__",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){},initPropValues:function(){this.tryApplySuper("initPropValues")},splitTrackByRings:function(t){for(var n=[],i=function(g,f){for(var m=0,C=n.length;m<C;++m){var _=n[m];if(!(_.startIndex>f||_.endIndex<g))return!1}return!0},r=0,a=t.length;r<a;++r){var o=t[r];if(o[this.COORD_INDEX_FIELD]===void 0)o[this.COORD_INDEX_FIELD]=r;else{var l=o[this.COORD_INDEX_FIELD],u=r;o[this.RING_END_INDEX_FIELD]=u,i(l,u)&&n.push({startIndex:l,endIndex:u})}}var c=[],d=n.length;if(d>0){var h=0;for(r=0;r<d;++r){var p=n[r];p.startIndex>h&&c.push({track:t.slice(h,p.startIndex+1),isRing:!1}),c.push({track:t.slice(p.startIndex,p.endIndex+1),isRing:!0}),h=p.endIndex}return h<t.length-1&&c.push({track:t.slice(h,t.length),isRing:!1}),c}return[{track:t,isRing:!1}]},optimize:function(t,n){var i,r=t,a=Kekule.Editor.PointerTrackConstraint,o=t[0],l=o.boundObj,u=t[t.length-1],c=u.boundObj;l&&c?i=l===c?a.CIRCLE:a.BOTH:l||c?(i=a.LEADING,c&&(r=s.reverse(t))):i=o===u?a.CIRCLE:a.LEADING;var d=Object.extend({},n);return d.preferredStartingAngles=n.preferredStartingAngles||[0],d.segmentsInfo=this._calcTrackSegmentsInfo(r),d.distanceMedian=s.getMedian(d.segmentsInfo.distances),i===a.CIRCLE?this.doOptimizeOnCircleConstraint(r,d):i===a.BOTH?this.doOptimizeOnBothConstraint(r,d):this.doOptimizeOnLeadingConstraint(r,d)},_calcTrackSegmentsInfo:function(t){for(var n=[],i=[],r=0,a=t.length;r<a-1;++r){var o=t[r],l=t[r+1],u=e.getDistance(o,l),c=e.substract(l,o),d=Math.atan2(c.y,c.x);n.push(u),i.push(d)}return{distances:n,angles:i}},doOptimizeOnLeadingConstraint:function(t,n,i){var r=Kekule.GeometryUtils,a=[];if(i){Kekule.Editor.PointerTrackConstraint;var o,l=this.splitTrackByRings(t);if(l.length===1)return l[u].isRing?this.doOptimizeOnCircleConstraint(d,n,!0):this.doOptimizeOnLeadingConstraint(d,n,!0);for(var u=0,c=l.length;u<c;++u){var d=l[u].track,h=l[u].isRing?this.doOptimizeOnCircleConstraint(d,n,!0):this.doOptimizeOnLeadingConstraint(d,n,!0);if(o){for(var p=h[0],g=e.substract(o,p),f=0,m=h.length;f<m;++f)h[f]=e.add(h[f],g);o=h[h.length-1],h.shift(),a=a.concat(h)}else o=h[h.length-1],a=a.concat(h)}return a}var C,_=n.preferredStartingAngles;for(a.push(t[0]),n.preferredIncludeAngle,n.preferredIncludeAngle,u=1,c=t.length;u<c;++u)if(t[u][this.OPTIMIZED_COORD_FIELD])a.push(t[u][this.OPTIMIZED_COORD_FIELD]);else{var y,T=t[u-1],E=a[u-1],b=t[u],v=(g=e.substract(b,T),e.getDistance(T,b)),I=this._optimizeLineSegmentDistance(v,n),R=Math.atan2(g.y,g.x);C=y=this._optimizeDirectionAngle(R,_,n,C);var N=Math.PI-n.preferredIncludeAngle,L=(_=[r.standardizeAngle(y-N),r.standardizeAngle(y+N)],{x:I*Math.cos(y),y:I*Math.sin(y)}),U=e.add(E,L);a.push(U),t[u][this.OPTIMIZED_COORD_FIELD]=U}return a},doOptimizeOnBothConstraint:function(t,n,i){var r=t.length,a=this.doOptimizeOnLeadingConstraint(t,n,i),o=a[r-1],l=t[r-1],u=t[0],c=e.substract(l,u),d=Math.atan2(c.y,c.x),h=e.substract(o,u),p=Math.atan2(h.y,h.x),g=e.getDistance(c)/e.getDistance(h);if(g<=2){var f=e.calcTransform2DMatrix({rotateAngle:-p,center:u}),m=e.calcTransform2DMatrix({scale:g,center:u}),C=e.calcTransform2DMatrix({rotateAngle:d,center:u}),_=Kekule.MatrixUtils.multiply(f,m);_=Kekule.MatrixUtils.multiply(_,C);for(var y=[a[0]],T=1;T<r-1;++T)y.push(e.transform2DByMatrix(a[T],_));y.push(t[r-1])}else{var E=e.divide(e.substract(l,o),r-1),b=(y=[a[0]],{x:0,y:0});for(T=0;T<r-1;++T)b=e.add(b,E),y.push(e.add(a[T],b));y.push(t[r-1])}return y},doOptimizeOnCircleConstraint:function(t,n,i){var r=t.length-1,a=Object.create(n);if(r<=8){var o=(1-2/r)*Math.PI;(a=Object.create(n)).preferredIncludeAngle=o}for(var l=t.length,u=this.doOptimizeOnLeadingConstraint(t,a,i),c=u[l-1],d=t[l-1],h=e.divide(e.substract(d,c),l-1),p=[u[0]],g={x:0,y:0},f=1;f<l-1;++f)g=e.add(g,h),p.push(e.add(u[f],g));return p.push(t[l-1]),p},_optimizeIncludeAngle:function(t,n,i){return this._optimizeDirectionAngle(t,n,i)},_optimizeDirectionAngle:function(t,n,i,r){var a=Kekule.GeometryUtils,o=null,l=null;if(n&&n.length){for(var u=null,c=0,d=n.length;c<d;++c){var h=Math.abs(a.standardizeAngle(t)-n[c]);(u===null||h<u)&&(l=n[c],u=h)}u<=Math.PI/6&&(o=l)}if(o===null){var p=i.angleConstraint;if(!p)return t;if(l===null&&(l=0),h=t-l,o=l+Math.round(h/p)*p,r){var g=5*Math.PI/180,f=Math.abs(a.standardizeAngle(o-r,-Math.PI));if(Kekule.NumUtils.isFloatEqual(f,0,g)||Kekule.NumUtils.isFloatEqual(f,Math.PI,g)){var m=o+p,C=o-p;o=Math.abs(t-m)<Math.abs(t-C)?m:C}}}return o},_optimizeLineSegmentDistance:function(t,n){var i=n.defBondScreenLength,r=n.distanceConstraints||[];if(!r)return t;if(t>r[r.length-1]*i)return Math.round(t/i)*i;var a,o=n.primaryDistanceConstraint,l=r.length,u=r.indexOf(o);u<0&&(u=0);for(var c=l-1;c>=u;--c){var d=r[c];if(t>(a=d*i))return a}for(c=0;c<=u;++c)if(t<(a=d*i))return a;return a}}),Kekule.Editor.TrackInputIaController=Class.create(Kekule.Editor.StructureInsertIaController,{CLASS_NAME:"Kekule.Editor.TrackInputIaController",initialize:function(t){this.tryApplySuper("initialize",[t]),this.setEnableSelect(!1),this._isTracking=!1,this._trackCoordToObjBindings=null,this._trackParser=new Kekule.Editor.TrackParser,this._trackLayoutOptimizer=new Kekule.Editor.TrackLayoutOptimizer,this._addStructureOperation=null,this._editorScaled=!1,this._editorOriginalZoomLevel=1,this._lastRenderedMarkerCoord=null,this._debugMarkers={}},doFinalize:function(){this._trackLayoutOptimizer.finalize(),this._trackParser.finalize();var t=this.getPropStoreFieldValue("trackMarker");t&&t.finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("trackMarker",{dataType:DataType.OBJECT,serializable:!1,setter:null,getter:function(){var t=this.getPropStoreFieldValue("trackMarker");return t||(t=new Kekule.ChemWidget.MetaShapeUIMarker({shapeType:Kekule.Render.MetaShapeType.POLYLINE,coords:[]}),this.setPropStoreFieldValue("trackMarker",t)),t}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getEditorUiMarkers:function(){return this.getEditor().getUiMarkers()},refineTrackCoords:function(t){var n=this.getEditor(),i=this.getEditorConfigs(),r={angleConstraint:i.getInteractionConfigs().getTrackOptimizationAngleConstraint(),distanceConstraints:i.getInteractionConfigs().getTrackOptimizationDistanceConstraints(),primaryDistanceConstraint:i.getInteractionConfigs().getTrackOptimizationPrimaryDistanceConstraint(),preferredIncludeAngle:2*Math.PI/3},a=n.getDefBondLength?n.getDefBondLength():i.getStructureConfigs().getDefBondLength(),o=n.objCoordToScreen({x:0,y:0}),l=n.objCoordToScreen({x:a,y:0}),u=e.getDistance(o,l);r.defBondScreenLength=u;for(var c=this.getEditorConfigs().getInteractionConfigs().getTrackSimplifierDistanceThreshold(),d=this.getEditorConfigs().getInteractionConfigs().getTrackMergeDistanceThreshold(),h=this._mergeCoordsToBoundNodesAndSplitTrack(t),p=[],g=0,f=h.length;g<f;++g){var m=h[g],C=(m=this._trackParser.refineTrack(m,c,d))[0].obj||m[m.length-1].obj,_=C?i.getStructureConfigs.getNewBondDefAngle(C,1):-Math.PI/6;r.preferredStartingAngles=[_],m=this._trackLayoutOptimizer.optimize(m,r),p.push(m)}return p},_mergeCoordsToBoundNodesAndSplitTrack:function(t){var n=this._trackCoordToObjBindings,i=n.length;if(i){for(var r=this.getEditor(),a=[],o=n[0].obj,l=n[0].coordIndex,u=0,c=1;c<=i;++c){var d=n[c];if(c<i&&d&&(o!==d.obj||d.coordIndex-l>10)||c===i){l>u&&a.push(t.slice(u,l));var h=r.getObjectScreenCoord(o);h.boundObj=o,u=n[c-1].coordIndex+1,a.push([h]),c!==i&&(o=d.obj,l=d.coordIndex)}}t.length-1>n[i-1].coordIndex&&a.push(t.slice(n[i-1].coordIndex));for(var p=[],g=[],f=(c=0,a.length);c<f;++c){var m=a[c];p=p.concat(m),c===f-1?g.push(p):m[0].boundObj&&c>0&&(g.push(p),p=m)}return g}return[t]},convertTracksToStructure:function(t,n){var i=new Kekule.Molecule;i.setCoord2D({x:0,y:0});for(var r=this.getEditor(),a=0,o=t.length;a<o;++a)this._trackParser.convertTrackToStructure(r,t[a],n,i);return i.getNodeCount()<2?null:i},getStructureSelectableChildren:function(t){return[].concat(t.getNodes()).concat(t.getConnectors())},addStructureToEditor:function(t){var n=this.getEditor();this._addStructureOperation=null,n.beginUpdateObject();try{var i,r=n.getChemSpace();this._targetMol?(i=new Kekule.ChemStructOperation.MergeStructFragment(t,this._targetMol,n),this._targetMol=null):i=new Kekule.ChemObjOperation.Add(t,r,null,n),i.execute(),this._addStructureOperation=i}finally{n.endUpdateObject()}},getTrackCoords:function(){return this.getTrackMarker().getShapeInfo().coords},clearTrackCoords:function(){this.getTrackMarker().getShapeInfo().coords=[]},startTracking:function(t,n){this._targetMol=null;var i=this.getEditor(),r=this._getMergeDestObjAtCoord(n);if(!i.canCreateNewChild()&&!r){if(!i.canAddUnconnectedStructFragment())return null;var a=i.getOnlyOneBlankStructFragment();this._targetMol=a}this._isTracking=!0,this._trackCoordToObjBindings=[],this.setManuallyHotTrack(!0),this.clearTrackCoords();var o=this.getTrackMarker();this.getEditorUiMarkers().addMarker(o);var l=this.getEditorConfigs().getUiMarkerConfigs(),u={strokeColor:l.getTrackMarkerStrokeColor(),strokeWidth:l.getTrackMarkerStrokeWidth(),strokeDash:l.getTrackMarkerStrokeDash(),opacity:l.getTrackMarkerOpacity()};if(o.setDrawStyles(u),o.setVisible(!0),this.addTrackCoord(n,!1),this.getEditorConfigs().getInteractionConfigs().getAutoAdjustZoomLevelOnTrackTouching()){i=this.getEditor();var c=this.getEditorConfigs().getInteractionConfigs().getTrackTouchRefLength();if(c){var d=i.getDocument(),h=i.getDefBondScreenLength(),p=Kekule.DocumentUtils.getDevicePPI(d)*c/Kekule.DocumentUtils.getClientScaleLevel(d)/h;if(p>.9){var g=i.getCurrZoom();i.setZoomCenter(n),i.zoomTo(g*p);var f=this._getEventMouseCoord(t),m=this.getTrackCoords(),C=m[m.length-1];n=f,Object.extend(C,f),this._editorScaled=!0,this._editorOriginalZoomLevel=g,this._autoScaleStartCoord=f}else this._editorScaled=!1,this._editorOriginalZoomLevel=null}}this.repaintMarker(),this._lastRenderedMarkerCoord=n},endTracking:function(t){var n=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()||"C";this._isTracking=!1,this.addTrackCoord(t);var i=this.refineTrackCoords(this.getTrackCoords());if(i.length){var r=this.convertTracksToStructure(i,n);if(r){this.addStructureToEditor(r),this.startDirectManipulate(null,r,t),this.moveManipulatedObjs(t),this.manipulateBeforeStopping(),this.stopManipulate();var a=this.getStructureSelectableChildren(r);this.doneInsertOrModifyBasicObjects(a)}}this.doneTracking()},cancelTracking:function(){this._isTracking=!1,this.getEditorUiMarkers().removeMarker(this.getTrackMarker()),this.doneTracking()},doneTracking:function(){if(this._editorScaled){var t=this.getTrackCoords();t[t.length-1],this._editorScaled=!1,this.getEditor().zoomTo(this._editorOriginalZoomLevel,null,this._autoScaleStartCoord),this._editorOriginalZoomLevel=null,this._autoScaleStartCoord=null}this.setManuallyHotTrack(!1),this.getEditor().hideHotTrack(),this.clearTrackCoords(),this.repaintMarker()},_getMergeDestObjAtCoord:function(t){for(var n=this.getEditor().getBasicObjectsAtCoord(t,this.getCurrBoundInflation()),i=0,r=n.length;i<r;++i){var a=n[i];if(this.isValidMergeDestObj(a))return a}return null},addTrackCoord:function(t,n){var i=this.getTrackCoords(),r=i&&i[i.length-1];if(!r||!Kekule.CoordUtils.isEqual(t,r)){var a=this._getMergeDestObjAtCoord(t);a&&(this._trackCoordToObjBindings.push({coord:t,obj:a,coordIndex:this.getTrackCoords().length}),this.getEditor().addHotTrackedObj(a)),i.push(t),!n&&(this._lastRenderedMarkerCoord?Kekule.CoordUtils.getDistance(this._lastRenderedMarkerCoord,t)>5&&(this.repaintMarker(),this._lastRenderedMarkerCoord=t):(this.repaintMarker(),this._lastRenderedMarkerCoord=t))}},repaintMarker:function(){this.getEditor().repaintUiMarker()},isValidMergeDestObj:function(t){return t instanceof Kekule.ChemStructureNode},canInteractWithObj:function(t){return t instanceof Kekule.ChemStructureNode},getAllObjOperations:function(t){var n=this.tryApplySuper("getAllObjOperations",[t])||[],i=this._addStructureOperation;return i&&n.unshift(i),n},react_pointerdown:function(t){if(this.setActivePointerType(t.pointerType),t.getButton()===Kekule.X.Event.MouseButton.LEFT){var n=this._getEventMouseCoord(t);return this.startTracking(t,n),t.preventDefault(),!0}if(t.getButton()===Kekule.X.Event.MouseButton.RIGHT)return this.cancelTracking(),t.preventDefault(),!0},react_pointerup:function(t){if(t.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this._isTracking){var n=this._getEventMouseCoord(t);this.endTracking(n),this.addOperationToEditor()}return this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL),t.preventDefault(),!0}},react_pointermove:function(t){if(this.tryApplySuper("react_pointermove",[t]),this._isTracking){var n=this._getEventMouseCoord(t);return this.addTrackCoord(n),t.preventDefault(),!0}}}),Kekule.Editor.IaControllerManager.register(Kekule.Editor.TrackInputIaController,Kekule.Editor.ChemSpaceEditor)}(),function(){var s=Kekule.ArrayUtils;Kekule.Editor,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames,Kekule.ChemWidget.ComponentWidgetNames,Kekule.Editor.ObjModifier={},Kekule.Editor.ObjModifier.Category={GENERAL:"general",CHEM_STRUCTURE:"chemStruct",GLYPH:"glyph",STYLE:"style",MISC:"misc"},Kekule.Editor.ObjModifier.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.ObjModifier.Base",initialize:function(t){this.tryApplySuper("initialize"),this.setEditor(t),this.modifierWidgetValueChangedBind=this.modifierWidgetValueChanged.bind(this)},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1}),this.defineProp("targetObjs",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getEditor().getSelection()}}),this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null,getter:function(){var t=this.getPropStoreFieldValue("widget");return t||(t=this.createWidget(),this.setPropStoreFieldValue("widget",t)),t}})},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getModifierName:function(){return this.getClassLocalName().toLowerCase()},createWidget:function(){var t=this.doCreateWidget();return t&&this.installValueChangeEventHandler(t),t},doCreateWidget:function(){return null},installValueChangeEventHandler:function(t){t.on("valueChange",this.modifierWidgetValueChangedBind)},modifierWidgetValueChanged:function(){this.applyToTargets()},loadFromTargets:function(){var t=this.getEditor();if(t){var n=this.getTargetObjs();n&&this.doLoadFromTargets(t,n)}return this},doLoadFromTargets:function(t,n){},applyToTargets:function(){var t=this.getEditor();if(t){var n=this.getTargetObjs();n&&this.doApplyToTargets(t,n)}return this},doApplyToTargets:function(t,n){var i=this.createModificationOper();i&&t.execOperation(i)},createModificationOper:function(t){var n=[];if(t&&t.length)for(var i=0,r=t.length;i<r;++i){var a=this.createModificationOperOnTarget(t[i]);a&&n.push(a)}var o=n.length;return o<=0?null:o===1?n[0]:new Kekule.MacroOperation(n)},createModificationOperOnTarget:function(t){var n=this.getModifiedPropValues();return n?this.createModificationOperation(t,n):null},getModifiedPropValues:function(){return null},createModificationOperation:function(t,n){return new Kekule.ChemObjOperation.Modify(t,n,this.getEditor())}}),Kekule.Editor.ObjModifierManager={_modifierMap:new Kekule.MapEx(!0),register:function(t,n){if(n&&t)for(var i=s.toArray(n),r=s.toArray(t),a=0,o=r.length;a<o;++a){var l=r[a],u=e._modifierMap.get(l);u?s.pushUnique(u,i):(u=i,e._modifierMap.set(l,u))}},unregister:function(t){if(t)for(var n=s.toArray(t),i=e._modifierMap.getKeys(),r=0,a=i.length;r<a;++r){var o=e._modifierMap.get(i[r]);o&&o.length&&e._modifierMap.set(i[r],s.exclude(o,n))}},getModifierCategories:function(t){var n=t.getCategories&&t.getCategories()||[],i=ClassEx.getSuperClass(t);return i&&s.pushUnique(n,e.getModifierCategories(i)),n},getModifierClasses:function(t,n){var i=e._modifierMap.get(t)||[],r=ClassEx.getSuperClass(t);if(r&&s.pushUnique(i,e.getModifierClasses(r,n)),n&&n.length){var a=i;i=[];for(var o=0,l=a.length;o<l;++o){var u=e.getModifierCategories(a[o]);s.intersect(u,n).length&&i.push(a[o])}}return i}};var e=Kekule.Editor.ObjModifierManager}(),function(){Kekule.ArrayUtils,Kekule.Editor;var s=Kekule.Widget.HtmlClassNames,e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ComponentWidgetNames,Kekule.Editor.ObjModifier.BaseRenderOptionModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseRenderOptionModifier",getRenderOptionValue:function(t,n,i){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(t,n,i)}}),Kekule.Editor.ObjModifier.BaseRenderOptionModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.STYLE]},Kekule.Editor.ObjModifier.Color=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Color",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:s.COLORPICKER_SPEC_COLOR_MIXED},initProperties:function(){this.defineProp("colorBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var t=new Kekule.Widget.ColorDropButton(this.getEditor());return t.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR")),t.setShowText(!1),t.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),t.addClassName(e.COMPOSER_COLOR_BOX),this.setPropStoreFieldValue("colorBox",t),t},doLoadFromTargets:function(t,n){if(n&&n.length){var i=this.getColorBox();if(i){var r=this.getRenderOptionValue(n,"useAtomSpecifiedColor"),a=this.getRenderOptionValue(n,"color");r?(a=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,i.setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className),i.setValue(a)):(i.setColorClassName(null),i.setValue(a))}}},doApplyToTargets:function(t,n){var i=this.getWidget().getValue();i===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?t.modifyObjectsRenderOptions(n,{useAtomSpecifiedColor:!0,color:void 0},!1,!0):(i==Kekule.Widget.ColorPicker.SpecialColors.UNSET&&(i=void 0),t.modifyObjectsRenderOptions(n,{useAtomSpecifiedColor:!1,color:i},!1,!0))}}),Kekule.Editor.ObjModifierManager.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.Color])}(),function(){var s=Kekule.DomUtils,e=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames),t=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_TEXTFORMAT_BUTTON:"K-Chem-Composer-TextFormat-Button",COMPOSER_MODIFIER_RICHTEXT_PANEL:"K-Chem-Composer-Modifier-RichText-Panel",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP:"K-Chem-Composer-Modifier-RichText-Panel-Group",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-LabelCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL:"K-Chem-Composer-Modifier-RichText-Panel-Group-CtrlCell",COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABEL:"K-Chem-Composer-Modifier-RichText-Panel-Group-Label",COMPOSER_TEXTDIRECTION_BOX:"K-Chem-Composer-TextDirection-Box",COMPOSER_TEXTALIGN_BOX:"K-Chem-Composer-TextAlign-Box"}),Kekule.globalOptions.add("chemWidget.composer.objModifier.richText",{componentNames:[t.fontName,t.fontSize,t.textDirection,t.textAlign,t.nodeDisplayMode]}),Kekule.Editor.ObjModifier.RichText=Class.create(Kekule.Editor.ObjModifier.BaseRenderOptionModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.RichText",initialize:function(n){this.tryApplySuper("initialize",[n]),this._valueStorage={},this._nodeLabelDisplayModeGroup=null},initProperties:function(){this.defineProp("fontPanel",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textDirectionBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("textVerticalAlignBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null}),this.defineProp("nodeLabelDisplayModeBox",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},_createCtrlGroup:function(n,i,r,a){var o=n.createElement("tr");o.className=e.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP,(l=n.createElement("td")).className=e.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_LABELCELL;var l,u=n.createElement("label");return u.className=e.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUPLABEL,s.setElementText(u,r),l.appendChild(u),o.appendChild(l),(l=n.createElement("td")).className=e.COMPOSER_MODIFIER_RICHTEXT_PANEL_GROUP_CTRLCELL,a.appendToElem(l),o.appendChild(l),i.appendChild(o),o},_doCreateDropDownPanel:function(){var n=new Kekule.Widget.Panel(this.getEditor());n.addClassName(e.COMPOSER_MODIFIER_RICHTEXT_PANEL).setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT"));var i,r=Kekule.globalOptions.chemWidget.composer.objModifier.richText.componentNames,a=this.getEditor().getDocument(),o=a.createElement("table");if(n.getContainerElement().appendChild(o),r.indexOf(t.fontName)>=0){var l=new Kekule.Widget.ComboBox(n);this.fillFontNameBox(l),l.addClassName(e.COMPOSER_FONTNAME_BOX),l.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME")),l.addEventListener("valueChange",function(p){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontFamily:this.getFontNameBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("fontNameBox",l),this._createCtrlGroup(a,o,Kekule.$L("ChemWidgetTexts.CAPTION_FONTNAME"),l)}if(r.indexOf(t.fontSize)>=0&&(l=new Kekule.Widget.ComboBox(n),this.fillFontSizeBox(l),l.addClassName(e.COMPOSER_FONTSIZE_BOX),l.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE")),l.addEventListener("valueChange",function(p){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{fontSize:this.getFontSizeBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("fontSizeBox",l),this._createCtrlGroup(a,o,Kekule.$L("ChemWidgetTexts.CAPTION_FONTSIZE"),l)),r.indexOf(t.textDirection)>=0){i=new Kekule.Widget.SelectBox(n);var u=Kekule.Render.TextDirection,c=[{value:u.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT")},{value:u.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR")},{value:u.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL")},{value:u.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB")},{value:u.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT")}];i.setItems(c),l.addClassName(e.COMPOSER_TEXTDIRECTION_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION")),i.addEventListener("valueChange",function(p){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{charDirection:this.getTextDirectionBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textDirectionBox",i),this._createCtrlGroup(a,o,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),i)}if(r.indexOf(t.textAlign)>=0){i=new Kekule.Widget.SelectBox(n),c=[{value:(d=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:d.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:d.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:d.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:d.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT")},{value:d.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT")}],i.setItems(c),l.addClassName(e.COMPOSER_TEXTALIGN_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN")),i.addEventListener("valueChange",function(p){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{horizontalAlign:this.getTextHorizontalAlignBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textHorizontalAlignBox",i),this._createCtrlGroup(a,o,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),i),i=new Kekule.Widget.SelectBox(n);var d;c=[{value:(d=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT")},{value:d.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING")},{value:d.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING")},{value:d.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER")},{value:d.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP")},{value:d.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM")}],i.setItems(c),l.addClassName(e.COMPOSER_TEXTALIGN_BOX),i.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN")),i.addEventListener("valueChange",function(p){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{verticalAlign:this.getTextVerticalAlignBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("textVerticalAlignBox",i),this._createCtrlGroup(a,o,Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),i)}r.indexOf(t.nodeDisplayMode)>=0&&(l=new Kekule.Widget.SelectBox(n),this.fillNodeDisplayModeBox(l),l.addClassName(e.COMPOSER_NODEDISPLAYMODE_BOX),l.setHint(Kekule.$L("ChemWidgetTexts.HINT_NODE_LABEL_DISPLAY_MODE")),l.addEventListener("valueChange",function(p){this.getEditor().modifyObjectsRenderOptions(this.getTargetObjs(),{nodeDisplayMode:this.getNodeLabelDisplayModeBox().getValue()},!1,!0)},this),this.setPropStoreFieldValue("nodeLabelDisplayModeBox",l),this._nodeLabelDisplayModeGroup=this._createCtrlGroup(a,o,Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE"),l)),this.setPropStoreFieldValue("fontPanel",n);var h=this._valueStorage;return h&&this._updateUiValuesFromStorage(h),n},doCreateWidget:function(){var n=new Kekule.Widget.DropDownButton(this.getEditor());return n.setHint(Kekule.$L("ChemWidgetTexts.HINT_TEXT_FORMAT")),n.setText(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_FORMAT")),n.setShowText(!1),n.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),n.addClassName(e.COMPOSER_TEXTFORMAT_BUTTON),n.setDropDownWidgetGetter(this._doCreateDropDownPanel.bind(this)),n},_filterNodeLabelDisplayModeTargets:function(n){for(var i=[],r=0,a=n.length;r<a;++r){var o=n[r];o instanceof Kekule.ChemStructureNode&&(o instanceof Kekule.StructureFragment&&o.hasCtab(),i.push(o))}return i},_hasNodeLabelDisplayModeTarget:function(n){return!!this._filterNodeLabelDisplayModeTargets(n).length},_updateUiValuesFromStorage:function(n){this.getFontPanel()&&(this.getFontNameBox()&&this.getFontNameBox().setValue(n.fontName),this.getFontSizeBox()&&this.getFontSizeBox().setValue(n.fontSize),this.getTextDirectionBox()&&this.getTextDirectionBox().setValue(n.textDirection),this.getTextHorizontalAlignBox()&&this.getTextHorizontalAlignBox().setValue(n.textHAlign),this.getTextVerticalAlignBox()&&this.getTextVerticalAlignBox().setValue(n.textVAlign),this.getNodeLabelDisplayModeBox()&&this.getNodeLabelDisplayModeBox().setValue(n.nodeDisplayMode),this._nodeLabelDisplayModeGroup&&Kekule.StyleUtils.setDisplay(this._nodeLabelDisplayModeGroup,n.hasNodeLabelDisplayModeTarget))},doLoadFromTargets:function(n,i){if(i&&i.length){var r=this._valueStorage;r.fontName=this.getRenderOptionValue(i,"fontFamily")||"",r.fontSize=this.getRenderOptionValue(i,"fontSize")||void 0,r.textDirection=this.getRenderOptionValue(i,"charDirection")||Kekule.Render.TextDirection.DEFAULT,r.textHAlign=this.getRenderOptionValue(i,"horizontalAlign")||Kekule.Render.TextAlign.DEFAULT,r.textVAlign=this.getRenderOptionValue(i,"verticalAlign")||Kekule.Render.TextAlign.DEFAULT,r.nodeDisplayMode=this.getRenderOptionValue(this._filterNodeLabelDisplayModeTargets(i),"nodeDisplayMode")||Kekule.Render.NodeLabelDisplayMode.DEFAULT,r.hasNodeLabelDisplayModeTarget=this._hasNodeLabelDisplayModeTarget(i),this.getFontPanel()&&this._updateUiValuesFromStorage(r)}},doApplyToTargets:function(n,i){},fillFontSizeBox:function(n){for(var i=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],a=0,o=i.length;a<o;++a)r.push({text:i[a]+" px",value:i[a]});n.setItems(r)},fillFontNameBox:function(n){for(var i=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),r=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],a=0,o=i.length;a<o;++a)r.push({text:i[a],value:i[a]});n.setItems(r)},fillNodeDisplayModeBox:function(n){var i=Kekule.Render.NodeLabelDisplayMode,r=[{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT"),value:i.DEFAULT},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN"),value:i.SHOWN},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN"),value:i.HIDDEN},{text:Kekule.$L("ChemWidgetTexts.CAPTION_NODE_LABEL_DISPLAY_MODE_SMART"),value:i.SMART}];n.setItems(r)}}),Kekule.Editor.ObjModifierManager.register(Kekule.ChemObject,[Kekule.Editor.ObjModifier.RichText])}(),function(){var s=Kekule.ArrayUtils,e=Kekule.DomUtils,t=(Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames),n=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.ComponentWidgetNames,Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_ATOM_MODIFIER_BUTTON:"K-Chem-Composer-AtomModifier-Button",COMPOSER_ATOM_MODIFIER_DROPDOWN:"K-Chem-Composer-AtomModifier-DropDown",COMPOSER_BOND_MODIFIER_BUTTON:"K-Chem-Composer-BondModifier-Button",COMPOSER_BOND_MODIFIER_DROPDOWN:"K-Chem-Composer-BondModifier-DropDown",COMPOSER_CHARGE_MODIFIER_BUTTON:"K-Chem-Composer-ChargeModifier-Button",COMPOSER_CHARGE_MODIFIER_DROPDOWN:"K-Chem-Composer-ChargeModifier-DropDown"}),Kekule.Editor.ObjModifier.ChemStructureModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.ChemStructureModifier",installValueChangeEventHandler:function(r){}}),Kekule.Editor.ObjModifier.ChemStructureModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.CHEM_STRUCTURE]},Kekule.Editor.ObjModifier.Atom=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Atom",initialize:function(r){this.tryApplySuper("initialize",[r]),this._valueStorage={}},initProperties:function(){this.defineProp("atomSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var r=new Kekule.Widget.DropDownButton(this.getEditor());return r.setHint(Kekule.$L("ChemWidgetTexts.HINT_ATOM_MODIFIER")),r.setText(Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER")),r.setShowText(!0),r.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),r.addClassName(n.COMPOSER_ATOM_MODIFIER_BUTTON),r.setDropDownWidgetGetter(this._createAtomSetter.bind(this)),r},_createAtomSetter:function(r){r||(r=this.getEditor());var a=this.getEditor(),o=new Kekule.ChemWidget.StructureNodeSetter(r);o.addClassName([t.PANEL,n.COMPOSER_ATOM_MODIFIER_DROPDOWN,t.CORNER_ALL]),o.setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs());var l=r.getDocument().createElement("div");l.className=t.PANEL_CAPTION,e.setElementText(l,Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER"));var u=o.getElement();u.insertBefore(l,Kekule.DomUtils.getFirstChildElem(u));var c=s.clone(this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms());c.push("...");var d=a&&a.getEnabledNonAtomInputData&&a.getEnabledNonAtomInputData();o.setSelectableInfos({elementSymbols:c,nonElementInfos:d,subGroupRepItems:Kekule.Editor.StoredSubgroupRepositoryItem2D.getAllRepItems()});var h=this;return o.addEventListener("valueChange",function(p){var g=h.getAtomSetter();g&&g.isShown()&&(p.value&&h.applyToTargets(),o.dismiss())}),this.setPropStoreFieldValue("atomSetter",o),this._valueStorage.nodes&&o.setNodes(this._valueStorage.nodes),o},_filterStructureNodes:function(r){for(var a=[],o=0,l=r.length;o<l;++o){var u=r[o];u instanceof Kekule.ChemStructureNode&&a.push(u)}return a},_getActualModificationNodes:function(r,a){for(var o=[],l=0,u=r.length;l<u;++l){var c=r[l];if(c instanceof Kekule.StructureFragment&&c.isExpanded()){var d=this._getActualModificationNodes(c.getNodes(),!0);s.pushUnique(o,d)}else o.push(c)}return a||(o=this._filterStructureNodes(o)),o},doLoadFromTargets:function(r,a){var o,l=this._getActualModificationNodes(a);this._valueStorage.nodes=l,this.getAtomSetter()&&(this.getAtomSetter().setLabelConfigs(this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getAtomSetter().setNodes(l)),o=Kekule.Editor.StructureUtils.getAllChemStructureNodesHtmlCode(l,null,null,this.getEditor().getRenderConfigs().getDisplayLabelConfigs()),this.getWidget().setText(o||Kekule.$L("ChemWidgetTexts.CAPTION_ATOM_MODIFIER_MIXED")).setShowText(!0).setDisplayed(!!l.length)},doApplyToTargets:function(r,a){for(var o,l=this.getAtomSetter().getValue(),u=[],c=this._getActualModificationNodes(a),d=0,h=c.length;d<h;++d){var p=c[d];if(p instanceof Kekule.ChemStructureNode){var g=this._createNewDataToAtomOperation(l,p);g&&u.push(g)}}(o=u.length>1?new Kekule.MacroOperation(u):u[0])&&this.getEditor().execOperation(o)},_createNewDataToAtomOperation:function(r,a){return Kekule.Editor.OperationUtils.createNodeModificationOperationFromData(a,r,this.getEditor())},_createModificationOperation:function(r,a,o,l){return Kekule.Editor.OperationUtils.createNodeModificationOperation(r,a,o,l,this.getEditor())}}),Kekule.Editor.ObjModifier.Bond=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Bond",initialize:function(r){this.tryApplySuper("initialize",[r]),this._activeSelBtnHtmlClass=null,this._defaultBondTypeData=null,this._valueStorage={};var a=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=a[0]},initProperties:function(){this.defineProp("bondSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var r=new Kekule.Widget.DropDownButton(this.getEditor());return r.setHint(Kekule.$L("ChemWidgetTexts.HINT_BOND_MODIFIER")),r.setText(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),r.setShowText(!1),r.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),r.addClassName(n.COMPOSER_BOND_MODIFIER_BUTTON),r.setDropDownWidgetGetter(this._createBondSelector.bind(this)),this._defaultBondTypeData.htmlClass&&r.addClassName(this._defaultBondTypeData.htmlClass),r},_filterBond:function(r){for(var a=[],o=0,l=r.length;o<l;++o){var u=r[o];u instanceof Kekule.Bond&&a.push(u)}return a},_getActualModificationBonds:function(r,a){for(var o=[],l=0,u=r.length;l<u;++l){var c=r[l];if(c instanceof Kekule.StructureFragment&&c.isExpanded()){var d=this._getActualModificationBonds(c.getNodes(),!0);s.pushUnique(o,d),s.pushUnique(o,c.getConnectors())}else c instanceof Kekule.Bond&&o.push(c)}return a||(o=this._filterBond(o)),o},_createBondSelector:function(r){r||(r=this.getEditor());var a=new Kekule.ChemWidget.StructureConnectorSelectPanelAdv(r);if(a.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_BOND_MODIFIER")),a.addClassName(n.COMPOSER_BOND_MODIFIER_DROPDOWN),this.getEditor().getEnabledBondFormData){var o=this.getEditor().getEnabledBondFormData();a.setBondPropNames(this._getBondComparePropNames(o)),a.setBondData(o);var l=this.getEditor().getEditorConfigs().getInteractionConfigs().getEnableBondKekulizeHucklize();a.setExtraComponents(l?[Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Components.KEKULIZE]:[])}this._valueStorage.bondsPropValues&&a.setActiveBondPropValues(this._valueStorage.bondsPropValues),this.setPropStoreFieldValue("bondSelector",a);var u=this;return a.addEventListener("valueChange",function(c){u.applyToTargets(),a.dismiss()}),a.addEventListener("command",function(c){u.execExtraCommand(c.command)}),a},_setActiveBondHtmlClass:function(r){var a=this._activeSelBtnHtmlClass;a&&this.getWidget().removeClassName(a),this._activeSelBtnHtmlClass=r,r||(r=this._defaultBondTypeData.htmlClass),r&&this.getWidget().addClassName(r)},_extractBondPropValues:function(r,a){return r.getPropValues(a)},_extractBondsPropValues:function(r,a){for(var o,l,u=0,c=r.length;u<c;++u)if(l=this._extractBondPropValues(r[u],a),o){if(!Kekule.Editor.StructureUtils.isBondPropsMatch(o,l,a)){o=null;break}}else o=l;return o},_getBondComparePropNames:function(r){for(var a=[],o=0,l=r.length;o<l;++o){var u=r[o].bondProps;u&&s.pushUnique(a,Kekule.ObjUtils.getOwnedFieldNames(u))}return a},_getMatchedBondData:function(r,a,o){if(!r)return null;for(var l=0,u=a.length;l<u;++l){var c=a[l];if(c&&Kekule.Editor.StructureUtils.isBondPropsMatch(r,c.bondProps,o))return c}return null},_createBondModificationOperation:function(r,a){return new Kekule.ChemObjOperation.Modify(a,r,this.getEditor())},_execModificationOperations:function(r){var a;(a=r.length>1?new Kekule.MacroOperation(r):r[0])&&this.getEditor().execOperation(a)},doLoadFromTargets:function(r,a){var o=this.getEditor().getEnabledBondFormData();this._defaultBondTypeData=o[0];var l=this._getActualModificationBonds(a);if(this._valueStorage.connectors=l,this.getBondSelector()){var u=this.getBondSelector().getBondPropNames(),c=this._extractBondsPropValues(l,u);this.getBondSelector().setActiveBondPropValues(c),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())}else{this._valueStorage.bondPropNames=this._getBondComparePropNames(o),this._valueStorage.bondsPropValues=this._extractBondsPropValues(l,this._valueStorage.bondPropNames);var d=this._getMatchedBondData(this._valueStorage.bondsPropValues,o,this._valueStorage.bondPropNames);this._setActiveBondHtmlClass(d&&d.htmlClass)}this.getWidget().setDisplayed(!!l.length)},doApplyToTargets:function(r,a){for(var o=this.getBondSelector().getActiveBondPropValues(),l=[],u=this._getActualModificationBonds(a),c=0,d=u.length;c<d;++c){var h=u[c],p=this._createBondModificationOperation(o,h);p&&l.push(p)}this._execModificationOperations(l),this._setActiveBondHtmlClass(this.getBondSelector().getActiveBondHtmlClass())},execExtraCommand:function(r){var a=this._getActualModificationBonds(this.getTargetObjs());if(a&&a.length){var o=this.getEditor().getChemObj();if(o&&o.getKekulizationChanges){var l,u=Kekule.ChemWidget.StructureConnectorSelectPanelAdv.Commands;if(r===u.KEKULIZE?l=o.getKekulizationChanges(a):r===u.HUCKLIZE&&(l=o.getHucklizationChanges(a)),l&&l.length){for(var c=[],d=0,h=l.length;d<h;++d){var p=l[d].bond,g=l[d].bondOrder,f=this._createBondModificationOperation({bondOrder:g},p);c.push(f)}this._execModificationOperations(c)}}}},_getKekulizeOrHucklizeBondModifications:function(r){this.getEditor()}}),Kekule.Editor.ObjModifier.Charge=Class.create(Kekule.Editor.ObjModifier.ChemStructureModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.Charge",initialize:function(r){this.tryApplySuper("initialize",[r]),this._valueStorage={}},initProperties:function(){this.defineProp("chargeSelector",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var r=new Kekule.Widget.DropDownButton(this.getEditor());return r.setHint(Kekule.$L("ChemWidgetTexts.HINT_CHARGE_MODIFIER")).setText(Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN")).setShowText(!0).setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),r.addClassName(n.COMPOSER_CHARGE_MODIFIER_BUTTON),r.setDropDownWidgetGetter(this._createChargeSelector.bind(this)),r},_createChargeSelector:function(r){r||(r=this.getEditor());var a=new Kekule.ChemWidget.ChargeSelectPanel(r);a.setCaption(Kekule.$L("ChemWidgetTexts.CAPTION_CHARGE_MODIFIER")),a.addClassName(n.COMPOSER_CHARGE_MODIFIER_DROPDOWN),Kekule.ObjUtils.notUnset(this._valueStorage.charge)&&a.setValue(this._valueStorage.charge),this.setPropStoreFieldValue("chargeSelector",a);var o=this;return a.addEventListener("valueChange",function(l){o.applyToTargets(),a.dismiss()}),a},_filterStructureNodes:function(r){for(var a=[],o=0,l=r.length;o<l;++o){var u=r[o];u instanceof Kekule.ChemStructureNode&&u.getCharge&&a.push(u)}return a},_getActualModificationNodes:function(r,a){for(var o=[],l=0,u=r.length;l<u;++l){var c=r[l];if(c instanceof Kekule.StructureFragment&&c.isExpanded()){var d=this._getActualModificationNodes(c.getNodes(),!0);s.pushUnique(o,d)}else o.push(c)}return a||(o=this._filterStructureNodes(o)),o},_getChargeOfNodes:function(r){for(var a=null,o=0,l=r.length;o<l;++o){var u=r[o];if(u.getCharge){var c=u.getCharge()||0;if(a===null)a=c;else if(a!==c)return null}}return a},doLoadFromTargets:function(r,a){var o=this._getActualModificationNodes(a),l=o.length>=0&&o.length<=1;if(l){var u,c=this._getChargeOfNodes(o);if(this._valueStorage.charge=c,this.getChargeSelector()&&this.getChargeSelector().setValue(c),c){var d=c>0?Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_POSITIVE"):Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_NEGATIVE"),h=Kekule.NumUtils.toDecimals(c,1);u=Math.abs(h)+d}else u=Kekule.$L("ChemWidgetTexts.TEXT_CHARGE_UNKNOWN");this.getWidget().setText(u).setShowText(!0)}this.getWidget().setDisplayed(l)},doApplyToTargets:function(r,a){for(var o,l=this.getChargeSelector().getValue(),u=[],c=this._getActualModificationNodes(a),d=(r=this.getEditor(),0),h=c.length;d<h;++d){var p=c[d];if(p instanceof Kekule.ChemStructureNode){var g=new Kekule.ChemObjOperation.Modify(p,{charge:l},r);g&&u.push(g)}}(o=u.length>1?new Kekule.MacroOperation(u):u[0])&&(r=this.getEditor()).execOperation(o)}});var i=Kekule.Editor.ObjModifierManager;i.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Atom]),i.register(Kekule.ChemStructureNode,[Kekule.Editor.ObjModifier.Charge]),i.register([Kekule.Bond,Kekule.StructureFragment],[Kekule.Editor.ObjModifier.Bond])}(),function(){var s=Kekule.ObjUtils,e=Kekule.ArrayUtils,t=(Kekule.DomUtils,Kekule.HtmlElementUtils,Kekule.Widget.HtmlClassNames,Kekule.ChemWidget.HtmlClassNames);Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER_GLYPH_PATH_MODIFIER_BUTTON:"K-Chem-Composer-GlyphPathModifier-Button",COMPOSER_Glyph_PATH_MODIFIER_DROPDOWN:"K-Chem-Composer-GlyphPathModifier-DropDown",COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ReactionArrowModifier-Button",COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-ArcPathModifier-Button",COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON:"K-Chem-Composer-MultiArcPathModifier-Button",COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-ElectronPushingArrowModifier-Button",COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON:"K-Chem-Composer-BondFormingElectronPushingArrowModifier-Button"}),Kekule.Editor.ObjModifier.GlyphModifier=Class.create(Kekule.Editor.ObjModifier.Base,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphModifier"}),Kekule.Editor.ObjModifier.GlyphModifier.getCategories=function(){return[Kekule.Editor.ObjModifier.Category.GLYPH]},Kekule.Editor.ObjModifier.GlyphPath=Class.create(Kekule.Editor.ObjModifier.GlyphModifier,{CLASS_NAME:"Kekule.Editor.ObjModifier.GlyphPath",MIX_VALUE:"[mixed]",initialize:function(i){this.tryApplySuper("initialize",[i]),this._valueStorage={}},initProperties:function(){this.defineProp("pathParamSetter",{dataType:"Kekule.Widget.BaseWidget",serializable:!1,setter:null})},doCreateWidget:function(){var i=new Kekule.Widget.DropDownButton(this.getEditor());return i.setHint(this.getModifierHint()),i.setText(this.getModifierCaption()),i.setShowText(!0),i.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),i.addClassName(t.COMPOSER_GLYPH_PATH_MODIFIER_BUTTON+" "+this.getModifierClassName()),i.setDropDownWidgetGetter(this._createPathParamSetter.bind(this)),i},_createPathParamSetter:function(i){i||(i=this.getEditor());var r=new(this.getPathParamSetterClass())(i);r.setCaption(this.getModifierCaption()),r.addClassName(t.COMPOSER_GLYPH_PATH_MODIFIER_DROPDOWN),this.setPropStoreFieldValue("pathParamSetter",r),this._valueStorage.pathParams&&(r.setValue(this._valueStorage.pathParams),this._valueStorage.pathParams=null);var a=this;return r.addEventListener("showStateChange",function(o){o.widget===r&&(o.isShown?a._lastOperation=null:o.isDismissed&&(a._lastOperation&&a._lastOperation.reverse(),a._lastOperation=null))}),r.addEventListener("valueChange",function(o){o.widget===r&&(a.doModification(a.getEditor(),a.getTargetObjs(),!1),a._lastOperation=null,o.stopPropagation())}),r.addEventListener("valueInput",function(o){o.widget===r&&(a.doModification(a.getEditor(),a.getTargetObjs(),!1),o.stopPropagation())}),r},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_GLYPH_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_GLYPH_PATH_MODIFIER")},getModifierClassName:function(){return""},_mergeHashValues:function(i,r){if(!i)return r;if(r){var a=s.getOwnedFieldNames(i,!1),o=s.getOwnedFieldNames(r,!1),l=e.clone(a);if(e.pushUnique(l,o),l.length){for(var u={},c=0,d=l.length;c<d;++c){var h=l[c],p=i[h],g=r[h];u[h]=p===g?p:this.MIX_VALUE}return u}return null}return i},_extractPathParamsOfObjs:function(i){for(var r=null,a=0,o=i.length;a<o;++a){var l=i[a],u=l instanceof Kekule.Glyph.PathGlyphConnector?[l]:l instanceof Kekule.Glyph.PathGlyph?l.getConnectors():null;if(u){var c=this._extractPathParamOfConnectors(u);r=this._mergeHashValues(r,c)}}return r},_extractPathParamOfConnectors:function(i){for(var r=null,a=0,o=i.length;a<o;++a){var l=this._extractPathParamOfConnector(i[a]);l&&(r=this._mergeHashValues(r,l))}return r},_extractPathParamOfConnector:function(i){return i.getPathParams&&i.getPathParams()},getApplicableGlyphClasses:function(){return[Kekule.Glyph.PathGlyph]},isApplicableGlyph:function(i){if(this.getTargetPathGlyph(i)){var r=this.getApplicableGlyphClasses();if(r){for(var a=0,o=r.length;a<o;++a)if(i instanceof r[a])return!0;return!1}return!0}return!1},getTargetPathGlyph:function(i){return i instanceof Kekule.Glyph.PathGlyph?i:i instanceof Kekule.Glyph.PathGlyphConnector?i.getParent():null},_getActualModificationObjs:function(i){for(var r=[],a=0,o=i.length;a<o;++a){var l=i[a];this.isApplicableGlyph(l)&&e.pushUnique(r,l)}return r},_getActualModificationConnectors:function(i){for(var r=[],a=this._getActualModificationObjs(i),o=0,l=a.length;o<l;++o){var u=a[o];u instanceof Kekule.Glyph.PathGlyphConnector?r.push(u):u instanceof Kekule.Glyph.PathGlyph&&e.pushUnique(r,u.getConnectors())}return r},_getActualModificationGlyphs:function(i){for(var r=[],a=this._getActualModificationObjs(i),o=0,l=a.length;o<l;++o){var u=a[o],c=this.getTargetPathGlyph(u);c&&e.pushUnique(r,c)}return r},_filterAppliableParams:function(i){for(var r={},a=s.getOwnedFieldNames(i),o=0,l=a.length;o<l;++o){var u=i[a[o]];u!==void 0&&u!==this.MIX_VALUE&&(r[a[o]]=u)}return r},_splitPathParamValues:function(i){for(var r={},a=s.getOwnedFieldNames(i),o=0,l=a.length;o<l;++o){var u=a[o];if(!u.startsWith("_")){var c=this._getPathParamFieldCategory(u);r[c]||(r[c]={}),r[c][u]=i[u]}}return r},_getPathParamFieldCategory:function(i){return"connectorParams"},createModificationOperations:function(i,r,a){var o=this._splitPathParamValues(a);return this.doCreateModificationOperations(i,r,o)},doCreateModificationOperations:function(i,r,a){if(a.connectorParams){var o=this._getActualModificationConnectors(r);return this._createModificationOperationsOnConnectors(i,o,a.connectorParams)}return null},updateModificationOperations:function(i,r,a,o){var l,u=this._splitPathParamValues(a);return l=o.length?o:o instanceof Kekule.MacroOperation?o.getChildren():[o],this.doUpdateModificationOperations(i,l,r,u)},doUpdateModificationOperations:function(i,r,a,o){return this._updateModificationOperationsOnConnectors(i,a,o.connectorParams,r),r},_updateModificationOperationsOnConnectors:function(i,r,a,o){for(var l=0,u=o.length;l<u;++l){var c=o[l],d=c.getTarget();d instanceof Kekule.Glyph.PathGlyphConnector&&c instanceof Kekule.ChemObjOperation.ModifyHashProp&&this._updateModificationOperationOnConnector(i,d,c,a)}},_updateModificationOperationOnConnector:function(i,r,a,o){r instanceof Kekule.Glyph.PathGlyphConnector&&a instanceof Kekule.ChemObjOperation.ModifyHashProp&&a.setNewPropValue(o)},_createModificationOperationsOnConnectors:function(i,r,a){for(var o=[],l=0,u=r.length;l<u;++l){var c=r[l];if(c instanceof Kekule.Glyph.PathGlyphConnector){var d=this._createModificationOperationOnConnector(i,c,a);d&&o.push(d)}}return o},_createModificationOperationOnConnector:function(i,r,a){return r instanceof Kekule.Glyph.PathGlyphConnector?new Kekule.ChemObjOperation.ModifyHashProp(r,"pathParams",a,i):null},_createWrapperOperation:function(i){return i&&i.length>1?new Kekule.MacroOperation(i):i[0]},_execModificationOperationInEditor:function(i){var r=!this._lastOperation,a=this.getEditor();a.beginManipulateAndUpdateObject();try{i&&(r?a.execOperation(i):i.execute())}finally{a.endManipulateAndUpdateObject(),this._lastOperation=i}},doModification:function(i,r,a){var o,l=this.getPathParamSetter().getValue();l=this._filterAppliableParams(l),o=this._lastOperation?this.updateModificationOperations(i,r,l,this._lastOperation):this.createModificationOperations(i,r,l);var u=this._createWrapperOperation(o);this._execModificationOperationInEditor(u)},doLoadFromTargets:function(i,r){var a=this._getActualModificationObjs(r),o=a.length>0;if(this._lastOperation=null,o){var l=this._extractPathParamsOfObjs(a);this._valueStorage.pathParams=l;var u=this.getPathParamSetter();u&&u.setValue(l)}this.getWidget().setDisplayed(o)},doApplyToTargets:function(i,r){this.doModification(i,r,!1)}}),Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath",MIX_VALUE:"[mixed]",initialize:function(i){this.tryApplySuper("initialize",[i])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphReactionArrowPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER")},getModifierClassName:function(){return t.COMPOSER_GLYPH_REACTION_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.StraightLine,Kekule.Glyph.Segment,Kekule.Glyph.ReactionArrow]},_extractPathParamsOfObjs:function(i){for(var r,a=this.tryApplySuper("_extractPathParamsOfObjs",[i]),o=0,l=i.length;o<l;++o){var u=i[o],c=this.getTargetPathGlyph(u);if(c&&c.getReactionType){var d=c.getReactionType();if(r){if(r!==d){r=Kekule.Glyph.ReactionArrowType.CUSTOM;break}}else r=d}}return a.reactionArrowType=r,a},createModificationOperations_OLD:function(i,r,a){var o=[];if(a.reactionArrowType!==this.MIX_VALUE){for(var l=this._getActualModificationGlyphs(r),u=0,c=l.length;u<c;++u){var d=l[u];d.setReactionType?a.reactionArrowType||d instanceof Kekule.Glyph.ReactionArrow&&o.push(new Kekule.ChemObjOperation.ChangeClass(d,Kekule.Glyph.Segment,i)):a.reactionArrowType&&d instanceof Kekule.Glyph.StraightLine&&o.push(new Kekule.ChemObjOperation.ChangeClass(d,Kekule.Glyph.ReactionArrow,i))}o.push(new Kekule.ChemObjOperation.Modify(d,{reactionType:a.reactionArrowType},i))}var h=this.tryApplySuper("createModificationOperations_OLD",[i,r,a])||[];return o=o.concat(h)},doCreateModificationOperations:function(i,r,a){var o=[],l=a.connectorParams;if(l.reactionArrowType!==this.MIX_VALUE){for(var u=this._getActualModificationGlyphs(r),c=0,d=u.length;c<d;++c){var h=u[c];h.setReactionType?l.reactionArrowType||h instanceof Kekule.Glyph.ReactionArrow&&o.push(new Kekule.ChemObjOperation.ChangeClass(h,Kekule.Glyph.Segment,i)):l.reactionArrowType&&h instanceof Kekule.Glyph.StraightLine&&o.push(new Kekule.ChemObjOperation.ChangeClass(h,Kekule.Glyph.ReactionArrow,i))}o.push(new Kekule.ChemObjOperation.Modify(h,{reactionType:l.reactionArrowType},i))}var p=this.tryApplySuper("doCreateModificationOperations",[i,r,a])||[];return o=o.concat(p)}}),Kekule.Editor.ObjModifier.ArcPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.ArcPath",initialize:function(i){this.tryApplySuper("initialize",[i])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphArcPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_ARC_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_ARC_PATH_MODIFIER")},getModifierClassName:function(){return t.COMPOSER_GLYPH_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.Arc]}}),Kekule.Editor.ObjModifier.MultiArcPath=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.MultiArcPath",initialize:function(i){this.tryApplySuper("initialize",[i])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphMultiArcPathSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_MULTI_ARC_PATH_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_MULTI_ARC_PATH_MODIFIER")},getModifierClassName:function(){return t.COMPOSER_GLYPH_MULTI_ARC_PATH_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.TwinArc]},_filterAppliableParams:function(i){if(DataType.isArrayValue(i)){for(var r=[],a=0,o=i.length;a<o;++a)r.push(this.tryApplySuper("_filterAppliableParams",[i[a]]));return r}return this.tryApplySuper("_filterAppliableParams",[i])},_buildConnectorGroup:function(i,r){var a,o,l,u=[];r&&(a=new Kekule.MapEx,u.map=a);for(var c=0,d=i.length;c<d;++c)for(var h=i[c],p=h instanceof Kekule.Glyph.PathGlyphConnector?[h]:h instanceof Kekule.Glyph.PathGlyph?h.getConnectors():[],g=0,f=p.length;g<f;++g){var m=p[g];(o=g,l=void 0,l=u[o],l||(l=[],u[o]=l),l).push(m),r&&a.set(m,g)}return u},_extractPathParamsOfObjs:function(i){for(var r=[],a=this._buildConnectorGroup(i),o=0,l=a.length;o<l;++o){var u=a[o]||[],c=this._extractPathParamOfConnectors(u)||null;r.push(c)}return r},_splitPathParamValues:function(i){if(DataType.isArrayValue(i)){for(var r=[],a=0,o=i.length;a<o;++a){var l=this.tryApplySuper("_splitPathParamValues",[i[a]]);if(l)for(var u=s.getOwnedFieldNames(l),c=0,d=u.length;c<d;++c){var h=u[c];r[h]||(r[h]=[]),r[h][a]=l[h]}}return r}return this.tryApplySuper("_splitPathParamValues",[i])},_updateModificationOperationsOnConnectors:function(i,r,a,o){for(var l=this._buildConnectorGroup(r,!0).map,u=0,c=o.length;u<c;++u){var d=o[u],h=d.getTarget();if(h instanceof Kekule.Glyph.PathGlyphConnector&&d instanceof Kekule.ChemObjOperation.ModifyHashProp){var p=l.get(h);p>=0&&this._updateModificationOperationOnConnector(i,h,d,a[p])}}},doCreateModificationOperations:function(i,r,a){var o=[];if(a.connectorParams)for(var l=e.toArray(a.connectorParams),u=this._buildConnectorGroup(r),c=0,d=u.length;c<d;++c){var h=l[c];if(h){var p=u[c]||[],g=this._createModificationOperationsOnConnectors(i,p,h);g&&(o=o.concat(g))}}return o}}),Kekule.Editor.ObjModifier.BaseElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.GlyphPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BaseElectronPushingArrow",getPathParamSetterClass:function(){return null},getModifierCaption:function(){return null},getModifierHint:function(){return null},getModifierClassName:function(){return""},getApplicableGlyphClasses:function(){return[]},_extractPathParamsOfObjs:function(i){for(var r,a=this.tryApplySuper("_extractPathParamsOfObjs",[i]),o=0,l=i.length;o<l;++o){var u=i[o],c=this.getTargetPathGlyph(u);if(c&&c.getElectronCount){var d=c.getElectronCount();if(s.isUnset(r))r=d;else if(r!==d){r=0;break}}}return a.electronCount=r,a},_getPathParamFieldCategory:function(i){return i==="electronCount"?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[i])},doCreateModificationOperations:function(i,r,a){var o=this.tryApplySuper("doCreateModificationOperations",[i,r,a])||[];if(a.glyphParams&&a.glyphParams.electronCount)for(var l=this._getActualModificationGlyphs(r),u=0,c=l.length;u<c;++u){var d=l[u];d.hasProperty("electronCount")&&o.push(new Kekule.ChemObjOperation.Modify(d,{electronCount:a.glyphParams.electronCount},i))}return o},doUpdateModificationOperations:function(i,r,a,o){return this.tryApplySuper("doUpdateModificationOperations",[i,r,a,o]),this._updateGlyphModificationOperations(i,r,o),r},_updateGlyphModificationOperations:function(i,r,a){}}),Kekule.Editor.ObjModifier.ElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.BaseElectronPushingArrow,{CLASS_NAME:"Kekule.Editor.ObjModifier.ElectronPushingArrow",initialize:function(i){this.tryApplySuper("initialize",[i])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphElectronPushingArrowSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return t.COMPOSER_GLYPH_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.ElectronPushingArrow]}}),Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow=Class.create(Kekule.Editor.ObjModifier.MultiArcPath,{CLASS_NAME:"Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow",initialize:function(i){this.tryApplySuper("initialize",[i])},getPathParamSetterClass:function(){return Kekule.ChemWidget.GlyphMultiElectronPushingArrowSettingPanel},getModifierCaption:function(){return Kekule.$L("ChemWidgetTexts.CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierHint:function(){return Kekule.$L("ChemWidgetTexts.HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER")},getModifierClassName:function(){return t.COMPOSER_GLYPH_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER_BUTTON},getApplicableGlyphClasses:function(){return[Kekule.Glyph.BondFormingElectronPushingArrow]},_extractPathParamsOfObjs:function(i){for(var r,a=this.tryApplySuper("_extractPathParamsOfObjs",[i]),o=0,l=i.length;o<l;++o){var u=i[o],c=this.getTargetPathGlyph(u);if(c&&c.getElectronCount){var d=c.getConnectorCount()||1,h=Math.round((c.getElectronCount()||0)/d);if(s.isUnset(r))(r=h)<=0&&(r=1);else if(r!==h){r=0;break}}}return a.electronCount=r,a},_getPathParamFieldCategory:function(i){return i==="electronCount"?"glyphParams":this.tryApplySuper("_getPathParamFieldCategory",[i])},_filterAppliableParams:function(i){var r=this.tryApplySuper("_filterAppliableParams",[i])||[];return i.electronCount&&(r.electronCount=i.electronCount),r},_splitPathParamValues:function(i){var r=this.tryApplySuper("_splitPathParamValues",[i])||[];return i.electronCount&&(r.glyphParams||(r.glyphParams={}),r.glyphParams.electronCount=i.electronCount),r},doCreateModificationOperations:function(i,r,a){var o=this.tryApplySuper("doCreateModificationOperations",[i,r,a])||[];if(a.glyphParams&&a.glyphParams.electronCount)for(var l=this._getActualModificationGlyphs(r),u=0,c=l.length;u<c;++u){var d=l[u];if(d.hasProperty("electronCount")){var h=d.getConnectorCount()||1,p=Math.round(a.glyphParams.electronCount*h);p<=0&&(p=1),o.push(new Kekule.ChemObjOperation.Modify(d,{electronCount:p},i))}}return o}});var n=Kekule.Editor.ObjModifierManager;n.register([Kekule.Glyph.StraightLine,Kekule.Glyph.PathGlyphConnector],[Kekule.Editor.ObjModifier.ReactionArrowAndSegmentPath]),n.register([Kekule.Glyph.Arc],[Kekule.Editor.ObjModifier.ArcPath]),n.register([Kekule.Glyph.TwinArc],[Kekule.Editor.ObjModifier.MultiArcPath]),n.register([Kekule.Glyph.ElectronPushingArrow],[Kekule.Editor.ObjModifier.ElectronPushingArrow]),n.register([Kekule.Glyph.BondFormingElectronPushingArrow],[Kekule.Editor.ObjModifier.BondFormingElectronPushingArrow])}(),function(){var s=Kekule.ErrorLevel;Kekule.IssueCheck={},Kekule.IssueCheck.IssueCode={ERROR_UNKNOWN:0,ERROR_ATOM_VALENCE_ABNORMAL:1101,ERROR_BOND_ORDER_EXCEED:1201};var e=Kekule.IssueCheck.IssueCode;Kekule.IssueCheck.CheckerIds={ATOM_VALENCE:"atomValence",BOND_ORDER:"bondOrder"};var t=Kekule.IssueCheck.CheckerIds;Kekule.IssueCheck.CheckerManager={_checkerMap:{},register:function(i,r){i||(i=ClassEx.getClassName(r));var a=n._checkerMap[i];a&&a.checkerClass===r||(n._checkerMap[i]={checkerClass:r})},unregister:function(i){n._checkerMap[i]=null},getCheckerClass:function(i){var r=n._checkerMap[i];return r&&r.checkerClass},getCheckerInstance:function(i){var r=null,a=n._checkerMap[i];if(a){if(!a.instance){var o=a.checkerClass;a.instance=new o}r=a.instance}return r}};var n=Kekule.IssueCheck.CheckerManager;Kekule.IssueCheck.Executor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.Executor",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("ignoreUnexposedObjs",{dataType:DataType.ARRAY}),this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("durationLimit",{dataType:DataType.NUMBER}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1}),this.defineProp("checkerIds",{dataType:DataType.ARRAY,setter:function(i){for(var r=[],a=Kekule.ArrayUtils.toArray(i),o=0,l=a.length;o<l;++o){var u=n.getCheckerInstance(a[o]);u&&r.push(u)}this.setPropStoreFieldValue("checkers",r)}}),this.defineProp("checkers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setIgnoreUnexposedObjs(!0),this.setEnabled(!0)},doFinalize:function(){this.setPropStoreFieldValue("checkers",null),this.tryApplySuper("doFinalize")},execute:function(i,r){if(!this.getEnabled())return null;for(var a=this.getDurationLimit(),o=a&&Date.now()+a,l=this.doPrepareOptions(r),u=new Kekule.MapEx,c=this.getCheckers(),d=[],h=0,p=c.length;h<p;++h)c[h].getEnabled()&&d.push(c[h]);this._getAllObjsNeedCheck(i,i,d,u,l);var g=!0,f=[];for(h=0,p=d.length;h<p;++h){var m=d[h];m.setDeadline(o);var C=u.get(m);if(C&&C.length){var _=m.check(C,i,l);_&&_.length&&(f=f.concat(_)),g=g&&m.getAllFinished()}}return this.setPropStoreFieldValue("allFinished",g),this.invokeEvent("execute",{checkResults:f,allFinished:g}),f},recheck:function(i,r,a,o){var l;if(a){l=[];for(var u=0,c=r.length;u<c;++u)r[u].isChildOf(a)&&l.push(r[u])}else l=r;return l.length?i.check(r,o||{}):null},doPrepareOptions:function(i){return options||{}},_getAllObjsNeedCheck:function(i,r,a,o,l){var u=!this.getIgnoreUnexposedObjs();if(this._isObjExposed(i)||u)for(var c=0,d=r.getChildCount();c<d;++c){var h=r.getChildAt(c);if(this._isObjExposed(h)||u){for(var p=0,g=a.length;p<g;++p){var f=a[p];if(f.applicable(h,i,l)){var m=o.get(f);m?m.push(h):(m=[h],o.set(f,m))}}this._getAllObjsNeedCheck(i,h,a,o,l)}}},_isObjExposed:function(i){return!i.isExposed||i.isExposed()}}),Kekule.IssueCheck.CheckResult=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.CheckResult",DEF_ERROR_CODE:e.UNKNOWN,initialize:function(i,r,a,o,l){this.setPropStoreFieldValue("level",i||s.ERROR),this.setPropStoreFieldValue("code",r||this.DEF_ERROR_CODE),this.setPropStoreFieldValue("data",a),this.setPropStoreFieldValue("targets",o),this.setPropStoreFieldValue("reporter",l),this.tryApplySuper("initialize")},doFinalize:function(){this.setData(null),this.setTargets(null),this.setReporter(null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("level",{dataType:DataType.INT}),this.defineProp("code",{dataType:DataType.INT}),this.defineProp("data",{dataType:DataType.HASH}),this.defineProp("targets",{dataType:DataType.Array,serializable:!1}),this.defineProp("reporter",{dataType:DataType.OBJECTEX,serializable:!1}),this.defineProp("msg",{dataType:DataType.STRING,serializable:!1,setter:null,getter:function(){return this.getMessage()}})},getDataValue:function(i){return(this.getData()||{})[i]},getMessage:function(){return Kekule.$L("ErrorCheckMsg.GENERAL_ERROR_WITH_CODE").format(this.getErrorCode())}}),Kekule.IssueCheck.BaseChecker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.BaseChecker",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL}),this.defineProp("deadline",{dataType:DataType.NUMBER,serializable:!1}),this.defineProp("allFinished",{dataType:DataType.BOOL,setter:null,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnabled(!0)},_createReport:function(i,r,a,o,l){return new i(r,a,o,l,this)},applicable:function(i,r,a){return this.doApplicable(i,r,a||{})},doApplicable:function(i,r,a){return!1},check:function(i,r,a){return this.doCheck(i,r,a||{})},doCheck:function(i,r,a){this.setPropStoreFieldValue("allFinished",!1);for(var o=[],l=this.getDeadline()||null,u=!1,c=0,d=i.length;c<d;++c){if(l&&Date.now()>=l){u=!0;break}var h=this.doCheckOnTarget(i[c],c,i,r,a)||[];o=o.concat(h)}return this.setPropStoreFieldValue("allFinished",!!u),o},doCheckOnTarget:function(i,r,a,o,l){}}),Kekule.IssueCheck.AtomValenceChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker",initialize:function(){this.tryApplySuper("initialize")},doApplicable:function(i,r,a){return i instanceof Kekule.Atom&&i.isNormalAtom()},doCheckOnTarget:function(i,r,a,o,l){var u=this.checkValence(i);return u?[u]:null},checkValence:function(i){var r=i.getValence(),a=i.getCharge()||0,o=this._getPossibleValences(i.getAtomicNumber(),a);return o.length&&o.indexOf(r)<0?this._createReport(Kekule.IssueCheck.AtomValenceChecker.Result,s.ERROR,e.ERROR_ATOM_VALENCE_ABNORMAL,{currValence:r,possibleValences:o},[i]):null},_getPossibleValences:function(i,r){var a=[],o=Kekule.ValenceUtils.getPossibleMdlValenceInfo(i,r);return o&&o.valences&&!o.unexpectedCharge&&(a=[].concat(o.valences)),a}}),n.register(t.ATOM_VALENCE,Kekule.IssueCheck.AtomValenceChecker),Kekule.IssueCheck.AtomValenceChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.AtomValenceChecker.Result",DEF_ERROR_CODE:e.ERROR_ATOM_VALENCE_ABNORMAL,getMessage:function(){var i=this.getDataValue("currValence"),r=this.getDataValue("possibleValences"),a=r.length<=1?Kekule.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGEST"):Kekule.$L("ErrorCheckMsg.ATOM_VALENCE_ERROR_WITH_SUGGESTS"),o=this.getTargets()[0],l=(o.getId(),o.getLabel?o.getLabel():o.getSymbol()),u=r.join("/");return a.format(l,i,u)}}),Kekule.IssueCheck.BondOrderChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker",doApplicable:function(i,r,a){return i instanceof Kekule.Bond&&i.isCovalentBond()},doCheckOnTarget:function(i,r,a,o,l){var u=this.checkBondOrder(i);return u?[u]:null},checkBondOrder:function(i){var r=i.getBondValence&&i.getBondValence();if(r){for(var a=i.getConnectedChemNodes(),o=0,l=0,u=a.length;l<u;++l){var c=this._getAllowedMaxBondOrder(a[l]);c>0&&(!o||c<o)&&(o=c)}if(o&&r>o)return this._createReport(Kekule.IssueCheck.BondOrderChecker.Result,s.ERROR,e.ERROR_BOND_ORDER_EXCEED,{currOrder:r,maxOrder:o},[i])}return null},_getAllowedMaxBondOrder:function(i){var r=0;if(i instanceof Kekule.Atom&&i.isNormalAtom()){var a=i.getValence(),o=Kekule.AtomTypeDataUtil.getAllAtomTypes(i.getAtomicNumber());if(o){for(var l=0,u=o.length;l<u;++l)if(a<=o[l].bondOrderSum){r=o[l].maxBondOrder;break}}}return r}}),n.register(t.BOND_ORDER,Kekule.IssueCheck.BondOrderChecker),Kekule.IssueCheck.BondOrderChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Result",DEF_ERROR_CODE:e.ERROR_BOND_ORDER_EXCEED,getMessage:function(){for(var i=this.getDataValue("currOrder"),r=this.getDataValue("maxOrder"),a=this.getTargets()[0].getConnectedChemNodes(),o=[],l=0,u=a.length;l<u;++l){var c=a[l],d=c.getLabel&&c.getLabel();d&&o.push(d)}var h=o.length>1?o.join("-"):null;return h?Kekule.$L("ErrorCheckMsg.BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(h,i,r):Kekule.$L("ErrorCheckMsg.BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST").format(i,r)}})}(),function(){Kekule.IssueCheck.IssueCode=Object.extend(Kekule.IssueCheck.IssueCode,{WARNING_NODE_TOO_CLOSE:2101});var s=Kekule.IssueCheck.IssueCode;Kekule.IssueCheck.CheckerIds=Object.extend(Kekule.IssueCheck.CheckerIds,{NODE_DISTANCE_2D:"nodeDistance2D"});var e=Kekule.IssueCheck.CheckerIds,t=Kekule.IssueCheck.CheckerManager,n=Kekule.CoordUtils;Kekule.IssueCheck.ExecutorForEditor=Class.create(Kekule.IssueCheck.Executor,{CLASS_NAME:"Kekule.IssueCheck.ExecutorForEditor",initialize:function(r){this.setPropStoreFieldValue("editor",r),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1})},doPrepareOptions:function(r){var a=r?Object.create(r):{},o=this.getEditor();return o&&(a.editor=o),a}}),Kekule.IssueCheck.IssueResolver=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueResolver",initialize:function(){this.tryApplySuper("initialize")},createSolutions:function(r,a){return this.doCreateSolutions(r,a)},doCreateSolutions:function(r,a){return[]},_createSolutionInstance:function(r,a,o,l,u){return u||(u=Kekule.IssueCheck.IssueSolution),new u(r,a,o,l)},_getEditorWidget:function(r){return r&&r instanceof Kekule.Editor.BaseEditor?r:null}}),Kekule.IssueCheck.IssueSolution=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IssueCheck.IssueSolution",initialize:function(r,a,o,l){this.setPropStoreFieldValue("issueResult",l),this.setPropStoreFieldValue("title",r),this.setPropStoreFieldValue("description",a),this.setPropStoreFieldValue("operation",o),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("issueResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("description",{dataType:DataType.STRING}),this.defineProp("operation",{dataType:"Kekule.Operation",serializable:!1})},doFinalize:function(){var r=this.getOperation();r&&r.finalize(),this.tryApplySuper("doFinalize")}}),Kekule.IssueCheck.ResolverManager={_resolverMap:new Kekule.MapEx,_resolverInstanceMap:new Kekule.MapEx,register:function(r,a){var o=i._resolverMap.get(r);o||(o=[],i._resolverMap.set(r,o)),o.indexOf(a)<0&&o.push(a)},unregister:function(r,a){var o=i._resolverMap.get(r),l=o.indexOf(a);l>=0&&o.splice(l,1)},getResolverClasses:function(r){return i._resolverMap.get(r)||[]},getResolverInstances:function(r){for(var a=[],o=i.getResolverClasses(r),l=0,u=o.length;l<u;++l){var c=o[l],d=i._resolverInstanceMap.get(c);d||(d=new c,i._resolverInstanceMap.set(c,d)),a.push(d)}return a}};var i=Kekule.IssueCheck.ResolverManager;ClassEx.extend(Kekule.IssueCheck.CheckResult,{getResolvers:function(){return i.getResolverInstances(this.getClass())},fetchSolutions:function(r){for(var a=this.getResolvers(),o=[],l=0,u=a.length;l<u;++l){var c=a[l].createSolutions(this,r);c&&c.length&&(o=o.concat(c))}return o}}),Kekule.IssueCheck.BondOrderChecker.Resolver=Class.create(Kekule.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.BondOrderChecker.Resolver",doCreateSolutions:function(r,a){var o=r.getTargets()[0],l=o.getBondOrder(),u=r.getData().maxOrder,c=this._getEditorWidget(a);if(o&&u&&c){var d=new Kekule.ChemObjOperation.Modify(o,{bondOrder:u},c),h=Kekule.$L("ErrorCheckMsg.TITLE_CHANGE_BOND_ORDER_TO").format(u),p=Kekule.$L("ErrorCheckMsg.DESCRIPTION_CHANGE_BOND_ORDER_TO").format(l,u);return[this._createSolutionInstance(h,p,d,r)]}return[]}}),i.register(Kekule.IssueCheck.BondOrderChecker.Result,Kekule.IssueCheck.BondOrderChecker.Resolver),Kekule.IssueCheck.Node2DDistanceChecker=Class.create(Kekule.IssueCheck.BaseChecker,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker",doApplicable:function(r,a,o){return a instanceof Kekule.ChemSpace&&r instanceof Kekule.ChemStructureNode&&(!(r instanceof Kekule.Molecule)||!(r.isExpanded&&r.isExpanded))&&(!r.isExposed||r.isExposed())},doCheckOnTarget:function(r,a,o,l,u){for(var c=[],d=r,h=a+1,p=o.length;h<p;++h){var g=o[h];if(g){var f=this.doCheckDistance(d,g,l,u);f&&c.push(f)}}return c},doCheckDistance:function(r,a,o,l){var u=this._getDistanceRefLength(o)/5,c=l.editor,d=!!c&&c.getAllowCoordBorrow();return this._isNodesDistanceTooClose(r,a,u,d,c)?new Kekule.IssueCheck.Node2DDistanceChecker.Result(Kekule.ErrorLevel.WARNING,s.WARNING_NODE_TOO_CLOSE,null,[r,a],this):null},_getDistanceRefLength:function(r){return r.getDefAutoScaleRefLength()},_getEditor:function(r){return r.editor},_isNodesDistanceTooClose:function(r,a,o,l,u){if(u){var c=u.translateDistance(o,Kekule.Render.CoordSystem.CHEM,Kekule.Render.CoordSystem.SCREEN);return this._isNodesDistanceTooCloseByBound(r,a,o,c,u)}return this._getNodesDistanceByCoord(r,a,l)<distanceThreshold},_getNodesDistanceByCoord:function(r,a,o){var l=r.getAbsCoord2D(o),u=a.getAbsCoord2D(o);return n.getDistance(l,u)},_isNodesDistanceTooCloseByBound:function(r,a,o,l,u){Kekule.Render.BoundShapeType;var c=Kekule.Render.MetaShapeUtils,d=u.getChemObjBounds(r)[0],h=u.getChemObjBounds(a)[0];if(!d||!h)return!1;if(this._isPointOrCircleShape(d)&&this._isPointOrCircleShape(h))return n.getDistance(d.coords[0],h.coords[0])-(d.radius||0)-(d.radius||0)<l;if(this._isPointOrCircleShape(d)||this._isPointOrCircleShape(h)){var p=this._isPointOrCircleShape(d),g=p?d.coords[0]:h.coords[0],f=p?d.radius||0:h.radius||0,m=p?h:d,C=c.inflateShape(m,l);return c.getDistance(g,C)-f<0}for(var _=0,y=d.coords.length;_<y;++_){var T=d.coords[_];if(c.isCoordInside(T,h))return!0}for(_=0,y=h.coords.length;_<y;++_)if(T=h.coords[_],c.isCoordInside(T,d))return!0;return!1},_isPointOrCircleShape:function(r){var a=Kekule.Render.BoundShapeType;return r.shapeType===a.POINT||r.shapeType===a.CIRCLE}}),t.register(e.NODE_DISTANCE_2D,Kekule.IssueCheck.Node2DDistanceChecker),Kekule.IssueCheck.Node2DDistanceChecker.Result=Class.create(Kekule.IssueCheck.CheckResult,{CLASS_NAME:"Kekule.IssueCheck.NodeDistanceChecker.Result",DEF_ERROR_CODE:s.WARNING_NODE_TOO_CLOSE,getMessage:function(){var r=this.getTargets()[0],a=this.getTargets()[1],o=r.getLabel&&r.getLabel()||r.getId&&r.getId(),l=a.getLabel&&a.getLabel()||a.getId&&a.getId();return o&&o?Kekule.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE_WITH_LABEL").format(o+"/"+l):Kekule.$L("ErrorCheckMsg.NODE_DISTANCE_TOO_CLOSE")}}),Kekule.IssueCheck.Node2DDistanceChecker.Resolver=Class.create(Kekule.IssueCheck.IssueResolver,{CLASS_NAME:"Kekule.IssueCheck.Node2DDistanceChecker.Resolver",doCreateSolutions:function(r,a){var o=r.getTargets()[0],l=r.getTargets()[1],u=o.getLabel&&o.getLabel(),c=l.getLabel&&l.getLabel(),d=u===c;if(!u||d){var h=o.getId&&o.getId();h&&(u=u?u+"("+h+")":h)}if(!u||d){var p=l.getId&&l.getId();p&&(c=c?c+"("+p+")":p)}var g=this._getEditorWidget(a),f=[];if(o&&l&&g){var m=g.getEditorConfigs().getInteractionConfigs().getEnableStructFragmentMerge(),C=g.getEditorConfigs().getInteractionConfigs().getEnableNeighborNodeMerge();if(Kekule.ChemStructOperation.MergeNodes.canMerge(o,l,m,C)){var _=new Kekule.ChemStructOperation.MergeNodes(o,l,m,g);f.push(this._createSolutionInstance(Kekule.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(u,c),Kekule.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(u,c),_,r))}Kekule.ChemStructOperation.MergeNodes.canMerge(l,o,m,C)&&(_=new Kekule.ChemStructOperation.MergeNodes(l,o,m,g),f.push(this._createSolutionInstance(Kekule.$L("ErrorCheckMsg.TITLE_MERGE_TO").format(c,u),Kekule.$L("ErrorCheckMsg.DESCRIPTION_MERGE_TO").format(c,u),_,r)))}return f}}),i.register(Kekule.IssueCheck.Node2DDistanceChecker.Result,Kekule.IssueCheck.Node2DDistanceChecker.Resolver)}(),function(){var s=Kekule.DomUtils,e=Kekule.HtmlElementUtils,t=Kekule.Widget.HtmlClassNames,n=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHECK_RESULT_LIST_VIEW:"K-Chem-CheckResultListView",CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:"K-Chem-CheckResultListView-SolutionEnabled",CHECK_RESULT_LIST_VIEW_ITEM:"K-Chem-CheckResultListView-Item",CHECK_RESULT_LIST_VIEW_ITEM_BODY:"K-Chem-CheckResultListView-ItemBody",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION:"K-Chem-CheckResultListView-Item-SolutionSection",CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET:"K-Chem-CheckResultListView-Item-SolutionWidget",ISSUE_INSPECTOR:"K-Chem-IssueInspector",ISSUE_INSPECTOR_FLEX_LAYOUT:"K-Chem-IssueInspector-Flex-Layout",ISSUE_INSPECTOR_SUBPART:"K-Chem-IssueInspector-SubPart",ISSUE_INSPECTOR_LIST_PANEL:"K-Chem-IssueInspector-ListPanel"}),Kekule.ChemWidget.CheckResultListView=Class.create(Kekule.Widget.ListView,{CLASS_NAME:"Kekule.ChemWidget.CheckResultListView",initProperties:function(){this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,setter:function(i){this.setPropStoreFieldValue("checkResults",i),this._updateListView()}}),this.defineProp("selectedCheckResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){var i,r=this.getSelectedItem();return r&&(i=this.getItemData(r).checkResult),i}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,setter:function(i){var r=!!i;this.getEnableIssueSolutions()!==r&&(this.setPropStoreFieldValue("enableIssueSolutions",r),r?this.addClassName(n.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED):this.removeClassName(n.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED))}}),this.defineProp("resolverCaller",{dataType:DataType.OBJECT,serialiazable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableSelect(!0).setEnableMultiSelect(!1).setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function(){var i=this.tryApplySuper("doGetWidgetClassName")+" "+n.CHECK_RESULT_LIST_VIEW;return i+=" "+this._getSolutionEnableRelatedClassName()},getItemClassName:function(){return this.tryApplySuper("getItemClassName")+" "+n.CHECK_RESULT_LIST_VIEW_ITEM},_getSolutionEnableRelatedClassName:function(){return this.getEnableIssueSolutions()?n.CHECK_RESULT_LIST_VIEW_SOLUTION_ENABLED:""},selectionChanged:function(i,r){var a=this.tryApplySuper("selectionChanged",[i,r]);if(i&&this.getEnableIssueSolutions())for(var o=0,l=i.length;o<l;++o){var u=i[o],c=this.getItemData(u);c.solutions||(c.solutions=c.checkResult.fetchSolutions(this.getResolverCaller()),c.solutions&&this.doFillSolutionSection(u,c.solutions))}return a},createChildItem:function(i){var r;return r=i instanceof Kekule.IssueCheck.CheckResult?this._wrapCheckResultToItemData(i):i,this.tryApplySuper("createChildItem",[r])},doCreateChildItem:function(i){var r=this.getDocument(),a=r.createElement("li"),o=r.createElement("span");o.className=n.CHECK_RESULT_LIST_VIEW_ITEM_BODY,a.appendChild(o);var l=r.createElement("span");return l.className=n.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_SECTION,a._solutionSecElem=l,a.appendChild(l),a},doFillSolutionSection:function(i,r){if(r&&this.getEnableIssueSolutions())for(var a=this.getDocument(),o=0,l=r.length;o<l;++o)this.doCreateSolutionWidget(a,r[o],i).appendToElem(i._solutionSecElem);else s.clearChildContent(i._solutionSecElem)},doCreateSolutionWidget:function(i,r,a){var o=this,l=new Kekule.Widget.Button(this);return l.addClassName(n.CHECK_RESULT_LIST_VIEW_ITEM_SOLUTION_WIDGET),l.setText(r.getTitle()).setHint(r.getDescription()),l.addEventListener("execute",function(u){o.getEnableIssueSolutions()&&o.invokeEvent("resolveIssue",{solution:r,issueResult:r.getIssueResult()})}),l},setItemData:function(i,r){var a;a=r instanceof Kekule.IssueCheck.CheckResult?this._wrapCheckResultToItemData(r):r,this.tryApplySuper("setItemData",[i,a])},doSetItemData:function(i,r){var a=this.getItemData(i);if(a&&a.className&&e.removeClass(i,a.className),r){var o=r;o.text&&s.setElementText(i.getElementsByClassName(n.CHECK_RESULT_LIST_VIEW_ITEM_BODY)[0],o.text),o.hint&&i.setAttribute("title",o.hint),o.className&&e.addClass(i,o.className),this.doFillSolutionSection(i,o.solutions)}},_wrapCheckResultToItemData:function(i){var r=i.getMessage();return{text:r,hint:r,className:this._getErrorLevelHtmlClass(i.getLevel()),checkResult:i,solutions:null}},_updateListView:function(){for(var i=this.getItems(),r=i.length,a=this.getCheckResults()||[],o=a.length,l=0;l<o;++l)l<r?this.setItemData(i[l],a[l]):this.appendItem(a[l]);if(r>o)for(l=r-1;l>=o;--l){var u=i[l];this.removeItem(u)}},_getErrorLevelHtmlClass:function(i){var r=Kekule.ErrorLevel;return i===r.LOG||i===r.NOTE?t.MSG_INFO:i===r.WARNING?t.MSG_WARNING:t.MSG_ERROR}}),Kekule.Editor.IssueInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Editor.IssueInspector",initialize:function(i){this._reactExecutorExecuteBind=this._reactExecutorExecute.bind(this),this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("issueCheckExecutor",{dataType:"Kekule.IssueCheck.Executor",serializable:!1,setter:function(i){var r=this.getIssueCheckExecutor();i!==r&&(this.setPropStoreFieldValue("issueCheckExecutor",i),this._issueCheckExecutorChanged(r,i))}}),this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("checkResults",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getCheckResults()},setter:function(i){this.getResultListView().setCheckResults(i)}}),this.defineProp("selectedResult",{dataType:"Kekule.IssueCheck.CheckResult",serializable:!1,setter:null,getter:function(){return this.getResultListView().getSelectedResult()}}),this.defineProp("enableIssueSolutions",{dataType:DataType.BOOL,getter:function(){return this.getResultListView().getEnableIssueSolutions()},setter:function(i){this.getResultListView().setEnableIssueSolutions(i)}}),this.defineProp("resultListView",{dataType:"Kekule.ChemWidget.CheckResultListView",serializable:!1,setter:null,scope:Class.PropertyScope.PRIVATE}),this.defineProp("resolverCaller",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getResultListView().getResolverCaller()},setter:function(i){this.getResultListView().setResolverCaller(i)}})},doFinalize:function(){this._finalizeChildWidgets(),this.tryApplySuper("doFinalize")},_finalizeChildWidgets:function(){var i=this.getResultListView();i&&i.finalize(),this.setPropStoreFieldValue("resultListView",null)},_isUsingFlexLayout:function(){return!!Kekule.BrowserFeature.cssFlex},doGetWidgetClassName:function(){var i=n.ISSUE_INSPECTOR;return this._isUsingFlexLayout()&&(i+=" "+n.ISSUE_INSPECTOR_FLEX_LAYOUT),i},getChildrenHolderElement:function(){return this._listPanelElem||this.tryApplySuper("getChildrenHolderElement")},doCreateRootElement:function(i){return i.createElement("div")},doCreateSubElements:function(i,r){var a=this.tryApplySuper("doCreateSubElements",[i,r])||[],o=this._createSubPartElem(i);return e.addClass(o,n.ISSUE_INSPECTOR_LIST_PANEL),this._listPanelElem=o,r.appendChild(o),a.push(o),this._createChildWidgets(),a},_createSubPartElem:function(i){var r=i.createElement("div");return r.className=n.ISSUE_INSPECTOR_SUBPART,r},_createChildWidgets:function(){this._finalizeChildWidgets();var i=new Kekule.ChemWidget.CheckResultListView(this);i.setUseCornerDecoration(!0),i.appendToElem(this._listPanelElem);var r=this;i.addEventListener("selectionChange",function(a){if(a.target===i){var o,l=a.selectedItem;l&&(o=i.getItemData(l).checkResult),r.invokeEvent("selectResult",{selectedResult:o})}}),this.setPropStoreFieldValue("resultListView",i)},_issueCheckExecutorChanged:function(i,r){i&&i.removeEventListener("execute",this._reactExecutorExecuteBind),r&&r.addEventListener("execute",this._reactExecutorExecuteBind)},_reactExecutorExecute:function(i){this.setCheckResults(i.checkResults)},deselect:function(){this.getResultListView().clearSelection()}})}(),function(){var s=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.ChemIdEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function(){var e=this.tryApplySuper("getAttributes");return e&s.MULTIOBJS&&(e^=s.MULTIOBJS),e}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemIdEditor,null,Kekule.ChemObject,"id"),Kekule.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:!1}),this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:!1})},getCoordFieldValue:function(e,t,n){if(e.length){var i=e[0].getPropValue(t);if(i){for(var r=i[n],a=1,o=e.length;a<o;++a)if(e[a].getPropValue(t)[n]!==r)return;return r}}},getValue:function(){var e=this.getParentObjects(),t=this.getParentPropName();return e&&t?this.getCoordFieldValue(e,t,this.getPropertyName()):this.tryApplySuper("getValue")}}),Kekule.PropertyEditor.ChemCoordEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var n=this.tryApplySuper("createFieldEditor",[e,t]);return n.setParentObjects&&n.setParentObjects(this.getObjects()),n.setParentPropName&&n.setParentPropName(this.getPropertyName()),n},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var n=this.getObjFields(),i="",r=0,a=n.length;r<a;++r){var o=t[n[r]];Kekule.ObjUtils.notUnset(o)&&(i&&(i+=", "),i+=n[r]+": "+o)}return"{"+i+"}"}return""}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord3D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord3D"),Kekule.PropertyEditor.ChemSizeEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){return this.getPropertyName().indexOf("3")>=0},getFieldEditorClass:function(e,t){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function(e,t){var n=this.tryApplySuper("createFieldEditor",[e,t]);return n.setParentObjects&&n.setParentObjects(this.getObjects()),n.setParentPropName&&n.setParentPropName(this.getPropertyName()),n},getFieldValueType:function(e,t){return DataType.FLOAT},getObjFields:function(e){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function(){var e=Kekule.Widget.ValueListEditor.ValueDisplayMode;if(this.getValueTextMode()===e.JSON)return this.tryApplySuper("getValueText");var t=this.getValue();if(t){for(var n=this.getObjFields(),i="",r=0,a=n.length;r<a;++r){var o=t[n[r]];Kekule.ObjUtils.notUnset(o)&&(i&&(i+=", "),i+=n[r]+": "+o)}return"{"+i+"}"}return""}}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size2D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size3D"),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"screenSize"),Kekule.PropertyEditor.ChemOptionObjectEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function(){this.tryApplySuper("initialize"),this.setAllowEmpty(!0)},getObjFieldInfos:function(e){for(var t=ClassEx.getCommonSuperClass(this.getObjects()),n=[],i=this.CHILD_FIELD_INFOS,r=0,a=i.length;r<a;++r){var o=i[r];o.targetClass&&t&&!ClassEx.isOrIsDescendantOf(t,o.targetClass)||n.push(o)}return n.sort(function(l,u){return l.name>u.name?1:l.name<u.name?-1:0}),n},notifyChildEditorValueChange:function(e,t){var n=this.getValue()||this._initialObjValue;n=Object.extend({},n),Kekule.ObjUtils.notUnset(t)?n[e]=t:delete n[e],this.setValue(n)}}),Kekule.PropertyEditor.ChemRender2DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:Kekule.Render.RenderOptionUtils.getOptionDefinitions()}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender2DOptionsEditor,null,Kekule.ChemObject,"renderOptions"),Kekule.PropertyEditor.ChemRender3DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:Kekule.Render.Render3DOptionUtils.getOptionDefinitions()}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender3DOptionsEditor,null,Kekule.ChemObject,"render3DOptions"),Kekule.PropertyEditor.GlyphPathParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector}]}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathParamsEditor,null,Kekule.Glyph.PathGlyphConnector,"pathParams"),Kekule.PropertyEditor.GlyphPathNodeParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathNodeParamsEditor",CHILD_FIELD_INFOS:[{name:"useStickingOffset",dataType:DataType.BOOL,targetClass:Kekule.Glyph.PathGlyphNode},{name:"stickingOffsetRelLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphNode}]}),Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathNodeParamsEditor,null,Kekule.Glyph.PathGlyphNode,"pathNodeParams")}(),function(){Class.PropertyScope;var s=Kekule.ArrayUtils,e=(Kekule.ChemWidget,Kekule.Editor,Kekule.Widget.HtmlClassNames),t=Kekule.ChemWidget.HtmlClassNames,n=Kekule.ChemWidget.ComponentWidgetNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_GRID_LAYOUT:"K-Chem-Composer-Grid-Layout",COMPOSER_LANDSCAPE:"K-Chem-Composer-Landscape",COMPOSER_PORTRAIT:"K-Chem-Composer-Portrait",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_ISSUE_PANEL:"K-Chem-Composer-Issue-Panel",COMPOSER_ISSUE_PANEL_WRAPPER:"K-Chem-Composer-Issue-Panel-Wrapper",COMPOSER_ISSUE_PANEL_TOOL_PANEL:"K-Chem-Composer-Issue-Panel-ToolPanel",COMPOSER_ISSUE_PANEL_INSPECTOR_REGION:"K-Chem-Composer-Issue-Panel-InspectorRegion",COMPOSER_TOP_REGION:"K-Chem-Composer-Top-Region",COMPOSER_LEFT_REGION:"K-Chem-Composer-Left-Region",COMPOSER_BOTTOM_REGION:"K-Chem-Composer-Bottom-Region",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_ZOOM_TOOLBAR:"K-Chem-Composer-Zoom-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_OBJMODIFIER_TOOLBAR:"K-Chem-Composer-ObjModifier-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_NODEDISPLAYMODE_BOX:"K-Chem-Composer-NodeDisplayMode-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom",COMPOSER_DIALOG:"K-Chem-ComposerDialog",COMPOSER_FRAME:"K-Chem-ComposerFrame",COMPOSER_FRAME_CONTENT_DOC:"K-Chem-ComposerFrame-ContentDoc",COMPOSER_FRAME_CONTENT_BODY:"K-Chem-ComposerFrame-ContentBody"}),Kekule.globalOptions.add("chemWidget.composer",{commonToolButtons:[n.newDoc,n.loadData,n.saveData,n.undo,n.redo,n.copy,n.cut,n.paste,n.zoomIn,n.zoomOut,n.config,n.objInspector],chemToolButtons:[n.manipulate,n.erase,n.molBond,n.molAtomAndFormula,n.molRing,n.molCharge,n.glyph,n.textImage],styleToolComponentNames:[n.fontName,n.fontSize,n.color,n.textDirection,n.textAlign]}),Kekule.Editor.ComposerStyleToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{text:Kekule.$L("ChemWidgetTexts.HINT_USE_ATOM_CUSTOM_COLOR"),value:"Atom",className:e.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setPropStoreFieldValue("composer",i),this.createChildWidgets(),this.appendToWidget(i),this._relatedPropNames=i.getCoordMode()===Kekule.CoordMode.COORD3D?["renderOptions","render3DOptions"]:["renderOptions"],this.getEditor().addEventListener("selectionChange",function(r){this._isApplying||this.updateStyleValues()},this),this.getEditor().addEventListener("editObjChanged",function(r){var a=r.propNames;a&&a.length&&Kekule.ArrayUtils.intersect(this._relatedPropNames,a).length&&(this._isApplying||this.updateStyleValues())},this),this._isApplying=!1},doFinalize:function(){this.clearWidgets(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:!1,setter:null}),this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:!1,setter:null}),this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:!1,setter:null}),this.defineProp("fontName",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(i){this.getFontNameBox()&&this.getFontNameBox().setValue(i)}}),this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:!1,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(i){this.getFontSizeBox()&&this.getFontSizeBox().setValue(i)}}),this.defineProp("color",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getColorBox()?this.getColorBox().getValue():void 0},setter:function(i){this.getColorBox()&&this.getColorBox().setValue(i)}}),this.defineProp("textDirection",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(i){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),i)}}),this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(i){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),i)}}),this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:!1,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(i){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),i)}}),this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var i=this.getPropStoreFieldValue("componentNames");return i||(i=this.getDefaultComponentNames(),this.setPropStoreFieldValue("componentNames",i)),i},setter:function(i){this.setPropStoreFieldValue("componentNames",i),this.recreateComponents()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},removeWidget:function(i,r){i===this.getFontNameBox()&&this.setPropStoreFieldValue("fontNameBox",null),i===this.getFontSizeBox()&&this.setPropStoreFieldValue("fontSizeBox",null),i===this.getColorBox()&&this.setPropStoreFieldValue("colorBox",null),i===this.getTextDirectionButtonSet()&&this.setPropStoreFieldValue("textDirectionButtonSet",null),i===this.getTextHorizontalAlignButtonSet()&&this.setPropStoreFieldValue("textHorizontalAlignButtonSet",null),i===this.getTextVerticalAlignButtonSet()&&this.setPropStoreFieldValue("textVerticalAlignButtonSet",null),this.tryApplySuper("removeWidget",[i,r])},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPOSER_TOOLBAR+" "+t.COMPOSER_STYLE_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(i){i||(i=this.getComponentNames());for(var r=0,a=i.length;r<a;++r){var o=i[r];if(o===n.fontName){var l=new Kekule.Widget.ComboBox(this);this.fillFontNameBox(l),l.addClassName(t.COMPOSER_FONTNAME_BOX),l.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTNAME")),l.addEventListener("valueChange",function(g){this.applyFontName()},this),this.setPropStoreFieldValue("fontNameBox",l)}else if(o===n.fontSize)l=new Kekule.Widget.ComboBox(this),this.fillFontSizeBox(l),l.addClassName(t.COMPOSER_FONTSIZE_BOX),l.setHint(Kekule.$L("ChemWidgetTexts.HINT_FONTSIZE")),l.addEventListener("valueChange",function(g){this.applyFontSize()},this),this.setPropStoreFieldValue("fontSizeBox",l);else if(o===n.color){var u=new Kekule.Widget.ColorDropButton(this);u.setHint(Kekule.$L("ChemWidgetTexts.HINT_PICK_COLOR")),u.setShowText(!1),u.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]),u.addClassName(t.COMPOSER_COLOR_BOX),u.addEventListener("valueChange",function(g){this.applyColor()},this),this.setPropStoreFieldValue("colorBox",u)}else if(o===n.textDirection){var c=Kekule.Render.TextDirection,d=[{value:c.DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_DEFAULT"),className:t.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:c.LTR,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_LTR"),className:t.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:c.RTL,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_RTL"),className:t.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:c.TTB,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_TTB"),className:t.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:c.BTT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION_BTT"),className:t.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];(p=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_DIRECTION"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_DIRECTION"),t.COMPOSER_TEXTDIRECTION_BUTTON,d)).addEventListener("select",function(g){this.applyTextDirection()},this),this.setPropStoreFieldValue("textDirectionButtonSet",p)}else if(o===n.textAlign){d=[{value:(h=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:t.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:h.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:t.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:h.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:t.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:h.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:t.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:h.LEFT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEFT"),className:t.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:h.RIGHT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_RIGHT"),className:t.COMPOSER_TEXTALIGN_BUTTON_RIGHT}],(p=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_HORIZONTAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_HORIZONTAL_ALIGN"),t.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,d)).addEventListener("select",function(g){this.applyTextHorizontalAlign()},this),this.setPropStoreFieldValue("textHorizontalAlignButtonSet",p);var h,p;d=[{value:(h=Kekule.Render.TextAlign).DEFAULT,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_DEFAULT"),className:t.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:h.LEADING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_LEADING"),className:t.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:h.TRAILING,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TRAILING"),className:t.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:h.CENTER,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_CENTER"),className:t.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:h.TOP,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_TOP"),className:t.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:h.BOTTOM,text:Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_ALIGN_BOTTOM"),className:t.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}],(p=this._createStyleButtonSet(Kekule.$L("ChemWidgetTexts.CAPTION_TEXT_VERTICAL_ALIGN"),Kekule.$L("ChemWidgetTexts.HINT_TEXT_VERTICAL_ALIGN"),t.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,d)).addEventListener("select",function(g){this.applyTextVerticalAlign()},this),this.setPropStoreFieldValue("textVerticalAlignButtonSet",p)}}this.updateStyleValues()},_createStyleButtonSet:function(i,r,a,o){var l=new Kekule.Widget.CompactButtonSet(this);if(l.setText(i),l.setHint(r),l.addClassName(a),l.setShowText(!1),l.setShowCompactMark(!1),l.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN),l.getButtonSet().addClassName(t.COMPOSER_STYLE_TOOLBAR),l.getButtonSet().setShowText(!0),o)for(var u=0,c=o.length;u<c;++u){var d=o[u],h=new Kekule.Widget.RadioButton(l,d.text||"");h.setHint(d.hint||""),h.addClassName(d.className),h[this.LINKED_VALUE_FIELD]=d.value,l.append(h,d.selected)}return l},_getButtonSetLinkedValue:function(i){var r=i?i.getSelected():null;return r?r[this.LINKED_VALUE_FIELD]:void 0},_setButtonSetLinkedValue:function(i,r){if(i){var a=i.getButtonSet().getChildWidgets();i.setSelected(null);for(var o=0,l=a.length;o<l;++o){var u=a[o];if(u.hasOwnProperty(this.LINKED_VALUE_FIELD)&&u[this.LINKED_VALUE_FIELD]==r){i.setSelected(u);break}}}},getDefaultComponentNames:function(){return Kekule.globalOptions.chemWidget.composer.styleToolComponentNames},recreateComponents:function(){var i=this.getComponentNames();this.clearWidgets(),this.createChildWidgets(i)},fillFontSizeBox:function(i){for(var r=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes(),a=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:void 0}],o=0,l=r.length;o<l;++o)a.push({text:r[o]+" px",value:r[o]});i.setItems(a)},fillFontNameBox:function(i){for(var r=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames(),a=[{text:Kekule.$L("ChemWidgetTexts.S_VALUE_DEFAULT"),value:""}],o=0,l=r.length;o<l;++o)a.push({text:r[o],value:r[o]});i.setItems(a)},applyStyle:function(i,r,a){this._isApplying=!0;try{this.getEditor().modifyObjectsRenderOptions(i,r,a,!0)}finally{this._isApplying=!1}},getStyleValue:function(i,r,a){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(i,r,a)},applyStyleToEditorSelection:function(i,r){var a=this.getEditor().getSelection();if(a&&a.length)return this.applyStyle(a,i,r)},applyFontName:function(i){if(i||(i=this.getEditor().getSelection()),i&&i.length){var r=this.getFontName();this.applyStyle(i,{fontFamily:r})}},applyFontSize:function(i){if(i||(i=this.getEditor().getSelection()),i&&i.length){var r=this.getFontSize();this.applyStyle(i,{fontSize:r})}},applyColor:function(i){if(i||(i=this.getEditor().getSelection()),i&&i.length){var r=this.getColor();r===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value?this.applyStyle(i,{useAtomSpecifiedColor:!0,color:void 0}):(r==Kekule.Widget.ColorPicker.SpecialColors.UNSET&&(r=void 0),this.applyStyle(i,{useAtomSpecifiedColor:!1,color:r}))}},applyTextDirection:function(i){if(i||(i=this.getEditor().getSelection()),i&&i.length){var r=this.getTextDirection();this.applyStyle(i,{charDirection:r})}},applyTextHorizontalAlign:function(i){if(i||(i=this.getEditor().getSelection()),i&&i.length){var r=this.getTextHorizontalAlign();this.applyStyle(i,{horizontalAlign:r})}},applyTextVerticalAlign:function(i){if(i||(i=this.getEditor().getSelection()),i&&i.length){var r=this.getTextVerticalAlign();this.applyStyle(i,{verticalAlign:r})}},updateStyleValues:function(i){i||(i=this.getEditor().getSelection()),i&&i.length&&(this.updateFontName(i),this.updateFontSize(i),this.updateColor(i),this.updateTextDirection(i),this.updateTextHorizontalAlign(i),this.updateTextVerticalAlign(i))},updateFontName:function(i){if(i&&i.length&&this.getFontNameBox()){var r=this.getStyleValue(i,"fontFamily");this.setFontName(r||"")}},updateFontSize:function(i){if(i&&i.length&&this.getFontSizeBox()){var r=this.getStyleValue(i,"fontSize");this.setFontSize(r||void 0)}},updateColor:function(i){if(i&&i.length&&this.getColorBox()){var r=this.getStyleValue(i,"useAtomSpecifiedColor"),a=this.getStyleValue(i,"color");this.getColorBox().setColorClassName(null),a?this.getColorBox().setColorClassName(null):r&&(a=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value,this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)),this.setColor(a||void 0)}},updateTextDirection:function(i){if(i&&i.length&&this.getTextDirectionButtonSet()){var r=this.getStyleValue(i,"charDirection");this.setTextDirection(r)}},updateTextHorizontalAlign:function(i){if(i&&i.length&&this.getTextHorizontalAlignButtonSet()){var r=this.getStyleValue(i,"horizontalAlign");this.setTextHorizontalAlign(r)}},updateTextVerticalAlign:function(i){if(i&&i.length&&this.getTextVerticalAlignButtonSet()){var r=this.getStyleValue(i,"verticalAlign");this.setTextVerticalAlign(r)}},updateState:function(){var i=this.getEditor(),r=i&&i.hasSelection();this.getFontNameBox()&&this.getFontNameBox().setEnabled(r),this.getFontSizeBox()&&this.getFontSizeBox().setEnabled(r),this.getColorBox()&&this.getColorBox().setEnabled(r),this.getTextDirectionButtonSet()&&this.getTextDirectionButtonSet().setEnabled(r),this.getTextHorizontalAlignButtonSet()&&this.getTextHorizontalAlignButtonSet().setEnabled(r),this.getTextVerticalAlignButtonSet()&&this.getTextVerticalAlignButtonSet().setEnabled(r)}}),Kekule.Editor.ComposerObjModifierToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerObjModifierToolbar",initialize:function(i){this.tryApplySuper("initialize",[i]),this.setPropStoreFieldValue("modifiers",[]),this.setPropStoreFieldValue("modifierMap",new Kekule.MapEx),this.setPropStoreFieldValue("composer",i),this.appendToWidget(i),i.addEventListener("selectionChange",function(r){this._isApplying||this.updateModifierValues()},this),i.addEventListener("selectedObjsUpdated",function(r){this._isApplying||(i.getEditor().isManipulatingObject()?this._suppressUpdateModifierValuesInManipulation=!0:this.updateModifierValues())},this),i.addEventListener("endManipulateObject",function(r){this._suppressUpdateModifierValuesInManipulation&&(this.updateModifierValues(),this._suppressUpdateModifierValuesInManipulation=!1)},this),this._isApplying=!1},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("modifierMap",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("modifiers",{dataType:DataType.ARRAY,serializable:!1,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setShowGlyph(!0)},doFinalize:function(){this.clearWidgets(),this.getModifierMap().finalize();for(var i=this.getModifiers(),r=0,a=i.length;r<a;++r)i[r].finalize();this.tryApplySuper("doFinalize")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPOSER_TOOLBAR+" "+t.COMPOSER_OBJMODIFIER_TOOLBAR},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},getAllowedModifierCategories:function(){var i=this.getComposer();return i&&i.getAllowedObjModifierCategories()},getTargetObjs:function(){return this.getEditor().getSelection()},getAvailableModifierClasses:function(){for(var i=[],r=this.getTargetObjs(),a=0,o=r.length;a<o;++a)r[a].getClass&&s.pushUnique(i,r[a].getClass());var l=[],u=this.getAllowedModifierCategories();for(a=0,o=i.length;a<o;++a){var c=Kekule.Editor.ObjModifierManager.getModifierClasses(i[a],u);c&&s.pushUnique(l,c)}return l.length&&l.sort(function(d,h){var p=d&&ClassEx.getPrototype(d),g=h&&ClassEx.getPrototype(h),f=p&&p.getModifierName&&p.getModifierName(),m=g&&g.getModifierName&&g.getModifierName();return f===m?0:f<m?-1:1}),l},getModifierInstanceOfClass:function(i,r){var a=this.getModifierMap(),o=a.get(i);return!o&&r&&(o=new i(this.getEditor()),a.set(i,o)),o},updateModifierWidgets:function(){var i=[];this.clearWidgets(!0);for(var r=this.getAvailableModifierClasses(),a=0,o=r.length;a<o;++a){var l=r[a],u=this.getModifierInstanceOfClass(l,!0),c=u.getWidget();c&&(this.appendWidget(c),i.push(u))}this.setPropStoreFieldValue("modifiers",i),this.updateModifierValues(),this._isAllModifierWidgetButtons(i)?this.removeClassName(e.TOOLBAR).addClassName(e.BUTTON_GROUP):this.removeClassName(e.BUTTON_GROUP).addClassName(e.TOOLBAR)},updateState:function(){this.updateModifierWidgets()},updateModifierValues:function(){for(var i=this.getModifiers(),r=0,a=i.length;r<a;++r)i[r].loadFromTargets()},_isAllModifierWidgetButtons:function(i){for(var r=0,a=i.length;r<a;++r){var o=i[r],l=o&&o.getWidget();if(l&&l.getDisplayed()&&!(l instanceof Kekule.Widget.Button))return!1}return!0}}),Kekule.Editor.Composer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],CHEM_TOOL_CHILD_FIELDS:"__$children__",initialize:function(i,r){this.updateSelectionAssocToolbarStateBind=this.updateSelectionAssocToolbarState.bind(this),this.setPropStoreFieldValue("enableIssueInspectorSolutions",!0),this.setPropStoreFieldValue("enableStyleToolbar",!0),this.setPropStoreFieldValue("enableObjModifierToolbar",!0),this.setPropStoreFieldValue("editor",r),this.setPropStoreFieldValue("editorNexus",new Kekule.Editor.EditorNexus),this.tryApplySuper("initialize",[i]),this.bindEditor(r);var a=this.getEditor();a&&a.setChemObj(a.getChemObj()),this.getCommonBtnGroup()||this.createCommonToolbar(),this.getChemBtnGroup()||this.createChemToolbar(),this.getZoomBtnGroup()||this.createZoomToolbar(),this.uiLayoutChanged()},doFinalize:function(){var i=this.getIssueInspector();i&&i.finalize();var r=this.getStructureTreeView();r&&r.finalize();var a,o=this.getObjInspector();o&&o.finalize(),(a=this.getCommonBtnGroup())&&a.finalize(),(a=this.getChemBtnGroup())&&a.finalize();var l=this.getPropStoreFieldValue("editor");l&&l.finalize(),this.getEditorNexus().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:!1,setter:null,getter:function(){var i=this.getPropStoreFieldValue("editor");return i||(i=this.createDefaultEditor(),this.setPropStoreFieldValue("editor",i)),i}}),this.defineProp("autoSetMinDimension",{dataType:DataType.BOOL}),this.defineProp("showObjInspector",{dataType:DataType.BOOL,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("objInspector")>=0},setter:function(i){if(this.getShowObjInspector()!==i){var r=this.getAdvPanelDisplayedComponents()||[];r=i?["objInspector"]:s.exclude(r,"objInspector"),this.setAdvPanelDisplayedComponents(r)}}}),this.defineProp("showIssueInspector",{dataType:DataType.BOOL,serializable:!1,getter:function(){return(this.getAdvPanelDisplayedComponents()||[]).indexOf("issueInspector")>=0},setter:function(i){if(this.getShowIssueInspector()!==i){var r=this.getAdvPanelDisplayedComponents()||[];if(r=i?["issueInspector"]:s.exclude(r,"issueInspector"),this.setAdvPanelDisplayedComponents(r),i){var a=this.getEditor();a&&(a.getEnableAutoIssueCheck()||a.checkIssues(),a.getIssueCheckResults()&&a.getIssueCheckResults().length&&a.deselectAll())}else this.getIssueInspector().deselect()}}}),this.defineProp("enableIssueInspectorSolutions",{dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("enableIssueInspectorSolutions",!!i),this.getIssueInspector()&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())}}),this.defineProp("showInspector",{dataType:DataType.BOOL,getter:function(){return this.getShowObjInspector()},setter:function(i){this.setShowObjInspector(i)}}),this.defineProp("advPanelDisplayedComponents",{dataType:DataType.ARRAY,serializable:!1,setter:function(i){this.setPropStoreFieldValue("advPanelDisplayedComponents",i),this.updateAdvPanelDisplayedComponents(i)}}),this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("objInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("issueInspectorHolderElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("topRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("leftRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("bottomRegionElem",{dataType:DataType.OBJECT,serializable:!1,setter:null}),this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:!1,setter:null}),this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:!1,setter:null}),this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:!1,setter:null}),this.defineProp("issueInspector",{dataType:"Kekule.Editor.IssueInspector",serializable:!1,setter:null}),this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("zoomBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:!1}),this.defineProp("styleToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var i=this.getPropStoreFieldValue("styleToolbar");return i||this.getEnableStyleToolbar()&&(i=this.createStyleToolbar(),this.setPropStoreFieldValue("styleToolbar",i)),i}}),this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var i=this.getStyleToolbar();return i?i.getComponentNames():null},setter:function(i){var r=this.getStyleToolbar();return r&&r.setComponentNames(i),this}}),this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableStyleToolbar")&&!this.getEnableObjModifierToolbar()},setter:function(i){this.setPropStoreFieldValue("enableStyleToolbar",i),i&&this.setPropStoreFieldValue("enableObjModifierToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("objModifierToolbar",{dataType:"Kekule.Widget.Toolbar",serializable:!1,getter:function(){var i=this.getPropStoreFieldValue("objModifierToolbar");return i||this.getEnableObjModifierToolbar()&&(i=this.createObjModifierToolbar(),this.setPropStoreFieldValue("objModifierToolbar",i)),i}}),this.defineProp("enableObjModifierToolbar",{dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("enableObjModifierToolbar",i),i&&this.setPropStoreFieldValue("enableStyleToolbar",!1),this.updateSelectionAssocToolbarState()}}),this.defineProp("allowedObjModifierCategories",{dataType:DataType.ARRAY,setter:function(i){this.setPropStoreFieldValue("allowedObjModifierCategories",i),this.updateObjModifierToolbarState()}}),this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var i=this.getPropStoreFieldValue("commonToolButtons");return i||(i=this.getDefaultCommonToolBarButtons(),this.setPropStoreFieldValue("commonToolButtons",i)),i},setter:function(i){this.setPropStoreFieldValue("commonToolButtons",i),this.updateCommonToolbar(),this.updateZoomToolbar()}}),this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:!1,getter:function(){var i=this.getPropStoreFieldValue("chemToolButtons");return i||(i=this.getDefaultChemToolBarButtons(),this.setPropStoreFieldValue("chemToolButtons",i)),i},setter:function(i){this.setPropStoreFieldValue("chemToolButtons",i),this.updateChemToolbar()}}),this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var i=this.getPropStoreFieldValue("styleBarComponents");return i||(i=null,this.setPropStoreFieldValue("styleBarComponents",i)),i},setter:function(i){this.setPropStoreFieldValue("styleBarComponents",i),this.getStyleToolbar()&&this.getStyleToolbar().setComponentNames(i)}}),this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var i=this.getPropStoreFieldValue("commonActions");return i||(i=new Kekule.ActionList,this.setPropStoreFieldValue("commonActions",i)),i}}),this.defineProp("zoomActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var i=this.getPropStoreFieldValue("zoomActions");return i||(i=new Kekule.ActionList,this.setPropStoreFieldValue("zoomActions",i)),i}}),this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:!1,setter:null,getter:function(){var i=this.getPropStoreFieldValue("chemActions");return i||(i=new Kekule.ActionList,this.setPropStoreFieldValue("chemActions",i)),i}}),this.defineProp("actionMap",{dataType:"Kekule.MapEx",serializable:!1,setter:null,getter:function(){var i=this.getPropStoreFieldValue("actionMap");return i||(i=new Kekule.MapEx,this.setPropStoreFieldValue("actionMap",i)),i}}),this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var i=this.getEditor();return i&&i.getAllowCreateNewChild?i.getAllowCreateNewChild():null},setter:function(i){var r=this.getEditor();return r.setAllowCreateNewChild&&r.setAllowCreateNewChild(i),this}}),this.defineProp("allowAppendDataToCurr",{dataType:DataType.BOOL,getter:function(){var i=this.getEditor();return i&&i.getAllowAppendDataToCurr?i.getAllowAppendDataToCurr():null},setter:function(i){var r=this.getEditor();return r.setAllowAppendDataToCurr&&r.setAllowAppendDataToCurr(i),this}}),this._defineEditorDelegatedProp("chemObj"),this._defineEditorDelegatedProp("chemObjData"),this._defineEditorDelegatedProp("chemObjLoaded"),this._defineEditorDelegatedProp("renderType"),this._defineEditorDelegatedProp("renderConfigs"),this._defineEditorDelegatedProp("drawOptions"),this._defineEditorDelegatedProp("allowCoordBorrow"),this._defineEditorDelegatedProp("editorConfigs"),this._defineEditorDelegatedProp("operHistory"),this._defineEditorDelegatedProp("enableOperHistory"),this._defineEditorDelegatedProp("selection"),this._defineEditorDelegatedProp("hotTrackedObjs"),this._defineEditorDelegatedProp("enableOperContext"),this._defineEditorDelegatedProp("enableCreateNewDoc"),this._defineEditorDelegatedProp("enableLoadNewFile"),this._defineEditorDelegatedProp("enableIssueCheck"),this._defineEditorDelegatedProp("enableAutoIssueCheck"),this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(i,r){r||(r=i);var a=ClassEx.getPropInfo(Kekule.Editor.BaseEditor,r),o=Object.create(a);return o.getter=null,o.setter=null,a.getter&&(o.getter=function(){return this.getEditor().getPropValue(r)}),a.setter&&(o.setter=function(l){this.getEditor().setPropValue(r,l)}),this.defineProp(i,o)},loadPredefinedResDataToProp:function(i,r,a){if(i==="chemObj")if(a)try{var o=Kekule.IO.loadTypedData(r.data,r.resType,r.resUri);this.setChemObj(o)}catch(l){Kekule.raise(l,Kekule.ExceptionLevel.ERROR)}else Kekule.throwException(Kekule.$L("ErrorMsg.CANNOT_LOAD_RES_OF_URI")+r.resUri||"")},doCreateRootElement:function(i){return i.createElement("div")},doCreateSubElements:function(i,r){var a=[],o=this._doCreateSubElement(i,r,"div",t.COMPOSER_EDITOR_STAGE,"editorStageElem");return a.push(o),o=this._doCreateSubElement(i,r,"div",t.COMPOSER_ADV_PANEL,"advPanelElem"),this._doCreateSubElement(i,o,"div",null,"objInspectorHolderElem"),this._doCreateSubElement(i,o,"div",t.COMPOSER_ISSUE_PANEL,"issueInspectorHolderElem"),a.push(o),a.push(this._doCreateSubElement(i,r,"div",t.COMPOSER_TOP_REGION,"topRegionElem")),a.push(this._doCreateSubElement(i,r,"div",t.COMPOSER_LEFT_REGION,"leftRegionElem")),a.push(this._doCreateSubElement(i,r,"div",t.COMPOSER_BOTTOM_REGION,"bottomRegionElem")),a},_doCreateSubElement:function(i,r,a,o,l){var u=i.createElement(a);return o&&(u.className=o),r&&r.appendChild(u),l&&this.setPropStoreFieldValue(l,u),u},doGetWidgetClassName:function(){var i=this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPOSER;return this._isUsingGridLayout()&&(i+=" "+t.COMPOSER_GRID_LAYOUT),i},_isUsingGridLayout:function(){return Kekule.BrowserFeature.cssGrid},elementBound:function(i){this.setObserveElemResize(!0)},doWidgetShowStateChanged:function(i){this.tryApplySuper("doWidgetShowStateChanged",[i]),i&&this.adjustComponentPositions()},getResizerElement:function(){return this.getEditorStageElem()},getChildActionClass:function(i,r){var a=this.tryApplySuper("getChildActionClass",[i,r]);return a||(a=this.getEditor().getChildActionClass(i,r)),a},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},newDoc:function(){return this.getEditor().newDoc()},load:function(i){return this.getEditor().load(i)},loadFromData:function(i,r,a,o,l){return this.getEditor().loadFromData(i,r,a,o)},loadFromFile:function(i){return this.getEditor().loadFromFile(i)},getSavingTargetObj:function(){var i=this.getEditor();return i?i.getSavingTargetObj():null},getExportableClasses:function(){return this.getEditor().getExportableClasses()},exportObj:function(i){return this.getEditor().exportObj(i)},exportObjs:function(i){return this.getEditor().exportObjs(i)},undo:function(){return this.getEditor().undo()},redo:function(){return this.getEditor().redo()},undoAll:function(){return this.getEditor().undoAll()},canUndo:function(){return this.getEditor().canUndo()},canRedo:function(){return this.getEditor().canRedo()},repaint:function(i){return this.getEditor().repaint(i),this},getBoundEditorAction:function(i){var r;return typeof i=="string"?r=this.getCompActionClass(i):ClassEx.isClass(i)&&(r=i),r?this.getActionMap().get(r):null},execBoundEditorAction:function(i){var r=this.getBoundEditorAction(i);return r&&r.execute(),r},uiLayoutChanged:function(){this.adjustComponentPositions()},doResize:function(){this.adjustComponentPositions()},adjustComponentPositions:function(){var i=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null,r=this.getZoomBtnGroup()?this.getZoomBtnGroup().getElement():null,a=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(i&&a){if(i)var o=Kekule.HtmlElementUtils.getElemPageRect(i);if(r)var l=Kekule.HtmlElementUtils.getElemPageRect(r);if(a)var u=Kekule.HtmlElementUtils.getElemPageRect(a);if(o.width&&u.width){var c=o.height,d=u.width,h=l&&l.height||c,p=!this._isUsingGridLayout(),g=this.getTopRegionElem(),f=this.getBottomRegionElem(),m=this.getLeftRegionElem(),C=Kekule.HtmlElementUtils.getElemPageRect(this.getElement()),_=(Kekule.HtmlElementUtils.getElemPageRect(g),Kekule.HtmlElementUtils.getElemPageRect(f).width-(l?l.width:0)),y=Kekule.HtmlElementUtils.getElemPageRect(m).height-u.height,T=C.width;if(.85*C.height>T?(this.removeClassName(t.COMPOSER_LANDSCAPE),this.addClassName(t.COMPOSER_PORTRAIT)):(this.addClassName(t.COMPOSER_LANDSCAPE),this.removeClassName(t.COMPOSER_PORTRAIT)),p){(b=g.style).top="0px",b.left=d+"px",b.right="0px",b.height=c+"px",(b=f.style).bottom="0px",b.height=h+"px",b.left=d+"px",b.right="0px",(b=m.style).left="0px",b.top=c+"px",b.bottom="0px",b.width=d+"px";var E,b,v=c,I=d,R=h;if((this.getAdvPanelDisplayedComponents()||[]).length){var N=this.getAdvPanelElem();E=Kekule.HtmlElementUtils.getElemPageRect(N).width}else E=0;(b=this.getEditorStageElem().style).position="absolute",b.top=v+"px",b.left=I+"px",b.bottom=R+"px",b.right=E+"px",(b=(N=this.getAdvPanelElem()).style).position="absolute",b.top=v+"px",b.bottom=R+"px"}if(y/_>.9?this.changeAssocToolbarRegion(!0):this.changeAssocToolbarRegion(!1),this.getAutoSetMinDimension()){var L={width:d+o.width,height:c+u.height};L.width&&L.height&&this.setMinDimension(L)}}}},adjustAssocToolbarPositions:function(){this.adjustStyleAndObjModifierToolbarPosition()},adjustStyleAndObjModifierToolbarPosition:function(){},bindEditor:function(i){i?i.setParent(this):i=this.getEditor(),i.setTouchAction("none");var r=this.getCommonActions();this.getChemActions(),this.createIaControllers(i),i.addEventListener("load",function(o){this.updateAllActions(),this.updateUiWidgets();var l=this.getChemActions().getActionAt(0);l&&l.execute()},this),i.addEventListener("operChange",function(o){r.updateAll(),this.updateUiWidgets()},this),i.addEventListener("selectionChange",function(o){r.updateAll(),this.updateUiWidgets()},this),i.addEventListener("change",function(o){o.changedPropNames.indexOf("enableAutoIssueCheck")>=0&&this.getIssueInspector().setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions())},this);var a=this;i.overwriteMethod("getChildAction",function(o,l,u){var c=a._getCreatedNamedAction(l);return c||(c=o(l,u)),c}),i.appendToElem(this.getEditorStageElem()),this.getEditorNexus().setEditor(i)},createDefaultEditor:function(){var i=new Kekule.Editor.ChemSpaceEditor(this,null,Kekule.Render.RendererType.R2D);return i.addClassName(e.DYN_CREATED),i},createIaControllers:function(i){for(var r=Kekule.Editor.IaControllerManager.getAvailableControllerClasses(i.getClass()),a=0,o=r.length;a<o;++a){var l=new r[a](i);i.addIaController(l.getDefId(),l)}},updateAdvPanelDisplayedComponents:function(i){if(i&&i.length){var r=i.indexOf("objInspector")>=0,a=i.indexOf("issueInspector")>=0;r||a?(r&&!this.getObjInspector()&&this._createObjInspectorControls(),a&&!this.getIssueInspector()&&this._createIssueInspectorControls(),this.getObjInspectorHolderElem().style.display=r?"block":"none",this.getIssueInspectorHolderElem().style.display=a?"block":"none",this.showAdvPanel()):this.hideAdvPanel()}else this.hideAdvPanel();this.uiLayoutChanged()},_createObjInspectorControls:function(i){i||(i=this.getObjInspectorHolderElem());var r=this.getDocument(),a=new Kekule.ChemWidget.StructureTreeView(r);a.setItemInitialExpanded(!0),a.appendToElem(i),a.setParent(this),this.setPropStoreFieldValue("structureTreeView",a);var o=new Kekule.Widget.ObjectInspector(r);o.setShowPropInfoPanel(!1),o.appendToElem(i),o.setParent(this),this.setPropStoreFieldValue("objInspector",o);var l=this.getEditorNexus();l.setObjectInspector(o),l.setStructureTreeView(a)},_createIssueInspectorControls:function(i){i||(i=this.getIssueInspectorHolderElem());var r=this.getDocument(),a=this._doCreateSubElement(r,i,"div",t.COMPOSER_ISSUE_PANEL_WRAPPER),o=this._doCreateSubElement(r,a,"div",t.COMPOSER_ISSUE_PANEL_TOOL_PANEL),l=this.getCommonActions();this.createToolButton(n.recheckIssues,this,l).setShowText(!1).setShowGlyph(!0).appendToElem(o),this.createToolButton(n.toggleShowAllIssues,this,l).setShowText(!1).setShowGlyph(!0).appendToElem(o);var u=this._doCreateSubElement(r,a,"div",t.COMPOSER_ISSUE_PANEL_INSPECTOR_REGION),c=new Kekule.Editor.IssueInspector(r);c.appendToElem(u),c.setParent(this).setResolverCaller(this.getEditor()).setEnableIssueSolutions(this.getActualEnableIssueInspectorSolutions());var d=this;c.addEventListener("resolveIssue",function(h){var p=h.solution;if(p){var g=p.getOperation();g&&d.getEditor().execOperation(g)}}),this.setPropStoreFieldValue("issueInspector",c),this.getEditorNexus().setIssueInspector(c)},getActualEnableIssueInspectorSolutions:function(){return this.getEnableIssueInspectorSolutions()&&this.getEnableAutoIssueCheck()},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},getDefaultCommonToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.commonToolButtons},getZoomButtonNames:function(){return[n.zoomIn,n.zoomOut,n.reset,n.resetZoom]},getDefaultChemToolBarButtons:function(){return Kekule.globalOptions.chemWidget.composer.chemToolButtons},getCompActionClass:function(i){return this.getChildActionClass(i,!0)},_getActionTargetWidget:function(i){return ClassEx.isOrIsDescendantOf(i,Kekule.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(i,Kekule.Widget.ActionOpenConfigWidget)?this:this.getEditor()},createToolButton:function(i,r,a,o){var l=null,u=DataType.isObjectValue(i)?i.name:i,c=this.getCompActionClass(u),d=this._createToolButtonAction(i,a,o);if(DataType.isObjectValue(i)&&!c){var h,p=o?Kekule.Widget.RadioButton:Kekule.Widget.Button;h=Object.extend({widget:p},i),l=Kekule.Widget.Utils.createFromHash(r,h)}else{var g=d.getPreferredWidgetClass&&d.getPreferredWidgetClass();l=new(g||(i===n.objInspector||i===n.issueInspector?Kekule.Widget.CheckButton:o?Kekule.Widget.RadioButton:Kekule.Widget.Button))(r)}return d&&(d.update(),l.setAction(d)),l},_createActionButton:function(i,r){var a=i.getCheckGroup(),o=i.getPreferredWidgetClass&&i.getPreferredWidgetClass(),l=new(o||(a?Kekule.Widget.RadioButton:Kekule.Widget.Button))(r);return i.update(),l.setAction(i),l},_createToolButtonAction:function(i,r,a){var o=DataType.isObjectValue(i),l=null,u=o?i.name:i,c=o?i.attached:null,d=this.getCompActionClass(u);if(o&&!d){var h=i;(d=h.actionClass)&&typeof d=="string"&&(d=ClassEx.findClass(h.actionClass))}if(d){var p=this.getActionMap();(l=p.get(d))||(l=new d(this._getActionTargetWidget(d)),o&&(i.text&&l.setText(i.text),i.hint&&l.setHint(i.hint),(i.htmlClass||i.htmlClassName)&&l.setHtmlClassName((l.getHtmlClassName()||"")+(i.htmlClass||i.htmlClassName))),p.set(d,l));var g=a||"",f=l.getExplicitGroup&&l.getExplicitGroup();if(Kekule.ObjUtils.notUnset(f)&&(g=f),g&&l.setCheckGroup(g),l&&r&&r.add(l),l&&l.addAttachedAction){var m=l.getClassName(),C=Kekule.ArrayUtils.clone(l.getAttachedActions().getActions()||[]),_=function(L,U,W,M,B){if(!U)return null;var V=W.indexOf(U);V>=0?W[V]=null:L.addAttachedAction(U,M),Kekule.ObjUtils.notUnset(B)&&L.setAttachedActionIndex(U,B)};if(c)for(var y=0,T=c.length;y<T;++y){var E=c[y];_(l,v=this._createToolButtonAction(E,null,m),C,y===0,y)}else{var b=l.getAttachedActionClasses();if(b)for(y=0,T=b.length;y<T;++y){var v,I=b[y];if(!(v=p.get(I))){var R=(v=new I(this._getActionTargetWidget(I))).getExplicitGroup&&v.getExplicitGroup();Kekule.ObjUtils.notUnset(R)?v.setCheckGroup(R):v.setCheckGroup(m),p.set(I,v)}_(l,v,C,y===0,y)}}if(C.length)for(y=0,T=C.length;y<T;++y){var N=C[y];N&&(l.removeAttachedAction(N),p.remove(N.getClass()))}}}return l},_getCreatedNamedAction:function(i){var r=this.getCompActionClass(i),a=this.getActionMap();return r&&a.get(r)},createInnerToolbar:function(i,r){var a=new Kekule.Widget.ButtonGroup(this);a.addClassName(t.COMPOSER_TOOLBAR),a.addClassName(t.INNER_TOOLBAR),a.addClassName(e.DYN_CREATED),a.setShowText(!1),a.doSetShowGlyph(!0);var o=i||this.getElement();if(r){var l=Kekule.DomUtils.getFirstChildElem(o);l?a.insertToElem(o,l):a.appendToElem(o)}else a.appendToElem(o);return a.setBubbleUiEvents(!0),a},createCommonToolbar:function(){var i=this.getTopRegionElem(),r=this.createInnerToolbar(i);r.addClassName(t.COMPOSER_COMMON_TOOLBAR);var a=this.getCommonToolButtons();a=Kekule.ArrayUtils.exclude(a,this.getZoomButtonNames());var o=this.getCommonActions();this.getEditor(),o.clear();for(var l=0,u=a.length;l<u;++l){var c=a[l];this.createToolButton(c,r,o)}return this.setCommonBtnGroup(r),r.addClassName(e.DYN_CREATED),this.updateZoomToolbar(),this.adjustComponentPositions(),r},createZoomToolbar:function(){var i=Kekule.ArrayUtils.intersect(this.getCommonToolButtons(),this.getZoomButtonNames());if(i.length){var r=this.getBottomRegionElem(),a=this.createInnerToolbar(r);a.addClassName(t.COMPOSER_ZOOM_TOOLBAR);var o=this.getZoomActions();this.getEditor(),o.clear();for(var l=0,u=i.length;l<u;++l){var c=i[l];this.createToolButton(c,a,o)}return this.setZoomBtnGroup(a),a.addClassName(e.DYN_CREATED),this.adjustComponentPositions(),a}return this.setZoomBtnGroup(null),null},updateCommonToolbar:function(){var i=this.getCommonBtnGroup();i&&i.finalize(),this.createCommonToolbar()},updateZoomToolbar:function(){var i=this.getZoomBtnGroup();i&&i.finalize(),this.createZoomToolbar()},createChemToolbar:function(){var i=this.getLeftRegionElem(),r=this.createInnerToolbar(i,!0);r.addClassName(t.COMPOSER_CHEM_TOOLBAR),r.setLayout(Kekule.Widget.Layout.VERTICAL);var a=this.getChemToolButtons(),o=this.getChemActions();o.clear();for(var l,u=0,c=a.length;u<c;++u){var d=a[u],h=this.createToolButton(d,r,o,"chemTools");u===0&&(l=h)}if(this.setChemBtnGroup(r),r.addClassName(e.DYN_CREATED),this.adjustComponentPositions(),l){var p=l.getAction();if(p){p.setChecked(!0);var g=p.getAttachedActions&&p.getAttachedActions();this.bindAssocActions(g||null)}}return r},updateChemToolbar:function(){var i=this.getChemBtnGroup();i&&i.finalize(),this.createChemToolbar()},createAssocToolbar:function(){var i=this.getBottomRegionElem(),r=this.createInnerToolbar(i);return r.addClassName(t.COMPOSER_ASSOC_TOOLBAR),this.setAssocBtnGroup(r),this.adjustAssocToolbarPositions(),r.addClassName(e.DYN_CREATED),r},changeAssocToolbarRegion:function(i){var r,a=this.getAssocBtnGroup();if(a||(a=this.createAssocToolbar()),i)r=this.getLeftRegionElem(),a.getElement().parentNode!==r&&(a.setLayout(Kekule.Widget.Layout.VERTICAL),a.appendToElem(r));else if(r=this.getBottomRegionElem(),a.getElement().parentNode!==r){a.setLayout(Kekule.Widget.Layout.HORIZONTAL);var o=Kekule.DomUtils.getFirstChildElem(r);r.insertBefore(a.getElement(),o)}},showAssocToolbar:function(){var i=this.getAssocBtnGroup();i||(i=this.createAssocToolbar());var r=this;return i.show(null,function(){r.uiLayoutChanged(),setTimeout(r.updateSelectionAssocToolbarStateBind,0)}),this},hideAssocToolbar:function(){var i=this.getAssocBtnGroup();if(i){var r=this;i.hide(null,function(){r.uiLayoutChanged(),setTimeout(r.updateSelectionAssocToolbarStateBind,0)})}return this},isAssocToolbarShown:function(){var i=this.getAssocBtnGroup();return i&&i.isShown()},bindAssocActions:function(i){var r=this.getAssocBtnGroup();if(r||(r=this.createAssocToolbar()),r.clearWidgets(),i)for(var a=0,o=i.getActionCount();a<o;++a){var l=i.getActionAt(a);this._createActionButton(l,r)}},createObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var i=new Kekule.Editor.ComposerObjModifierToolbar(this);return i.appendToElem(this.getBottomRegionElem()),i.setBubbleUiEvents(!0),this.setObjModifierToolbar(i),this.adjustAssocToolbarPositions(),this.updateObjModifierToolbarState(),i}return null},showObjModifierToolbar:function(){if(this.getEnableObjModifierToolbar()){var i=this.getObjModifierToolbar();if(!i.isShown()){var r=this;i.show(null,function(){r.uiLayoutChanged()})}}return this},hideObjModifierToolbar:function(){var i=this.getPropStoreFieldValue("objModifierToolbar");if(i&&i.isShown()){var r=this;i.hide(null,function(){r.uiLayoutChanged()},null,{instantly:!0})}return this},isObjModifierToolbarShown:function(){var i=this.getPropStoreFieldValue("objModifierToolbar");return i&&i.isShown()},updateObjModifierToolbarState:function(){var i=!1;this.getEnableObjModifierToolbar()&&this.needShowSelectionAssocToolbar()&&(i=!0),i?(this.showObjModifierToolbar(),this.getObjModifierToolbar().updateState()):this.hideObjModifierToolbar()},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var i=new Kekule.Editor.ComposerStyleToolbar(this);return i.setComponentNames(this.getStyleBarComponents()),i.appendToElem(this.getBottomRegionElem()),i.setBubbleUiEvents(!0),this.setStyleToolbar(i),this.adjustAssocToolbarPositions(),this.updateStyleToolbarState(),i}return null},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var i=this.getStyleToolbar();if(!i.isShown()){var r=this;i.show(null,function(){r.uiLayoutChanged()})}}return this},hideStyleToolbar:function(){var i=this.getPropStoreFieldValue("styleToolbar");if(i&&i.isShown()){var r=this;i.hide(null,function(){r.uiLayoutChanged()})}return this},isStyleToolbarShown:function(){var i=this.getPropStoreFieldValue("styleToolbar");return i&&i.isShown()},updateStyleToolbarState:function(){this.getEnableStyleToolbar()&&this.needShowSelectionAssocToolbar()?(this.showStyleToolbar(),this.getStyleToolbar().updateState()):this.hideStyleToolbar()},needShowSelectionAssocToolbar:function(){var i=this.getEditor();return i&&i.hasSelection()},updateSelectionAssocToolbarState:function(){this.adjustStyleAndObjModifierToolbarPosition(),this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},updateAllActions:function(){this.getCommonActions().updateAll(),this.getZoomActions().updateAll(),this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState(),this.updateObjModifierToolbarState()},createConfigurator:function(){var i=this.tryApplySuper("createConfigurator");return i.addEventListener("configChange",function(r){this.getEditor().repaint()},this),i},react_keydown:function(i){if(!this.tryApplySuper("react_keydown",[i])&&this._isAcceptableHotKeyEvent(i))return!!this.getEditor().reactHotKeys(i)},_isAcceptableHotKeyEvent:function(i){var r=!1,a=i.getTarget();if(a&&a.tagName&&["input","select"].indexOf(a.tagName.toLowerCase())<0){var o=i.getKey()||"";r=Kekule.Widget.KeyboardUtils.isPrintableKey(o)&&o!==" "||o==="Backspace"||o==="Delete"||o==="Del"}return r}}),Kekule.Editor.Composer.getMinPreferredDimension=function(){return{width:630,height:350}},Kekule.Editor.Composer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function(i){this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","allowAppendDataToCurr","enableIssueCheck","enableStyleToolbar","enableObjModifierToolbar"])}}),Kekule.Editor.Composer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function(i){this.tryApplySuper("initialize",[i])},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function(){for(var i=this.tryApplySuper("getCategoryInfos"),r=this.getComposer().getEditor(),a=[r.getDisplayerConfigs(),r.getRenderConfigs()],o=0,l=a.length;o<l;++o)for(var u=a[o],c=u.getPropListOfScopes([Class.PropertyScope.PUBLISHED]),d=0,h=c.getLength();d<h;++d){var p=c.getPropInfoAt(d),g=u.getPropValue(p.name);g&&i.push({obj:g,name:p.name,title:p.title,description:p.description})}return i},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}}),Kekule._registerAfterLoadSysProc(function(){var i=Kekule.Editor.ObjModifier.Category,r=Kekule.ObjPropSettingManager;r.register("Kekule.Editor.Composer.fullFunc",{enableObjModifierToolbar:!0,enableOperHistory:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),r.register("Kekule.Editor.Composer.molOnly",{enableObjModifierToolbar:!0,enableOperHistor:!0,enableLoadNewFile:!0,enableCreateNewDoc:!0,allowCreateNewChild:!0,commonToolButtons:null,chemToolButtons:[n.manipulate,n.erase,n.molBond,n.molAtom,n.molRing,n.molCharge],styleToolComponentNames:null,allowedObjModifierCategories:[i.GENERAL,i.CHEM_STRUCTURE]}),r.register("Kekule.Editor.Composer.compact",{enableObjModifierToolbar:!0,commonToolButtons:[n.newDoc,n.loadData,n.saveData,n.undo,n.redo,n.zoomIn,n.zoomOut],chemToolButtons:null,styleToolComponentNames:null,allowedObjModifierCategories:null}),r.register("Kekule.Editor.Composer.singleObj",{allowCreateNewChild:!1})}),Kekule.Editor.ComposerDialog=Class.create(Kekule.Widget.Dialog,{CLASS_NAME:"Kekule.Editor.ComposerDialog",initialize:function(i,r,a){this.tryApplySuper("initialize",[i,r,a||[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:!1,setter:null}),this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:!1,getter:function(){var i=this.getComposer();return i&&i.getChemObj()},setter:function(i){var r=this.getComposer();r&&r.setChemObj(i)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPOSER_DIALOG},doCreateClientContents:function(i){this.tryApplySuper("doCreateClientContents");var r=this.doCreateComposerWidget();this.setPropStoreFieldValue("composer",r),r.appendToElem(i)},getSavingTargetObj:function(){var i=this.getComposer();return i?i.getSavingTargetObj():null},doCreateComposerWidget:function(){var i=new Kekule.Editor.Composer(this);return i.addClassName(e.DYN_CREATED),i.setResizable&&i.setResizable(!0),i.getEditor().addClassName(e.DYN_CREATED),i}}),Kekule.Editor.ComposerFrame=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.ComposerFrame",BINDABLE_TAG_NAMES:["iframe"],initialize:function(i){this.tryApplySuper("initialize",[i])},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null}),this.defineProp("frameDocument",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.getElement().contentDocument}}),this.defineProp("frameWindow",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return Kekule.DocumentUtils.getDefaultView(this.getFrameDocument())}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setMinDimension({width:550,height:350}),this.setEnableDimensionTransform(!0)},doGetWidgetClassName:function(){return this.tryApplySuper("doGetWidgetClassName")+" "+t.COMPOSER_FRAME},doCreateRootElement:function(i){return i.createElement("iframe")},doBindElement:function(i){this.tryApplySuper("doBindElement",[i]),i.parentNode||(this.setDisplayed(!1),i.ownerDocument.body.appendChild(i)),this._createComposerWidgetInFrame()},_initFrame:function(){var i=this.getFrameDocument();i.open("text/htmlreplace"),i.write("<!DOCTYPE html><html><head></head><body></body></html>"),i.close()},_createComposerWidgetInFrame:function(i){this._initFrame();var r=this,a=this.getFrameDocument();a.documentElement.className=t.COMPOSER_FRAME_CONTENT_DOC,a.body.className=t.COMPOSER_FRAME_CONTENT_BODY,Kekule.X.Event.addListener(a.body,"kekuleload",function(o){var l=new Kekule.Editor.Composer(a);l.appendToElem(a.body),r.setPropStoreFieldValue("composer",l),i&&i(l)}),this._insertKekuleScriptAndStyleSheetFiles(a)},_insertKekuleScriptAndStyleSheetFiles:function(i,r){var a=i.head,o=i.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",Kekule.getStyleSheetUrl()),a.appendChild(o),Kekule.ScriptFileUtils.appendScriptFile(i,Kekule.getScriptSrc(),r)}})}();(function(){if(typeof HTMLElement<"u"){Kekule.WebComponent={},Kekule.globalOptions.add("webComponent.init",{shadowInitOptions:{mode:"open"}}),Kekule.globalOptions.add("webComponent.widgetWrapper",{exposeWidgetProperties:!0,exposeWidgetMethods:!1,ignoredProperties:["id","draggable","droppable","innerHTML","style","offsetParent","offsetLeft","offsetTop","offsetWidth","offsetHeight"],ignoredMethods:["constructor","initialize","finalize","doFinalize","afterInitialization","initProperties","initPropValues","saved","loaded","invokeEvent"]}),Kekule.WebComponent;var s=Kekule.DomUtils;Kekule.WebComponent.WebComponentContextEventRelayer=Class.create(Kekule.Widget.BaseEventsReceiver,{CLASS_NAME:"Kekule.WebComponent.WebComponentContextEventRelayer",initialize:function(t,n,i){this._globalManager=i,this.tryApplySuper("initialize",[t,n]),this._isInShadow=n&&s.isInShadowRoot(n),this._globalManager.setHasWebComponentContext(!0)},isInShadow:function(){return this._isInShadow},reactUiEvent:function(t){var n=this.tryApplySuper("reactUiEvent",[t]);return this.isInShadow()&&(n=this._globalManager.reactUiEvent(t),t.stopPropagation()),n},reactDomNodeInsertEvent:function(t){return this.isInShadow()?(t.stopPropagation(),this._globalManager.reactDomNodeInsertEvent(t)):this.tryApplySuper("reactDomNodeInsertEvent",[t])},reactDomNodeRemoveEvent:function(t){return this.isInShadow()?(t.stopPropagation(),this._globalManager.reactDomNodeRemoveEvent(t)):this.tryApplySuper("reactDomNodeRemoveEvent",[t])},reactDomMutation:function(t){return this.isInShadow()?this._globalManager.reactDomMutation(t):this.tryApplySuper("reactDomMutation")}});class e extends HTMLElement{constructor(){super();var n=this.attachShadow(Kekule.globalOptions.webComponent.init.shadowInitOptions);this._initStyles(n),this._importStyleSheet(n),this._createSubElements(n),new Kekule.WebComponent.WebComponentContextEventRelayer(this.ownerDocument,this.hostElem,Kekule.Widget.globalManager)}_createSubElements(n){var i=this.ownerDocument.createElement("div");n.appendChild(i),this._hostElem=i}_importStyleSheet(n){Kekule.Widget.globalManager.loadTheme(n)}_initStyles(n){var i=n.ownerDocument.createElement("style");i.innerHTML=":host { position: static; width: 0px; height: 0px; left: 0px; top: 0px; }",n.appendChild(i)}ensureToBeLast(){var n=this.ownerDocument.body;n.lastChild!==this&&n.appendChild(this)}get hostElem(){return this._hostElem}}Kekule.WebComponent.WebComponentContextPopupHost=e,typeof customElements<"u"&&customElements.define("kekule-webcomponent-popup-host",e),Kekule.WebComponent.widgetWrapperPopupHost=null,ClassEx.extend(Kekule.Widget.GlobalManager,{getWebComponentContextRootElem:function(){return Kekule.WebComponent.widgetWrapperPopupHost||(Kekule.WebComponent.widgetWrapperPopupHost=new e,document.body.appendChild(Kekule.WebComponent.widgetWrapperPopupHost)),Kekule.WebComponent.widgetWrapperPopupHost.ensureToBeLast(),Kekule.WebComponent.widgetWrapperPopupHost.hostElem},isWidgetEnvironmentSetupIn:function(t){return t==="webComponent"?!!this.getHasWebComponentContext():(this._docContextEnvironmentSetup||this._detectIfThemeLoaded(this.getDocContextRootElem())&&(this._docContextEnvironmentSetup=!0),this._docContextEnvironmentSetup)}}),ClassEx.extendMethod(Kekule.Widget.GlobalManager,"getWidgetContextRootElement",function(t,n){return n&&n.isWrappedInWebComponent()?this.getWebComponentContextRootElem():t(n)}),ClassEx.extendMethod(Kekule.Widget.GlobalManager,"getDefaultContextRootElem",function(t){return this.isWidgetEnvironmentSetupIn("document")?this.getDocContextRootElem():this.isWidgetEnvironmentSetupIn("webComponent")?this.getWebComponentContextRootElem():t()}),ClassEx.defineProp(Kekule.Widget.GlobalManager,"hasWebComponentContext",{dataType:DataType.BOOL,serializable:!1}),ClassEx.extend(Kekule.Widget.BaseWidget,{isWrappedInWebComponent:function(){if(typeof ShadowRoot>"u")return!1;var t=this.getElement(),n=t.getRootNode&&t.getRootNode();return!!(n&&n instanceof ShadowRoot)}}),Kekule.WebComponent.BaseWidgetWrapper=class extends HTMLElement{constructor(){super();var t=this.attachShadow(Kekule.globalOptions.webComponent.init.shadowInitOptions);this._shadow=t;var n=this._createWidget(this.constructor.widgetClass,t);this._prepareStyles(t),new Kekule.WebComponent.WebComponentContextEventRelayer(this.ownerDocument,n.getElement(),Kekule.Widget.globalManager),this._reflectingChangedAttributes=[]}connectedCallback(){for(var t=this.getAttributeNames(),n=this.constructor.observedAttributes,i=0,r=(t=Kekule.ArrayUtils.intersect(t,n)).length;i<r;++i){var a=this.getAttribute(t[i]);this._setWidgetPropValueFromAttribute(t[i],a)}}static get observedAttributes(){var t=[];if(this._exposedWidgetProperties)for(var n=0,i=this._exposedWidgetProperties.length;n<i;++n){var r=this._exposedWidgetProperties[n].name;t.push(r.dasherize()),t.push("data-"+r.dasherize())}return t}attributeChangedCallback(t,n,i){if(!this._isChangingPropFromAttribute(t))try{this._reflectingChangedAttributes.push(t),this._setWidgetPropValueFromAttribute(t,i)}finally{Kekule.ArrayUtils.remove(this._reflectingChangedAttributes,t)}}_setWidgetPropValueFromAttribute(t,n){Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this.widget,t,n)}_isChangingPropFromAttribute(t){return this._reflectingChangedAttributes.indexOf(t)>=0}static get widgetClass(){return this._widgetClass}static set widgetClass(t){this._widgetClass=t}static _exposeWidgetProperties(t,n,i){for(var r=i||{},a=this.widgetClass,o=ClassEx.getAllPropList(a),l=[],u=[],c=0,d=o.getLength();c<d;++c){var h=o.getPropInfoAt(c);if(!(h.scope<Class.PropertyScope.PUBLIC)&&!(t&&t.indexOf(h.name)<0)&&!(n&&n.indexOf(h.name)>=0)&&(!Kekule.ObjUtils.getPropertyDescriptor(this.prototype,h.name,!0)||r.overwriteExisitedProperties)){l.push(h);var p={enumerable:h.enumerable,configurable:!1};if(p.enumerable===void 0&&(p.enumerable=!0),h.getter){h.getter;var g="get"+h.name.upperFirst();(function(m,C){C.get=function(){return this.widget.getPropValue(m)}})(h.name,p),u.push(g)}if(h.setter){h.setter;var f="set"+h.name.upperFirst();(function(m,C){C.set=function(_){var y=this.widget.setPropValue(m,_),T=this.widget.getPropValue(m);return this._exposedPropValueChanged(m,T),y}})(h.name,p),u.push(f)}try{Object.defineProperty(this.prototype,h.name,p)}catch(m){throw m}}}return this._exposedWidgetProperties=l,{exposedPropInfos:l,getterSetterMethodNames:u}}static _exposeWidgetMethods(t,n,i){for(var r=this.widgetClass,a=(ClassEx.getPrototype(r),function p(g,f){var m=function(_){for(var y=ClassEx.getPrototype(_),T=ClassEx.getSuperClass(_),E=(T&&ClassEx.getPrototype(T),Object.getOwnPropertyNames(y)),b=[],v=0,I=E.length;v<I;++v){var R=E[v],N=Object.getOwnPropertyDescriptor(y,R);N&&N.value&&typeof N.value=="function"&&b.push(R)}return b}(g);if(g!==f){var C=ClassEx.getSuperClass(g);C&&(m=p(C,f).concat(m))}return m}(r,Kekule.Widget.BaseWidget)),o=ClassEx.getPrototype(ClassEx.getSuperClass(Kekule.Widget.BaseWidget)),l=[],u=0,c=a.length;u<c;++u){var d=a[u],h=t&&t.indexOf(d)>=0;if(!(n&&n.indexOf(d)>=0)&&!(t&&t.indexOf(d)<0)&&(h||!(d in o))&&(h||!d.startsWith("_"))&&!Object.getOwnPropertyDescriptor(d)){try{if(d in this)continue}catch{}(function(p,g,f){p.prototype[g]=function(){return this.widget[g].apply(this.widget,arguments)},f.push(g)})(this,d,l)}}return l}_createWidget(t,n){this._widget=new t(this.ownerDocument),this._widget.beginUpdate();try{var i=this._widget.getElement().style;i.width="100%",i.height="100%",this._widget.appendToElem(n)}finally{this._widget.endUpdate()}return this._widget}_prepareStyles(t){Kekule.Widget.globalManager.loadTheme(t);var n=t.ownerDocument.createElement("style");n.innerHTML=`:host { display: inline-block; position: relative; vertical-align: bottom; }
:host([hidden]) { display: none }`,t.appendChild(n)}_exposedPropValueChanged(t,n){if(this.widget.getPropInfo(t)&&DataType.isSimpleValue(n)){var i=t.dasherize();this.setAttribute(i,n)}}get widgetHost(){return this._shadow}get widget(){return this._widget}},Kekule.WebComponent.Utils={wrapWidget:function(t,n,i){var r,a=Kekule.globalOptions.webComponent.widgetWrapper,o=Object.extend({exposeWidgetProperties:a.exposeWidgetProperties,ignoredProperties:a.ignoredProperties,exposeWidgetMethods:a.exposeWidgetMethods,ignoredMethods:a.ignoredMethods},i||{}),l=class extends Kekule.WebComponent.BaseWidgetWrapper{constructor(){super()}};if(l.widgetClass=t,o.exposeWidgetProperties&&(r=l._exposeWidgetProperties(o.exposedProperties,o.ignoredProperties,{overwriteExisitedProperties:o.overwriteExisitedProperties})),o.exposeWidgetMethods){var u=o.ignoredMethods||[];r&&(u=u.concat(r.getterSetterMethodNames)),l._exposeWidgetMethods(o.exposedMethods,u,{})}return n&&typeof customElements<"u"&&customElements.define(n,l),l}}}})(),function(){var s=[{widgetClassName:"Kekule.ChemWidget.PeriodicTable",htmlTagName:"kekule-periodic-table"},{widgetClassName:"Kekule.ChemWidget.Viewer",htmlTagName:"kekule-viewer"},{widgetClassName:"Kekule.ChemWidget.Viewer2D",htmlTagName:"kekule-viewer2d"},{widgetClassName:"Kekule.ChemWidget.Viewer3D",htmlTagName:"kekule-viewer3d"},{widgetClassName:"Kekule.ChemWidget.SpectrumInspector",htmlTagName:"kekule-spectrum-inspector"},{widgetClassName:"Kekule.ChemWidget.ChemObjInserter",htmlTagName:"kekule-chem-obj-inserter"},{widgetClassName:"Kekule.ChemWidget.SpectrumObjInserter",htmlTagName:"kekule-spectrum-obj-inserter"},{widgetClassName:"Kekule.Editor.Composer",htmlTagName:"kekule-composer"}];Kekule._registerAfterLoadSysProc(function(){if(Kekule.WebComponent&&Kekule.WebComponent.Utils)for(var e=Kekule.WebComponent,t=0,n=s.length;t<n;++t){var i=s[t],r=Object.getCascadeFieldValue(i.widgetClassName,Kekule.$jsRoot),a=i.htmlTagName;if(r&&a){var o=Kekule.ClassUtils.getLastClassName(i.widgetClassName),l=Kekule.WebComponent.Utils.wrapWidget(r,a);e[o]=l}}})}();(function(){var s=Kekule.ArrayUtils;Kekule.GraphElement=Class.create(ObjectEx,{CLASS_NAME:"Kekule.GraphElement",initialize:function(){this.tryApplySuper("initialize"),this._data={}},initProperties:function(){this.defineProp("storedData",{dataType:DataType.HASH,getter:function(){return this._data},setter:function(e){this._data=e||{}}})},getData:function(e){return e?this._data[e]:this._data},setData:function(e,t){return e&&(this._data[e]=t),this},removeData:function(e){return this._data[e]&&delete this._data[e],this}}),Kekule.GraphVertex=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphVertex",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},getEdgeCount:function(){return this.getEdges().length},getNeighbors:function(){for(var e=[],t=this.getEdges(),n=0,i=t.length;n<i;++n){var r=t[n].getVertexes();s.pushUnique(e,s.exclude(r,this))}return e},getNeighborOnEdge:function(e){for(var t=e.getVertexes(),n=0,i=t.length;n<i;++n)if(t[n]!==this)return t[n]},getEdgeTo:function(e){for(var t=this.getEdges(),n=0,i=t.length;n<i;++n)if(t[n].getVertexes().indexOf(e)>=0)return t[n];return null},doAppendEdge:function(e){return Kekule.ArrayUtils.pushUnique(this.getEdges(),e),this},doRemoveEdge:function(e){return Kekule.ArrayUtils.remove(this.getEdges(),e),this},doClearEdges:function(){for(var e=this.getEdges(),t=e.length-1;t>=0;--t)this.removeEdge(e[t]);return this}}),Kekule.GraphEdge=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphEdge",initialize:function(){this.setPropStoreFieldValue("weight",1),this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("weight",{dataType:DataType.NUMBER})},replaceVertex:function(e,t){var n=this.getVertexes(),i=n.indexOf(e),r=n.indexOf(t);i<0||r>=0||(n.splice(i,1,t),e.doRemoveEdge(this),t.doAppendEdge(this))}}),Kekule.GraphTraverseMode={DEPTH_FIRST:0,BREADTH_FIRST:1},Kekule.Graph=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Graph",VISITED_KEY:"__$visited__",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[]),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},addVertex:function(e){return Kekule.ArrayUtils.pushUnique(this.getVertexes(),e),this},newVertex:function(){var e=new Kekule.GraphVertex;return this.addVertex(e),e},removeVertex:function(e){if(Kekule.ArrayUtils.remove(this.getVertexes(),e))for(var t=Kekule.ArrayUtils.clone(e.getEdges()),n=0,i=t.length;n<i;++n)this.removeEdge(t[n])},addEdge:function(e,t,n){return Kekule.ArrayUtils.pushUnique(this.getEdges(),e)&&(e.setPropStoreFieldValue("vertexes",[t,n]),t.doAppendEdge(e),n.doAppendEdge(e)),this},newEdge:function(e,t){var n=new Kekule.GraphEdge;return this.addEdge(n,e,t),n},removeEdge:function(e){for(var t=e.getVertexes(),n=0,i=t.length;n<i;++n)t[n].doRemoveEdge(e);return Kekule.ArrayUtils.remove(this.getEdges(),e),this},traverse:function(e,t,n){for(var i=[],r=s.clone(this.getVertexes()),a=0,o=r.length;a<o;++a)r[a].setData(this.VISITED_KEY,!1);for(;r.length;){var l,u={vertexes:[],edges:[]};l=n&&r.indexOf(n)>=0?n:r[0];var c=this._doTravers(e,t,l);u.vertexes=u.vertexes.concat(c.vertexes),u.edges=u.edges.concat(c.edges),r=s.exclude(r,c.vertexes),i.push(u)}return i},_doTravers:function(e,t,n){var i={vertexes:[],edges:[]},r=n;r.getData(this.VISITED_KEY)||(i.vertexes.push(r),r.setData(this.VISITED_KEY,!0),e&&e(r,!1));for(var a=r.getEdges(),o=[],l=t===Kekule.GraphTraverseMode.BREADTH_FIRST,u=0,c=a.length;u<c;++u){var d=a[u],h=r.getNeighborOnEdge(d);if(!h.getData(this.VISITED_KEY))if(i.vertexes.push(h),i.edges.push(d),h.setData(this.VISITED_KEY,!0),e&&(e(d,!0),e(h,!1)),l)o.push(h);else{var p=this._doTravers(e,t,h);i.vertexes=i.vertexes.concat(p.vertexes),i.edges=i.edges.concat(p.edges)}}if(l)for(u=0,c=o.length;u<c;++u){var g=o[u];p=this._doTravers(e,t,g),i.vertexes=i.vertexes.concat(p.vertexes),i.edges=i.edges.concat(p.edges)}return i}}),Kekule.globalOptions.add("algorithm.molToGraph",{expandSubStructures:!0,ignoreBondedHydrogen:!0}),Kekule.GraphAdaptUtils={ctabToGraph:function(e,t,n){var i=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.molToGraph),n||{}),r=e,a=Kekule.ArrayUtils,o=null,l=i.expandSubStructures;if(r){for(var u=i.nodeFilter||function(W,M){if(i.nodeClasses){var B=W.getClass();if(!ClassEx.isOrIsDescendantOfClasses(B,i.nodeClasses))return!1}if(i.ignoreBondedHydrogen&&W.isHydrogenAtom&&W.isHydrogenAtom()){var V=W.getLinkedConnectors();if(M&&(V=a.intersect(V,M)),V.length<=1){var J=V[0];if(!J||J.isSingleBond&&J.isSingleBond())return!1}}return!0},c=i.connectorFilter||function(W,M){if(i.connectorClasses){var B=W.getClass();if(!ClassEx.isOrIsDescendantOfClasses(B,i.connectorClasses))return!1}return!(W.getBondType&&i.bondTypes&&i.bondTypes.indexOf(W.getBondType())<0)},d=(o=t||new Kekule.Graph,l?r.getAllContainingConnectors():r.getConnectors()),h=l?r.getLeafNodes():r.getNodes(),p=[],g=new Kekule.MapEx,f=0,m=d.length;f<m;++f){var C=d[f];if(c(C))for(var _=[],y=l?C.getConnectedObjs():C.getConnectedSiblings(),T=0,E=y.length;T<E;++T){var b=y[T];if(h.indexOf(b)>=0&&(u(b,d)?_.push(b):a.pushUnique(p,b),_.length>=2)){for(var v=a.exclude(_,p),I=0,R=v.length;I<R;++I)(L=o.newVertex()).setData("object",v[I]),g.set(v[I],L);o.newEdge(g.get(_[0]),g.get(_[1])).setData("object",C),a.pushUnique(p,_);break}}}var N=a.exclude(h,p);for(f=0,m=N.length;f<m;++f){var L,U=N[f];u(U,d)&&(L=o.newVertex()).setData("object",U)}g.finalize()}return o},molToGraph:function(e,t,n){if(Kekule.ArrayUtils,!e||!e.hasCtab())return null;var i=e.getCtab();return i?Kekule.GraphAdaptUtils.ctabToGraph(i,t,n):null},chemObjToGraph:function(e,t,n){for(var i=Kekule.ChemStructureUtils.getAllStructFragments(e,!0),r=t||new Kekule.Graph,a=0,o=i.length;a<o;++a)Kekule.GraphAdaptUtils.molToGraph(i[a],r,n);return r}},Kekule.GraphAlgorithmUtils={SEQ_KEY:"__$seq__",RESD_DEGREE_KEY:"__$resdDegree__",VISIT_EDGE_DEGREE_KEY:"__$visitedEdgeDegree__",TYPE_KEY:"__$type__",TYPE_CYCLE:"cycle",TYPE_BRIDGE:"bridge",VISITED_KEY:"__$visited",createSpanningTrees:function(e,t){return e.traverse(null,t)},calcMinDistances:function(e,t){var n,i,r=e.getVertexes();DataType.isSimpleValue(t)?n=r[i=t]:(n=t,i=r.indexOf(n));for(var a=[],o=[],l=0,u=r.length;l<u;++l){var c=r[l];l===i?(a[l]=0,o[l]=n):(C=n.getEdgeTo(c))?(a[l]=C.getWeight(),o[l]=n):(a[l]=1/0,o[l]=null)}var d=[i];for(l=0,u=r.length;l<u;++l)if(l!==i){for(var h,p=1/0,g=-1,f=0,m=r.length;f<m;++f)f!==i&&d.indexOf(f)<0&&a[f]<p&&(p=a[f],g=f,h=r[f]);for(d.push(g),f=0,m=r.length;f<m;++f)if(d.indexOf(f)<0){var C,_=p+((C=h.getEdgeTo(r[f]))?C.getWeight():1/0);_<a[f]&&(a[f]=_)}}return a},findCycleBlocks:function(e){for(var t=[],n=Kekule.GraphAlgorithmUtils,i=n.SEQ_KEY,r=n.RESD_DEGREE_KEY,a=n.VISIT_EDGE_DEGREE_KEY,o=n.TYPE_KEY,l=n.TYPE_CYCLE,u=n.TYPE_BRIDGE,c=e.getEdges(),d=0,h=c.length;d<h;++d)c[d].removeData(i);var p=e.getVertexes();for(d=0,h=p.length;d<h;++d)p[d].removeData(o);var g=1,f=1,m=[],C=[];for(e.traverse(function(M,B){B?(M.setData(i,g),++g):(M.setData(i,f),++f,m.push(M))}),d=0,h=m.length;d<h;++d){var _=m[d],y=_.getEdges();_.setData(r,y.length);for(var T=0,E=0,b=y.length;E<b;++E)y[E].getData(i)&&++T;_.setData(a,T),T<y.length&&C.push(_)}for(var v=function(M,B){if(B&&M.getData(i)<=1)return null;for(var V=M.getEdges(),J=null,$=null,q=0,Q=V.length;q<Q;++q){var ie=V[q].getData(i);ie&&($?ie<$&&(J=V[q],$=ie):(J=V[q],$=ie))}return J||null},I=function(M){for(var B=M.getEdges(),V=0,J=B.length;V<J;++V)if(!B[V].getData(i)&&!B[V].getData(o))return B[V];return null},R=function(M){var B=[],V=[],J=M.getData(a),$=(Y=M.getData(r))-J;if($>0){M.setData(o,l),s.pushUnique(B,M);for(var q=0;q<$;++q){M.setData(r,Y+1);var Q=I(M);if(Q){Q.setData(o,l),s.pushUnique(V,Q);var ie=M.getNeighborOnEdge(Q);for(ie.setData(r,ie.getData(r)+1),ie.setData(o,l),s.pushUnique(B,ie);;){var Y;if((J=ie.getData(a))<(Y=ie.getData(r))){var ne=R(ie);s.pushUnique(B,ne.vertexes),s.pushUnique(V,ne.edges)}var de=v(ie,!1);if(!de)break;de.setData(o,l),s.pushUnique(V,de);var Ae=ie.getNeighborOnEdge(de);if(Ae.getData(o))break;Ae.setData(o,l),s.pushUnique(B,Ae),ie=Ae}}}}return{vertexes:B,edges:V}},N=m.shift();N;){if(!N.getData(o)){var L=N.getData(a);if(N.getData(r)-L>0){var U=R(N);t.push(U)}else{N.setData(o,u);var W=v(N,!0);W&&W.setData(o,u)}}N=m.shift()}return t},findEndChains:function(e){for(var t=Kekule.ArrayUtils,n={vertexes:[],edges:[]},i=t.clone(e.getVertexes()),r=[],a=0,o=i.length;a<o;++a){var l=i[a],u=l.getEdgeCount();l.setData("__$currConnectivity__",u),u<=1&&r.push(l)}if(r.length){var c=r.pop();for(t.remove(i,c),n.vertexes.push(c);i.length;){var d=!1,h=t.exclude(c.getEdges(),n.edges);if(h.length){n.edges=n.edges.concat(h);var p=c.getNeighborOnEdge(h[0]);u=p.getData("__$currConnectivity__")-1,p.setData("__$currConnectivity__",u),u<=1&&(c=p,t.remove(i,c),n.vertexes.push(c),d=!0)}if(!d){if(!r.length)break;c=r.pop(),t.remove(i,c),n.vertexes.push(c)}}}return n},removeEndChains:function(e){for(var t=Kekule.GraphAlgorithmUtils.findEndChains(e),n=0,i=t.vertexes.length;n<i;++n)e.removeVertex(t.vertexes[n]);return t},findBridgeChains:function(e){for(var t=e.getVertexes(),n=e.getEdges(),i=Kekule.GraphAlgorithmUtils.findCycleBlocks(e),r=0,a=i.length;r<a;++r)t=s.exclude(t,i[r].vertexes),n=s.exclude(n,i[r].edges);return{vertexes:t,edges:n}},removeBridgeChains:function(e){for(var t=Kekule.GraphAlgorithmUtils.findBridgeChains(e),n=0,i=t.vertexes.length;n<i;++n)e.removeVertex(t.vertexes[n]);return t},findAllRings:function(e){var t,n=Kekule.GraphAlgorithmUtils,i=[];t=e instanceof Kekule.Graph?n.findCycleBlocks(e):[e];for(var r,a=function(m,C){var _=m.vertexes,y=_.length;return y&&(_[0]===C||_[y-1]===C)},o=function(m,C,_){var y=s.clone(m.vertexes),T=s.clone(C.vertexes),E=s.clone(m.edges),b=s.clone(C.edges);y[0]===_&&(y.reverse(),E.reverse()),T[T.length-1]===_&&(T.reverse(),b.reverse()),y.pop();var v=y.concat(T),I=E.concat(b);return{vertexCount:m.vertexCount+C.vertexCount-1,vertexes:v,edges:I}},l=function(m){for(var C=[],_=s.clone(m.vertexes),y=m.edges,T=0,E=_.length;T<E;++T){var b=_[T],v=s.intersect(b.getEdges(),y);b.setData("__$vertextPartDegree__",v.length)}_.sort(function(ie,Y){return ie.getData("__$vertextPartDegree__")-Y.getData("__$vertextPartDegree__")});var I,R,N,L,U=[];for(T=0,E=m.edges.length;T<E;++T){var W=m.edges[T],M=W.getVertexes();U.push({vertexCount:M.length,vertexes:[M[0],M[1]],edges:[W]})}for(;_.length;){var B=_.shift(),V=null;for(T=U.length-1;T>=0;--T){var J=U[T];if(a(J,B)){V=J;for(var $=T-1;$>=0;--$)if(J=U[$],a(J,B)&&(I=V,R=J,N=void 0,L=void 0,N=s.clone(I.vertexes),L=s.clone(R.vertexes),N.shift(),N.pop(),L.shift(),L.pop(),!(s.intersect(N,L).length>=1))){var q=o(V,J,B),Q=q.vertexes;Q[0]===Q[Q.length-1]?(Q.pop(),C.push(q)):U.push(q)}U.splice(T,1)}}}return C},u=0,c=t.length;u<c;++u){var d=t[u];if((r=d).vertexes.length===r.edges.length)i.push({vertexes:s.clone(d.vertexes),edges:s.clone(d.edges)});else for(var h=l(d),p=0,g=h.length;p<g;++p){var f=h[p];i.push({vertexes:s.clone(f.vertexes),edges:s.clone(f.edges)})}}return i},findSSSR:function(e,t){var n,i=Kekule.GraphAlgorithmUtils,r=[];e instanceof Kekule.Graph?(n=i.findCycleBlocks(e),t=null):n=[e];for(var a=function(c,d){var h=[],p=c.edges.length-c.vertexes.length+1;if(p<=0)return[];var g=d?s.clone(d):i.findAllRings(c);g.sort(function(T,E){return T.vertexes.length-E.vertexes.length});var f,m=function(T){h.push(T)},C=[],_=Kekule.RingVectorUtils;_.prepareConvertRingToVector(c);var y=g.shift();for(m(y),f=_.convertRingToVector(y,c),C.push(f);h.length<p&&g.length;)y=g.shift(),f=_.convertRingToVector(y,c),_.isLinearDependant(f,C)||(C.push(f),m(y));return h},o=0,l=n.length;o<l;++o){var u=a(n[o],t);r=r.concat(u)}return r},analysisRings:function(e){for(var t,n=Kekule.GraphAlgorithmUtils,i=[],r=0,a=(t=e instanceof Kekule.Graph?n.findCycleBlocks(e):[e]).length;r<a;++r){var o=t[r],l=n.findAllRings(o),u=n.findSSSR(o,l);i.push({vertexes:o.vertexes,edges:o.edges,allRings:l,sssrRings:u})}return i}},Kekule.RingVectorUtils={MAX_INT_BITNUM:23,EDGE_INDEX_FIELD:"__$index__",prepareConvertRingToVector:function(e){for(var t=e.edges,n=0,i=t.length;n<i;++n)t[n][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]=n},convertRingToVector:function(e,t){var n,i=t.edges.length,r=e.edges;if(i<Kekule.RingVectorUtils.MAX_INT_BITNUM){n=0;for(var a=0,o=r.length;a<o;++a)n+=1<<r[a][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]}else for(n=[],a=0,o=r.length;a<o;++a)n[r[a][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]]=!0;return n},vectorNotNull:function(e){if(DataType.isSimpleValue(e))return!!e;for(var t=0;t<e.length;++t)if(e[t])return!0;return!1},getVectorLength:function(e){return DataType.isSimpleValue(e)?e.toString(2).length:e.length},ringVectorAnd:function(e,t){if(DataType.isSimpleValue(e))return e&t;for(var n=[],i=Math.min(e.length,t.length),r=0;r<i;++r)n[r]=e[r]&&t[r];return n},ringVectorAndAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,n=t.ringVectorAnd(e[0],e[1]),i=2,r=e.length;i<r;++i)n=t.ringVectorAnd(n,e[i]);return n},ringVectorOr:function(e,t){if(DataType.isSimpleValue(e))return e|t;for(var n=[],i=Math.max(e.length,t.length),r=0;r<i;++r)n[r]=e[r]||t[r];return n},ringVectorOrAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,n=t.ringVectorOr(e[0],e[1]),i=2,r=e.length;i<r;++i)n=t.ringVectorOr(n,e[i]);return n},ringVectorXor:function(e,t){if(DataType.isSimpleValue(e))return e^t;for(var n=[],i=Math.max(e.length,t.length),r=0;r<i;++r)n[r]=!!(e[r]^t[r]);return n},ringVectorXorAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,n=t.ringVectorXor(e[0],e[1]),i=2,r=e.length;i<r;++i)n=t.ringVectorXor(n,e[i]);return n},ringVectorNot:function(e){if(DataType.isSimpleValue(e))return~e;for(var t=[],n=0,i=e.length;n<i;++n)t[n]=!e[n];return t},isLinearDependant:function(e,t){var n=Kekule.RingVectorUtils,i=n.ringVectorOrAll(t),r=n.ringVectorAnd(e,n.ringVectorNot(i));if(n.vectorNotNull(r))return!1;for(var a=t.length,o=function(m){for(var C=[],_=0;_<m;++_)C[_]=m-_-1;return C},l=function(m,C,_){var y=m[C],T=++y;if(T>=_-C)return!(C>=m.length-1)&&l(m,C+1,_);m[C]=T;for(var E=T,b=C-1;b>=0;--b)++E,m[b]=E;return!0},u=!1,c=2;c<=a;++c){for(var d=o(c);;){for(var h=[],p=0,g=d.length;p<g;++p)h.push(t[d[p]]);var f=n.ringVectorXorAll(h);if(!n.vectorNotNull(n.ringVectorXor(f,e))){u=!0;break}if(!l(d,0,a)){u=!1;break}}if(u)break}return u},isLinearDependant_wrong:null}})(),function(){Kekule.ChemStructObjContainer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructObjContainer",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("connectors",[])},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,setter:null})},clear:function(){return this.getNodes().length=0,this.getConnectors().length=0,this},add:function(s){var e=null;return s instanceof Kekule.ChemStructureConnector?e=this.getConnectors():s instanceof Kekule.ChemStructureNode&&(e=this.getNodes()),e?Kekule.ArrayUtils.pushUnique(e,s):Kekule.error(Kekule.$L("ErrorMsg.CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER")),this},remove:function(s){var e=null;return e=s instanceof Kekule.ChemStructureConnector?this.getConnectors():this.getNodes(),Kekule.ArrayUtils.remove(e,s),this}})}(),function(){Kekule;var s=Kekule.ArrayUtils;Kekule.BondType,Kekule.CanonicalizationIndexer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationIndexer",initialize:function(){this.tryApplySuper("initialize")},execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t):null},doExecute:function(e){}}),Kekule.CanonicalizationNodeSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationNodeSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getNodes()):null},doExecute:function(e){}}),Kekule.CanonicalizationConnectorSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),Kekule.CanonicalizationConnectorConnectedObjsSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorConnectedObjsSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),Kekule.CanonicalizationCustomExecutor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationCustomExecutor",execute:function(e){var t=this.doExecute(e);return t&&this.doCanonicalizeConnectedObjs(t),t},doExecute:function(e){return e},doCanonicalizeConnectedObjs:function(e){e&&new Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter().execute(e)}}),Kekule.CanonicalizationGeneralConnectorSorter=Class.create(Kekule.CanonicalizationConnectorSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorSorter",doExecute:function(e){var t=new Kekule.MapEx;try{for(var n=0,i=e.getConnectorCount();n<i;++n){for(var r=e.getConnectorAt(n),a=r.getConnectedObjs(),o=[],l=0,u=a.length;l<u;++l){var c,d=a[l];d instanceof Kekule.ChemStructureNode&&(c=e.indexOfNode(d),o.push(c))}o.sort(function(h,p){return h-p}),t.set(r,o)}e.sortConnectors(function(h,p){var g=t.get(h),f=t.get(p),m=s.compare(g,f);return m===0&&(m=-(h.getConnectedObjCount()-p.getConnectedObjCount())),m})}finally{t.finalize()}}}),Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter=Class.create(Kekule.CanonicalizationConnectorConnectedObjsSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter",doExecute:function(e){var t=new Kekule.MapEx;try{for(var n=0,i=e.getConnectorCount();n<i;++n){var r=e.getConnectorAt(n);if(r.getConnectedObjCount()===2){var a=r.getConnectedObjAt(0),o=r.getConnectedObjAt(1),l=e.indexOfChild(a),u=e.indexOfChild(o);(l<0||u<0)&&(l=(a.getCanonicalizationIndex?-a.getCanonicalizationIndex():0)||0,u=(o.getCanonicalizationIndex?-o.getCanonicalizationIndex():0)||0),l>u&&r.reverseConnectedObjOrder()}else r.sortConnectedObjs(function(c,d){var h=e.indexOfChild(c),p=e.indexOfChild(d);(h<0||p<0)&&(g=((h=(c.getCanonicalizationIndex?-c.getCanonicalizationIndex():0)||0)||0)-((p=(d.getCanonicalizationIndex?-d.getCanonicalizationIndex():0)||0)||0));var g=e.indexOfChild(c)-e.indexOfChild(d);return g})}}finally{t.finalize()}}}),Kekule.CanonicalizationMorganIndexer=Class.create(Kekule.CanonicalizationIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganIndexer",doExecute:function(e){var t=this.doCalcGraphAndEcResult(e);this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup)},doCalcGraphAndEcResult:function(e){var t=Kekule.GraphAdaptUtils.ctabToGraph(e,null,{expandSubStructures:!0,ignoreBondedHydrogen:!0});if(!t)return null;var n=this._calcGraphFinalECs(t);return{graph:t,ecMapping:n.ecMapping,vertexGroup:n.vertexGroup}},doExecuteOnGraphEcResult:function(e,t,n){var i=this._sortNodeByEcMapping(e,t,n);this._setCanonicalizationIndexToNodeGroups(i),this._fillSpanningTreeInfo(e)},_fillSpanningTreeInfo:function(e){if((i=e.getVertexes())&&i.length){i.sort(function(o,l){var u=o.getData("object"),c=l.getData("object");if(u||c){if(u){if(c){var d=(c.getCanonicalizationIndex()||-1)-(u.getCanonicalizationIndex()||-1);if(d===0&&u.hasCoord3D(!0)&&c.hasCoord3D(!0)){var h=Kekule.CoordUtils.substract(c.getAbsCoord3D(!0),u.getAbsCoord3D(!0));d=h.z||h.y||h.x}return d}return-1}return 1}return 0});var t=e.getEdges();if(t&&t.length){var n=function(o,l){for(var u=l.length,c=[],d=o.getVertexes(),h=0,p=d.length;h<p;++h){var g=l.indexOf(d[h]);g<0&&(g=u),c.push(g)}return c.sort(),c},i=e.getVertexes();t.sort(function(o,l){var u=n(o,i),c=n(l,i);return Kekule.ArrayUtils.compare(u,c)})}for(var r=0,a=(i=e.getVertexes()).length;r<a;++r)i[r].getEdges().sort(function(o,l){return t.indexOf(o)-t.indexOf(l)})}this._setSpanningTreeIndexToNodeOfGraph(e)},_sortNodeByEcMapping:function(e,t,n){return this._doSortNodeByEcMapping(e,t,n)},_doSortNodeByEcMapping:function(e,t,n){for(var i=this._doSortNodeByEcMappingDirectly(n),r=this._doSortNodeBySortedNodeList(i),a=[],o=0,l=r.length;o<l;++o){var u=r[o];s.isArray(u)&&u.length===1?a.push(u[0]):a.push(u)}return a},_doSortNodeByEcMappingDirectly:function(e){for(var t=[],n=e,i=0,r=n.length;i<r;++i){var a=n[i],o=this._vertexesToNodes(a.vertexes);if(o.length===1)s.pushUnique(t,o[0]);else{var l=this._groupNodesWithSameEcValue(o,t);t=t.concat(l)}}return t},_doSortNodeBySortedNodeList:function(e){var t=(n=this._doSortNodeBySortedNodeListCore(e)).length;do{var n,i=n,r=t;t=(n=this._doSortNodeBySortedNodeListCore(i)).length}while(t>r);return i},_doSortNodeBySortedNodeListCore:function(e){for(var t=[],n=[],i=0,r=e.length;i<r;++i){var a=e[i];if(s.isArray(a)){var o=function(c,d){for(var h=0,p=d.length;h<p;++h)if(s.isArray(d[h])){if(d[h].indexOf(c)>=0)return h}else if(d[h]===c)return h;return-1},l=function(c,d,h){for(var p=[],g=0,f=d.length;g<f;++g)p.push(o(d[g],h));return p.sort(function(m,C){return C-m}),p},u=s.group(a,function(c,d){var h=s.intersect(c.getLinkedObjs(),n),p=s.intersect(d.getLinkedObjs(),n);if((m=h.length-p.length)==0&&h.length>0){var g=l(0,h,t),f=l(0,p,t);m=s.compare(g,f)}if(m===0){var m;h=s.intersect(c.getLinkedObjs(),e),p=s.intersect(d.getLinkedObjs(),e),(m=h.length-p.length)==0&&(g=l(0,h,e),f=l(0,p,e),m=s.compare(g,f))}return m});t=t.concat(u),n=n.concat(a)}else t.push([a]),n.push(a)}return t},_setCanonicalizationIndexToNodeGroups:function(e){for(var t=0,n=e.length;t<n;++t){var i=t+1,r=e[t];if(s.isArray(r))for(var a=0,o=r.length;a<o;++a)r[a].setCanonicalizationIndex(i);else r.setCanonicalizationIndex(i)}},_setSpanningTreeIndexToNodeOfGraph:function(e){for(var t=Kekule.GraphAlgorithmUtils.createSpanningTrees(e,Kekule.GraphTraverseMode.DEPTH_FIRST),n=0,i=t.length;n<i;++n){var r=t[n];if(r.vertexes)for(var a=r.vertexes.length,o=0;o<a;++o){var l=r.vertexes[o].getData("object");l&&l.setCanonicalizationAssocIndex&&l.setCanonicalizationAssocIndex(a-o)}}},_vertexesToNodes:function(e){for(var t=[],n=0,i=e.length;n<i;++n){var r=e[n].getData("object");t.push(r)}return t},_processECs:function(e,t,n,i){if(i)return this._initECs(e,t);for(var r=[],a=[],o=e.getVertexes(),l=0,u=o.length;l<u;++l){var c=o[l],d=this._usePrimeECs?1:0;if(this._usePrimeECs)var h=this._getPrimeArray();for(var p=c.getNeighbors(),g=0,f=p.length;g<f;++g)this._usePrimeECs?d*=h[n.get(p[g])-1||0]:d+=n.get(p[g])||0;s.pushUnique(r,d),a[d]?a[d].push(c):a[d]=[c]}r.sort(function(_,y){return _-y});var m=[];for(l=0,u=r.length;l<u;++l){var C=r[l];a[C]&&m.push(a[C])}return this._setECValueByVertexGroup(m,t),m.length},_initECs:function(e,t){for(var n=[],i=0,r=(u=e.getVertexes()).length;i<r;++i){var a=u[i],o=a.getEdgeCount();n[o]?n[o].push(a):n[o]=[a]}var l=[];for(i=0,r=n.length;i<r;++i){var u;if(u=n[i])if(u.length===1)l.push(u);else for(var c=s.group(u,function(p,g){var f=p.getData("object"),m=g.getData("object"),C=(f.getLinkedNonHydrogenConnectors()||[]).length-(m.getLinkedNonHydrogenConnectors()||[]).length;return C||(C=f.compareStructure(m))||(C=(f.getHydrogenCount?f.getHydrogenCount(!0):0)-(m.getHydrogenCount?m.getHydrogenCount(!0):0)),C}),d=0,h=c.length;d<h;++d)l.push(s.toArray(c[d]))}return this._setECValueByVertexGroup(l,t),l.length},_setECValueByVertexGroup:function(e,t){for(var n=0,i=e.length;n<i;++n)for(var r=e[n],a=0,o=r.length;a<o;++a)t.set(r[a],n+1)},_getPrimeArray:function(){return Kekule.CanonicalizationMorganIndexer.primes||(Kekule.CanonicalizationMorganIndexer.primes=Kekule.NumUtils.getPrimes(1e4)),Kekule.CanonicalizationMorganIndexer.primes},_calcGraphFinalECs:function(e){var t=[new Kekule.MapEx,new Kekule.MapEx];try{e.getVertexes().length<this._getPrimeArray().length?this._usePrimeECs=!0:this._usePrimeECs=!1;for(var n,i,r=0,a=t[0],o=t[0],l=0,u=[],c=this._processECs(e,a,o,!0),d=!0;d;)l=c,n=i,o=a,a=t[++r%2],c=this._processECs(e,a,o),i=null,d=c>l,c===l?(i=this._groupVertexesByEcValue(e,a),!n&&o&&(n=this._groupVertexesByEcValue(e,o)),u.push(n),d=!this._hasVertexGroup(i,u)):u=[]}finally{a.finalize()}return{ecMapping:o,ecCount:l,vertexGroup:n||this._groupVertexesByEcValue(e,o)}},_groupVertexesByEcValue:function(e,t){for(var n=[],i=[],r=e.getVertexes(),a=0,o=r.length;a<o;++a){var l=r[a],u=t.get(l);s.pushUnique(i,u),n[u]||(n[u]=[]),n[u].push(l)}i.sort(function(h,p){return h-p});var c=[];for(a=0,o=i.length;a<o;++a){var d=n[i[a]];c.push({ecValue:i[a],vertexes:d,vertexesCount:d.length})}return c},_hasVertexGroup:function(e,t){for(var n=0,i=t.length;n<i;++n)if(this._compareEcVertexGroup(e,t[n])===0)return!0;return!1},_compareEcVertexGroup:function(e,t){var n=e.length,i=n-t.length;if(i===0)for(var r=0;r<n&&((i=e[r].vertexes.length-t[r].vertexes.length)===0&&(i=s.exclude(e[r].vertexes,t[r].vertexes).length),i===0);++r);return i},_groupNodesWithSameEcValue:function(e,t){var n=function(i,r){for(var a=s.flatten(r),o=i.getLinkedObjs(),l=s.intersect(o,a),u=[],c=[],d=0,h=l.length;d<h;++d){var p=l[d],g=s.indexStackOfElem(p,r);u.push(g)}for(u.sort(function(m,C){return s.compare(m,C)}),d=0,h=u.length;d<h;++d){(p=s.getElemByIndexStack(r,u[d]))||console.error("not found",p,u[d]);var f=i.getConnectorTo(p);c.push(f)}return{nodeIndexValues:u,connectors:c}};return s.group(e,function(i,r){var a=i.compareStructure(r);if(a===0){var o=n(i,t),l=n(r,t);a=s.compare(o.nodeIndexValues,l.nodeIndexValues);for(var u=o.connectors,c=l.connectors,d=0,h=u.length;d<h&&(a=u[d].compareStructure(c[d]))===0;++d);if(a===0){var p=i.getBelongedSssrRings&&i.getBelongedSssrRings()||[],g=r.getBelongedSssrRings&&r.getBelongedSssrRings()||[];if((a=p.length-g.length)===0){var f=[],m=[];for(d=0,h=p.length;d<h;++d)f.push(p[d].nodes.length),m.push(g[d].nodes.length);f.sort(),m.sort(),a=s.compare(f,m)}}}return a})}}),Kekule.CanonicalizationMorganNodeSorter=Class.create(Kekule.CanonicalizationNodeSorter,{CLASS_NAME:"Kekule.CanonicalizationMorganNodeSorter",doExecute:function(e){var t=this._getNodeSortedArray(e),n=t.length,i=this;e.sortNodes(function(r,a){var o=t.indexOf(r),l=t.indexOf(a);o<0&&(o=n),l<0&&(l=n);var u=o-l;return u===0&&o===n&&(u=i._getNeighborNodesMinIndex(r,t)-i._getNeighborNodesMinIndex(a,t)),u})},_getNeighborNodesMinIndex:function(e,t){for(var n=e.getLinkedChemNodes(),i=t.length,r=0,a=n.length;r<a;++r){var o=t.indexOf(n[r]);o>0&&o<i&&(i=o)}return i},_getNodeSortedArray:function(e){var t=function(m,C,_,y){var T;if((T=(C.getCanonicalizationIndex()||-1)-(_.getCanonicalizationIndex()||-1))===0){if(m){var E=m.getConnectorTo(C),b=m.getConnectorTo(_);T=E.compareStructure(b)}if(T===0&&(T=(C.getCanonicalizationAssocIndex()||-1)-(_.getCanonicalizationAssocIndex()||-1)),T===0&&C.hasCoord3D(!0)&&_.hasCoord3D(!0)){var v=Kekule.CoordUtils.substract(C.getAbsCoord3D(!0),_.getAbsCoord3D(!0));T=v.z||v.y||v.x}}return T};try{for(var n,i=s.clone(e.getNodes()),r=0,a=i.length;r<a;++r){var o=i[r];c?t(null,o,c)>0&&(c=o,n=r):(c=o,n=r)}i.splice(n,1);var l=[],u=[];for(c&&l.push(c),r=0;r<l.length;++r){var c=l[r];if(r!==0){var d=i.indexOf(c);d>=0&&(l.push(c),i.splice(d,1))}var h=c.getLinkedObjs();if((h=s.intersect(h,i)).length){h.sort(function(m,C){return t(c,m,C)});for(var p=h.length-1;p>=0;--p){var g=h[p];if((d=i.indexOf(g))>=0){var f=g.getCanonicalizationIndex();Kekule.ObjUtils.isUnset(f)?u.push(g):l.push(g),i.splice(d,1)}}}}return l=l.concat(u)}finally{}}}),Kekule.Canonicalizer=Class.create({CLASS_NAME:"Kekule.Canonicalizer",initialize:function(){this._executorClasses={},this._executorInstances={},this._defExecutorId=null},registerExecutor:function(e,t,n){s.isArray(t)?this._executorClasses[e]={indexer:t[0],nodeSorter:t[1],connectorSorter:t[2]||Kekule.CanonicalizationGeneralConnectorSorter,connectorConnectedObjsSorter:t[3]||Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter}:this._executorClasses[e]={customExecutor:t},n&&(this._defExecutorId=e)},getExecutor:function(e){if(!e)return null;var t=this._executorInstances[e];if(!t){var n=this._executorClasses[e];n&&(t=n.customExecutor?{customExecutor:new n.customExecutor}:{indexer:new n.indexer,nodeSorter:new n.nodeSorter,connectorSorter:new n.connectorSorter,connectorConnectedObjsSorter:new n.connectorConnectedObjsSorter},this._executorInstances[e]=t)}return t},canonicalize:function(e,t){e.beginUpdate();try{var n=t||this._defExecutorId,i=this.getExecutor(n);if(i){var r=e instanceof Kekule.StructureFragment?e:null,a=r.getCanonicalizationInfo();if(a&&a.id===n)return e;var o=e.getCtab?e.getCtab():e;if(!o||o.isEmpty())return e;var l=o.getParent();i.customExecutor?i.customExecutor.execute(o):this._doDefaultCanonicalize(i,o,l),r.setCanonicalizationInfo({id:n})}else Kekule.error(Kekule.$L("ErrorMsg.REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND"))}finally{e.endUpdate()}return e},_doDefaultCanonicalize:function(e,t,n){var i=n.getFlattenedShadowFragment();(t=i.getCtab()).beginUpdate();try{e.indexer.execute(t),e.nodeSorter.execute(t),e.connectorSorter.execute(t),e.connectorConnectedObjsSorter.execute(t)}finally{t.endUpdate()}if(!n.getFlattenedShadowOnSelf()){n.beginUpdate();try{this._sortSrcStructBaseOnShadow(n,i),e.connectorConnectedObjsSorter.execute(n.getCtab())}finally{n.endUpdate()}}},_sortSrcStructBaseOnShadow:function(e,t){var n=function(g){return g.__$flattern_index$__},i=function(g,f){g.__$flattern_index$__=f},r=function(g,f,m,C){i(f,m);var _=f.getParent();if(_.isChildOf(e)){var y=n(_),T=m+C;(Kekule.ObjUtils.isUnset(y)||y>T)&&r(g,_,T,C)}},a=function(g){g.beginUpdate();try{g.sortNodes(function(_,y){return n(_)-n(y)}),g.sortConnectors(function(_,y){return n(_)-n(y)});for(var f=0,m=g.getNodeCount();f<m;++f){var C=g.getNodeAt(f);C instanceof Kekule.StructureFragment&&a(C)}}finally{g.endUpdate()}};e.cascadeOnChildren(function(g){g&&i(g,null)});var o=t.getChildCount();e.beginUpdate();try{for(var l=0;l<o;++l){var u=t.getChildAt(l);if(u instanceof Kekule.ChemStructureNode){var c=u,d=e.getFlatternedShadowSourceObj(c);d&&(r(e,d,l,o),d.setCanonicalizationIndex(c.getCanonicalizationIndex()))}else if(u instanceof Kekule.ChemStructureConnector){var h=u,p=e.getFlatternedShadowSourceObj(h);i(p,l)}}a(e)}finally{e.endUpdate()}}}),Kekule.ClassUtils.makeSingleton(Kekule.Canonicalizer),Kekule.canonicalizer=Kekule.Canonicalizer.getInstance(),ClassEx.extend(Kekule.ChemObject,{canonicalize:function(e){for(var t=Kekule.ChemStructureUtils.getAllStructFragments(this,!0),n=0,i=t.length;n<i;++n)t[n].canonicalize(e);return this}}),ClassEx.extend(Kekule.StructureConnectionTable,{canonicalize:function(e){return Kekule.canonicalizer.canonicalize(this),this}}),ClassEx.extend(Kekule.StructureFragment,{canonicalize:function(e){return Kekule.canonicalizer.canonicalize(this),this}}),ClassEx.defineProp(Kekule.ChemStructureObject,"canonicalizationIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),ClassEx.defineProp(Kekule.ChemStructureObject,"canonicalizationAssocIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),Kekule.canonicalizer.registerExecutor("morgan",[Kekule.CanonicalizationMorganIndexer,Kekule.CanonicalizationMorganNodeSorter],!0)}(),function(){var s=Kekule.ArrayUtils,e=Kekule.GraphAlgorithmUtils,t=Kekule.ChemStructureUtils,n=Kekule.BondType;Kekule.globalOptions.add("algorithm.ringSearch",{bondTypes:[n.COVALENT]}),ClassEx.extend(Kekule.StructureConnectionTable,{getGraph:function(i){var r=Class.create(i);return r.connectorClasses=[Kekule.Bond],Kekule.GraphAdaptUtils.ctabToGraph(this,null,r)},extractStructObjs:function(i){for(var r=i.edges,a=i.vertexes,o=[],l=[],u=0,c=a.length;u<c;++u)(d=a[u].getData("object"))instanceof Kekule.BaseStructureNode&&o.push(d);for(u=0,c=r.length;u<c;++u){var d;(d=r[u].getData("object"))instanceof Kekule.BaseStructureConnector&&l.push(d)}return{nodes:o,connectors:l}},findCycleBlocks:function(){var i=this.getRingInfo();return i?i.cycleBlocks:[]},findAllRings:function(){var i=this.getRingInfo(),r=[];if(i)for(var a=0,o=i.cycleBlocks.length;a<o;++a){var l=i.cycleBlocks[a].allRings;r=r.concat(l)}return r},findSSSR:function(){var i=this.getRingInfo(),r=[];if(i)for(var a=0,o=i.cycleBlocks.length;a<o;++a){var l=i.cycleBlocks[a].sssrRings;r=r.concat(l)}return r},analysisRings:function(i){var r=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.ringSearch),i),a=this.getGraph(r);if(a){for(var o=[],l=e.analysisRings(a),u=0,c=l.length;u<c;++u){var d=l[u],h=this.extractStructObjs(d);o.push(h),h.allRings=[];for(var p=d.allRings,g=0,f=p.length;g<f;++g){var m=p[g],C=this.extractStructObjs(m);h.allRings.push(C)}h.sssrRings=[];var _=d.sssrRings;for(g=0,f=_.length;g<f;++g){m=_[g];var y=p.indexOf(m);y>=0?h.sssrRings.push(h.allRings[y]):(C=this.extractStructObjs(m),h.sssrRings.push(C))}}return{cycleBlocks:o}}return null}}),ClassEx.defineProps(Kekule.StructureConnectionTable,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(i){var r=this.getStructureCacheData("ringInfo");return r||i||(r=this.analysisRings(),this.setStructureCacheData("ringInfo",r)),r},setter:null}]),ClassEx.extend(Kekule.StructureFragment,{findCycleBlocks:function(){return this.hasCtab()?this.getCtab().findCycleBlocks():null},findAllRings:function(){return this.hasCtab()?this.getCtab().findAllRings():null},findSSSR:function(){return this.hasCtab()?this.getCtab().findSSSR():null},analysisRings:function(i){return this.hasCtab()?this.getCtab().analysisRings(i):null}}),ClassEx.defineProps(Kekule.StructureFragment,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(i){return this.hasCtab()?this.getCtab().getRingInfo(i):null},setter:null}]),ClassEx.extendMethod(Kekule.StructureFragment,"_copyAdditionalFragmentInfo",function(i,r,a,o){var l=function(T){for(var E={nodes:[],connectors:[]},b=0,v=T.nodes.length;b<v;++b)(I=a.get(T.nodes[b]))&&E.nodes.push(I);for(b=0,v=T.connectors.length;b<v;++b){var I;(I=a.get(T.connectors[b]))&&E.connectors.push(I)}return E};i(r,a,o);var u=this.getRingInfo(!0);if(u){for(var c={cycleBlocks:[]},d=0,h=u.cycleBlocks.length;d<h;++d){for(var p=u.cycleBlocks[d],g={allRings:[],sssrRings:[]},f=p.allRings,m=0,C=f.length;m<C;++m){var _=f[m];g.allRings.push(l(_))}var y=p.sssrRings;for(m=0,C=y.length;m<C;++m)_=y[m],g.sssrRings.push(l(_));c.cycleBlocks.push(g)}r.setPropStoreFieldValue("ringInfo",c)}}),ClassEx.extend(Kekule.ChemStructureObject,{getBelongedSssrRings:function(){var i=[],r=this.getParent();if(r&&r.findSSSR)for(var a=r.findSSSR(),o=0,l=a.length;o<l;++o){var u=a[o];this instanceof Kekule.BaseStructureConnector?u.connectors.indexOf(this)>=0&&i.push(u):u.nodes.indexOf(this)>=0&&i.push(u)}return i},getBelongedRingMinSize:function(){var i=null,r=this.getBelongedSssrRings();if(r&&r.length)for(var a=0,o=r.length;a<o;++a){var l=r[a].nodes.length;i=i?Math.min(i,l):l}return i},isInRing:function(i){var r=i&&s.toArray(i);if(!r){var a=this.getParent();a&&a.findSSSR&&(r=a.findSSSR())}if(r&&r.length){for(var o=0,l=r.length;o<l;++o){var u=r[o];if(this instanceof Kekule.BaseStructureConnector){if(u.connectors.indexOf(this)>=0)return!0}else if(u.nodes.indexOf(this)>=0)return!0}return!1}return!1}}),ClassEx.extend(Kekule.ChemObject,{findCycleBlocks:function(){for(var i=t.getAllStructFragments(this),r=[],a=0,o=i.length;a<o;++a){var l=i[a].findCycleBlocks();l&&(r=r.concat(l))}return r.length?r:null},findAllRings:function(){for(var i=t.getAllStructFragments(this),r=[],a=0,o=i.length;a<o;++a){var l=i[a].findAllRings();l&&(r=r.concat(l))}return r.length?r:null},findSSSR:function(){for(var i=t.getAllStructFragments(this),r=[],a=0,o=i.length;a<o;++a){var l=i[a].findSSSR();l&&(r=r.concat(l))}return r.length?r:null},analysisRings:function(i){for(var r=t.getAllStructFragments(this),a=[],o=0,l=r.length;o<l;++o){var u=r[o].analysisRings(i);u&&(a=a.concat(u))}return a.length?a:null}})}(),function(){var s=Kekule.ObjUtils,e=Kekule.ArrayUtils,t=Kekule.BondType,n=Kekule.BondOrder,i=Kekule.ChemStructureUtils,r=-1,a=-16,o=-32;Kekule.AromaticTypes={NONAROMATIC:0,EXPLICIT_AROMATIC:1,ANTIAROMATIC:-1,UNCERTAIN:64},ClassEx.extend(Kekule.Atom,{isSulfoneOrSulfoxideSulphur:function(){if(this.getSymbol()==="S"){var l=this.getLinkedMultipleBonds();if(l.length>=1)for(var u=0,c=l;u<c;++u)for(var d=this.getLinkedObjsOnConnector(l[u]),h=0,p=d.length;h<p;++h){var g=d[h];if(g instanceof Kekule.Atom&&g.getSymbol()==="O")return!0}}return!1},isEsterCarbon:function(){if(this.getSymbol()==="C")for(var l,u,c=this.getLinkedBonds(t.COVALENT),d=0,h=c.length;d<h;++d){var p=c[d];if(p.isBondBetween("C","O")&&(u||p.getBondOrder()!==n.SINGLE?l||p.getBondOrder()!==n.DOUBLE||(l=!0):u=!0,u&&l))return!0}return!1}}),Kekule.globalOptions.add("algorithm.aromaticRingsPerception",{allowUncertainRings:!1}),ClassEx.extend(Kekule.StructureConnectionTable,{_getPossibleRingNodePiElectronCounts:function(l,u,c){var d=function(y,T,E,b){var v=y,I=Kekule.IsotopeFactory.getIsotope(v),R=T.getCharge();if(!(T.isSaturated&&T.isSaturated())){var N,L,U,W=T.getLinkedMultipleBonds();if(T.isSulfoneOrSulfoxideSulphur&&T.isSulfoneOrSulfoxideSulphur())return o;if(T.isEsterCarbon&&T.isEsterCarbon())return a;if(b?U=(L=e.intersect(W,b)).length:(L=null,U=1),U)if(U===2&&L[0].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)N=I.isHetero&&I.isHetero()?[1,2]:1;else if(U===1&&L&&L[0].getBondOrder()===Kekule.BondOrder.DOUBLE)N=1;else{if(U!==1||L)return-1;N=1}else if(v==="C"){for(var M=!1,B=0,V=W.length;B<V;++B){var J=W[B],$=T.getLinkedObjsOnConnector(J);if($.length===1&&$[0].getPrimaryIsotope().isHetero()){M=!0;break}}N=M?0:1}else N=1;if(e.isArray(N)){for(B=0,V=N.length;B<V;++B)N[B]=Math.min(Math.max(N[B]-R,0),2);return N}return Math.min(Math.max(N-R,0),2)}return T.getRadical&&T.getRadical()===Kekule.RadicalOrder.DOUBLET?1:I.isHetero()?Math.min(Math.max(2-R,0),2):v==="C"?R>0?0:R<0?2:r:0};if(l instanceof Kekule.VariableAtom){var h=l.getAllowedIsotopeIds();if(h&&h.length){for(var p=[],g=0,f=h.length;g<f;++g){var m=h[g],C=Kekule.IsotopeFactory.getIsotopeById(m).getSymbol();e.pushUnique(p,d(C,l,0,c))}return p}return[0,1,2]}var _=l.getPrimaryIsotope();return _?d(C=_.getSymbol(),l,0,c):[0,1,2]},_checkRingAromaticType:function(l,u,c){if(u){for(var d=c&&Kekule.ChemStructureUtils.isInRings(l,c),h=l.nodes,p=h.length,g=p>6&&p<16,f=[],m=[],C=h.length,_=0;_<C;++_){var y=h[_],T=u.get(y);e.isArray(T)?f.push(T):f.push([T]),m[_]=0}var E,b=function(V,J){var $=J[V],q=++$;return q>=f[V].length?!(V>=J.length-1)&&(J[V]=0,b(V+1,J)):(J[V]=q,!0)},v=null,I=null;do{var R=0,N=null;for(_=0;_<C;++_){var L=f[_][m[_]];if(!(L>=0)){N=Kekule.AromaticTypes.NONAROMATIC;break}R+=L}if(N===null){var U=parseInt(R/4),W=R%4;U<=5&&(U!==2||!(g&&d))&&(W===2?(N=Kekule.AromaticTypes.EXPLICIT_AROMATIC,I=e.clone(m)):W||(N=Kekule.AromaticTypes.ANTIAROMATIC))}if(v!==null){if(N&&v!==N&&(v===Kekule.AromaticTypes.EXPLICIT_AROMATIC||N===Kekule.AromaticTypes.EXPLICIT_AROMATIC)){E=Kekule.AromaticTypes.UNCERTAIN;break}}else v=N}while(b(0,m));if(E||(E=v),I)for(var M=new Kekule.MapEx,B=(_=0,I.length);_<B;++_)M.set(h[_],f[_][I[_]]);return{result:E,eMap:M}}},_calcPossibleRingNodesPElectronCounts:function(l,u,c){var d=[],h=[],p=[];if(c){for(g=0,f=c.length;g<f;++g)e.pushUnique(d,c[g].nodes),e.pushUnique(h,c[g].connectors);for(g=0,f=u.length;g<f;++g)e.pushUnique(p,u[g].nodes)}else{for(var g=0,f=u.length;g<f;++g)e.pushUnique(d,u[g].nodes),e.pushUnique(h,u[g].connectors);p=d}for(g=0,f=p.length;g<f;++g){var m=p[g],C=m.getStructureCacheData("piElectronCount");if(Kekule.ObjUtils.notUnset(C))l.set(m,[C]);else{var _=this._getPossibleRingNodePiElectronCounts(m,d,h);l.set(m,_)}}},_storeAromaticCacheToRingInfo:function(l,u,c){if(l.aromaticType=u,u===Kekule.AromaticTypes.EXPLICIT_AROMATIC)for(var d=l.nodes,h=0,p=d.length;h<p;++h){var g=d[h];if(Kekule.ObjUtils.isUnset(g.getStructureCacheData("piElectronCount"))&&c){var f=c.get(g);Kekule.ObjUtils.notUnset(f)&&g.setStructureCacheData("piElectronCount",f)}}},perceiveAromaticRings:function(l,u){Kekule.ObjUtils.isUnset(l)&&(l=Kekule.globalOptions.algorithm.aromaticRingsPerception.allowUncertainRings);var c=this.findSSSR(),d=u||c,h=[],p=new Kekule.MapEx;try{this._calcPossibleRingNodesPElectronCounts(p,d,null);for(var g=0,f=d.length;g<f;++g){var m,C=d[g];if(Kekule.ObjUtils.notUnset(C.aromaticType))m=C.aromaticType;else{var _=this._checkRingAromaticType(C,p,c);m=_.result,this._storeAromaticCacheToRingInfo(C,m,_.eMap)}(m===Kekule.AromaticTypes.EXPLICIT_AROMATIC||l&&m===Kekule.AromaticTypes.UNCERTAIN)&&h.push(C)}return h}finally{p.finalize()}},findAromaticRings:function(l,u){return this.perceiveAromaticRings(l,u)},getRingAromaticType:function(l,u){if(Kekule.ObjUtils.notUnset(l.aromaticType))return l.aromaticType;var c,d=this.findSSSR();u||(u=d);var h=new Kekule.MapEx;try{this._calcPossibleRingNodesPElectronCounts(h,[l],u);var p=this._checkRingAromaticType(l,h,d);c=p.result,this._storeAromaticCacheToRingInfo(l,c,p.eMap)}finally{h.finalize()}return c},getHucklizationChanges:function(l,u){for(var c=u&&u.allowUncertainRings,d=Kekule.BondOrder,h=[],p=(this.getParent(),this.findAromaticRings(c)),g=0,f=p.length;g<f;++g)for(var m=p[g].connectors,C=0,_=m.length;C<_;++C){var y=m[C];if(!l||l.indexOf(y)>=0){var T=y.getBondOrder&&y.getBondOrder();T!==d.SINGLE&&T!==d.DOUBLE||y.setBondOrder&&h.push({bond:y,bondOrder:Kekule.BondOrder.EXPLICIT_AROMATIC})}}return h},hucklize:function(l,u){u&&u.allowUncertainRings,Kekule.BondOrder;var c=[],d=this.getParent();d.setAutoClearStructureCache(!1),d.beginUpdate();try{var h=this.getHucklizationChanges(l,u);if(h)for(var p=0,g=h.length;p<g;++p){var f=h[p].bond,m=h[p].bondOrder;f.setBondOrder&&(f.setBondOrder(m),c.push(f))}}finally{d.endUpdate(),d.setAutoClearStructureCache(!0)}return c},getKekulizationChanges:function(l,u){var c,d=Object.extend({doAromaticTests:!1,includingSubFragments:!0,expandSubFragments:!1,useShadow:!0},u||{}),h=[],p=this.getParent();if(d.doAromaticTests&&this.perceiveAromaticRings(),d.useShadow){var g=p.createShadow();c=g.getShadowFragment()}else c=p;try{var f;if(d.expandSubFragments&&d.useShadow&&c.unmarshalAllSubFragments(!0),l)if(f=[],d.useShadow)for(var m=0,C=l.length;m<C;++m){var _=g.getShadowObj(l[m]);_&&f.push(_)}else f=l;else f=d.includingSubFragments&&!d.expandSubFragments?c.getAllContainingConnectors():c.getConnectors();var y=[];for(m=0,C=f.length;m<C;++m){var T=f[m];T.getBondType()===Kekule.BondType.COVALENT&&T.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC&&T.getConnectedChemNodeCount()===2&&y.push(T)}c.setAutoClearStructureCache(!1),c.beginUpdate();try{var E=this._splitConnectorsToContinuousParts(y)||[];for(m=0,C=E.length;m<C;++m){var b=E[m];if(this._kekulizeContinousBonds(b,g,c,p))for(var v=0,I=b.length;v<I;++v){var R=b[v].getBondOrder();if(R!==n.EXPLICIT_AROMATIC){var N=d.useShadow?g.getSourceObj(b[v]):b[v];h.push({bond:N,bondOrder:R})}}}}finally{c.endUpdate(),c.setAutoClearStructureCache(!0)}}finally{d.useShadow&&g.finalize()}return h._useShadow=d.useShadow,h},kekulize:function(l,u){var c=[],d=this.getKekulizationChanges(l,u);if(d&&d._useShadow){var h=this.getParent();try{h.setAutoClearStructureCache(!1),h.beginUpdate();for(var p=0,g=d.length;p<g;++p){var f=d[p];f.bond.setBondOrder(f.bondOrder),c.push(f.bond)}}finally{h.endUpdate(),h.setAutoClearStructureCache(!0)}}return c},_kekulizeContinousBonds:function(l,u,c,d){for(var h=[],p=0,g=l.length;p<g;++p){var f=l[p].getConnectedChemNodes()||[];e.pushUnique(h,f)}var m=new Kekule.MapEx(!1);for(p=0,g=h.length;p<g;++p){var C=h[p],_=u?u.getSourceObj(C):C,y=_&&_.getStructureCacheData("piElectronCount");s.notUnset(y)&&m.set(C,{cachedPiElectronCount:y})}return this._doKekulizeContinousBondSys(0,l,h,m)},_doKekulizeContinousBondSys:function(l,u,c,d){var h=this,p=function(L){var U,W=d.get(L);return W?U=W.bondOrder:u.indexOf(L)<0&&(U=L.getBondOrder()),s.notUnset(U)?U:null},g=function(L){var U=p(L);return U>n.SINGLE&&U<=n.QUAD},f=function(L){var U=d.get(L),W=U&&U.cachedPiElectronCount;if(s.isUnset(W)){var M=L.getLinkedBonds(Kekule.BondType.COVALENT);if(function(ie){var Y=e.intersect(ie,u),ne=!Y||!Y.length;if(!ne){ne=!0;for(var de=0,Ae=Y.length;de<Ae;++de){var Ce=Y[de];if(!d.get(Ce)){ne=!1;break}}}return ne}(M)){var B=e.toArray(h._getPossibleRingNodePiElectronCounts(L,null,null));return!B||!B.length||B[0]<0?-1:B[0]}for(var V=0,J=0,$=M.length;J<$;++J){var q=M[J],Q=p(q);s.notUnset(Q)&&((Q===n.DOUBLE||Q===n.TRIPLE||Q===n.QUAD)&&++V)}V&&(W=V===1?1:-1)}return W},m=u[l],C=m.getConnectedChemNodes(),_=[];if(!d.get(m)){if(function(L){for(var U=L.getNeighboringBonds(),W=0,M=U.length;W<M;++W)if(L=U[W],g(L))return!0;return!1}(m))_=[n.SINGLE];else{var y=function(L,U){for(var W=0,M=0,B=0,V=U.length;B<V;++B){var J=f(U[B]);s.notUnset(J)&&(J>=2?++W:++M)}return W>0||!(M>=2)&&null}(0,C);_=y?[n.SINGLE]:y!==null?[n.DOUBLE]:[n.DOUBLE,n.SINGLE]}for(var T,E=0,b=_.length;E<b;++E){T=!0;var v=_[E];d.set(m,{bondOrder:v}),m.setBondOrder(v);for(var I=0,R=C.length;I<R;++I){var N=C[I];if(f(N)<0){T=!1;break}}if(T){if(!(l<u.length-1)){T=!0;break}if(T=this._doKekulizeContinousBondSys(l+1,u,c,d))break}}return!!T||(m.setBondOrder(n.EXPLICIT_AROMATIC),d.remove(m),!1)}},_splitConnectorsToContinuousParts:function(l){if(!l||!l.length)return null;for(var u=function(g,f){var m=f.indexOf(g);if(m<0)return[];f.splice(m,1);for(var C=[g],_=g.getNeighboringConnectors(),y=0,T=_.length;y<T;++y){var E=_[y];f.indexOf(E)>=0&&(C=C.concat(u(E,f)))}return C},c=[],d=e.clone(l);d.length;){var h=d[0],p=u(h,d);p&&p.length&&c.push(p)}return c}}),ClassEx.extend(Kekule.StructureFragment,{perceiveAromaticRings:function(l,u){var c=this.hasCtab()?this.getCtab().perceiveAromaticRings(l,u):[];return this.setAromaticRings(c||[]),c},findAromaticRings:function(l,u){return this.perceiveAromaticRings(l,u)},getRingAromaticType:function(l,u){return this.hasCtab()?this.getCtab().getRingAromaticType(l,u):null},getHucklizationChanges:function(l,u){return this.hasCtab()?this.getCtab().getHucklizationChanges(l,u):[]},hucklize:function(l,u){return this.hasCtab()?this.getCtab().hucklize(l,u):[]},getKekulizationChanges:function(l,u){return this.hasCtab()?this.getCtab().getKekulizationChanges(l,u):[]},kekulize:function(l,u){return this.hasCtab()?this.getCtab().kekulize(l,u):[]}}),ClassEx.extend(Kekule.ChemObject,{perceiveAromaticRings:function(l,u){for(var c=i.getAllStructFragments(this),d=[],h=0,p=c.length;h<p;++h){var g=c[h].perceiveAromaticRings(l,u);g&&(d=d.concat(g))}return d.length?d:null},findAromaticRings:function(l,u){return this.perceiveAromaticRings(l,u)},_groupActualTargetBondsOfKekulizationOrHucklization:function(l,u,c){var d=[];if(u)for(m=0,C=u.length;m<C;++m)for(var h=u[m],p=0,g=l.length;p<g;++p){var f=l[p];h.isChildOf(f)&&(d[p]?d[p].bonds.push(h):d[p]={structFragment:f,bonds:[h]})}else for(var m=0,C=l.length;m<C;++m)d.push({structFragment:l[m],bonds:null});return d},getHucklizationChanges:function(l,u){for(var c=[],d=i.getAllStructFragments(this),h=this._groupActualTargetBondsOfKekulizationOrHucklization(d,l,u),p=0,g=h.length;p<g;++p){var f=h[p];f&&(c=c.concat(f.structFragment.getHucklizationChanges(f.bonds,u)||[]))}return c},hucklize:function(l,u){for(var c=[],d=i.getAllStructFragments(this),h=this._groupActualTargetBondsOfKekulizationOrHucklization(d,l,u),p=0,g=h.length;p<g;++p){var f=h[p];f&&(c=c.concat(f.structFragment.hucklize(f.bonds,u)||[]))}return c},getKekulizationChanges:function(l,u){for(var c=[],d=i.getAllStructFragments(this),h=this._groupActualTargetBondsOfKekulizationOrHucklization(d,l,u),p=0,g=h.length;p<g;++p){var f=h[p];f&&(c=c.concat(f.structFragment.getKekulizationChanges(f.bonds,u)||[]))}return c},kekulize:function(l,u){for(var c=[],d=i.getAllStructFragments(this),h=this._groupActualTargetBondsOfKekulizationOrHucklization(d,l,u),p=0,g=h.length;p<g;++p){var f=h[p];f&&(c=c.concat(f.structFragment.kekulize(f.bonds,u)||[]))}return c}})}(),function(){Kekule.globalOptions.add("algorithm.molStandardization",{cleanStructure:!0,clearHydrogens:!0,unmarshalSubFragments:!0,doCanonicalization:!0,doAromaticPerception:!0,doStereoPerception:!0}),Kekule.MolStandardizer={standardize:function(s,e){var t=Object.extend({},Kekule.globalOptions.algorithm.molStandardization),n=s,i=Object.extend(t,e);return i.unmarshalSubFragments&&n.unmarshalAllSubFragments(!0),i.cleanStructure&&n.clean(),i.doCanonicalization&&Kekule.canonicalizer.canonicalize(n,i.canonicalizerExecutorId||null),i.doAromaticPerception&&n.perceiveAromaticRings(),i.doStereoPerception&&n.perceiveStereos(null,!0,i),i.clearHydrogens&&n.clearExplicitBondHydrogens(!0),n}},Object.extend(Kekule.ChemStructureUtils,{compareStructFragment:function(s,e,t){var n=s.clone(!1),i=e.clone(!1);n.setCanonicalizationIndex(null),i.setCanonicalizationIndex(null);var r=Object.create(t||{});return n=Kekule.MolStandardizer.standardize(n,r),i=Kekule.MolStandardizer.standardize(i,r),r.doStandardize=!1,r.extraComparisonProperties=["canonicalizationIndex"],n.compareStructure(i,r)},isSameStructure:function(s,e,t){return Kekule.ChemStructureUtils.compareStructFragment(s,e,t)===0}}),ClassEx.extend(Kekule.ChemObject,{standardize:function(s){for(var e=Kekule.ChemStructureUtils.getAllStructFragments(this,!0),t=0,n=e.length;t<n;++t)e[t].standardize(s);return this}}),ClassEx.extend(Kekule.StructureFragment,{standardize:function(s){return Kekule.MolStandardizer.standardize(this,s)},isSameStructureWith:function(s,e){return Kekule.ChemStructureUtils.isSameStructure(this,s,e)}}),ClassEx.extendMethod(Kekule.StructureFragment,"compare",function(s,e,t){return t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&t.doStandardize!==!1&&e instanceof Kekule.StructureFragment?Kekule.ChemStructureUtils.compareStructFragment(this,e,t):s(e,t)})}(),function(){var s=Kekule.ArrayUtils;Kekule.globalOptions.add("algorithm.structureSearch",{doStandardize:!0}),Kekule.ChemStructureSearcher={findSubStructure:function(t,n,i){var r=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.structureSearch),i);if(r.exactMatch)return!!n.isSameStructureWith(t,r)&&[].concat(n.getNodes()).concat(n.getConnectors());r=Object.extend({level:Kekule.StructureComparationLevel.CONSTITUTION,compareLinkedConnectorCount:!1,compareHydrogenCount:!1,compareConnectedObjCount:!1},r);var a=r=Kekule.ObjComparer.getStructureComparisonDetailOptions(r);if(r.doStandardize){var o={unmarshalSubFragments:!1,doCanonicalization:!0,doAromaticPerception:!0};r.compareStereo||(o.doCanonicalization=!1),t.standardize(o),n.standardize(o)}for(var l=n.getFlattenedShadowFragment(!0),u=t.getFlattenedShadowFragment(!0).getNonHydrogenNodes()[0],c=l.getNonHydrogenNodes(),d=c.length,h=0,p=[],g=[],f=!1;!f&&h<d;)f=e._compareNode(u,c[h],p,g,a),++h;if(f){var m=s.toUnique(f);return n.getFlatternedShadowSourceObjs(m)}return!1},_addToComparedObjs:function(t,n,i){n.push(t)},_removeFromComparedObjs:function(t,n,i){var r=n.indexOf(t);n.length=r},_isSameMappedObj:function(t,n,i,r){var a=r.indexOf(n),o=i.indexOf(t);return a>=0&&a===o},_compareComparedNeighbors:function(t,n,i,r){if(t.length>n.length)return!1;for(var a=[],o=0,l=t.length;o<l;++o)a.push(i.indexOf(t[o]));var u=[];for(o=0,l=n.length;o<l;++o)u.push(r.indexOf(n[o]));for(o=0,l=a.length;o<l;++o)if(u.indexOf(a[o])<0)return!1;return!0},_compareNode:function(t,n,i,r,a){if(t.compareStructure(n,a)!==0)return!1;var o=t.getLinkedNonHydrogenConnectors(),l=n.getLinkedNonHydrogenConnectors();if(o.length>l.length)return!1;var u=s.clone(i),c=s.clone(r);e._addToComparedObjs(t,u,"target"),e._addToComparedObjs(n,c,"src");var d=s.intersect(o,u),h=s.intersect(l,c),p=!0;e._compareComparedNeighbors(d,h,u,c)?(o=s.exclude(o,d),l=s.exclude(l,h),o.length>l.length&&(p=!1)):p=!1;for(var g=[];p&&o.length;){for(var f,m=!1,C=o.shift(),_=0;l.length&&!m&&_<l.length;)f=l[_],(m=e._compareConnector(C,f,u,c,a))&&(g=g.concat(m)),++_;if(!m){p=!1;break}s.remove(l,f)}return p&&(p=[n].concat(g)),p},_compareConnector:function(t,n,i,r,a){if(t.compareStructure(n,a)!==0||t.getConnectedObjCount()>n.getConnectedObjCount())return!1;var o=s.clone(i),l=s.clone(r);e._addToComparedObjs(t,o,"target"),e._addToComparedObjs(n,l,"src");var u=s.clone(t.getConnectedObjs()),c=s.clone(n.getConnectedObjs()),d=s.intersect(u,o),h=s.intersect(c,l),p=!0;e._compareComparedNeighbors(d,h,o,l)?(u=s.exclude(u,d),c=s.exclude(c,h),u.length>c.length&&(p=!1)):p=!1;for(var g=[];p&&u.length;){for(var f,m=!1,C=u.shift(),_=0;c.length&&!m&&_<c.length;)(m=(f=c[_]).getClass()===C.getClass()&&(f instanceof Kekule.ChemStructureNode?e._compareNode(C,f,o,l,a):f instanceof Kekule.ChemStructureConnector&&e._compareConnector(C,f,o,l,a)))&&(g=g.concat(m)),++_;if(!m){p=!1;break}s.remove(c,f)}return p&&(p=[n].concat(g)),p}};var e=Kekule.ChemStructureSearcher;ClassEx.extend(Kekule.StructureFragment,{search:function(t,n){return e.findSubStructure(t,this,n)}})}(),function(){var s=Kekule.ArrayUtils,e=Kekule.CoordUtils;Kekule.RotationDir={CLOCKWISE:1,ANTICLOCKWISE:-1,UNKNOWN:0};var t=Kekule.RotationDir;Kekule.globalOptions.add("algorithm.stereoPerception",{useFlattenedShadow:!0,perceiveStereoConnectors:!0,perceiveChiralNodes:!0,calcParity:!0,strictStereoBondGeometry:!1,strictStereoAtomGeometry:!1,wedgeBondPrior:!0}),Kekule.MolStereoUtils={FISCHER_PROJECTION_BOND_ALLOWED_ERROR:.08,getDihedralAngleOfNodes:function(n,i,r,a,o,l){Kekule.ObjUtils.isUnset(l)&&(l=!0),Kekule.ObjUtils.isUnset(o)&&(o=i.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D);var u=Kekule.MolStereoUtils._getNodeCoordForBondParity,c=i.getConnectorTo(r),d=c&&c.isDoubleBond&&c.isDoubleBond(),h=u(i,null,null,o,l),p=u(r,null,null,o,l),g=u(n,i,h,o,l,d),f=u(a,r,p,o,l,d);return g&&h&&p&&f?Kekule.GeometryUtils.getDihedralAngleOfPoints(g,h,p,f):-1},getParityOfNodeSeq:function(n,i,r,a,o,l){var u=Kekule.StereoParity,c=Kekule.MolStereoUtils.getDihedralAngleOfNodes(n,i,r,a,o,l);return c<0?u.UNKNOWN:c<2*Math.PI/5||c>8*Math.PI/5?u.ODD:c>3*Math.PI/5&&c<7*Math.PI/5?u.EVEN:u.UNKNOWN},_getNodeCoordForBondParity:function(n,i,r,a,o,l){if(a!==Kekule.CoordMode.COORD2D)return n.getAbsCoordOfMode(a,!0);var u=n.getAbsCoordOfMode(a,!0);if(i&&r){var c=n.getConnectorTo(i);if(c.getStereo){var d=c.getStereo(),h=Kekule.BondStereo,p=[h.UP,h.UP_INVERTED,h.DOWN,h.DOWN_INVERTED];if(p.indexOf(d)>=0){c.indexOfConnectedObj(n)-c.indexOfConnectedObj(i)<0&&(d=h.getInvertedDirection(d));var g=e.getDistance(u,r);u.z=g*[1,-1,-1,1][p.indexOf(d)]}else if([h.UP_OR_DOWN,h.UP_OR_DOWN_INVERTED].indexOf(d)>=0)return null}}return u.z=u.z||0,u},_calcParityOfCoordPairs:function(n,i,r,a,o,l,u){var c=Kekule.StereoParity,d=e.substract(i,n);if(!d.x&&!d.y)return c.UNKNOWN;for(var h=Math.atan2(d.y,d.x),p=e.calcTransform2DMatrix({rotateAngle:-h,center:n,translateX:-n.x,translateY:-n.y}),g=[n,i,r,a,o,l],f=[],m=0,C=g.length;m<C;++m){var _=g[m];f[m]=_?e.transform2DByMatrix(_,p):null}f[0];var y=f[1],T=f[2],E=f[3],b=e.substract(f[4],y),v=f[5]?e.substract(f[5],y):null,I=function(L,U,W,M){var B=0,V=Math.sqrt(Math.sqr(L.x)+Math.sqr(L.y));if(U){var J=Math.sqrt(Math.sqr(U.x)+Math.sqr(U.y));if($=L.y/V-U.y/J,Math.abs($)<W)B=0;else if(Math.sign(L.y)!==Math.sign(U.y))B=Math.sign($)*M;else{if(u)return 0;$=-(L.x/L.y-U.x/U.y),B=Math.sign($)}}else{var $=L.y/V;B=Math.abs($)<W?0:Math.sign(L.y)*M}return B},R=I(T,E,.05,-1),N=I(b,v,.05,1);return R&&N?R!==N?c.ODD:c.EVEN:c.UNKNOWN},isStereoBond:function(n){var i=Kekule.ObjUtils.isUnset;if(n.getBelongedRingMinSize){var r=n.getBelongedRingMinSize()||0;if(r>0&&r<=10)return!1}var a=!1;if(n.isDoubleBond&&n.isDoubleBond()&&n.getConnectedObjCount()===2){var o=n.getConnectedChemNodes();if(o.length===2){a=!0;for(var l=0;l<2;++l){for(var u=o[l],c=u.getHydrogenCount(!0),d=[],h=u.getLinkedBonds(Kekule.BondType.COVALENT),p=0,g=h.length;p<g;++p){var f=h[p];if(f!==n){var m=f.getBondOrder();if(m&&m!==Kekule.BondOrder.SINGLE)return!1;var C=s.exclude(f.getConnectedChemNodes(),o);if(C.length!==1)return!1;d.push(C[0])}}if(c>=2||!d.length){a=!1;break}if(d.length!==1){if(d.length===2&&(i(d[0].getCanonicalizationIndex())&&i(d[1].getCanonicalizationIndex())||d[0].getCanonicalizationIndex()===d[1].getCanonicalizationIndex())){a=!1;break}}for(p=0,g=d.length;p<g;++p){var _=u.getConnectorTo(d[p]);if(!_.isSingleBond||!_.isSingleBond()){a=!1;break}}if(!a)break}}}else a=!1;return a},doFindStereoBonds:function(n,i){var r=[];i||Kekule.canonicalizer.canonicalize(n,"morganEx");for(var a=0,o=n.getConnectorCount();a<o;++a){var l=n.getConnectorAt(a);Kekule.MolStereoUtils.isStereoBond(l)&&r.push(l)}return r},getStereoBondKeyNodes:function(n){var i=null;if(n.getConnectedObjCount()===2){var r=n.getConnectedChemNodes();if(r.length===2){for(var a=[],o=0;o<2;++o){var l=r[o],u=s.exclude(l.getLinkedChemNodes(),r);if(u.length===1)a.push(u[0]);else{if(u.length!==2)return null;var c=u[0].getCanonicalizationIndex()||-1,d=u[1].getCanonicalizationIndex()||-1;a.push(d>c?u[1]:u[0])}}i=[a[0],r[0],r[1],a[1]]}}return i},getStereoBondKeyNeighborConnectors:function(n){var i=Kekule.MolStereoUtils.getStereoBondKeyNodes(n);return[i[1].getConnectorTo(i[0]),i[2].getConnectorTo(i[3])]},getStereoBondRelNodes:function(n){var i=null;if(n.getConnectedObjCount()===2){var r=n.getConnectedChemNodes();if(r.length===2){for(var a=[],o=0;o<2;++o){var l=r[o],u=s.exclude(l.getLinkedChemNodes(),r);if(u.length===1)a.push(u[0]),a.push(null);else{if(u.length!==2)return null;var c=u[0].getCanonicalizationIndex()||-1,d=u[1].getCanonicalizationIndex()||-1;a.push(d>c?u[1]:u[0]),a.push(d>c?u[0]:u[1])}}i=[r[0],r[1],a[0],a[1],a[2],a[3]]}}return i},calcStereoBondParity:function(n,i,r,a){var o=Kekule.StereoParity;if(!r&&!Kekule.MolStereoUtils.isStereoBond(n)||n.getStereo&&[Kekule.BondStereo.E_OR_Z,Kekule.BondStereo.CIS_OR_TRANS].indexOf(n.getStereo())>=0)return o.NONE;var l,u,c=o.UNKNOWN,d=Kekule.MolStereoUtils.getStereoBondKeyNodes(n);if(d&&d.length){if(Kekule.ObjUtils.isUnset(i)&&(i=d[1].hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D),i===Kekule.CoordMode.COORD3D){var h=Kekule.MolStereoUtils.getDihedralAngleOfNodes(d[0],d[1],d[2],d[3],i);if(h<0||h>2*Math.PI/5&&h<3*Math.PI/5||h>7*Math.PI/5&&h<8*Math.PI/5)return o.UNKNOWN}var p=Kekule.MolStereoUtils._getNodeCoordForBondParity,g=Kekule.MolStereoUtils.getStereoBondRelNodes(n),f=[p(g[0],null,null,i,!0),p(g[1],null,null,i,!0)];f=f.concat([p(g[2],g[0],f[0],i,!0,!0),g[3]?p(g[3],g[0],f[0],i,!0,!0):null,p(g[4],g[1],f[1],i,!0,!0),g[5]?p(g[5],g[1],f[1],i,!0,!0):null]);for(var m=i===Kekule.CoordMode.COORD2D?[["x","y"]]:[["x","y"],["x","z"],["y","z"]],C=null,_=0,y=m.length;_<y;++_){for(var T=[],E=0,b=f.length;E<b;++E)f[E]?T.push((l=f[E],u=m[_],l?{x:l[u[0]],y:l[u[1]]}:null)):T.push(null);var v=Kekule.MolStereoUtils._calcParityOfCoordPairs(T[0],T[1],T[2],T[3],T[4],T[5],a);if(v!==o.UNKNOWN){if(C===null)C=v;else if(C!==v)return o.UNKNOWN}}c=C}return c},doPerceiveStereoConnectors:function(n,i,r,a){var o=Kekule.MolStereoUtils.doFindStereoBonds(n,r);n.beginUpdate();try{if(o&&o.length)for(var l=0,u=o.length;l<u;++l){var c=o[l],d=Kekule.MolStereoUtils.calcStereoBondParity(c,i,!0,a);c.setParity&&c.setParity(d)}}finally{n.endUpdate()}return o},isChiralNode:function(n){var i=!1;if(n.mayContainElement){var r,a,o=null,l=!1;if(n.mayContainElement("C")||n.mayContainElement("Si")?(r=4,a=0,o=[0],l=!0):n.mayContainElement("N")?(r=4,a=0,l=!0):n.mayContainElement("S")||n.mayContainElement("P")?(r=3,a=0,l=!0):n.mayContainElement("B")&&(r=3,a=0,o=[-1],l=!0),l){if(n.getLinkedMultiCenterBonds().length)return!1;var u=n.getLinkedChemNodes(),c=n.getLinkedMultipleBonds(),d=n.getHydrogenCount?n.getHydrogenCount():0,h=n.getHydrogenCount?n.getHydrogenCount(!0):0,p=n.getCharge()||0;if(c.length>a||h>=2||u.length+d<r||o&&o.indexOf(p)<0)i=!1;else{i=!0;for(var g=[],f=0,m=u.length;f<m;++f){var C=u[f].getCanonicalizationIndex()||0;if(g[C]){i=!1;break}g[C]=1}}}}return i},doFindChiralNodes:function(n,i){var r=[];i||Kekule.canonicalizer.canonicalize(n,"morganEx");for(var a=0,o=n.getNodeCount();a<o;++a){var l=n.getNodeAt(a);Kekule.MolStereoUtils.isChiralNode(l)&&r.push(l)}return r},calcRotationDirection:function(n,i,r,a,o,l){var u,c=l?e.substract(n,i):e.substract(i,n),d=null;c.x!==0||c.y!==0?(u=Kekule.GeometryUtils.getVectorCrossProduct(c,{x:0,y:0,z:1}),f=Kekule.GeometryUtils.getVectorIncludedAngle(c,{x:0,y:0,z:1}),c.z<0&&(f=Math.PI-f)):c.z<0&&(u={x:1,y:0,z:0},f=Math.PI),u&&f&&(d=e.calcRotate3DMatrix({rotateAngle:f,rotateAxisVector:u,center:{x:0,y:0,z:0}}));var h=e.substract(r,n),p=e.substract(a,n),g=e.substract(o,n);d&&(h=e.transform3DByMatrix(h,d),p=e.transform3DByMatrix(p,d),g=e.transform3DByMatrix(g,d));var f=-Math.atan2(h.y,h.x),m=(d=e.calcTransform2DMatrix({rotateAngle:f,center:{x:0,y:0,z:0}}),e.transform2DByMatrix(p,d)),C=e.transform2DByMatrix(g,d);if(m.x===0||C.x===0)return t.UNKNOWN;var _=Math.atan2(m.y,m.x),y=Math.atan2(C.y,C.x);return y<0&&(y=2*Math.PI+y),_<0&&(_=2*Math.PI+_),_<y?t.ANTICLOCKWISE:_>y?t.CLOCKWISE:t.UNKNOWN},_extractFischerProjectionDetectOptions:function(n){var i=n||{};return{allowedError:i.fischerAllowedError,reversedDirection:i.reversedFischer,allowExplicitHydrogen:i.allowExplicitHydrogenInFischer,allowExplicitVerticalHydrogen:i.allowExplicitVerticalHydrogen}},_getFischerProjectionInfo:function(n,i,r){var a=Object.create(r||null);if(i.length<3||i.length>4||i.length===3&&!a.allowExplicitHydrogen)return null;var o=Kekule.CoordMode.COORD2D,l=a.allowedError||Kekule.MolStereoUtils.FISCHER_PROJECTION_BOND_ALLOWED_ERROR;if(!a.ignoreStructure){var u=n instanceof Kekule.Atom&&n.getAtomicNumber()===6;if(u&&n.getRenderOption&&(u=n.getRenderOption("nodeDisplayMode")!==Kekule.Render.NodeLabelDisplayMode.SHOWN),u&&(u=!n.getExplicitHydrogenCount()),!u)return null}for(var c=n.getAbsCoordOfMode(o,!0),d=[],h=[],p=0,g=function(L,U,W){return!L[U]&&(L[U]=W,!0)},f=0,m=i.length;f<m;++f){var C=i[f],_=C.getConnectorTo(n);if(!a.ignoreStructure){var y=_.getStereo()||Kekule.BondStereo.NONE;if(!(_ instanceof Kekule.Bond&&y===Kekule.BondStereo.NONE))return null}var T,E,b=C.getAbsCoordOfMode(o,!0),v=e.substract(b,c),I=Math.abs(v.x),R=Math.abs(v.y);if(Kekule.NumUtils.isFloatEqual(I,0)&&Kekule.NumUtils.isFloatEqual(R,0)||(I>R?(E=R/I,T=v.x>0?1:3):(E=I/R,T=v.y>0?0:2,++p),E>l)||!g(d,T,C))return null;g(h,T,_)}if(p!==2&&!a.allowExplicitVerticalHydrogen)return null;var N={horizontalSiblings:[d[3],d[1]],verticalSiblings:[d[0],d[2]],horizontalBonds:[h[3],h[1]],verticalBonds:[h[0],h[2]]};return a.reversedDirection?(N.towardSiblings=N.verticalSiblings,N.awaySiblings=N.horizontalSiblings,N.towardBonds=N.verticalBonds,N.awayBonds=N.horizontalBonds,N.implicitTowardSibling=!d[0]||!d[2],N.implicitAwaySibling=!d[1]||!d[3]):(N.towardSiblings=N.horizontalSiblings,N.awaySiblings=N.verticalSiblings,N.towardBonds=N.horizontalBonds,N.awayBonds=N.verticalBonds,N.implicitTowardSibling=!d[1]||!d[3],N.implicitAwaySibling=!d[0]||!d[2]),N},calcTetrahedronChiralCenterRotationDirectionEx:function(n,i,r,a){var o=Object.extend({implicitFischerProjection:!0,allowExplicitHydrogenInFischer:!0},a),l=o.coordMode,u=!!o.withImplicitSibling,c=!!o.refSiblingBehind;if(o.implicitFischerProjection,!l){var d=n||i||r[0];if(!d)return{direction:t.UNKNOWN};l=d.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D}var h=l===Kekule.CoordMode.COORD2D,p=r.length,g=p;if(i&&++g,u&&++g,g<4)return{direction:t.UNKNOWN};var f=Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(o),m=[].concat(r);i&&Kekule.ArrayUtils.pushUnique(m,i);var C=n&&o.implicitFischerProjection?Kekule.MolStereoUtils._getFischerProjectionInfo(n,m,f):null,_=s.clone(r);i&&s.pushUnique(_,i);for(var y=function($,q,Q,ie,Y,ne){var de=Kekule.ObjUtils.isUnset,Ae=ie!==Kekule.CoordMode.COORD2D,Ce=$&&$.getAbsCoordOfMode(ie,ne);Ce&&de(Ce.z)&&(Ae?Ce.z=0:$.getZIndex2D?Ce.z=$.getZIndex2D()||0:Ce.z=0);for(var pe=[],fe={count:0,sum:0},Te=0,xe=q.length;Te<xe;++Te){var Re=q[Te];if(Ae)Xe=Re.getAbsCoordOfMode(ie,ne);else{if(de((Xe=Re.getAbsCoordOfMode(ie,ne)).z)){var we=Re.getConnectorTo($);if(we.getStereo&&$&&Ce){var Me=we.indexOfConnectedObj(Re)-we.indexOfConnectedObj($),Le=Kekule.BondStereo,Ue=we.getStereo()||Le.NONE;Ue===Le.NONE&&Y&&(Y.towardSiblings.indexOf(Re)>=0?Ue=Me<0?Le.UP_INVERTED:Le.UP:Y.awaySiblings.indexOf(Re)>=0&&(Ue=Me<0?Le.DOWN_INVERTED:Le.DOWN));var at=[Le.UP,Le.UP_INVERTED,Le.DOWN,Le.DOWN_INVERTED];if(at.indexOf(Ue)>=0){Me<0&&(Ue=Le.getInvertedDirection(Ue));var Bt=o.wedgeBondPrior?[2,-2,-1,1]:[1,-1,-1,1],Fe=e.getDistance(Xe,Ce);Xe.z=Fe*Bt[at.indexOf(Ue)]+Ce.z}else[Le.UP_OR_DOWN,Le.UP_OR_DOWN_INVERTED].indexOf(Ue)>=0&&(Xe=null)}}Xe&&de(Xe.z)&&Re.getZIndex2D&&(Xe.z=Re.getZIndex2D()),Xe&&!de(Xe.z)&&Xe.z!==!1&&(fe.sum+=Xe.z-Ce.z,++fe.count)}pe.push(Xe)}if(!Ae&&Ce){var Nt;for(Nt=-fe.sum/(Q-fe.count)+Ce.z,Te=0,xe=q.length;Te<xe;++Te){var Xe;(Xe=pe[Te])&&de(Xe.z)&&(Xe.z=Nt)}}var vt=new Kekule.MapEx;for($&&vt.set($,Ce),Te=0,xe=q.length;Te<xe;++Te)vt.set(q[Te],pe[Te]);return vt}(n,_,g,l,C,!0),T=y.get(n),E=function($,q,Q,ie,Y){return y.get($)},b=[],v=0;v<p;++v){var I=E(r[v]);b.push(I)}var R=s.clone(b),N=i?E(i):null;if(N&&R.push(N),R.indexOf(null)>=0)return{direction:t.UNKNOWN,fischerInfo:C};if(!T){for(var L={},U=(v=0,R.length);v<U;++v)L=e.add(R[v],L);T=e.divide(L,R.length)}var W=0;for(v=0,U=R.length;v<U;++v){var M=R[v],B=e.substract(M,T);M.x=B.x,M.y=B.y,M.z=B.z,h&&B.z&&++W}if(h&&W<=0)return{direction:t.UNKNOWN,fischerInfo:C};if(T={x:0,y:0,z:0},u){var V=0;for(L={},v=0,U=R.length;v<U;++v)L=e.add(R[v],L),V=Math.max(V,R[v].z||0);var J=e.substract({x:0,y:0,z:0},L);C&&(C.implicitTowardSibling||C.implicitTowardSibling)&&(J.z=C.implicitTowardSibling?V:-V),i?b.push(J):N=J}return b.length===3&&b.indexOf(null)<0?{direction:Kekule.MolStereoUtils.calcRotationDirection(T,N,b[0],b[1],b[2],c),fischerInfo:C}:{direction:t.UNKNOWN,fischerInfo:C}},calcTetrahedronChiralCenterRotationDirection:function(n,i,r,a,o,l,u){var c=Object.create(u);return Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(i,r,a,Object.extend(c,{coordMode:n,withImplicitSibling:o,refSiblingBehind:l})).direction},calcTetrahedronChiralNodeParity:function(n,i,r){var a=Object.create(r||null);i||(i=n.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D),a.coordMode=i,a.refSiblingBehind=!0;var o=Kekule.StereoParity;if(!a.ignoreChiralCheck&&!Kekule.MolStereoUtils.isChiralNode(n))return o.NONE;var l=n.getLinkedChemNodes();if(i===Kekule.CoordMode.COORD2D&&r.strictStereoAtomGeometry&&!Kekule.MolStereoUtils._isSiblingBond2DGeometryLegal(n,l))return o.UNKNOWN;var u=n.getHydrogenCount();a.withImplicitSibling=!!u||l.length<4,l.sort(function(h,p){return-((h.getCanonicalizationIndex()||0)-(p.getCanonicalizationIndex()||0))});var c=a.withImplicitSibling?null:l[3];l=l.slice(0,3);var d=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(n,c,l,a).direction;return d===t.CLOCKWISE?o.ODD:d===t.ANTICLOCKWISE?o.EVEN:o.UNKNOWN},_isSiblingBond2DGeometryLegal:function(n,i){for(var r=Kekule.BondStereo,a=[r.NONE,r.CLOSER],o=[2,2],l=[],u=0,c=i.length;u<c;++u){var d=i[u];if(!d.getZIndex2D()){var h=n.getConnectorTo(d);if(h.getStereo){var p=h.getStereo();if(a.indexOf(p)>=0)if(l[p]){if(++l[p],l[p]>o[p])return!1}else l[p]=1}}}return!0},doPerceiveChiralNodes:function(n,i,r,a){var o=Object.create(a||null),l=Object.create(o);l.ignoreChiralCheck=!0;var u=Kekule.MolStereoUtils.doFindChiralNodes(n,r);n.beginUpdate();try{if(u&&u.length)for(var c=0,d=u.length;c<d;++c){var h=u[c],p=Kekule.MolStereoUtils.calcTetrahedronChiralNodeParity(h,i,l);h.setParity&&h.setParity(p)}}finally{n.endUpdate()}return u},perceiveStereos:function(n,i,r,a){var o,l,u=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.stereoPerception),a),c=n instanceof Kekule.StructureConnectionTable?n.getParent():n;l=u.useFlattenedShadow?c.getFlattenedShadowFragment(!0):c,r||Kekule.canonicalizer.canonicalize(l,"morganEx"),l.beginUpdate();try{var d,h;u.perceiveStereoConnectors&&(d=u.calcParity?Kekule.MolStereoUtils.doPerceiveStereoConnectors(l,i,!0,u.strictStereoBondGeometry):Kekule.MolStereoUtils.doFindStereoBonds(l,!0)),u.perceiveChiralNodes&&(h=u.calcParity?Kekule.MolStereoUtils.doPerceiveChiralNodes(l,i,!0,u):Kekule.MolStereoUtils.doFindChiralNodes(l,!0));var p=(h||[]).concat(d||[]);if(u.useFlattenedShadow&&!c.getFlattenedShadowOnSelf()){o=[],c.beginUpdate();try{for(var g=0,f=p.length;g<f;++g){var m=c.getFlatternedShadowSourceObj(p[g]);m&&(u.calcParity&&m.setParity(p[g].getParity()),o.push(m))}}finally{c.endUpdate()}}else o=p}finally{l.endUpdate()}return o},_setWedgeAroundFischerCenter:function(n,i,r,a){for(var o=Kekule.BondStereo,l=function(g,f,m){g.setStereo(p),m&&(g.getRenderOption("renderType")||g.setRenderOption("renderType",Kekule.Render.BondRenderType.SINGLE))},u=!(!a||!a.maintainRenderStyle),c=0,d=i.towardBonds.length;c<d;++c){var h=i.towardBonds[c];if(r.indexOf(h)>=0){var p=h.indexOfConnectedObj(n)>0?o.UP_INVERTED:o.UP;l(h,0,u)}}for(c=0,d=i.awayBonds.length;c<d;++c)h=i.awayBonds[c],r.indexOf(h)>=0&&(p=h.indexOfConnectedObj(n)>0?o.DOWN_INVERTED:o.DOWN,l(h,0,u))},convertFischerCenterBondsToWedge:function(n,i,r,a){r||(r=i.getLinkedBonds());var o=i.getLinkedChemNodes(),l=(Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(a),Kekule.MolStereoUtils._getFischerProjectionInfo(i,o,fischerOptions));if(l){n.beginUpdate();try{Kekule.MolStereoUtils._setWedgeAroundFischerCenter(i,l,r,a)}finally{n.endUpdate()}}},convertFischerBondsToWedge:function(n,i){for(var r=Kekule.MolStereoUtils.perceiveStereos(n,null,null,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1}),a=Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(i),o=new Kekule.MapEx,l=[],u=0,c=r.length;u<c;++u){var d=r[u].getLinkedChemNodes();(g=Kekule.MolStereoUtils._getFischerProjectionInfo(r[u],d,a))&&(o.set(r[u],g),l.push(r[u]))}var h=function(m,C,_){for(var y=[],T=0,E=m.length;T<E;++T){var b=m[T],v=C.getLinkedObjsOnConnector(b);Kekule.ArrayUtils.intersect(v,_).length||y.push(b)}return y};n.beginUpdate();try{for(u=0,c=l.length;u<c;++u){var p=l[u],g=o.get(p),f=[].concat(g.towardBonds).concat(g.awayBonds);f=h(f,p,l),Kekule.MolStereoUtils._setWedgeAroundFischerCenter(p,g,f,i)}}finally{n.endUpdate()}},findStereoConnectors:function(n,i){return Kekule.MolStereoUtils.perceiveStereos(n,null,i,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!1})},perceiveStereoConnectors:function(n,i,r,a){return Kekule.MolStereoUtils.perceiveStereos(n,i,r,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!0,strictStereoBondGeometry:a})},findChiralNodes:function(n,i){return Kekule.MolStereoUtils.perceiveStereos(n,null,i,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1})},perceiveChiralNodes:function(n,i,r,a){var o=Object.create(a||null);return o=Object.extend(o,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!0}),Kekule.MolStereoUtils.perceiveStereos(n,i,r,o)}},Kekule.CanonicalizationMorganExIndexer=Class.create(Kekule.CanonicalizationMorganIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganExIndexer",doExecute:function(n){var i=this.doCalcGraphAndEcResult(n);this.doExecuteOnGraphEcResult(i.graph,i.ecMapping,i.vertexGroup);var r=n.getNonHydrogenNodes(),a=this._groupNodesByCanoIndex(r),o=null,l=0;for(o=Kekule.MolStereoUtils.perceiveStereos(n,null,!0)||[];l<o.length;)a=this._regroupSortedNodes(a),this._setCanonicalizationIndexToNodeGroups(a),l=o.length,o=Kekule.MolStereoUtils.perceiveStereos(n,null,!0)||[];l>0&&this.doExecuteOnGraphEcResult(i.graph,i.ecMapping,i.vertexGroup)},_groupNodesByCanoIndex:function(n){return s.group(n,function(i,r){return(i.getCanonicalizationIndex()||-1)-(r.getCanonicalizationIndex()||-1)})},_regroupSortedNodes:function(n){var i,r,a=n;do i=a.length,r=(a=this._doRegroupSortedNodes(a)).length;while(r>i);return a},_doRegroupSortedNodes:function(n){for(var i=[],r=0,a=n.length;r<a;++r){var o=n[r];if(s.isArray(o)){var l=s.group(o,function(u,c){var d=u.compareStructure(c);if(d===0){var h=u.getLinkedConnectors(),p=c.getLinkedConnectors();d=Kekule.ObjComparer.compareStructure(h,p)}return d});i=i.concat(l)}else i.push(o)}return i}}),Kekule.canonicalizer.registerExecutor("morganEx",[Kekule.CanonicalizationMorganExIndexer,Kekule.CanonicalizationMorganNodeSorter],!0),ClassEx.extend(Kekule.StructureFragment,{perceiveChiralNodes:function(n,i,r){return Kekule.MolStereoUtils.perceiveChiralNodes(this,n,i,r)},perceiveStereoConnectors:function(n,i){return Kekule.MolStereoUtils.perceiveStereoConnectors(this,n,i)},perceiveStereos:function(n,i,r){return Kekule.MolStereoUtils.perceiveStereos(this,n,i,r)}})}();(function(){Kekule.Calculator={},Kekule.Calculator.Utils={_instanceMaxIndex:0,generateUid:function(){return++Kekule.Calculator.Utils._instanceMaxIndex,"Kekule.Calculator."+Kekule.Calculator.Utils._instanceMaxIndex}},Kekule.Calculator.getWorkerBasePath=function(){var e=Kekule.isUsingMinJs()?"workers/":"calculation/workers/";return e=Kekule.getScriptPath()+e},Kekule.Calculator.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Calculator.Base",WORKER_SHARED_COUNT_FIELD:"__$workerSharedCount$__",initialize:function(){this.setPropStoreFieldValue("uid",this._generateUid()),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("async",{dataType:DataType.BOOL}),this.defineProp("worker",{dataType:DataType.OBJECT,setter:null}),this.defineProp("uid",{dataType:DataType.STRING,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAsync(!0),this.reactWorkerMessageBind=this.reactWorkerMessage.bind(this),this.reactWorkerErrorBind=this.reactWorkerError.bind(this)},doFinalize:function(){this.finalizeWorker(),this.tryApplySuper("doFinalize")},_generateUid:function(){return Kekule.Calculator.Utils.generateUid()},isWorkerShared:function(){return!1},_incWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;++t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_decWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;t&&--t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_isWorkerInSharingState:function(e){return this.isWorkerShared()&&(e[this.WORKER_SHARED_COUNT_FIELD]||0)>0},getWorkerBasePath:function(){return Kekule.Calculator.getWorkerBasePath()},execute:function(e,t,n){if(this._doneCallback=e,this._errCallback=t,this._msgCallback=n,this.getAsync()&&this.isWorkerSupported()&&this.fetchWorker()){var i=this.getWorker();this._incWorkerSharedCount(i),this._installWorkerEventReceiver(i),this.workerStartCalc(i)}else{var r,a;try{a=this.executeSync(e)}catch(o){r=o}r?(Kekule.error(r),this.error(r)):a&&(r?this.error(r):this.done())}},executeSync:function(e){this._doneCallback=e;var t=this.doExecuteSync(e);return t&&this.done(),t},doExecuteSync:function(e){},error:function(e){if(!this._errCallback)throw e;this._errCallback(e)},done:function(){this._doneCallback&&this._doneCallback.apply(this,arguments),this.getWorker()&&this.workerJobDone()},halt:function(){var e=this.getWorker();e&&(e.terminate(),this.error(Kekule.$L("ErrorMsg.CALC_TERMINATED_BY_USER")))},isWorkerSupported:function(){return Kekule.BrowserFeature.workers},fetchWorker:function(){var e=this.getWorker();return e||(e=this.createWorker()),e},createWorker:function(){if(this.isWorkerSupported()){var e=this.getWorkerScriptFile();if(e){var t=new Worker(e);return this.setPropStoreFieldValue("worker",t),t}}},_installWorkerEventReceiver:function(e){e.addEventListener("message",this.reactWorkerMessageBind),e.addEventListener("error",this.reactWorkerErrorBind)},_uninstallWorkerEventReceiver:function(e){e.removeEventListener("message",this.reactWorkerMessageBind),e.removeEventListener("error",this.reactWorkerErrorBind)},getWorkerScriptFile:function(){return null},importWorkerScriptFile:function(e){this.postWorkerMessage({type:"importScript",url:e})},postWorkerMessage:function(e){var t=Object.extend({uid:this.getUid()},e),n=this.getWorker();n&&n.postMessage(t)},reactWorkerMessage:function(e){return e.data.uid===this.getUid()?(this._msgCallback&&this._msgCallback(e.data),this.doReactWorkerMessage(e.data,e)):null},doReactWorkerMessage:function(e,t){},reactWorkerError:function(e){this.error(e.message)},workerStartCalc:function(e){},workerJobDone:function(){var e=this.getWorker();e&&(this._uninstallWorkerEventReceiver(e),this._decWorkerSharedCount(e))},finalizeWorker:function(){var e=this.getWorker();e&&(this._isWorkerInSharingState(e)||e.terminate(),this.setPropStoreFieldValue("worker",null))}}),Kekule.Calculator.AbstractStructureGenerator=Class.create(Kekule.Calculator.Base,{CLASS_NAME:"Kekule.Calculator.AbstractStructureGenerator",initProperties:function(){this.defineProp("sourceMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("generatedMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("childObjMap",{dataType:"Kekule.MapEx",serializable:!1}),this.defineProp("options",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("options");return e||(e={},this.setPropStoreFieldValue("options",e)),e}})},getGeneratorCoordMode:function(){return Kekule.CoordMode.COORD3D},done:function(){this._modifySourceAccordingToGeneratedMol(this.getSourceMol(),this.getGeneratedMol(),this.getChildObjMap()),this.tryApplySuper("done")},_modifySourceAccordingToGeneratedMol:function(e,t,n){var i=n;if(i){var r=this.getGeneratorCoordMode(),a=i.getKeys();e.beginUpdate();try{for(var o=0,l=a.length;o<l;++o)if(a[o]instanceof Kekule.ChemStructureNode){var u=a[o],c=i.get(u).getCoordOfMode(r);u.setCoordOfMode(c,r)}}finally{e.endUpdate()}}}}),Kekule.Calculator.ServiceManager={_serviceInfos:{},_getServiceClassInfos:function(e,t){var n=s._serviceInfos[e];return!n&&t&&(n=[],s._serviceInfos[e]=n),n},_findServiceClassInfoItemIndex:function(e,t,n){var i=s._getServiceClassInfos(e,!1);if(i)for(var r=i.length-1;r>=0;--r){var a=i[r];if(a&&!(t&&a.serviceClass!==t||n&&a.id!==n))return r}return-1},register:function(e,t,n,i){var r=s._getServiceClassInfos(e,!0),a=s._findServiceClassInfoItemIndex(e,t);a>=0&&r.splice(a,1),r.push({serviceClass:t,id:n,priorityLevel:i||0})},unregister:function(e,t){var n=s._findServiceClassInfoItemIndex(e,t);n>=0&&s._getServiceClassInfos(e,!1).splice(n,1)},_getRegisteredServiceInfo:function(e,t){var n=-1,i=null,r=s._getServiceClassInfos(e);if(r)for(var a=0,o=r.length;a<o;++a){var l=r[a];if(l){if(t&&l.id===t){i=l;break}(!i||l.priorityLevel>=n)&&(i=l,n=l.priorityLevel)}}return i},getServiceClass:function(e,t){var n=s._getRegisteredServiceInfo(e,t);return n&&n.serviceClass}};var s=Kekule.Calculator.ServiceManager;Kekule.Calculator.Services={GEN2D:"2D structure generator",GEN3D:"3D structure generator"},Kekule.Calculator.hasService=function(e){return!!s.getServiceClass(e)},Kekule.Calculator.generateStructure=function(e,t,n,i,r,a){var o=t||Kekule.Calculator.Services.GEN3D,l=s.getServiceClass(o);if(l){var u,c=new l;c.setChildObjMap&&(u=new Kekule.MapEx(!0),c.setChildObjMap(u));var d=function(p){r&&r(p)};try{c.setSourceMol(e),c.setOptions(n),n&&n.sync&&c.setAsync(!1),c.execute(function(){i&&i(c.getGeneratedMol(),u)},d,function(p){a&&a(p)})}catch(p){d(p)}return c}var h=Kekule.$L("ErrorMsg.CALC_SERVICE_UNAVAILABLE").format(o);return r&&r(h),null},Kekule.Calculator.generate3D=function(e,t,n,i,r){return Kekule.Calculator.generateStructure(e,Kekule.Calculator.Services.GEN3D,t,n,i,r)},Kekule.Calculator.generate2D=function(e,t,n,i,r){return Kekule.Calculator.generateStructure(e,Kekule.Calculator.Services.GEN2D,t,n,i,r)}})();Kekule.chemicalElementsData=[{symbol:"H",casId:"1333-74-0",group:1,period:1,name:"Hydrogen",atomicNumber:1,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.37,radiiVdw:1.2,paulingE:2.2,naturalMass:1.00794075382579},{symbol:"He",casId:"7440-59-7",group:18,period:1,name:"Helium",atomicNumber:2,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.32,radiiVdw:1.4,naturalMass:4.002601902393709},{symbol:"Li",casId:"7439-93-2",group:1,period:2,name:"Lithium",atomicNumber:3,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:.32,radiiVdw:2.2,paulingE:.98,naturalMass:6.9400376247955},{symbol:"Be",casId:"7440-41-7",group:2,period:2,name:"Beryllium",atomicNumber:4,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:.9,radiiVdw:1.9,paulingE:1.57,naturalMass:9.0121822},{symbol:"B",casId:"7440-42-8",group:13,period:2,name:"Boron",atomicNumber:5,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:.82,radiiVdw:1.8,paulingE:2.04,naturalMass:10.811028088400002},{symbol:"C",casId:"7440-44-0",group:14,period:2,name:"Carbon",atomicNumber:6,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:.77,radiiVdw:1.7,paulingE:2.55,naturalMass:12.010735896788},{symbol:"N",casId:"7727-37-9",group:15,period:2,name:"Nitrogen",atomicNumber:7,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.77,radiiVdw:1.6,paulingE:3.04,naturalMass:14.006743088432001},{symbol:"O",casId:"7782-44-7",group:16,period:2,name:"Oxygen",atomicNumber:8,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.73,radiiVdw:1.55,paulingE:3.44,naturalMass:15.999404927569397},{symbol:"F",casId:"7782-41-4",group:17,period:2,name:"Fluorine",atomicNumber:9,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.73,radiiVdw:1.5,paulingE:3.98,naturalMass:18.99840322},{symbol:"Ne",casId:"7440-01-9",group:18,period:2,name:"Neon",atomicNumber:10,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.69,radiiVdw:1.54,naturalMass:20.180046383574997},{symbol:"Na",casId:"7440-23-5",group:1,period:3,name:"Sodium",atomicNumber:11,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.54,radiiVdw:2.4,paulingE:.93,naturalMass:22.98976928},{symbol:"Mg",casId:"7439-95-4",group:2,period:3,name:"Magnesium",atomicNumber:12,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.3,radiiVdw:2.2,paulingE:1.31,naturalMass:24.305051612423004},{symbol:"Al",casId:"7429-90-5",group:13,period:3,name:"Aluminum",atomicNumber:13,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.18,radiiVdw:2.1,paulingE:1.61,naturalMass:26.98153863},{symbol:"Si",casId:"7440-21-3",group:14,period:3,name:"Silicon",atomicNumber:14,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.11,radiiVdw:2.1,paulingE:1.9,naturalMass:28.085384754933294},{symbol:"P",casId:"7723-14-0",group:15,period:3,name:"Phosphorus",atomicNumber:15,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.06,radiiVdw:1.95,paulingE:2.19,naturalMass:30.97376163},{symbol:"S",casId:"7704-34-9",group:16,period:3,name:"Sulfur",atomicNumber:16,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.02,radiiVdw:1.8,paulingE:2.58,naturalMass:32.066084993038},{symbol:"Cl",casId:"7782-50-5",group:17,period:3,name:"Chlorine",atomicNumber:17,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.99,radiiVdw:1.8,paulingE:3.16,naturalMass:35.452538168202},{symbol:"Ar",casId:"7440-37-1",group:18,period:3,name:"Argon",atomicNumber:18,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.97,radiiVdw:1.8,naturalMass:39.947676710841314},{symbol:"K",casId:"7440-09-7",group:1,period:4,name:"Potassium",atomicNumber:19,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.96,radiiVdw:2.8,paulingE:.82,naturalMass:39.09830112446276},{symbol:"Ca",casId:"7440-70-2",group:2,period:4,name:"Calcium",atomicNumber:20,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.74,radiiVdw:2.4,paulingE:1,naturalMass:40.078022651988505},{symbol:"Sc",casId:"7440-20-2",group:3,period:4,name:"Scandium",atomicNumber:21,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.3,paulingE:1.36,naturalMass:44.9559119},{symbol:"Ti",casId:"7440-32-6",group:4,period:4,name:"Titanium",atomicNumber:22,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.15,paulingE:1.54,naturalMass:47.866749245159994},{symbol:"V",casId:"7440-62-2",group:5,period:4,name:"Vanadium",atomicNumber:23,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.63,naturalMass:50.94146749750001},{symbol:"Cr",casId:"7440-47-3",group:6,period:4,name:"Chromium",atomicNumber:24,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.27,radiiVdw:2.05,paulingE:1.66,naturalMass:51.996133070619},{symbol:"Mn",casId:"7439-96-5",group:7,period:4,name:"Manganese",atomicNumber:25,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.39,radiiVdw:2.05,paulingE:1.55,naturalMass:54.9380451},{symbol:"Fe",casId:"7439-89-6",group:8,period:4,name:"Iron",atomicNumber:26,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.83,naturalMass:55.845145623527},{symbol:"Co",casId:"7440-48-4",group:9,period:4,name:"Cobalt",atomicNumber:27,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2,paulingE:1.88,naturalMass:58.933195},{symbol:"Ni",casId:"7440-02-0",group:10,period:4,name:"Nickel",atomicNumber:28,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.21,radiiVdw:2,paulingE:1.91,naturalMass:58.693351562447994},{symbol:"Cu",casId:"7440-50-8",group:11,period:4,name:"Copper",atomicNumber:29,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2,paulingE:1.9,naturalMass:63.5456400936},{symbol:"Zn",casId:"7440-66-6",group:12,period:4,name:"Zinc",atomicNumber:30,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.1,paulingE:1.65,naturalMass:65.39556265691999},{symbol:"Ga",casId:"7440-55-3",group:13,period:4,name:"Gallium",atomicNumber:31,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.1,paulingE:1.81,naturalMass:69.723065622084},{symbol:"Ge",casId:"7440-56-4",group:14,period:4,name:"Germanium",atomicNumber:32,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.22,radiiVdw:2.1,paulingE:2.01,naturalMass:72.61275825015},{symbol:"As",casId:"7440-38-2",group:15,period:4,name:"Arsenic",atomicNumber:33,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.19,radiiVdw:2.05,paulingE:2.18,naturalMass:74.9215965},{symbol:"Se",casId:"7782-49-2",group:16,period:4,name:"Selenium",atomicNumber:34,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.16,radiiVdw:1.9,paulingE:2.55,naturalMass:78.9593882401},{symbol:"Br",casId:"7726-95-6",group:17,period:4,name:"Bromine",atomicNumber:35,chemicalSerie:"Halogens",phase:"Liquid",radiiCova:1.14,radiiVdw:1.9,paulingE:2.96,naturalMass:79.90352797085},{symbol:"Kr",casId:"7439-90-9",group:18,period:4,name:"Krypton",atomicNumber:36,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.1,radiiVdw:2.02,paulingE:3,naturalMass:83.79932499157},{symbol:"Rb",casId:"7440-17-7",group:1,period:5,name:"Rubidium",atomicNumber:37,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.11,radiiVdw:2.9,paulingE:.82,naturalMass:85.46766359685701},{symbol:"Sr",casId:"7440-24-6",group:2,period:5,name:"Strontium",atomicNumber:38,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.92,radiiVdw:2.55,paulingE:.95,naturalMass:87.61664410489999},{symbol:"Y",casId:"7440-65-5",group:3,period:5,name:"Yttrium",atomicNumber:39,chemicalSerie:"Transition metals",phase:"Solid",naturalMass:88.9058483},{symbol:"Zr",casId:"7440-67-7",group:4,period:5,name:"Zirconium",atomicNumber:40,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:91.22364760672002},{symbol:"Nb",casId:"7440-03-1",group:5,period:5,name:"Niobium",atomicNumber:41,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2.15,naturalMass:92.9063781},{symbol:"Mo",casId:"7439-98-7",group:6,period:5,name:"Molybdenum",atomicNumber:42,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.45,radiiVdw:2.1,naturalMass:95.93129211008},{symbol:"Tc",casId:"7440-26-8",group:7,period:5,name:"Technetium",atomicNumber:43,chemicalSerie:"Transition metals",phase:"Synthetic",radiiCova:1.56,radiiVdw:2.05},{symbol:"Ru",casId:"7440-18-8",group:8,period:5,name:"Ruthenium",atomicNumber:44,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2.05,naturalMass:101.06494544279},{symbol:"Rh",casId:"7440-16-6",group:9,period:5,name:"Rhodium",atomicNumber:45,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.35,radiiVdw:2,naturalMass:102.905504},{symbol:"Pd",casId:"7440-05-3",group:10,period:5,name:"Palladium",atomicNumber:46,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.05,naturalMass:106.41532878129999},{symbol:"Ag",casId:"7440-22-4",group:11,period:5,name:"Silver",atomicNumber:47,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.53,radiiVdw:2.1,naturalMass:107.86815084455},{symbol:"Cd",casId:"7440-43-9",group:12,period:5,name:"Cadmium",atomicNumber:48,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.2,naturalMass:112.41155220052002},{symbol:"In",casId:"7440-74-6",group:13,period:5,name:"Indium",atomicNumber:49,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.25,naturalMass:114.818085722},{symbol:"Sn",casId:"7440-31-5",group:14,period:5,name:"Tin",atomicNumber:50,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.41,radiiVdw:2.25,naturalMass:118.71010831537001},{symbol:"Sb",casId:"7440-36-0",group:15,period:5,name:"Antimony",atomicNumber:51,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:121.75978613257},{symbol:"Te",casId:"13494-80-9",group:16,period:5,name:"Tellurium",atomicNumber:52,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.35,radiiVdw:2.1,naturalMass:127.60312784714},{symbol:"I",casId:"7553-56-2",group:17,period:5,name:"Iodine",atomicNumber:53,chemicalSerie:"Halogens",phase:"Solid",radiiCova:1.33,radiiVdw:2.1,naturalMass:126.904473},{symbol:"Xe",casId:"7440-63-3",group:18,period:5,name:"Xenon",atomicNumber:54,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.3,radiiVdw:2.16,naturalMass:131.29248059059},{symbol:"Cs",casId:"7440-46-2",group:1,period:6,name:"Cesium",atomicNumber:55,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.25,radiiVdw:3,naturalMass:132.9054519},{symbol:"Ba",casId:"7440-39-3",group:2,period:6,name:"Barium",atomicNumber:56,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.98,radiiVdw:2.7,naturalMass:137.32689183471098},{symbol:"La",casId:"7439-91-0",group:3,period:6,name:"Lanthanum",atomicNumber:57,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.69,radiiVdw:2.5,naturalMass:138.90545398283},{symbol:"Ce",casId:"7440-45-1",period:6,name:"Cerium",atomicNumber:58,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.48,naturalMass:140.11572621392},{symbol:"Pr",casId:"7440-10-0",period:6,name:"Praseodymium",atomicNumber:59,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:140.9076528},{symbol:"Nd",casId:"7440-00-8",period:6,name:"Neodymium",atomicNumber:60,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:144.23613137220002},{symbol:"Pm",casId:"7440-12-2",period:6,name:"Promethium",atomicNumber:61,chemicalSerie:"Lanthanides",phase:"Synthetic",radiiVdw:2.43},{symbol:"Sm",casId:"7440-19-9",period:6,name:"Samarium",atomicNumber:62,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.43,naturalMass:150.36634852618},{symbol:"Eu",casId:"7440-53-1",period:6,name:"Europium",atomicNumber:63,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:2.4,naturalMass:151.96437047419},{symbol:"Gd",casId:"7440-54-2",period:6,name:"Gadolinium",atomicNumber:64,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.38,naturalMass:157.25212221544},{symbol:"Tb",casId:"7440-27-9",period:6,name:"Terbium",atomicNumber:65,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.37,naturalMass:158.9253468},{symbol:"Dy",casId:"7429-91-6",period:6,name:"Dysprosium",atomicNumber:66,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.35,naturalMass:162.49703350552},{symbol:"Ho",casId:"7440-60-0",period:6,name:"Holmium",atomicNumber:67,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.33,naturalMass:164.9303221},{symbol:"Er",casId:"7440-52-0",period:6,name:"Erbium",atomicNumber:68,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.32,naturalMass:167.25630413192},{symbol:"Tm",casId:"7440-30-4",period:6,name:"Thulium",atomicNumber:69,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.3,naturalMass:168.9342133},{symbol:"Yb",casId:"7440-64-4",period:6,name:"Ytterbium",atomicNumber:70,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.28,naturalMass:173.03769558789998},{symbol:"Lu",casId:"7439-94-3",period:6,name:"Lutetium",atomicNumber:71,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.6,radiiVdw:2.27,naturalMass:174.96672138555},{symbol:"Hf",casId:"7440-58-6",group:4,period:6,name:"Hafnium",atomicNumber:72,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.5,radiiVdw:2.25,naturalMass:178.48497214162},{symbol:"Ta",casId:"7440-25-7",group:5,period:6,name:"Tantalum",atomicNumber:73,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:180.94787573628},{symbol:"W",casId:"7440-33-7",group:6,period:6,name:"Tungsten",atomicNumber:74,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.46,radiiVdw:2.1,naturalMass:183.84177810241},{symbol:"Re",casId:"7440-15-5",group:7,period:6,name:"Rhenium",atomicNumber:75,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.59,radiiVdw:2.05,naturalMass:186.2067066106},{symbol:"Os",casId:"7440-04-2",group:8,period:6,name:"Osmium",atomicNumber:76,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2,naturalMass:190.22486304558998},{symbol:"Ir",casId:"7439-88-5",group:9,period:6,name:"Iridium",atomicNumber:77,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2,naturalMass:192.2160564148},{symbol:"Pt",casId:"7440-06-4",group:10,period:6,name:"Platinum",atomicNumber:78,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2.05,naturalMass:195.07780788031297},{symbol:"Au",casId:"7440-57-5",group:11,period:6,name:"Gold",atomicNumber:79,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.1,naturalMass:196.9665687},{symbol:"Hg",casId:"7439-97-6",group:12,period:6,name:"Mercury",atomicNumber:80,chemicalSerie:"Transition metals",phase:"Liquid",radiiCova:1.49,radiiVdw:2.05,naturalMass:200.59916661780002},{symbol:"Tl",casId:"7440-28-0",group:13,period:6,name:"Thallium",atomicNumber:81,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.49,radiiVdw:2.2,naturalMass:204.38333242650796},{symbol:"Pb",casId:"7439-92-1",group:14,period:6,name:"Lead",atomicNumber:82,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:207.21690766300003},{symbol:"Bi",casId:"7440-69-9",group:15,period:6,name:"Bismuth",atomicNumber:83,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.47,radiiVdw:2.3,naturalMass:208.9803987},{symbol:"Po",casId:"7440-08-6",group:16,period:6,name:"Polonium",atomicNumber:84,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.46,radiiVdw:2},{symbol:"At",casId:"7440-08-6",group:17,period:6,name:"Astatine",atomicNumber:85,chemicalSerie:"Halogens",phase:"Solid",radiiVdw:2},{symbol:"Rn",casId:"10043-92-2",group:18,period:6,name:"Radon",atomicNumber:86,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.45,radiiVdw:2},{symbol:"Fr",casId:"7440-73-5",group:1,period:7,name:"Francium",atomicNumber:87,chemicalSerie:"Alkali Metals",phase:"Solid",radiiVdw:2},{symbol:"Ra",casId:"7440-14-4",group:2,period:7,name:"Radium",atomicNumber:88,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiVdw:2},{symbol:"Ac",casId:"7440-34-8",group:3,period:7,name:"Actinium",atomicNumber:89,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Th",casId:"7440-29-1",period:7,name:"Thorium",atomicNumber:90,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:232.0380553},{symbol:"Pa",casId:"7440-13-3",period:7,name:"Protactinium",atomicNumber:91,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2,naturalMass:231.035884},{symbol:"U",casId:"7440-61-1",period:7,name:"Uranium",atomicNumber:92,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:238.0289182792545},{symbol:"Np",casId:"7439-99-8",period:7,name:"Neptunium",atomicNumber:93,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Pu",casId:"7440-07-5",period:7,name:"Plutonium",atomicNumber:94,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Am",casId:"7440-35-9",period:7,name:"Americium",atomicNumber:95,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cm",casId:"7440-51-9",period:7,name:"Curium",atomicNumber:96,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Bk",casId:"7440-40-6",period:7,name:"Berkelium",atomicNumber:97,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cf",casId:"7440-71-3",period:7,name:"Californium",atomicNumber:98,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Es",casId:"7429-92-7",period:7,name:"Einsteinium",atomicNumber:99,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Fm",casId:"7440-72-4",period:7,name:"Fermium",atomicNumber:100,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Md",casId:"7440-11-1",period:7,name:"Mendelevium",atomicNumber:101,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"No",casId:"10028-14-5",period:7,name:"Nobelium",atomicNumber:102,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Lr",casId:"22537-19-5",period:7,name:"Lawrencium",atomicNumber:103,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Rf",casId:"53850-36-5",group:4,period:7,name:"Rutherfordium",atomicNumber:104,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Db",casId:"53850-35-4",group:5,period:7,name:"Dubnium",atomicNumber:105,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Sg",casId:"54038-81-2",group:6,period:7,name:"Seaborgium",atomicNumber:106,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Bh",casId:"54037-14-8",group:7,period:7,name:"Bohrium",atomicNumber:107,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Hs",casId:"54037-57-9",group:8,period:7,name:"Hassium",atomicNumber:108,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Mt",casId:"54038-01-6",group:9,period:7,name:"Meitnerium",atomicNumber:109,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Ds",casId:"54083-77-1",group:10,period:7,name:"Darmstadtium",atomicNumber:110,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Rg",casId:"54386-24-2",group:11,period:7,name:"Roentgenium",atomicNumber:111,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Uub",group:12,period:7,name:"Ununbium",atomicNumber:112,chemicalSerie:"Transition metals",phase:"Synthetic"}],Kekule.isotopesData=[{elementSymbol:"H",atomicNumber:1,isotopes:[{id:"H1",massNumber:1,relativeAbundance:.999885,atomicNumber:1,exactMass:1.007825032,spin:"1/2+",magneticMoment:"+2.792846",halfLife:-1},{id:"H2",massNumber:2,relativeAbundance:115e-6,atomicNumber:1,exactMass:2.014101778,spin:"1+",magneticMoment:"+0.857438",halfLife:-1},{id:"H3",massNumber:3,exactMass:3.016049278,atomicNumber:1,spin:"1/2+",magneticMoment:"+2.978960",halfLife:388839e3,betaminusDecay:"0.01861",betaminusDecayLikeliness:"100.0"},{id:"H4",massNumber:4,exactMass:4.02781,atomicNumber:1},{id:"H5",massNumber:5,exactMass:5.03531,atomicNumber:1},{id:"H6",massNumber:6,exactMass:6.04494,atomicNumber:1},{id:"H7",massNumber:7,exactMass:7.05275,atomicNumber:1}]},{elementSymbol:"He",atomicNumber:2,isotopes:[{id:"He3",massNumber:3,relativeAbundance:137e-8,atomicNumber:2,exactMass:3.016029319,spin:"1/2+",magneticMoment:"-2.127624",halfLife:-1},{id:"He4",massNumber:4,relativeAbundance:.99999863,atomicNumber:2,exactMass:4.002603254,spin:"0+",halfLife:-1},{id:"He5",massNumber:5,exactMass:5.01222,atomicNumber:2},{id:"He6",massNumber:6,exactMass:6.0188891,atomicNumber:2,halfLife:.8067},{id:"He7",massNumber:7,exactMass:7.028021,atomicNumber:2},{id:"He8",massNumber:8,exactMass:8.033922,atomicNumber:2,halfLife:.119},{id:"He9",massNumber:9,exactMass:9.04395,atomicNumber:2},{id:"He10",massNumber:10,exactMass:10.0524,atomicNumber:2}]},null,null,{elementSymbol:"B",atomicNumber:5,isotopes:[{id:"B6",massNumber:6,exactMass:6.04681,atomicNumber:5},{id:"B7",massNumber:7,exactMass:7.02992,atomicNumber:5},{id:"B8",massNumber:8,exactMass:8.0246072,atomicNumber:5,halfLife:.77},{id:"B9",massNumber:9,exactMass:9.0133288,atomicNumber:5},{id:"B10",massNumber:10,relativeAbundance:.19899999999999998,atomicNumber:5,exactMass:10.012937,spin:"3+",magneticMoment:"+1.80065",halfLife:-1},{id:"B11",massNumber:11,relativeAbundance:.8009999999999999,atomicNumber:5,exactMass:11.0093054,spin:"3/2-",magneticMoment:"+2.688637",halfLife:-1},{id:"B12",massNumber:12,exactMass:12.0143521,atomicNumber:5,halfLife:.0202},{id:"B13",massNumber:13,exactMass:13.0177802,atomicNumber:5,halfLife:.01736},{id:"B14",massNumber:14,exactMass:14.025404,atomicNumber:5,halfLife:.0138},{id:"B15",massNumber:15,exactMass:15.031103,atomicNumber:5,halfLife:.0105},{id:"B16",massNumber:16,exactMass:16.03981,atomicNumber:5},{id:"B17",massNumber:17,exactMass:17.04699,atomicNumber:5,halfLife:.00508},{id:"B18",massNumber:18,exactMass:18.05617,atomicNumber:5},{id:"B19",massNumber:19,exactMass:19.06373,atomicNumber:5}]},{elementSymbol:"C",atomicNumber:6,isotopes:[{id:"C8",massNumber:8,exactMass:8.037675,atomicNumber:6},{id:"C9",massNumber:9,exactMass:9.0310367,atomicNumber:6,halfLife:.126},{id:"C10",massNumber:10,exactMass:10.0168532,atomicNumber:6,halfLife:19.255},{id:"C11",massNumber:11,exactMass:11.0114336,atomicNumber:6,spin:"3/2-",halfLife:1223.4,betaplusDecay:"0.96",betaplusDecayLikeliness:"100.0"},{id:"C12",massNumber:12,relativeAbundance:.9893000000000001,atomicNumber:6,exactMass:12,spin:"0+",halfLife:-1},{id:"C13",massNumber:13,relativeAbundance:.010700000000000001,atomicNumber:6,exactMass:13.00335484,spin:"1/2-",magneticMoment:"+0.702411",halfLife:-1},{id:"C14",massNumber:14,exactMass:14.00324199,atomicNumber:6,halfLife:180701e6,betaminusDecay:"0.15648",betaminusDecayLikeliness:"100.0"},{id:"C15",massNumber:15,exactMass:15.0105993,atomicNumber:6,halfLife:2.449},{id:"C16",massNumber:16,exactMass:16.014701,atomicNumber:6,halfLife:.747},{id:"C17",massNumber:17,exactMass:17.022586,atomicNumber:6,halfLife:.193},{id:"C18",massNumber:18,exactMass:18.02676,atomicNumber:6,halfLife:.095},{id:"C19",massNumber:19,exactMass:19.03481,atomicNumber:6,halfLife:.046},{id:"C20",massNumber:20,exactMass:20.04032,atomicNumber:6,halfLife:.014},{id:"C21",massNumber:21,exactMass:21.04934,atomicNumber:6},{id:"C22",massNumber:22,exactMass:22.0572,atomicNumber:6}]},{elementSymbol:"N",atomicNumber:7,isotopes:[{id:"N10",massNumber:10,exactMass:10.04165,atomicNumber:7},{id:"N11",massNumber:11,exactMass:11.02609,atomicNumber:7},{id:"N12",massNumber:12,exactMass:12.0186132,atomicNumber:7,halfLife:.011},{id:"N13",massNumber:13,exactMass:13.00573861,atomicNumber:7,halfLife:597.9},{id:"N14",massNumber:14,relativeAbundance:.9963200000000001,atomicNumber:7,exactMass:14.003074,spin:"1+",magneticMoment:"+0.403761",halfLife:-1},{id:"N15",massNumber:15,relativeAbundance:.00368,atomicNumber:7,exactMass:15.0001089,spin:"1/2-",magneticMoment:"-0.283189",halfLife:-1},{id:"N16",massNumber:16,exactMass:16.0061017,atomicNumber:7,halfLife:7.13},{id:"N17",massNumber:17,exactMass:17.00845,atomicNumber:7,halfLife:4.173},{id:"N18",massNumber:18,exactMass:18.014079,atomicNumber:7,halfLife:.624},{id:"N19",massNumber:19,exactMass:19.017029,atomicNumber:7,halfLife:.304},{id:"N20",massNumber:20,exactMass:20.02337,atomicNumber:7,halfLife:.1},{id:"N21",massNumber:21,exactMass:21.02711,atomicNumber:7,halfLife:.085},{id:"N22",massNumber:22,exactMass:22.03439,atomicNumber:7,halfLife:.024},{id:"N23",massNumber:23,exactMass:23.04122,atomicNumber:7},{id:"N24",massNumber:24,exactMass:24.05104,atomicNumber:7},{id:"N25",massNumber:25,exactMass:25.06066,atomicNumber:7}]},{elementSymbol:"O",atomicNumber:8,isotopes:[{id:"O12",massNumber:12,exactMass:12.034405,atomicNumber:8},{id:"O13",massNumber:13,exactMass:13.024812,atomicNumber:8,halfLife:.00858},{id:"O14",massNumber:14,exactMass:14.00859625,atomicNumber:8,halfLife:70.606},{id:"O15",massNumber:15,exactMass:15.0030656,atomicNumber:8,halfLife:122.24},{id:"O16",massNumber:16,relativeAbundance:.9975700000000001,atomicNumber:8,exactMass:15.99491462,spin:"0+",halfLife:-1},{id:"O17",massNumber:17,relativeAbundance:.00037999999999999997,atomicNumber:8,exactMass:16.9991317,spin:"5/2+",magneticMoment:"-1.89379",halfLife:-1},{id:"O18",massNumber:18,relativeAbundance:.0020499999999999997,atomicNumber:8,exactMass:17.999161,spin:"0+",halfLife:-1},{id:"O19",massNumber:19,exactMass:19.00358,atomicNumber:8,halfLife:26.91},{id:"O20",massNumber:20,exactMass:20.0040767,atomicNumber:8,halfLife:13.51},{id:"O21",massNumber:21,exactMass:21.008656,atomicNumber:8,halfLife:3.42},{id:"O22",massNumber:22,exactMass:22.00997,atomicNumber:8,halfLife:2.25},{id:"O23",massNumber:23,exactMass:23.01569,atomicNumber:8,halfLife:.082},{id:"O24",massNumber:24,exactMass:24.02047,atomicNumber:8,halfLife:.061},{id:"O25",massNumber:25,exactMass:25.02946,atomicNumber:8},{id:"O26",massNumber:26,exactMass:26.03834,atomicNumber:8},{id:"O27",massNumber:27,exactMass:27.04826,atomicNumber:8},{id:"O28",massNumber:28,exactMass:28.05781,atomicNumber:8}]},{elementSymbol:"F",atomicNumber:9,isotopes:[{id:"F14",massNumber:14,exactMass:14.03506,atomicNumber:9},{id:"F15",massNumber:15,exactMass:15.01801,atomicNumber:9,halfLife:-1},{id:"F16",massNumber:16,exactMass:16.011466,atomicNumber:9},{id:"F17",massNumber:17,exactMass:17.00209524,atomicNumber:9,halfLife:64.49},{id:"F18",massNumber:18,exactMass:18.000938,atomicNumber:9,spin:"1+",halfLife:6586.2,betaplusDecay:"0.64",betaplusDecayLikeliness:"97.0",ecDecay:"",ecDecayLikeliness:"3.0"},{id:"F19",massNumber:19,relativeAbundance:1,atomicNumber:9,exactMass:18.99840322,spin:"1/2+",magneticMoment:"+2.628866",halfLife:-1},{id:"F20",massNumber:20,exactMass:19.99998132,atomicNumber:9,halfLife:11},{id:"F21",massNumber:21,exactMass:20.999949,atomicNumber:9,halfLife:4.158},{id:"F22",massNumber:22,exactMass:22.002999,atomicNumber:9,halfLife:4.23},{id:"F23",massNumber:23,exactMass:23.00357,atomicNumber:9,halfLife:2.23},{id:"F24",massNumber:24,exactMass:24.00812,atomicNumber:9,halfLife:.34},{id:"F25",massNumber:25,exactMass:25.0121,atomicNumber:9,halfLife:.059},{id:"F26",massNumber:26,exactMass:26.01962,atomicNumber:9},{id:"F27",massNumber:27,exactMass:27.02676,atomicNumber:9},{id:"F28",massNumber:28,exactMass:28.03567,atomicNumber:9},{id:"F29",massNumber:29,exactMass:29.04326,atomicNumber:9},{id:"F30",massNumber:30,exactMass:30.0525,atomicNumber:9},{id:"F31",massNumber:31,exactMass:31.06043,atomicNumber:9}]},null,null,null,null,{elementSymbol:"Si",atomicNumber:14,isotopes:[{id:"Si22",massNumber:22,exactMass:22.03453,atomicNumber:14,halfLife:.006},{id:"Si23",massNumber:23,exactMass:23.02552,atomicNumber:14},{id:"Si24",massNumber:24,exactMass:24.011546,atomicNumber:14,halfLife:.102},{id:"Si25",massNumber:25,exactMass:25.004106,atomicNumber:14,halfLife:.22},{id:"Si26",massNumber:26,exactMass:25.99233,atomicNumber:14,halfLife:2.234},{id:"Si27",massNumber:27,exactMass:26.98670491,atomicNumber:14,halfLife:4.16},{id:"Si28",massNumber:28,relativeAbundance:.9222969999999999,atomicNumber:14,exactMass:27.97692653,spin:"0+",halfLife:-1},{id:"Si29",massNumber:29,relativeAbundance:.046832000000000006,atomicNumber:14,exactMass:28.9764947,spin:"1/2+",magneticMoment:"-0.55529",halfLife:-1},{id:"Si30",massNumber:30,relativeAbundance:.030872,atomicNumber:14,exactMass:29.97377017,spin:"0+",halfLife:-1},{id:"Si31",massNumber:31,exactMass:30.97536323,atomicNumber:14,halfLife:9438},{id:"Si32",massNumber:32,exactMass:31.97414808,atomicNumber:14,halfLife:47304e5},{id:"Si33",massNumber:33,exactMass:32.978,atomicNumber:14,halfLife:6.18},{id:"Si34",massNumber:34,exactMass:33.978576,atomicNumber:14,halfLife:2.77},{id:"Si35",massNumber:35,exactMass:34.98458,atomicNumber:14,halfLife:.78},{id:"Si36",massNumber:36,exactMass:35.9866,atomicNumber:14,halfLife:.45},{id:"Si37",massNumber:37,exactMass:36.99294,atomicNumber:14},{id:"Si38",massNumber:38,exactMass:37.99563,atomicNumber:14},{id:"Si39",massNumber:39,exactMass:39.00207,atomicNumber:14},{id:"Si40",massNumber:40,exactMass:40.00587,atomicNumber:14},{id:"Si41",massNumber:41,exactMass:41.01456,atomicNumber:14},{id:"Si42",massNumber:42,exactMass:42.01979,atomicNumber:14},{id:"Si43",massNumber:43,exactMass:43.02866,atomicNumber:14},{id:"Si44",massNumber:44,exactMass:44.03526,atomicNumber:14}]},{elementSymbol:"P",atomicNumber:15,isotopes:[{id:"P24",massNumber:24,exactMass:24.03435,atomicNumber:15},{id:"P25",massNumber:25,exactMass:25.02026,atomicNumber:15},{id:"P26",massNumber:26,exactMass:26.01178,atomicNumber:15,halfLife:.02},{id:"P27",massNumber:27,exactMass:26.99923,atomicNumber:15,halfLife:.26},{id:"P28",massNumber:28,exactMass:27.992315,atomicNumber:15,halfLife:.2703},{id:"P29",massNumber:29,exactMass:28.9818006,atomicNumber:15,halfLife:4.14},{id:"P30",massNumber:30,exactMass:29.9783138,atomicNumber:15,halfLife:149.88},{id:"P31",massNumber:31,relativeAbundance:1,atomicNumber:15,exactMass:30.97376163,spin:"1/2+",magneticMoment:"+1.13160",halfLife:-1},{id:"P32",massNumber:32,exactMass:31.97390727,atomicNumber:15,spin:"1+",magneticMoment:"-0.2524",halfLife:1232240,betaminusDecay:"1.710",betaminusDecayLikeliness:"100.0"},{id:"P33",massNumber:33,exactMass:32.9717255,atomicNumber:15,halfLife:2189380},{id:"P34",massNumber:34,exactMass:33.973636,atomicNumber:15,halfLife:12.43},{id:"P35",massNumber:35,exactMass:34.9733141,atomicNumber:15,halfLife:47.3},{id:"P36",massNumber:36,exactMass:35.97826,atomicNumber:15,halfLife:5.6},{id:"P37",massNumber:37,exactMass:36.97961,atomicNumber:15,halfLife:2.31},{id:"P38",massNumber:38,exactMass:37.98416,atomicNumber:15,halfLife:.64},{id:"P39",massNumber:39,exactMass:38.98618,atomicNumber:15,halfLife:.16},{id:"P40",massNumber:40,exactMass:39.9913,atomicNumber:15,halfLife:.26},{id:"P41",massNumber:41,exactMass:40.99434,atomicNumber:15,halfLife:.12},{id:"P42",massNumber:42,exactMass:42.00101,atomicNumber:15,halfLife:.11},{id:"P43",massNumber:43,exactMass:43.00619,atomicNumber:15,halfLife:.033},{id:"P44",massNumber:44,exactMass:44.01299,atomicNumber:15},{id:"P45",massNumber:45,exactMass:45.01922,atomicNumber:15},{id:"P46",massNumber:46,exactMass:46.02738,atomicNumber:15}]},{elementSymbol:"S",atomicNumber:16,isotopes:[{id:"S26",massNumber:26,exactMass:26.02788,atomicNumber:16},{id:"S27",massNumber:27,exactMass:27.01883,atomicNumber:16,halfLife:.021},{id:"S28",massNumber:28,exactMass:28.00437,atomicNumber:16,halfLife:.125},{id:"S29",massNumber:29,exactMass:28.99661,atomicNumber:16,halfLife:.187},{id:"S30",massNumber:30,exactMass:29.984903,atomicNumber:16,halfLife:1.178},{id:"S31",massNumber:31,exactMass:30.9795547,atomicNumber:16,halfLife:2.572},{id:"S32",massNumber:32,relativeAbundance:.9493,atomicNumber:16,exactMass:31.972071,spin:"0+",halfLife:-1},{id:"S33",massNumber:33,relativeAbundance:.0076,atomicNumber:16,exactMass:32.97145876,spin:"3/2+",magneticMoment:"+0.643821",halfLife:-1},{id:"S34",massNumber:34,relativeAbundance:.0429,atomicNumber:16,exactMass:33.9678669,spin:"0+",halfLife:-1},{id:"S35",massNumber:35,exactMass:34.96903216,atomicNumber:16,spin:"3/2+",magneticMoment:"+1",halfLife:7544450,betaminusDecay:"0.1674",betaminusDecayLikeliness:"100.0"},{id:"S36",massNumber:36,relativeAbundance:2e-4,atomicNumber:16,exactMass:35.96708076,spin:"0+",halfLife:-1},{id:"S37",massNumber:37,exactMass:36.97112557,atomicNumber:16,halfLife:303},{id:"S38",massNumber:38,exactMass:37.971163,atomicNumber:16,halfLife:10218},{id:"S39",massNumber:39,exactMass:38.97513,atomicNumber:16,halfLife:11.5},{id:"S40",massNumber:40,exactMass:39.97545,atomicNumber:16,halfLife:8.8},{id:"S41",massNumber:41,exactMass:40.97958,atomicNumber:16},{id:"S42",massNumber:42,exactMass:41.98102,atomicNumber:16,halfLife:.56},{id:"S43",massNumber:43,exactMass:42.98715,atomicNumber:16,halfLife:.22},{id:"S44",massNumber:44,exactMass:43.99021,atomicNumber:16,halfLife:.123},{id:"S45",massNumber:45,exactMass:44.99651,atomicNumber:16,halfLife:.082},{id:"S46",massNumber:46,exactMass:46.00075,atomicNumber:16},{id:"S47",massNumber:47,exactMass:47.00859,atomicNumber:16},{id:"S48",massNumber:48,exactMass:48.01417,atomicNumber:16},{id:"S49",massNumber:49,exactMass:49.02362,atomicNumber:16}]},{elementSymbol:"Cl",atomicNumber:17,isotopes:[{id:"Cl28",massNumber:28,exactMass:28.02851,atomicNumber:17},{id:"Cl29",massNumber:29,exactMass:29.01411,atomicNumber:17},{id:"Cl30",massNumber:30,exactMass:30.00477,atomicNumber:17},{id:"Cl31",massNumber:31,exactMass:30.99241,atomicNumber:17,halfLife:.15},{id:"Cl32",massNumber:32,exactMass:31.98569,atomicNumber:17,halfLife:.298},{id:"Cl33",massNumber:33,exactMass:32.9774519,atomicNumber:17,halfLife:2.511},{id:"Cl34",massNumber:34,exactMass:33.97376282,atomicNumber:17,halfLife:1.5264},{id:"Cl35",massNumber:35,relativeAbundance:.7578,atomicNumber:17,exactMass:34.96885268,spin:"3/2+",magneticMoment:"+0.82187",halfLife:-1},{id:"Cl36",massNumber:36,exactMass:35.96830698,atomicNumber:17},{id:"Cl37",massNumber:37,relativeAbundance:.2422,atomicNumber:17,exactMass:36.96590259,spin:"3/2+",magneticMoment:"+0.68412",halfLife:-1},{id:"Cl38",massNumber:38,exactMass:37.96801043,atomicNumber:17,halfLife:2234.4},{id:"Cl39",massNumber:39,exactMass:38.9680082,atomicNumber:17,halfLife:3336},{id:"Cl40",massNumber:40,exactMass:39.97042,atomicNumber:17,halfLife:81},{id:"Cl41",massNumber:41,exactMass:40.97068,atomicNumber:17,halfLife:38.4},{id:"Cl42",massNumber:42,exactMass:41.97325,atomicNumber:17,halfLife:6.8},{id:"Cl43",massNumber:43,exactMass:42.97405,atomicNumber:17,halfLife:3.3},{id:"Cl44",massNumber:44,exactMass:43.97828,atomicNumber:17,halfLife:.434},{id:"Cl45",massNumber:45,exactMass:44.98029,atomicNumber:17,halfLife:.4},{id:"Cl46",massNumber:46,exactMass:45.98421,atomicNumber:17,halfLife:.223},{id:"Cl47",massNumber:47,exactMass:46.98871,atomicNumber:17},{id:"Cl48",massNumber:48,exactMass:47.99495,atomicNumber:17},{id:"Cl49",massNumber:49,exactMass:49.00032,atomicNumber:17},{id:"Cl50",massNumber:50,exactMass:50.00784,atomicNumber:17},{id:"Cl51",massNumber:51,exactMass:51.01449,atomicNumber:17}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"Br",atomicNumber:35,isotopes:[{id:"Br67",massNumber:67,exactMass:66.96479,atomicNumber:35},{id:"Br68",massNumber:68,exactMass:67.95852,atomicNumber:35},{id:"Br69",massNumber:69,exactMass:68.95011,atomicNumber:35},{id:"Br70",massNumber:70,exactMass:69.94479,atomicNumber:35,halfLife:.0791},{id:"Br71",massNumber:71,exactMass:70.93874,atomicNumber:35,halfLife:21.4},{id:"Br72",massNumber:72,exactMass:71.93664,atomicNumber:35,halfLife:78.6},{id:"Br73",massNumber:73,exactMass:72.93169,atomicNumber:35,halfLife:204},{id:"Br74",massNumber:74,exactMass:73.929891,atomicNumber:35,halfLife:1524},{id:"Br75",massNumber:75,exactMass:74.925776,atomicNumber:35,halfLife:5802},{id:"Br76",massNumber:76,exactMass:75.924541,atomicNumber:35,halfLife:58320},{id:"Br77",massNumber:77,exactMass:76.921379,atomicNumber:35,halfLife:205330},{id:"Br78",massNumber:78,exactMass:77.921146,atomicNumber:35,halfLife:387.6},{id:"Br79",massNumber:79,relativeAbundance:.5069,atomicNumber:35,exactMass:78.9183371,spin:"3/2-",magneticMoment:"+2.1064",halfLife:-1},{id:"Br80",massNumber:80,exactMass:79.9185293,atomicNumber:35,halfLife:1060.8},{id:"Br81",massNumber:81,relativeAbundance:.49310000000000004,atomicNumber:35,exactMass:80.9162906,spin:"3/2-",magneticMoment:"+2.2706",halfLife:-1},{id:"Br82",massNumber:82,exactMass:81.9168041,atomicNumber:35,halfLife:127080},{id:"Br83",massNumber:83,exactMass:82.91518,atomicNumber:35,halfLife:8640},{id:"Br84",massNumber:84,exactMass:83.916479,atomicNumber:35,halfLife:1908},{id:"Br85",massNumber:85,exactMass:84.915608,atomicNumber:35,halfLife:174},{id:"Br86",massNumber:86,exactMass:85.918798,atomicNumber:35,halfLife:55.1},{id:"Br87",massNumber:87,exactMass:86.920711,atomicNumber:35,halfLife:55.6},{id:"Br88",massNumber:88,exactMass:87.92407,atomicNumber:35,halfLife:16.34},{id:"Br89",massNumber:89,exactMass:88.92639,atomicNumber:35,halfLife:4.348},{id:"Br90",massNumber:90,exactMass:89.93063,atomicNumber:35,halfLife:1.91},{id:"Br91",massNumber:91,exactMass:90.93397,atomicNumber:35,halfLife:.541},{id:"Br92",massNumber:92,exactMass:91.93926,atomicNumber:35,halfLife:.343},{id:"Br93",massNumber:93,exactMass:92.94305,atomicNumber:35,halfLife:.102},{id:"Br94",massNumber:94,exactMass:93.94868,atomicNumber:35,halfLife:.07},{id:"Br95",massNumber:95,exactMass:94.95287,atomicNumber:35},{id:"Br96",massNumber:96,exactMass:95.95853,atomicNumber:35},{id:"Br97",massNumber:97,exactMass:96.9628,atomicNumber:35}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,isotopes:[{id:"I108",massNumber:108,exactMass:107.94348,atomicNumber:53,halfLife:.036},{id:"I109",massNumber:109,exactMass:108.93815,atomicNumber:53,halfLife:1e-4},{id:"I110",massNumber:110,exactMass:109.93524,atomicNumber:53,halfLife:.65},{id:"I111",massNumber:111,exactMass:110.93028,atomicNumber:53,halfLife:2.5},{id:"I112",massNumber:112,exactMass:111.92797,atomicNumber:53,halfLife:3.42},{id:"I113",massNumber:113,exactMass:112.92364,atomicNumber:53,halfLife:6.6},{id:"I114",massNumber:114,exactMass:113.92185,atomicNumber:53,halfLife:2.1},{id:"I115",massNumber:115,exactMass:114.91805,atomicNumber:53,halfLife:78},{id:"I116",massNumber:116,exactMass:115.91681,atomicNumber:53,halfLife:2.91},{id:"I117",massNumber:117,exactMass:116.91365,atomicNumber:53,halfLife:133.2},{id:"I118",massNumber:118,exactMass:117.913074,atomicNumber:53,halfLife:822},{id:"I119",massNumber:119,exactMass:118.91007,atomicNumber:53,halfLife:1146},{id:"I120",massNumber:120,exactMass:119.910048,atomicNumber:53,halfLife:4860},{id:"I121",massNumber:121,exactMass:120.907367,atomicNumber:53,halfLife:7632},{id:"I122",massNumber:122,exactMass:121.907589,atomicNumber:53,halfLife:217.8},{id:"I123",massNumber:123,exactMass:122.905589,atomicNumber:53,halfLife:47772},{id:"I124",massNumber:124,exactMass:123.9062099,atomicNumber:53,halfLife:360806},{id:"I125",massNumber:125,exactMass:124.9046302,atomicNumber:53,spin:"5/2+",halfLife:5132850},{id:"I126",massNumber:126,exactMass:125.905624,atomicNumber:53,spin:"2-",halfLife:1132700},{id:"I127",massNumber:127,relativeAbundance:1,atomicNumber:53,exactMass:126.904473,spin:"5/2+",magneticMoment:"+2.808",halfLife:-1},{id:"I128",massNumber:128,exactMass:127.905809,atomicNumber:53,spin:"1+",halfLife:1499.4},{id:"I129",massNumber:129,exactMass:128.904988,atomicNumber:53,magneticMoment:"+2.617",halfLife:157e5,betaminusDecay:"0.193",betaminusDecayLikeliness:"100.0"},{id:"I130",massNumber:130,exactMass:129.906674,atomicNumber:53,halfLife:44496},{id:"I131",massNumber:131,exactMass:130.9061246,atomicNumber:53,halfLife:692988},{id:"I132",massNumber:132,exactMass:131.907997,atomicNumber:53,halfLife:8262},{id:"I133",massNumber:133,exactMass:132.907797,atomicNumber:53,halfLife:74880},{id:"I134",massNumber:134,exactMass:133.909744,atomicNumber:53,halfLife:3150},{id:"I135",massNumber:135,exactMass:134.910048,atomicNumber:53,halfLife:23652},{id:"I136",massNumber:136,exactMass:135.91465,atomicNumber:53,halfLife:83.4},{id:"I137",massNumber:137,exactMass:136.917871,atomicNumber:53,halfLife:24.5},{id:"I138",massNumber:138,exactMass:137.92235,atomicNumber:53,halfLife:6.49},{id:"I139",massNumber:139,exactMass:138.9261,atomicNumber:53,halfLife:2.29},{id:"I140",massNumber:140,exactMass:139.931,atomicNumber:53,halfLife:.86},{id:"I141",massNumber:141,exactMass:140.93503,atomicNumber:53,halfLife:.43},{id:"I142",massNumber:142,exactMass:141.94018,atomicNumber:53},{id:"I143",massNumber:143,exactMass:142.94456,atomicNumber:53},{id:"I144",massNumber:144,exactMass:143.94999,atomicNumber:53}]}],Kekule.structGenAtomTypesData=[{elementSymbol:"H",atomicNumber:1,atomTypes:[{id:"H1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Li",atomicNumber:3,atomTypes:[{id:"Li1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"B",atomicNumber:5,atomTypes:[{id:"B3",maxBondOrder:2,bondOrderSum:3}]},{elementSymbol:"C",atomicNumber:6,atomTypes:[{id:"C4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"N",atomicNumber:7,atomTypes:[{id:"N3",maxBondOrder:3,bondOrderSum:3},{id:"N5",maxBondOrder:2,bondOrderSum:5}]},{elementSymbol:"O",atomicNumber:8,atomTypes:[{id:"O2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"F",atomicNumber:9,atomTypes:[{id:"F1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Na",atomicNumber:11,atomTypes:[{id:"Na1",maxBondOrder:1,bondOrderSum:1}]},null,null,{elementSymbol:"Si",atomicNumber:14,atomTypes:[{id:"Si4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"P",atomicNumber:15,atomTypes:[{id:"P3",maxBondOrder:3,bondOrderSum:3},{id:"P4",maxBondOrder:3,bondOrderSum:5}]},{elementSymbol:"S",atomicNumber:16,atomTypes:[{id:"S2",maxBondOrder:2,bondOrderSum:2},{id:"S3",maxBondOrder:2,bondOrderSum:4},{id:"S4",maxBondOrder:2,bondOrderSum:6}]},{elementSymbol:"Cl",atomicNumber:17,atomTypes:[{id:"Cl1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"As",atomicNumber:33,atomTypes:[{id:"As3",maxBondOrder:1,bondOrderSum:3}]},{elementSymbol:"Se",atomicNumber:34,atomTypes:[{id:"Se2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"Br",atomicNumber:35,atomTypes:[{id:"Br1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,atomTypes:[{id:"I1",maxBondOrder:1,bondOrderSum:1}]}],Kekule.ChemicalElementsDataUtil={_getElementInfoBySymbol:function(s){for(var e,t=0,n=Kekule.chemicalElementsData.length;t<n;++t)if((e=Kekule.chemicalElementsData[t])&&e.symbol==s)return e;return null},_getElementInfoByAtomicNumber:function(s){var e=Kekule.chemicalElementsData[s-1];if(e&&e.atomicNumber==s)return e;if(!e||e.atomicNumber<s){for(var t=s,n=Kekule.chemicalElementsData.length;t<n;++t)if((e=Kekule.chemicalElementsData[t])&&e.atomicNumber==s)return e;for(t=s-2;t>=0;--t)if((e=Kekule.chemicalElementsData[t])&&e.atomicNumber==s)return e}else{for(t=s-2;t>=0;--t)if((e=Kekule.chemicalElementsData[t])&&e.atomicNumber==s)return e;for(t=s,n=Kekule.chemicalElementsData.length;t<n;++t)if((e=Kekule.chemicalElementsData[t])&&e.atomicNumber==s)return e}return null},getElementInfo:function(s){return typeof s=="number"?Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(s):Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(s)},getElementProp:function(s,e){var t=Kekule.ChemicalElementsDataUtil.getElementInfo(s);return t?t[e]:null},getAtomicNumber:function(s){var e=Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(s);return e?e.atomicNumber:0},getElementSymbol:function(s){var e=Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(s);return e?e.symbol:null},isAtomicNumberAvailable:function(s){return!!Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(s)},isElementSymbolAvailable:function(s){return Kekule.ChemicalElementsDataUtil.getAtomicNumber(s)>0},getAllElementSymbols:function(){for(var s=[],e=Kekule.chemicalElementsData,t=0,n=e.length;t<n;++t)s.push(e[t].symbol);return s}},Kekule.IsotopeAliasUtil={enableAlias:!0,ALIAS:[{alias:"D",atomicNumber:1,massNumber:2}],getAllAlias:function(){return Kekule.IsotopeAliasUtil.enableAlias?Kekule.IsotopeAliasUtil.ALIAS:[]},getAliasInfo:function(s){for(var e=Kekule.IsotopeAliasUtil.getAllAlias(),t=0,n=e.length;t<n;++t){var i=e[t];if(i.alias===s)return Object.extend(Kekule.IsotopesDataUtil.getIsotopeInfo(i.atomicNumber,i.massNumber),{isotopeAlias:s})}return null},getAlias:function(s,e){for(var t=Kekule.IsotopeAliasUtil.getAllAlias(),n=0,i=t.length;n<i;++n){var r=t[n];if(r.atomicNumber===s&&r.massNumber===e)return r.alias}return null}},Kekule.IsotopesDataUtil={_getElementItem:function(s){var e;if(e=typeof s=="number"?s:Kekule.ChemicalElementsDataUtil.getAtomicNumber(s),!(i=Kekule.isotopesData[e-1])||i.atomicNumber!=e)for(var t=0,n=Kekule.isotopesData.length;t<n;++t){var i;if((i=Kekule.isotopesData[t])&&i.atomicNumber==e)break}return i},getAllIsotopeInfos:function(s){var e=Kekule.IsotopesDataUtil._getElementItem(s);return e?e.isotopes:null},getIsotopeInfo:function(s,e){var t=null;if(!e&&typeof s=="string"&&(t=Kekule.IsotopeAliasUtil.getAliasInfo(s)))return t;var n=Kekule.IsotopesDataUtil._getElementItem(s),i=n.isotopes;if(i){if(e)for(var r=0,a=i.length;r<a&&(!(t=i[r])||t.massNumber!=e);++r);else i.length===1&&(t=i[0]);if(t)return t.elementSymbol=n.elementSymbol,t}return null},getIsotopeInfoById:function(s){var e=Kekule.IsotopesDataUtil.getIsotopeIdDetail(s);return Kekule.IsotopesDataUtil.getIsotopeInfo(e.symbol,e.massNumber)},isMassNumberAvailable:function(s,e){return!!Kekule.IsotopesDataUtil.getIsotopeInfo(s,e)},getIsotopeId:function(s,e){if(typeof s!="string"||e){var t=Kekule.IsotopeAliasUtil.getAlias(s,e);if(t)return t}else if(Kekule.IsotopeAliasUtil.getAliasInfo(s))return s;var n=Kekule.ChemicalElementsDataUtil.getElementInfo(s);if(!n)return null;var i=n.symbol;return e?i+e.toString():i},getIsotopeIdDetail:function(s){if(!s)return null;for(var e="",t="",n=0,i=s.length;n<i;++n){var r=s.charAt(n);r>="0"&&r<="9"?t+=r:e+=r}var a=t?parseInt(t,10):null,o={symbol:e};return a&&(o.massNumber=a),o},isIsotopeIdAvailable:function(s){var e=Kekule.IsotopesDataUtil.getIsotopeIdDetail(s);if(Kekule.IsotopeAliasUtil.getAliasInfo(s))return!0;var t=Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(e.symbol);return t&&e.massNum&&(t=!!Kekule.IsotopesDataUtil.getIsotopeInfo(e.symbol,e.massNum)),t}},Kekule.AtomTypeDataUtil={getAtomTypeInfoObj:function(s){var e;e=typeof s=="number"?s:Kekule.ChemicalElementsDataUtil.getAtomicNumber(s);var t=Kekule.structGenAtomTypesData[e-1];if(t&&t.atomicNumber==e)return t;for(var n=0,i=Kekule.structGenAtomTypesData.length;n<i;++n)if((t=Kekule.structGenAtomTypesData[n])&&t.atomicNumber==e)return t;return null},getAllAtomTypes:function(s){var e=Kekule.AtomTypeDataUtil.getAtomTypeInfoObj(s);return e?e.atomTypes:null},getAtomTypeFromId:function(s,e){if(!s){for(var t="",n=0,i=e.length;n<i;++n){var r=e.chatAt(n);(r<"0"||r>"9")&&(t+=r)}s=t}if(s){var a=Kekule.AtomTypeDataUtil.getAllAtomTypes(s);for(n=0,i=a.length;n<i;++n)if(a[n].id==e)return a[n]}return null}};(function(s){s||(s=Kekule.$jsRoot),Kekule.EmscriptenUtils={DEF_MODULE_NAME:"Module",_createdModules:{},_getActualModule:function(t){return s[t||e.DEF_MODULE_NAME]},isSupported:function(t){return e._getActualModule(t)!==void 0},getRootModule:function(t,n){var i=e._createdModules[t];if(i)return i;var r=e._getActualModule(t);return i=r,typeof r=="function"&&(i=r(n)),i&&(e._createdModules[t]=i),i},setRootModule:function(t,n){e._createdModules[t]=n},getModuleObj:function(t){return typeof t=="object"?t:e.getRootModule(t)},getMember:function(t,n){return(e.getModuleObj(n)||{})[t]},getClassCtor:function(t,n){return(e.getModuleObj(n)||{})[t]},cwrap:function(t,n,i,r){var a=e.getModuleObj(r);return a&&a.cwrap&&a.cwrap(t,n,i)},initModule:function(t,n,i){t||(t=Kekule.$jsRoot.document);var r=n.moduleName,a=n.moduleInitEventName,o=n.moduleInitCallbackName,l=n.creationOptions,u=function(d){i&&i(d)};if(e.isModuleReady(r))u();else try{if(a&&t&&Kekule.X){var c=function(){u(),Kekule.X.Event.removeListener(t,a,c)};Kekule.X.Event.addListener(t,a,c)}else o&&(Kekule.$jsRoot[o]=function(){u()});r&&e.getRootModule(r,l)}catch(d){throw u(d),d}},isModuleReady:function(t){return!!e._createdModules[t]},ensureModuleReady:function(t,n,i){return e.initModule(t,n,i)},loadScript:function(t,n,i,r){i||(i=Kekule.$jsRoot.document);var a=function(l){l?n(l):e.initModule(i,r,n)};if(Kekule.environment.isNode)try{var o=Kekule.environment.nodeRequire(t);r.moduleName&&(Kekule.$jsRoot[r.moduleName]=o),a()}catch(l){throw a(l),l}else Kekule.ScriptFileUtils.appendScriptFile(i,t,a)}};var e=Kekule.EmscriptenUtils})(void 0);Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("extra.openbabel"),Kekule.Localization.addResource("en","ErrorMsg",{OpenBabel:{CHEM_NODE_TYPE_NOT_SUITABLE:"Unsuitable node type",CHEM_CONNECTOR_TYPE_NOT_SUITABLE:"Unsuitable connector type",ONLY_STR_INPUT_DATA_ALLOWED:"Input data must be text",ONLY_STR_OUTPUT_DATA_ALLOWED:"Output data must be text",FAIL_TO_GENERATE_3D_STRUCTURE:"Fail to generate 3D structure coordinates"}}),function(){var s=Kekule.EmscriptenUtils,e={usingModulaize:!0,moduleName:"OpenBabelModule",moduleInitEventName:"OpenBabel.Initialized",moduleInitCallbackName:"__$openBabelInitialized$__"};Kekule.OpenBabel={_autoEnabled:!0,_module:null,SCRIPT_FILE:"openbabel.js",_enableFuncs:[],BondOrder:{SINGLE:1,DOUBLE:2,TRIPLE:3,EXPLICIT_AROMATIC:5},getObInitOptions:function(){return e},getModule:function(){return t._module||(t._module=s.getRootModule(e.moduleName,e)),t._module},setModule:function(n){t._module=n,s.setRootModule(e.moduleName,n)},getMember:function(n){return s.getMember(n,t.getModule())},getClassCtor:function(n){return s.getClassCtor(n,t.getModule())},isScriptLoaded:function(){return s.isSupported(e.moduleName)},isModuleReady:function(){return s.isModuleReady(e.moduleName)},enable:function(n){t.isScriptLoaded()?(t._enableAllFunctions(),n&&n()):t.loadObScript(Kekule.$jsRoot.document,function(i){i||t._enableAllFunctions(),n&&n(i)})},_enableAllFunctions:function(){if(t.isModuleReady())for(var n=t._enableFuncs,i=0,r=n.length;i<r;++i){var a=n[i];a&&a()}}};var t=Kekule.OpenBabel;Kekule._registerAfterLoadSysProc(function(){t._autoEnabled&&t.isScriptLoaded()&&s.ensureModuleReady(Kekule.$jsRoot.document,e,t._enableAllFunctions)}),Kekule.OpenBabel.getObPath=function(){var n=Kekule.environment.getEnvVar("openbabel.path");return n||(n=Kekule.isUsingMinJs()?"extra/":"_extras/OpenBabel/",n=Kekule.getScriptPath()+n),n},Kekule.OpenBabel.getObScriptUrl=function(){var n=Kekule.environment.getEnvVar("openbabel.scriptSrc");return n||(n=Kekule.OpenBabel.getObPath()+Kekule.OpenBabel.SCRIPT_FILE,Kekule.isUsingMinJs()||(n+=".dev")),n},Kekule.OpenBabel.loadObScript=function(n,i){n||(n=Kekule.$jsRoot.document);var r=function(o){t._obScriptLoadedBySelf=!o,i&&i(o)};if(t._obScriptLoadedBySelf||t.isScriptLoaded())r();else{var a=Kekule.OpenBabel.getObScriptUrl();s.loadScript(a,r,n,e)}},Kekule.OpenBabel.AdaptUtils={DEF_ATOM_ID_PREFIX:"A",DEF_BOND_ID_PREFIX:"B",DEF_MOL_ID_PREFIX:"M",wrapCFuncs:function(){Kekule.OpenBabel._funcInited||(Object.extend(Kekule.OpenBabel,{}),Kekule.OpenBabel._funcInited=!0)},isAvailable:function(){return t.getClassCtor("ObBaseHelper")!==void 0},obObjToKekule:function(n,i,r){var a=Kekule.OpenBabel.AdaptUtils,o=Kekule.ObjUtils.getPrototypeOf(n).constructor.name;return(o==="OBReaction"?a.obReactionToKekule:o==="OBMol"?a.obMolToKekule:a.obBaseToKekule)(n,i,r)},kObjToOB:function(n,i,r){var a=Kekule.OpenBabel.AdaptUtils,o=n instanceof Kekule.Reaction?a.kReactionToOB:n instanceof Kekule.StructureFragment?a.kMolToOB:null;return o?o(n,i,r):null},kIdToOB:function(n){var i=parseInt(n,10);return i||null},obBondOrderToKekule:function(n){return n<=3?n:n===Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC?Kekule.BondOrder.EXPLICIT_AROMATIC:Kekule.BondOrder.OTHER},kBondOrderToOB:function(n){return n<=3?n:n===Kekule.BondOrder.EXPLICIT_AROMATIC?Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC:0},obBaseToKekule:function(n,i){var r=i||new Kekule.ChemObject,a=new(t.getClassCtor("ObBaseHelper"))(n),o=a.getTitle();o&&r.setName&&r.setName(o);var l=a.getDataSize();if(l)for(var u=r.getInfo(!0),c=0;c<l;++c){var d=a.getDataAt(c);if(d){var h=d.GetAttribute(),p=d.GetValue();h&&p&&(u[h]=p)}}return r},kChemObjToOB:function(n,i){var r=i||new(t.getClassCtor("OBBase"));n.getName&&r.SetTitle&&r.SetTitle(n.getName());var a=n.getInfo();if(a)for(var o=Kekule.ObjUtils.getOwnedFieldNames(a),l=0,u=o.length;l<u;++l){var c=o[l],d=a[c];if(c&&d){var h=new(t.getClassCtor("OBPairData"));h.SetAttribute(""+c),h.SetValue(""+d),r.SetData(h)}}},obAtomToKekule:function(n,i,r){var a=n.GetAtomicNum(),o=a?Kekule.Atom:Kekule.SubGroup;!i||i instanceof o||Kekule.Error(Kekule.$L("ErrorMsg.OpenBabel.CHEM_NODE_TYPE_NOT_SUITABLE"));var l,u=i||new o;return Kekule.OpenBabel.AdaptUtils.obBaseToKekule(n,u),l=n.GetId(),Kekule.ObjUtils.notUnset(l)&&u.setId(Kekule.OpenBabel.AdaptUtils.DEF_ATOM_ID_PREFIX+l),(l=n.GetFormalCharge())&&u.setCharge(l),(l=n.GetSpinMultiplicity())&&u.setRadical(l),l={x:n.GetX(),y:n.GetY()},r===Kekule.CoordMode.COORD3D&&(l.z=n.GetZ()),u.setAbsCoordOfMode?u.setAbsCoordOfMode(l,r):u.setCoordOfMode(l,r),u instanceof Kekule.Atom&&(a&&u.setAtomicNumber(a),(l=n.GetIsotope())&&u.setMassNumber(l),(l=n.GetHyb())&&u.setHybridizationType(l)),u},kChemNodeToOB:function(n,i,r){var a,o=i||new(t.getClassCtor("OBAtom"));if(a=n.getId(),a=Kekule.OpenBabel.AdaptUtils.kIdToOB(a),Kekule.ObjUtils.notUnset(a)&&o.SetId(a),a=n.getCharge())if(parseInt(a,10)===parseFloat(a))o.SetFormalCharge(a);else{var l=parseInt(a,10),u=a-l;o.SetFormalCharge(l),o.SetPartialCharge(u)}if((a=n.getRadical())&&o.SetSpinMultiplicity(a),a=n.getAbsCoordOfMode?n.getAbsCoordOfMode(r):n.getCoordOfMode(r),o.SetVector(a.x||0,a.y||0,a.z||0),n instanceof Kekule.Atom){o.SetAtomicNum(n.getAtomicNumber()),(a=n.getMassNumber())&&o.SetIsotope(a),(a=n.getHybridizationType())&&o.SetHyb(a);var c=n.getImplicitHydrogenCount();c&&o.SetImplicitHCount(c)}else o.SetAtomicNum(0);return o},obBondToKekule:function(n,i,r){var a,o=i||new Kekule.Bond;Kekule.OpenBabel.AdaptUtils.obBaseToKekule(n,o),a=n.GetId(),Kekule.ObjUtils.notUnset(a)&&o.setId(Kekule.OpenBabel.AdaptUtils.DEF_BOND_ID_PREFIX+a),a=n.GetBondOrder(),o.setBondOrder(Kekule.OpenBabel.AdaptUtils.obBondOrderToKekule(a));var l=Kekule.BondStereo;if(a=n.IsWedge()?l.UP:n.IsHash()?l.DOWN:n.IsWedgeOrHash()?l.UP_OR_DOWN:n.IsCisOrTrans()?l.CIS_OR_TRANS:n.IsDoubleBondGeometry()?l.E_Z_BY_COORDINATES:l.NONE,o.setStereo(a),console.log(n.GetFlags().toString(2)),r){a=null;for(var u=[n.GetBeginAtom(),n.GetEndAtom()],c=0,d=u.length;c<d;++c){var h=u[c];h&&(a=r.get(h.GetIdx()))&&o.appendConnectedObj(a)}}return o},kBondToOB:function(n,i,r,a){var o=i||new(t.getClassCtor("OBBond"));Kekule.OpenBabel.AdaptUtils.kChemObjToOB(n,o),h=Kekule.OpenBabel.AdaptUtils.kIdToOB(n.getId()),Kekule.ObjUtils.notUnset(h)&&o.SetId(h),(h=n.getBondOrder())&&(o.SetBondOrder(Kekule.OpenBabel.AdaptUtils.kBondOrderToOB(h)),h===Kekule.BondOrder.EXPLICIT_AROMATIC&&o.SetAromatic()),o.UnsetHash(),o.UnsetWedge(),o.UnsetUp(),o.UnsetDown(),o.UnsetAromatic();var l=Kekule.BondStereo;if((h=n.getStereo())===l.UP?o.SetWedge(!0):h===l.DOWN?o.SetHash(!0):h===l.UP_OR_DOWN&&o.SetWedgeOrHash(!0),r)for(var u=0,c=0,d=n.getConnectedObjCount();c<d;++c){var h,p=n.getConnectedObjAt(c);if(p&&p instanceof Kekule.ChemStructureNode&&((h=r.get(p))&&(u===0?o.SetBegin(h):u===1&&o.SetEnd(h),++u),h.AddBond&&h.AddBond(o),u>1))break}return o},obMolToKekule:function(n,i,r){var a=i,o=new(t.getClassCtor("ObConversionWrapper"));try{o.setOutFormat("","mol");var l=o.writeString(n,!1),u=Kekule.IO.loadFormatData(l,Kekule.IO.DataFormat.MOL);a?a.assign(u):a=u,u.finalize()}finally{o.delete()}if(Kekule.OpenBabel.AdaptUtils.obBaseToKekule(n,a),r){var c;if((c=n.NumAtoms())===a.getNodeCount())for(var d=0;d<c;++d){var h=n.GetAtom(d+1);if(h){var p=a.getNodeAt(d);p&&r.set(h,p)}}if((c=n.NumBonds())===a.getConnectorCount())for(d=0;d<c;++d){var g=n.GetBond(d);if(g){var f=a.getConnectorAt(d);f&&r.set(g,f)}}}return a},kMolToOB:function(n,i,r){var a=n.nodesHasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D,o=i||new(t.getClassCtor("OBMol"));i&&o.Clear();for(var l=new Kekule.MapEx(!1),u=n.getFlattenedShadowFragment(!0),c=0,d=u.getNodeCount();c<d;++c){var h=u.getNodeAt(c);if(h){var p=Kekule.OpenBabel.AdaptUtils.kChemNodeToOB(h,o.NewAtom(),a);if(p&&(l.set(h,p),r)){var g=n.getFlatternedShadowSourceObj(h);r.set(g,p)}}}for(c=0,d=u.getConnectorCount();c<d;++c){var f=u.getConnectorAt(c);if(f&&f instanceof Kekule.Bond){var m=Kekule.OpenBabel.AdaptUtils.kBondToOB(f,o.NewBond(),l,o);if(r&&m){var C=n.getFlatternedShadowSourceObj(f);r.set(C,m)}}}return l.finalize(),l=null,o},obReactionToKekule:function(n,i,r){var a=i||new Kekule.Reaction;a.clearAll(),Kekule.OpenBabel.AdaptUtils.obBaseToKekule(n,a),a.setDirection(n.IsReversible()?Kekule.ReactionDirection.BIDIRECTION:Kekule.ReactionDirection.FORWARD);for(var o=0,l=n.NumReactants();o<l;++o){var u=n.GetReactant(o),c=Kekule.OpenBabel.AdaptUtils.obMolToKekule(u,null,r);a.appendReactant(c),r&&r.set(u,c)}for(o=0,l=n.NumProducts();o<l;++o)u=n.GetProduct(o),c=Kekule.OpenBabel.AdaptUtils.obMolToKekule(u,null,r),a.appendProduct(c),r&&r.set(u,c);return a},kReactionToOB:function(n,i,r){var a=i||new(t.getClassCtor("OBReaction"));a.Clear(),Kekule.OpenBabel.AdaptUtils.kChemObjToOB(n,a);var o=!1,l=n.getDirection();l===Kekule.ReactionDirection.BIDIRECTION?a.SetReversible(!0):l===Kekule.ReactionDirection.BACKWARD&&(o=!0);for(var u=0,c=n.getReactantCount();u<c;++u)if(h=n.getReactantAt(u)){var d=Kekule.OpenBabel.AdaptUtils.kMolToOB(h,null,r);o?a.AddProduct(d):a.AddReactant(d),r&&r.set(h,d)}for(u=0,c=n.getProductCount();u<c;++u){var h;(h=n.getProductAt(u))&&(d=Kekule.OpenBabel.AdaptUtils.kMolToOB(h,null,r),o?a.AddReactant(d):a.AddProduct(d),r&&r.set(h,d))}}}}(),function(){Kekule.EmscriptenUtils;var s=Kekule.OpenBabel,e=Kekule.OpenBabel.AdaptUtils;Kekule.IO.OpenBabelReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.OpenBabelReader",initialize:function(t){this.tryApplySuper("initialize")},finalize:function(){this.tryApplySuper("finalize")},getFormatTargetObClassName:function(t){return t.getTypeName().toLowerCase().indexOf("reaction")>=0?"OBReaction":"OBMol"},doReadData:function(t,n,i){this._obConv=new(s.getClassCtor("ObConversionWrapper"));try{var r=Kekule.IO.DataFormatsManager.getFormatInfo(i),a=(r.mimeType,r.fileExts[0],this._obConv.setInFormatId(r.id)),o=this.getFormatTargetObClassName(a);try{var l=[];this._obConv.setInStr(t);for(var u=new(s.getClassCtor(o)),c=this._obConv.readFromInput(u);c;){if(u.NumAtoms&&u.NumAtoms()>0){var d=e.obObjToKekule(u);l.push(d)}c=this._obConv.readFromInput(u)}var h=l.length;if(h<=0)return null;if(h===1)return l[0];for(var p=new Kekule.ChemObjList,g=0;g<h;++g)p.append(l[g]);return p}finally{u&&(u.delete(),u=null)}}finally{this._obConv&&(this._obConv.delete(),this._obConv=null)}}}),Kekule.IO.OpenBabelWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.OpenBabelWriter",initialize:function(t){this.tryApplySuper("initialize",[t])},finalize:function(){this.tryApplySuper("finalize")},doWriteData:function(t,n,i){this._obConv=new(s.getClassCtor("ObConversionWrapper"));try{var r=Kekule.IO.DataFormatsManager.getFormatInfo(i);r.mimeType,r.fileExts[0],this._obConv.setOutFormatId(r.id);for(var a=Kekule.ChemStructureUtils.getChildStructureObjs(t,!0),o=0,l=a.length;o<l;++o){var u=a[o];if(u){var c=e.kObjToOB(u);if(c)try{if(!this._obConv.writeToOutput(c))break}finally{c.delete(),c=null}}}return this._obConv.getOutStr()}finally{this._obConv&&this._obConv.delete()}},isAllowedObj:function(t){var n=Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(t,n)}}),Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace],Kekule.OpenBabel.IORegHelper=Class.create({listFormatInfo:function(t,n){for(var i=[],r=(t==="in"?n.getSupportedInputFormatsStr(`
`):n.getSupportedOutputFormatsStr(`
`)).split(`
`),a=0,o=r.length;a<o;++a){var l=r[a],u=l.indexOf("--");if(u>0){var c=l.substring(0,u).trim(),d=n.getFormatInfoById(c);i.push(d)}}return i},registerByInfos:function(t,n){for(var i=Kekule.IO.DataFormatsManager,r=[],a=0,o=t.length;a<o;++a){var l=t[a],u=l.id,c=l.mimeType;if((d=i.findFormatId(c))&&(d=i.findFormatId(null,u)),!d)var d=i.register(u,c,u,Kekule.IO.ChemDataType.UNKNOWN,l.description,l.description,{specificationUrl:l.specificationURL}).id;(n==="in"?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(d):Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(d))||Kekule.ArrayUtils.pushUnique(r,d)}r.length&&(n==="in"?Kekule.IO.ChemDataReaderManager.register("openbabel",Kekule.IO.OpenBabelReader,r):Kekule.IO.ChemDataWriterManager.register("openbabel",Kekule.IO.OpenBabelWriter,Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES,r))},registerAll:function(){var t=new(s.getClassCtor("ObConversionWrapper"));try{var n=this.listFormatInfo("in",t);this.registerByInfos(n,"in"),n=this.listFormatInfo("out",t),this.registerByInfos(n,"out")}finally{t.delete()}}}),Kekule.IO.registerAllOpenBabelFormats=function(){if(Kekule.OpenBabel.AdaptUtils.isAvailable())try{var t=new Kekule.OpenBabel.IORegHelper;t.registerAll()}finally{t=null}},Kekule.OpenBabel._enableFuncs.push(Kekule.IO.registerAllOpenBabelFormats),Kekule.IO.enableOpenBabelFormats=function(){Kekule.OpenBabel.AdaptUtils.isAvailable()?Kekule.IO.registerAllOpenBabelFormats():Kekule.OpenBabel.loadObScript(document,function(){Kekule.IO.registerAllOpenBabelFormats()})}}(),function(){Kekule.EmscriptenUtils;var s=Kekule.OpenBabel,e=Kekule.OpenBabel.AdaptUtils;Kekule.OpenBabel.StructUtils={generate2DStructure:function(t,n,i){var r=n||{};try{var a=new Kekule.MapEx,o=new Kekule.MapEx,l=e.kObjToOB(t,null,a);if(Kekule.OpenBabel.StructUtils._gen2DByObOperation(l,r)||(l.delete(),l=null),l){if(t=e.obObjToKekule(l,null,o),i)for(var u=a.getKeys(),c=0,d=u.length;c<d;++c){var h=u[c],p=a.get(h);if(p){var g=o.get(p);g&&i.set(h,g)}}}else Kekule.raise(Kekule.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{l&&l.delete()}return t},generate3DStructure:function(t,n,i){var r,a=n||{},o=a.forceField;try{var l=new Kekule.MapEx,u=new Kekule.MapEx,c=e.kObjToOB(t,null,l);if(a.applyFFCalc){var d=new(s.getClassCtor("OB3DGenWrapper"));try{d.generate3DStructure(c,o||"")}finally{d.delete()}}else Kekule.OpenBabel.StructUtils._gen3DByObOperation(c,a)||(c.delete(),c=null);if(c){if(r=e.obObjToKekule(c,null,u),i)for(var h=l.getKeys(),p=0,g=h.length;p<g;++p){var f=h[p],m=l.get(f);if(m){var C=u.get(m);C&&i.set(f,C)}}}else Kekule.raise(Kekule.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{c&&c.delete()}return r},_gen2DByObOperation:function(t,n){var i=!1,r=s.getModule().OBOp.FindType("Gen2D");if(r){var a=""+n.speed||"";r.Do(t,a),i=!0}return i},_gen3DByObOperation:function(t,n){var i=""+n.speed||"",r=!1,a=s.getModule().OBOp.FindType("Gen3D");return a&&(a.Do(t,i),r=!0),r}},Kekule.Calculator&&(Kekule.Calculator.ObStructureBaseGenerator=Class.create(Kekule.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructureBaseGenerator",isWorkerShared:function(){return!0},getGeneratorCoordMode:function(){return this.getOutputDimension()===2?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D},getOutputDimension:function(){return 3},_getInputMsgName:function(){return"gen"+this.getOutputDimension()+"D"},_getOutputMsgName:function(){return"output"+this.getOutputDimension()+"D"},getObInitOptions:function(){return Kekule.OpenBabel.getObInitOptions()},getForceField:function(){return this.getOptions().forceField},doGetWorker:function(){var t=this.tryApplySuper("doGetWorker");return t||(t=Kekule.Calculator.ObStructureBaseGenerator._worker),t},_requestImportingObScriptInWorker:function(){var t=Kekule.OpenBabel.getObScriptUrl();this.importWorkerScriptFile(t)},createWorker:function(){var t=this.tryApplySuper("createWorker");if(t){this._requestImportingObScriptInWorker();var n=this.getObInitOptions();this.postWorkerMessage({type:"obInit",usingModulaize:n.usingModulaize,moduleName:n.moduleName,initCallbackName:n.moduleInitCallbackName}),Kekule.Calculator.ObStructureBaseGenerator._worker=t}return t},getWorkerScriptFile:function(){return Kekule.OpenBabel.getObPath()+"kekule.worker.obStructureGenerator.js"},doReactWorkerMessage:function(t,n){if(this.tryApplySuper("doReactWorkerMessage",[t,n]),t.type===this._getOutputMsgName()){var i=t.molData;if(i){var r=Kekule.IO.loadMimeData(i,"chemical/x-mdl-molfile"),a=this.getChildObjMap();if(a){for(var o=this.getSourceMol().getFlattenedShadowFragment(!0),l=0,u=o.getNodeCount();l<u;++l)a.set(o.getNodeAt(l),r.getNodeAt(l));for(l=0,u=o.getConnectorCount();l<u;++l)a.set(o.getConnectorAt(l),r.getConnectorAt(l))}this.setGeneratedMol(r),this.done()}}},workerStartCalc:function(t){this._requestImportingObScriptInWorker();var n=this.getSourceMol().getFlattenedShadowFragment(!0),i=Kekule.IO.saveMimeData(n,"chemical/x-mdl-molfile"),r=Object.extend(this.getOptions(),{type:this._getInputMsgName(),molData:i});this.postWorkerMessage(r)},doExecuteSync:function(t){if(Kekule.OpenBabel){var n=this;Kekule.OpenBabel.loadObScript(null,function(){var i;try{var r=(n.getOutputDimension()===2?Kekule.OpenBabel.StructUtils.generate2DStructure:Kekule.OpenBabel.StructUtils.generate3DStructure)(n.getSourceMol(),n.getOptions());n.setGeneratedMol(r)}catch(a){throw i=a,a}return i||n.done(),t&&t(i),!0})}else Kekule.error(Kekule.$L("ErrorMsg.MODULE_NOT_LOADED").format("OpenBabel"));return!1}}),Kekule.Calculator.ObStructure3DGenerator=Class.create(Kekule.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure3DGenerator",getOutputDimension:function(){return 3}}),Kekule.Calculator.ObStructure2DGenerator=Class.create(Kekule.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure2DGenerator",getOutputDimension:function(){return 2}}),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN3D,Kekule.Calculator.ObStructure3DGenerator,"openbabel",10),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN2D,Kekule.Calculator.ObStructure2DGenerator,"openbabel",10))}();(function(s){var e=Kekule.$jsRoot||s||{},t=Kekule.EmscriptenUtils,n={usingModulaize:!0,moduleName:"IndigoModule",moduleInitEventName:"Indigo.Initialized",moduleInitCallbackName:"__$indigoInitialized$__",indigoAdaptFuncName:"CreateIndigo"};Kekule.Indigo={_autoEnabled:!0,_module:null,_indigo:null,SCRIPT_FILE:"indigo.js",HELPER_SCRIPT_FILE:"indigoAdapter.js",_enableFuncs:[],isScriptLoaded:function(){return t.isSupported(n.moduleName)&&e[n.indigoAdaptFuncName]!==void 0},getIndigoInitOptions:function(){return n},getModule:function(){return i._module||(i._module=t.getRootModule(n.moduleName,n)),i._module},setModule:function(r){i._module=r,t.setRootModule(n.moduleName,r)},getIndigo:function(){if(!i._indigo){var r=i.getModule();r&&(i._indigo=e[n.indigoAdaptFuncName](r))}return i._indigo},getClassCtor:function(r){return t.getClassCtor(r,i.getModule())},isAvailable:function(){return i.getModule()&&i.getIndigo()},enable:function(r){i.isScriptLoaded()?(i._enableAllFunctions(),r&&r()):i.loadIndigoScript(Kekule.$jsRoot.document,function(a){a||i._enableAllFunctions(),r&&r(a)})},_enableAllFunctions:function(){if(t.isModuleReady(n.moduleName))for(var r=i._enableFuncs,a=0,o=r.length;a<o;++a){var l=r[a];l&&l()}}},Kekule.Indigo.getIndigoPath=function(){var r=Kekule.environment.getEnvVar("indigo.path");return r||(r=Kekule.isUsingMinJs()?"extra/":"_extras/Indigo/",r=Kekule.getScriptPath()+r),r},Kekule.Indigo.getIndigoScriptUrl=function(){var r=Kekule.environment.getEnvVar("indigo.scriptSrc");return r||(r=i.getIndigoPath()+i.SCRIPT_FILE,Kekule.isUsingMinJs()||(r+=".dev")),r},Kekule.Indigo.getIndigoHelperScriptUrl=function(){return i.getIndigoPath()+i.HELPER_SCRIPT_FILE},Kekule.Indigo.loadIndigoScript=function(r,a){r||(r=Kekule.$jsRoot.document);var o=function(u){i._scriptLoadedBySelf=!u,u||Kekule.Indigo.getIndigo(),a&&a(u)};if(i._scriptLoadedBySelf||i.isScriptLoaded())o();else{var l=i.getIndigoScriptUrl();t.loadScript(l,function(u){u?o(u):Kekule.ScriptFileUtils.appendScriptFiles(r,[i.getIndigoHelperScriptUrl()],o)},r,n)}};var i=Kekule.Indigo;Kekule.Indigo.AdaptUtils={iMolToKekule:function(r){var a=i.getIndigo(),o=a.molfile(r);return a.free(r),Kekule.IO.loadFormatData(o,Kekule.IO.DataFormat.MOL)},kMolToIndigo:function(r){var a=i.getIndigo(),o=Kekule.IO.saveFormatData(r,Kekule.IO.DataFormat.MOL);return a.loadMoleculeFromString(o)}},Kekule._registerAfterLoadSysProc(function(){i._autoEnabled&&i.isScriptLoaded()&&t.ensureModuleReady(Kekule.$jsRoot.document,n,i._enableAllFunctions)})})(void 0),function(){Kekule.EmscriptenUtils;var s=Kekule.Indigo;Kekule.IO.IndigoReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.IndigoReader",doReadData:function(e,t,n,i){var r=s.getIndigo(),a=r.loadMoleculeFromString(e);if(a>=0){n===Kekule.IO.DataFormat.SMILES&&(!i||i.autoLayout||Kekule.ObjUtils.isUnset(i.autoLayout));var o=r.molfile(a);return r.free(a),Kekule.IO.loadFormatData(o,Kekule.IO.DataFormat.MOL)}return null}}),Kekule.IO.registerAllIndigoFormats=function(){s.isAvailable()&&Kekule.IO.ChemDataReaderManager.register("Indigo-smiles",Kekule.IO.IndigoReader,Kekule.IO.DataFormat.SMILES)},Kekule.IO.enableIndigoFormats=function(){s.isAvailable()?Kekule.IO.registerAllIndigoFormats():s.loadIndigoScript(document,function(){Kekule.IO.registerAllIndigoFormats()})},s._enableFuncs.push(Kekule.IO.registerAllIndigoFormats)}(),function(){var s=Kekule.Indigo;Kekule.Indigo.StructUtils={generate2DStructure:function(e,t,n){var i=s.getIndigo(),r=s.AdaptUtils.kMolToIndigo(e);return i.setOption("smart-layout","true"),i.layout(r),s.AdaptUtils.iMolToKekule(r)}},Kekule.Calculator&&(Kekule.Calculator.IndigoStructure2DGenerator=Class.create(Kekule.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.IndigoStructure2DGenerator",execute:function(e){var t,n;try{n=this.executeSync(e)}catch(i){t=i}t?(Kekule.error(t),this.error(t)):n&&(t?this.error(t):this.done())},doExecuteSync:function(e){if(Kekule.Indigo){var t=this;Kekule.Indigo.loadIndigoScript(null,function(){var n;try{var i=Kekule.Indigo.StructUtils.generate2DStructure(t.getSourceMol(),t.getOptions());t.setGeneratedMol(i)}catch(r){n=r}n||t.done(),e&&e(n)})}else Kekule.error(Kekule.$L("ErrorMsg.MODULE_NOT_LOADED").format("Indigo"));return!1}}),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN2D,Kekule.Calculator.IndigoStructure2DGenerator,"indigo",0))}();(function(){var s=Kekule.EmscriptenUtils,e={usingModulaize:!0,moduleName:"InChIModule",moduleInitEventName:"InChI.Initialized",moduleInitCallbackName:"__$inChIInitialized$__"};Kekule.InChI={_autoEnabled:!0,_scriptLoadedBySelf:!1,_module:null,_enableFuncs:[],SCRIPT_FILE:"inchi.js",isScriptLoaded:function(){return s.isSupported(e.moduleName)},getInchiInitOptions:function(){return e},getModule:function(){return t._module||(t._module=s.getRootModule(e.moduleName,e)),t._module},setModule:function(n){t._module=n,s.setRootModule(e.moduleName,n)},getInChIPath:function(){var n=Kekule.environment.getEnvVar("inchi.path");return n||(n=Kekule.isUsingMinJs()?"extra/":"_extras/InChI/",n=Kekule.getScriptPath()+n),n},getInChIScriptUrl:function(){var n=Kekule.environment.getEnvVar("inchi.scriptSrc");return n||(n=t.getInChIPath()+t.SCRIPT_FILE,Kekule.isUsingMinJs()||(n+=".dev")),n},loadInChIScript:function(n,i){n||(n=Kekule.$jsRoot.document);var r=function(o){t._scriptLoadedBySelf=!o,i&&i(o)};if(t._scriptLoadedBySelf||t.isScriptLoaded())r();else{var a=t.getInChIScriptUrl();s.loadScript(a,r,n,e)}},molDataToInChI:function(n,i){var r=t._molToInChI;r||(r=t.getModule().cwrap("molToInchiJson","string",["string","string"]));var a=r(n,i);return JSON.parse(a)},getInChIKeyFromInChI:function(n,i,r){var a=t._getInChIKeyFromInChI;a||(a=t.getModule().cwrap("getInChIKeyJson","string",["string","number","number"]));var o=a(n,i,r);return JSON.parse(o)},getInChIInfo:function(n){var i=Kekule.IO.saveFormatData(n,Kekule.IO.DataFormat.MOL);return t.molDataToInChI(i)},enable:function(n){t.isScriptLoaded()?(t._enableAllFunctions(),n&&n()):t.loadInChIScript(Kekule.$jsRoot.document,function(i){i||t._enableAllFunctions(),n&&n(i)})},_enableAllFunctions:function(){if(s.isModuleReady(e.moduleName))for(var n=t._enableFuncs,i=0,r=n.length;i<r;++i){var a=n[i];a&&a()}}};var t=Kekule.InChI;Kekule.IO.InChIWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.InChIWriter",doWriteData:function(n,i,r){var a=t.getInChIInfo(n);if(a&&a.inchi){var o=a.inchi;a.auxInfo&&(o+=`
`+a.auxInfo);var l=t.getInChIKeyFromInChI(a.inchi,1,1);return o+=`
`+JSON.stringify(l)}return null},isAllowedObj:function(n){var i=Kekule.IO.InChIWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(n,i)}}),Kekule.IO.InChIWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace],Kekule.IO.registerAllInChIFormats=function(){t.isScriptLoaded()&&(Kekule.IO.DataFormat.INCHI="inchi",Kekule.IO.MimeType.INCHI="chemical/x-inchi",Kekule.IO.DataFormatsManager.register("inchi",Kekule.IO.MimeType.INCHI,"inchi",Kekule.IO.ChemDataType.TEXT,"InChI format"),Kekule.IO.ChemDataWriterManager.register("inchi",Kekule.IO.InChIWriter,Kekule.IO.InChIWriter.ALLOWED_CLASSES,"inchi"))},Kekule.IO.enableInChIFormats=function(){t.enable()},t._enableFuncs.push(Kekule.IO.registerAllInChIFormats),Kekule._registerAfterLoadSysProc(function(){t._autoEnabled&&t.isScriptLoaded()&&s.ensureModuleReady(Kekule.$jsRoot.document,e,t._enableAllFunctions)})})();let{Kekule:ve,Class:XD,ClassEx:JD,ObjectEx:qD,DataType:ZD}=Uv();ve.scriptSrcInfo.modules||(ve.scriptSrcInfo.modules=[]);ve.ArrayUtils.pushUnique(ve.scriptSrcInfo.modules,["lan","root","localization","localizationData","localizationData.zh","common","core","html","io","render","spectroscopy","widget","chemWidget","webComponent","algorithm","calculation","data","emscripten","openbabel","indigo","inchi"]);typeof ve<"u"&&ve._loaded();function Jv(s,e,t){var n=t||new Kekule.Molecule,i=new s.ObBaseHelper(e),r=i.getTitle();r&&n.setName&&n.setName(r);var a=i.getDataSize();if(a)for(var o=n.getInfo(!0),l=0;l<a;++l){var u=i.getDataAt(l);if(u){var c=u.GetAttribute(),d=u.GetValue();c&&d&&(o[c]=d)}}return n}function xp(s,e,t,n){var i=t,r=new s.ObConversionWrapper;try{r.setOutFormat("","mol");var a=r.writeString(e,!1),o=Kekule.IO.loadFormatData(a,"mol");i?i.assign(o):i=o,o.finalize()}finally{r.delete()}return Jv(s,e,i),i}function qv(s,e,t=!1){var n="",i=new s.ObConversionWrapper;try{i.setOutFormat("","can"),t&&i.addOption("h",s.ObConversion_Option_type.OUTOPTIONS,"");var r=i.writeString(e,!1);n=r;const a=r.split("	");a.length>1&&(n=a[0])}finally{i.delete()}return n}function Zv(s,e){var t="",n=new s.ObConversionWrapper;try{n.setOutFormat("","inchi");var i=n.writeString(e,!1);t=i}finally{n.delete()}return t}function Qv(s,e){let t=e.reduce((n,i)=>{let r=Math.sqrt(Math.pow(i.coord2D.x-s.coord2D.x,2)+Math.pow(i.coord2D.y-s.coord2D.y,2));return n+r},0);return t/=e.length,t}function is(s,e){return Math.atan2(-(e.coord2D.y-s.coord2D.y),e.coord2D.x-s.coord2D.x)}const Jf=-19.5/360*Math.PI*2,ns=Math.cos(Jf),os=Math.sin(Jf),qf=Math.PI/2,as=Math.cos(qf),ss=Math.sin(qf),Zf=-150/360*Math.PI*2,Kn=Math.cos(Zf),wn=Math.sin(Zf),Qf=-180/360*Math.PI*2,Bn=Math.cos(Qf),Un=Math.sin(Qf),ek=0,tk=160/360*Math.PI*2,rk=-160/360*Math.PI*2,ik=Math.PI/2,nk=-Math.PI/2,ok=Math.PI/2,ak=30/360*Math.PI*2,sk=-30/360*Math.PI*2,lk=-Math.PI/2,uk=150/360*Math.PI*2,ck=-150/360*Math.PI*2;function ei(s){return{x:Math.cos(s),y:Math.sin(s)}}function yu(s,e=!1,t=!1){let n=[];return t&&n.push(ei(ok+s)),n.push(ei(ak+s)),n.push(ei(sk+s)),n.push(ei(lk+s)),n.push(ei(uk+s)),n.push(ei(ck+s)),n}function ls(s,e=!1,t=!1){let n=[];return t&&n.push(ei(nk+s)),n.push(ei(ik+s)),n.push(ei(ek+s)),n.push(ei(tk+s)),n.push(ei(rk+s)),n}function bi(s,e=!1,t=!1){let n=[];if(!e)s>0&&s<Math.PI*3/8?(t&&n.push({x:ns,y:-os}),n.push({x:as,y:-ss}),n.push({x:Kn,y:-wn}),n.push({x:Bn,y:-Un})):s>=Math.PI*3/8&&s<Math.PI*5/8?(n.push({x:ns,y:os}),n.push({x:Kn,y:wn}),n.push({x:Bn,y:Un})):s>=Math.PI*5/8&&s<=Math.PI?(n.push({x:-as,y:-ss}),n.push({x:-Kn,y:-wn}),n.push({x:-Bn,y:-Un})):s<=0&&s>=-Math.PI*3/8?(t&&n.push({x:ns,y:os}),n.push({x:as,y:ss}),n.push({x:Kn,y:wn}),n.push({x:Bn,y:Un})):s<-Math.PI*3/8&&s>=-Math.PI*5/8?(n.push({x:ns,y:-os}),n.push({x:Kn,y:-wn}),n.push({x:Bn,y:-Un})):s<-Math.PI*5/8&&s>=-Math.PI&&(n.push({x:-as,y:ss}),n.push({x:-Kn,y:wn}),n.push({x:-Bn,y:Un}));else{t&&n.push({x:Math.cos(s),y:Math.sin(s)});let i=s+Math.PI/2;n.push({x:Math.cos(i),y:Math.sin(i)}),i+=Math.PI/2,n.push({x:Math.cos(i),y:Math.sin(i)}),i+=Math.PI/2,n.push({x:Math.cos(i),y:Math.sin(i)})}return n}function rt(s,e,t){return{x:s.coord2D.x+e.x*t,y:-e.y*t+s.coord2D.y}}function em(s,e,t={useFlat:!0,showFormalCharges:!0}){const n=t.useFlat;t.showFormalCharges;for(let i=0;i<e.length;i++){let r=e[i],a=r.getLinkedChemNodes(!1).sort((p,g)=>p.getLinkedChemNodes().length-g.getLinkedChemNodes().length),o=r.getMarkerCount(),l=r.getLinkedBonds(),u=a.filter(p=>e.includes(p)),c=a.filter(p=>!e.includes(p)),d=e[i].getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet,!1),h=Qv(r,a);if(a.length==4&&o==0){if(e.length==1){let p=bi(0,n,!0);if(a[0].coord2D={x:r.coord2D.x+p[0].x*h,y:-p[0].y*h+r.coord2D.y},a[1].coord2D={x:r.coord2D.x+p[1].x*h,y:-p[1].y*h+r.coord2D.y},a[2].coord2D={x:r.coord2D.x+p[2].x*h,y:-p[2].y*h+r.coord2D.y},a[3].coord2D={x:r.coord2D.x+p[3].x*h,y:-p[3].y*h+r.coord2D.y},!n){let g=a[2].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(f[0].stereo=Kekule.BondStereo.UP),g=a[3].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN)}}else if(u.length==1){let p=is(r,u[0]),g=bi(p,n);if(c[0].coord2D={x:r.coord2D.x+g[0].x*h,y:-g[0].y*h+r.coord2D.y},c[1].coord2D={x:r.coord2D.x+g[1].x*h,y:-g[1].y*h+r.coord2D.y},c[2].coord2D={x:r.coord2D.x+g[2].x*h,y:-g[2].y*h+r.coord2D.y},!n){let f=c[1].getLinkedBonds(),m=l.filter(C=>f.includes(C));m.length==1&&(m[0].stereo=Kekule.BondStereo.UP),f=c[2].getLinkedBonds(),m=l.filter(C=>f.includes(C)),m.length==1&&(m[0].stereo=Kekule.BondStereo.DOWN)}}else if(!n)for(let p=0;p<c.length;p++){let g=c[p].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(p==0?f[0].stereo=Kekule.BondStereo.UP:f[0].stereo=Kekule.BondStereo.DOWN)}}else if(a.length==3&&o==1){if(e.length==1){let p=bi(0,n,!0);if(a[0].coord2D={x:r.coord2D.x+p[0].x*h,y:-p[0].y*h+r.coord2D.y},a[1].coord2D={x:r.coord2D.x+p[2].x*h,y:-p[2].y*h+r.coord2D.y},a[2].coord2D={x:r.coord2D.x+p[3].x*h,y:-p[3].y*h+r.coord2D.y},d[0].coord2D={x:p[1].x,y:-p[1].y},!n){let g=a[1].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(f[0].stereo=Kekule.BondStereo.UP),g=a[2].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN)}}else if(u.length==1){let p=is(r,u[0]),g=bi(p,n,!1);if(c[0].coord2D={x:r.coord2D.x+g[1].x*h,y:-g[1].y*h+r.coord2D.y},c[1].coord2D={x:r.coord2D.x+g[2].x*h,y:-g[2].y*h+r.coord2D.y},d[0].coord2D={x:g[0].x,y:-g[0].y},!n){let f=a[0].getLinkedBonds(),m=l.filter(C=>f.includes(C));m.length==1&&(m[0].stereo=Kekule.BondStereo.UP),f=a[1].getLinkedBonds(),m=l.filter(C=>f.includes(C)),m.length==1&&(m[0].stereo=Kekule.BondStereo.DOWN)}}else if(!n)for(let p=0;p<c.length;p++){let g=c[p].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(p==0?f[0].stereo=Kekule.BondStereo.UP:f[0].stereo=Kekule.BondStereo.DOWN)}}else if(a.length==2&&o==2){if(e.length==1){let p=bi(0,n,!0);a[0].coord2D={x:r.coord2D.x+p[0].x*h,y:-p[0].y*h+r.coord2D.y},a[1].coord2D={x:r.coord2D.x+p[1].x*h,y:-p[1].y*h+r.coord2D.y}}else if(u.length==1){let p=is(r,u[0]),g=bi(p,n,!1);c[0].coord2D={x:r.coord2D.x+g[0].x*h,y:-g[0].y*h+r.coord2D.y},d[0].coord2D={x:g[1].x,y:-g[1].y},d[1].coord2D={x:g[2].x,y:-g[2].y}}}else if(a.length==1&&o==3){let p=bi(0,n,!0);a[0].coord2D={x:r.coord2D.x+p[0].x*h,y:-p[0].y*h+r.coord2D.y};let g=e[i].getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet,!1);g[0].coord2D={x:p[1].x,y:-p[1].y},g[1].coord2D={x:p[2].x,y:-p[2].y},g[2].coord2D={x:p[3].x,y:-p[3].y}}else if(!(a.length==3&&o==0)){if(a.length==2&&o==1){if(e.length==1)bi(0,n,!0);else if(u.length==1){let p=is(r,u[0]),g=bi(p,n,!1);c[0].coord2D={x:r.coord2D.x+g[0].x*h,y:-g[0].y*h+r.coord2D.y},d[0].coord2D={x:g[1].x,y:-g[1].y}}}else if(a.length==5&&o==0){if(!n){let p=ls(0,n,!0);a[0].coord2D=rt(r,p[0],h),a[1].coord2D=rt(r,p[1],h),a[2].coord2D=rt(r,p[2],h),a[3].coord2D=rt(r,p[3],h),a[4].coord2D=rt(r,p[4],h);let g=a[3].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(f[0].stereo=Kekule.BondStereo.UP),g=a[4].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN)}}else if(a.length==4&&o==1){if(!n){let p=ls(0,n,!0);a[0].coord2D=rt(r,p[0],h),a[1].coord2D=rt(r,p[1],h),a[2].coord2D=rt(r,p[3],h),a[3].coord2D=rt(r,p[4],h),d[0].coord2D=rt(r,p[2],h);let g=a[2].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(f[0].stereo=Kekule.BondStereo.UP),g=a[3].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN)}}else if(a.length==3&&o==2){if(!n){let p=ls(0,n,!0);a[0].coord2D=rt(r,p[0],h),a[1].coord2D=rt(r,p[1],h),a[2].coord2D=rt(r,p[2],h),d[0].coord2D=rt(r,p[3],h),d[1].coord2D=rt(r,p[4],h)}}else if(a.length==2&&o==3){if(!n){let p=ls(0,n,!0);a[0].coord2D=rt(r,p[0],h),a[1].coord2D=rt(r,p[1],h),d[2].coord2D=rt(r,p[2],h),d[0].coord2D=rt(r,p[3],h),d[1].coord2D=rt(r,p[4],h)}}else if(a.length==6&&o==0){if(!n){let p=yu(0,n,!0);a[0].coord2D=rt(r,p[0],h),a[1].coord2D=rt(r,p[1],h),a[2].coord2D=rt(r,p[2],h),a[3].coord2D=rt(r,p[3],h),a[4].coord2D=rt(r,p[4],h),a[5].coord2D=rt(r,p[5],h);let g=a[1].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN),g=a[2].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.UP),g=a[4].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN),g=a[5].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.UP)}}else if(a.length==5&&o==1){if(!n){let p=yu(0,n,!0);a[0].coord2D=rt(r,p[0],h),a[1].coord2D=rt(r,p[1],h),a[2].coord2D=rt(r,p[2],h),a[3].coord2D=rt(r,p[4],h),a[4].coord2D=rt(r,p[5],h),d[0].coord2D=rt(r,p[3],h);let g=a[1].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN),g=a[2].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.UP),g=a[3].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN),g=a[4].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.UP)}}else if(a.length==4&&o==2&&!n){let p=yu(0,n,!0);a[0].coord2D=rt(r,p[1],h),a[1].coord2D=rt(r,p[2],h),a[2].coord2D=rt(r,p[4],h),a[3].coord2D=rt(r,p[5],h),d[0].coord2D=rt(r,p[0],h),d[0].coord2D=rt(r,p[3],h);let g=a[0].getLinkedBonds(),f=l.filter(m=>g.includes(m));f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN),g=a[1].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.UP),g=a[2].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.DOWN),g=a[3].getLinkedBonds(),f=l.filter(m=>g.includes(m)),f.length==1&&(f[0].stereo=Kekule.BondStereo.UP)}}}}function dk(s,e={useFlat:!0,showFormalCharges:!0}){e.useFlat;const t=e.showFormalCharges,n=[],i=[],r=[];for(let a=0;a<s.getNodeCount();a++){let o=s.getNodeAt(a);if(o.symbol=="A"){const l=o.linkedSiblings[0],u=o.getLinkedConnectorAt(0);let c=new Kekule.ChemMarker.UnbondedElectronSet;l.appendMarker(c),i.push(o),r.push(u)}if(t&&o.charge!=0){let l=new Kekule.ChemMarker.Charge;l.value=o.charge,o.appendMarker(l)}}i.forEach(a=>s.removeNode(a)),r.forEach(a=>s.removeConnector(a));for(let a=0;a<s.getNodeCount();a++){let o=s.getNodeAt(a);o.linkedSiblings.length>1&&n.push(o)}em(s,n,e)}function Bi(s,e={useFlat:!0,showFormalCharges:!0}){e.useFlat;const t=e.showFormalCharges,n=[];for(let i=0;i<s.getNodeCount();i++){let r=s.getNodeAt(i);r.getLinkedChemNodes(!1).length>1&&n.push(r);let l=r.getLinkedBonds().reduce((h,p)=>h+p.bondOrder,0),u=new Kekule.Element(r.symbol),c=0;switch(u.group){case 1:c=1;break;case 2:c=2;break;case 13:c=3;break;case 14:c=4;break;case 15:c=5;break;case 16:c=6;break;case 17:c=7;break;case 18:c=8;break;default:c=0;break}let d=(c-r.charge-l)/2;for(let h=0;h<d;h++){let p=new Kekule.ChemMarker.UnbondedElectronSet;r.appendMarker(p)}if(t&&r.charge!=0){let h=new Kekule.ChemMarker.Charge;h.value=r.charge,r.appendMarker(h)}}em(s,n,e)}const zu={},tm=[];function Qe(s,e){if(Array.isArray(s)){for(const t of s)Qe(t,e);return}if(typeof s=="object"){for(const t in s)Qe(t,s[t]);return}rm(Object.getOwnPropertyNames(e)),zu[s]=Object.assign(zu[s]||{},e)}function kr(s){return zu[s]||{}}function hk(){return[...new Set(tm)]}function rm(s){tm.push(...s)}function Ol(s,e){let t;const n=s.length,i=[];for(t=0;t<n;t++)i.push(e(s[t]));return i}function im(s,e){let t;const n=s.length,i=[];for(t=0;t<n;t++)e(s[t])&&i.push(s[t]);return i}function ms(s){return s%360*Math.PI/180}function pk(s){return s*180/Math.PI%360}function jo(s){return s.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function nm(s){return s.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})}function jc(s){return s.charAt(0).toUpperCase()+s.slice(1)}function vn(s,e,t,n){return(e==null||t==null)&&(n=n||s.bbox(),e==null?e=n.width/n.height*t:t==null&&(t=n.height/n.width*e)),{width:e,height:t}}function ws(s,e){const t=s.origin;let n=s.ox!=null?s.ox:s.originX!=null?s.originX:"center",i=s.oy!=null?s.oy:s.originY!=null?s.originY:"center";t!=null&&([n,i]=Array.isArray(t)?t:typeof t=="object"?[t.x,t.y]:[t,t]);const r=typeof n=="string",a=typeof i=="string";if(r||a){const{height:o,width:l,x:u,y:c}=e.bbox();r&&(n=n.includes("left")?u:n.includes("right")?u+l:u+l/2),a&&(i=i.includes("top")?c:i.includes("bottom")?c+o:c+o/2)}return[n,i]}var bl={__proto__:null,map:Ol,filter:im,radians:ms,degrees:pk,camelCase:jo,unCamelCase:nm,capitalize:jc,proportionalSize:vn,getOrigin:ws};const vl="http://www.w3.org/2000/svg",om="http://www.w3.org/1999/xhtml",Wo="http://www.w3.org/2000/xmlns/",po="http://www.w3.org/1999/xlink",am="http://svgjs.dev/svgjs";var gk={__proto__:null,svg:vl,html:om,xmlns:Wo,xlink:po,svgjs:am};const mt={window:typeof window>"u"?null:window,document:typeof document>"u"?null:document};class Wc{}const pn={},Hc="___SYMBOL___ROOT___";function la(s,e=vl){return mt.document.createElementNS(e,s)}function Cr(s,e=!1){if(s instanceof Wc)return s;if(typeof s=="object")return Au(s);if(s==null)return new pn[Hc];if(typeof s=="string"&&s.charAt(0)!=="<")return Au(mt.document.querySelector(s));const t=e?mt.document.createElement("div"):la("svg");return t.innerHTML=s,s=Au(t.firstChild),t.removeChild(t.firstChild),s}function Dt(s,e){return e&&e.ownerDocument&&e instanceof e.ownerDocument.defaultView.Node?e:la(s)}function $r(s){if(!s)return null;if(s.instance instanceof Wc)return s.instance;if(s.nodeName==="#document-fragment")return new pn.Fragment(s);let e=jc(s.nodeName||"Dom");return e==="LinearGradient"||e==="RadialGradient"?e="Gradient":pn[e]||(e="Dom"),new pn[e](s)}let Au=$r;function ct(s,e=s.name,t=!1){return pn[e]=s,t&&(pn[Hc]=s),rm(Object.getOwnPropertyNames(s.prototype)),s}function fk(s){return pn[s]}let mk=1e3;function sm(s){return"Svgjs"+jc(s)+mk++}function lm(s){for(let e=s.children.length-1;e>=0;e--)lm(s.children[e]);return s.id&&(s.id=sm(s.nodeName)),s}function Ye(s,e){let t,n;for(s=Array.isArray(s)?s:[s],n=s.length-1;n>=0;n--)for(t in e)s[n].prototype[t]=e[t]}function It(s){return function(...e){const t=e[e.length-1];return t&&t.constructor===Object&&!(t instanceof Array)?s.apply(this,e.slice(0,-1)).attr(t):s.apply(this,e)}}function Ck(){return this.parent().children()}function _k(){return this.parent().index(this)}function yk(){return this.siblings()[this.position()+1]}function Ak(){return this.siblings()[this.position()-1]}function Tk(){const s=this.position();return this.parent().add(this.remove(),s+1),this}function Ek(){const s=this.position();return this.parent().add(this.remove(),s?s-1:0),this}function Sk(){return this.parent().add(this.remove()),this}function Ok(){return this.parent().add(this.remove(),0),this}function bk(s){s=Cr(s),s.remove();const e=this.position();return this.parent().add(s,e),this}function vk(s){s=Cr(s),s.remove();const e=this.position();return this.parent().add(s,e+1),this}function kk(s){return s=Cr(s),s.before(this),this}function Ik(s){return s=Cr(s),s.after(this),this}Qe("Dom",{siblings:Ck,position:_k,next:yk,prev:Ak,forward:Tk,backward:Ek,front:Sk,back:Ok,before:bk,after:vk,insertBefore:kk,insertAfter:Ik});const um=/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,Dk=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Rk=/rgb\((\d+),(\d+),(\d+)\)/,Pk=/(#[a-z_][a-z0-9\-_]*)/i,Nk=/\)\s*,?\s*/,Mk=/\s/g,Lp=/^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i,Kp=/^rgb\(/,wp=/^(\s+)?$/,Bp=/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,xk=/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,Mi=/[\s,]+/,Gc=/[MLHVCSQTAZ]/i;function Lk(){const s=this.attr("class");return s==null?[]:s.trim().split(Mi)}function Kk(s){return this.classes().indexOf(s)!==-1}function wk(s){if(!this.hasClass(s)){const e=this.classes();e.push(s),this.attr("class",e.join(" "))}return this}function Bk(s){return this.hasClass(s)&&this.attr("class",this.classes().filter(function(e){return e!==s}).join(" ")),this}function Uk(s){return this.hasClass(s)?this.removeClass(s):this.addClass(s)}Qe("Dom",{classes:Lk,hasClass:Kk,addClass:wk,removeClass:Bk,toggleClass:Uk});function Fk(s,e){const t={};if(arguments.length===0)return this.node.style.cssText.split(/\s*;\s*/).filter(function(n){return!!n.length}).forEach(function(n){const i=n.split(/\s*:\s*/);t[i[0]]=i[1]}),t;if(arguments.length<2){if(Array.isArray(s)){for(const n of s){const i=jo(n);t[n]=this.node.style[i]}return t}if(typeof s=="string")return this.node.style[jo(s)];if(typeof s=="object")for(const n in s)this.node.style[jo(n)]=s[n]==null||wp.test(s[n])?"":s[n]}return arguments.length===2&&(this.node.style[jo(s)]=e==null||wp.test(e)?"":e),this}function Vk(){return this.css("display","")}function jk(){return this.css("display","none")}function Wk(){return this.css("display")!=="none"}Qe("Dom",{css:Fk,show:Vk,hide:jk,visible:Wk});function Hk(s,e,t){if(s==null)return this.data(Ol(im(this.node.attributes,n=>n.nodeName.indexOf("data-")===0),n=>n.nodeName.slice(5)));if(s instanceof Array){const n={};for(const i of s)n[i]=this.data(i);return n}else if(typeof s=="object")for(e in s)this.data(e,s[e]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+s))}catch{return this.attr("data-"+s)}else this.attr("data-"+s,e===null?null:t===!0||typeof e=="string"||typeof e=="number"?e:JSON.stringify(e));return this}Qe("Dom",{data:Hk});function Gk(s,e){if(typeof arguments[0]=="object")for(const t in s)this.remember(t,s[t]);else{if(arguments.length===1)return this.memory()[s];this.memory()[s]=e}return this}function zk(){if(arguments.length===0)this._memory={};else for(let s=arguments.length-1;s>=0;s--)delete this.memory()[arguments[s]];return this}function $k(){return this._memory=this._memory||{}}Qe("Dom",{remember:Gk,forget:zk,memory:$k});function Yk(s){return s.length===4?["#",s.substring(1,2),s.substring(1,2),s.substring(2,3),s.substring(2,3),s.substring(3,4),s.substring(3,4)].join(""):s}function Xk(s){const e=Math.round(s),n=Math.max(0,Math.min(255,e)).toString(16);return n.length===1?"0"+n:n}function Fn(s,e){for(let t=e.length;t--;)if(s[e[t]]==null)return!1;return!0}function Jk(s,e){const t=Fn(s,"rgb")?{_a:s.r,_b:s.g,_c:s.b,_d:0,space:"rgb"}:Fn(s,"xyz")?{_a:s.x,_b:s.y,_c:s.z,_d:0,space:"xyz"}:Fn(s,"hsl")?{_a:s.h,_b:s.s,_c:s.l,_d:0,space:"hsl"}:Fn(s,"lab")?{_a:s.l,_b:s.a,_c:s.b,_d:0,space:"lab"}:Fn(s,"lch")?{_a:s.l,_b:s.c,_c:s.h,_d:0,space:"lch"}:Fn(s,"cmyk")?{_a:s.c,_b:s.m,_c:s.y,_d:s.k,space:"cmyk"}:{_a:0,_b:0,_c:0,space:"rgb"};return t.space=e||t.space,t}function qk(s){return s==="lab"||s==="xyz"||s==="lch"}function Tu(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*(2/3-t)*6:s}class Ot{constructor(...e){this.init(...e)}static isColor(e){return e&&(e instanceof Ot||this.isRgb(e)||this.test(e))}static isRgb(e){return e&&typeof e.r=="number"&&typeof e.g=="number"&&typeof e.b=="number"}static random(e="vibrant",t,n){const{random:i,round:r,sin:a,PI:o}=Math;if(e==="vibrant"){const l=24*i()+57,u=38*i()+45,c=360*i();return new Ot(l,u,c,"lch")}else if(e==="sine"){t=t??i();const l=r(80*a(2*o*t/.5+.01)+150),u=r(50*a(2*o*t/.5+4.6)+200),c=r(100*a(2*o*t/.5+2.3)+150);return new Ot(l,u,c)}else if(e==="pastel"){const l=8*i()+86,u=17*i()+9,c=360*i();return new Ot(l,u,c,"lch")}else if(e==="dark"){const l=10+10*i(),u=50*i()+86,c=360*i();return new Ot(l,u,c,"lch")}else if(e==="rgb"){const l=255*i(),u=255*i(),c=255*i();return new Ot(l,u,c)}else if(e==="lab"){const l=100*i(),u=256*i()-128,c=256*i()-128;return new Ot(l,u,c,"lab")}else if(e==="grey"){const l=255*i();return new Ot(l,l,l)}else throw new Error("Unsupported random color mode")}static test(e){return typeof e=="string"&&(Lp.test(e)||Kp.test(e))}cmyk(){const{_a:e,_b:t,_c:n}=this.rgb(),[i,r,a]=[e,t,n].map(h=>h/255),o=Math.min(1-i,1-r,1-a);if(o===1)return new Ot(0,0,0,1,"cmyk");const l=(1-i-o)/(1-o),u=(1-r-o)/(1-o),c=(1-a-o)/(1-o);return new Ot(l,u,c,o,"cmyk")}hsl(){const{_a:e,_b:t,_c:n}=this.rgb(),[i,r,a]=[e,t,n].map(f=>f/255),o=Math.max(i,r,a),l=Math.min(i,r,a),u=(o+l)/2,c=o===l,d=o-l,h=c?0:u>.5?d/(2-o-l):d/(o+l),p=c?0:o===i?((r-a)/d+(r<a?6:0))/6:o===r?((a-i)/d+2)/6:o===a?((i-r)/d+4)/6:0;return new Ot(360*p,100*h,100*u,"hsl")}init(e=0,t=0,n=0,i=0,r="rgb"){if(e=e||0,this.space)for(const d in this.space)delete this[this.space[d]];if(typeof e=="number")r=typeof i=="string"?i:r,i=typeof i=="string"?0:i,Object.assign(this,{_a:e,_b:t,_c:n,_d:i,space:r});else if(e instanceof Array)this.space=t||(typeof e[3]=="string"?e[3]:e[4])||"rgb",Object.assign(this,{_a:e[0],_b:e[1],_c:e[2],_d:e[3]||0});else if(e instanceof Object){const d=Jk(e,t);Object.assign(this,d)}else if(typeof e=="string")if(Kp.test(e)){const d=e.replace(Mk,""),[h,p,g]=Rk.exec(d).slice(1,4).map(f=>parseInt(f));Object.assign(this,{_a:h,_b:p,_c:g,_d:0,space:"rgb"})}else if(Lp.test(e)){const d=f=>parseInt(f,16),[,h,p,g]=Dk.exec(Yk(e)).map(d);Object.assign(this,{_a:h,_b:p,_c:g,_d:0,space:"rgb"})}else throw Error("Unsupported string format, can't construct Color");const{_a:a,_b:o,_c:l,_d:u}=this,c=this.space==="rgb"?{r:a,g:o,b:l}:this.space==="xyz"?{x:a,y:o,z:l}:this.space==="hsl"?{h:a,s:o,l}:this.space==="lab"?{l:a,a:o,b:l}:this.space==="lch"?{l:a,c:o,h:l}:this.space==="cmyk"?{c:a,m:o,y:l,k:u}:{};Object.assign(this,c)}lab(){const{x:e,y:t,z:n}=this.xyz(),i=116*t-16,r=500*(e-t),a=200*(t-n);return new Ot(i,r,a,"lab")}lch(){const{l:e,a:t,b:n}=this.lab(),i=Math.sqrt(t**2+n**2);let r=180*Math.atan2(n,t)/Math.PI;return r<0&&(r*=-1,r=360-r),new Ot(e,i,r,"lch")}rgb(){if(this.space==="rgb")return this;if(qk(this.space)){let{x:e,y:t,z:n}=this;if(this.space==="lab"||this.space==="lch"){let{l:p,a:g,b:f}=this;if(this.space==="lch"){const{c:b,h:v}=this,I=Math.PI/180;g=b*Math.cos(I*v),f=b*Math.sin(I*v)}const m=(p+16)/116,C=g/500+m,_=m-f/200,y=16/116,T=.008856,E=7.787;e=.95047*(C**3>T?C**3:(C-y)/E),t=1*(m**3>T?m**3:(m-y)/E),n=1.08883*(_**3>T?_**3:(_-y)/E)}const i=e*3.2406+t*-1.5372+n*-.4986,r=e*-.9689+t*1.8758+n*.0415,a=e*.0557+t*-.204+n*1.057,o=Math.pow,l=.0031308,u=i>l?1.055*o(i,1/2.4)-.055:12.92*i,c=r>l?1.055*o(r,1/2.4)-.055:12.92*r,d=a>l?1.055*o(a,1/2.4)-.055:12.92*a;return new Ot(255*u,255*c,255*d)}else if(this.space==="hsl"){let{h:e,s:t,l:n}=this;if(e/=360,t/=100,n/=100,t===0)return n*=255,new Ot(n,n,n);const i=n<.5?n*(1+t):n+t-n*t,r=2*n-i,a=255*Tu(r,i,e+1/3),o=255*Tu(r,i,e),l=255*Tu(r,i,e-1/3);return new Ot(a,o,l)}else if(this.space==="cmyk"){const{c:e,m:t,y:n,k:i}=this,r=255*(1-Math.min(1,e*(1-i)+i)),a=255*(1-Math.min(1,t*(1-i)+i)),o=255*(1-Math.min(1,n*(1-i)+i));return new Ot(r,a,o)}else return this}toArray(){const{_a:e,_b:t,_c:n,_d:i,space:r}=this;return[e,t,n,i,r]}toHex(){const[e,t,n]=this._clamped().map(Xk);return`#${e}${t}${n}`}toRgb(){const[e,t,n]=this._clamped();return`rgb(${e},${t},${n})`}toString(){return this.toHex()}xyz(){const{_a:e,_b:t,_c:n}=this.rgb(),[i,r,a]=[e,t,n].map(C=>C/255),o=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,l=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,u=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,c=(o*.4124+l*.3576+u*.1805)/.95047,d=(o*.2126+l*.7152+u*.0722)/1,h=(o*.0193+l*.1192+u*.9505)/1.08883,p=c>.008856?Math.pow(c,1/3):7.787*c+16/116,g=d>.008856?Math.pow(d,1/3):7.787*d+16/116,f=h>.008856?Math.pow(h,1/3):7.787*h+16/116;return new Ot(p,g,f,"xyz")}_clamped(){const{_a:e,_b:t,_c:n}=this.rgb(),{max:i,min:r,round:a}=Math,o=l=>i(0,r(a(l),255));return[e,t,n].map(o)}}class Xt{constructor(...e){this.init(...e)}clone(){return new Xt(this)}init(e,t){const n={x:0,y:0},i=Array.isArray(e)?{x:e[0],y:e[1]}:typeof e=="object"?{x:e.x,y:e.y}:{x:e,y:t};return this.x=i.x==null?n.x:i.x,this.y=i.y==null?n.y:i.y,this}toArray(){return[this.x,this.y]}transform(e){return this.clone().transformO(e)}transformO(e){Be.isMatrixLike(e)||(e=new Be(e));const{x:t,y:n}=this;return this.x=e.a*t+e.c*n+e.e,this.y=e.b*t+e.d*n+e.f,this}}function Zk(s,e){return new Xt(s,e).transform(this.screenCTM().inverse())}function Vn(s,e,t){return Math.abs(e-s)<1e-6}class Be{constructor(...e){this.init(...e)}static formatTransforms(e){const t=e.flip==="both"||e.flip===!0,n=e.flip&&(t||e.flip==="x")?-1:1,i=e.flip&&(t||e.flip==="y")?-1:1,r=e.skew&&e.skew.length?e.skew[0]:isFinite(e.skew)?e.skew:isFinite(e.skewX)?e.skewX:0,a=e.skew&&e.skew.length?e.skew[1]:isFinite(e.skew)?e.skew:isFinite(e.skewY)?e.skewY:0,o=e.scale&&e.scale.length?e.scale[0]*n:isFinite(e.scale)?e.scale*n:isFinite(e.scaleX)?e.scaleX*n:n,l=e.scale&&e.scale.length?e.scale[1]*i:isFinite(e.scale)?e.scale*i:isFinite(e.scaleY)?e.scaleY*i:i,u=e.shear||0,c=e.rotate||e.theta||0,d=new Xt(e.origin||e.around||e.ox||e.originX,e.oy||e.originY),h=d.x,p=d.y,g=new Xt(e.position||e.px||e.positionX||NaN,e.py||e.positionY||NaN),f=g.x,m=g.y,C=new Xt(e.translate||e.tx||e.translateX,e.ty||e.translateY),_=C.x,y=C.y,T=new Xt(e.relative||e.rx||e.relativeX,e.ry||e.relativeY),E=T.x,b=T.y;return{scaleX:o,scaleY:l,skewX:r,skewY:a,shear:u,theta:c,rx:E,ry:b,tx:_,ty:y,ox:h,oy:p,px:f,py:m}}static fromArray(e){return{a:e[0],b:e[1],c:e[2],d:e[3],e:e[4],f:e[5]}}static isMatrixLike(e){return e.a!=null||e.b!=null||e.c!=null||e.d!=null||e.e!=null||e.f!=null}static matrixMultiply(e,t,n){const i=e.a*t.a+e.c*t.b,r=e.b*t.a+e.d*t.b,a=e.a*t.c+e.c*t.d,o=e.b*t.c+e.d*t.d,l=e.e+e.a*t.e+e.c*t.f,u=e.f+e.b*t.e+e.d*t.f;return n.a=i,n.b=r,n.c=a,n.d=o,n.e=l,n.f=u,n}around(e,t,n){return this.clone().aroundO(e,t,n)}aroundO(e,t,n){const i=e||0,r=t||0;return this.translateO(-i,-r).lmultiplyO(n).translateO(i,r)}clone(){return new Be(this)}decompose(e=0,t=0){const n=this.a,i=this.b,r=this.c,a=this.d,o=this.e,l=this.f,u=n*a-i*r,c=u>0?1:-1,d=c*Math.sqrt(n*n+i*i),h=Math.atan2(c*i,c*n),p=180/Math.PI*h,g=Math.cos(h),f=Math.sin(h),m=(n*r+i*a)/u,C=r*d/(m*n-i)||a*d/(m*i+n),_=o-e+e*g*d+t*(m*g*d-f*C),y=l-t+e*f*d+t*(m*f*d+g*C);return{scaleX:d,scaleY:C,shear:m,rotate:p,translateX:_,translateY:y,originX:e,originY:t,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}equals(e){if(e===this)return!0;const t=new Be(e);return Vn(this.a,t.a)&&Vn(this.b,t.b)&&Vn(this.c,t.c)&&Vn(this.d,t.d)&&Vn(this.e,t.e)&&Vn(this.f,t.f)}flip(e,t){return this.clone().flipO(e,t)}flipO(e,t){return e==="x"?this.scaleO(-1,1,t,0):e==="y"?this.scaleO(1,-1,0,t):this.scaleO(-1,-1,e,t||e)}init(e){const t=Be.fromArray([1,0,0,1,0,0]);return e=e instanceof Ir?e.matrixify():typeof e=="string"?Be.fromArray(e.split(Mi).map(parseFloat)):Array.isArray(e)?Be.fromArray(e):typeof e=="object"&&Be.isMatrixLike(e)?e:typeof e=="object"?new Be().transform(e):arguments.length===6?Be.fromArray([].slice.call(arguments)):t,this.a=e.a!=null?e.a:t.a,this.b=e.b!=null?e.b:t.b,this.c=e.c!=null?e.c:t.c,this.d=e.d!=null?e.d:t.d,this.e=e.e!=null?e.e:t.e,this.f=e.f!=null?e.f:t.f,this}inverse(){return this.clone().inverseO()}inverseO(){const e=this.a,t=this.b,n=this.c,i=this.d,r=this.e,a=this.f,o=e*i-t*n;if(!o)throw new Error("Cannot invert "+this);const l=i/o,u=-t/o,c=-n/o,d=e/o,h=-(l*r+c*a),p=-(u*r+d*a);return this.a=l,this.b=u,this.c=c,this.d=d,this.e=h,this.f=p,this}lmultiply(e){return this.clone().lmultiplyO(e)}lmultiplyO(e){const t=this,n=e instanceof Be?e:new Be(e);return Be.matrixMultiply(n,t,this)}multiply(e){return this.clone().multiplyO(e)}multiplyO(e){const t=this,n=e instanceof Be?e:new Be(e);return Be.matrixMultiply(t,n,this)}rotate(e,t,n){return this.clone().rotateO(e,t,n)}rotateO(e,t=0,n=0){e=ms(e);const i=Math.cos(e),r=Math.sin(e),{a,b:o,c:l,d:u,e:c,f:d}=this;return this.a=a*i-o*r,this.b=o*i+a*r,this.c=l*i-u*r,this.d=u*i+l*r,this.e=c*i-d*r+n*r-t*i+t,this.f=d*i+c*r-t*r-n*i+n,this}scale(e,t,n,i){return this.clone().scaleO(...arguments)}scaleO(e,t=e,n=0,i=0){arguments.length===3&&(i=n,n=t,t=e);const{a:r,b:a,c:o,d:l,e:u,f:c}=this;return this.a=r*e,this.b=a*t,this.c=o*e,this.d=l*t,this.e=u*e-n*e+n,this.f=c*t-i*t+i,this}shear(e,t,n){return this.clone().shearO(e,t,n)}shearO(e,t=0,n=0){const{a:i,b:r,c:a,d:o,e:l,f:u}=this;return this.a=i+r*e,this.c=a+o*e,this.e=l+u*e-n*e,this}skew(e,t,n,i){return this.clone().skewO(...arguments)}skewO(e,t=e,n=0,i=0){arguments.length===3&&(i=n,n=t,t=e),e=ms(e),t=ms(t);const r=Math.tan(e),a=Math.tan(t),{a:o,b:l,c:u,d:c,e:d,f:h}=this;return this.a=o+l*r,this.b=l+o*a,this.c=u+c*r,this.d=c+u*a,this.e=d+h*r-i*r,this.f=h+d*a-n*a,this}skewX(e,t,n){return this.skew(e,0,t,n)}skewY(e,t,n){return this.skew(0,e,t,n)}toArray(){return[this.a,this.b,this.c,this.d,this.e,this.f]}toString(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}transform(e){if(Be.isMatrixLike(e))return new Be(e).multiplyO(this);const t=Be.formatTransforms(e),n=this,{x:i,y:r}=new Xt(t.ox,t.oy).transform(n),a=new Be().translateO(t.rx,t.ry).lmultiplyO(n).translateO(-i,-r).scaleO(t.scaleX,t.scaleY).skewO(t.skewX,t.skewY).shearO(t.shear).rotateO(t.theta).translateO(i,r);if(isFinite(t.px)||isFinite(t.py)){const o=new Xt(i,r).transform(a),l=isFinite(t.px)?t.px-o.x:0,u=isFinite(t.py)?t.py-o.y:0;a.translateO(l,u)}return a.translateO(t.tx,t.ty),a}translate(e,t){return this.clone().translateO(e,t)}translateO(e,t){return this.e+=e||0,this.f+=t||0,this}valueOf(){return{a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}}function Qk(){return new Be(this.node.getCTM())}function eI(){if(typeof this.isRoot=="function"&&!this.isRoot()){const s=this.rect(1,1),e=s.node.getScreenCTM();return s.remove(),new Be(e)}return new Be(this.node.getScreenCTM())}ct(Be,"Matrix");function Ui(){if(!Ui.nodes){const s=Cr().size(2,0);s.node.style.cssText=["opacity: 0","position: absolute","left: -100%","top: -100%","overflow: hidden"].join(";"),s.attr("focusable","false"),s.attr("aria-hidden","true");const e=s.path().node;Ui.nodes={svg:s,path:e}}if(!Ui.nodes.svg.node.parentNode){const s=mt.document.body||mt.document.documentElement;Ui.nodes.svg.addTo(s)}return Ui.nodes}function cm(s){return!s.width&&!s.height&&!s.x&&!s.y}function tI(s){return s===mt.document||(mt.document.documentElement.contains||function(e){for(;e.parentNode;)e=e.parentNode;return e===mt.document}).call(mt.document.documentElement,s)}class lr{constructor(...e){this.init(...e)}addOffset(){return this.x+=mt.window.pageXOffset,this.y+=mt.window.pageYOffset,new lr(this)}init(e){const t=[0,0,0,0];return e=typeof e=="string"?e.split(Mi).map(parseFloat):Array.isArray(e)?e:typeof e=="object"?[e.left!=null?e.left:e.x,e.top!=null?e.top:e.y,e.width,e.height]:arguments.length===4?[].slice.call(arguments):t,this.x=e[0]||0,this.y=e[1]||0,this.width=this.w=e[2]||0,this.height=this.h=e[3]||0,this.x2=this.x+this.w,this.y2=this.y+this.h,this.cx=this.x+this.w/2,this.cy=this.y+this.h/2,this}isNulled(){return cm(this)}merge(e){const t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),i=Math.max(this.x+this.width,e.x+e.width)-t,r=Math.max(this.y+this.height,e.y+e.height)-n;return new lr(t,n,i,r)}toArray(){return[this.x,this.y,this.width,this.height]}toString(){return this.x+" "+this.y+" "+this.width+" "+this.height}transform(e){e instanceof Be||(e=new Be(e));let t=1/0,n=-1/0,i=1/0,r=-1/0;return[new Xt(this.x,this.y),new Xt(this.x2,this.y),new Xt(this.x,this.y2),new Xt(this.x2,this.y2)].forEach(function(o){o=o.transform(e),t=Math.min(t,o.x),n=Math.max(n,o.x),i=Math.min(i,o.y),r=Math.max(r,o.y)}),new lr(t,i,n-t,r-i)}}function dm(s,e,t){let n;try{if(n=e(s.node),cm(n)&&!tI(s.node))throw new Error("Element not in the dom")}catch{n=t(s)}return n}function rI(){const t=dm(this,i=>i.getBBox(),i=>{try{const r=i.clone().addTo(Ui().svg).show(),a=r.node.getBBox();return r.remove(),a}catch(r){throw new Error(`Getting bbox of element "${i.node.nodeName}" is not possible: ${r.toString()}`)}});return new lr(t)}function iI(s){const n=dm(this,r=>r.getBoundingClientRect(),r=>{throw new Error(`Getting rbox of element "${r.node.nodeName}" is not possible`)}),i=new lr(n);return s?i.transform(s.screenCTM().inverseO()):i.addOffset()}function nI(s,e){const t=this.bbox();return s>t.x&&e>t.y&&s<t.x+t.width&&e<t.y+t.height}Qe({viewbox:{viewbox(s,e,t,n){return s==null?new lr(this.attr("viewBox")):this.attr("viewBox",new lr(s,e,t,n))},zoom(s,e){let{width:t,height:n}=this.attr(["width","height"]);if((!t&&!n||typeof t=="string"||typeof n=="string")&&(t=this.node.clientWidth,n=this.node.clientHeight),!t||!n)throw new Error("Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element");const i=this.viewbox(),r=t/i.width,a=n/i.height,o=Math.min(r,a);if(s==null)return o;let l=o/s;l===1/0&&(l=Number.MAX_SAFE_INTEGER/100),e=e||new Xt(t/2/r+i.x,n/2/a+i.y);const u=new lr(i).transform(new Be({scale:l,origin:e}));return this.viewbox(u)}}});ct(lr,"Box");class yn extends Array{constructor(e=[],...t){if(super(e,...t),typeof e=="number")return this;this.length=0,this.push(...e)}}Ye([yn],{each(s,...e){return typeof s=="function"?this.map((t,n,i)=>s.call(t,t,n,i)):this.map(t=>t[s](...e))},toArray(){return Array.prototype.concat.apply([],this)}});const oI=["toArray","constructor","each"];yn.extend=function(s){s=s.reduce((e,t)=>(oI.includes(t)||t[0]==="_"||(e[t]=function(...n){return this.each(t,...n)}),e),{}),Ye([yn],s)};function kn(s,e){return new yn(Ol((e||mt.document).querySelectorAll(s),function(t){return $r(t)}))}function aI(s){return kn(s,this.node)}function sI(s){return $r(this.node.querySelector(s))}let lI=0;const hm={};function pm(s){let e=s.getEventHolder();return e===mt.window&&(e=hm),e.events||(e.events={}),e.events}function zc(s){return s.getEventTarget()}function uI(s){let e=s.getEventHolder();e===mt.window&&(e=hm),e.events&&(e.events={})}function ua(s,e,t,n,i){const r=t.bind(n||s),a=Cr(s),o=pm(a),l=zc(a);e=Array.isArray(e)?e:e.split(Mi),t._svgjsListenerId||(t._svgjsListenerId=++lI),e.forEach(function(u){const c=u.split(".")[0],d=u.split(".")[1]||"*";o[c]=o[c]||{},o[c][d]=o[c][d]||{},o[c][d][t._svgjsListenerId]=r,l.addEventListener(c,r,i||!1)})}function _i(s,e,t,n){const i=Cr(s),r=pm(i),a=zc(i);typeof t=="function"&&(t=t._svgjsListenerId,!t)||(e=Array.isArray(e)?e:(e||"").split(Mi),e.forEach(function(o){const l=o&&o.split(".")[0],u=o&&o.split(".")[1];let c,d;if(t)r[l]&&r[l][u||"*"]&&(a.removeEventListener(l,r[l][u||"*"][t],n||!1),delete r[l][u||"*"][t]);else if(l&&u){if(r[l]&&r[l][u]){for(d in r[l][u])_i(a,[l,u].join("."),d);delete r[l][u]}}else if(u)for(o in r)for(c in r[o])u===c&&_i(a,[o,u].join("."));else if(l){if(r[l]){for(c in r[l])_i(a,[l,c].join("."));delete r[l]}}else{for(o in r)_i(a,o);uI(i)}}))}function cI(s,e,t,n){const i=zc(s);return e instanceof mt.window.Event||(e=new mt.window.CustomEvent(e,{detail:t,cancelable:!0,...n})),i.dispatchEvent(e),e}class Aa extends Wc{addEventListener(){}dispatch(e,t,n){return cI(this,e,t,n)}dispatchEvent(e){const t=this.getEventHolder().events;if(!t)return!0;const n=t[e.type];for(const i in n)for(const r in n[i])n[i][r](e);return!e.defaultPrevented}fire(e,t,n){return this.dispatch(e,t,n),this}getEventHolder(){return this}getEventTarget(){return this}off(e,t,n){return _i(this,e,t,n),this}on(e,t,n,i){return ua(this,e,t,n,i),this}removeEventListener(){}}ct(Aa,"EventTarget");function Up(){}const Ho={duration:400,ease:">",delay:0},dI={"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","text-anchor":"start"};class An extends Array{constructor(...e){super(...e),this.init(...e)}clone(){return new this.constructor(this)}init(e){return typeof e=="number"?this:(this.length=0,this.push(...this.parse(e)),this)}parse(e=[]){return e instanceof Array?e:e.trim().split(Mi).map(parseFloat)}toArray(){return Array.prototype.concat.apply([],this)}toSet(){return new Set(this)}toString(){return this.join(" ")}valueOf(){const e=[];return e.push(...this),e}}class qe{constructor(...e){this.init(...e)}convert(e){return new qe(this.value,e)}divide(e){return e=new qe(e),new qe(this/e,this.unit||e.unit)}init(e,t){return t=Array.isArray(e)?e[1]:t,e=Array.isArray(e)?e[0]:e,this.value=0,this.unit=t||"",typeof e=="number"?this.value=isNaN(e)?0:isFinite(e)?e:e<0?-34e37:34e37:typeof e=="string"?(t=e.match(um),t&&(this.value=parseFloat(t[1]),t[5]==="%"?this.value/=100:t[5]==="s"&&(this.value*=1e3),this.unit=t[5])):e instanceof qe&&(this.value=e.valueOf(),this.unit=e.unit),this}minus(e){return e=new qe(e),new qe(this-e,this.unit||e.unit)}plus(e){return e=new qe(e),new qe(this+e,this.unit||e.unit)}times(e){return e=new qe(e),new qe(this*e,this.unit||e.unit)}toArray(){return[this.value,this.unit]}toJSON(){return this.toString()}toString(){return(this.unit==="%"?~~(this.value*1e8)/1e6:this.unit==="s"?this.value/1e3:this.value)+this.unit}valueOf(){return this.value}}const gm=[];function hI(s){gm.push(s)}function pI(s,e,t){if(s==null){s={},e=this.node.attributes;for(const n of e)s[n.nodeName]=Bp.test(n.nodeValue)?parseFloat(n.nodeValue):n.nodeValue;return s}else{if(s instanceof Array)return s.reduce((n,i)=>(n[i]=this.attr(i),n),{});if(typeof s=="object"&&s.constructor===Object)for(e in s)this.attr(e,s[e]);else if(e===null)this.node.removeAttribute(s);else{if(e==null)return e=this.node.getAttribute(s),e==null?dI[s]:Bp.test(e)?parseFloat(e):e;e=gm.reduce((n,i)=>i(s,n,this),e),typeof e=="number"?e=new qe(e):Ot.isColor(e)?e=new Ot(e):e.constructor===Array&&(e=new An(e)),s==="leading"?this.leading&&this.leading(e):typeof t=="string"?this.node.setAttributeNS(t,s,e.toString()):this.node.setAttribute(s,e.toString()),this.rebuild&&(s==="font-size"||s==="x")&&this.rebuild()}}return this}class Hi extends Aa{constructor(e,t){super(),this.node=e,this.type=e.nodeName,t&&e!==t&&this.attr(t)}add(e,t){return e=Cr(e),e.removeNamespace&&this.node instanceof mt.window.SVGElement&&e.removeNamespace(),t==null?this.node.appendChild(e.node):e.node!==this.node.childNodes[t]&&this.node.insertBefore(e.node,this.node.childNodes[t]),this}addTo(e,t){return Cr(e).put(this,t)}children(){return new yn(Ol(this.node.children,function(e){return $r(e)}))}clear(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this}clone(e=!0){return this.writeDataToDom(),new this.constructor(lm(this.node.cloneNode(e)))}each(e,t){const n=this.children();let i,r;for(i=0,r=n.length;i<r;i++)e.apply(n[i],[i,n]),t&&n[i].each(e,t);return this}element(e,t){return this.put(new Hi(la(e),t))}first(){return $r(this.node.firstChild)}get(e){return $r(this.node.childNodes[e])}getEventHolder(){return this.node}getEventTarget(){return this.node}has(e){return this.index(e)>=0}html(e,t){return this.xml(e,t,om)}id(e){return typeof e>"u"&&!this.node.id&&(this.node.id=sm(this.type)),this.attr("id",e)}index(e){return[].slice.call(this.node.childNodes).indexOf(e.node)}last(){return $r(this.node.lastChild)}matches(e){const t=this.node,n=t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector||null;return n&&n.call(t,e)}parent(e){let t=this;if(!t.node.parentNode)return null;if(t=$r(t.node.parentNode),!e)return t;do if(typeof e=="string"?t.matches(e):t instanceof e)return t;while(t=$r(t.node.parentNode));return t}put(e,t){return e=Cr(e),this.add(e,t),e}putIn(e,t){return Cr(e).add(this,t)}remove(){return this.parent()&&this.parent().removeElement(this),this}removeElement(e){return this.node.removeChild(e.node),this}replace(e){return e=Cr(e),this.node.parentNode&&this.node.parentNode.replaceChild(e.node,this.node),e}round(e=2,t=null){const n=10**e,i=this.attr(t);for(const r in i)typeof i[r]=="number"&&(i[r]=Math.round(i[r]*n)/n);return this.attr(i),this}svg(e,t){return this.xml(e,t,vl)}toString(){return this.id()}words(e){return this.node.textContent=e,this}wrap(e){const t=this.parent();if(!t)return this.addTo(e);const n=t.index(this);return t.put(e,n).put(this)}writeDataToDom(){return this.each(function(){this.writeDataToDom()}),this}xml(e,t,n){if(typeof e=="boolean"&&(n=t,t=e,e=null),e==null||typeof e=="function"){t=t??!0,this.writeDataToDom();let o=this;if(e!=null){if(o=$r(o.node.cloneNode(!0)),t){const l=e(o);if(o=l||o,l===!1)return""}o.each(function(){const l=e(this),u=l||this;l===!1?this.remove():l&&this!==u&&this.replace(u)},!0)}return t?o.node.outerHTML:o.node.innerHTML}t=t??!1;const i=la("wrapper",n),r=mt.document.createDocumentFragment();i.innerHTML=e;for(let o=i.children.length;o--;)r.appendChild(i.firstElementChild);const a=this.parent();return t?this.replace(r)&&a:this.add(r)}}Ye(Hi,{attr:pI,find:aI,findOne:sI});ct(Hi,"Dom");let Ir=class extends Hi{constructor(e,t){super(e,t),this.dom={},this.node.instance=this,e.hasAttribute("svgjs:data")&&this.setData(JSON.parse(e.getAttribute("svgjs:data"))||{})}center(e,t){return this.cx(e).cy(t)}cx(e){return e==null?this.x()+this.width()/2:this.x(e-this.width()/2)}cy(e){return e==null?this.y()+this.height()/2:this.y(e-this.height()/2)}defs(){const e=this.root();return e&&e.defs()}dmove(e,t){return this.dx(e).dy(t)}dx(e=0){return this.x(new qe(e).plus(this.x()))}dy(e=0){return this.y(new qe(e).plus(this.y()))}getEventHolder(){return this}height(e){return this.attr("height",e)}move(e,t){return this.x(e).y(t)}parents(e=this.root()){const t=typeof e=="string";t||(e=Cr(e));const n=new yn;let i=this;for(;(i=i.parent())&&i.node!==mt.document&&i.nodeName!=="#document-fragment"&&(n.push(i),!(!t&&i.node===e.node||t&&i.matches(e)));)if(i.node===this.root().node)return null;return n}reference(e){if(e=this.attr(e),!e)return null;const t=(e+"").match(Pk);return t?Cr(t[1]):null}root(){const e=this.parent(fk(Hc));return e&&e.root()}setData(e){return this.dom=e,this}size(e,t){const n=vn(this,e,t);return this.width(new qe(n.width)).height(new qe(n.height))}width(e){return this.attr("width",e)}writeDataToDom(){return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),super.writeDataToDom()}x(e){return this.attr("x",e)}y(e){return this.attr("y",e)}};Ye(Ir,{bbox:rI,rbox:iI,inside:nI,point:Zk,ctm:Qk,screenCTM:eI});ct(Ir,"Element");const Lo={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(s,e){return e==="color"?s:s+"-"+e}};["fill","stroke"].forEach(function(s){const e={};let t;e[s]=function(n){if(typeof n>"u")return this.attr(s);if(typeof n=="string"||n instanceof Ot||Ot.isRgb(n)||n instanceof Ir)this.attr(s,n);else for(t=Lo[s].length-1;t>=0;t--)n[Lo[s][t]]!=null&&this.attr(Lo.prefix(s,Lo[s][t]),n[Lo[s][t]]);return this},Qe(["Element","Runner"],e)});Qe(["Element","Runner"],{matrix:function(s,e,t,n,i,r){return s==null?new Be(this):this.attr("transform",new Be(s,e,t,n,i,r))},rotate:function(s,e,t){return this.transform({rotate:s,ox:e,oy:t},!0)},skew:function(s,e,t,n){return arguments.length===1||arguments.length===3?this.transform({skew:s,ox:e,oy:t},!0):this.transform({skew:[s,e],ox:t,oy:n},!0)},shear:function(s,e,t){return this.transform({shear:s,ox:e,oy:t},!0)},scale:function(s,e,t,n){return arguments.length===1||arguments.length===3?this.transform({scale:s,ox:e,oy:t},!0):this.transform({scale:[s,e],ox:t,oy:n},!0)},translate:function(s,e){return this.transform({translate:[s,e]},!0)},relative:function(s,e){return this.transform({relative:[s,e]},!0)},flip:function(s="both",e="center"){return"xybothtrue".indexOf(s)===-1&&(e=s,s="both"),this.transform({flip:s,origin:e},!0)},opacity:function(s){return this.attr("opacity",s)}});Qe("radius",{radius:function(s,e=s){return(this._element||this).type==="radialGradient"?this.attr("r",new qe(s)):this.rx(s).ry(e)}});Qe("Path",{length:function(){return this.node.getTotalLength()},pointAt:function(s){return new Xt(this.node.getPointAtLength(s))}});Qe(["Element","Runner"],{font:function(s,e){if(typeof s=="object"){for(e in s)this.font(e,s[e]);return this}return s==="leading"?this.leading(e):s==="anchor"?this.attr("text-anchor",e):s==="size"||s==="family"||s==="weight"||s==="stretch"||s==="variant"||s==="style"?this.attr("font-"+s,e):this.attr(s,e)}});const gI=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","touchstart","touchmove","touchleave","touchend","touchcancel"].reduce(function(s,e){const t=function(n){return n===null?this.off(e):this.on(e,n),this};return s[e]=t,s},{});Qe("Element",gI);function fI(){return this.attr("transform",null)}function mI(){return(this.attr("transform")||"").split(Nk).slice(0,-1).map(function(e){const t=e.trim().split("(");return[t[0],t[1].split(Mi).map(function(n){return parseFloat(n)})]}).reverse().reduce(function(e,t){return t[0]==="matrix"?e.lmultiply(Be.fromArray(t[1])):e[t[0]].apply(e,t[1])},new Be)}function CI(s,e){if(this===s)return this;const t=this.screenCTM(),n=s.screenCTM().inverse();return this.addTo(s,e).untransform().transform(n.multiply(t)),this}function _I(s){return this.toParent(this.root(),s)}function yI(s,e){if(s==null||typeof s=="string"){const i=new Be(this).decompose();return s==null?i:i[s]}Be.isMatrixLike(s)||(s={...s,origin:ws(s,this)});const t=e===!0?this:e||!1,n=new Be(t).transform(s);return this.attr("transform",n)}Qe("Element",{untransform:fI,matrixify:mI,toParent:CI,toRoot:_I,transform:yI});class Ar extends Ir{flatten(e=this,t){return this.each(function(){if(this instanceof Ar)return this.flatten().ungroup()}),this}ungroup(e=this.parent(),t=e.index(this)){return t=t===-1?e.children().length:t,this.each(function(n,i){return i[i.length-n-1].toParent(e,t)}),this.remove()}}ct(Ar,"Container");class kl extends Ar{constructor(e,t=e){super(Dt("defs",e),t)}flatten(){return this}ungroup(){return this}}ct(kl,"Defs");class Ur extends Ir{}ct(Ur,"Shape");function $c(s){return this.attr("rx",s)}function Yc(s){return this.attr("ry",s)}function fm(s){return s==null?this.cx()-this.rx():this.cx(s+this.rx())}function mm(s){return s==null?this.cy()-this.ry():this.cy(s+this.ry())}function Cm(s){return this.attr("cx",s)}function _m(s){return this.attr("cy",s)}function ym(s){return s==null?this.rx()*2:this.rx(new qe(s).divide(2))}function Am(s){return s==null?this.ry()*2:this.ry(new qe(s).divide(2))}var AI={__proto__:null,rx:$c,ry:Yc,x:fm,y:mm,cx:Cm,cy:_m,width:ym,height:Am};class Il extends Ur{constructor(e,t=e){super(Dt("ellipse",e),t)}size(e,t){const n=vn(this,e,t);return this.rx(new qe(n.width).divide(2)).ry(new qe(n.height).divide(2))}}Ye(Il,AI);Qe("Container",{ellipse:It(function(s=0,e=s){return this.put(new Il).size(s,e).move(0,0)})});ct(Il,"Ellipse");class Tm extends Hi{constructor(e=mt.document.createDocumentFragment()){super(e)}xml(e,t,n){if(typeof e=="boolean"&&(n=t,t=e,e=null),e==null||typeof e=="function"){const i=new Hi(la("wrapper",n));return i.add(this.node.cloneNode(!0)),i.xml(!1,n)}return super.xml(e,!1,n)}}ct(Tm,"Fragment");function Em(s,e){return(this._element||this).type==="radialGradient"?this.attr({fx:new qe(s),fy:new qe(e)}):this.attr({x1:new qe(s),y1:new qe(e)})}function Sm(s,e){return(this._element||this).type==="radialGradient"?this.attr({cx:new qe(s),cy:new qe(e)}):this.attr({x2:new qe(s),y2:new qe(e)})}var TI={__proto__:null,from:Em,to:Sm};class Ta extends Ar{constructor(e,t){super(Dt(e+"Gradient",typeof e=="string"?null:e),t)}attr(e,t,n){return e==="transform"&&(e="gradientTransform"),super.attr(e,t,n)}bbox(){return new lr}targets(){return kn('svg [fill*="'+this.id()+'"]')}toString(){return this.url()}update(e){return this.clear(),typeof e=="function"&&e.call(this,this),this}url(){return'url("#'+this.id()+'")'}}Ye(Ta,TI);Qe({Container:{gradient(...s){return this.defs().gradient(...s)}},Defs:{gradient:It(function(s,e){return this.put(new Ta(s)).update(e)})}});ct(Ta,"Gradient");class ca extends Ar{constructor(e,t=e){super(Dt("pattern",e),t)}attr(e,t,n){return e==="transform"&&(e="patternTransform"),super.attr(e,t,n)}bbox(){return new lr}targets(){return kn('svg [fill*="'+this.id()+'"]')}toString(){return this.url()}update(e){return this.clear(),typeof e=="function"&&e.call(this,this),this}url(){return'url("#'+this.id()+'")'}}Qe({Container:{pattern(...s){return this.defs().pattern(...s)}},Defs:{pattern:It(function(s,e,t){return this.put(new ca).update(t).attr({x:0,y:0,width:s,height:e,patternUnits:"userSpaceOnUse"})})}});ct(ca,"Pattern");class Dl extends Ur{constructor(e,t=e){super(Dt("image",e),t)}load(e,t){if(!e)return this;const n=new mt.window.Image;return ua(n,"load",function(i){const r=this.parent(ca);this.width()===0&&this.height()===0&&this.size(n.width,n.height),r instanceof ca&&r.width()===0&&r.height()===0&&r.size(this.width(),this.height()),typeof t=="function"&&t.call(this,i)},this),ua(n,"load error",function(){_i(n)}),this.attr("href",n.src=e,po)}}hI(function(s,e,t){return(s==="fill"||s==="stroke")&&xk.test(e)&&(e=t.root().defs().image(e)),e instanceof Dl&&(e=t.root().defs().pattern(0,0,n=>{n.add(e)})),e});Qe({Container:{image:It(function(s,e){return this.put(new Dl).size(0,0).load(s,e)})}});ct(Dl,"Image");class Gi extends An{bbox(){let e=-1/0,t=-1/0,n=1/0,i=1/0;return this.forEach(function(r){e=Math.max(r[0],e),t=Math.max(r[1],t),n=Math.min(r[0],n),i=Math.min(r[1],i)}),new lr(n,i,e-n,t-i)}move(e,t){const n=this.bbox();if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))for(let i=this.length-1;i>=0;i--)this[i]=[this[i][0]+e,this[i][1]+t];return this}parse(e=[0,0]){const t=[];e instanceof Array?e=Array.prototype.concat.apply([],e):e=e.trim().split(Mi).map(parseFloat),e.length%2!==0&&e.pop();for(let n=0,i=e.length;n<i;n=n+2)t.push([e[n],e[n+1]]);return t}size(e,t){let n;const i=this.bbox();for(n=this.length-1;n>=0;n--)i.width&&(this[n][0]=(this[n][0]-i.x)*e/i.width+i.x),i.height&&(this[n][1]=(this[n][1]-i.y)*t/i.height+i.y);return this}toLine(){return{x1:this[0][0],y1:this[0][1],x2:this[1][0],y2:this[1][1]}}toString(){const e=[];for(let t=0,n=this.length;t<n;t++)e.push(this[t].join(","));return e.join(" ")}transform(e){return this.clone().transformO(e)}transformO(e){Be.isMatrixLike(e)||(e=new Be(e));for(let t=this.length;t--;){const[n,i]=this[t];this[t][0]=e.a*n+e.c*i+e.e,this[t][1]=e.b*n+e.d*i+e.f}return this}}const EI=Gi;function SI(s){return s==null?this.bbox().x:this.move(s,this.bbox().y)}function OI(s){return s==null?this.bbox().y:this.move(this.bbox().x,s)}function bI(s){const e=this.bbox();return s==null?e.width:this.size(s,e.height)}function vI(s){const e=this.bbox();return s==null?e.height:this.size(e.width,s)}var Xc={__proto__:null,MorphArray:EI,x:SI,y:OI,width:bI,height:vI};class da extends Ur{constructor(e,t=e){super(Dt("line",e),t)}array(){return new Gi([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])}move(e,t){return this.attr(this.array().move(e,t).toLine())}plot(e,t,n,i){return e==null?this.array():(typeof t<"u"?e={x1:e,y1:t,x2:n,y2:i}:e=new Gi(e).toLine(),this.attr(e))}size(e,t){const n=vn(this,e,t);return this.attr(this.array().size(n.width,n.height).toLine())}}Ye(da,Xc);Qe({Container:{line:It(function(...s){return da.prototype.plot.apply(this.put(new da),s[0]!=null?s:[0,0,0,0])})}});ct(da,"Line");class Bs extends Ar{constructor(e,t=e){super(Dt("marker",e),t)}height(e){return this.attr("markerHeight",e)}orient(e){return this.attr("orient",e)}ref(e,t){return this.attr("refX",e).attr("refY",t)}toString(){return"url(#"+this.id()+")"}update(e){return this.clear(),typeof e=="function"&&e.call(this,this),this}width(e){return this.attr("markerWidth",e)}}Qe({Container:{marker(...s){return this.defs().marker(...s)}},Defs:{marker:It(function(s,e,t){return this.put(new Bs).size(s,e).ref(s/2,e/2).viewbox(0,0,s,e).attr("orient","auto").update(t)})},marker:{marker(s,e,t,n){let i=["marker"];return s!=="all"&&i.push(s),i=i.join("-"),s=arguments[1]instanceof Bs?arguments[1]:this.defs().marker(e,t,n),this.attr(i,s)}}});ct(Bs,"Marker");function Wn(s,e){return function(t){return t==null?this[s]:(this[s]=t,e&&e.call(this),this)}}const kI={"-":function(s){return s},"<>":function(s){return-Math.cos(s*Math.PI)/2+.5},">":function(s){return Math.sin(s*Math.PI/2)},"<":function(s){return-Math.cos(s*Math.PI/2)+1},bezier:function(s,e,t,n){return function(i){return i<0?s>0?e/s*i:t>0?n/t*i:0:i>1?t<1?(1-n)/(1-t)*i+(n-t)/(1-t):s<1?(1-e)/(1-s)*i+(e-s)/(1-s):1:3*i*(1-i)**2*e+3*i**2*(1-i)*n+i**3}},steps:function(s,e="end"){e=e.split("-").reverse()[0];let t=s;return e==="none"?--t:e==="both"&&++t,(n,i=!1)=>{let r=Math.floor(n*s);const a=n*r%1===0;return(e==="start"||e==="both")&&++r,i&&a&&--r,n>=0&&r<0&&(r=0),n<=1&&r>t&&(r=t),r/t}}};class Jc{done(){return!1}}class $u extends Jc{constructor(e=Ho.ease){super(),this.ease=kI[e]||e}step(e,t,n){return typeof e!="number"?n<1?e:t:e+(t-e)*this.ease(n)}}class Us extends Jc{constructor(e){super(),this.stepper=e}done(e){return e.done}step(e,t,n,i){return this.stepper(e,t,n,i)}}function Fp(){const s=(this._duration||500)/1e3,e=this._overshoot||0,t=1e-10,n=Math.PI,i=Math.log(e/100+t),r=-i/Math.sqrt(n*n+i*i),a=3.9/(r*s);this.d=2*r*a,this.k=a*a}class II extends Us{constructor(e=500,t=0){super(),this.duration(e).overshoot(t)}step(e,t,n,i){if(typeof e=="string")return e;if(i.done=n===1/0,n===1/0)return t;if(n===0)return e;n>100&&(n=16),n/=1e3;const r=i.velocity||0,a=-this.d*r-this.k*(e-t),o=e+r*n+a*n*n/2;return i.velocity=r+a*n,i.done=Math.abs(t-o)+Math.abs(r)<.002,i.done?t:o}}Ye(II,{duration:Wn("_duration",Fp),overshoot:Wn("_overshoot",Fp)});class DI extends Us{constructor(e=.1,t=.01,n=0,i=1e3){super(),this.p(e).i(t).d(n).windup(i)}step(e,t,n,i){if(typeof e=="string")return e;if(i.done=n===1/0,n===1/0)return t;if(n===0)return e;const r=t-e;let a=(i.integral||0)+r*n;const o=(r-(i.error||0))/n,l=this._windup;return l!==!1&&(a=Math.max(-l,Math.min(a,l))),i.error=r,i.integral=a,i.done=Math.abs(r)<.001,i.done?t:e+(this.P*r+this.I*a+this.D*o)}}Ye(DI,{windup:Wn("_windup"),p:Wn("P"),i:Wn("I"),d:Wn("D")});const RI={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0},Yu={M:function(s,e,t){return e.x=t.x=s[0],e.y=t.y=s[1],["M",e.x,e.y]},L:function(s,e){return e.x=s[0],e.y=s[1],["L",s[0],s[1]]},H:function(s,e){return e.x=s[0],["H",s[0]]},V:function(s,e){return e.y=s[0],["V",s[0]]},C:function(s,e){return e.x=s[4],e.y=s[5],["C",s[0],s[1],s[2],s[3],s[4],s[5]]},S:function(s,e){return e.x=s[2],e.y=s[3],["S",s[0],s[1],s[2],s[3]]},Q:function(s,e){return e.x=s[2],e.y=s[3],["Q",s[0],s[1],s[2],s[3]]},T:function(s,e){return e.x=s[0],e.y=s[1],["T",s[0],s[1]]},Z:function(s,e,t){return e.x=t.x,e.y=t.y,["Z"]},A:function(s,e){return e.x=s[5],e.y=s[6],["A",s[0],s[1],s[2],s[3],s[4],s[5],s[6]]}},Eu="mlhvqtcsaz".split("");for(let s=0,e=Eu.length;s<e;++s)Yu[Eu[s]]=function(t){return function(n,i,r){if(t==="H")n[0]=n[0]+i.x;else if(t==="V")n[0]=n[0]+i.y;else if(t==="A")n[5]=n[5]+i.x,n[6]=n[6]+i.y;else for(let a=0,o=n.length;a<o;++a)n[a]=n[a]+(a%2?i.y:i.x);return Yu[t](n,i,r)}}(Eu[s].toUpperCase());function PI(s){const e=s.segment[0];return Yu[e](s.segment.slice(1),s.p,s.p0)}function Xu(s){return s.segment.length&&s.segment.length-1===RI[s.segment[0].toUpperCase()]}function NI(s,e){s.inNumber&&an(s,!1);const t=Gc.test(e);if(t)s.segment=[e];else{const n=s.lastCommand,i=n.toLowerCase(),r=n===i;s.segment=[i==="m"?r?"l":"L":n]}return s.inSegment=!0,s.lastCommand=s.segment[0],t}function an(s,e){if(!s.inNumber)throw new Error("Parser Error");s.number&&s.segment.push(parseFloat(s.number)),s.inNumber=e,s.number="",s.pointSeen=!1,s.hasExponent=!1,Xu(s)&&Ju(s)}function Ju(s){s.inSegment=!1,s.absolute&&(s.segment=PI(s)),s.segments.push(s.segment)}function MI(s){if(!s.segment.length)return!1;const e=s.segment[0].toUpperCase()==="A",t=s.segment.length;return e&&(t===4||t===5)}function xI(s){return s.lastToken.toUpperCase()==="E"}function LI(s,e=!0){let t=0,n="";const i={segment:[],inNumber:!1,number:"",lastToken:"",inSegment:!1,segments:[],pointSeen:!1,hasExponent:!1,absolute:e,p0:new Xt,p:new Xt};for(;i.lastToken=n,n=s.charAt(t++);)if(!(!i.inSegment&&NI(i,n))){if(n==="."){if(i.pointSeen||i.hasExponent){an(i,!1),--t;continue}i.inNumber=!0,i.pointSeen=!0,i.number+=n;continue}if(!isNaN(parseInt(n))){if(i.number==="0"||MI(i)){i.inNumber=!0,i.number=n,an(i,!0);continue}i.inNumber=!0,i.number+=n;continue}if(n===" "||n===","){i.inNumber&&an(i,!1);continue}if(n==="-"){if(i.inNumber&&!xI(i)){an(i,!1),--t;continue}i.number+=n,i.inNumber=!0;continue}if(n.toUpperCase()==="E"){i.number+=n,i.hasExponent=!0;continue}if(Gc.test(n)){if(i.inNumber)an(i,!1);else if(Xu(i))Ju(i);else throw new Error("parser Error");--t}}return i.inNumber&&an(i,!1),i.inSegment&&Xu(i)&&Ju(i),i.segments}function KI(s){let e="";for(let t=0,n=s.length;t<n;t++)e+=s[t][0],s[t][1]!=null&&(e+=s[t][1],s[t][2]!=null&&(e+=" ",e+=s[t][2],s[t][3]!=null&&(e+=" ",e+=s[t][3],e+=" ",e+=s[t][4],s[t][5]!=null&&(e+=" ",e+=s[t][5],e+=" ",e+=s[t][6],s[t][7]!=null&&(e+=" ",e+=s[t][7])))));return e+" "}class Tn extends An{bbox(){return Ui().path.setAttribute("d",this.toString()),new lr(Ui.nodes.path.getBBox())}move(e,t){const n=this.bbox();if(e-=n.x,t-=n.y,!isNaN(e)&&!isNaN(t))for(let i,r=this.length-1;r>=0;r--)i=this[r][0],i==="M"||i==="L"||i==="T"?(this[r][1]+=e,this[r][2]+=t):i==="H"?this[r][1]+=e:i==="V"?this[r][1]+=t:i==="C"||i==="S"||i==="Q"?(this[r][1]+=e,this[r][2]+=t,this[r][3]+=e,this[r][4]+=t,i==="C"&&(this[r][5]+=e,this[r][6]+=t)):i==="A"&&(this[r][6]+=e,this[r][7]+=t);return this}parse(e="M0 0"){return Array.isArray(e)&&(e=Array.prototype.concat.apply([],e).toString()),LI(e)}size(e,t){const n=this.bbox();let i,r;for(n.width=n.width===0?1:n.width,n.height=n.height===0?1:n.height,i=this.length-1;i>=0;i--)r=this[i][0],r==="M"||r==="L"||r==="T"?(this[i][1]=(this[i][1]-n.x)*e/n.width+n.x,this[i][2]=(this[i][2]-n.y)*t/n.height+n.y):r==="H"?this[i][1]=(this[i][1]-n.x)*e/n.width+n.x:r==="V"?this[i][1]=(this[i][1]-n.y)*t/n.height+n.y:r==="C"||r==="S"||r==="Q"?(this[i][1]=(this[i][1]-n.x)*e/n.width+n.x,this[i][2]=(this[i][2]-n.y)*t/n.height+n.y,this[i][3]=(this[i][3]-n.x)*e/n.width+n.x,this[i][4]=(this[i][4]-n.y)*t/n.height+n.y,r==="C"&&(this[i][5]=(this[i][5]-n.x)*e/n.width+n.x,this[i][6]=(this[i][6]-n.y)*t/n.height+n.y)):r==="A"&&(this[i][1]=this[i][1]*e/n.width,this[i][2]=this[i][2]*t/n.height,this[i][6]=(this[i][6]-n.x)*e/n.width+n.x,this[i][7]=(this[i][7]-n.y)*t/n.height+n.y);return this}toString(){return KI(this)}}const Om=s=>{const e=typeof s;return e==="number"?qe:e==="string"?Ot.isColor(s)?Ot:Mi.test(s)?Gc.test(s)?Tn:An:um.test(s)?qe:qu:qc.indexOf(s.constructor)>-1?s.constructor:Array.isArray(s)?An:e==="object"?ha:qu};class sn{constructor(e){this._stepper=e||new $u("-"),this._from=null,this._to=null,this._type=null,this._context=null,this._morphObj=null}at(e){return this._morphObj.morph(this._from,this._to,e,this._stepper,this._context)}done(){return this._context.map(this._stepper.done).reduce(function(t,n){return t&&n},!0)}from(e){return e==null?this._from:(this._from=this._set(e),this)}stepper(e){return e==null?this._stepper:(this._stepper=e,this)}to(e){return e==null?this._to:(this._to=this._set(e),this)}type(e){return e==null?this._type:(this._type=e,this)}_set(e){this._type||this.type(Om(e));let t=new this._type(e);return this._type===Ot&&(t=this._to?t[this._to[4]]():this._from?t[this._from[4]]():t),this._type===ha&&(t=this._to?t.align(this._to):this._from?t.align(this._from):t),t=t.toConsumable(),this._morphObj=this._morphObj||new this._type,this._context=this._context||Array.apply(null,Array(t.length)).map(Object).map(function(n){return n.done=!0,n}),t}}class qu{constructor(...e){this.init(...e)}init(e){return e=Array.isArray(e)?e[0]:e,this.value=e,this}toArray(){return[this.value]}valueOf(){return this.value}}class Ea{constructor(...e){this.init(...e)}init(e){return Array.isArray(e)&&(e={scaleX:e[0],scaleY:e[1],shear:e[2],rotate:e[3],translateX:e[4],translateY:e[5],originX:e[6],originY:e[7]}),Object.assign(this,Ea.defaults,e),this}toArray(){const e=this;return[e.scaleX,e.scaleY,e.shear,e.rotate,e.translateX,e.translateY,e.originX,e.originY]}}Ea.defaults={scaleX:1,scaleY:1,shear:0,rotate:0,translateX:0,translateY:0,originX:0,originY:0};const wI=(s,e)=>s[0]<e[0]?-1:s[0]>e[0]?1:0;class ha{constructor(...e){this.init(...e)}align(e){const t=this.values;for(let n=0,i=t.length;n<i;++n){if(t[n+1]===e[n+1]){if(t[n+1]===Ot&&e[n+7]!==t[n+7]){const o=e[n+7],l=new Ot(this.values.splice(n+3,5))[o]().toArray();this.values.splice(n+3,0,...l)}n+=t[n+2]+2;continue}if(!e[n+1])return this;const r=new e[n+1]().toArray(),a=t[n+2]+3;t.splice(n,a,e[n],e[n+1],e[n+2],...r),n+=t[n+2]+2}return this}init(e){if(this.values=[],Array.isArray(e)){this.values=e.slice();return}e=e||{};const t=[];for(const n in e){const i=Om(e[n]),r=new i(e[n]).toArray();t.push([n,i,r.length,...r])}return t.sort(wI),this.values=t.reduce((n,i)=>n.concat(i),[]),this}toArray(){return this.values}valueOf(){const e={},t=this.values;for(;t.length;){const n=t.shift(),i=t.shift(),r=t.shift(),a=t.splice(0,r);e[n]=new i(a)}return e}}const qc=[qu,Ea,ha];function BI(s=[]){qc.push(...[].concat(s))}function UI(){Ye(qc,{to(s){return new sn().type(this.constructor).from(this.toArray()).to(s)},fromArray(s){return this.init(s),this},toConsumable(){return this.toArray()},morph(s,e,t,n,i){const r=function(a,o){return n.step(a,e[o],t,i[o],i)};return this.fromArray(s.map(r))}})}class go extends Ur{constructor(e,t=e){super(Dt("path",e),t)}array(){return this._array||(this._array=new Tn(this.attr("d")))}clear(){return delete this._array,this}height(e){return e==null?this.bbox().height:this.size(this.bbox().width,e)}move(e,t){return this.attr("d",this.array().move(e,t))}plot(e){return e==null?this.array():this.clear().attr("d",typeof e=="string"?e:this._array=new Tn(e))}size(e,t){const n=vn(this,e,t);return this.attr("d",this.array().size(n.width,n.height))}width(e){return e==null?this.bbox().width:this.size(e,this.bbox().height)}x(e){return e==null?this.bbox().x:this.move(e,this.bbox().y)}y(e){return e==null?this.bbox().y:this.move(this.bbox().x,e)}}go.prototype.MorphArray=Tn;Qe({Container:{path:It(function(s){return this.put(new go).plot(s||new Tn)})}});ct(go,"Path");function FI(){return this._array||(this._array=new Gi(this.attr("points")))}function VI(){return delete this._array,this}function jI(s,e){return this.attr("points",this.array().move(s,e))}function WI(s){return s==null?this.array():this.clear().attr("points",typeof s=="string"?s:this._array=new Gi(s))}function HI(s,e){const t=vn(this,s,e);return this.attr("points",this.array().size(t.width,t.height))}var bm={__proto__:null,array:FI,clear:VI,move:jI,plot:WI,size:HI};class Sa extends Ur{constructor(e,t=e){super(Dt("polygon",e),t)}}Qe({Container:{polygon:It(function(s){return this.put(new Sa).plot(s||new Gi)})}});Ye(Sa,Xc);Ye(Sa,bm);ct(Sa,"Polygon");class Oa extends Ur{constructor(e,t=e){super(Dt("polyline",e),t)}}Qe({Container:{polyline:It(function(s){return this.put(new Oa).plot(s||new Gi)})}});Ye(Oa,Xc);Ye(Oa,bm);ct(Oa,"Polyline");class Rl extends Ur{constructor(e,t=e){super(Dt("rect",e),t)}}Ye(Rl,{rx:$c,ry:Yc});Qe({Container:{rect:It(function(s,e){return this.put(new Rl).size(s,e)})}});ct(Rl,"Rect");class Su{constructor(){this._first=null,this._last=null}first(){return this._first&&this._first.value}last(){return this._last&&this._last.value}push(e){const t=typeof e.next<"u"?e:{value:e,next:null,prev:null};return this._last?(t.prev=this._last,this._last.next=t,this._last=t):(this._last=t,this._first=t),t}remove(e){e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this._last&&(this._last=e.prev),e===this._first&&(this._first=e.next),e.prev=null,e.next=null}shift(){const e=this._first;return e?(this._first=e.next,this._first&&(this._first.prev=null),this._last=this._first?this._last:null,e.value):null}}const Tt={nextDraw:null,frames:new Su,timeouts:new Su,immediates:new Su,timer:()=>mt.window.performance||mt.window.Date,transforms:[],frame(s){const e=Tt.frames.push({run:s});return Tt.nextDraw===null&&(Tt.nextDraw=mt.window.requestAnimationFrame(Tt._draw)),e},timeout(s,e){e=e||0;const t=Tt.timer().now()+e,n=Tt.timeouts.push({run:s,time:t});return Tt.nextDraw===null&&(Tt.nextDraw=mt.window.requestAnimationFrame(Tt._draw)),n},immediate(s){const e=Tt.immediates.push(s);return Tt.nextDraw===null&&(Tt.nextDraw=mt.window.requestAnimationFrame(Tt._draw)),e},cancelFrame(s){s!=null&&Tt.frames.remove(s)},clearTimeout(s){s!=null&&Tt.timeouts.remove(s)},cancelImmediate(s){s!=null&&Tt.immediates.remove(s)},_draw(s){let e=null;const t=Tt.timeouts.last();for(;(e=Tt.timeouts.shift())&&(s>=e.time?e.run():Tt.timeouts.push(e),e!==t););let n=null;const i=Tt.frames.last();for(;n!==i&&(n=Tt.frames.shift());)n.run(s);let r=null;for(;r=Tt.immediates.shift();)r();Tt.nextDraw=Tt.timeouts.first()||Tt.frames.first()?mt.window.requestAnimationFrame(Tt._draw):null}},GI=function(s){const e=s.start,t=s.runner.duration(),n=e+t;return{start:e,duration:t,end:n,runner:s.runner}},zI=function(){const s=mt.window;return(s.performance||s.Date).now()};class vm extends Aa{constructor(e=zI){super(),this._timeSource=e,this._startTime=0,this._speed=1,this._persist=0,this._nextFrame=null,this._paused=!0,this._runners=[],this._runnerIds=[],this._lastRunnerId=-1,this._time=0,this._lastSourceTime=0,this._lastStepTime=0,this._step=this._stepFn.bind(this,!1),this._stepImmediate=this._stepFn.bind(this,!0)}active(){return!!this._nextFrame}finish(){return this.time(this.getEndTimeOfTimeline()+1),this.pause()}getEndTime(){const e=this.getLastRunnerInfo(),t=e?e.runner.duration():0;return(e?e.start:this._time)+t}getEndTimeOfTimeline(){const e=this._runners.map(t=>t.start+t.runner.duration());return Math.max(0,...e)}getLastRunnerInfo(){return this.getRunnerInfoById(this._lastRunnerId)}getRunnerInfoById(e){return this._runners[this._runnerIds.indexOf(e)]||null}pause(){return this._paused=!0,this._continue()}persist(e){return e==null?this._persist:(this._persist=e,this)}play(){return this._paused=!1,this.updateTime()._continue()}reverse(e){const t=this.speed();if(e==null)return this.speed(-t);const n=Math.abs(t);return this.speed(e?-n:n)}schedule(e,t,n){if(e==null)return this._runners.map(GI);let i=0;const r=this.getEndTime();if(t=t||0,n==null||n==="last"||n==="after")i=r;else if(n==="absolute"||n==="start")i=t,t=0;else if(n==="now")i=this._time;else if(n==="relative"){const l=this.getRunnerInfoById(e.id);l&&(i=l.start+t,t=0)}else if(n==="with-last"){const l=this.getLastRunnerInfo();i=l?l.start:this._time}else throw new Error('Invalid value for the "when" parameter');e.unschedule(),e.timeline(this);const a=e.persist(),o={persist:a===null?this._persist:a,start:i+t,runner:e};return this._lastRunnerId=e.id,this._runners.push(o),this._runners.sort((l,u)=>l.start-u.start),this._runnerIds=this._runners.map(l=>l.runner.id),this.updateTime()._continue(),this}seek(e){return this.time(this._time+e)}source(e){return e==null?this._timeSource:(this._timeSource=e,this)}speed(e){return e==null?this._speed:(this._speed=e,this)}stop(){return this.time(0),this.pause()}time(e){return e==null?this._time:(this._time=e,this._continue(!0))}unschedule(e){const t=this._runnerIds.indexOf(e.id);return t<0?this:(this._runners.splice(t,1),this._runnerIds.splice(t,1),e.timeline(null),this)}updateTime(){return this.active()||(this._lastSourceTime=this._timeSource()),this}_continue(e=!1){return Tt.cancelFrame(this._nextFrame),this._nextFrame=null,e?this._stepImmediate():this._paused?this:(this._nextFrame=Tt.frame(this._step),this)}_stepFn(e=!1){const t=this._timeSource();let n=t-this._lastSourceTime;e&&(n=0);const i=this._speed*n+(this._time-this._lastStepTime);this._lastSourceTime=t,e||(this._time+=i,this._time=this._time<0?0:this._time),this._lastStepTime=this._time,this.fire("time",this._time);for(let a=this._runners.length;a--;){const o=this._runners[a],l=o.runner;this._time-o.start<=0&&l.reset()}let r=!1;for(let a=0,o=this._runners.length;a<o;a++){const l=this._runners[a],u=l.runner;let c=i;const d=this._time-l.start;if(d<=0){r=!0;continue}else d<c&&(c=d);if(!u.active())continue;u.step(c).done?l.persist!==!0&&u.duration()-u.time()+this._time+l.persist<this._time&&(u.unschedule(),--a,--o):r=!0}return r&&!(this._speed<0&&this._time===0)||this._runnerIds.length&&this._speed<0&&this._time>0?this._continue():(this.pause(),this.fire("finished")),this}}Qe({Element:{timeline:function(s){return s==null?(this._timeline=this._timeline||new vm,this._timeline):(this._timeline=s,this)}}});class wr extends Aa{constructor(e){super(),this.id=wr.id++,e=e??Ho.duration,e=typeof e=="function"?new Us(e):e,this._element=null,this._timeline=null,this.done=!1,this._queue=[],this._duration=typeof e=="number"&&e,this._isDeclarative=e instanceof Us,this._stepper=this._isDeclarative?e:new $u,this._history={},this.enabled=!0,this._time=0,this._lastTime=0,this._reseted=!0,this.transforms=new Be,this.transformId=1,this._haveReversed=!1,this._reverse=!1,this._loopsDone=0,this._swing=!1,this._wait=0,this._times=1,this._frameId=null,this._persist=this._isDeclarative?!0:null}static sanitise(e,t,n){let i=1,r=!1,a=0;return e=e||Ho.duration,t=t||Ho.delay,n=n||"last",typeof e=="object"&&!(e instanceof Jc)&&(t=e.delay||t,n=e.when||n,r=e.swing||r,i=e.times||i,a=e.wait||a,e=e.duration||Ho.duration),{duration:e,delay:t,swing:r,times:i,wait:a,when:n}}active(e){return e==null?this.enabled:(this.enabled=e,this)}addTransform(e,t){return this.transforms.lmultiplyO(e),this}after(e){return this.on("finished",e)}animate(e,t,n){const i=wr.sanitise(e,t,n),r=new wr(i.duration);return this._timeline&&r.timeline(this._timeline),this._element&&r.element(this._element),r.loop(i).schedule(i.delay,i.when)}clearTransform(){return this.transforms=new Be,this}clearTransformsFromQueue(){(!this.done||!this._timeline||!this._timeline._runnerIds.includes(this.id))&&(this._queue=this._queue.filter(e=>!e.isTransform))}delay(e){return this.animate(0,e)}duration(){return this._times*(this._wait+this._duration)-this._wait}during(e){return this.queue(null,e)}ease(e){return this._stepper=new $u(e),this}element(e){return e==null?this._element:(this._element=e,e._prepareRunner(),this)}finish(){return this.step(1/0)}loop(e,t,n){return typeof e=="object"&&(t=e.swing,n=e.wait,e=e.times),this._times=e||1/0,this._swing=t||!1,this._wait=n||0,this._times===!0&&(this._times=1/0),this}loops(e){const t=this._duration+this._wait;if(e==null){const a=Math.floor(this._time/t),l=(this._time-a*t)/this._duration;return Math.min(a+l,this._times)}const n=Math.floor(e),i=e%1,r=t*n+this._duration*i;return this.time(r)}persist(e){return e==null?this._persist:(this._persist=e,this)}position(e){const t=this._time,n=this._duration,i=this._wait,r=this._times,a=this._swing,o=this._reverse;let l;if(e==null){const h=function(g){const f=a*Math.floor(g%(2*(i+n))/(i+n)),m=f&&!o||!f&&o,C=Math.pow(-1,m)*(g%(i+n))/n+m;return Math.max(Math.min(C,1),0)},p=r*(i+n)-i;return l=t<=0?Math.round(h(1e-5)):t<p?h(t):Math.round(h(p-1e-5)),l}const u=Math.floor(this.loops()),c=a&&u%2===0;return l=u+(c&&!o||o&&c?e:1-e),this.loops(l)}progress(e){return e==null?Math.min(1,this._time/this.duration()):this.time(e*this.duration())}queue(e,t,n,i){return this._queue.push({initialiser:e||Up,runner:t||Up,retarget:n,isTransform:i,initialised:!1,finished:!1}),this.timeline()&&this.timeline()._continue(),this}reset(){return this._reseted?this:(this.time(0),this._reseted=!0,this)}reverse(e){return this._reverse=e??!this._reverse,this}schedule(e,t,n){if(e instanceof vm||(n=t,t=e,e=this.timeline()),!e)throw Error("Runner cannot be scheduled without timeline");return e.schedule(this,t,n),this}step(e){if(!this.enabled)return this;e=e??16,this._time+=e;const t=this.position(),n=this._lastPosition!==t&&this._time>=0;this._lastPosition=t;const i=this.duration(),r=this._lastTime<=0&&this._time>0,a=this._lastTime<i&&this._time>=i;this._lastTime=this._time,r&&this.fire("start",this);const o=this._isDeclarative;this.done=!o&&!a&&this._time>=i,this._reseted=!1;let l=!1;return(n||o)&&(this._initialise(n),this.transforms=new Be,l=this._run(o?e:t),this.fire("step",this)),this.done=this.done||l&&o,a&&this.fire("finished",this),this}time(e){if(e==null)return this._time;const t=e-this._time;return this.step(t),this}timeline(e){return typeof e>"u"?this._timeline:(this._timeline=e,this)}unschedule(){const e=this.timeline();return e&&e.unschedule(this),this}_initialise(e){if(!(!e&&!this._isDeclarative))for(let t=0,n=this._queue.length;t<n;++t){const i=this._queue[t],r=this._isDeclarative||!i.initialised&&e;e=!i.finished,r&&e&&(i.initialiser.call(this),i.initialised=!0)}}_rememberMorpher(e,t){if(this._history[e]={morpher:t,caller:this._queue[this._queue.length-1]},this._isDeclarative){const n=this.timeline();n&&n.play()}}_run(e){let t=!0;for(let n=0,i=this._queue.length;n<i;++n){const r=this._queue[n],a=r.runner.call(this,e);r.finished=r.finished||a===!0,t=t&&r.finished}return t}_tryRetarget(e,t,n){if(this._history[e]){if(!this._history[e].caller.initialised){const r=this._queue.indexOf(this._history[e].caller);return this._queue.splice(r,1),!1}this._history[e].caller.retarget?this._history[e].caller.retarget.call(this,t,n):this._history[e].morpher.to(t),this._history[e].caller.finished=!1;const i=this.timeline();return i&&i.play(),!0}return!1}}wr.id=0;class Fs{constructor(e=new Be,t=-1,n=!0){this.transforms=e,this.id=t,this.done=n}clearTransformsFromQueue(){}}Ye([wr,Fs],{mergeWith(s){return new Fs(s.transforms.lmultiply(this.transforms),s.id)}});const km=(s,e)=>s.lmultiplyO(e),Im=s=>s.transforms;function $I(){const e=this._transformationRunners.runners.map(Im).reduce(km,new Be);this.transform(e),this._transformationRunners.merge(),this._transformationRunners.length()===1&&(this._frameId=null)}class YI{constructor(){this.runners=[],this.ids=[]}add(e){if(this.runners.includes(e))return;const t=e.id+1;return this.runners.push(e),this.ids.push(t),this}clearBefore(e){const t=this.ids.indexOf(e+1)||1;return this.ids.splice(0,t,0),this.runners.splice(0,t,new Fs).forEach(n=>n.clearTransformsFromQueue()),this}edit(e,t){const n=this.ids.indexOf(e+1);return this.ids.splice(n,1,e+1),this.runners.splice(n,1,t),this}getByID(e){return this.runners[this.ids.indexOf(e+1)]}length(){return this.ids.length}merge(){let e=null;for(let t=0;t<this.runners.length;++t){const n=this.runners[t];if(e&&n.done&&e.done&&(!n._timeline||!n._timeline._runnerIds.includes(n.id))&&(!e._timeline||!e._timeline._runnerIds.includes(e.id))){this.remove(n.id);const r=n.mergeWith(e);this.edit(e.id,r),e=r,--t}else e=n}return this}remove(e){const t=this.ids.indexOf(e+1);return this.ids.splice(t,1),this.runners.splice(t,1),this}}Qe({Element:{animate(s,e,t){const n=wr.sanitise(s,e,t),i=this.timeline();return new wr(n.duration).loop(n).element(this).timeline(i.play()).schedule(n.delay,n.when)},delay(s,e){return this.animate(0,s,e)},_clearTransformRunnersBefore(s){this._transformationRunners.clearBefore(s.id)},_currentTransform(s){return this._transformationRunners.runners.filter(e=>e.id<=s.id).map(Im).reduce(km,new Be)},_addRunner(s){this._transformationRunners.add(s),Tt.cancelImmediate(this._frameId),this._frameId=Tt.immediate($I.bind(this))},_prepareRunner(){this._frameId==null&&(this._transformationRunners=new YI().add(new Fs(new Be(this))))}}});const XI=(s,e)=>s.filter(t=>!e.includes(t));Ye(wr,{attr(s,e){return this.styleAttr("attr",s,e)},css(s,e){return this.styleAttr("css",s,e)},styleAttr(s,e,t){if(typeof e=="string")return this.styleAttr(s,{[e]:t});let n=e;if(this._tryRetarget(s,n))return this;let i=new sn(this._stepper).to(n),r=Object.keys(n);return this.queue(function(){i=i.from(this.element()[s](r))},function(a){return this.element()[s](i.at(a).valueOf()),i.done()},function(a){const o=Object.keys(a),l=XI(o,r);if(l.length){const c=this.element()[s](l),d=new ha(i.from()).valueOf();Object.assign(d,c),i.from(d)}const u=new ha(i.to()).valueOf();Object.assign(u,a),i.to(u),r=o,n=a}),this._rememberMorpher(s,i),this},zoom(s,e){if(this._tryRetarget("zoom",s,e))return this;let t=new sn(this._stepper).to(new qe(s));return this.queue(function(){t=t.from(this.element().zoom())},function(n){return this.element().zoom(t.at(n),e),t.done()},function(n,i){e=i,t.to(n)}),this._rememberMorpher("zoom",t),this},transform(s,e,t){if(e=s.relative||e,this._isDeclarative&&!e&&this._tryRetarget("transform",s))return this;const n=Be.isMatrixLike(s);t=s.affine!=null?s.affine:t??!n;const i=new sn(this._stepper).type(t?Ea:Be);let r,a,o,l,u;function c(){a=a||this.element(),r=r||ws(s,a),u=new Be(e?void 0:a),a._addRunner(this),e||a._clearTransformRunnersBefore(this)}function d(p){e||this.clearTransform();const{x:g,y:f}=new Xt(r).transform(a._currentTransform(this));let m=new Be({...s,origin:[g,f]}),C=this._isDeclarative&&o?o:u;if(t){m=m.decompose(g,f),C=C.decompose(g,f);const y=m.rotate,T=C.rotate,E=[y-360,y,y+360],b=E.map(R=>Math.abs(R-T)),v=Math.min(...b),I=b.indexOf(v);m.rotate=E[I]}e&&(n||(m.rotate=s.rotate||0),this._isDeclarative&&l&&(C.rotate=l)),i.from(C),i.to(m);const _=i.at(p);return l=_.rotate,o=new Be(_),this.addTransform(o),a._addRunner(this),i.done()}function h(p){(p.origin||"center").toString()!==(s.origin||"center").toString()&&(r=ws(p,a)),s={...p,origin:r}}return this.queue(c,d,h,!0),this._isDeclarative&&this._rememberMorpher("transform",i),this},x(s,e){return this._queueNumber("x",s)},y(s){return this._queueNumber("y",s)},dx(s=0){return this._queueNumberDelta("x",s)},dy(s=0){return this._queueNumberDelta("y",s)},dmove(s,e){return this.dx(s).dy(e)},_queueNumberDelta(s,e){if(e=new qe(e),this._tryRetarget(s,e))return this;const t=new sn(this._stepper).to(e);let n=null;return this.queue(function(){n=this.element()[s](),t.from(n),t.to(n+e)},function(i){return this.element()[s](t.at(i)),t.done()},function(i){t.to(n+new qe(i))}),this._rememberMorpher(s,t),this},_queueObject(s,e){if(this._tryRetarget(s,e))return this;const t=new sn(this._stepper).to(e);return this.queue(function(){t.from(this.element()[s]())},function(n){return this.element()[s](t.at(n)),t.done()}),this._rememberMorpher(s,t),this},_queueNumber(s,e){return this._queueObject(s,new qe(e))},cx(s){return this._queueNumber("cx",s)},cy(s){return this._queueNumber("cy",s)},move(s,e){return this.x(s).y(e)},center(s,e){return this.cx(s).cy(e)},size(s,e){let t;return(!s||!e)&&(t=this._element.bbox()),s||(s=t.width/t.height*e),e||(e=t.height/t.width*s),this.width(s).height(e)},width(s){return this._queueNumber("width",s)},height(s){return this._queueNumber("height",s)},plot(s,e,t,n){if(arguments.length===4)return this.plot([s,e,t,n]);if(this._tryRetarget("plot",s))return this;const i=new sn(this._stepper).type(this._element.MorphArray).to(s);return this.queue(function(){i.from(this._element.array())},function(r){return this._element.plot(i.at(r)),i.done()}),this._rememberMorpher("plot",i),this},leading(s){return this._queueNumber("leading",s)},viewbox(s,e,t,n){return this._queueObject("viewbox",new lr(s,e,t,n))},update(s){return typeof s!="object"?this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]}):(s.opacity!=null&&this.attr("stop-opacity",s.opacity),s.color!=null&&this.attr("stop-color",s.color),s.offset!=null&&this.attr("offset",s.offset),this)}});Ye(wr,{rx:$c,ry:Yc,from:Em,to:Sm});ct(wr,"Runner");class Zc extends Ar{constructor(e,t=e){super(Dt("svg",e),t),this.namespace()}defs(){return this.isRoot()?$r(this.node.querySelector("defs"))||this.put(new kl):this.root().defs()}isRoot(){return!this.node.parentNode||!(this.node.parentNode instanceof mt.window.SVGElement)&&this.node.parentNode.nodeName!=="#document-fragment"}namespace(){return this.isRoot()?this.attr({xmlns:vl,version:"1.1"}).attr("xmlns:xlink",po,Wo).attr("xmlns:svgjs",am,Wo):this.root().namespace()}removeNamespace(){return this.attr({xmlns:null,version:null}).attr("xmlns:xlink",null,Wo).attr("xmlns:svgjs",null,Wo)}root(){return this.isRoot()?this:super.root()}}Qe({Container:{nested:It(function(){return this.put(new Zc)})}});ct(Zc,"Svg",!0);let Qc=class extends Ar{constructor(e,t=e){super(Dt("symbol",e),t)}};Qe({Container:{symbol:It(function(){return this.put(new Qc)})}});ct(Qc,"Symbol");function JI(s){return this._build===!1&&this.clear(),this.node.appendChild(mt.document.createTextNode(s)),this}function qI(){return this.node.getComputedTextLength()}function ZI(s,e=this.bbox()){return s==null?e.x:this.attr("x",this.attr("x")+s-e.x)}function QI(s,e=this.bbox()){return s==null?e.y:this.attr("y",this.attr("y")+s-e.y)}function e0(s,e,t=this.bbox()){return this.x(s,t).y(e,t)}function t0(s,e=this.bbox()){return s==null?e.cx:this.attr("x",this.attr("x")+s-e.cx)}function r0(s,e=this.bbox()){return s==null?e.cy:this.attr("y",this.attr("y")+s-e.cy)}function i0(s,e,t=this.bbox()){return this.cx(s,t).cy(e,t)}function n0(s){return this.attr("x",s)}function o0(s){return this.attr("y",s)}function a0(s,e){return this.ax(s).ay(e)}function s0(s){return this._build=!!s,this}var Dm={__proto__:null,plain:JI,length:qI,x:ZI,y:QI,move:e0,cx:t0,cy:r0,center:i0,ax:n0,ay:o0,amove:a0,build:s0};class ii extends Ur{constructor(e,t=e){super(Dt("text",e),t),this.dom.leading=new qe(1.3),this._rebuild=!0,this._build=!1}leading(e){return e==null?this.dom.leading:(this.dom.leading=new qe(e),this.rebuild())}rebuild(e){if(typeof e=="boolean"&&(this._rebuild=e),this._rebuild){const t=this;let n=0;const i=this.dom.leading;this.each(function(r){const a=mt.window.getComputedStyle(this.node).getPropertyValue("font-size"),o=i*new qe(a);this.dom.newLined&&(this.attr("x",t.attr("x")),this.text()===`
`?n+=o:(this.attr("dy",r?o+n:0),n=0))}),this.fire("rebuild")}return this}setData(e){return this.dom=e,this.dom.leading=new qe(e.leading||1.3),this}text(e){if(e===void 0){const t=this.node.childNodes;let n=0;e="";for(let i=0,r=t.length;i<r;++i){if(t[i].nodeName==="textPath"){i===0&&(n=1);continue}i!==n&&t[i].nodeType!==3&&$r(t[i]).dom.newLined===!0&&(e+=`
`),e+=t[i].textContent}return e}if(this.clear().build(!0),typeof e=="function")e.call(this,this);else{e=(e+"").split(`
`);for(let t=0,n=e.length;t<n;t++)this.newLine(e[t])}return this.build(!1).rebuild()}}Ye(ii,Dm);Qe({Container:{text:It(function(s=""){return this.put(new ii).text(s)}),plain:It(function(s=""){return this.put(new ii).plain(s)})}});ct(ii,"Text");class Pl extends Ur{constructor(e,t=e){super(Dt("tspan",e),t),this._build=!1}dx(e){return this.attr("dx",e)}dy(e){return this.attr("dy",e)}newLine(){this.dom.newLined=!0;const e=this.parent();if(!(e instanceof ii))return this;const t=e.index(this),n=mt.window.getComputedStyle(this.node).getPropertyValue("font-size"),i=e.dom.leading*new qe(n);return this.dy(t?i:0).attr("x",e.x())}text(e){return e==null?this.node.textContent+(this.dom.newLined?`
`:""):(typeof e=="function"?(this.clear().build(!0),e.call(this,this),this.build(!1)):this.plain(e),this)}}Ye(Pl,Dm);Qe({Tspan:{tspan:It(function(s=""){const e=new Pl;return this._build||this.clear(),this.put(e).text(s)})},Text:{newLine:function(s=""){return this.tspan(s).newLine()}}});ct(Pl,"Tspan");class ed extends Ur{constructor(e,t=e){super(Dt("circle",e),t)}radius(e){return this.attr("r",e)}rx(e){return this.attr("r",e)}ry(e){return this.rx(e)}size(e){return this.radius(new qe(e).divide(2))}}Ye(ed,{x:fm,y:mm,cx:Cm,cy:_m,width:ym,height:Am});Qe({Container:{circle:It(function(s=0){return this.put(new ed).size(s).move(0,0)})}});ct(ed,"Circle");class Zu extends Ar{constructor(e,t=e){super(Dt("clipPath",e),t)}remove(){return this.targets().forEach(function(e){e.unclip()}),super.remove()}targets(){return kn('svg [clip-path*="'+this.id()+'"]')}}Qe({Container:{clip:It(function(){return this.defs().put(new Zu)})},Element:{clipper(){return this.reference("clip-path")},clipWith(s){const e=s instanceof Zu?s:this.parent().clip().add(s);return this.attr("clip-path",'url("#'+e.id()+'")')},unclip(){return this.attr("clip-path",null)}}});ct(Zu,"ClipPath");class Rm extends Ir{constructor(e,t=e){super(Dt("foreignObject",e),t)}}Qe({Container:{foreignObject:It(function(s,e){return this.put(new Rm).size(s,e)})}});ct(Rm,"ForeignObject");function l0(s,e){return this.children().forEach((t,n)=>{let i;try{i=t.bbox()}catch{return}const r=new Be(t),a=r.translate(s,e).transform(r.inverse()),o=new Xt(i.x,i.y).transform(a);t.move(o.x,o.y)}),this}function u0(s){return this.dmove(s,0)}function c0(s){return this.dmove(0,s)}function d0(s,e=this.bbox()){return s==null?e.height:this.size(e.width,s,e)}function h0(s=0,e=0,t=this.bbox()){const n=s-t.x,i=e-t.y;return this.dmove(n,i)}function p0(s,e,t=this.bbox()){const n=vn(this,s,e,t),i=n.width/t.width,r=n.height/t.height;return this.children().forEach((a,o)=>{const l=new Xt(t).transform(new Be(a).inverse());a.scale(i,r,l.x,l.y)}),this}function g0(s,e=this.bbox()){return s==null?e.width:this.size(s,e.height,e)}function f0(s,e=this.bbox()){return s==null?e.x:this.move(s,e.y,e)}function m0(s,e=this.bbox()){return s==null?e.y:this.move(e.x,s,e)}var Pm={__proto__:null,dmove:l0,dx:u0,dy:c0,height:d0,move:h0,size:p0,width:g0,x:f0,y:m0};class Nl extends Ar{constructor(e,t=e){super(Dt("g",e),t)}}Ye(Nl,Pm);Qe({Container:{group:It(function(){return this.put(new Nl)})}});ct(Nl,"G");class Vs extends Ar{constructor(e,t=e){super(Dt("a",e),t)}target(e){return this.attr("target",e)}to(e){return this.attr("href",e,po)}}Ye(Vs,Pm);Qe({Container:{link:It(function(s){return this.put(new Vs).to(s)})},Element:{unlink(){const s=this.linker();if(!s)return this;const e=s.parent();if(!e)return this.remove();const t=e.index(s);return e.add(this,t),s.remove(),this},linkTo(s){let e=this.linker();return e||(e=new Vs,this.wrap(e)),typeof s=="function"?s.call(e,e):e.to(s),this},linker(){const s=this.parent();return s&&s.node.nodeName.toLowerCase()==="a"?s:null}}});ct(Vs,"A");class Qu extends Ar{constructor(e,t=e){super(Dt("mask",e),t)}remove(){return this.targets().forEach(function(e){e.unmask()}),super.remove()}targets(){return kn('svg [mask*="'+this.id()+'"]')}}Qe({Container:{mask:It(function(){return this.defs().put(new Qu)})},Element:{masker(){return this.reference("mask")},maskWith(s){const e=s instanceof Qu?s:this.parent().mask().add(s);return this.attr("mask",'url("#'+e.id()+'")')},unmask(){return this.attr("mask",null)}}});ct(Qu,"Mask");class Nm extends Ir{constructor(e,t=e){super(Dt("stop",e),t)}update(e){return(typeof e=="number"||e instanceof qe)&&(e={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),e.opacity!=null&&this.attr("stop-opacity",e.opacity),e.color!=null&&this.attr("stop-color",e.color),e.offset!=null&&this.attr("offset",new qe(e.offset)),this}}Qe({Gradient:{stop:function(s,e,t){return this.put(new Nm).update(s,e,t)}}});ct(Nm,"Stop");function C0(s,e){if(!s)return"";if(!e)return s;let t=s+"{";for(const n in e)t+=nm(n)+":"+e[n]+";";return t+="}",t}class ec extends Ir{constructor(e,t=e){super(Dt("style",e),t)}addText(e=""){return this.node.textContent+=e,this}font(e,t,n={}){return this.rule("@font-face",{fontFamily:e,src:t,...n})}rule(e,t){return this.addText(C0(e,t))}}Qe("Dom",{style(s,e){return this.put(new ec).rule(s,e)},fontface(s,e,t){return this.put(new ec).font(s,e,t)}});ct(ec,"Style");class td extends ii{constructor(e,t=e){super(Dt("textPath",e),t)}array(){const e=this.track();return e?e.array():null}plot(e){const t=this.track();let n=null;return t&&(n=t.plot(e)),e==null?n:this}track(){return this.reference("href")}}Qe({Container:{textPath:It(function(s,e){return s instanceof ii||(s=this.text(s)),s.path(e)})},Text:{path:It(function(s,e=!0){const t=new td;s instanceof go||(s=this.defs().path(s)),t.attr("href","#"+s,po);let n;if(e)for(;n=this.node.firstChild;)t.node.appendChild(n);return this.put(t)}),textPath(){return this.findOne("textPath")}},Path:{text:It(function(s){return s instanceof ii||(s=new ii().addTo(this.parent()).text(s)),s.path(this)}),targets(){return kn("svg textPath").filter(s=>(s.attr("href")||"").includes(this.id()))}}});td.prototype.MorphArray=Tn;ct(td,"TextPath");class Mm extends Ur{constructor(e,t=e){super(Dt("use",e),t)}use(e,t){return this.attr("href",(t||"")+"#"+e,po)}}Qe({Container:{use:It(function(s,e){return this.put(new Mm).use(s,e)})}});ct(Mm,"Use");const Vp=Cr;Ye([Zc,Qc,Dl,ca,Bs],kr("viewbox"));Ye([da,Oa,Sa,go],kr("marker"));Ye(ii,kr("Text"));Ye(go,kr("Path"));Ye(kl,kr("Defs"));Ye([ii,Pl],kr("Tspan"));Ye([Rl,Il,Ta,wr],kr("radius"));Ye(Aa,kr("EventTarget"));Ye(Hi,kr("Dom"));Ye(Ir,kr("Element"));Ye(Ur,kr("Shape"));Ye([Ar,Tm],kr("Container"));Ye(Ta,kr("Gradient"));Ye(wr,kr("Runner"));yn.extend(hk());BI([qe,Ot,lr,Be,An,Gi,Tn,Xt]);UI();const jp=s=>(s.changedTouches&&(s=s.changedTouches[0]),{x:s.clientX,y:s.clientY});class _0{constructor(e){e.remember("_draggable",this),this.el=e,this.drag=this.drag.bind(this),this.startDrag=this.startDrag.bind(this),this.endDrag=this.endDrag.bind(this)}init(e){e?(this.el.on("mousedown.drag",this.startDrag),this.el.on("touchstart.drag",this.startDrag)):(this.el.off("mousedown.drag"),this.el.off("touchstart.drag"))}startDrag(e){const t=!e.type.indexOf("mouse");if(t&&(e.which||e.buttons)!==1||this.el.dispatch("beforedrag",{event:e,handler:this}).defaultPrevented)return;e.preventDefault(),e.stopPropagation(),this.init(!1),this.box=this.el.bbox(),this.lastClick=this.el.point(jp(e));const n=(t?"mousemove":"touchmove")+".drag",i=(t?"mouseup":"touchcancel.drag touchend")+".drag";ua(window,n,this.drag),ua(window,i,this.endDrag),this.el.fire("dragstart",{event:e,handler:this,box:this.box})}drag(e){const{box:t,lastClick:n}=this,i=this.el.point(jp(e)),r=t.x+(i.x-n.x),a=t.y+(i.y-n.y),o=new lr(r,a,t.w,t.h);if(!this.el.dispatch("dragmove",{event:e,handler:this,box:o}).defaultPrevented)return this.move(r,a),o}move(e,t){this.el.type==="svg"?Nl.prototype.move.call(this.el,e,t):this.el.move(e,t)}endDrag(e){const t=this.drag(e);this.el.fire("dragend",{event:e,handler:this,box:t}),_i(window,"mousemove.drag"),_i(window,"touchmove.drag"),_i(window,"mouseup.drag"),_i(window,"touchend.drag"),this.init(!0)}}Ye(Ir,{draggable(s=!0){return(this.remember("_draggable")||new _0(this)).init(s),this}});class xt extends Ir{constructor(e){super(Dt("filter",e),e),this.$source="SourceGraphic",this.$sourceAlpha="SourceAlpha",this.$background="BackgroundImage",this.$backgroundAlpha="BackgroundAlpha",this.$fill="FillPaint",this.$stroke="StrokePaint",this.$autoSetIn=!0}put(e,t){return e=super.put(e,t),!e.attr("in")&&this.$autoSetIn&&e.attr("in",this.$source),e.attr("result")||e.attr("result",e.id()),e}remove(){return this.targets().each("unfilter"),super.remove()}targets(){return kn('svg [filter*="'+this.id()+'"]')}toString(){return"url(#"+this.id()+")"}}class rd extends Ir{constructor(e,t){super(e,t),this.result(this.id())}in(e){if(e==null){const t=this.attr("in");return this.parent()&&this.parent().find(`[result="${t}"]`)[0]||t}return this.attr("in",e)}result(e){return this.attr("result",e)}toString(){return this.result()}}const zr=s=>function(...e){for(let t=s.length;t--;)e[t]!=null&&this.attr(s[t],e[t])},y0={blend:zr(["in","in2","mode"]),colorMatrix:zr(["type","values"]),composite:zr(["in","in2","operator"]),convolveMatrix:function(s){s=new An(s).toString(),this.attr({order:Math.sqrt(s.split(" ").length),kernelMatrix:s})},diffuseLighting:zr(["surfaceScale","lightingColor","diffuseConstant","kernelUnitLength"]),displacementMap:zr(["in","in2","scale","xChannelSelector","yChannelSelector"]),dropShadow:zr(["in","dx","dy","stdDeviation"]),flood:zr(["flood-color","flood-opacity"]),gaussianBlur:function(s=0,e=s){this.attr("stdDeviation",s+" "+e)},image:function(s){this.attr("href",s,gk.xlink)},morphology:zr(["operator","radius"]),offset:zr(["dx","dy"]),specularLighting:zr(["surfaceScale","lightingColor","diffuseConstant","specularExponent","kernelUnitLength"]),tile:zr([]),turbulence:zr(["baseFrequency","numOctaves","seed","stitchTiles","type"])},A0=["blend","colorMatrix","componentTransfer","composite","convolveMatrix","diffuseLighting","displacementMap","dropShadow","flood","gaussianBlur","image","merge","morphology","offset","specularLighting","tile","turbulence"];A0.forEach(s=>{const e=bl.capitalize(s),t=y0[s];xt[e+"Effect"]=class extends rd{constructor(n){super(Dt("fe"+e,n),n)}update(n){return t.apply(this,n),this}},xt.prototype[s]=It(function(n,...i){const r=new xt[e+"Effect"];return n==null?this.put(r):(typeof n=="function"?n.call(r,r):i.unshift(n),this.put(r).update(i))})});Ye(xt,{merge(s){const e=this.put(new xt.MergeEffect);return typeof s=="function"?(s.call(e,e),e):((s instanceof Array?s:[...arguments]).forEach(n=>{n instanceof xt.MergeNode?e.put(n):e.mergeNode(n)}),e)},componentTransfer(s={}){const e=this.put(new xt.ComponentTransferEffect);if(typeof s=="function")return s.call(e,e),e;if(!s.r&&!s.g&&!s.b&&!s.a){const t=s;s={r:t,g:t,b:t,a:t}}for(const t in s)e.add(new xt["Func"+t.toUpperCase()](s[t]));return e}});const T0=["distantLight","pointLight","spotLight","mergeNode","FuncR","FuncG","FuncB","FuncA"];T0.forEach(s=>{const e=bl.capitalize(s);xt[e]=class extends rd{constructor(t){super(Dt("fe"+e,t),t)}}});const E0=["funcR","funcG","funcB","funcA"];E0.forEach(function(s){const e=xt[bl.capitalize(s)],t=It(function(){return this.put(new e)});xt.ComponentTransferEffect.prototype[s]=t});const S0=["distantLight","pointLight","spotLight"];S0.forEach(s=>{const e=xt[bl.capitalize(s)],t=It(function(){return this.put(new e)});xt.DiffuseLightingEffect.prototype[s]=t,xt.SpecularLightingEffect.prototype[s]=t});Ye(xt.MergeEffect,{mergeNode(s){return this.put(new xt.MergeNode).attr("in",s)}});Ye(kl,{filter:function(s){const e=this.put(new xt);return typeof s=="function"&&s.call(e,e),e}});Ye(Ar,{filter:function(s){return this.defs().filter(s)}});Ye(Ir,{filterWith:function(s){const e=s instanceof xt?s:this.defs().filter(s);return this.attr("filter",e)},unfilter:function(s){return this.attr("filter",null)},filterer(){return this.reference("filter")}});const O0={blend:function(s,e){return this.parent()&&this.parent().blend(this,s,e)},colorMatrix:function(s,e){return this.parent()&&this.parent().colorMatrix(s,e).in(this)},componentTransfer:function(s){return this.parent()&&this.parent().componentTransfer(s).in(this)},composite:function(s,e){return this.parent()&&this.parent().composite(this,s,e)},convolveMatrix:function(s){return this.parent()&&this.parent().convolveMatrix(s).in(this)},diffuseLighting:function(s,e,t,n){return this.parent()&&this.parent().diffuseLighting(s,t,n).in(this)},displacementMap:function(s,e,t,n){return this.parent()&&this.parent().displacementMap(this,s,e,t,n)},dropShadow:function(s,e,t){return this.parent()&&this.parent().dropShadow(this,s,e,t).in(this)},flood:function(s,e){return this.parent()&&this.parent().flood(s,e)},gaussianBlur:function(s,e){return this.parent()&&this.parent().gaussianBlur(s,e).in(this)},image:function(s){return this.parent()&&this.parent().image(s)},merge:function(s){return s=s instanceof Array?s:[...s],this.parent()&&this.parent().merge(this,...s)},morphology:function(s,e){return this.parent()&&this.parent().morphology(s,e).in(this)},offset:function(s,e){return this.parent()&&this.parent().offset(s,e).in(this)},specularLighting:function(s,e,t,n,i){return this.parent()&&this.parent().specularLighting(s,t,n,i).in(this)},tile:function(){return this.parent()&&this.parent().tile().in(this)},turbulence:function(s,e,t,n,i){return this.parent()&&this.parent().turbulence(s,e,t,n,i).in(this)}};Ye(rd,O0);Ye(xt.MergeEffect,{in:function(s){return s instanceof xt.MergeNode?this.add(s,0):this.add(new xt.MergeNode().in(s),0),this}});Ye([xt.CompositeEffect,xt.BlendEffect,xt.DisplacementMapEffect],{in2:function(s){if(s==null){const e=this.attr("in2");return this.parent()&&this.parent().find(`[result="${e}"]`)[0]||e}return this.attr("in2",s)}});xt.filter={sepiatone:[.343,.669,.119,0,0,.249,.626,.13,0,0,.172,.334,.111,0,0,0,0,0,1,0]};class Wp{constructor(e){oe(this,"programError");oe(this,"empty");oe(this,"simpleKekule");oe(this,"kekuleMimeCompressed");oe(this,"perspectiveCorrect");this.empty=!1,this.simpleKekule="",this.kekuleMimeCompressed="",this.perspectiveCorrect=!1,Object.assign(this,e)}}class Ou{constructor(e){oe(this,"programError");oe(this,"empty");oe(this,"smiles");oe(this,"inchi");oe(this,"mol");oe(this,"kekuleMime");oe(this,"svg");oe(this,"atomNums");oe(this,"perspectiveCorrect");oe(this,"blindComparisonResult");this.empty=!1,this.smiles="",this.inchi="",this.mol="",this.kekuleMime="",this.svg="",this.atomNums=[],this.perspectiveCorrect=!0,Object.assign(this,e)}}class bu{constructor(e){oe(this,"programError");oe(this,"empty");oe(this,"smiles");oe(this,"inchi");oe(this,"mol");oe(this,"kekuleMime");oe(this,"svg");oe(this,"atomNums");oe(this,"perspectiveCorrect");oe(this,"comparisonResult");oe(this,"blindComparisonResult");this.empty=!1,this.smiles="",this.inchi="",this.mol="",this.kekuleMime="",this.svg="",this.atomNums=[],this.perspectiveCorrect=!0,Object.assign(this,e)}}class zt{constructor(e){oe(this,"node");oe(this,"nodeError");oe(this,"nodeCountError");oe(this,"connector");oe(this,"connectorError");oe(this,"connectorCountError");oe(this,"lonePairCountError");oe(this,"lonePairNodeError");oe(this,"connectorStereochemistryError");this.node=null,this.nodeError=0,this.nodeCountError=0,this.connector=null,this.connectorError=0,this.connectorCountError=0,this.lonePairCountError=0,this.lonePairNodeError=null,this.connectorStereochemistryError=0,Object.assign(this,e)}static toStringOutput(e){return{node:e.node?e.node.symbol:"",nodeError:e.nodeError,nodeCountError:e.nodeCountError,connector:e.connector?e.connector.getConnectedChemNodes().map(t=>t.symbol).join(","):"",connectorError:e.connectorError,connectorCountError:e.connectorCountError,lonePairCountError:e.lonePairCountError,lonePairNodeError:e.lonePairNodeError?e.lonePairNodeError.symbol:"",connectorStereochemistryError:e.connectorStereochemistryError}}}const Hp=["C=O","N","N(=O)[O-]","[CH3-]","FB(F)F","C(F)(F)C(F)(F)CCl","P(Cl)(Cl)(Cl)(Cl)Cl","S(F)(F)(F)F","Cl(F)(F)F","I[I-]I","S(F)(F)(F)(F)(F)F","FBr(F)(F)(F)(F)","F[Xe](F)(F)(F)"],b0=[{smiles:"C=O",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:08 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1 2","LSSR":"LSSR","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":199.44668077630686,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":121.78177781466573,"y":214.72243186433545,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":121.78177781466573,"y":185.27756813566455,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":130.28177781466573,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":235.1357707045137,"y":138.1873262231813,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":235.1357707045137,"y":261.8126737768187,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"N",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:08 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":219.80516213204118,"y":165.11612763992733,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":219.80516213204118,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":300.6779921948348,"y":210.75469877828152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":145.50552014495588,"y":225.01304594186382,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":134.01132552816813,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}},{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 17:16:49 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":219.80516213204118,"y":165.11612763992733,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":219.80516213204118,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":300.6779921948348,"y":210.75469877828152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":145.50552014495588,"y":225.01304594186382,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":134.01132552816813,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!1}},{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 17:18:45 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":219.80516213204118,"y":165.11612763992733,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":219.80516213204118,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":300.6779921948348,"y":210.75469877828152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":145.50552014495588,"y":225.01304594186382,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":134.01132552816813,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!1}},{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 17:19:54 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":219.80516213204118,"y":165.11612763992733,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":219.80516213204118,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":300.6779921948348,"y":210.75469877828152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":145.50552014495588,"y":225.01304594186382,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":134.01132552816813,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt({connectorStereochemistryError:1}),perspectiveTest:{pass:!1}},{tryMatchWith:'{"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":170,"y":204,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":120,"y":241,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":178,"y":251,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":221,"y":220,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt({lonePairCountError:1}),perspectiveTest:{pass:!1}}]},{smiles:"N(=O)[O-]",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:08 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"3 2 1","LSSR":"LSSR","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":199.99729512640513,"y":158.11063323664067,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":199.99751106332351,"y":175.11063323526923,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"N"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":279.3896675687836,"y":203.9441343048989,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":264.6681867549958,"y":229.44468337054215,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":264.6675527281235,"y":212.44468338236538,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"O"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.8351232147242,"y":227.16700727705395,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":120.61261231386442,"y":220.9448703885366,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":126.83474920238177,"y":197.7223594876768,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":135.334936208553,"y":212.44468338236538,"__type__":"object"},"charge":-1,"parity":null,"isotopeId":"O"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"[CH3-]",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:09 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":219.80516213204118,"y":165.1161276399273,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":219.80516213204118,"y":182.1161276399273,"__type__":"object"},"charge":-1,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":300.6779921948348,"y":210.75469877828152,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":145.50552014495585,"y":225.01304594186385,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":134.01132552816813,"y":182.11612763992733,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"FB(F)F",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:09 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1 2 1 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":274.83628798042383,"y":137.1660951176109,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":298.0584877586665,"y":143.38939307443297,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":291.8351898018444,"y":166.61159285267564,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":283.3357388911341,"y":151.88884398514327,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":199.99759444219924,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"B"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":216.99759444219924,"y":296.22231202971346,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":199.99759444219924,"y":313.22231202971346,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":182.99759444219924,"y":296.22231202971346,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":199.99759444219924,"y":296.22231202971346,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":108.16888521829618,"y":166.61116787983184,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":101.94674832977883,"y":143.38865697897205,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":125.16925923063862,"y":137.1665200904547,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":116.6690722244674,"y":151.88884398514327,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"C(F)(F)C(F)(F)CCl",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:10 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"5 2 2 6 3 3 4 1","LSSR":"LSSR","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":232.31751145482178,"y":207.4572573859686,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":249.31751145482178,"y":245.29717826739693,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":232.31751145482178,"y":262.29717826739693,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":215.31751145482178,"y":245.29717826739693,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":232.31751145482178,"y":245.29717826739693,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":256.587844215332,"y":173.814865080919,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":279.81027607966746,"y":180.03729694525444,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":273.587844215332,"y":203.2597288095899,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":265.087844215332,"y":188.53729694525444,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200.11175473590015,"y":188.86270962677597,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":166.79488308201894,"y":165.15713991402555,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":173.0170199705363,"y":141.93462901316576,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":196.23953087139608,"y":148.15676590168312,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":181.5172069767075,"y":156.65695290785433,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":203.98397860040419,"y":148.15676590168312,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":227.20648950126397,"y":141.93462901316576,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":233.42862638978133,"y":165.15713991402555,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":218.70630249509276,"y":156.65695290785433,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":167.90227910742666,"y":207.4572573859686,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":184.90227910742666,"y":245.94798744407328,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":167.90227910742666,"y":262.9479874440733,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":150.90227910742666,"y":245.94798744407328,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":167.90227910742666,"y":245.94798744407328,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":270.1574323362501,"y":207.4572573859686,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":134.56832906689874,"y":188.21189235691628,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":129.411549049322,"y":207.4572573859686,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"H"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,8]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[3,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,6]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[6,7]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[6,9]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[6,10]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"P(Cl)(Cl)(Cl)(Cl)Cl",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:10 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1 1 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"P"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":224.4933428043215,"y":251.12669021550462,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":207.4933428043215,"y":268.1266902155046,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":190.4933428043215,"y":251.12669021550462,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":251.12669021550462,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":190.4933428043215,"y":148.87330978449538,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":207.4933428043215,"y":131.87330978449538,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":224.4933428043215,"y":148.87330978449538,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":148.87330978449538,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":258.6200330198261,"y":183,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":275.6200330198261,"y":200,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":258.6200330198261,"y":217,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":258.6200330198261,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":153.63562684706832,"y":198.48841663808648,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.47519473024425,"y":176.69929964818965,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":165.26431172014108,"y":166.53886753136558,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":159.4499692836047,"y":182.51364208472603,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":165.26431172014108,"y":233.46113246863442,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.47519473024425,"y":223.30070035181035,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":153.63562684706832,"y":201.51158336191352,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":159.4499692836047,"y":217.48635791527397,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,5]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}},{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 17:01:29 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1 1 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"P"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":224.4933428043215,"y":251.12669021550462,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":207.4933428043215,"y":268.1266902155046,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":190.4933428043215,"y":251.12669021550462,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":251.12669021550462,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":190.4933428043215,"y":148.87330978449538,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":207.4933428043215,"y":131.87330978449538,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":224.4933428043215,"y":148.87330978449538,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":148.87330978449538,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":258.6200330198261,"y":183,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":275.6200330198261,"y":200,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":258.6200330198261,"y":217,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":258.6200330198261,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":153.63562684706832,"y":198.48841663808648,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.47519473024425,"y":176.69929964818965,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":165.26431172014108,"y":166.53886753136558,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":159.4499692836047,"y":182.51364208472603,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":165.26431172014108,"y":233.46113246863442,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.47519473024425,"y":223.30070035181035,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":153.63562684706832,"y":201.51158336191352,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":159.4499692836047,"y":217.48635791527397,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,5]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}},{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 17:04:20 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1 1 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"P"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":224.4933428043215,"y":251.12669021550462,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":207.4933428043215,"y":268.1266902155046,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":190.4933428043215,"y":251.12669021550462,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":251.12669021550462,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":190.4933428043215,"y":148.87330978449538,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":207.4933428043215,"y":131.87330978449538,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":224.4933428043215,"y":148.87330978449538,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":207.4933428043215,"y":148.87330978449538,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":258.6200330198261,"y":183,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":275.6200330198261,"y":200,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":258.6200330198261,"y":217,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":258.6200330198261,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":153.63562684706832,"y":198.48841663808648,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.47519473024425,"y":176.69929964818965,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":165.26431172014108,"y":166.53886753136558,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":159.4499692836047,"y":182.51364208472603,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":165.26431172014108,"y":233.46113246863442,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.47519473024425,"y":223.30070035181035,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":153.63562684706832,"y":201.51158336191352,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":159.4499692836047,"y":217.48635791527397,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,5]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt({connectorStereochemistryError:1}),perspectiveTest:{pass:!1}}]},{smiles:"S(F)(F)(F)F",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:11 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1 1","LSSR":"LSSR","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":246.04551922386574,"y":208.5,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":231.3230873595303,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":248.3230873595303,"y":283.33333333333337,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":231.3230873595303,"y":300.33333333333337,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":214.3230873595303,"y":283.33333333333337,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":231.3230873595303,"y":283.33333333333337,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":214.3230873595303,"y":116.66666666666666,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":231.3230873595303,"y":99.66666666666666,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":248.3230873595303,"y":116.66666666666666,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":231.3230873595303,"y":116.66666666666666,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":147.2010265241682,"y":187.47309594288802,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":137.04059440734414,"y":165.6839789529912,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":158.82971139724097,"y":155.52354683616713,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":153.0153689607046,"y":171.49832138952758,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":158.82971139724097,"y":244.47645316383287,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":137.04059440734414,"y":234.3160210470088,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":147.2010265241682,"y":212.52690405711198,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":153.0153689607046,"y":228.50167861047242,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"Cl(F)(F)F",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:11 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":164.44438758291,"y":208.5,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":164.44438758291,"y":191.5,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":179.16681944724544,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Cl"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":196.16681944724544,"y":283.3327222110182,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":179.16681944724544,"y":300.3327222110182,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":162.16681944724544,"y":283.3327222110182,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":179.16681944724544,"y":283.3327222110182,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":162.16681944724544,"y":116.66727778898176,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":179.16681944724544,"y":99.66727778898176,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":196.16681944724544,"y":116.66727778898176,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":179.16681944724544,"y":116.66727778898176,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":262.4995416582637,"y":183,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":279.4995416582637,"y":200,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":262.4995416582637,"y":217,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":262.4995416582637,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,3]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"I[I-]I",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:11 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"1 2 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":217,"y":283.33333333333337,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":200,"y":300.33333333333337,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":183,"y":283.33333333333337,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":283.33333333333337,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":183,"y":200,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":214.72243186433545,"y":191.5,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":214.72243186433545,"y":208.5,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":200,"__type__":"object"},"charge":-1,"parity":null,"isotopeId":"I"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":183,"y":116.66666666666666,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":200,"y":99.66666666666666,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":217,"y":116.66666666666666,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":116.66666666666666,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"I"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"S(F)(F)(F)(F)(F)F",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:12 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1 1 1 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"S"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":183,"y":125.32923035650633,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":200,"y":108.32923035650633,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":217,"y":125.32923035650633,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":125.32923035650633,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":256.1667834314014,"y":147.94218331391772,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":279.3892152957369,"y":154.16461517825317,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":273.1667834314014,"y":177.38704704258862,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":264.6667834314014,"y":162.66461517825317,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":273.1667834314014,"y":222.61295295741135,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":279.3892152957369,"y":245.83538482174683,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":256.1667834314014,"y":252.0578166860823,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":264.6667834314014,"y":237.33538482174683,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":217,"y":274.67076964349366,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":200,"y":291.67076964349366,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":183,"y":274.67076964349366,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":274.67076964349366,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":126.83321656859857,"y":177.38704704258862,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":120.61078470426311,"y":154.16461517825317,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.83321656859857,"y":147.9421833139177,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":135.33321656859857,"y":162.66461517825317,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":143.83321656859857,"y":252.05781668608228,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":120.61078470426311,"y":245.83538482174683,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":126.83321656859857,"y":222.61295295741138,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":135.33321656859857,"y":237.33538482174683,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,6]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"Br(F)(F)(F)(F)F",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:12 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1 1 1","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":200,"y":227.3408859010766,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":210.3408859010766,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Br"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":183,"y":148.29557049461698,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":200,"y":131.29557049461698,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":217,"y":148.29557049461698,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":200,"y":148.29557049461698,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":245.23281932781208,"y":164.59579633351134,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":268.45525119214756,"y":170.8182281978468,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":262.2328193278121,"y":194.04066006218224,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":253.73281932781208,"y":179.3182281978468,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":262.2328193278121,"y":226.64111173997094,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":268.45525119214756,"y":249.86354360430641,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":245.23281932781208,"y":256.0859754686419,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":253.73281932781208,"y":241.36354360430641,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":137.76718067218795,"y":194.04066006218224,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":131.5447488078525,"y":170.8182281978468,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":154.76718067218795,"y":164.59579633351132,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":146.26718067218795,"y":179.3182281978468,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":154.76718067218795,"y":256.0859754686419,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":131.5447488078525,"y":249.86354360430641,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":137.76718067218795,"y":226.64111173997097,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":146.26718067218795,"y":241.36354360430641,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,5]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]},{smiles:"[Xe](F)(F)(F)F",tests:[{tryMatchWith:'{"info":{"author":"O","generator":"penBabel","date":{"__type__":"date","date":"Wed, 01 Mar 2023 16:33:13 GMT"},"SSSR":"SSSR","OpenBabel Symmetry Classes":"2 1 1 1 1","LSSR":"LSSR","__type__":"object"},"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":199.99999999999997,"y":217,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":199.99999999999997,"y":183,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":199.99999999999997,"y":200,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"Xe"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":252.50423396407314,"y":150.05675723480005,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":275.7266658284086,"y":156.2791890991355,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":269.50423396407314,"y":179.50162096347094,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":261.00423396407314,"y":164.7791890991355,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":269.50423396407314,"y":220.49837903652903,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":275.7266658284086,"y":243.7208109008645,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":252.50423396407314,"y":249.94324276519998,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":261.00423396407314,"y":235.2208109008645,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":130.49576603592686,"y":179.50162096347094,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":124.2733341715914,"y":156.2791890991355,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":147.49576603592686,"y":150.05675723480002,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":138.99576603592686,"y":164.7791890991355,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"},{"__type__":"Kekule.Atom","attachedMarkers":[{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":147.49576603592686,"y":249.94324276519995,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":124.2733341715914,"y":243.7208109008645,"__type__":"object"},"electronCount":2},{"__type__":"Kekule.ChemMarker.UnbondedElectronSet","coordPos2D":0,"coordPos3D":0,"isAttachedToParent":true,"coord2D":{"x":130.49576603592686,"y":220.49837903652906,"__type__":"object"},"electronCount":2}],"coordPos2D":0,"coordPos3D":0,"coord2D":{"x":138.99576603592686,"y":235.2208109008645,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"F"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":3,"isInAromaticRing":false,"connectedObjs":[0,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"stereo":1,"isInAromaticRing":false,"connectedObjs":[0,4]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}',result:new zt,perspectiveTest:{pass:!0}}]}],v0=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-circle" viewBox="0 0 16 16">
<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
<path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
</svg>`,k0=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
</svg>`,Gp=new Map([[1,1],[2,2],[3,1],[4,2],[5,3],[6,4],[7,5],[8,6],[9,7],[10,8],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,7],[18,8],[19,1],[20,2],[31,3],[32,4],[33,5],[34,6],[35,7],[36,8],[37,1],[38,2],[51,5],[52,6],[53,7],[54,8],[55,1],[56,2],[83,5],[84,6],[85,7],[86,8]]);function zp(s){let e=s.atomicNumber;return Gp.has(e)?Gp.get(e):s.getValence({ignoreCharge:!0})}var vu={},Ko={},$p;function I0(){if($p)return Ko;$p=1,Ko.byteLength=o,Ko.toByteArray=u,Ko.fromByteArray=h;for(var s=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,r=n.length;i<r;++i)s[i]=n[i],e[n.charCodeAt(i)]=i;e[45]=62,e[95]=63;function a(p){var g=p.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var f=p.indexOf("=");f===-1&&(f=g);var m=f===g?0:4-f%4;return[f,m]}function o(p){var g=a(p),f=g[0],m=g[1];return(f+m)*3/4-m}function l(p,g,f){return(g+f)*3/4-f}function u(p){var g,f=a(p),m=f[0],C=f[1],_=new t(l(p,m,C)),y=0,T=C>0?m-4:m,E;for(E=0;E<T;E+=4)g=e[p.charCodeAt(E)]<<18|e[p.charCodeAt(E+1)]<<12|e[p.charCodeAt(E+2)]<<6|e[p.charCodeAt(E+3)],_[y++]=g>>16&255,_[y++]=g>>8&255,_[y++]=g&255;return C===2&&(g=e[p.charCodeAt(E)]<<2|e[p.charCodeAt(E+1)]>>4,_[y++]=g&255),C===1&&(g=e[p.charCodeAt(E)]<<10|e[p.charCodeAt(E+1)]<<4|e[p.charCodeAt(E+2)]>>2,_[y++]=g>>8&255,_[y++]=g&255),_}function c(p){return s[p>>18&63]+s[p>>12&63]+s[p>>6&63]+s[p&63]}function d(p,g,f){for(var m,C=[],_=g;_<f;_+=3)m=(p[_]<<16&16711680)+(p[_+1]<<8&65280)+(p[_+2]&255),C.push(c(m));return C.join("")}function h(p){for(var g,f=p.length,m=f%3,C=[],_=16383,y=0,T=f-m;y<T;y+=_)C.push(d(p,y,y+_>T?T:y+_));return m===1?(g=p[f-1],C.push(s[g>>2]+s[g<<4&63]+"==")):m===2&&(g=(p[f-2]<<8)+p[f-1],C.push(s[g>>10]+s[g>>4&63]+s[g<<2&63]+"=")),C.join("")}return Ko}var us={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Yp;function D0(){return Yp||(Yp=1,us.read=function(s,e,t,n,i){var r,a,o=i*8-n-1,l=(1<<o)-1,u=l>>1,c=-7,d=t?i-1:0,h=t?-1:1,p=s[e+d];for(d+=h,r=p&(1<<-c)-1,p>>=-c,c+=o;c>0;r=r*256+s[e+d],d+=h,c-=8);for(a=r&(1<<-c)-1,r>>=-c,c+=n;c>0;a=a*256+s[e+d],d+=h,c-=8);if(r===0)r=1-u;else{if(r===l)return a?NaN:(p?-1:1)*(1/0);a=a+Math.pow(2,n),r=r-u}return(p?-1:1)*a*Math.pow(2,r-n)},us.write=function(s,e,t,n,i,r){var a,o,l,u=r*8-i-1,c=(1<<u)-1,d=c>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:r-1,g=n?1:-1,f=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+d>=1?e+=h/l:e+=h*Math.pow(2,1-d),e*l>=2&&(a++,l/=2),a+d>=c?(o=0,a=c):a+d>=1?(o=(e*l-1)*Math.pow(2,i),a=a+d):(o=e*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;s[t+p]=o&255,p+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;s[t+p]=a&255,p+=g,a/=256,u-=8);s[t+p-g]|=f*128}),us}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Xp;function R0(){return Xp||(Xp=1,function(s){const e=I0(),t=D0(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=o,s.SlowBuffer=_,s.INSPECT_MAX_BYTES=50;const i=2147483647;s.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=r(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function r(){try{const D=new Uint8Array(1),O={foo:function(){return 42}};return Object.setPrototypeOf(O,Uint8Array.prototype),Object.setPrototypeOf(D,O),D.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function a(D){if(D>i)throw new RangeError('The value "'+D+'" is invalid for option "size"');const O=new Uint8Array(D);return Object.setPrototypeOf(O,o.prototype),O}function o(D,O,k){if(typeof D=="number"){if(typeof O=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(D)}return l(D,O,k)}o.poolSize=8192;function l(D,O,k){if(typeof D=="string")return h(D,O);if(ArrayBuffer.isView(D))return g(D);if(D==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D);if(yt(D,ArrayBuffer)||D&&yt(D.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(yt(D,SharedArrayBuffer)||D&&yt(D.buffer,SharedArrayBuffer)))return f(D,O,k);if(typeof D=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const w=D.valueOf&&D.valueOf();if(w!=null&&w!==D)return o.from(w,O,k);const z=m(D);if(z)return z;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof D[Symbol.toPrimitive]=="function")return o.from(D[Symbol.toPrimitive]("string"),O,k);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D)}o.from=function(D,O,k){return l(D,O,k)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function u(D){if(typeof D!="number")throw new TypeError('"size" argument must be of type number');if(D<0)throw new RangeError('The value "'+D+'" is invalid for option "size"')}function c(D,O,k){return u(D),D<=0?a(D):O!==void 0?typeof k=="string"?a(D).fill(O,k):a(D).fill(O):a(D)}o.alloc=function(D,O,k){return c(D,O,k)};function d(D){return u(D),a(D<0?0:C(D)|0)}o.allocUnsafe=function(D){return d(D)},o.allocUnsafeSlow=function(D){return d(D)};function h(D,O){if((typeof O!="string"||O==="")&&(O="utf8"),!o.isEncoding(O))throw new TypeError("Unknown encoding: "+O);const k=y(D,O)|0;let w=a(k);const z=w.write(D,O);return z!==k&&(w=w.slice(0,z)),w}function p(D){const O=D.length<0?0:C(D.length)|0,k=a(O);for(let w=0;w<O;w+=1)k[w]=D[w]&255;return k}function g(D){if(yt(D,Uint8Array)){const O=new Uint8Array(D);return f(O.buffer,O.byteOffset,O.byteLength)}return p(D)}function f(D,O,k){if(O<0||D.byteLength<O)throw new RangeError('"offset" is outside of buffer bounds');if(D.byteLength<O+(k||0))throw new RangeError('"length" is outside of buffer bounds');let w;return O===void 0&&k===void 0?w=new Uint8Array(D):k===void 0?w=new Uint8Array(D,O):w=new Uint8Array(D,O,k),Object.setPrototypeOf(w,o.prototype),w}function m(D){if(o.isBuffer(D)){const O=C(D.length)|0,k=a(O);return k.length===0||D.copy(k,0,0,O),k}if(D.length!==void 0)return typeof D.length!="number"||Ht(D.length)?a(0):p(D);if(D.type==="Buffer"&&Array.isArray(D.data))return p(D.data)}function C(D){if(D>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return D|0}function _(D){return+D!=D&&(D=0),o.alloc(+D)}o.isBuffer=function(O){return O!=null&&O._isBuffer===!0&&O!==o.prototype},o.compare=function(O,k){if(yt(O,Uint8Array)&&(O=o.from(O,O.offset,O.byteLength)),yt(k,Uint8Array)&&(k=o.from(k,k.offset,k.byteLength)),!o.isBuffer(O)||!o.isBuffer(k))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(O===k)return 0;let w=O.length,z=k.length;for(let Z=0,se=Math.min(w,z);Z<se;++Z)if(O[Z]!==k[Z]){w=O[Z],z=k[Z];break}return w<z?-1:z<w?1:0},o.isEncoding=function(O){switch(String(O).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(O,k){if(!Array.isArray(O))throw new TypeError('"list" argument must be an Array of Buffers');if(O.length===0)return o.alloc(0);let w;if(k===void 0)for(k=0,w=0;w<O.length;++w)k+=O[w].length;const z=o.allocUnsafe(k);let Z=0;for(w=0;w<O.length;++w){let se=O[w];if(yt(se,Uint8Array))Z+se.length>z.length?(o.isBuffer(se)||(se=o.from(se)),se.copy(z,Z)):Uint8Array.prototype.set.call(z,se,Z);else if(o.isBuffer(se))se.copy(z,Z);else throw new TypeError('"list" argument must be an Array of Buffers');Z+=se.length}return z};function y(D,O){if(o.isBuffer(D))return D.length;if(ArrayBuffer.isView(D)||yt(D,ArrayBuffer))return D.byteLength;if(typeof D!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof D);const k=D.length,w=arguments.length>2&&arguments[2]===!0;if(!w&&k===0)return 0;let z=!1;for(;;)switch(O){case"ascii":case"latin1":case"binary":return k;case"utf8":case"utf-8":return Bt(D).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k*2;case"hex":return k>>>1;case"base64":return Xe(D).length;default:if(z)return w?-1:Bt(D).length;O=(""+O).toLowerCase(),z=!0}}o.byteLength=y;function T(D,O,k){let w=!1;if((O===void 0||O<0)&&(O=0),O>this.length||((k===void 0||k>this.length)&&(k=this.length),k<=0)||(k>>>=0,O>>>=0,k<=O))return"";for(D||(D="utf8");;)switch(D){case"hex":return q(this,O,k);case"utf8":case"utf-8":return M(this,O,k);case"ascii":return J(this,O,k);case"latin1":case"binary":return $(this,O,k);case"base64":return W(this,O,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,O,k);default:if(w)throw new TypeError("Unknown encoding: "+D);D=(D+"").toLowerCase(),w=!0}}o.prototype._isBuffer=!0;function E(D,O,k){const w=D[O];D[O]=D[k],D[k]=w}o.prototype.swap16=function(){const O=this.length;if(O%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let k=0;k<O;k+=2)E(this,k,k+1);return this},o.prototype.swap32=function(){const O=this.length;if(O%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let k=0;k<O;k+=4)E(this,k,k+3),E(this,k+1,k+2);return this},o.prototype.swap64=function(){const O=this.length;if(O%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let k=0;k<O;k+=8)E(this,k,k+7),E(this,k+1,k+6),E(this,k+2,k+5),E(this,k+3,k+4);return this},o.prototype.toString=function(){const O=this.length;return O===0?"":arguments.length===0?M(this,0,O):T.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(O){if(!o.isBuffer(O))throw new TypeError("Argument must be a Buffer");return this===O?!0:o.compare(this,O)===0},o.prototype.inspect=function(){let O="";const k=s.INSPECT_MAX_BYTES;return O=this.toString("hex",0,k).replace(/(.{2})/g,"$1 ").trim(),this.length>k&&(O+=" ... "),"<Buffer "+O+">"},n&&(o.prototype[n]=o.prototype.inspect),o.prototype.compare=function(O,k,w,z,Z){if(yt(O,Uint8Array)&&(O=o.from(O,O.offset,O.byteLength)),!o.isBuffer(O))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof O);if(k===void 0&&(k=0),w===void 0&&(w=O?O.length:0),z===void 0&&(z=0),Z===void 0&&(Z=this.length),k<0||w>O.length||z<0||Z>this.length)throw new RangeError("out of range index");if(z>=Z&&k>=w)return 0;if(z>=Z)return-1;if(k>=w)return 1;if(k>>>=0,w>>>=0,z>>>=0,Z>>>=0,this===O)return 0;let se=Z-z,me=w-k;const Pe=Math.min(se,me),be=this.slice(z,Z),He=O.slice(k,w);for(let nt=0;nt<Pe;++nt)if(be[nt]!==He[nt]){se=be[nt],me=He[nt];break}return se<me?-1:me<se?1:0};function b(D,O,k,w,z){if(D.length===0)return-1;if(typeof k=="string"?(w=k,k=0):k>2147483647?k=2147483647:k<-2147483648&&(k=-2147483648),k=+k,Ht(k)&&(k=z?0:D.length-1),k<0&&(k=D.length+k),k>=D.length){if(z)return-1;k=D.length-1}else if(k<0)if(z)k=0;else return-1;if(typeof O=="string"&&(O=o.from(O,w)),o.isBuffer(O))return O.length===0?-1:v(D,O,k,w,z);if(typeof O=="number")return O=O&255,typeof Uint8Array.prototype.indexOf=="function"?z?Uint8Array.prototype.indexOf.call(D,O,k):Uint8Array.prototype.lastIndexOf.call(D,O,k):v(D,[O],k,w,z);throw new TypeError("val must be string, number or Buffer")}function v(D,O,k,w,z){let Z=1,se=D.length,me=O.length;if(w!==void 0&&(w=String(w).toLowerCase(),w==="ucs2"||w==="ucs-2"||w==="utf16le"||w==="utf-16le")){if(D.length<2||O.length<2)return-1;Z=2,se/=2,me/=2,k/=2}function Pe(He,nt){return Z===1?He[nt]:He.readUInt16BE(nt*Z)}let be;if(z){let He=-1;for(be=k;be<se;be++)if(Pe(D,be)===Pe(O,He===-1?0:be-He)){if(He===-1&&(He=be),be-He+1===me)return He*Z}else He!==-1&&(be-=be-He),He=-1}else for(k+me>se&&(k=se-me),be=k;be>=0;be--){let He=!0;for(let nt=0;nt<me;nt++)if(Pe(D,be+nt)!==Pe(O,nt)){He=!1;break}if(He)return be}return-1}o.prototype.includes=function(O,k,w){return this.indexOf(O,k,w)!==-1},o.prototype.indexOf=function(O,k,w){return b(this,O,k,w,!0)},o.prototype.lastIndexOf=function(O,k,w){return b(this,O,k,w,!1)};function I(D,O,k,w){k=Number(k)||0;const z=D.length-k;w?(w=Number(w),w>z&&(w=z)):w=z;const Z=O.length;w>Z/2&&(w=Z/2);let se;for(se=0;se<w;++se){const me=parseInt(O.substr(se*2,2),16);if(Ht(me))return se;D[k+se]=me}return se}function R(D,O,k,w){return vt(Bt(O,D.length-k),D,k,w)}function N(D,O,k,w){return vt(Fe(O),D,k,w)}function L(D,O,k,w){return vt(Xe(O),D,k,w)}function U(D,O,k,w){return vt(Nt(O,D.length-k),D,k,w)}o.prototype.write=function(O,k,w,z){if(k===void 0)z="utf8",w=this.length,k=0;else if(w===void 0&&typeof k=="string")z=k,w=this.length,k=0;else if(isFinite(k))k=k>>>0,isFinite(w)?(w=w>>>0,z===void 0&&(z="utf8")):(z=w,w=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Z=this.length-k;if((w===void 0||w>Z)&&(w=Z),O.length>0&&(w<0||k<0)||k>this.length)throw new RangeError("Attempt to write outside buffer bounds");z||(z="utf8");let se=!1;for(;;)switch(z){case"hex":return I(this,O,k,w);case"utf8":case"utf-8":return R(this,O,k,w);case"ascii":case"latin1":case"binary":return N(this,O,k,w);case"base64":return L(this,O,k,w);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,O,k,w);default:if(se)throw new TypeError("Unknown encoding: "+z);z=(""+z).toLowerCase(),se=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function W(D,O,k){return O===0&&k===D.length?e.fromByteArray(D):e.fromByteArray(D.slice(O,k))}function M(D,O,k){k=Math.min(D.length,k);const w=[];let z=O;for(;z<k;){const Z=D[z];let se=null,me=Z>239?4:Z>223?3:Z>191?2:1;if(z+me<=k){let Pe,be,He,nt;switch(me){case 1:Z<128&&(se=Z);break;case 2:Pe=D[z+1],(Pe&192)===128&&(nt=(Z&31)<<6|Pe&63,nt>127&&(se=nt));break;case 3:Pe=D[z+1],be=D[z+2],(Pe&192)===128&&(be&192)===128&&(nt=(Z&15)<<12|(Pe&63)<<6|be&63,nt>2047&&(nt<55296||nt>57343)&&(se=nt));break;case 4:Pe=D[z+1],be=D[z+2],He=D[z+3],(Pe&192)===128&&(be&192)===128&&(He&192)===128&&(nt=(Z&15)<<18|(Pe&63)<<12|(be&63)<<6|He&63,nt>65535&&nt<1114112&&(se=nt))}}se===null?(se=65533,me=1):se>65535&&(se-=65536,w.push(se>>>10&1023|55296),se=56320|se&1023),w.push(se),z+=me}return V(w)}const B=4096;function V(D){const O=D.length;if(O<=B)return String.fromCharCode.apply(String,D);let k="",w=0;for(;w<O;)k+=String.fromCharCode.apply(String,D.slice(w,w+=B));return k}function J(D,O,k){let w="";k=Math.min(D.length,k);for(let z=O;z<k;++z)w+=String.fromCharCode(D[z]&127);return w}function $(D,O,k){let w="";k=Math.min(D.length,k);for(let z=O;z<k;++z)w+=String.fromCharCode(D[z]);return w}function q(D,O,k){const w=D.length;(!O||O<0)&&(O=0),(!k||k<0||k>w)&&(k=w);let z="";for(let Z=O;Z<k;++Z)z+=Dr[D[Z]];return z}function Q(D,O,k){const w=D.slice(O,k);let z="";for(let Z=0;Z<w.length-1;Z+=2)z+=String.fromCharCode(w[Z]+w[Z+1]*256);return z}o.prototype.slice=function(O,k){const w=this.length;O=~~O,k=k===void 0?w:~~k,O<0?(O+=w,O<0&&(O=0)):O>w&&(O=w),k<0?(k+=w,k<0&&(k=0)):k>w&&(k=w),k<O&&(k=O);const z=this.subarray(O,k);return Object.setPrototypeOf(z,o.prototype),z};function ie(D,O,k){if(D%1!==0||D<0)throw new RangeError("offset is not uint");if(D+O>k)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(O,k,w){O=O>>>0,k=k>>>0,w||ie(O,k,this.length);let z=this[O],Z=1,se=0;for(;++se<k&&(Z*=256);)z+=this[O+se]*Z;return z},o.prototype.readUintBE=o.prototype.readUIntBE=function(O,k,w){O=O>>>0,k=k>>>0,w||ie(O,k,this.length);let z=this[O+--k],Z=1;for(;k>0&&(Z*=256);)z+=this[O+--k]*Z;return z},o.prototype.readUint8=o.prototype.readUInt8=function(O,k){return O=O>>>0,k||ie(O,1,this.length),this[O]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(O,k){return O=O>>>0,k||ie(O,2,this.length),this[O]|this[O+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(O,k){return O=O>>>0,k||ie(O,2,this.length),this[O]<<8|this[O+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(O,k){return O=O>>>0,k||ie(O,4,this.length),(this[O]|this[O+1]<<8|this[O+2]<<16)+this[O+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(O,k){return O=O>>>0,k||ie(O,4,this.length),this[O]*16777216+(this[O+1]<<16|this[O+2]<<8|this[O+3])},o.prototype.readBigUInt64LE=Mt(function(O){O=O>>>0,Me(O,"offset");const k=this[O],w=this[O+7];(k===void 0||w===void 0)&&Le(O,this.length-8);const z=k+this[++O]*2**8+this[++O]*2**16+this[++O]*2**24,Z=this[++O]+this[++O]*2**8+this[++O]*2**16+w*2**24;return BigInt(z)+(BigInt(Z)<<BigInt(32))}),o.prototype.readBigUInt64BE=Mt(function(O){O=O>>>0,Me(O,"offset");const k=this[O],w=this[O+7];(k===void 0||w===void 0)&&Le(O,this.length-8);const z=k*2**24+this[++O]*2**16+this[++O]*2**8+this[++O],Z=this[++O]*2**24+this[++O]*2**16+this[++O]*2**8+w;return(BigInt(z)<<BigInt(32))+BigInt(Z)}),o.prototype.readIntLE=function(O,k,w){O=O>>>0,k=k>>>0,w||ie(O,k,this.length);let z=this[O],Z=1,se=0;for(;++se<k&&(Z*=256);)z+=this[O+se]*Z;return Z*=128,z>=Z&&(z-=Math.pow(2,8*k)),z},o.prototype.readIntBE=function(O,k,w){O=O>>>0,k=k>>>0,w||ie(O,k,this.length);let z=k,Z=1,se=this[O+--z];for(;z>0&&(Z*=256);)se+=this[O+--z]*Z;return Z*=128,se>=Z&&(se-=Math.pow(2,8*k)),se},o.prototype.readInt8=function(O,k){return O=O>>>0,k||ie(O,1,this.length),this[O]&128?(255-this[O]+1)*-1:this[O]},o.prototype.readInt16LE=function(O,k){O=O>>>0,k||ie(O,2,this.length);const w=this[O]|this[O+1]<<8;return w&32768?w|4294901760:w},o.prototype.readInt16BE=function(O,k){O=O>>>0,k||ie(O,2,this.length);const w=this[O+1]|this[O]<<8;return w&32768?w|4294901760:w},o.prototype.readInt32LE=function(O,k){return O=O>>>0,k||ie(O,4,this.length),this[O]|this[O+1]<<8|this[O+2]<<16|this[O+3]<<24},o.prototype.readInt32BE=function(O,k){return O=O>>>0,k||ie(O,4,this.length),this[O]<<24|this[O+1]<<16|this[O+2]<<8|this[O+3]},o.prototype.readBigInt64LE=Mt(function(O){O=O>>>0,Me(O,"offset");const k=this[O],w=this[O+7];(k===void 0||w===void 0)&&Le(O,this.length-8);const z=this[O+4]+this[O+5]*2**8+this[O+6]*2**16+(w<<24);return(BigInt(z)<<BigInt(32))+BigInt(k+this[++O]*2**8+this[++O]*2**16+this[++O]*2**24)}),o.prototype.readBigInt64BE=Mt(function(O){O=O>>>0,Me(O,"offset");const k=this[O],w=this[O+7];(k===void 0||w===void 0)&&Le(O,this.length-8);const z=(k<<24)+this[++O]*2**16+this[++O]*2**8+this[++O];return(BigInt(z)<<BigInt(32))+BigInt(this[++O]*2**24+this[++O]*2**16+this[++O]*2**8+w)}),o.prototype.readFloatLE=function(O,k){return O=O>>>0,k||ie(O,4,this.length),t.read(this,O,!0,23,4)},o.prototype.readFloatBE=function(O,k){return O=O>>>0,k||ie(O,4,this.length),t.read(this,O,!1,23,4)},o.prototype.readDoubleLE=function(O,k){return O=O>>>0,k||ie(O,8,this.length),t.read(this,O,!0,52,8)},o.prototype.readDoubleBE=function(O,k){return O=O>>>0,k||ie(O,8,this.length),t.read(this,O,!1,52,8)};function Y(D,O,k,w,z,Z){if(!o.isBuffer(D))throw new TypeError('"buffer" argument must be a Buffer instance');if(O>z||O<Z)throw new RangeError('"value" argument is out of bounds');if(k+w>D.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(O,k,w,z){if(O=+O,k=k>>>0,w=w>>>0,!z){const me=Math.pow(2,8*w)-1;Y(this,O,k,w,me,0)}let Z=1,se=0;for(this[k]=O&255;++se<w&&(Z*=256);)this[k+se]=O/Z&255;return k+w},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(O,k,w,z){if(O=+O,k=k>>>0,w=w>>>0,!z){const me=Math.pow(2,8*w)-1;Y(this,O,k,w,me,0)}let Z=w-1,se=1;for(this[k+Z]=O&255;--Z>=0&&(se*=256);)this[k+Z]=O/se&255;return k+w},o.prototype.writeUint8=o.prototype.writeUInt8=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,1,255,0),this[k]=O&255,k+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,2,65535,0),this[k]=O&255,this[k+1]=O>>>8,k+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,2,65535,0),this[k]=O>>>8,this[k+1]=O&255,k+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,4,4294967295,0),this[k+3]=O>>>24,this[k+2]=O>>>16,this[k+1]=O>>>8,this[k]=O&255,k+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,4,4294967295,0),this[k]=O>>>24,this[k+1]=O>>>16,this[k+2]=O>>>8,this[k+3]=O&255,k+4};function ne(D,O,k,w,z){we(O,w,z,D,k,7);let Z=Number(O&BigInt(4294967295));D[k++]=Z,Z=Z>>8,D[k++]=Z,Z=Z>>8,D[k++]=Z,Z=Z>>8,D[k++]=Z;let se=Number(O>>BigInt(32)&BigInt(4294967295));return D[k++]=se,se=se>>8,D[k++]=se,se=se>>8,D[k++]=se,se=se>>8,D[k++]=se,k}function de(D,O,k,w,z){we(O,w,z,D,k,7);let Z=Number(O&BigInt(4294967295));D[k+7]=Z,Z=Z>>8,D[k+6]=Z,Z=Z>>8,D[k+5]=Z,Z=Z>>8,D[k+4]=Z;let se=Number(O>>BigInt(32)&BigInt(4294967295));return D[k+3]=se,se=se>>8,D[k+2]=se,se=se>>8,D[k+1]=se,se=se>>8,D[k]=se,k+8}o.prototype.writeBigUInt64LE=Mt(function(O,k=0){return ne(this,O,k,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Mt(function(O,k=0){return de(this,O,k,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(O,k,w,z){if(O=+O,k=k>>>0,!z){const Pe=Math.pow(2,8*w-1);Y(this,O,k,w,Pe-1,-Pe)}let Z=0,se=1,me=0;for(this[k]=O&255;++Z<w&&(se*=256);)O<0&&me===0&&this[k+Z-1]!==0&&(me=1),this[k+Z]=(O/se>>0)-me&255;return k+w},o.prototype.writeIntBE=function(O,k,w,z){if(O=+O,k=k>>>0,!z){const Pe=Math.pow(2,8*w-1);Y(this,O,k,w,Pe-1,-Pe)}let Z=w-1,se=1,me=0;for(this[k+Z]=O&255;--Z>=0&&(se*=256);)O<0&&me===0&&this[k+Z+1]!==0&&(me=1),this[k+Z]=(O/se>>0)-me&255;return k+w},o.prototype.writeInt8=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,1,127,-128),O<0&&(O=255+O+1),this[k]=O&255,k+1},o.prototype.writeInt16LE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,2,32767,-32768),this[k]=O&255,this[k+1]=O>>>8,k+2},o.prototype.writeInt16BE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,2,32767,-32768),this[k]=O>>>8,this[k+1]=O&255,k+2},o.prototype.writeInt32LE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,4,2147483647,-2147483648),this[k]=O&255,this[k+1]=O>>>8,this[k+2]=O>>>16,this[k+3]=O>>>24,k+4},o.prototype.writeInt32BE=function(O,k,w){return O=+O,k=k>>>0,w||Y(this,O,k,4,2147483647,-2147483648),O<0&&(O=4294967295+O+1),this[k]=O>>>24,this[k+1]=O>>>16,this[k+2]=O>>>8,this[k+3]=O&255,k+4},o.prototype.writeBigInt64LE=Mt(function(O,k=0){return ne(this,O,k,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Mt(function(O,k=0){return de(this,O,k,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ae(D,O,k,w,z,Z){if(k+w>D.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("Index out of range")}function Ce(D,O,k,w,z){return O=+O,k=k>>>0,z||Ae(D,O,k,4),t.write(D,O,k,w,23,4),k+4}o.prototype.writeFloatLE=function(O,k,w){return Ce(this,O,k,!0,w)},o.prototype.writeFloatBE=function(O,k,w){return Ce(this,O,k,!1,w)};function pe(D,O,k,w,z){return O=+O,k=k>>>0,z||Ae(D,O,k,8),t.write(D,O,k,w,52,8),k+8}o.prototype.writeDoubleLE=function(O,k,w){return pe(this,O,k,!0,w)},o.prototype.writeDoubleBE=function(O,k,w){return pe(this,O,k,!1,w)},o.prototype.copy=function(O,k,w,z){if(!o.isBuffer(O))throw new TypeError("argument should be a Buffer");if(w||(w=0),!z&&z!==0&&(z=this.length),k>=O.length&&(k=O.length),k||(k=0),z>0&&z<w&&(z=w),z===w||O.length===0||this.length===0)return 0;if(k<0)throw new RangeError("targetStart out of bounds");if(w<0||w>=this.length)throw new RangeError("Index out of range");if(z<0)throw new RangeError("sourceEnd out of bounds");z>this.length&&(z=this.length),O.length-k<z-w&&(z=O.length-k+w);const Z=z-w;return this===O&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(k,w,z):Uint8Array.prototype.set.call(O,this.subarray(w,z),k),Z},o.prototype.fill=function(O,k,w,z){if(typeof O=="string"){if(typeof k=="string"?(z=k,k=0,w=this.length):typeof w=="string"&&(z=w,w=this.length),z!==void 0&&typeof z!="string")throw new TypeError("encoding must be a string");if(typeof z=="string"&&!o.isEncoding(z))throw new TypeError("Unknown encoding: "+z);if(O.length===1){const se=O.charCodeAt(0);(z==="utf8"&&se<128||z==="latin1")&&(O=se)}}else typeof O=="number"?O=O&255:typeof O=="boolean"&&(O=Number(O));if(k<0||this.length<k||this.length<w)throw new RangeError("Out of range index");if(w<=k)return this;k=k>>>0,w=w===void 0?this.length:w>>>0,O||(O=0);let Z;if(typeof O=="number")for(Z=k;Z<w;++Z)this[Z]=O;else{const se=o.isBuffer(O)?O:o.from(O,z),me=se.length;if(me===0)throw new TypeError('The value "'+O+'" is invalid for argument "value"');for(Z=0;Z<w-k;++Z)this[Z+k]=se[Z%me]}return this};const fe={};function Te(D,O,k){fe[D]=class extends k{constructor(){super(),Object.defineProperty(this,"message",{value:O.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${D}]`,this.stack,delete this.name}get code(){return D}set code(z){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:z,writable:!0})}toString(){return`${this.name} [${D}]: ${this.message}`}}}Te("ERR_BUFFER_OUT_OF_BOUNDS",function(D){return D?`${D} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Te("ERR_INVALID_ARG_TYPE",function(D,O){return`The "${D}" argument must be of type number. Received type ${typeof O}`},TypeError),Te("ERR_OUT_OF_RANGE",function(D,O,k){let w=`The value of "${D}" is out of range.`,z=k;return Number.isInteger(k)&&Math.abs(k)>2**32?z=xe(String(k)):typeof k=="bigint"&&(z=String(k),(k>BigInt(2)**BigInt(32)||k<-(BigInt(2)**BigInt(32)))&&(z=xe(z)),z+="n"),w+=` It must be ${O}. Received ${z}`,w},RangeError);function xe(D){let O="",k=D.length;const w=D[0]==="-"?1:0;for(;k>=w+4;k-=3)O=`_${D.slice(k-3,k)}${O}`;return`${D.slice(0,k)}${O}`}function Re(D,O,k){Me(O,"offset"),(D[O]===void 0||D[O+k]===void 0)&&Le(O,D.length-(k+1))}function we(D,O,k,w,z,Z){if(D>k||D<O){const se=typeof O=="bigint"?"n":"";let me;throw O===0||O===BigInt(0)?me=`>= 0${se} and < 2${se} ** ${(Z+1)*8}${se}`:me=`>= -(2${se} ** ${(Z+1)*8-1}${se}) and < 2 ** ${(Z+1)*8-1}${se}`,new fe.ERR_OUT_OF_RANGE("value",me,D)}Re(w,z,Z)}function Me(D,O){if(typeof D!="number")throw new fe.ERR_INVALID_ARG_TYPE(O,"number",D)}function Le(D,O,k){throw Math.floor(D)!==D?(Me(D,k),new fe.ERR_OUT_OF_RANGE("offset","an integer",D)):O<0?new fe.ERR_BUFFER_OUT_OF_BOUNDS:new fe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${O}`,D)}const Ue=/[^+/0-9A-Za-z-_]/g;function at(D){if(D=D.split("=")[0],D=D.trim().replace(Ue,""),D.length<2)return"";for(;D.length%4!==0;)D=D+"=";return D}function Bt(D,O){O=O||1/0;let k;const w=D.length;let z=null;const Z=[];for(let se=0;se<w;++se){if(k=D.charCodeAt(se),k>55295&&k<57344){if(!z){if(k>56319){(O-=3)>-1&&Z.push(239,191,189);continue}else if(se+1===w){(O-=3)>-1&&Z.push(239,191,189);continue}z=k;continue}if(k<56320){(O-=3)>-1&&Z.push(239,191,189),z=k;continue}k=(z-55296<<10|k-56320)+65536}else z&&(O-=3)>-1&&Z.push(239,191,189);if(z=null,k<128){if((O-=1)<0)break;Z.push(k)}else if(k<2048){if((O-=2)<0)break;Z.push(k>>6|192,k&63|128)}else if(k<65536){if((O-=3)<0)break;Z.push(k>>12|224,k>>6&63|128,k&63|128)}else if(k<1114112){if((O-=4)<0)break;Z.push(k>>18|240,k>>12&63|128,k>>6&63|128,k&63|128)}else throw new Error("Invalid code point")}return Z}function Fe(D){const O=[];for(let k=0;k<D.length;++k)O.push(D.charCodeAt(k)&255);return O}function Nt(D,O){let k,w,z;const Z=[];for(let se=0;se<D.length&&!((O-=2)<0);++se)k=D.charCodeAt(se),w=k>>8,z=k%256,Z.push(z),Z.push(w);return Z}function Xe(D){return e.toByteArray(at(D))}function vt(D,O,k,w){let z;for(z=0;z<w&&!(z+k>=O.length||z>=D.length);++z)O[z+k]=D[z];return z}function yt(D,O){return D instanceof O||D!=null&&D.constructor!=null&&D.constructor.name!=null&&D.constructor.name===O.name}function Ht(D){return D!==D}const Dr=function(){const D="0123456789abcdef",O=new Array(256);for(let k=0;k<16;++k){const w=k*16;for(let z=0;z<16;++z)O[w+z]=D[k]+D[z]}return O}();function Mt(D){return typeof BigInt>"u"?ae:D}function ae(){throw new Error("BigInt not supported")}}(vu)),vu}var P0=R0(),Go={exports:{}},N0=Go.exports,Jp;function M0(){return Jp||(Jp=1,function(s,e){/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */(function(t,n){n(e)})(N0,function(t){function o(A){let P=A.length;for(;--P>=0;)A[P]=0}const l=0,u=1,c=2,d=3,h=258,p=29,g=256,f=g+1+p,m=30,C=19,_=2*f+1,y=15,T=16,E=7,b=256,v=16,I=17,R=18,N=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),L=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M=512,B=new Array((f+2)*2);o(B);const V=new Array(m*2);o(V);const J=new Array(M);o(J);const $=new Array(h-d+1);o($);const q=new Array(p);o(q);const Q=new Array(m);o(Q);function ie(A,P,S,K,j){this.static_tree=A,this.extra_bits=P,this.extra_base=S,this.elems=K,this.max_length=j,this.has_stree=A&&A.length}let Y,ne,de;function Ae(A,P){this.dyn_tree=A,this.max_code=0,this.stat_desc=P}const Ce=A=>A<256?J[A]:J[256+(A>>>7)],pe=(A,P)=>{A.pending_buf[A.pending++]=P&255,A.pending_buf[A.pending++]=P>>>8&255},fe=(A,P,S)=>{A.bi_valid>T-S?(A.bi_buf|=P<<A.bi_valid&65535,pe(A,A.bi_buf),A.bi_buf=P>>T-A.bi_valid,A.bi_valid+=S-T):(A.bi_buf|=P<<A.bi_valid&65535,A.bi_valid+=S)},Te=(A,P,S)=>{fe(A,S[P*2],S[P*2+1])},xe=(A,P)=>{let S=0;do S|=A&1,A>>>=1,S<<=1;while(--P>0);return S>>>1},Re=A=>{A.bi_valid===16?(pe(A,A.bi_buf),A.bi_buf=0,A.bi_valid=0):A.bi_valid>=8&&(A.pending_buf[A.pending++]=A.bi_buf&255,A.bi_buf>>=8,A.bi_valid-=8)},we=(A,P)=>{const S=P.dyn_tree,K=P.max_code,j=P.stat_desc.static_tree,F=P.stat_desc.has_stree,le=P.stat_desc.extra_bits,re=P.stat_desc.extra_base,Ne=P.stat_desc.max_length;let X,ue,ft,Ie,_e,Ve,Vt=0;for(Ie=0;Ie<=y;Ie++)A.bl_count[Ie]=0;for(S[A.heap[A.heap_max]*2+1]=0,X=A.heap_max+1;X<_;X++)ue=A.heap[X],Ie=S[S[ue*2+1]*2+1]+1,Ie>Ne&&(Ie=Ne,Vt++),S[ue*2+1]=Ie,!(ue>K)&&(A.bl_count[Ie]++,_e=0,ue>=re&&(_e=le[ue-re]),Ve=S[ue*2],A.opt_len+=Ve*(Ie+_e),F&&(A.static_len+=Ve*(j[ue*2+1]+_e)));if(Vt!==0){do{for(Ie=Ne-1;A.bl_count[Ie]===0;)Ie--;A.bl_count[Ie]--,A.bl_count[Ie+1]+=2,A.bl_count[Ne]--,Vt-=2}while(Vt>0);for(Ie=Ne;Ie!==0;Ie--)for(ue=A.bl_count[Ie];ue!==0;)ft=A.heap[--X],!(ft>K)&&(S[ft*2+1]!==Ie&&(A.opt_len+=(Ie-S[ft*2+1])*S[ft*2],S[ft*2+1]=Ie),ue--)}},Me=(A,P,S)=>{const K=new Array(y+1);let j=0,F,le;for(F=1;F<=y;F++)j=j+S[F-1]<<1,K[F]=j;for(le=0;le<=P;le++){let re=A[le*2+1];re!==0&&(A[le*2]=xe(K[re]++,re))}},Le=()=>{let A,P,S,K,j;const F=new Array(y+1);for(S=0,K=0;K<p-1;K++)for(q[K]=S,A=0;A<1<<N[K];A++)$[S++]=K;for($[S-1]=K,j=0,K=0;K<16;K++)for(Q[K]=j,A=0;A<1<<L[K];A++)J[j++]=K;for(j>>=7;K<m;K++)for(Q[K]=j<<7,A=0;A<1<<L[K]-7;A++)J[256+j++]=K;for(P=0;P<=y;P++)F[P]=0;for(A=0;A<=143;)B[A*2+1]=8,A++,F[8]++;for(;A<=255;)B[A*2+1]=9,A++,F[9]++;for(;A<=279;)B[A*2+1]=7,A++,F[7]++;for(;A<=287;)B[A*2+1]=8,A++,F[8]++;for(Me(B,f+1,F),A=0;A<m;A++)V[A*2+1]=5,V[A*2]=xe(A,5);Y=new ie(B,N,g+1,f,y),ne=new ie(V,L,0,m,y),de=new ie(new Array(0),U,0,C,E)},Ue=A=>{let P;for(P=0;P<f;P++)A.dyn_ltree[P*2]=0;for(P=0;P<m;P++)A.dyn_dtree[P*2]=0;for(P=0;P<C;P++)A.bl_tree[P*2]=0;A.dyn_ltree[b*2]=1,A.opt_len=A.static_len=0,A.sym_next=A.matches=0},at=A=>{A.bi_valid>8?pe(A,A.bi_buf):A.bi_valid>0&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0},Bt=(A,P,S,K)=>{const j=P*2,F=S*2;return A[j]<A[F]||A[j]===A[F]&&K[P]<=K[S]},Fe=(A,P,S)=>{const K=A.heap[S];let j=S<<1;for(;j<=A.heap_len&&(j<A.heap_len&&Bt(P,A.heap[j+1],A.heap[j],A.depth)&&j++,!Bt(P,K,A.heap[j],A.depth));)A.heap[S]=A.heap[j],S=j,j<<=1;A.heap[S]=K},Nt=(A,P,S)=>{let K,j,F=0,le,re;if(A.sym_next!==0)do K=A.pending_buf[A.sym_buf+F++]&255,K+=(A.pending_buf[A.sym_buf+F++]&255)<<8,j=A.pending_buf[A.sym_buf+F++],K===0?Te(A,j,P):(le=$[j],Te(A,le+g+1,P),re=N[le],re!==0&&(j-=q[le],fe(A,j,re)),K--,le=Ce(K),Te(A,le,S),re=L[le],re!==0&&(K-=Q[le],fe(A,K,re)));while(F<A.sym_next);Te(A,b,P)},Xe=(A,P)=>{const S=P.dyn_tree,K=P.stat_desc.static_tree,j=P.stat_desc.has_stree,F=P.stat_desc.elems;let le,re,Ne=-1,X;for(A.heap_len=0,A.heap_max=_,le=0;le<F;le++)S[le*2]!==0?(A.heap[++A.heap_len]=Ne=le,A.depth[le]=0):S[le*2+1]=0;for(;A.heap_len<2;)X=A.heap[++A.heap_len]=Ne<2?++Ne:0,S[X*2]=1,A.depth[X]=0,A.opt_len--,j&&(A.static_len-=K[X*2+1]);for(P.max_code=Ne,le=A.heap_len>>1;le>=1;le--)Fe(A,S,le);X=F;do le=A.heap[1],A.heap[1]=A.heap[A.heap_len--],Fe(A,S,1),re=A.heap[1],A.heap[--A.heap_max]=le,A.heap[--A.heap_max]=re,S[X*2]=S[le*2]+S[re*2],A.depth[X]=(A.depth[le]>=A.depth[re]?A.depth[le]:A.depth[re])+1,S[le*2+1]=S[re*2+1]=X,A.heap[1]=X++,Fe(A,S,1);while(A.heap_len>=2);A.heap[--A.heap_max]=A.heap[1],we(A,P),Me(S,Ne,A.bl_count)},vt=(A,P,S)=>{let K,j=-1,F,le=P[0*2+1],re=0,Ne=7,X=4;for(le===0&&(Ne=138,X=3),P[(S+1)*2+1]=65535,K=0;K<=S;K++)F=le,le=P[(K+1)*2+1],!(++re<Ne&&F===le)&&(re<X?A.bl_tree[F*2]+=re:F!==0?(F!==j&&A.bl_tree[F*2]++,A.bl_tree[v*2]++):re<=10?A.bl_tree[I*2]++:A.bl_tree[R*2]++,re=0,j=F,le===0?(Ne=138,X=3):F===le?(Ne=6,X=3):(Ne=7,X=4))},yt=(A,P,S)=>{let K,j=-1,F,le=P[0*2+1],re=0,Ne=7,X=4;for(le===0&&(Ne=138,X=3),K=0;K<=S;K++)if(F=le,le=P[(K+1)*2+1],!(++re<Ne&&F===le)){if(re<X)do Te(A,F,A.bl_tree);while(--re!==0);else F!==0?(F!==j&&(Te(A,F,A.bl_tree),re--),Te(A,v,A.bl_tree),fe(A,re-3,2)):re<=10?(Te(A,I,A.bl_tree),fe(A,re-3,3)):(Te(A,R,A.bl_tree),fe(A,re-11,7));re=0,j=F,le===0?(Ne=138,X=3):F===le?(Ne=6,X=3):(Ne=7,X=4)}},Ht=A=>{let P;for(vt(A,A.dyn_ltree,A.l_desc.max_code),vt(A,A.dyn_dtree,A.d_desc.max_code),Xe(A,A.bl_desc),P=C-1;P>=3&&A.bl_tree[W[P]*2+1]===0;P--);return A.opt_len+=3*(P+1)+5+5+4,P},Dr=(A,P,S,K)=>{let j;for(fe(A,P-257,5),fe(A,S-1,5),fe(A,K-4,4),j=0;j<K;j++)fe(A,A.bl_tree[W[j]*2+1],3);yt(A,A.dyn_ltree,P-1),yt(A,A.dyn_dtree,S-1)},Mt=A=>{let P=4093624447,S;for(S=0;S<=31;S++,P>>>=1)if(P&1&&A.dyn_ltree[S*2]!==0)return 0;if(A.dyn_ltree[9*2]!==0||A.dyn_ltree[10*2]!==0||A.dyn_ltree[13*2]!==0)return 1;for(S=32;S<g;S++)if(A.dyn_ltree[S*2]!==0)return 1;return 0};let ae=!1;const D=A=>{ae||(Le(),ae=!0),A.l_desc=new Ae(A.dyn_ltree,Y),A.d_desc=new Ae(A.dyn_dtree,ne),A.bl_desc=new Ae(A.bl_tree,de),A.bi_buf=0,A.bi_valid=0,Ue(A)},O=(A,P,S,K)=>{fe(A,(l<<1)+(K?1:0),3),at(A),pe(A,S),pe(A,~S),S&&A.pending_buf.set(A.window.subarray(P,P+S),A.pending),A.pending+=S},k=A=>{fe(A,u<<1,3),Te(A,b,B),Re(A)},w=(A,P,S,K)=>{let j,F,le=0;A.level>0?(A.strm.data_type===2&&(A.strm.data_type=Mt(A)),Xe(A,A.l_desc),Xe(A,A.d_desc),le=Ht(A),j=A.opt_len+3+7>>>3,F=A.static_len+3+7>>>3,F<=j&&(j=F)):j=F=S+5,S+4<=j&&P!==-1?O(A,P,S,K):A.strategy===4||F===j?(fe(A,(u<<1)+(K?1:0),3),Nt(A,B,V)):(fe(A,(c<<1)+(K?1:0),3),Dr(A,A.l_desc.max_code+1,A.d_desc.max_code+1,le+1),Nt(A,A.dyn_ltree,A.dyn_dtree)),Ue(A),K&&at(A)},z=(A,P,S)=>(A.pending_buf[A.sym_buf+A.sym_next++]=P,A.pending_buf[A.sym_buf+A.sym_next++]=P>>8,A.pending_buf[A.sym_buf+A.sym_next++]=S,P===0?A.dyn_ltree[S*2]++:(A.matches++,P--,A.dyn_ltree[($[S]+g+1)*2]++,A.dyn_dtree[Ce(P)*2]++),A.sym_next===A.sym_end);var Z=D,se=O,me=w,Pe=z,be=k,He={_tr_init:Z,_tr_stored_block:se,_tr_flush_block:me,_tr_tally:Pe,_tr_align:be},Zr=(A,P,S,K)=>{let j=A&65535|0,F=A>>>16&65535|0,le=0;for(;S!==0;){le=S>2e3?2e3:S,S-=le;do j=j+P[K++]|0,F=F+j|0;while(--le);j%=65521,F%=65521}return j|F<<16|0};const $i=()=>{let A,P=[];for(var S=0;S<256;S++){A=S;for(var K=0;K<8;K++)A=A&1?3988292384^A>>>1:A>>>1;P[S]=A}return P},Yi=new Uint32Array($i());var Et=(A,P,S,K)=>{const j=Yi,F=K+S;A^=-1;for(let le=K;le<F;le++)A=A>>>8^j[(A^P[le])&255];return A^-1},pr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ai={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ba,_tr_stored_block:xi,_tr_flush_block:Ml,_tr_tally:si,_tr_align:xl}=He,{Z_NO_FLUSH:li,Z_PARTIAL_FLUSH:Ll,Z_FULL_FLUSH:va,Z_FINISH:gr,Z_BLOCK:ka,Z_OK:Qt,Z_STREAM_END:Ia,Z_STREAM_ERROR:Fr,Z_DATA_ERROR:Kl,Z_BUF_ERROR:fo,Z_DEFAULT_COMPRESSION:Da,Z_FILTERED:Ra,Z_HUFFMAN_ONLY:Xi,Z_RLE:Pa,Z_FIXED:Na,Z_DEFAULT_STRATEGY:mo,Z_UNKNOWN:Ti,Z_DEFLATED:ui}=ai,Ji=9,Dn=15,Rn=8,Vr=256+1+29,Qr=30,Zi=19,x=2*Vr+1,H=15,G=3,ce=258,ye=ce+G+1,Ke=32,Ge=42,gt=57,We=69,St=73,Gt=91,ci=103,jr=113,Wr=666,ir=1,Ei=2,Tr=3,di=4,Pr=3,nr=(A,P)=>(A.msg=pr[P],P),Qi=A=>A*2-(A>4?9:0),Hr=A=>{let P=A.length;for(;--P>=0;)A[P]=0},Co=A=>{let P,S,K,j=A.w_size;P=A.hash_size,K=P;do S=A.head[--K],A.head[K]=S>=j?S-j:0;while(--P);P=j,K=P;do S=A.prev[--K],A.prev[K]=S>=j?S-j:0;while(--P)};let Li=(A,P,S)=>(P<<A.hash_shift^S)&A.hash_mask;const Nr=A=>{const P=A.state;let S=P.pending;S>A.avail_out&&(S=A.avail_out),S!==0&&(A.output.set(P.pending_buf.subarray(P.pending_out,P.pending_out+S),A.next_out),A.next_out+=S,P.pending_out+=S,A.total_out+=S,A.avail_out-=S,P.pending-=S,P.pending===0&&(P.pending_out=0))},Mr=(A,P)=>{Ml(A,A.block_start>=0?A.block_start:-1,A.strstart-A.block_start,P),A.block_start=A.strstart,Nr(A.strm)},Ct=(A,P)=>{A.pending_buf[A.pending++]=P},_o=(A,P)=>{A.pending_buf[A.pending++]=P>>>8&255,A.pending_buf[A.pending++]=P&255},wl=(A,P,S,K)=>{let j=A.avail_in;return j>K&&(j=K),j===0?0:(A.avail_in-=j,P.set(A.input.subarray(A.next_in,A.next_in+j),S),A.state.wrap===1?A.adler=Zr(A.adler,P,j,S):A.state.wrap===2&&(A.adler=Et(A.adler,P,j,S)),A.next_in+=j,A.total_in+=j,j)},id=(A,P)=>{let S=A.max_chain_length,K=A.strstart,j,F,le=A.prev_length,re=A.nice_match;const Ne=A.strstart>A.w_size-ye?A.strstart-(A.w_size-ye):0,X=A.window,ue=A.w_mask,ft=A.prev,Ie=A.strstart+ce;let _e=X[K+le-1],Ve=X[K+le];A.prev_length>=A.good_match&&(S>>=2),re>A.lookahead&&(re=A.lookahead);do if(j=P,!(X[j+le]!==Ve||X[j+le-1]!==_e||X[j]!==X[K]||X[++j]!==X[K+1])){K+=2,j++;do;while(X[++K]===X[++j]&&X[++K]===X[++j]&&X[++K]===X[++j]&&X[++K]===X[++j]&&X[++K]===X[++j]&&X[++K]===X[++j]&&X[++K]===X[++j]&&X[++K]===X[++j]&&K<Ie);if(F=ce-(Ie-K),K=Ie-ce,F>le){if(A.match_start=P,le=F,F>=re)break;_e=X[K+le-1],Ve=X[K+le]}}while((P=ft[P&ue])>Ne&&--S!==0);return le<=A.lookahead?le:A.lookahead},Pn=A=>{const P=A.w_size;let S,K,j;do{if(K=A.window_size-A.lookahead-A.strstart,A.strstart>=P+(P-ye)&&(A.window.set(A.window.subarray(P,P+P-K),0),A.match_start-=P,A.strstart-=P,A.block_start-=P,A.insert>A.strstart&&(A.insert=A.strstart),Co(A),K+=P),A.strm.avail_in===0)break;if(S=wl(A.strm,A.window,A.strstart+A.lookahead,K),A.lookahead+=S,A.lookahead+A.insert>=G)for(j=A.strstart-A.insert,A.ins_h=A.window[j],A.ins_h=Li(A,A.ins_h,A.window[j+1]);A.insert&&(A.ins_h=Li(A,A.ins_h,A.window[j+G-1]),A.prev[j&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=j,j++,A.insert--,!(A.lookahead+A.insert<G)););}while(A.lookahead<ye&&A.strm.avail_in!==0)},nd=(A,P)=>{let S=A.pending_buf_size-5>A.w_size?A.w_size:A.pending_buf_size-5,K,j,F,le=0,re=A.strm.avail_in;do{if(K=65535,F=A.bi_valid+42>>3,A.strm.avail_out<F||(F=A.strm.avail_out-F,j=A.strstart-A.block_start,K>j+A.strm.avail_in&&(K=j+A.strm.avail_in),K>F&&(K=F),K<S&&(K===0&&P!==gr||P===li||K!==j+A.strm.avail_in)))break;le=P===gr&&K===j+A.strm.avail_in?1:0,xi(A,0,0,le),A.pending_buf[A.pending-4]=K,A.pending_buf[A.pending-3]=K>>8,A.pending_buf[A.pending-2]=~K,A.pending_buf[A.pending-1]=~K>>8,Nr(A.strm),j&&(j>K&&(j=K),A.strm.output.set(A.window.subarray(A.block_start,A.block_start+j),A.strm.next_out),A.strm.next_out+=j,A.strm.avail_out-=j,A.strm.total_out+=j,A.block_start+=j,K-=j),K&&(wl(A.strm,A.strm.output,A.strm.next_out,K),A.strm.next_out+=K,A.strm.avail_out-=K,A.strm.total_out+=K)}while(le===0);return re-=A.strm.avail_in,re&&(re>=A.w_size?(A.matches=2,A.window.set(A.strm.input.subarray(A.strm.next_in-A.w_size,A.strm.next_in),0),A.strstart=A.w_size,A.insert=A.strstart):(A.window_size-A.strstart<=re&&(A.strstart-=A.w_size,A.window.set(A.window.subarray(A.w_size,A.w_size+A.strstart),0),A.matches<2&&A.matches++,A.insert>A.strstart&&(A.insert=A.strstart)),A.window.set(A.strm.input.subarray(A.strm.next_in-re,A.strm.next_in),A.strstart),A.strstart+=re,A.insert+=re>A.w_size-A.insert?A.w_size-A.insert:re),A.block_start=A.strstart),A.high_water<A.strstart&&(A.high_water=A.strstart),le?di:P!==li&&P!==gr&&A.strm.avail_in===0&&A.strstart===A.block_start?Ei:(F=A.window_size-A.strstart,A.strm.avail_in>F&&A.block_start>=A.w_size&&(A.block_start-=A.w_size,A.strstart-=A.w_size,A.window.set(A.window.subarray(A.w_size,A.w_size+A.strstart),0),A.matches<2&&A.matches++,F+=A.w_size,A.insert>A.strstart&&(A.insert=A.strstart)),F>A.strm.avail_in&&(F=A.strm.avail_in),F&&(wl(A.strm,A.window,A.strstart,F),A.strstart+=F,A.insert+=F>A.w_size-A.insert?A.w_size-A.insert:F),A.high_water<A.strstart&&(A.high_water=A.strstart),F=A.bi_valid+42>>3,F=A.pending_buf_size-F>65535?65535:A.pending_buf_size-F,S=F>A.w_size?A.w_size:F,j=A.strstart-A.block_start,(j>=S||(j||P===gr)&&P!==li&&A.strm.avail_in===0&&j<=F)&&(K=j>F?F:j,le=P===gr&&A.strm.avail_in===0&&K===j?1:0,xi(A,A.block_start,K,le),A.block_start+=K,Nr(A.strm)),le?Tr:ir)},Bl=(A,P)=>{let S,K;for(;;){if(A.lookahead<ye){if(Pn(A),A.lookahead<ye&&P===li)return ir;if(A.lookahead===0)break}if(S=0,A.lookahead>=G&&(A.ins_h=Li(A,A.ins_h,A.window[A.strstart+G-1]),S=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),S!==0&&A.strstart-S<=A.w_size-ye&&(A.match_length=id(A,S)),A.match_length>=G)if(K=si(A,A.strstart-A.match_start,A.match_length-G),A.lookahead-=A.match_length,A.match_length<=A.max_lazy_match&&A.lookahead>=G){A.match_length--;do A.strstart++,A.ins_h=Li(A,A.ins_h,A.window[A.strstart+G-1]),S=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart;while(--A.match_length!==0);A.strstart++}else A.strstart+=A.match_length,A.match_length=0,A.ins_h=A.window[A.strstart],A.ins_h=Li(A,A.ins_h,A.window[A.strstart+1]);else K=si(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++;if(K&&(Mr(A,!1),A.strm.avail_out===0))return ir}return A.insert=A.strstart<G-1?A.strstart:G-1,P===gr?(Mr(A,!0),A.strm.avail_out===0?Tr:di):A.sym_next&&(Mr(A,!1),A.strm.avail_out===0)?ir:Ei},Nn=(A,P)=>{let S,K,j;for(;;){if(A.lookahead<ye){if(Pn(A),A.lookahead<ye&&P===li)return ir;if(A.lookahead===0)break}if(S=0,A.lookahead>=G&&(A.ins_h=Li(A,A.ins_h,A.window[A.strstart+G-1]),S=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),A.prev_length=A.match_length,A.prev_match=A.match_start,A.match_length=G-1,S!==0&&A.prev_length<A.max_lazy_match&&A.strstart-S<=A.w_size-ye&&(A.match_length=id(A,S),A.match_length<=5&&(A.strategy===Ra||A.match_length===G&&A.strstart-A.match_start>4096)&&(A.match_length=G-1)),A.prev_length>=G&&A.match_length<=A.prev_length){j=A.strstart+A.lookahead-G,K=si(A,A.strstart-1-A.prev_match,A.prev_length-G),A.lookahead-=A.prev_length-1,A.prev_length-=2;do++A.strstart<=j&&(A.ins_h=Li(A,A.ins_h,A.window[A.strstart+G-1]),S=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart);while(--A.prev_length!==0);if(A.match_available=0,A.match_length=G-1,A.strstart++,K&&(Mr(A,!1),A.strm.avail_out===0))return ir}else if(A.match_available){if(K=si(A,0,A.window[A.strstart-1]),K&&Mr(A,!1),A.strstart++,A.lookahead--,A.strm.avail_out===0)return ir}else A.match_available=1,A.strstart++,A.lookahead--}return A.match_available&&(K=si(A,0,A.window[A.strstart-1]),A.match_available=0),A.insert=A.strstart<G-1?A.strstart:G-1,P===gr?(Mr(A,!0),A.strm.avail_out===0?Tr:di):A.sym_next&&(Mr(A,!1),A.strm.avail_out===0)?ir:Ei},Lm=(A,P)=>{let S,K,j,F;const le=A.window;for(;;){if(A.lookahead<=ce){if(Pn(A),A.lookahead<=ce&&P===li)return ir;if(A.lookahead===0)break}if(A.match_length=0,A.lookahead>=G&&A.strstart>0&&(j=A.strstart-1,K=le[j],K===le[++j]&&K===le[++j]&&K===le[++j])){F=A.strstart+ce;do;while(K===le[++j]&&K===le[++j]&&K===le[++j]&&K===le[++j]&&K===le[++j]&&K===le[++j]&&K===le[++j]&&K===le[++j]&&j<F);A.match_length=ce-(F-j),A.match_length>A.lookahead&&(A.match_length=A.lookahead)}if(A.match_length>=G?(S=si(A,1,A.match_length-G),A.lookahead-=A.match_length,A.strstart+=A.match_length,A.match_length=0):(S=si(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++),S&&(Mr(A,!1),A.strm.avail_out===0))return ir}return A.insert=0,P===gr?(Mr(A,!0),A.strm.avail_out===0?Tr:di):A.sym_next&&(Mr(A,!1),A.strm.avail_out===0)?ir:Ei},Km=(A,P)=>{let S;for(;;){if(A.lookahead===0&&(Pn(A),A.lookahead===0)){if(P===li)return ir;break}if(A.match_length=0,S=si(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++,S&&(Mr(A,!1),A.strm.avail_out===0))return ir}return A.insert=0,P===gr?(Mr(A,!0),A.strm.avail_out===0?Tr:di):A.sym_next&&(Mr(A,!1),A.strm.avail_out===0)?ir:Ei};function hi(A,P,S,K,j){this.good_length=A,this.max_lazy=P,this.nice_length=S,this.max_chain=K,this.func=j}const yo=[new hi(0,0,0,0,nd),new hi(4,4,8,4,Bl),new hi(4,5,16,8,Bl),new hi(4,6,32,32,Bl),new hi(4,4,16,16,Nn),new hi(8,16,32,32,Nn),new hi(8,16,128,128,Nn),new hi(8,32,128,256,Nn),new hi(32,128,258,1024,Nn),new hi(32,258,258,4096,Nn)],wm=A=>{A.window_size=2*A.w_size,Hr(A.head),A.max_lazy_match=yo[A.level].max_lazy,A.good_match=yo[A.level].good_length,A.nice_match=yo[A.level].nice_length,A.max_chain_length=yo[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=G-1,A.match_available=0,A.ins_h=0};function Bm(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ui,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(x*2),this.dyn_dtree=new Uint16Array((2*Qr+1)*2),this.bl_tree=new Uint16Array((2*Zi+1)*2),Hr(this.dyn_ltree),Hr(this.dyn_dtree),Hr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(H+1),this.heap=new Uint16Array(2*Vr+1),Hr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Vr+1),Hr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ao=A=>{if(!A)return 1;const P=A.state;return!P||P.strm!==A||P.status!==Ge&&P.status!==gt&&P.status!==We&&P.status!==St&&P.status!==Gt&&P.status!==ci&&P.status!==jr&&P.status!==Wr?1:0},od=A=>{if(Ao(A))return nr(A,Fr);A.total_in=A.total_out=0,A.data_type=Ti;const P=A.state;return P.pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap===2?gt:P.wrap?Ge:jr,A.adler=P.wrap===2?0:1,P.last_flush=-2,ba(P),Qt},ad=A=>{const P=od(A);return P===Qt&&wm(A.state),P},Um=(A,P)=>Ao(A)||A.state.wrap!==2?Fr:(A.state.gzhead=P,Qt),sd=(A,P,S,K,j,F)=>{if(!A)return Fr;let le=1;if(P===Da&&(P=6),K<0?(le=0,K=-K):K>15&&(le=2,K-=16),j<1||j>Ji||S!==ui||K<8||K>15||P<0||P>9||F<0||F>Na||K===8&&le!==1)return nr(A,Fr);K===8&&(K=9);const re=new Bm;return A.state=re,re.strm=A,re.status=Ge,re.wrap=le,re.gzhead=null,re.w_bits=K,re.w_size=1<<re.w_bits,re.w_mask=re.w_size-1,re.hash_bits=j+7,re.hash_size=1<<re.hash_bits,re.hash_mask=re.hash_size-1,re.hash_shift=~~((re.hash_bits+G-1)/G),re.window=new Uint8Array(re.w_size*2),re.head=new Uint16Array(re.hash_size),re.prev=new Uint16Array(re.w_size),re.lit_bufsize=1<<j+6,re.pending_buf_size=re.lit_bufsize*4,re.pending_buf=new Uint8Array(re.pending_buf_size),re.sym_buf=re.lit_bufsize,re.sym_end=(re.lit_bufsize-1)*3,re.level=P,re.strategy=F,re.method=S,ad(A)},Fm=(A,P)=>sd(A,P,ui,Dn,Rn,mo),Vm=(A,P)=>{if(Ao(A)||P>ka||P<0)return A?nr(A,Fr):Fr;const S=A.state;if(!A.output||A.avail_in!==0&&!A.input||S.status===Wr&&P!==gr)return nr(A,A.avail_out===0?fo:Fr);const K=S.last_flush;if(S.last_flush=P,S.pending!==0){if(Nr(A),A.avail_out===0)return S.last_flush=-1,Qt}else if(A.avail_in===0&&Qi(P)<=Qi(K)&&P!==gr)return nr(A,fo);if(S.status===Wr&&A.avail_in!==0)return nr(A,fo);if(S.status===Ge&&S.wrap===0&&(S.status=jr),S.status===Ge){let j=ui+(S.w_bits-8<<4)<<8,F=-1;if(S.strategy>=Xi||S.level<2?F=0:S.level<6?F=1:S.level===6?F=2:F=3,j|=F<<6,S.strstart!==0&&(j|=Ke),j+=31-j%31,_o(S,j),S.strstart!==0&&(_o(S,A.adler>>>16),_o(S,A.adler&65535)),A.adler=1,S.status=jr,Nr(A),S.pending!==0)return S.last_flush=-1,Qt}if(S.status===gt){if(A.adler=0,Ct(S,31),Ct(S,139),Ct(S,8),S.gzhead)Ct(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),Ct(S,S.gzhead.time&255),Ct(S,S.gzhead.time>>8&255),Ct(S,S.gzhead.time>>16&255),Ct(S,S.gzhead.time>>24&255),Ct(S,S.level===9?2:S.strategy>=Xi||S.level<2?4:0),Ct(S,S.gzhead.os&255),S.gzhead.extra&&S.gzhead.extra.length&&(Ct(S,S.gzhead.extra.length&255),Ct(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(A.adler=Et(A.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=We;else if(Ct(S,0),Ct(S,0),Ct(S,0),Ct(S,0),Ct(S,0),Ct(S,S.level===9?2:S.strategy>=Xi||S.level<2?4:0),Ct(S,Pr),S.status=jr,Nr(A),S.pending!==0)return S.last_flush=-1,Qt}if(S.status===We){if(S.gzhead.extra){let j=S.pending,F=(S.gzhead.extra.length&65535)-S.gzindex;for(;S.pending+F>S.pending_buf_size;){let re=S.pending_buf_size-S.pending;if(S.pending_buf.set(S.gzhead.extra.subarray(S.gzindex,S.gzindex+re),S.pending),S.pending=S.pending_buf_size,S.gzhead.hcrc&&S.pending>j&&(A.adler=Et(A.adler,S.pending_buf,S.pending-j,j)),S.gzindex+=re,Nr(A),S.pending!==0)return S.last_flush=-1,Qt;j=0,F-=re}let le=new Uint8Array(S.gzhead.extra);S.pending_buf.set(le.subarray(S.gzindex,S.gzindex+F),S.pending),S.pending+=F,S.gzhead.hcrc&&S.pending>j&&(A.adler=Et(A.adler,S.pending_buf,S.pending-j,j)),S.gzindex=0}S.status=St}if(S.status===St){if(S.gzhead.name){let j=S.pending,F;do{if(S.pending===S.pending_buf_size){if(S.gzhead.hcrc&&S.pending>j&&(A.adler=Et(A.adler,S.pending_buf,S.pending-j,j)),Nr(A),S.pending!==0)return S.last_flush=-1,Qt;j=0}S.gzindex<S.gzhead.name.length?F=S.gzhead.name.charCodeAt(S.gzindex++)&255:F=0,Ct(S,F)}while(F!==0);S.gzhead.hcrc&&S.pending>j&&(A.adler=Et(A.adler,S.pending_buf,S.pending-j,j)),S.gzindex=0}S.status=Gt}if(S.status===Gt){if(S.gzhead.comment){let j=S.pending,F;do{if(S.pending===S.pending_buf_size){if(S.gzhead.hcrc&&S.pending>j&&(A.adler=Et(A.adler,S.pending_buf,S.pending-j,j)),Nr(A),S.pending!==0)return S.last_flush=-1,Qt;j=0}S.gzindex<S.gzhead.comment.length?F=S.gzhead.comment.charCodeAt(S.gzindex++)&255:F=0,Ct(S,F)}while(F!==0);S.gzhead.hcrc&&S.pending>j&&(A.adler=Et(A.adler,S.pending_buf,S.pending-j,j))}S.status=ci}if(S.status===ci){if(S.gzhead.hcrc){if(S.pending+2>S.pending_buf_size&&(Nr(A),S.pending!==0))return S.last_flush=-1,Qt;Ct(S,A.adler&255),Ct(S,A.adler>>8&255),A.adler=0}if(S.status=jr,Nr(A),S.pending!==0)return S.last_flush=-1,Qt}if(A.avail_in!==0||S.lookahead!==0||P!==li&&S.status!==Wr){let j=S.level===0?nd(S,P):S.strategy===Xi?Km(S,P):S.strategy===Pa?Lm(S,P):yo[S.level].func(S,P);if((j===Tr||j===di)&&(S.status=Wr),j===ir||j===Tr)return A.avail_out===0&&(S.last_flush=-1),Qt;if(j===Ei&&(P===Ll?xl(S):P!==ka&&(xi(S,0,0,!1),P===va&&(Hr(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),Nr(A),A.avail_out===0))return S.last_flush=-1,Qt}return P!==gr?Qt:S.wrap<=0?Ia:(S.wrap===2?(Ct(S,A.adler&255),Ct(S,A.adler>>8&255),Ct(S,A.adler>>16&255),Ct(S,A.adler>>24&255),Ct(S,A.total_in&255),Ct(S,A.total_in>>8&255),Ct(S,A.total_in>>16&255),Ct(S,A.total_in>>24&255)):(_o(S,A.adler>>>16),_o(S,A.adler&65535)),Nr(A),S.wrap>0&&(S.wrap=-S.wrap),S.pending!==0?Qt:Ia)},jm=A=>{if(Ao(A))return Fr;const P=A.state.status;return A.state=null,P===jr?nr(A,Kl):Qt},Wm=(A,P)=>{let S=P.length;if(Ao(A))return Fr;const K=A.state,j=K.wrap;if(j===2||j===1&&K.status!==Ge||K.lookahead)return Fr;if(j===1&&(A.adler=Zr(A.adler,P,S,0)),K.wrap=0,S>=K.w_size){j===0&&(Hr(K.head),K.strstart=0,K.block_start=0,K.insert=0);let Ne=new Uint8Array(K.w_size);Ne.set(P.subarray(S-K.w_size,S),0),P=Ne,S=K.w_size}const F=A.avail_in,le=A.next_in,re=A.input;for(A.avail_in=S,A.next_in=0,A.input=P,Pn(K);K.lookahead>=G;){let Ne=K.strstart,X=K.lookahead-(G-1);do K.ins_h=Li(K,K.ins_h,K.window[Ne+G-1]),K.prev[Ne&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=Ne,Ne++;while(--X);K.strstart=Ne,K.lookahead=G-1,Pn(K)}return K.strstart+=K.lookahead,K.block_start=K.strstart,K.insert=K.lookahead,K.lookahead=0,K.match_length=K.prev_length=G-1,K.match_available=0,A.next_in=le,A.input=re,A.avail_in=F,K.wrap=j,Qt};var Hm=Fm,Gm=sd,zm=ad,$m=od,Ym=Um,Xm=Vm,Jm=jm,qm=Wm,Zm="pako deflate (from Nodeca project)",To={deflateInit:Hm,deflateInit2:Gm,deflateReset:zm,deflateResetKeep:$m,deflateSetHeader:Ym,deflate:Xm,deflateEnd:Jm,deflateSetDictionary:qm,deflateInfo:Zm};const Qm=(A,P)=>Object.prototype.hasOwnProperty.call(A,P);var eC=function(A){const P=Array.prototype.slice.call(arguments,1);for(;P.length;){const S=P.shift();if(S){if(typeof S!="object")throw new TypeError(S+"must be non-object");for(const K in S)Qm(S,K)&&(A[K]=S[K])}}return A},tC=A=>{let P=0;for(let K=0,j=A.length;K<j;K++)P+=A[K].length;const S=new Uint8Array(P);for(let K=0,j=0,F=A.length;K<F;K++){let le=A[K];S.set(le,j),j+=le.length}return S},xa={assign:eC,flattenChunks:tC};let ld=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ld=!1}const Eo=new Uint8Array(256);for(let A=0;A<256;A++)Eo[A]=A>=252?6:A>=248?5:A>=240?4:A>=224?3:A>=192?2:1;Eo[254]=Eo[254]=1;var rC=A=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(A);let P,S,K,j,F,le=A.length,re=0;for(j=0;j<le;j++)S=A.charCodeAt(j),(S&64512)===55296&&j+1<le&&(K=A.charCodeAt(j+1),(K&64512)===56320&&(S=65536+(S-55296<<10)+(K-56320),j++)),re+=S<128?1:S<2048?2:S<65536?3:4;for(P=new Uint8Array(re),F=0,j=0;F<re;j++)S=A.charCodeAt(j),(S&64512)===55296&&j+1<le&&(K=A.charCodeAt(j+1),(K&64512)===56320&&(S=65536+(S-55296<<10)+(K-56320),j++)),S<128?P[F++]=S:S<2048?(P[F++]=192|S>>>6,P[F++]=128|S&63):S<65536?(P[F++]=224|S>>>12,P[F++]=128|S>>>6&63,P[F++]=128|S&63):(P[F++]=240|S>>>18,P[F++]=128|S>>>12&63,P[F++]=128|S>>>6&63,P[F++]=128|S&63);return P};const iC=(A,P)=>{if(P<65534&&A.subarray&&ld)return String.fromCharCode.apply(null,A.length===P?A:A.subarray(0,P));let S="";for(let K=0;K<P;K++)S+=String.fromCharCode(A[K]);return S};var nC=(A,P)=>{const S=P||A.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(A.subarray(0,P));let K,j;const F=new Array(S*2);for(j=0,K=0;K<S;){let le=A[K++];if(le<128){F[j++]=le;continue}let re=Eo[le];if(re>4){F[j++]=65533,K+=re-1;continue}for(le&=re===2?31:re===3?15:7;re>1&&K<S;)le=le<<6|A[K++]&63,re--;if(re>1){F[j++]=65533;continue}le<65536?F[j++]=le:(le-=65536,F[j++]=55296|le>>10&1023,F[j++]=56320|le&1023)}return iC(F,j)},oC=(A,P)=>{P=P||A.length,P>A.length&&(P=A.length);let S=P-1;for(;S>=0&&(A[S]&192)===128;)S--;return S<0||S===0?P:S+Eo[A[S]]>P?S:P},So={string2buf:rC,buf2string:nC,utf8border:oC};function aC(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ud=aC;const cd=Object.prototype.toString,{Z_NO_FLUSH:sC,Z_SYNC_FLUSH:lC,Z_FULL_FLUSH:uC,Z_FINISH:cC,Z_OK:La,Z_STREAM_END:dC,Z_DEFAULT_COMPRESSION:hC,Z_DEFAULT_STRATEGY:pC,Z_DEFLATED:gC}=ai;function Oo(A){this.options=xa.assign({level:hC,method:gC,chunkSize:16384,windowBits:15,memLevel:8,strategy:pC},A||{});let P=this.options;P.raw&&P.windowBits>0?P.windowBits=-P.windowBits:P.gzip&&P.windowBits>0&&P.windowBits<16&&(P.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ud,this.strm.avail_out=0;let S=To.deflateInit2(this.strm,P.level,P.method,P.windowBits,P.memLevel,P.strategy);if(S!==La)throw new Error(pr[S]);if(P.header&&To.deflateSetHeader(this.strm,P.header),P.dictionary){let K;if(typeof P.dictionary=="string"?K=So.string2buf(P.dictionary):cd.call(P.dictionary)==="[object ArrayBuffer]"?K=new Uint8Array(P.dictionary):K=P.dictionary,S=To.deflateSetDictionary(this.strm,K),S!==La)throw new Error(pr[S]);this._dict_set=!0}}Oo.prototype.push=function(A,P){const S=this.strm,K=this.options.chunkSize;let j,F;if(this.ended)return!1;for(P===~~P?F=P:F=P===!0?cC:sC,typeof A=="string"?S.input=So.string2buf(A):cd.call(A)==="[object ArrayBuffer]"?S.input=new Uint8Array(A):S.input=A,S.next_in=0,S.avail_in=S.input.length;;){if(S.avail_out===0&&(S.output=new Uint8Array(K),S.next_out=0,S.avail_out=K),(F===lC||F===uC)&&S.avail_out<=6){this.onData(S.output.subarray(0,S.next_out)),S.avail_out=0;continue}if(j=To.deflate(S,F),j===dC)return S.next_out>0&&this.onData(S.output.subarray(0,S.next_out)),j=To.deflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===La;if(S.avail_out===0){this.onData(S.output);continue}if(F>0&&S.next_out>0){this.onData(S.output.subarray(0,S.next_out)),S.avail_out=0;continue}if(S.avail_in===0)break}return!0},Oo.prototype.onData=function(A){this.chunks.push(A)},Oo.prototype.onEnd=function(A){A===La&&(this.result=xa.flattenChunks(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg};function Ul(A,P){const S=new Oo(P);if(S.push(A,!0),S.err)throw S.msg||pr[S.err];return S.result}function fC(A,P){return P=P||{},P.raw=!0,Ul(A,P)}function mC(A,P){return P=P||{},P.gzip=!0,Ul(A,P)}var CC=Oo,_C=Ul,yC=fC,AC=mC,TC=ai,EC={Deflate:CC,deflate:_C,deflateRaw:yC,gzip:AC,constants:TC};const Ka=16209,SC=16191;var OC=function(P,S){let K,j,F,le,re,Ne,X,ue,ft,Ie,_e,Ve,Vt,lt,et,At,ot,ke,_t,or,je,Rt,ut,Ze;const st=P.state;K=P.next_in,ut=P.input,j=K+(P.avail_in-5),F=P.next_out,Ze=P.output,le=F-(S-P.avail_out),re=F+(P.avail_out-257),Ne=st.dmax,X=st.wsize,ue=st.whave,ft=st.wnext,Ie=st.window,_e=st.hold,Ve=st.bits,Vt=st.lencode,lt=st.distcode,et=(1<<st.lenbits)-1,At=(1<<st.distbits)-1;e:do{Ve<15&&(_e+=ut[K++]<<Ve,Ve+=8,_e+=ut[K++]<<Ve,Ve+=8),ot=Vt[_e&et];t:for(;;){if(ke=ot>>>24,_e>>>=ke,Ve-=ke,ke=ot>>>16&255,ke===0)Ze[F++]=ot&65535;else if(ke&16){_t=ot&65535,ke&=15,ke&&(Ve<ke&&(_e+=ut[K++]<<Ve,Ve+=8),_t+=_e&(1<<ke)-1,_e>>>=ke,Ve-=ke),Ve<15&&(_e+=ut[K++]<<Ve,Ve+=8,_e+=ut[K++]<<Ve,Ve+=8),ot=lt[_e&At];r:for(;;){if(ke=ot>>>24,_e>>>=ke,Ve-=ke,ke=ot>>>16&255,ke&16){if(or=ot&65535,ke&=15,Ve<ke&&(_e+=ut[K++]<<Ve,Ve+=8,Ve<ke&&(_e+=ut[K++]<<Ve,Ve+=8)),or+=_e&(1<<ke)-1,or>Ne){P.msg="invalid distance too far back",st.mode=Ka;break e}if(_e>>>=ke,Ve-=ke,ke=F-le,or>ke){if(ke=or-ke,ke>ue&&st.sane){P.msg="invalid distance too far back",st.mode=Ka;break e}if(je=0,Rt=Ie,ft===0){if(je+=X-ke,ke<_t){_t-=ke;do Ze[F++]=Ie[je++];while(--ke);je=F-or,Rt=Ze}}else if(ft<ke){if(je+=X+ft-ke,ke-=ft,ke<_t){_t-=ke;do Ze[F++]=Ie[je++];while(--ke);if(je=0,ft<_t){ke=ft,_t-=ke;do Ze[F++]=Ie[je++];while(--ke);je=F-or,Rt=Ze}}}else if(je+=ft-ke,ke<_t){_t-=ke;do Ze[F++]=Ie[je++];while(--ke);je=F-or,Rt=Ze}for(;_t>2;)Ze[F++]=Rt[je++],Ze[F++]=Rt[je++],Ze[F++]=Rt[je++],_t-=3;_t&&(Ze[F++]=Rt[je++],_t>1&&(Ze[F++]=Rt[je++]))}else{je=F-or;do Ze[F++]=Ze[je++],Ze[F++]=Ze[je++],Ze[F++]=Ze[je++],_t-=3;while(_t>2);_t&&(Ze[F++]=Ze[je++],_t>1&&(Ze[F++]=Ze[je++]))}}else if(ke&64){P.msg="invalid distance code",st.mode=Ka;break e}else{ot=lt[(ot&65535)+(_e&(1<<ke)-1)];continue r}break}}else if(ke&64)if(ke&32){st.mode=SC;break e}else{P.msg="invalid literal/length code",st.mode=Ka;break e}else{ot=Vt[(ot&65535)+(_e&(1<<ke)-1)];continue t}break}}while(K<j&&F<re);_t=Ve>>3,K-=_t,Ve-=_t<<3,_e&=(1<<Ve)-1,P.next_in=K,P.next_out=F,P.avail_in=K<j?5+(j-K):5-(K-j),P.avail_out=F<re?257+(re-F):257-(F-re),st.hold=_e,st.bits=Ve};const Mn=15,dd=852,hd=592,pd=0,Fl=1,gd=2,bC=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),vC=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),kC=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),IC=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var bo=(A,P,S,K,j,F,le,re)=>{const Ne=re.bits;let X=0,ue=0,ft=0,Ie=0,_e=0,Ve=0,Vt=0,lt=0,et=0,At=0,ot,ke,_t,or,je,Rt=null,ut;const Ze=new Uint16Array(Mn+1),st=new Uint16Array(Mn+1);let rn=null,lh,ja,Wa;for(X=0;X<=Mn;X++)Ze[X]=0;for(ue=0;ue<K;ue++)Ze[P[S+ue]]++;for(_e=Ne,Ie=Mn;Ie>=1&&Ze[Ie]===0;Ie--);if(_e>Ie&&(_e=Ie),Ie===0)return j[F++]=1<<24|64<<16|0,j[F++]=1<<24|64<<16|0,re.bits=1,0;for(ft=1;ft<Ie&&Ze[ft]===0;ft++);for(_e<ft&&(_e=ft),lt=1,X=1;X<=Mn;X++)if(lt<<=1,lt-=Ze[X],lt<0)return-1;if(lt>0&&(A===pd||Ie!==1))return-1;for(st[1]=0,X=1;X<Mn;X++)st[X+1]=st[X]+Ze[X];for(ue=0;ue<K;ue++)P[S+ue]!==0&&(le[st[P[S+ue]]++]=ue);if(A===pd?(Rt=rn=le,ut=20):A===Fl?(Rt=bC,rn=vC,ut=257):(Rt=kC,rn=IC,ut=0),At=0,ue=0,X=ft,je=F,Ve=_e,Vt=0,_t=-1,et=1<<_e,or=et-1,A===Fl&&et>dd||A===gd&&et>hd)return 1;for(;;){lh=X-Vt,le[ue]+1<ut?(ja=0,Wa=le[ue]):le[ue]>=ut?(ja=rn[le[ue]-ut],Wa=Rt[le[ue]-ut]):(ja=96,Wa=0),ot=1<<X-Vt,ke=1<<Ve,ft=ke;do ke-=ot,j[je+(At>>Vt)+ke]=lh<<24|ja<<16|Wa|0;while(ke!==0);for(ot=1<<X-1;At&ot;)ot>>=1;if(ot!==0?(At&=ot-1,At+=ot):At=0,ue++,--Ze[X]===0){if(X===Ie)break;X=P[S+le[ue]]}if(X>_e&&(At&or)!==_t){for(Vt===0&&(Vt=_e),je+=ft,Ve=X-Vt,lt=1<<Ve;Ve+Vt<Ie&&(lt-=Ze[Ve+Vt],!(lt<=0));)Ve++,lt<<=1;if(et+=1<<Ve,A===Fl&&et>dd||A===gd&&et>hd)return 1;_t=At&or,j[_t]=_e<<24|Ve<<16|je-F|0}}return At!==0&&(j[je+At]=X-Vt<<24|64<<16|0),re.bits=_e,0};const DC=0,fd=1,md=2,{Z_FINISH:Cd,Z_BLOCK:RC,Z_TREES:wa,Z_OK:en,Z_STREAM_END:PC,Z_NEED_DICT:NC,Z_STREAM_ERROR:Gr,Z_DATA_ERROR:_d,Z_MEM_ERROR:yd,Z_BUF_ERROR:MC,Z_DEFLATED:Ad}=ai,Ba=16180,Td=16181,Ed=16182,Sd=16183,Od=16184,bd=16185,vd=16186,kd=16187,Id=16188,Dd=16189,Ua=16190,Si=16191,Vl=16192,Rd=16193,jl=16194,Pd=16195,Nd=16196,Md=16197,xd=16198,Fa=16199,Va=16200,Ld=16201,Kd=16202,wd=16203,Bd=16204,Ud=16205,Wl=16206,Fd=16207,Vd=16208,Ut=16209,jd=16210,Wd=16211,xC=852,LC=592,KC=15,Hd=A=>(A>>>24&255)+(A>>>8&65280)+((A&65280)<<8)+((A&255)<<24);function wC(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const tn=A=>{if(!A)return 1;const P=A.state;return!P||P.strm!==A||P.mode<Ba||P.mode>Wd?1:0},Gd=A=>{if(tn(A))return Gr;const P=A.state;return A.total_in=A.total_out=P.total=0,A.msg="",P.wrap&&(A.adler=P.wrap&1),P.mode=Ba,P.last=0,P.havedict=0,P.flags=-1,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new Int32Array(xC),P.distcode=P.distdyn=new Int32Array(LC),P.sane=1,P.back=-1,en},zd=A=>{if(tn(A))return Gr;const P=A.state;return P.wsize=0,P.whave=0,P.wnext=0,Gd(A)},$d=(A,P)=>{let S;if(tn(A))return Gr;const K=A.state;return P<0?(S=0,P=-P):(S=(P>>4)+5,P<48&&(P&=15)),P&&(P<8||P>15)?Gr:(K.window!==null&&K.wbits!==P&&(K.window=null),K.wrap=S,K.wbits=P,zd(A))},Yd=(A,P)=>{if(!A)return Gr;const S=new wC;A.state=S,S.strm=A,S.window=null,S.mode=Ba;const K=$d(A,P);return K!==en&&(A.state=null),K},BC=A=>Yd(A,KC);let Xd=!0,Hl,Gl;const UC=A=>{if(Xd){Hl=new Int32Array(512),Gl=new Int32Array(32);let P=0;for(;P<144;)A.lens[P++]=8;for(;P<256;)A.lens[P++]=9;for(;P<280;)A.lens[P++]=7;for(;P<288;)A.lens[P++]=8;for(bo(fd,A.lens,0,288,Hl,0,A.work,{bits:9}),P=0;P<32;)A.lens[P++]=5;bo(md,A.lens,0,32,Gl,0,A.work,{bits:5}),Xd=!1}A.lencode=Hl,A.lenbits=9,A.distcode=Gl,A.distbits=5},Jd=(A,P,S,K)=>{let j;const F=A.state;return F.window===null&&(F.wsize=1<<F.wbits,F.wnext=0,F.whave=0,F.window=new Uint8Array(F.wsize)),K>=F.wsize?(F.window.set(P.subarray(S-F.wsize,S),0),F.wnext=0,F.whave=F.wsize):(j=F.wsize-F.wnext,j>K&&(j=K),F.window.set(P.subarray(S-K,S-K+j),F.wnext),K-=j,K?(F.window.set(P.subarray(S-K,S),0),F.wnext=K,F.whave=F.wsize):(F.wnext+=j,F.wnext===F.wsize&&(F.wnext=0),F.whave<F.wsize&&(F.whave+=j))),0},FC=(A,P)=>{let S,K,j,F,le,re,Ne,X,ue,ft,Ie,_e,Ve,Vt,lt=0,et,At,ot,ke,_t,or,je,Rt;const ut=new Uint8Array(4);let Ze,st;const rn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(tn(A)||!A.output||!A.input&&A.avail_in!==0)return Gr;S=A.state,S.mode===Si&&(S.mode=Vl),le=A.next_out,j=A.output,Ne=A.avail_out,F=A.next_in,K=A.input,re=A.avail_in,X=S.hold,ue=S.bits,ft=re,Ie=Ne,Rt=en;e:for(;;)switch(S.mode){case Ba:if(S.wrap===0){S.mode=Vl;break}for(;ue<16;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(S.wrap&2&&X===35615){S.wbits===0&&(S.wbits=15),S.check=0,ut[0]=X&255,ut[1]=X>>>8&255,S.check=Et(S.check,ut,2,0),X=0,ue=0,S.mode=Td;break}if(S.head&&(S.head.done=!1),!(S.wrap&1)||(((X&255)<<8)+(X>>8))%31){A.msg="incorrect header check",S.mode=Ut;break}if((X&15)!==Ad){A.msg="unknown compression method",S.mode=Ut;break}if(X>>>=4,ue-=4,je=(X&15)+8,S.wbits===0&&(S.wbits=je),je>15||je>S.wbits){A.msg="invalid window size",S.mode=Ut;break}S.dmax=1<<S.wbits,S.flags=0,A.adler=S.check=1,S.mode=X&512?Dd:Si,X=0,ue=0;break;case Td:for(;ue<16;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(S.flags=X,(S.flags&255)!==Ad){A.msg="unknown compression method",S.mode=Ut;break}if(S.flags&57344){A.msg="unknown header flags set",S.mode=Ut;break}S.head&&(S.head.text=X>>8&1),S.flags&512&&S.wrap&4&&(ut[0]=X&255,ut[1]=X>>>8&255,S.check=Et(S.check,ut,2,0)),X=0,ue=0,S.mode=Ed;case Ed:for(;ue<32;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}S.head&&(S.head.time=X),S.flags&512&&S.wrap&4&&(ut[0]=X&255,ut[1]=X>>>8&255,ut[2]=X>>>16&255,ut[3]=X>>>24&255,S.check=Et(S.check,ut,4,0)),X=0,ue=0,S.mode=Sd;case Sd:for(;ue<16;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}S.head&&(S.head.xflags=X&255,S.head.os=X>>8),S.flags&512&&S.wrap&4&&(ut[0]=X&255,ut[1]=X>>>8&255,S.check=Et(S.check,ut,2,0)),X=0,ue=0,S.mode=Od;case Od:if(S.flags&1024){for(;ue<16;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}S.length=X,S.head&&(S.head.extra_len=X),S.flags&512&&S.wrap&4&&(ut[0]=X&255,ut[1]=X>>>8&255,S.check=Et(S.check,ut,2,0)),X=0,ue=0}else S.head&&(S.head.extra=null);S.mode=bd;case bd:if(S.flags&1024&&(_e=S.length,_e>re&&(_e=re),_e&&(S.head&&(je=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Uint8Array(S.head.extra_len)),S.head.extra.set(K.subarray(F,F+_e),je)),S.flags&512&&S.wrap&4&&(S.check=Et(S.check,K,_e,F)),re-=_e,F+=_e,S.length-=_e),S.length))break e;S.length=0,S.mode=vd;case vd:if(S.flags&2048){if(re===0)break e;_e=0;do je=K[F+_e++],S.head&&je&&S.length<65536&&(S.head.name+=String.fromCharCode(je));while(je&&_e<re);if(S.flags&512&&S.wrap&4&&(S.check=Et(S.check,K,_e,F)),re-=_e,F+=_e,je)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=kd;case kd:if(S.flags&4096){if(re===0)break e;_e=0;do je=K[F+_e++],S.head&&je&&S.length<65536&&(S.head.comment+=String.fromCharCode(je));while(je&&_e<re);if(S.flags&512&&S.wrap&4&&(S.check=Et(S.check,K,_e,F)),re-=_e,F+=_e,je)break e}else S.head&&(S.head.comment=null);S.mode=Id;case Id:if(S.flags&512){for(;ue<16;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(S.wrap&4&&X!==(S.check&65535)){A.msg="header crc mismatch",S.mode=Ut;break}X=0,ue=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),A.adler=S.check=0,S.mode=Si;break;case Dd:for(;ue<32;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}A.adler=S.check=Hd(X),X=0,ue=0,S.mode=Ua;case Ua:if(S.havedict===0)return A.next_out=le,A.avail_out=Ne,A.next_in=F,A.avail_in=re,S.hold=X,S.bits=ue,NC;A.adler=S.check=1,S.mode=Si;case Si:if(P===RC||P===wa)break e;case Vl:if(S.last){X>>>=ue&7,ue-=ue&7,S.mode=Wl;break}for(;ue<3;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}switch(S.last=X&1,X>>>=1,ue-=1,X&3){case 0:S.mode=Rd;break;case 1:if(UC(S),S.mode=Fa,P===wa){X>>>=2,ue-=2;break e}break;case 2:S.mode=Nd;break;case 3:A.msg="invalid block type",S.mode=Ut}X>>>=2,ue-=2;break;case Rd:for(X>>>=ue&7,ue-=ue&7;ue<32;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if((X&65535)!==(X>>>16^65535)){A.msg="invalid stored block lengths",S.mode=Ut;break}if(S.length=X&65535,X=0,ue=0,S.mode=jl,P===wa)break e;case jl:S.mode=Pd;case Pd:if(_e=S.length,_e){if(_e>re&&(_e=re),_e>Ne&&(_e=Ne),_e===0)break e;j.set(K.subarray(F,F+_e),le),re-=_e,F+=_e,Ne-=_e,le+=_e,S.length-=_e;break}S.mode=Si;break;case Nd:for(;ue<14;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(S.nlen=(X&31)+257,X>>>=5,ue-=5,S.ndist=(X&31)+1,X>>>=5,ue-=5,S.ncode=(X&15)+4,X>>>=4,ue-=4,S.nlen>286||S.ndist>30){A.msg="too many length or distance symbols",S.mode=Ut;break}S.have=0,S.mode=Md;case Md:for(;S.have<S.ncode;){for(;ue<3;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}S.lens[rn[S.have++]]=X&7,X>>>=3,ue-=3}for(;S.have<19;)S.lens[rn[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,Ze={bits:S.lenbits},Rt=bo(DC,S.lens,0,19,S.lencode,0,S.work,Ze),S.lenbits=Ze.bits,Rt){A.msg="invalid code lengths set",S.mode=Ut;break}S.have=0,S.mode=xd;case xd:for(;S.have<S.nlen+S.ndist;){for(;lt=S.lencode[X&(1<<S.lenbits)-1],et=lt>>>24,At=lt>>>16&255,ot=lt&65535,!(et<=ue);){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(ot<16)X>>>=et,ue-=et,S.lens[S.have++]=ot;else{if(ot===16){for(st=et+2;ue<st;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(X>>>=et,ue-=et,S.have===0){A.msg="invalid bit length repeat",S.mode=Ut;break}je=S.lens[S.have-1],_e=3+(X&3),X>>>=2,ue-=2}else if(ot===17){for(st=et+3;ue<st;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}X>>>=et,ue-=et,je=0,_e=3+(X&7),X>>>=3,ue-=3}else{for(st=et+7;ue<st;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}X>>>=et,ue-=et,je=0,_e=11+(X&127),X>>>=7,ue-=7}if(S.have+_e>S.nlen+S.ndist){A.msg="invalid bit length repeat",S.mode=Ut;break}for(;_e--;)S.lens[S.have++]=je}}if(S.mode===Ut)break;if(S.lens[256]===0){A.msg="invalid code -- missing end-of-block",S.mode=Ut;break}if(S.lenbits=9,Ze={bits:S.lenbits},Rt=bo(fd,S.lens,0,S.nlen,S.lencode,0,S.work,Ze),S.lenbits=Ze.bits,Rt){A.msg="invalid literal/lengths set",S.mode=Ut;break}if(S.distbits=6,S.distcode=S.distdyn,Ze={bits:S.distbits},Rt=bo(md,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,Ze),S.distbits=Ze.bits,Rt){A.msg="invalid distances set",S.mode=Ut;break}if(S.mode=Fa,P===wa)break e;case Fa:S.mode=Va;case Va:if(re>=6&&Ne>=258){A.next_out=le,A.avail_out=Ne,A.next_in=F,A.avail_in=re,S.hold=X,S.bits=ue,OC(A,Ie),le=A.next_out,j=A.output,Ne=A.avail_out,F=A.next_in,K=A.input,re=A.avail_in,X=S.hold,ue=S.bits,S.mode===Si&&(S.back=-1);break}for(S.back=0;lt=S.lencode[X&(1<<S.lenbits)-1],et=lt>>>24,At=lt>>>16&255,ot=lt&65535,!(et<=ue);){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(At&&!(At&240)){for(ke=et,_t=At,or=ot;lt=S.lencode[or+((X&(1<<ke+_t)-1)>>ke)],et=lt>>>24,At=lt>>>16&255,ot=lt&65535,!(ke+et<=ue);){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}X>>>=ke,ue-=ke,S.back+=ke}if(X>>>=et,ue-=et,S.back+=et,S.length=ot,At===0){S.mode=Ud;break}if(At&32){S.back=-1,S.mode=Si;break}if(At&64){A.msg="invalid literal/length code",S.mode=Ut;break}S.extra=At&15,S.mode=Ld;case Ld:if(S.extra){for(st=S.extra;ue<st;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}S.length+=X&(1<<S.extra)-1,X>>>=S.extra,ue-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=Kd;case Kd:for(;lt=S.distcode[X&(1<<S.distbits)-1],et=lt>>>24,At=lt>>>16&255,ot=lt&65535,!(et<=ue);){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(!(At&240)){for(ke=et,_t=At,or=ot;lt=S.distcode[or+((X&(1<<ke+_t)-1)>>ke)],et=lt>>>24,At=lt>>>16&255,ot=lt&65535,!(ke+et<=ue);){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}X>>>=ke,ue-=ke,S.back+=ke}if(X>>>=et,ue-=et,S.back+=et,At&64){A.msg="invalid distance code",S.mode=Ut;break}S.offset=ot,S.extra=At&15,S.mode=wd;case wd:if(S.extra){for(st=S.extra;ue<st;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}S.offset+=X&(1<<S.extra)-1,X>>>=S.extra,ue-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){A.msg="invalid distance too far back",S.mode=Ut;break}S.mode=Bd;case Bd:if(Ne===0)break e;if(_e=Ie-Ne,S.offset>_e){if(_e=S.offset-_e,_e>S.whave&&S.sane){A.msg="invalid distance too far back",S.mode=Ut;break}_e>S.wnext?(_e-=S.wnext,Ve=S.wsize-_e):Ve=S.wnext-_e,_e>S.length&&(_e=S.length),Vt=S.window}else Vt=j,Ve=le-S.offset,_e=S.length;_e>Ne&&(_e=Ne),Ne-=_e,S.length-=_e;do j[le++]=Vt[Ve++];while(--_e);S.length===0&&(S.mode=Va);break;case Ud:if(Ne===0)break e;j[le++]=S.length,Ne--,S.mode=Va;break;case Wl:if(S.wrap){for(;ue<32;){if(re===0)break e;re--,X|=K[F++]<<ue,ue+=8}if(Ie-=Ne,A.total_out+=Ie,S.total+=Ie,S.wrap&4&&Ie&&(A.adler=S.check=S.flags?Et(S.check,j,Ie,le-Ie):Zr(S.check,j,Ie,le-Ie)),Ie=Ne,S.wrap&4&&(S.flags?X:Hd(X))!==S.check){A.msg="incorrect data check",S.mode=Ut;break}X=0,ue=0}S.mode=Fd;case Fd:if(S.wrap&&S.flags){for(;ue<32;){if(re===0)break e;re--,X+=K[F++]<<ue,ue+=8}if(S.wrap&4&&X!==(S.total&4294967295)){A.msg="incorrect length check",S.mode=Ut;break}X=0,ue=0}S.mode=Vd;case Vd:Rt=PC;break e;case Ut:Rt=_d;break e;case jd:return yd;case Wd:default:return Gr}return A.next_out=le,A.avail_out=Ne,A.next_in=F,A.avail_in=re,S.hold=X,S.bits=ue,(S.wsize||Ie!==A.avail_out&&S.mode<Ut&&(S.mode<Wl||P!==Cd))&&Jd(A,A.output,A.next_out,Ie-A.avail_out),ft-=A.avail_in,Ie-=A.avail_out,A.total_in+=ft,A.total_out+=Ie,S.total+=Ie,S.wrap&4&&Ie&&(A.adler=S.check=S.flags?Et(S.check,j,Ie,A.next_out-Ie):Zr(S.check,j,Ie,A.next_out-Ie)),A.data_type=S.bits+(S.last?64:0)+(S.mode===Si?128:0)+(S.mode===Fa||S.mode===jl?256:0),(ft===0&&Ie===0||P===Cd)&&Rt===en&&(Rt=MC),Rt},VC=A=>{if(tn(A))return Gr;let P=A.state;return P.window&&(P.window=null),A.state=null,en},jC=(A,P)=>{if(tn(A))return Gr;const S=A.state;return S.wrap&2?(S.head=P,P.done=!1,en):Gr},WC=(A,P)=>{const S=P.length;let K,j,F;return tn(A)||(K=A.state,K.wrap!==0&&K.mode!==Ua)?Gr:K.mode===Ua&&(j=1,j=Zr(j,P,S,0),j!==K.check)?_d:(F=Jd(A,P,S,S),F?(K.mode=jd,yd):(K.havedict=1,en))};var HC=zd,GC=$d,zC=Gd,$C=BC,YC=Yd,XC=FC,JC=VC,qC=jC,ZC=WC,QC="pako inflate (from Nodeca project)",Oi={inflateReset:HC,inflateReset2:GC,inflateResetKeep:zC,inflateInit:$C,inflateInit2:YC,inflate:XC,inflateEnd:JC,inflateGetHeader:qC,inflateSetDictionary:ZC,inflateInfo:QC};function e_(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var t_=e_;const qd=Object.prototype.toString,{Z_NO_FLUSH:r_,Z_FINISH:i_,Z_OK:vo,Z_STREAM_END:zl,Z_NEED_DICT:$l,Z_STREAM_ERROR:n_,Z_DATA_ERROR:Zd,Z_MEM_ERROR:o_}=ai;function ko(A){this.options=xa.assign({chunkSize:1024*64,windowBits:15,to:""},A||{});const P=this.options;P.raw&&P.windowBits>=0&&P.windowBits<16&&(P.windowBits=-P.windowBits,P.windowBits===0&&(P.windowBits=-15)),P.windowBits>=0&&P.windowBits<16&&!(A&&A.windowBits)&&(P.windowBits+=32),P.windowBits>15&&P.windowBits<48&&(P.windowBits&15||(P.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ud,this.strm.avail_out=0;let S=Oi.inflateInit2(this.strm,P.windowBits);if(S!==vo)throw new Error(pr[S]);if(this.header=new t_,Oi.inflateGetHeader(this.strm,this.header),P.dictionary&&(typeof P.dictionary=="string"?P.dictionary=So.string2buf(P.dictionary):qd.call(P.dictionary)==="[object ArrayBuffer]"&&(P.dictionary=new Uint8Array(P.dictionary)),P.raw&&(S=Oi.inflateSetDictionary(this.strm,P.dictionary),S!==vo)))throw new Error(pr[S])}ko.prototype.push=function(A,P){const S=this.strm,K=this.options.chunkSize,j=this.options.dictionary;let F,le,re;if(this.ended)return!1;for(P===~~P?le=P:le=P===!0?i_:r_,qd.call(A)==="[object ArrayBuffer]"?S.input=new Uint8Array(A):S.input=A,S.next_in=0,S.avail_in=S.input.length;;){for(S.avail_out===0&&(S.output=new Uint8Array(K),S.next_out=0,S.avail_out=K),F=Oi.inflate(S,le),F===$l&&j&&(F=Oi.inflateSetDictionary(S,j),F===vo?F=Oi.inflate(S,le):F===Zd&&(F=$l));S.avail_in>0&&F===zl&&S.state.wrap>0&&A[S.next_in]!==0;)Oi.inflateReset(S),F=Oi.inflate(S,le);switch(F){case n_:case Zd:case $l:case o_:return this.onEnd(F),this.ended=!0,!1}if(re=S.avail_out,S.next_out&&(S.avail_out===0||F===zl))if(this.options.to==="string"){let Ne=So.utf8border(S.output,S.next_out),X=S.next_out-Ne,ue=So.buf2string(S.output,Ne);S.next_out=X,S.avail_out=K-X,X&&S.output.set(S.output.subarray(Ne,Ne+X),0),this.onData(ue)}else this.onData(S.output.length===S.next_out?S.output:S.output.subarray(0,S.next_out));if(!(F===vo&&re===0)){if(F===zl)return F=Oi.inflateEnd(this.strm),this.onEnd(F),this.ended=!0,!0;if(S.avail_in===0)break}}return!0},ko.prototype.onData=function(A){this.chunks.push(A)},ko.prototype.onEnd=function(A){A===vo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=xa.flattenChunks(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg};function Yl(A,P){const S=new ko(P);if(S.push(A),S.err)throw S.msg||pr[S.err];return S.result}function a_(A,P){return P=P||{},P.raw=!0,Yl(A,P)}var s_=ko,l_=Yl,u_=a_,c_=Yl,d_=ai,h_={Inflate:s_,inflate:l_,inflateRaw:u_,ungzip:c_,constants:d_};const{Deflate:p_,deflate:g_,deflateRaw:f_,gzip:m_}=EC,{Inflate:C_,inflate:__,inflateRaw:y_,ungzip:A_}=h_;var Qd=p_,eh=g_,th=f_,rh=m_,ih=C_,nh=__,oh=y_,ah=A_,sh=ai,T_={Deflate:Qd,deflate:eh,deflateRaw:th,gzip:rh,Inflate:ih,inflate:nh,inflateRaw:oh,ungzip:ah,constants:sh};t.Deflate=Qd,t.Inflate=ih,t.constants=sh,t.default=T_,t.deflate=eh,t.deflateRaw=th,t.gzip=rh,t.inflate=nh,t.inflateRaw=oh,t.ungzip=ah,Object.defineProperty(t,"__esModule",{value:!0})})}(Go,Go.exports)),Go.exports}var qp=M0(),x0=Object.defineProperty,L0=Object.getOwnPropertyDescriptor,oi=(s,e,t,n)=>{for(var i=n>1?void 0:n?L0(e,t):e,r=s.length-1,a;r>=0;r--)(a=s[r])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&x0(e,t,i),i};ve.environment.setEnvVar("openbabel.scriptSrc","https://cdn.jsdelivr.net/gh/limefrogyank/LewisStructuresWeb@latest/dist/openbabel.js");ve.OpenBabel.enable(()=>console.log("OpenBabelModule Loaded!"));const K0=new Promise((s,e)=>{xm()});function xm(s){setTimeout(()=>{window.OpenBabelModule===void 0&&(console.log("OpenBabelModule not loaded yet"),xm())},100)}Af().register(Cf()).register(Sb()).register(_f()).register(_b()).register(Ab());const w0=ht`  
 
<fluent-design-system-provider use-defaults>
<style>
.eventless{
	pointer-events:none;
}
g:focus{
	outline: none;
}
g:focus-visible{
	outline: -webkit-focus-ring-color auto 5px;
}
</style>
${vi(s=>!s.readonly,ht`
	<div role="toolbar" ${tr("toolbarDiv")} style="display:flex;flex-wrap:wrap;" aria-label="Toolbar with button groups">

		<div style="display:flex;margin-right:5px;">
			<fluent-button appearance="accent" id='draw' class="toolButton">Draw</fluent-button>
			<fluent-button appearance="outline" id='move' class="toolButton">Move</fluent-button>
			<fluent-button appearance="outline" id='erase' class="toolButton">Erase</fluent-button>
		</div>

		<div style="display:flex;margin-right:5px;" class="btn-group me-2" role="group" >
			<fluent-button apearance="outline" class="elementButton" ${tr("periodicTableButton")} 
				@click="${(s,e)=>{s.visibleElementSelector=!s.visibleElementSelector}}"
				aria-label="Element Selector">
				Element Select
			</fluent-button>
			<fluent-text-field ${tr("elementTextField")} size="1" class="elementButton" readonly value="${s=>s.settingsService.currentElement}"></fluent-text-field>
		</div>

		<div style="display:flex;margin-right:5px;" class="btn-group me-2" role="group" aria-label="Electrons button group">

			<fluent-button appearance="accent" id='single' class="electronButton" aria-label="Single Bond">
				<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
					<path
						d="M 0.17263349,14.53574 14.604793,0.1035801 15.968598,1.4673847 1.5019114,15.934071 Z"
					/>
				</svg>
			</fluent-button>
			<fluent-button appearance="outline" id='double' class="electronButton" aria-label="Double bond">
				<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
					<path
						d="M 0.11187782,11.695577 11.678321,0.09460633 13.042126,1.4584109 1.4411558,13.093908 Z"
					/>
					<path
						d="M 2.9948582,14.526764 14.561301,2.9257944 15.925106,4.289599 4.3241362,15.925096 Z"
					/>
				</svg>
			</fluent-button>
			<fluent-button appearance="outline" id='triple' class="electronButton" aria-label="Triple bond">
				<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
					<path
						d="M 0.11187782,10.418089 10.400833,0.09460636 11.764638,1.4584109 1.4411558,11.81642 Z"
					/>
					<path
						d="M 2.2180078,12.472426 12.506963,2.1489436 13.870768,3.5127482 3.5472858,13.870757 Z"
					/>
					<path
						d="M 4.2550831,14.544028 14.544038,4.2205455 15.907843,5.5843501 5.5843611,15.942359 Z"
					/>
				</svg>
			</fluent-button>
			<fluent-button appearance="outline" id='dashed' class="electronButton" aria-label="Dashed wedge bond">
				<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
					<path
						d="m 0.1009346,15.919433 2.0063376,-2.93919 0.9546284,0.952815 z" />
					<path
						d="M 3.2398821,11.397603 4.6475544,12.8026 6.1523075,11.75289 4.2430508,9.847261 Z" />
					<path
						d="M 7.7703217,10.68703 5.29476,8.2161722 6.4435501,6.520486 9.4692364,9.5404225 Z" />
					<path
						d="M 7.802682,4.55026 11.443214,8.1838735 12.883247,7.0695653 8.8220309,3.0160676 Z" />
					<path
						d="M 9.943689,1.3810679 14.553003,5.9903821 15.899544,5.092688 10.806856,2.3870958e-7 Z"/>
				</svg>
			</fluent-button>
			<fluent-button appearance="outline" id='solid' class="electronButton" aria-label="Solid wedge bond">
				<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
					<path
					d="M 0.10358009,15.916808 10.841383,0.0345267 15.899544,5.092688 Z"
					/>
				</svg>
			</fluent-button>
			<fluent-button appearance="outline" id='lonePair' class="electronButton" aira-label="Lone pair electrons">
				<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
					<circle
						r="2.3132887"
						cy="7.7685075"
						cx="4.1086769"
						id="path2067"
							/>
						<circle
						id="path2067-4"
						cx="12.153398"
						cy="7.6994534"
						r="2.3132887" />
				</svg>
			</fluent-button>
			<fluent-button appearance="outline" id='positive' class="electronButton" aria-label="Positive Formal Charge"
				:innerHTML="${s=>k0}">		
			</fluent-button>
			<fluent-button appearance="outline" id='negative' class="electronButton" aria-label="Negative Formal Charge" 
				:innerHTML="${s=>v0}">				
			</fluent-button>
		</div>

		${vi(s=>s.debug,ht`
		<div style="display:flex;margin-right:5px;" role="group" >
			<fluent-button appearance="${s=>s.settingsService.readAloudAtoms?"accent":"outline"}" class="readAloudButton" ${tr("readAloudButton")} aria-label="Read aloud toggle">
				🔊&#xFE0E;
			</fluent-button>
		</div>
		`)}
	</div>
	`)}
	<div id='svgContainer' ${tr("svgContainer")} style='width:${s=>s.width}px;height:${s=>s.height}px;border:black solid 1px;user-select:none;pointer-events:${s=>s.readonly?"none":"auto"}'>

	</div>
	
	<periodic-table-modal 
		@change="${(s,e)=>{s.settingsService.setElement(e.event.detail),s.dismissPeriodicTable()}}"
		visible="${s=>s.visibleElementSelector}" 
		@dismiss="${s=>s.dismissPeriodicTable()}"
	>
	</periodic-table-modal>
${vi(s=>s.debug,ht`
	<div role="toolbar" style="display:flex;flex-wrap:wrap;" aria-label="Toolbar with button groups">
		<div style="display:flex;margin-right:5px;">
			<fluent-button appearance="outline" @click="${async s=>console.log(await s.compareMoleculeAsync())}">Compare</fluent-button>
			<fluent-button appearance="outline" @click="${s=>console.log(s.getMolMime())}">Get MMime</fluent-button>
			<fluent-button appearance="outline" @click="${s=>console.log(s.getKekuleMime())}">Get KMime</fluent-button>
			
			<fluent-button appearance="outline" @click="${s=>s.compareMoleculeAsync2(s.smiles)}" >Check Molecule</fluent-button>
			<fluent-button appearance="outline" @click="${s=>s.runTestsAsync()}">Run Tests</fluent-button>
			<fluent-button appearance="outline" @click="${s=>s.loadOne()}">Load One</fluent-button>
		</div>
	</div>

<textarea >
${s=>s.debugString}
</textarea>
`)}
</fluent-design-system-provider>
`;let qr=class extends to{constructor(){super();oe(this,"height",400);oe(this,"width",400);oe(this,"visibleElementSelector",!1);oe(this,"debugString","");oe(this,"smiles");oe(this,"mol",null);oe(this,"readonly",!1);oe(this,"explicitLonePairs",!1);oe(this,"useFormalCharge",!1);oe(this,"noPerspective",!1);oe(this,"debug",!1);oe(this,"periodicTableButton");oe(this,"periodicTableModal");oe(this,"svgContainer");oe(this,"settingsService",new Wf);oe(this,"elementTextField");oe(this,"keyboardDiv");oe(this,"menuButton");oe(this,"readAloudButton");oe(this,"mainModal");oe(this,"toolbarDiv");oe(this,"molecule");oe(this,"mainSVG");this.molecule=new ve.Molecule}dismissPeriodicTable(){Vp(),this.visibleElementSelector=!1,this.periodicTableButton.focus()}async loadMoleculeUsingSmilesAsync(e){let t=await this.loadSmilesAsync(e);Bi(t,{useFlat:!1,showFormalCharges:this.useFormalCharge}),this.clearMolecule(),this.molecule=this.drawMolecule(t,this.mainSVG,!0)}async loadMoleculeUsingMolAsync(e,t=!1){if(t){const n=await new Promise((i,r)=>{let a=window.OpenBabelModule();a.onRuntimeInitialized=()=>{window.ob=a;let o=new a.OBMol,l=new a.ObConversionWrapper;l.setInFormat("","mol"),l.readString(o,e),a.OBOp.FindType("gen2D").Do(o,"");let c=new ve.Molecule;xp(a,o,c),i(c)}});this.explicitLonePairs?dk(n,{useFlat:!1,showFormalCharges:this.useFormalCharge}):Bi(n,{useFlat:!1,showFormalCharges:this.useFormalCharge}),this.clearMolecule(),this.molecule=this.drawMolecule(n,this.mainSVG,!0)}}async loadOne(){this.molecule=new ve.Molecule;let e=await this.loadSmilesAsync("[CH3-]");Bi(e,{useFlat:!1,showFormalCharges:this.useFormalCharge}),this.clearMolecule(),this.molecule=this.drawMolecule(e,this.mainSVG,!0)}async runTestsAsync(){for(const e of b0){this.molecule=new ve.Molecule;let t=await this.loadSmilesAsync(e.smiles);Bi(t,{useFlat:!1,showFormalCharges:this.useFormalCharge}),this.clearMolecule(),this.molecule=this.drawMolecule(t,this.mainSVG,!0);let n=0;for(const i of e.tests){const r=ve.IO.loadMimeData(i.tryMatchWith,"chemical/x-kekule-json"),a=this.compareStructure(this.molecule,r);for(const l in a)if(typeof a[l]!="object"&&a[l]!==i.result[l]){console.error(`%c KEY: ${l}`,"color: red;"),console.error(`%c Test failed for ${e.smiles} and ${i.tryMatchWith}`,"color: red;"),console.error(`%c Expected ${i.result[l]} but got ${a[l]}`,"color: red;"),console.error(i.result),console.error(a),console.error("%c Test Index: "+n,"color: red;");break}const o=this.checkDashWedgeBonds(r);o.length>0&&i.perspectiveTest.pass?(console.error(`%cFor ${e.smiles}, index=${n}, ${o.length} node(s) did not have perspective drawn correctly.`,"color: red;"),console.error(o)):o.length===0&&!i.perspectiveTest.pass&&console.warn(`For ${e.smiles}, index=${n}, molecule should have failed the perspective test, but did not. `),n++}ve.IO.saveMimeData(this.molecule,"chemical/x-kekule-json"),this.getSVG(),ve.IO.saveFormatData(this.molecule,"smi"),this.debugString+=await this.exportCanonicalSmilesAsync(this.molecule),this.debugString+=`

`}}async getCompressedWebworkOutputAsync(){if(this.molecule==null)return new Wp({programError:"No structure has been loaded."});const e=new Wp({perspectiveCorrect:!0});this.checkDashWedgeBonds(this.molecule).length>0&&(e.programError="Perspective is not drawn correctly.",e.perspectiveCorrect=!1);let n=this.getKekuleMime(),i=P0.Buffer.from(n),r=await new Promise((o,l)=>{const u=qp.deflate(i);var c=u.byteLength;let d="";for(var h=0;h<c;h++)d+=String.fromCharCode(u[h]);o(window.btoa(d))});e.kekuleMimeCompressed=r;let a=JSON.parse(n);delete a.coordPos2D,delete a.coordPos3D,delete a.renderOptions,delete a.parity;for(const o of a.ctab.nodes)if(delete o.coordPos2D,delete o.coordPos3D,delete o.coord2D,o.attachedMarkers)for(const l of o.attachedMarkers)delete l.coordPos2D,delete l.coordPos3D,delete l.isAttachedToParent,delete l.coord2D,delete l.parity;delete a.anchorNodes;for(const o of a.ctab.connectors)delete o.coordPos2D,delete o.coordPos3D,delete o.coord2D,delete o.parity,delete o.isInAromaticRing;return e.simpleKekule=JSON.stringify(a),e}async getBlindOutputAsync(){if(this.molecule==null)return new Ou({programError:"No structure has been loaded."});let e=await this.exportCanonicalSmilesAsync(this.molecule);if(e==null||e=="")return new Ou({empty:!0,programError:"Structure does not correspond to correct any valid structure."});let t=await this.loadSmilesAsync(e);t.getNodeCount()!==this.molecule.getNodeCount()&&(e=await this.exportCanonicalSmilesAsync(this.molecule,!0),t=await this.loadSmilesAsync(e));const n=await this.exportInChIAsync(this.molecule),i=await this.exportMolAsync(this.molecule),r=new Ou({smiles:e,inchi:n,mol:i}),a=this.checkDashWedgeBonds(this.molecule);a.length>0&&(r.programError="Perspective is not drawn correctly.",r.perspectiveCorrect=!1,r.perspectiveErrorAtom=a.map(l=>l.symbol)),r.kekuleMime=this.getKekuleMime(),r.svg=this.getSVG(),r.atomNums=this.molecule.nodes.filter(l=>l instanceof ve.Atom).map(l=>l.atomicNumber),Bi(t,{useFlat:!1,showFormalCharges:this.useFormalCharge});const o=this.compareStructure(this.molecule,t);return r.blindComparisonResult=zt.toStringOutput(o),r.blindComparisonResult.lonePairCountError&&(r.programError!==""&&(r.programError+=`
`),r.programError+="Lone pairs are not drawn correctly."),r}checkPerspective(){return!(this.molecule==null||this.checkDashWedgeBonds(this.molecule).length>0)}async compareMoleculeAsync(){if(this.molecule==null)return new bu({empty:!0});if(this.smiles==""||this.smiles==null)return new bu({programError:"Missing SMILES to compare molecule to."});let e=new bu({smiles:this.smiles}),t=await this.loadSmilesAsync(this.smiles);Bi(t,{useFlat:!1,showFormalCharges:this.useFormalCharge}),e.comparisonResult=zt.toStringOutput(this.compareStructure(this.molecule,t));const n=this.checkDashWedgeBonds(this.molecule);return n.length>0&&(e.perspectiveCorrect=!1,e.perspectiveErrorAtom=n.map(i=>i.symbol)),e}async getMolecule(){if(this.molecule==null)return"";let e=1,t=await this.loadSmilesAsync(Hp[e]);console.log(t);let n=t.clone();Bi(n,{useFlat:!1,showFormalCharges:this.useFormalCharge}),console.log(n),this.molecule=this.drawMolecule(n,this.mainSVG,!0);let i=await this.compareMoleculeAsync2(Hp[e]);console.log(`They match?  ${i}`);let r=ve.IO.saveMimeData(this.molecule,"chemical/x-kekule-json");return this.getSVG(),r}verifyElectronCount(){if(this.molecule==null)return!1;let e=this.molecule.nodes.filter(a=>a instanceof ve.Atom).map(a=>a),t=0;for(const a of e){const o=a.getMarkersOfType(ve.ChemMarker.UnbondedElectronSet);t+=o.length*2}let n=this.molecule.connectors.filter(a=>a instanceof ve.Bond).map(a=>a),i=0;for(const a of n)i+=a.bondOrder*2;let r=0;for(const a of e)r+=zp(a);for(const a of e){const o=a.getMarkersOfType(ve.ChemMarker.Charge);for(const l of o)r-=l.value}return r===t+i}async getSMILESAsync(){return this.molecule==null?"empty":this.verifyElectronCount()?await this.exportCanonicalSmilesAsync(this.molecule):(console.warn("Not a valid Lewis structure"),"invalid")}getKekuleMime(){return this.molecule==null?"":ve.IO.saveMimeData(this.molecule,"chemical/x-kekule-json")}getMolMime(){if(this.molecule==null)return"";let e=ve.IO.saveMimeData(this.molecule,"chemical/x-mdl-molfile");return console.log(e),e}loadKekule(e){this.molecule=ve.IO.loadMimeData(e,"chemical/x-kekule-json"),this.drawMolecule(this.molecule,this.mainSVG,!0)}loadKekuleCompressed(e){let t=window.atob(e),n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);const i=qp.inflate(n),r=new TextDecoder().decode(i);this.molecule=ve.IO.loadMimeData(r,"chemical/x-kekule-json"),this.drawMolecule(this.molecule,this.mainSVG,!0)}async getImageAsync(){return await this.svgToPngAsync(this.mainSVG.svg())}async svgToPngAsync(e){const t=this.getSvgUrl(e),n=await this.svgUrlToPngAsync(t);return URL.revokeObjectURL(t),n}getSvgUrl(e){return URL.createObjectURL(new Blob([e],{type:"image/svg+xml"}))}svgUrlToPngAsync(e){const t=document.createElement("img");document.body.appendChild(t);const n=new Promise((i,r)=>{t.onload=()=>{const a=document.createElement("canvas");a.width=t.clientWidth,a.height=t.clientHeight;const o=a.getContext("2d");if(o==null)r("canvasCtx is null");else{o.drawImage(t,0,0);const l=a.toDataURL("image/webp",.1);i(l)}}});return t.src=e,n}loadSmilesAsync(e){return new Promise((t,n)=>{let i=window.OpenBabelModule();i.onRuntimeInitialized=()=>{window.ob=i;let r=new i.OBMol,a=new i.ObConversionWrapper;a.setInFormat("","smi"),a.readString(r,e),i.OBOp.FindType("gen2D").Do(r,"");let l=r.NumAtoms();for(let c=0;c<l;c++){let d=r.GetAtom(c+1);r.AddHydrogens(d)}let u=new ve.Molecule;xp(i,r,u),t(u)}})}exportCanonicalSmilesAsync(e,t=!1){return new Promise((n,i)=>{const r=e.clone();r.nodes.forEach(l=>{const u=l,c=u.getMarkersOfType(ve.ChemMarker.UnbondedElectronSet).length,d=u.getLinkedBonds().reduce((h,p)=>h+p.bondOrder,0);if(u.atomicNumber>5){const h=zp(u)-(c*2+d);h!==0&&u.setCharge(h)}});let a=ve.IO.saveMimeData(r,"chemical/x-mdl-molfile"),o=window.OpenBabelModule();o.onRuntimeInitialized=()=>{window.ob=o;let l=new o.OBMol,u=new o.ObConversionWrapper;u.setInFormat("","mol"),u.readString(l,a);const c=qv(o,l,t);n(c)}})}exportInChIAsync(e){return new Promise((t,n)=>{let i=ve.IO.saveMimeData(e,"chemical/x-mdl-molfile"),r=window.OpenBabelModule();r.onRuntimeInitialized=()=>{window.ob=r;let a=new r.OBMol,o=new r.ObConversionWrapper;o.setInFormat("","mol"),o.readString(a,i);const l=Zv(r,a);t(l)}})}exportMolAsync(e){let t=ve.IO.saveMimeData(e,"chemical/x-mdl-molfile");return Promise.resolve(t)}getSVG(){return this.mainSVG.svg(t=>{t.hasClass("interactive")&&t.remove(),(t.type=="feGaussianBlur"||t.type=="filter")&&t.remove(),t.node.hasAttribute("svgjs:data")&&t.node.removeAttribute("svgjs:data")})}async compareMoleculeAsync2(e){if(this.molecule==null)return!1;let t=await this.loadSmilesAsync(e);return Bi(t,{useFlat:!1,showFormalCharges:this.useFormalCharge}),this.compareStructure(this.molecule,t),!0}checkDashWedgeBonds(e){let t=e.nodes.filter(i=>i instanceof ve.Atom);const n=[];for(const i of t){const r=i.getLinkedBonds(),a=i.getMarkersOfType(ve.ChemMarker.UnbondedElectronSet);switch(r.length+a.length){case 0:case 1:case 2:case 3:break;case 4:if(r.length<=2)break;if(r.length==3){if(r.filter(o=>o.stereo==ve.BondStereo.NONE).length==1&&r.filter(o=>o.stereo==ve.BondStereo.UP).length==1&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==1)break;n.push(i);break}else if(r.length==4){if(r.filter(o=>o.stereo==ve.BondStereo.NONE).length==2&&r.filter(o=>o.stereo==ve.BondStereo.UP).length==1&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==1||r.filter(o=>o.stereo==ve.BondStereo.UP).length==2&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==2)break;n.push(i);break}else break;case 5:if(r.length<=3)break;if(r.length==4){if(r.filter(o=>o.stereo==ve.BondStereo.NONE).length==2&&r.filter(o=>o.stereo==ve.BondStereo.UP).length==1&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==1)break;n.push(i);break}else if(r.length==5){if(r.filter(o=>o.stereo==ve.BondStereo.NONE).length==3&&r.filter(o=>o.stereo==ve.BondStereo.UP).length==1&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==1)break;n.push(i);break}else break;case 6:if(r.length<=3)break;if(r.length==4){if(r.filter(o=>o.stereo==ve.BondStereo.NONE).length==4||r.filter(o=>o.stereo==ve.BondStereo.UP).length==2&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==2)break;n.push(i);break}else if(r.length==5){if(r.filter(o=>o.stereo==ve.BondStereo.NONE).length==4&&r.filter(o=>o.stereo==ve.BondStereo.UP).length==1||r.filter(o=>o.stereo==ve.BondStereo.NONE).length==4&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==1||r.filter(o=>o.stereo==ve.BondStereo.UP).length==2&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==2&&r.filter(o=>o.stereo==ve.BondStereo.NONE).length==1)break;n.push(i);break}else if(r.length==6){if(r.filter(o=>o.stereo==ve.BondStereo.UP).length==2&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==2&&r.filter(o=>o.stereo==ve.BondStereo.NONE).length==2||r.filter(o=>o.stereo==ve.BondStereo.UP).length==1&&r.filter(o=>o.stereo==ve.BondStereo.DOWN).length==1&&r.filter(o=>o.stereo==ve.BondStereo.NONE).length==4)break;n.push(i);break}else break}}return n}compareStructure(e,t){let n=e.clone(),i=t.clone();n=ve.canonicalizer.canonicalize(n,null),i=ve.canonicalizer.canonicalize(i,null),n=ve.MolStandardizer.standardize(n,{clearHydrogens:!1}),i=ve.MolStandardizer.standardize(i,{clearHydrogens:!1});let r={doStandardize:!1,extraComparisonProperties:["canonicalizationIndex","bondOrder"],method:ve.ComparisonMethod.CHEM_STRUCTURE,clearHydrogens:!1};return this.compare(n,i,r)}compare(e,t,n){const i=ve.ObjComparer;let r=0;const a=new zt;if(e&&t){if(r===0){var o=e.nodes,l=t.nodes;if(r=o.length-l.length,r===0)for(var u=0,c=o.length;u<c;++u)if(r=i.compare(o[u],l[u],n),r!==0){a.nodeError=r,a.node=l[u];break}else{const p=o[u].getMarkersOfType(ve.ChemMarker.UnbondedElectronSet),g=l[u].getMarkersOfType(ve.ChemMarker.UnbondedElectronSet);if(p.length!==g.length){a.lonePairCountError=p.length-g.length,a.lonePairNodeError=l[u];break}o[u].getLinkedBonds().map(f=>f.stereo).sort(),l[u].getLinkedBonds().map(f=>f.stereo).sort()}else a.nodeCountError=r}if(r===0){var d=e.connectors,h=t.connectors;if(r=d.length-h.length,r===0){for(var u=0,c=d.length;u<c;++u)if(r=i.compare(d[u],h[u],n),r!==0){a.connectorError=r,a.connector=h[u];break}}else a.connectorCountError=r}if(r===0){e.clearExplicitBondHydrogens(!0),t.clearExplicitBondHydrogens(!0);var d=e.connectors,h=t.connectors;const f=e.connectors.map(C=>C.stereo).sort(),m=t.connectors.map(C=>C.stereo).sort();if(f.length===m.length)for(let C=0;C<f.length;C++)f[C]!==m[C]&&a.connectorStereochemistryError++}}return a}clearMolecule(){if(this.molecule!=null){const e=this.molecule;let t=e.getNodeCount();for(let n=t-1;n>=0;n--)e.getNodeAt(n);this.molecule=null}this.mainSVG.clear()}loadMolecule(e){this.clearMolecule();let t=ve.IO.loadMimeData(e,"chemical/x-kekule-json");return this.drawMolecule(t)}drawMolecule(e,t=this.mainSVG,n=!1){var C,_;let i=1/0,r=1/0,a=-1/0,o=-1/0,l=-1/0,u=1/0,c=1,d=0,h=0,p=0,g=0;if(n){e.nodes.forEach(T=>{p+=T.coord2D.x,g+=T.coord2D.y,i=Math.min(i,T.coord2D.x),r=Math.min(r,T.coord2D.y),a=Math.max(a,T.coord2D.x),o=Math.max(o,T.coord2D.y)}),p/=e.nodes.length,g/=e.nodes.length,e.nodes.forEach(T=>{T.setCoord2D({x:T.coord2D.x-p,y:T.coord2D.y-g})}),l=Math.max(a,o),u=Math.min(i,r);let y=l-u;y*=1.2,c=+t.width()/2/y,d=+t.width()/2,h=+t.height()/2}let f=new Map;for(let y=0;y<e.getNodeCount();y++){let T=e.getNodeAt(y);T.coord2D={x:T.coord2D.x*c+d,y:T.coord2D.y*c+h};let E=new ze({identity:T.symbol,x:T.coord2D.x,y:T.coord2D.y,molecule:e,atom:T,svg:this.mainSVG});f.set(T,E)}for(let y=0;y<e.getConnectorCount();y++){let T=e.getConnectorAt(y),E=T.getConnectedChemNodes();if(E.length==2){let b;T.bondOrder==1?T.stereo==ve.BondStereo.UP?b=dt.solid:T.stereo==ve.BondStereo.DOWN?b=dt.dashed:b=dt.single:T.bondOrder==2?b=dt.double:T.bondOrder==3?b=dt.triple:b=dt.single;var m=new Fo({vertex1:f.get(E[0]),vertex2:f.get(E[1]),bondType:b,molecule:e,bond:T,svg:this.mainSVG});(C=f.get(E[0]))==null||C.addConnector(m),(_=f.get(E[1]))==null||_.addConnector(m)}else throw"There should only be two atoms!"}for(const[y,T]of f){let E=y.getMarkersOfType(ve.ChemMarker.UnbondedElectronSet,!1);for(let v=0;v<E.length;v++){let I=E[v],R=T.Position;R.x,R.y,I.coord2D!==void 0&&(I.coord2D.x-R.x,I.coord2D.y-R.y);let N=T.bondCount()+E.length,L=T.getAngleThatFits(N),U=new $t({radians:L,owner:T,molecule:e,svg:this.mainSVG,electronSet:I});T.addLonePair(U)}let b=y.getMarkersOfType(ve.ChemMarker.Charge,!1);for(let v=0;v<b.length;v++){let I=b[v],R=T.Position;R.x,R.y,I.coord2D!==void 0&&(I.coord2D.x-R.x,I.coord2D.y-R.y);let N=new cn({owner:T,molecule:e,svg:this.mainSVG,charge:I,radians:0});T.addFormalCharge(N)}}return e}onResize(){this.mainSVG.height(this.height),this.mainSVG.width(this.width)}visibleElementSelectorChanged(e,t){}async connectedCallback(){super.connectedCallback(),this.mainSVG=Vp(),this.mainSVG.addTo(this.svgContainer),this.mainSVG.size(this.width,this.height),this.mainSVG.on("change",t=>{this.$emit("change",t)}),this.mainSVG.tag=Symbol(),ya.register(this.mainSVG.tag,{useValue:this.settingsService});let e=this.onResize.bind(this);if(window.onresize=e,this.settingsService.keyboardDiv=this.keyboardDiv,this.readonly&&this.settingsService.setDrawMode(un.none),this.mainSVG.mousedown(t=>{if(t.button!=0){t.preventDefault();return}if(this.settingsService.isDrawMode&&this.molecule!=null){const n=this.mainSVG.node.getBoundingClientRect();new ze({identity:this.settingsService.currentElement,x:t.clientX-n.left,y:t.clientY-n.top,molecule:this.molecule,svg:this.mainSVG})}}),this.shadowRoot!=null){let t=this.shadowRoot.querySelectorAll(".toolButton");for(let r=0;r<t.length;r++){let a=t.item(r);a&&(a.onclick=o=>{let l=o.target;if(l.appearance!="accent")switch(this.resetButtons(t),l.appearance="accent",l.id){case"draw":this.settingsService.setDrawMode(un.draw);break;case"move":this.settingsService.setDrawMode(un.move);break;case"erase":this.settingsService.setDrawMode(un.erase);break}})}let n=this.shadowRoot.querySelectorAll(".elementButton");this.readAloudButton!=null&&(this.readAloudButton.onclick=r=>{this.settingsService.readAloudAtoms=!this.settingsService.readAloudAtoms});let i=this.shadowRoot.querySelectorAll(".electronButton");for(let r=0;r<i.length;r++){let a=i.item(r);a&&(a.onclick=o=>{let l=o.target;if(l.appearance!="accent")if(this.resetButtons(i),l.appearance="accent",this.settingsService.currentBondType=dt[l.id],dt[l.value]==dt.lonePair)for(let u=0;u<n.length;u++){let c=n.item(u);c.disabled=!0}else for(let u=0;u<n.length;u++){let c=n.item(u);c.disabled=!1}})}this.settingsService.whenMode.subscribe(r=>{if(r==un.draw){if(this.settingsService.currentBondType!==dt.lonePair)for(let a=0;a<n.length;a++){let o=n.item(a);o.disabled=!1}for(let a=0;a<i.length;a++){let o=i.item(a);o.disabled=!1}}else{for(let a=0;a<n.length;a++){let o=n.item(a);o.disabled=!0}for(let a=0;a<i.length;a++){let o=i.item(a);o.disabled=!0}}}),this.settingsService.whenElement.subscribe(r=>{this.elementTextField!==void 0&&(this.elementTextField.value=r)})}await K0,this.mol!=null&&this.loadMoleculeUsingMolAsync(this.mol,!0)}resetButtons(e){for(let t=0;t<e.length;t++)e[t].appearance="outline"}};oi([Ee],qr.prototype,"height",2);oi([Ee],qr.prototype,"width",2);oi([Ee],qr.prototype,"visibleElementSelector",2);oi([tt],qr.prototype,"debugString",2);oi([Ee],qr.prototype,"smiles",2);oi([Ee],qr.prototype,"mol",2);oi([Ee({mode:"boolean"})],qr.prototype,"readonly",2);oi([Ee({mode:"boolean",attribute:"explicit-lone-pairs"})],qr.prototype,"explicitLonePairs",2);oi([Ee({mode:"boolean",attribute:"show-formal-charges"})],qr.prototype,"useFormalCharge",2);oi([Ee({mode:"boolean",attribute:"flat"})],qr.prototype,"noPerspective",2);qr=oi([sc({name:"lewis-structure-canvas",template:w0,shadowOptions:{mode:"open"}})],qr);PE().register(RE(),kE());
